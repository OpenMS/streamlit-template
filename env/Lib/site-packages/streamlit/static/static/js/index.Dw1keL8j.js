var nk=Object.defineProperty;var ik=(r,e,t)=>e in r?nk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var J=(r,e,t)=>ik(r,typeof e!="symbol"?e+"":e,t);import{g as th,r as Bt,at as yr,aS as dt,aT as Bu,_ as kR,j as Es,B as Vc,aU as pv,F as AT,aV as gv,aW as sk,aX as pT,aY as ok,aD as ak,aZ as ck,n as UR,A as zR,S as Eb,a_ as gT,aA as lk,y as uk,a$ as fk,b0 as mT}from"./index.DmrHunjf.js";import{_ as as,a as hk,C as dk}from"./toConsumableArray.D_I0ytZe.js";import{a as Wu,b as Xu,_ as ux,c as tA,d as fx}from"./possibleConstructorReturn.CsfwiF-x.js";import{a as Ak,T as pk}from"./Toolbar.Bj8O1njj.js";import{u as GR,E as VR,w as gk}from"./withFullScreenWrapper.C7S0FcQa.js";import{u as mk}from"./useBasicWidgetState.Qz7AufmX.js";import{u as _k,s as yk}from"./threshold.DjX0wlsa.js";import{a as vk}from"./index.DW_MHI2K.js";import"./FormClearHelper.CDiPqtGN.js";import"./value.CgPGBV_l.js";function bk(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}const vu={};async function rh(r,e,t,n){return n._parse(r,e,t,n)}function $n(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const z_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),_T=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_T&&parseFloat(_T[1]);const d0=globalThis,Qh=globalThis.process||{},xk=globalThis.navigator||{};function HR(r){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function $u(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||HR()}function wk(r){return $u()?HR()?"Electron":(xk.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const jR="4.0.7";function Ck(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class Ek{constructor(e,t,n="sessionStorage"){this.storage=Ck(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function Tk(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function Bk(r,e=8){const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var Fm;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Fm||(Fm={}));const Sk=10;function yT(r){return typeof r!="string"?r:(r=r.toUpperCase(),Fm[r]||Fm.WHITE)}function Ik(r,e,t){return!$u&&typeof r=="string"&&(e&&(r=`\x1B[${yT(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${yT(t)+Sk}m${r}\x1B[49m`)),r}function Mk(r,e=["constructor"]){const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(c=>o===c)||(i[o]=s.bind(r)))}}function hx(r,e){if(!r)throw new Error("Assertion failed")}function ed(){var e,t,n;let r;if($u()&&d0.performance)r=(t=(e=d0==null?void 0:d0.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Qh){const i=(n=Qh==null?void 0:Qh.hrtime)==null?void 0:n.call(Qh);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const td={debug:$u()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Pk={enabled:!0,level:0};function rd(){}const vT={},bT={once:!0};class yA{constructor({id:e}={id:""}){this.VERSION=jR,this._startTs=ed(),this._deltaTs=ed(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Ek(`__probe-${this.id}__`,Pk),this.timeStamp(`${this.id} started`),Mk(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ed()-this._startTs).toPrecision(10))}getDelta(){return Number((ed()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,td.warn,arguments,bT)}error(e){return this._getLogFunction(0,e,td.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,td.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,td.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,td.debug||td.info,arguments,bT)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||rd,n&&[n],{tag:Fk(t)}):rd}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||rd)}group(e,t,n={collapsed:!1}){const i=xT({logLevel:e,message:t,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||rd)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=JR(e)}_getLogFunction(e,t,n,i,o){if(this._shouldLog(e)){o=xT({logLevel:e,message:t,args:i,opts:o}),n=n||o.method,hx(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=ed();const s=o.tag||o.message;if(o.once&&s)if(!vT[s])vT[s]=ed();else return rd;return t=Rk(this.id,o.message,o),n.bind(console,t,...o.args)}return rd}}yA.VERSION=jR;function JR(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return hx(Number.isFinite(e)&&e>=0),e}function xT(r){const{logLevel:e,message:t}=r;r.logLevel=JR(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return hx(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function Rk(r,e,t){if(typeof e=="string"){const n=t.time?Bk(Tk(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=Ik(e,t.color,t.background)}return e}function Fk(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}globalThis.probe={};const WR=new yA({id:"@probe.gl/log"});function XR(r,e){return $R(r||{},e)}function $R(r,e,t=0){if(t>3)return e;const n={...r};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=$R(n[i]||{},e[i],t+1):n[i]=e[i];return n}function Dk(r){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,r)}function Ok(r){var t,n;return((n=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:n[r])||null}const Lk="latest";function Nk(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.4"),globalThis._loadersgl_.version}const KR=Nk();function Ll(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const Ba=typeof process!="object"||String(process)!=="[object process]"||process.browser,dx=typeof importScripts=="function",kk=typeof window<"u"&&typeof window.orientation<"u",wT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);wT&&parseFloat(wT[1]);class Uk{constructor(e,t){J(this,"name");J(this,"workerThread");J(this,"isRunning",!0);J(this,"result");J(this,"_resolve",()=>{});J(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Ll(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ll(this.isRunning),this.isRunning=!1,this._reject(e)}}class mv{terminate(){}}const _v=new Map;function zk(r){Ll(r.source&&!r.url||!r.source&&r.url);let e=_v.get(r.source||r.url);return e||(r.url&&(e=Gk(r.url),_v.set(r.url,e)),r.source&&(e=qR(r.source),_v.set(r.source,e))),Ll(e),e}function Gk(r){if(!r.startsWith("http"))return r;const e=Vk(r);return qR(e)}function qR(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function Vk(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function ZR(r,e=!0,t){const n=t||new Set;if(r){if(CT(r))n.add(r);else if(CT(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const i in r)ZR(r[i],e,n)}}return t===void 0?Array.from(n):[]}function CT(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const yv=()=>{};class Tb{constructor(e){J(this,"name");J(this,"source");J(this,"url");J(this,"terminated",!1);J(this,"worker");J(this,"onMessage");J(this,"onError");J(this,"_loadableURL","");const{name:t,source:n,url:i}=e;Ll(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=yv,this.onError=o=>console.log(o),this.worker=Ba?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Ba||typeof mv<"u"&&!Ba}destroy(){this.onMessage=yv,this.onError=yv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||ZR(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=zk({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new mv(n,{eval:!1})}else if(this.source)e=new mv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class Hk{constructor(e){J(this,"name","unnamed");J(this,"source");J(this,"url");J(this,"maxConcurrency",1);J(this,"maxMobileConcurrency",1);J(this,"onDebug",()=>{});J(this,"reuseWorkers",!0);J(this,"props",{});J(this,"jobQueue",[]);J(this,"idleQueue",[]);J(this,"count",0);J(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Tb.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,o,s)=>i.done(s),n=(i,o)=>i.error(o)){const i=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new Uk(t.name,e);e.onMessage=i=>t.onMessage(n,i.type,i.payload),e.onError=i=>t.onError(n,i),t.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Ba||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Tb({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return kk?this.maxMobileConcurrency:this.maxConcurrency}}const jk={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Mu=class Mu{constructor(e){J(this,"props");J(this,"workerPools",new Map);this.props={...jk},this.setProps(e),this.workerPools=new Map}static isSupported(){return Tb.isSupported()}static getWorkerFarm(e={}){return Mu._workerFarm=Mu._workerFarm||new Mu({}),Mu._workerFarm.setProps(e),Mu._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let o=this.workerPools.get(t);return o||(o=new Hk({name:t,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};J(Mu,"_workerFarm");let Dm=Mu;function Jk(r,e={}){const t=e[r.id]||{},n=Ba?`${r.id}-worker.js`:`${r.id}-worker-node.js`;let i=t.workerUrl;if(!i&&r.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Ba?i=`modules/${r.module}/dist/${n}`:i=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!i){let o=r.version;o==="latest"&&(o=Lk);const s=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${r.module}${s}/dist/${n}`}return Ll(i),i}function Wk(r,e=KR){Ll(r,"no worker provided");const t=r.version;return!(!e||!t)}const vv={};async function jf(r,e=null,t={},n=null){return e&&(r=Xk(r,e,t,n)),vv[r]=vv[r]||$k(r),await vv[r]}function Xk(r,e,t={},n=null){if(!t.useLocalLibraries&&r.startsWith("http"))return r;n=n||r;const i=t.modules||{};return i[n]?i[n]:Ba?t.CDN?(Ll(t.CDN.startsWith("http")),`${t.CDN}/${e}@${KR}/dist/libs/${n}`):dx?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function $k(r){if(r.endsWith("wasm"))return await qk(r);if(!Ba)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(r))}catch(t){return console.error(t),null}if(dx)return importScripts(r);const e=await Zk(r);return Kk(e,r)}function Kk(r,e){if(!Ba){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(r,e)}if(dx)return eval.call(globalThis,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function qk(r){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Ba||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function Zk(r){const{readFileAsText:e}=globalThis.loaders||{};return Ba||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}function Yk(r,e){return!Dm.isSupported()||!Ba&&!(e!=null&&e._nodeWorkers)?!1:r.worker&&(e==null?void 0:e.worker)}async function Qk(r,e,t,n,i){const o=r.id,s=Jk(r,t),f=Dm.getWorkerFarm(t).getWorkerPool({name:o,url:s});t=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(n||{}));const g=await f.startJob("process-on-worker",e9.bind(null,i));return g.postMessage("process",{input:e,options:t,context:n}),await(await g.result).result}async function e9(r,e,t,n){switch(t){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:o,options:s}=n;try{const c=await r(o,s);e.postMessage("done",{id:i,result:c})}catch(c){const f=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:i,error:f})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function t9(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?ET(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?ET(r,0,e):""}function ET(r,e,t){if(r.byteLength<=e+t)return"";const n=new DataView(r);let i="";for(let o=0;o<t;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}function YR(r){try{return JSON.parse(r)}catch{throw new Error(`Failed to parse JSON from data starting with "${t9(r)}"`)}}function r9(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const n=new Uint8Array(r),i=new Uint8Array(e);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function n9(...r){return i9(r)}function i9(r){const e=r.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),t=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(t);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}function hg(r,e,t){const n=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(n).buffer}function Gl(r,e){return $n(r>=0),$n(e>0),r+(e-1)&-4}function QR(r,e,t){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,o=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,o)}return e.set(n,t),t+Gl(n.byteLength,4)}async function s9(r){const e=[];for await(const t of r)e.push(t);return n9(...e)}function TT(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class BT{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=TT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(TT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class vA{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof BT?i=e:i=new BT(t,n),this.stats[t]=i),i}}const o9="Queued Requests",a9="Active Requests",c9="Cancelled Requests",l9="Queued Requests Ever",u9="Active Requests Ever",f9={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class eF{constructor(e={}){J(this,"props");J(this,"stats");J(this,"activeRequestCount",0);J(this,"requestQueue",[]);J(this,"requestMap",new Map);J(this,"updateTimer",null);this.props={...f9,...e},this.stats=new vA({id:this.props.id}),this.stats.get(o9),this.stats.get(a9),this.stats.get(c9),this.stats.get(l9),this.stats.get(u9)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},i=new Promise(o=>(n.resolve=o,n));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:n}=e;let i=!1;const o=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort((t,n)=>t.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let h9="";const ST={};function d9(r){for(const e in ST)if(r.startsWith(e)){const t=ST[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${h9}${r}`),r}function A9(r){return r&&typeof r=="object"&&r.isBuffer}function tF(r){if(A9(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function p9(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const r=(e=window.location)==null?void 0:e.pathname;return(r==null?void 0:r.slice(0,r.lastIndexOf("/")+1))||""}function rF(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function Ax(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}function g9(...r){const e=[];for(let o=0;o<r.length;o++)e[o]=r[o];let t="",n=!1,i;for(let o=e.length-1;o>=-1&&!n;o--){let s;o>=0?s=e[o]:(i===void 0&&(i=p9()),s=i),s.length!==0&&(t=`${s}/${t}`,n=s.charCodeAt(0)===xp)}return t=m9(t,!n),n?`/${t}`:t.length>0?t:"."}const xp=47,bv=46;function m9(r,e){let t="",n=-1,i=0,o,s=!1;for(let c=0;c<=r.length;++c){if(c<r.length)o=r.charCodeAt(c);else{if(o===xp)break;o=xp}if(o===xp){if(!(n===c-1||i===1))if(n!==c-1&&i===2){if(t.length<2||!s||t.charCodeAt(t.length-1)!==bv||t.charCodeAt(t.length-2)!==bv){if(t.length>2){const f=t.length-1;let g=f;for(;g>=0&&t.charCodeAt(g)!==xp;--g);if(g!==f){t=g===-1?"":t.slice(0,g),n=c,i=0,s=!1;continue}}else if(t.length===2||t.length===1){t="",n=c,i=0,s=!1;continue}}e&&(t.length>0?t+="/..":t="..",s=!0)}else{const f=r.slice(n+1,c);t.length>0?t+=`/${f}`:t=f,s=!1}n=c,i=0}else o===bv&&i!==-1?++i:i=-1}return t}class _9{constructor(e){J(this,"fetch");J(this,"loadOptions");J(this,"_needsRefresh",!0);J(this,"props");this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=y9(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(e=!0){const t=this._needsRefresh;return e&&(this._needsRefresh=!1),t}}function y9(r){const e=r==null?void 0:r.fetch;if(e&&typeof e=="function")return(n,i)=>e(n,i);const t=r==null?void 0:r.fetch;return t&&typeof t!="function"?n=>fetch(n,t):n=>fetch(n)}class Kp extends _9{}J(Kp,"type","template"),J(Kp,"testURL",e=>!1);const v9=r=>typeof r=="boolean",Rp=r=>typeof r=="function",dg=r=>r!==null&&typeof r=="object",IT=r=>dg(r)&&r.constructor==={}.constructor,b9=r=>!!r&&typeof r[Symbol.iterator]=="function",x9=r=>r&&typeof r[Symbol.asyncIterator]=="function",nh=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,ih=r=>typeof Blob<"u"&&r instanceof Blob,w9=r=>r&&typeof r=="object"&&r.isBuffer,C9=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||dg(r)&&Rp(r.tee)&&Rp(r.cancel)&&Rp(r.getReader),E9=r=>dg(r)&&Rp(r.read)&&Rp(r.pipe)&&v9(r.readable),nF=r=>C9(r)||E9(r);class T9 extends Error{constructor(t,n){super(t);J(this,"reason");J(this,"url");J(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const B9=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,S9=/^([-\w.]+\/[-\w.+]+)/;function MT(r,e){return r.toLowerCase()===e.toLowerCase()}function I9(r){const e=S9.exec(r);return e?e[1]:r}function PT(r){const e=B9.exec(r);return e?e[1]:""}const iF=/\?.*/;function M9(r){const e=r.match(iF);return e&&e[0]}function px(r){return r.replace(iF,"")}function P9(r){if(r.length<50)return r;const e=r.slice(r.length-15);return`${r.substr(0,32)}...${e}`}function G_(r){return nh(r)?r.url:ih(r)?r.name||"":typeof r=="string"?r:""}function gx(r){if(nh(r)){const e=r,t=e.headers.get("content-type")||"",n=px(e.url);return I9(t)||PT(n)}return ih(r)?r.type||"":typeof r=="string"?PT(r):""}function R9(r){return nh(r)?r.headers["content-length"]||-1:ih(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function sF(r){if(nh(r))return r;const e={},t=R9(r);t>=0&&(e["content-length"]=String(t));const n=G_(r),i=gx(r);i&&(e["content-type"]=i);const o=await O9(r);o&&(e["x-first-bytes"]=o),typeof r=="string"&&(r=new TextEncoder().encode(r));const s=new Response(r,{headers:e});return Object.defineProperty(s,"url",{value:n}),s}async function F9(r){if(!r.ok)throw await D9(r)}async function D9(r){const e=P9(r.url);let t=`Failed to fetch resource (${r.status}) ${r.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const n={reason:r.statusText,url:r.url,response:r};try{const i=r.headers.get("Content-Type");n.reason=i!=null&&i.includes("application/json")?await r.json():r.text()}catch{}return new T9(t,n)}async function O9(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=o=>{var s;return n((s=o==null?void 0:o.target)==null?void 0:s.result)},i.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5);return`data:base64,${L9(t)}`}return null}function L9(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function N9(r){return!k9(r)&&!U9(r)}function k9(r){return r.startsWith("http:")||r.startsWith("https:")}function U9(r){return r.startsWith("data:")}async function RT(r,e){var t,n;if(typeof r=="string"){const i=d9(r);return N9(i)&&(t=globalThis.loaders)!=null&&t.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(i,e):await fetch(i,e)}return await sF(r)}const FT=new yA({id:"loaders.gl"});class z9{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class G9{constructor(){J(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const oF={fetch:null,mimeType:void 0,nothrow:!1,log:new G9,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:z_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},V9={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function aF(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function cF(){const r=aF();return r.globalOptions=r.globalOptions||{...oF},r.globalOptions}function H9(r,e,t,n){return t=t||[],t=Array.isArray(t)?t:[t],j9(r,t),W9(e,r,n)}function j9(r,e){DT(r,null,oF,V9,e);for(const t of e){const n=r&&r[t.id]||{},i=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};DT(n,t.id,i,o,e)}}function DT(r,e,t,n,i){const o=e||"Top level",s=e?`${e}.`:"";for(const c in r){const f=!e&&dg(r[c]),g=c==="baseUri"&&!e,b=c==="workerUrl"&&e;if(!(c in t)&&!g&&!b){if(c in n)FT.warn(`${o} loader option '${s}${c}' no longer supported, use '${n[c]}'`)();else if(!f){const T=J9(c,i);FT.warn(`${o} loader option '${s}${c}' not recognized. ${T}`)()}}}}function J9(r,e){const t=r.toLowerCase();let n="";for(const i of e)for(const o in i.options){if(r===o)return`Did you mean '${i.id}.${o}'?`;const s=o.toLowerCase();(t.startsWith(s)||s.startsWith(t))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function W9(r,e,t){const i={...r.options||{}};return X9(i,t),i.log===null&&(i.log=new z9),OT(i,cF()),OT(i,e),i}function OT(r,e){for(const t in e)if(t in e){const n=e[t];IT(n)&&IT(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function X9(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function mx(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r==null?void 0:r.extensions)):!1}function _x(r){$n(r,"null loader"),$n(mx(r),"invalid loader");let e;return Array.isArray(r)&&(e=r[1],r=r[0],r={...r,options:{...r.options,...e}}),(r!=null&&r.parseTextSync||r!=null&&r.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const lF=()=>{const r=aF();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function Ag(r){const e=lF();r=Array.isArray(r)?r:[r];for(const t of r){const n=_x(t);e.find(i=>n===i)||e.unshift(n)}}function $9(){return lF()}const K9=new yA({id:"loaders.gl"}),q9=/\.([^.]+)$/;async function Z9(r,e=[],t,n){if(!uF(r))return null;let i=LT(r,e,{...t,nothrow:!0},n);if(i)return i;if(ih(r)&&(r=await r.slice(0,10).arrayBuffer(),i=LT(r,e,t,n)),!i&&!(t!=null&&t.nothrow))throw new Error(fF(r));return i}function LT(r,e=[],t,n){if(!uF(r))return null;if(e&&!Array.isArray(e))return _x(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...$9()),Q9(i);const o=Y9(r,i,t,n);if(!o&&!(t!=null&&t.nothrow))throw new Error(fF(r));return o}function Y9(r,e,t,n){const i=G_(r),o=gx(r),s=px(i)||(n==null?void 0:n.url);let c=null,f="";return t!=null&&t.mimeType&&(c=xv(e,t==null?void 0:t.mimeType),f=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),c=c||e5(e,s),f=f||(c?`matched url ${s}`:""),c=c||xv(e,o),f=f||(c?`matched MIME type ${o}`:""),c=c||r5(e,r),f=f||(c?`matched initial data ${hF(r)}`:""),t!=null&&t.fallbackMimeType&&(c=c||xv(e,t==null?void 0:t.fallbackMimeType),f=f||(c?`matched fallback MIME type ${o}`:"")),f&&K9.log(1,`selectLoader selected ${c==null?void 0:c.name}: ${f}.`),c}function uF(r){return!(r instanceof Response&&r.status===204)}function fF(r){const e=G_(r),t=gx(r);let n="No valid loader found (";n+=e?`${rF(e)}, `:"no url provided, ",n+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=r?hF(r):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function Q9(r){for(const e of r)_x(e)}function e5(r,e){const t=e&&q9.exec(e),n=t&&t[1];return n?t5(r,n):null}function t5(r,e){e=e.toLowerCase();for(const t of r)for(const n of t.extensions)if(n.toLowerCase()===e)return t;return null}function xv(r,e){var t;for(const n of r)if((t=n.mimeTypes)!=null&&t.some(i=>MT(e,i))||MT(e,`application/x.${n.id}`))return n;return null}function r5(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(n5(e,t))return t}else if(ArrayBuffer.isView(e)){if(NT(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&NT(e,0,t))return t;return null}function n5(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>r.startsWith(n))}function NT(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>i5(r,e,t,i))}function i5(r,e,t,n){if(n instanceof ArrayBuffer)return r9(n,r,n.byteLength);switch(typeof n){case"function":return n(r);case"string":const i=Bb(r,e,n.length);return n===i;default:return!1}}function hF(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?Bb(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?Bb(r,0,e):""}function Bb(r,e,t){if(r.byteLength<e+t)return"";const n=new DataView(r);let i="";for(let o=0;o<t;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}const s5=256*1024;function*o5(r,e){const t=(e==null?void 0:e.chunkSize)||s5;let n=0;const i=new TextEncoder;for(;n<r.length;){const o=Math.min(r.length-n,t),s=r.slice(n,n+o);n+=o,yield i.encode(s)}}const a5=256*1024;function*c5(r,e={}){const{chunkSize:t=a5}=e;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,t),o=new ArrayBuffer(i),s=new Uint8Array(r,n,i);new Uint8Array(o).set(s),n+=i,yield o}}const l5=1024*1024;async function*u5(r,e){const t=(e==null?void 0:e.chunkSize)||l5;let n=0;for(;n<r.size;){const i=n+t,o=await r.slice(n,i).arrayBuffer();n=i,yield o}}function kT(r,e){return z_?f5(r,e):h5(r)}async function*f5(r,e){const t=r.getReader();let n;try{for(;;){const i=n||t.read();e!=null&&e._streamReadAhead&&(n=t.read());const{done:o,value:s}=await i;if(o)return;yield tF(s)}}catch{t.releaseLock()}}async function*h5(r,e){for await(const t of r)yield tF(t)}function d5(r,e){if(typeof r=="string")return o5(r,e);if(r instanceof ArrayBuffer)return c5(r,e);if(ih(r))return u5(r,e);if(nF(r))return kT(r,e);if(nh(r))return kT(r.body,e);throw new Error("makeIterator")}const dF="Cannot convert supplied data type";function A5(r,e,t){if(e.text&&typeof r=="string")return r;if(w9(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(dF)}async function p5(r,e,t){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return A5(r,e);if(ih(r)&&(r=await sF(r)),nh(r)){const i=r;return await F9(i),e.binary?await i.arrayBuffer():await i.text()}if(nF(r)&&(r=d5(r,t)),b9(r)||x9(r))return s9(r);throw new Error(dF)}function AF(r,e){const t=cF(),n=r||t;return typeof n.fetch=="function"?n.fetch:dg(n.fetch)?i=>RT(i,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:RT}function g5(r,e,t){if(t)return t;const n={fetch:AF(e,r),...r};if(n.url){const i=px(n.url);n.baseUrl=i,n.queryString=M9(n.url),n.filename=rF(i),n.baseUrl=Ax(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function m5(r,e){if(r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...n]:n}return t&&t.length?t:void 0}async function Om(r,e,t,n){e&&!Array.isArray(e)&&!mx(e)&&(n=void 0,t=e,e=void 0),r=await r,t=t||{};const i=G_(r),s=m5(e,n),c=await Z9(r,s,t);return c?(t=H9(t,c,s,i),n=g5({url:i,_parse:Om,loaders:s},t,n||null),await _5(c,r,t,n)):null}async function _5(r,e,t,n){if(Wk(r),t=XR(r.options,t),nh(e)){const o=e,{ok:s,redirected:c,status:f,statusText:g,type:b,url:T}=o,S=Object.fromEntries(o.headers.entries());n.response={headers:S,ok:s,redirected:c,status:f,statusText:g,type:b,url:T}}e=await p5(e,r,t);const i=r;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,n);if(Yk(r,t))return await Qk(r,e,t,n,Om);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,n);if(i.parse)return await i.parse(e,t,n);throw Ll(!i.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}function y5(r){switch(r.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function pF(r){let e=1/0,t=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0;const c=r.POSITION?r.POSITION.value:[],f=c&&c.length;for(let g=0;g<f;g+=3){const b=c[g],T=c[g+1],S=c[g+2];e=b<e?b:e,t=T<t?T:t,n=S<n?S:n,i=b>i?b:i,o=T>o?T:o,s=S>s?S:s}return[[e,t,n],[i,o,s]]}function v5(r,e,t){const n=y5(e.value),i=t||b5(e);return{name:r,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function b5(r){const e={};return"byteOffset"in r&&(e.byteOffset=r.byteOffset.toString(10)),"byteStride"in r&&(e.byteStride=r.byteStride.toString(10)),"normalized"in r&&(e.normalized=r.normalized.toString()),e}async function Nl(r,e,t,n){let i,o;!Array.isArray(e)&&!mx(e)?(i=[],o=e):(i=e,o=t);const s=AF(o);let c=r;return typeof r=="string"&&(c=await s(r)),ih(r)&&(c=await s(r)),Array.isArray(i)?await Om(c,i,o):await Om(c,i,o)}const x5="4.2.4";var LR;const w5=(LR=globalThis.loaders)==null?void 0:LR.parseImageNode,Sb=typeof Image<"u",Ib=typeof ImageBitmap<"u",C5=!!w5,Mb=z_?!0:C5;function E5(r){switch(r){case"auto":return Ib||Sb||Mb;case"imagebitmap":return Ib;case"image":return Sb;case"data":return Mb;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function T5(){if(Ib)return"imagebitmap";if(Sb)return"image";if(Mb)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function B5(r){const e=S5(r);if(!e)throw new Error("Not an image");return e}function yx(r){switch(B5(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function S5(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const I5=/^data:image\/svg\+xml/,M5=/\.svg((\?|#).*)?$/;function vx(r){return r&&(I5.test(r)||M5.test(r))}function P5(r,e){if(vx(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return gF(r,e)}function gF(r,e){if(vx(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function mF(r,e,t){const n=P5(r,t),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await R5(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function R5(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const F5={};let UT=!0;async function D5(r,e,t){let n;vx(t)?n=await mF(r,e,t):n=gF(r,t);const i=e&&e.imagebitmap;return await O5(n,i)}async function O5(r,e=null){if((L5(e)||!UT)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),UT=!1}return await createImageBitmap(r)}function L5(r){for(const e in r||F5)return!1;return!0}function N5(r){return!G5(r,"ftyp",4)||!(r[8]&96)?null:k5(r)}function k5(r){switch(U5(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function U5(r,e,t){return String.fromCharCode(...r.slice(e,t))}function z5(r){return[...r].map(e=>e.charCodeAt(0))}function G5(r,e,t=0){const n=z5(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Hc=!1,Fp=!0;function V_(r){const e=pg(r);return H5(e)||W5(e)||j5(e)||J5(e)||V5(e)}function V5(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=N5(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function H5(r){const e=pg(r);return e.byteLength>=24&&e.getUint32(0,Hc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Hc),height:e.getUint32(20,Hc)}:null}function j5(r){const e=pg(r);return e.byteLength>=10&&e.getUint32(0,Hc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Fp),height:e.getUint16(8,Fp)}:null}function J5(r){const e=pg(r);return e.byteLength>=14&&e.getUint16(0,Hc)===16973&&e.getUint32(2,Fp)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Fp),height:e.getUint32(22,Fp)}:null}function W5(r){const e=pg(r);if(!(e.byteLength>=3&&e.getUint16(0,Hc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=X5();let o=2;for(;o+9<e.byteLength;){const s=e.getUint16(o,Hc);if(i.has(s))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Hc),width:e.getUint16(o+7,Hc)};if(!n.has(s))return null;o+=2,o+=e.getUint16(o,Hc)}return null}function X5(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function pg(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function $5(r,e){var i;const{mimeType:t}=V_(r)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return $n(n),await n(r,t)}async function K5(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=t||{},s=q5(i);let c;switch(s){case"imagebitmap":c=await D5(r,e,o);break;case"image":c=await mF(r,e,o);break;case"data":c=await $5(r);break;default:$n(!1)}return i==="data"&&(c=yx(c)),c}function q5(r){switch(r){case"auto":case"data":return T5();default:return E5(r),r}}const Z5=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Y5=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Q5={image:{type:"auto",decode:!0}},rA={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:x5,mimeTypes:Y5,extensions:Z5,parse:K5,tests:[r=>!!V_(new DataView(r))],options:Q5},wv={};function _F(r){if(wv[r]===void 0){const e=z_?tU(r):eU(r);wv[r]=e}return wv[r]}function eU(r){var i,o;const e=["image/png","image/jpeg","image/gif"],t=((i=globalThis.loaders)==null?void 0:i.imageFormatsNode)||e;return!!((o=globalThis.loaders)==null?void 0:o.parseImageNode)&&t.includes(r)}function tU(r){switch(r){case"image/avif":case"image/webp":return rU(r);default:return!0}}function rU(r){try{return document.createElement("canvas").toDataURL(r).indexOf(`data:${r}`)===0}catch{return!1}}const Ur=new yA({id:"deck"});let Pb={};function nU(r){Pb=r}function to(r,e,t,n){Ur.level>0&&Pb[r]&&Pb[r].call(null,e,t,n)}function iU(r){const e=r[0],t=r[r.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const sU={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:iU,parseTextSync:JSON.parse};function oU(){const r="9.0.37",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==r)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${r}`);return e||(Ur.log(1,`deck.gl ${r}`)(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:Ur,_registerLoggers:nU},Ag([sU,[rA,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const aU=oU();function kf(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}const Cv={number:{type:"number",validate(r,e){return Number.isFinite(r)&&typeof e=="object"&&(e.max===void 0||r<=e.max)&&(e.min===void 0||r>=e.min)}},array:{type:"array",validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function cU(r){const e={};for(const[t,n]of Object.entries(r))e[t]=uU(n);return e}function lU(r,e,t){const n={};for(const[i,o]of Object.entries(e))r&&i in r&&!o.private?(o.validate&&kf(o.validate(r[i],o),`${t}: invalid ${i}`),n[i]=r[i]):n[i]=o.value;return n}function uU(r){let e=zT(r);if(e!=="object")return{value:r,...Cv[e],type:e};if(typeof r=="object")return r?r.type!==void 0?{...r,...Cv[r.type],type:r.type}:r.value===void 0?{type:"object",value:r}:(e=zT(r.value),{...r,...Cv[e],type:e}):{type:"object",value:null};throw new Error("props")}function zT(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const fU=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,hU=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,dU={vertex:fU,fragment:hU},GT=/void\s+main\s*\([^)]*\)\s*\{\n?/,VT=/}\n?[^{}]*$/,Ev=[],dm="__LUMA_INJECT_DECLARATIONS__";function AU(r){const e={vertex:{},fragment:{}};for(const t in r){let n=r[t];const i=pU(t);typeof n=="string"&&(n={order:0,injection:n}),e[i][t]=n}return e}function pU(r){const e=r.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Lm(r,e,t,n=!1){const i=e==="vertex";for(const o in t){const s=t[o];s.sort((f,g)=>f.order-g.order),Ev.length=s.length;for(let f=0,g=s.length;f<g;++f)Ev[f]=s[f].injection;const c=`${Ev.join(`
`)}
`;switch(o){case"vs:#decl":i&&(r=r.replace(dm,c));break;case"vs:#main-start":i&&(r=r.replace(GT,f=>f+c));break;case"vs:#main-end":i&&(r=r.replace(VT,f=>c+f));break;case"fs:#decl":i||(r=r.replace(dm,c));break;case"fs:#main-start":i||(r=r.replace(GT,f=>f+c));break;case"fs:#main-end":i||(r=r.replace(VT,f=>c+f));break;default:r=r.replace(o,f=>f+c)}}return r=r.replace(dm,""),n&&(r=r.replace(/\}\s*$/,o=>o+dU[e])),r}let gU=1;class Pu{constructor(e){J(this,"name");J(this,"vs");J(this,"fs");J(this,"getModuleUniforms");J(this,"dependencies");J(this,"deprecations");J(this,"defines");J(this,"injections");J(this,"uniforms",{});J(this,"uniformTypes",{});const{name:t,vs:n,fs:i,dependencies:o=[],uniformTypes:s={},uniformPropTypes:c={},getUniforms:f,deprecations:g=[],defines:b={},inject:T={}}=e;kf(typeof t=="string"),this.name=t,this.vs=n,this.fs=i,this.getModuleUniforms=f,this.dependencies=Pu.instantiateModules(o),this.deprecations=this._parseDeprecationDefinitions(g),this.defines=b,this.injections=AU(T),this.uniformTypes=s,c&&(this.uniforms=cU(c))}static instantiateModules(e){return e.map(t=>{if(t instanceof Pu)return t;kf(typeof t!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(t)}' and use it directly.`),t.name||(console.warn("shader module has no name"),t.name=`shader-module-${gU++}`);const n=new Pu(t);return n.dependencies=Pu.instantiateModules(t.dependencies||[]),n})}getModuleSource(e){let t;switch(e){case"vertex":t=this.vs||"";break;case"fragment":t=this.fs||"";break;default:kf(!1)}const n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${n}
${t}

`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):lU(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(n=>{var i;(i=n.regex)!=null&&i.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),e}_defaultGetUniforms(e={}){const t={},n=this.uniforms;for(const i in n){const o=n[i];i in e&&!o.private?(o.validate&&kf(o.validate(e[i],o),`${this.name}: invalid ${i}`),t[i]=e[i]):t[i]=o.value}return t}}function HT(r){if(r.source&&r.platformInfo.type==="webgpu")return{...r,vs:void 0,fs:void 0};if(!r.vs)throw new Error("no vertex shader");const e=jT(r.platformInfo,r.vs);let t;return r.fs&&(t=jT(r.platformInfo,r.fs)),{...r,vs:e,fs:t}}function jT(r,e){if(typeof e=="string")return e;switch(r.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function H_(r){const e=Pu.instantiateModules(r);return mU(e)}function mU(r){const e={},t={};return yF({modules:r,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((n,i)=>t[i]-t[n]).map(n=>e[n])}function yF(r){const{modules:e,level:t,moduleMap:n,moduleDepth:i}=r;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)n[o.name]=o,(i[o.name]===void 0||i[o.name]<t)&&(i[o.name]=t);for(const o of e)o.dependencies&&yF({modules:o.dependencies,level:t+1,moduleMap:n,moduleDepth:i})}function _U(r){switch(r==null?void 0:r.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function yU(r,e){var n;if(Number(((n=r.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return r=JT(r,vU),r;case"fragment":return r=JT(r,bU),r;default:throw new Error(e)}}const vF=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],vU=[...vF,[Rb("attribute"),"in $1"],[Rb("varying"),"out $1"]],bU=[...vF,[Rb("varying"),"in $1"]];function JT(r,e){for(const[t,n]of e)r=r.replace(t,n);return r}function Rb(r){return new RegExp(`\\b${r}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function bF(r,e){let t="";for(const n in r){const i=r[n];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[n]){const o=e[n];o.sort((s,c)=>s.order-c.order);for(const s of o)t+=`  ${s.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function xF(r){const e={vertex:{},fragment:{}};for(const t of r){let n,i;typeof t!="string"?(n=t,i=n.hook):(n={},i=t),i=i.trim();const[o,s]=i.split(":"),c=i.replace(/\(.+/,""),f=Object.assign(n,{signature:s});switch(o){case"vs":e.vertex[c]=f;break;case"fs":e.fragment[c]=f;break;default:throw new Error(o)}}return e}function xU(r,e){return{name:wU(r,e),language:"glsl",version:CU(r)}}function wU(r,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(r);return n?n[1]:e}function CU(r){let e=100;const t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const wF=`

${dm}
`,EU=`precision highp float;
`;function TU(r){const e=H_(r.modules||[]);return{source:Fb(r.platformInfo,{...r,source:r.source,stage:"vertex",modules:e}),getUniforms:bx(e)}}function BU(r){const e=H_(r.modules||[]);return{vs:Fb(r.platformInfo,{...r,source:r.vs,stage:"vertex",modules:e}),fs:Fb(r.platformInfo,{...r,source:r.fs,stage:"fragment",modules:e}),getUniforms:bx(e)}}function SU(r){const{vs:e,fs:t}=r,n=H_(r.modules||[]);return{vs:WT(r.platformInfo,{...r,source:e,stage:"vertex",modules:n}),fs:WT(r.platformInfo,{...r,source:t,stage:"fragment",modules:n}),getUniforms:bx(n)}}function Fb(r,e){const{source:t,stage:n,modules:i,hookFunctions:o=[],inject:s={},log:c}=e;kf(typeof t=="string","shader source must be a string");const f=t;let g="";const b=xF(o),T={},S={},F={};for(const U in s){const j=typeof s[U]=="string"?{injection:s[U],order:0}:s[U],z=/^(v|f)s:(#)?([\w-]+)$/.exec(U);if(z){const V=z[2],K=z[3];V?K==="decl"?S[U]=[j]:F[U]=[j]:T[U]=[j]}else F[U]=[j]}const k=r.type!=="webgpu"?i:[];for(const U of k){c&&U.checkDeprecations(f,c);const j=U.getModuleSource(n,"wgsl");g+=j;const z=U.injections[n];for(const V in z){const K=/^(v|f)s:#([\w-]+)$/.exec(V);if(K){const Q=K[2]==="decl"?S:F;Q[V]=Q[V]||[],Q[V].push(z[V])}else T[V]=T[V]||[],T[V].push(z[V])}}return g+=wF,g=Lm(g,n,S),g+=bF(b[n],T),g+=f,g=Lm(g,n,F),g}function WT(r,e){const{id:t,source:n,stage:i,language:o="glsl",modules:s,defines:c={},hookFunctions:f=[],inject:g={},prologue:b=!0,log:T}=e;kf(typeof n=="string","shader source must be a string");const S=o==="glsl"?xU(n).version:-1,F=r.shaderLanguageVersion,k=S===100?"#version 100":"#version 300 es",j=n.split(`
`).slice(1).join(`
`),z={};s.forEach(Te=>{Object.assign(z,Te.getDefines())}),Object.assign(z,c);let V="";switch(o){case"wgsl":break;case"glsl":V=b?`${k}

// ----- PROLOGUE -------------------------
${IU({id:t,source:n,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}
${_U(r)}
${i==="fragment"?EU:""}

// ----- APPLICATION DEFINES -------------------------

${MU(z)}

`:`${k}
`;break}const K=xF(f),fe={},Q={},oe={};for(const Te in g){const ze=typeof g[Te]=="string"?{injection:g[Te],order:0}:g[Te],Ae=/^(v|f)s:(#)?([\w-]+)$/.exec(Te);if(Ae){const _e=Ae[2],pe=Ae[3];_e?pe==="decl"?Q[Te]=[ze]:oe[Te]=[ze]:fe[Te]=[ze]}else oe[Te]=[ze]}for(const Te of s){T&&Te.checkDeprecations(j,T);const ze=Te.getModuleSource(i);V+=ze;const Ae=Te.injections[i];for(const _e in Ae){const pe=/^(v|f)s:#([\w-]+)$/.exec(_e);if(pe){const ne=pe[2]==="decl"?Q:oe;ne[_e]=ne[_e]||[],ne[_e].push(Ae[_e])}else fe[_e]=fe[_e]||[],fe[_e].push(Ae[_e])}}return V+="// ----- MAIN SHADER SOURCE -------------------------",V+=wF,V=Lm(V,i,Q),V+=bF(K[i],fe),V+=j,V=Lm(V,i,oe),o==="glsl"&&S!==F&&(V=yU(V,i)),V.trim()}function bx(r){return function(t){const n={};for(const i of r){const o=i.getUniforms(t,n);Object.assign(n,o)}return n}}function IU(r){const{id:e,source:t,stage:n}=r;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}

`:""}function MU(r={}){let e="";for(const t in r){const n=r[t];(n||Number.isFinite(n))&&(e+=`#define ${t.toUpperCase()} ${r[t]}
`)}return e}const Lf=class Lf{constructor(){J(this,"_hookFunctions",[]);J(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Lf.defaultShaderAssembler=Lf.defaultShaderAssembler||new Lf,Lf.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,i=HT(e);return{...TU({platformInfo:e.platformInfo,...i,modules:t,hookFunctions:n}),modules:t}}assembleShaderPair(e){const t=HT(e),n=this._getModuleList(e.modules),i=this._hookFunctions,{platformInfo:o}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?BU({platformInfo:o,...t,modules:n,hookFunctions:i}):SU({platformInfo:o,...t,modules:n,hookFunctions:i}),modules:n}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let o=0,s=this._defaultModules.length;o<s;++o){const c=this._defaultModules[o],f=c.name;t[i++]=c,n[f]=!0}for(let o=0,s=e.length;o<s;++o){const c=e[o],f=c.name;n[f]||(t[i++]=c,n[f]=!0)}return t.length=i,Pu.instantiateModules(t)}};J(Lf,"defaultShaderAssembler");let Nm=Lf;function PU(r){if(!r.normalized&&(r.normalized=!0,r.uniformPropTypes&&!r.getUniforms)){const e=new Pu(r);r.getUniforms=e.getUniforms.bind(e)}return r}const RU=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,FU=`#version 300 es
${RU}`;function CF(r){const{input:e,inputChannels:t,output:n}=r||{};if(!e)return FU;if(!t)throw new Error("inputChannels");const i=DU(t),o=OU(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${o};
}`}function DU(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${r}`)}}function OU(r,e){switch(e){case 1:return`vec4(${r}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${r}, 0.0, 1.0)`;case 3:return`vec4(${r}, 1.0)`;case 4:return r;default:throw new Error(`invalid channels: ${e}`)}}const Zt=new yA({id:"luma.gl"});class LU{constructor(){J(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new vA({id:e})),this.stats.get(e)}}const xx=new LU;function NU(){const r="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==r)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${r}`);return globalThis.luma||($u()&&Zt.log(1,`${r} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:r,version:r,log:Zt,stats:xx}),r}const kU=NU();function UU(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)?r:null}function qp(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number"?r:null:UU(r)}const Tv={};function Vl(r="id"){Tv[r]=Tv[r]||1;const e=Tv[r]++;return`${r}-${e}`}function km(r){let e=!0;for(const t in r){e=!1;break}return e}var Cb;let ui=(Cb=class{constructor(e,t,n){J(this,"id");J(this,"props");J(this,"userData",{});J(this,"_device");J(this,"destroyed",!1);J(this,"allocatedBytes",0);J(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=zU(t,n);const i=this.props.id!=="undefined"?this.props.id:Vl(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},J(Cb,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Cb);function zU(r,e){const t={...e};for(const n in r)r[n]!==void 0&&(t[n]=r[n]);return t}var ss;let $i=(ss=class extends ui{constructor(t,n){const i={...n};(n.usage||0)&ss.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?i.indexType="uint32":n.data instanceof Uint16Array&&(i.indexType="uint16"));super(t,i,ss.defaultProps);J(this,"usage");J(this,"indexType");J(this,"updateTimestamp");J(this,"debugData",new ArrayBuffer(0));this.usage=n.usage||0,this.indexType=i.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(t,n){throw new Error("not implemented")}_setDebugData(t,n,i){const o=ArrayBuffer.isView(t)?t.buffer:t,s=Math.min(t?t.byteLength:i,ss.DEBUG_DATA_MAX_LENGTH);t===null?this.debugData=new ArrayBuffer(s):n===0&&i===t.byteLength?this.debugData=o.slice(0,s):this.debugData=o.slice(n,n+s)}},J(ss,"defaultProps",{...ui.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),J(ss,"MAP_READ",1),J(ss,"MAP_WRITE",2),J(ss,"COPY_SRC",4),J(ss,"COPY_DST",8),J(ss,"INDEX",16),J(ss,"VERTEX",32),J(ss,"UNIFORM",64),J(ss,"STORAGE",128),J(ss,"INDIRECT",256),J(ss,"QUERY_RESOLVE",512),J(ss,"DEBUG_DATA_MAX_LENGTH",32),ss);function EF(r){const e=XT[r],t=GU(e),n=r.includes("norm"),i=!n&&!r.startsWith("float"),o=r.startsWith("s");return{dataType:XT[r],byteLength:t,integer:i,signed:o,normalized:n}}function GU(r){return VU[r]}const XT={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},VU={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},HU=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],jU=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function JU(r){return HU.some(e=>r.startsWith(e))}function TF(r){const e=jU.exec(r);if(e){const[,t,n,i,o,s]=e;if(t){const c=`${i}${n}`,f=EF(c);return{format:t,components:t.length,srgb:o==="-srgb",unsized:s==="-unsized",webgl:s==="-webgl",...f}}}return XU(r)}const WU={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function XU(r){var t;const e=WU[r];if(!e)throw new Error(`Unknown format ${r}`);return{format:e.format||"",components:e.components||((t=e.format)==null?void 0:t.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class $U{}class KU{constructor(e=[],t){J(this,"features");J(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const Wp=class Wp{constructor(e){J(this,"id");J(this,"props");J(this,"userData",{});J(this,"statsManager",xx);J(this,"_lumaData",{});J(this,"timestamp",0);this.props={...Wp.defaultProps,...e},this.id=this.props.id||Vl(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return JU(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&$i.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":Zt.warn("indices buffer content must be of integer type")()),t}};J(Wp,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Zt.get("debug"),spector:!!(Zt.get("spector")||Zt.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Zt.error(e.message)}),J(Wp,"VERSION",kU);let nA=Wp;function jn(r,e){if(!r)throw new Error(e||"luma.gl: assertion failed.")}const ap=new Map,Vd=class Vd{static registerDevices(e){for(const t of e)jn(t.type&&t.isSupported&&t.create),ap.set(t.type,t)}static getAvailableDevices(){return Array.from(ap).map(e=>e.type)}static getSupportedDevices(){return Array.from(ap).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(nA.defaultProps,e)}static async attachDevice(e){const t=$T(e.devices)||ap;if(e.handle instanceof WebGL2RenderingContext){const n=t.get("webgl");if(n)return await n.attach(e.handle)}if(e.handle===null){const n=t.get("unknown");if(n)return await n.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var o,s;e={...Vd.defaultProps,...e},e.gl&&(e.type="webgl");const t=$T(e.devices)||ap;let n,i;switch(e.type){case"webgpu":if(n=t.get("webgpu"),n)return await n.create(e);break;case"webgl":if(i=t.get("webgl"),i)return await i.create(e);break;case"unknown":const c=t.get("unknown");if(c)return await c.create(e);break;case"best-available":if(n=t.get("webgpu"),(o=n==null?void 0:n.isSupported)!=null&&o.call(n))return await n.create(e);if(i=t.get("webgl"),(s=i==null?void 0:i.isSupported)!=null&&s.call(i))return await i.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(n,i){return n==="webgl"||n==="experimental-webgl"?this.originalGetContext("webgl2",i):this.originalGetContext(n,i)}}};J(Vd,"defaultProps",{...nA.defaultProps,type:"best-available",devices:void 0}),J(Vd,"stats",xx),J(Vd,"log",Zt);let Hd=Vd;function $T(r){if(!r||(r==null?void 0:r.length)===0)return null;const e=new Map;for(const t of r)e.set(t.type,t);return e}const qU=$u()&&typeof document<"u",j_=()=>qU&&document.readyState==="complete",ZU={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class wx{constructor(e){J(this,"id");J(this,"props");J(this,"canvas");J(this,"htmlCanvas");J(this,"offscreenCanvas");J(this,"type");J(this,"width",1);J(this,"height",1);J(this,"resizeObserver");J(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...ZU,...e},e=this.props,!$u()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=ez(e.canvas):this.canvas=e.canvas;else{const t=tz(e),n=QU((e==null?void 0:e.container)||null);n.insertBefore(t,n.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const n of t)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return j_()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:t}=this._canvasSizeInfo;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[i,o]=this.getDrawingBufferSize();return rz(e,n,i,o,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;(!n||!i)&&(Zt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const o=this._canvasSizeInfo;if(o.clientWidth!==n||o.clientHeight!==i||o.devicePixelRatio!==e){let s=e;const c=Math.floor(n*s),f=Math.floor(i*s);this.htmlCanvas.width=c,this.htmlCanvas.height=f;const[g,b]=this.getDrawingBufferSize();(g!==c||b!==f)&&(s=Math.min(g/n,b/i),this.htmlCanvas.width=Math.floor(n*s),this.htmlCanvas.height=Math.floor(i*s),Zt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}J(wx,"pageLoaded",YU());function YU(){return j_()||typeof window>"u"?Promise.resolve():new Promise(r=>{window.addEventListener("load",()=>r())})}function QU(r){if(typeof r=="string"){const e=document.getElementById(r);if(!e&&!j_())throw new Error(`Accessing '${r}' before page was loaded`);if(!e)throw new Error(`${r} is not an HTML element`);return e}else if(r)return r;return document.body}function ez(r){const e=document.getElementById(r);if(!e&&!j_())throw new Error(`Accessing '${r}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function tz(r){const{width:e,height:t}=r,n=document.createElement("canvas");return n.id="lumagl-auto-created-canvas",n.width=e||1,n.height=t||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(t)?`${t}px`:"100%",n}function rz(r,e,t,n,i){const o=r,s=KT(o[0],e,t);let c=qT(o[1],e,n,i),f=KT(o[0]+1,e,t);const g=f===t-1?f:f-1;f=qT(o[1]+1,e,n,i);let b;return i?(f=f===0?f:f+1,b=c,c=f):b=f===n-1?f:f-1,{x:s,y:c,width:Math.max(g-s+1,1),height:Math.max(b-c+1,1)}}function KT(r,e,t){return Math.min(Math.round(r*e),t-1)}function qT(r,e,t,n){return n?Math.max(0,t-1-Math.round(r*e)):Math.min(Math.round(r*e),t-1)}const Il=class Il extends ui{constructor(t,n,i=Il.defaultProps){super(t,n,i);J(this,"dimension");J(this,"format");J(this,"width");J(this,"height");J(this,"depth");J(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};J(Il,"defaultProps",{...ui.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),J(Il,"COPY_SRC",1),J(Il,"COPY_DST",2),J(Il,"TEXTURE_BINDING",4),J(Il,"STORAGE_BINDING",8),J(Il,"RENDER_ATTACHMENT",16);let ea=Il;const E_=class E_ extends ui{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,E_.defaultProps)}};J(E_,"defaultProps",{...ui.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Um=E_;function nz(r,e,t){let n="";const i=e.split(/\r?\n/),o=r.slice().sort((s,c)=>s.lineNum-c.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let s=0;for(let c=1;c<=i.length;c++)for(n+=BF(i[c-1],c,t);o.length>s&&o[s].lineNum===c;){const f=o[s++];n+=ZT(f,i,f.lineNum,{...t,inlineSource:!1})}return n;case"issues":case"no":for(const c of r)n+=ZT(c,i,c.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return n}}function ZT(r,e,t,n){if(n!=null&&n.inlineSource){const i=iz(e,t),o=r.linePos>0?`${" ".repeat(r.linePos+5)}^^^
`:"";return`
${i}${o}${r.type.toUpperCase()}: ${r.message}

`}return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${r.type.toUpperCase()}: ${r.message}</b></div>`:`${r.type.toUpperCase()}: ${r.message}`}function iz(r,e,t){let n="";for(let i=e-2;i<=e;i++){const o=r[i-1];o!==void 0&&(n+=BF(o,e,t))}return n}function BF(r,e,t){const n=t!=null&&t.html?oz(r):r;return`${sz(String(e),4)}: ${n}${t!=null&&t.html?"<br/>":`
`}`}function sz(r,e){let t="";for(let n=r.length;n<e;++n)t+=" ";return t+r}function oz(r){return r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function SF(r,e){return{name:az(r,e),language:"glsl",version:cz(r)}}function az(r,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(r);return n?n[1]:e}function cz(r){let e=100;const t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}return e}const T_=class T_ extends ui{constructor(t,n){super(t,{id:lz(n),...n},T_.defaultProps);J(this,"stage");J(this,"source");J(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(t=this.props.debug){switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();this.props.debug==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(t){var g;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=SF(this.source).name,i=`${this.stage} ${n}`;let o=nz(t,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const c=document.createElement("Button");c.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,c.style.top="10px",c.style.left="10px",c.style.position="absolute",c.style.zIndex="9999",c.style.width="100%",c.style.textAlign="left",document.body.appendChild(c);const f=document.getElementsByClassName("luma-compiler-log-error");(g=f[0])!=null&&g.scrollIntoView&&f[0].scrollIntoView(),c.onclick=()=>{const b=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(b)}}};J(T_,"defaultProps",{...ui.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let zm=T_;function lz(r){return SF(r.source).name||r.id||Vl(`unnamed ${r.stage}-shader`)}const B_=class B_ extends ui{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){super(e,t,B_.defaultProps)}};J(B_,"defaultProps",{...ui.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Gm=B_;const S_=class S_ extends ui{constructor(t,n={}){super(t,n,S_.defaultProps);J(this,"width");J(this,"height");J(this,"colorAttachments",[]);J(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(t){let n=!t;if(t){const[i,o]=Array.isArray(t)?t:[t.width,t.height];n=n||o!==this.height||i!==this.width,this.width=i,this.height=o}n&&(Zt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(n=>{if(typeof n=="string"){const i=this.createColorTexture(n);return this.attachResource(i),i.view}return n instanceof ea?n.view:n});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const n=this.createDepthStencilTexture(t);this.attachResource(n),this.depthStencilAttachment=n.view}else t instanceof ea?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t){return this.device.createTexture({id:"color-attachment",usage:ea.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}createDepthStencilTexture(t){return this.device.createTexture({id:"depth-stencil-attachment",usage:ea.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,n){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const o=this.device._createTexture({...this.colorAttachments[i].props,width:t,height:n});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=o.view,this.attachResource(o.view)}if(this.depthStencilAttachment){const i=this.device._createTexture({...this.depthStencilAttachment.props,width:t,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}};J(S_,"defaultProps",{...ui.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Vm=S_;const I_=class I_ extends ui{constructor(t,n){super(t,n,I_.defaultProps);J(this,"shaderLayout");J(this,"bufferLayout");J(this,"linkStatus","pending");J(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};J(I_,"defaultProps",{...ui.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let iA=I_;const M_=class M_ extends ui{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){super(e,t,M_.defaultProps)}};J(M_,"defaultProps",{...ui.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Db=M_;const P_=class P_ extends ui{constructor(t,n){super(t,n,P_.defaultProps);J(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};J(P_,"defaultProps",{...ui.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Hm=P_;const R_=class R_ extends ui{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,R_.defaultProps)}};J(R_,"defaultProps",{...ui.defaultProps,measureExecutionTime:void 0});let Ob=R_;const F_=class F_ extends ui{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,F_.defaultProps)}};J(F_,"defaultProps",{...ui.defaultProps});let Lb=F_;function uz(r){const[e,t]=hz[r],n=e==="i32"||e==="u32",i=e!=="u32",o=dz[e]*t,s=fz(e,t);return{dataType:e,components:t,defaultVertexFormat:s,byteLength:o,integer:n,signed:i}}function fz(r,e){let t;switch(r){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const hz={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},dz={f32:4,f16:2,i32:4,u32:4};function IF(r){let e;r.endsWith("-webgl")&&(r.replace("-webgl",""),e=!0);const[t,n]=r.split("x"),i=t,o=n?parseInt(n):1,s=EF(i),c={type:i,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return e&&(c.webglOnly=!0),c}function MF(r,e){const t={};for(const n of r.attributes)t[n.name]=pz(r,e,n.name);return t}function Az(r,e,t=16){const n=MF(r,e),i=new Array(t).fill(null);for(const o of Object.values(n))i[o.location]=o;return i}function pz(r,e,t){const n=gz(r,t),i=mz(e,t);if(!n)return null;const o=uz(n.type),s=(i==null?void 0:i.vertexFormat)||o.defaultVertexFormat,c=IF(s);return{attributeName:(i==null?void 0:i.attributeName)||n.name,bufferName:(i==null?void 0:i.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:o.integer,stepMode:(i==null?void 0:i.stepMode)||n.stepMode,byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function gz(r,e){const t=r.attributes.find(n=>n.name===e);return t||Zt.warn(`shader layout attribute "${e}" not present in shader`),t||null}function mz(r,e){_z(r);let t=yz(r,e);return t||(t=vz(r,e),t)?t:(Zt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function _z(r){for(const e of r)(e.attributes&&e.format||!e.attributes&&!e.format)&&Zt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function yz(r,e){for(const t of r)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function vz(r,e){var t;for(const n of r){let i=n.byteStride;if(typeof n.byteStride!="number")for(const s of n.attributes||[]){const c=IF(s.format);i+=c.byteLength}const o=(t=n.attributes)==null?void 0:t.find(s=>s.attribute===e);if(o)return{attributeName:o.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:o.format,byteOffset:o.byteOffset,byteStride:i}}return null}function bz(r,e){const t={...r,attributes:r.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const i=t.attributes.find(o=>o.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Zt.warn(`shader layout attribute ${n.name} not present in shader`)}return t}const D_=class D_ extends ui{constructor(t,n){super(t,n,D_.defaultProps);J(this,"maxVertexAttributes");J(this,"attributeInfos");J(this,"indexBuffer",null);J(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=Az(n.renderPipeline.shaderLayout,n.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,n){throw new Error("constant attributes not supported")}};J(D_,"defaultProps",{...ui.defaultProps,renderPipeline:null});let Nb=D_;const O_=class O_ extends ui{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,O_.defaultProps)}};J(O_,"defaultProps",{...ui.defaultProps,layout:void 0,buffers:{}});let kb=O_;const L_=class L_ extends ui{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,L_.defaultProps)}};J(L_,"defaultProps",{...ui.defaultProps,type:void 0,count:void 0});let Ub=L_;const xz={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function wz(r){const e=xz[r];return jn(r),e}function Cz(r,e){switch(e){case 1:return r;case 2:return r+r%2;default:return r+(4-r%4)%4}}let A0;function PF(r){return(!A0||A0.byteLength<r)&&(A0=new ArrayBuffer(r)),A0}function Ez(r,e){const t=PF(r.BYTES_PER_ELEMENT*e);return new r(t,0,e)}function Tz(r){const{target:e,source:t,start:n=0,count:i=1}=r,o=t.length,s=i*o;let c=0;for(let f=n;c<o;c++)e[f++]=t[c];for(;c<s;)c<s-c?(e.copyWithin(n+c,n,n+c),c*=2):(e.copyWithin(n+c,n,n+s-c),c=s);return r.target}const YT=1024;class Bz{constructor(e){J(this,"layout",{});J(this,"byteLength");let t=0;for(const[i,o]of Object.entries(e)){const s=wz(o),{type:c,components:f}=s;t=Cz(t,f);const g=t;t+=f,this.layout[i]={type:c,size:f,offset:g}}t+=(4-t%4)%4;const n=t*4;this.byteLength=Math.max(n,YT)}getData(e){const t=Math.max(this.byteLength,YT),n=PF(t),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[o,s]of Object.entries(e)){const c=this.layout[o];if(!c){Zt.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}const{type:f,size:g,offset:b}=c,T=i[f];if(g===1){if(typeof s!="number"&&typeof s!="boolean"){Zt.warn(`Supplied value for single component uniform ${o} is not a number: ${s}`)();continue}T[b]=Number(s)}else{const S=qp(s);if(!S){Zt.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${s}`)();continue}T.set(S,b)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function Sz(r,e,t=16){if(r!==e)return!1;const n=qp(r);if(!n)return!1;const i=qp(e);if(i&&n.length===i.length){for(let o=0;o<n.length;++o)if(i[o]!==n[o])return!1}return!0}function Iz(r){const e=qp(r);return e?e.slice():r}class Mz{constructor(e){J(this,"name");J(this,"uniforms",{});J(this,"modifiedUniforms",{});J(this,"modified",!0);J(this,"bindingLayout",{});J(this,"needsRedraw","initialized");var t;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(o=>o.type==="uniform"&&o.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const i=n;for(const o of i.uniforms||[])this.bindingLayout[o.name]=o}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){Sz(this.uniforms[e],t)||(this.uniforms[e]=Iz(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class Pz{constructor(e){J(this,"uniformBlocks",new Map);J(this,"uniformBufferLayouts",new Map);J(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const i=t,o=new Bz(n.uniformTypes||{});this.uniformBufferLayouts.set(i,o);const s=new Mz({name:t});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,s)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const t=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:$i.UNIFORM|$i.COPY_DST,byteLength:i}),s=this.getUniformBufferData(t);return o.write(s),o}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:$i.UNIFORM|$i.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&Zt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e),n=this.uniformBuffers.get(e);let i=!1;if(n&&t.needsRedraw){i||(i=t.needsRedraw);const o=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(o);const c=this.uniformBlocks.get(e).getAllUniforms();Zt.log(4,`Writing to uniform buffer ${String(e)}`,o,c)()}return i}}function RF(r){const e=ArrayBuffer.isView(r)?r.constructor:r;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function FF(r){switch(r){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(r)}}function Rz(r,e,t){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let i=RF(r);if(i==="uint8"&&t&&n===1)return"unorm8-webgl";if(i==="uint8"&&t&&n===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${n}`}if(i==="uint16"||i==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${n}`}return n===1?i:`${i}x${n}`}function Fz(r){return qp(r)!==null||typeof r=="number"||typeof r=="boolean"}function Cx(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const n=r[t];Fz(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}function Dz(r,e,t){const{removedProps:n={},deprecatedProps:i={},replacedProps:o={}}=t;for(const c in n)if(c in e){const g=n[c]?`${r}.${n[c]}`:"N/A";Zt.removed(`${r}.${c}`,g)()}for(const c in i)if(c in e){const f=i[c];Zt.deprecated(`${r}.${c}`,`${r}.${f}`)()}let s=null;for(const[c,f]of Object.entries(o))c in e&&(Zt.deprecated(`${r}.${c}`,`${r}.${f}`)(),s=s||Object.assign({},e),s[f]=e[c],delete s[c]);return s||e}let Oz="";async function Lz(r,e){return await new Promise((t,n)=>{try{const i=new Image;i.onload=()=>t(i),i.onerror=()=>n(new Error(`Could not load image ${r}.`)),i.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",i.src=r.startsWith("http")?r:Oz+r}catch(i){n(i)}})}async function DF(r,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",r),new Promise((i,o)=>{n.onload=i,n.onerror=s=>o(new Error(`Unable to load script '${r}': ${s}`)),t.appendChild(n)})}function zb(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!zb(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!zb(r[o],e[o],t-1))return!1;return!0}return!1}function Nz(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function kz(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}class Uz{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Hl{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,t){if(e){t(jm.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(Jm.instance)}}}class jm extends Hl{}jm.instance=new jm;class Jm extends Hl{}Jm.instance=new Jm;class Ri extends Hl{constructor(){super()}}let Gb=class extends Ri{constructor(e,t,n,i,o,s){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=o,this.endLine=s}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}};class zz extends Ri{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Gz extends Ri{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Vz extends Ri{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Hz extends Ri{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class Of extends Ri{constructor(e,t,n,i,o){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class OF extends Ri{constructor(e,t,n){super(),this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Vb extends Ri{constructor(e,t,n,i,o){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class QT extends Ri{constructor(e,t,n,i,o){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var sA;(function(r){r.increment="++",r.decrement="--"})(sA||(sA={}));(function(r){function e(t){const n=t;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return r[n]}r.parse=e})(sA||(sA={}));class jz extends Ri{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var Zp;(function(r){r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(Zp||(Zp={}));(function(r){function e(t){const n=t;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}r.parse=e})(Zp||(Zp={}));class Jz extends Ri{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class LF extends Ri{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}search(e){for(const t of this.args)t.search(e);e(this)}}class Wz extends Ri{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class Xz extends Ri{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"body"}}class $z extends Ri{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Kz extends Ri{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class qz extends Ri{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Zz extends Ri{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Yz extends Ri{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class NF extends Ri{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class Qz extends Ri{constructor(){super()}get astNodeType(){return"discard"}}class e7 extends Ri{constructor(){super()}get astNodeType(){return"break"}}class t7 extends Ri{constructor(){super()}get astNodeType(){return"continue"}}class sh extends Ri{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Df extends sh{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}}class kF extends sh{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}}class r7 extends sh{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class UF extends sh{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class wp extends sh{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class fc extends Hl{constructor(){super()}}class eB extends fc{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Md extends fc{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){e(this);for(const t of this.args)t.search(e)}}class zF extends fc{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const t of this.args)t.search(e);e(this)}}class Hb extends fc{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const t=e.constants.get(this.name);if(!t)throw new Error("Cannot evaluate node");return t.evaluate(e)}}class tB extends fc{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}evaluate(e){var t,n;if(this.initializer instanceof Md){const i=(t=this.postfix)===null||t===void 0?void 0:t.evaluateString(e),o=(n=this.initializer.type)===null||n===void 0?void 0:n.name,s=e.structs.get(o),c=s==null?void 0:s.getMemberIndex(i);if(c!=-1)return this.initializer.args[c].evaluate(e);console.log(c)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class rB extends fc{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class n7 extends fc{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class i7 extends fc{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class nB extends fc{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class s7 extends fc{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class GF extends fc{constructor(){super()}}class o7 extends GF{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Lc extends GF{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class VF extends Hl{constructor(){super()}}class a7 extends VF{constructor(e,t){super(),this.selector=e,this.body=t}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class c7 extends VF{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class l7 extends Hl{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class u7 extends Hl{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class f7 extends Hl{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}let h7=class extends Hl{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}};var gt,st;(function(r){r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(st||(st={}));class ot{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class Le{}gt=Le;Le.none=new ot("",st.reserved,"");Le.eof=new ot("EOF",st.token,"");Le.reserved={asm:new ot("asm",st.reserved,"asm"),bf16:new ot("bf16",st.reserved,"bf16"),do:new ot("do",st.reserved,"do"),enum:new ot("enum",st.reserved,"enum"),f16:new ot("f16",st.reserved,"f16"),f64:new ot("f64",st.reserved,"f64"),handle:new ot("handle",st.reserved,"handle"),i8:new ot("i8",st.reserved,"i8"),i16:new ot("i16",st.reserved,"i16"),i64:new ot("i64",st.reserved,"i64"),mat:new ot("mat",st.reserved,"mat"),premerge:new ot("premerge",st.reserved,"premerge"),regardless:new ot("regardless",st.reserved,"regardless"),typedef:new ot("typedef",st.reserved,"typedef"),u8:new ot("u8",st.reserved,"u8"),u16:new ot("u16",st.reserved,"u16"),u64:new ot("u64",st.reserved,"u64"),unless:new ot("unless",st.reserved,"unless"),using:new ot("using",st.reserved,"using"),vec:new ot("vec",st.reserved,"vec"),void:new ot("void",st.reserved,"void")};Le.keywords={array:new ot("array",st.keyword,"array"),atomic:new ot("atomic",st.keyword,"atomic"),bool:new ot("bool",st.keyword,"bool"),f32:new ot("f32",st.keyword,"f32"),i32:new ot("i32",st.keyword,"i32"),mat2x2:new ot("mat2x2",st.keyword,"mat2x2"),mat2x3:new ot("mat2x3",st.keyword,"mat2x3"),mat2x4:new ot("mat2x4",st.keyword,"mat2x4"),mat3x2:new ot("mat3x2",st.keyword,"mat3x2"),mat3x3:new ot("mat3x3",st.keyword,"mat3x3"),mat3x4:new ot("mat3x4",st.keyword,"mat3x4"),mat4x2:new ot("mat4x2",st.keyword,"mat4x2"),mat4x3:new ot("mat4x3",st.keyword,"mat4x3"),mat4x4:new ot("mat4x4",st.keyword,"mat4x4"),ptr:new ot("ptr",st.keyword,"ptr"),sampler:new ot("sampler",st.keyword,"sampler"),sampler_comparison:new ot("sampler_comparison",st.keyword,"sampler_comparison"),struct:new ot("struct",st.keyword,"struct"),texture_1d:new ot("texture_1d",st.keyword,"texture_1d"),texture_2d:new ot("texture_2d",st.keyword,"texture_2d"),texture_2d_array:new ot("texture_2d_array",st.keyword,"texture_2d_array"),texture_3d:new ot("texture_3d",st.keyword,"texture_3d"),texture_cube:new ot("texture_cube",st.keyword,"texture_cube"),texture_cube_array:new ot("texture_cube_array",st.keyword,"texture_cube_array"),texture_multisampled_2d:new ot("texture_multisampled_2d",st.keyword,"texture_multisampled_2d"),texture_storage_1d:new ot("texture_storage_1d",st.keyword,"texture_storage_1d"),texture_storage_2d:new ot("texture_storage_2d",st.keyword,"texture_storage_2d"),texture_storage_2d_array:new ot("texture_storage_2d_array",st.keyword,"texture_storage_2d_array"),texture_storage_3d:new ot("texture_storage_3d",st.keyword,"texture_storage_3d"),texture_depth_2d:new ot("texture_depth_2d",st.keyword,"texture_depth_2d"),texture_depth_2d_array:new ot("texture_depth_2d_array",st.keyword,"texture_depth_2d_array"),texture_depth_cube:new ot("texture_depth_cube",st.keyword,"texture_depth_cube"),texture_depth_cube_array:new ot("texture_depth_cube_array",st.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new ot("texture_depth_multisampled_2d",st.keyword,"texture_depth_multisampled_2d"),texture_external:new ot("texture_external",st.keyword,"texture_external"),u32:new ot("u32",st.keyword,"u32"),vec2:new ot("vec2",st.keyword,"vec2"),vec3:new ot("vec3",st.keyword,"vec3"),vec4:new ot("vec4",st.keyword,"vec4"),bitcast:new ot("bitcast",st.keyword,"bitcast"),block:new ot("block",st.keyword,"block"),break:new ot("break",st.keyword,"break"),case:new ot("case",st.keyword,"case"),continue:new ot("continue",st.keyword,"continue"),continuing:new ot("continuing",st.keyword,"continuing"),default:new ot("default",st.keyword,"default"),diagnostic:new ot("diagnostic",st.keyword,"diagnostic"),discard:new ot("discard",st.keyword,"discard"),else:new ot("else",st.keyword,"else"),enable:new ot("enable",st.keyword,"enable"),fallthrough:new ot("fallthrough",st.keyword,"fallthrough"),false:new ot("false",st.keyword,"false"),fn:new ot("fn",st.keyword,"fn"),for:new ot("for",st.keyword,"for"),function:new ot("function",st.keyword,"function"),if:new ot("if",st.keyword,"if"),let:new ot("let",st.keyword,"let"),const:new ot("const",st.keyword,"const"),loop:new ot("loop",st.keyword,"loop"),while:new ot("while",st.keyword,"while"),private:new ot("private",st.keyword,"private"),read:new ot("read",st.keyword,"read"),read_write:new ot("read_write",st.keyword,"read_write"),return:new ot("return",st.keyword,"return"),requires:new ot("requires",st.keyword,"requires"),storage:new ot("storage",st.keyword,"storage"),switch:new ot("switch",st.keyword,"switch"),true:new ot("true",st.keyword,"true"),alias:new ot("alias",st.keyword,"alias"),type:new ot("type",st.keyword,"type"),uniform:new ot("uniform",st.keyword,"uniform"),var:new ot("var",st.keyword,"var"),override:new ot("override",st.keyword,"override"),workgroup:new ot("workgroup",st.keyword,"workgroup"),write:new ot("write",st.keyword,"write"),r8unorm:new ot("r8unorm",st.keyword,"r8unorm"),r8snorm:new ot("r8snorm",st.keyword,"r8snorm"),r8uint:new ot("r8uint",st.keyword,"r8uint"),r8sint:new ot("r8sint",st.keyword,"r8sint"),r16uint:new ot("r16uint",st.keyword,"r16uint"),r16sint:new ot("r16sint",st.keyword,"r16sint"),r16float:new ot("r16float",st.keyword,"r16float"),rg8unorm:new ot("rg8unorm",st.keyword,"rg8unorm"),rg8snorm:new ot("rg8snorm",st.keyword,"rg8snorm"),rg8uint:new ot("rg8uint",st.keyword,"rg8uint"),rg8sint:new ot("rg8sint",st.keyword,"rg8sint"),r32uint:new ot("r32uint",st.keyword,"r32uint"),r32sint:new ot("r32sint",st.keyword,"r32sint"),r32float:new ot("r32float",st.keyword,"r32float"),rg16uint:new ot("rg16uint",st.keyword,"rg16uint"),rg16sint:new ot("rg16sint",st.keyword,"rg16sint"),rg16float:new ot("rg16float",st.keyword,"rg16float"),rgba8unorm:new ot("rgba8unorm",st.keyword,"rgba8unorm"),rgba8unorm_srgb:new ot("rgba8unorm_srgb",st.keyword,"rgba8unorm_srgb"),rgba8snorm:new ot("rgba8snorm",st.keyword,"rgba8snorm"),rgba8uint:new ot("rgba8uint",st.keyword,"rgba8uint"),rgba8sint:new ot("rgba8sint",st.keyword,"rgba8sint"),bgra8unorm:new ot("bgra8unorm",st.keyword,"bgra8unorm"),bgra8unorm_srgb:new ot("bgra8unorm_srgb",st.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new ot("rgb10a2unorm",st.keyword,"rgb10a2unorm"),rg11b10float:new ot("rg11b10float",st.keyword,"rg11b10float"),rg32uint:new ot("rg32uint",st.keyword,"rg32uint"),rg32sint:new ot("rg32sint",st.keyword,"rg32sint"),rg32float:new ot("rg32float",st.keyword,"rg32float"),rgba16uint:new ot("rgba16uint",st.keyword,"rgba16uint"),rgba16sint:new ot("rgba16sint",st.keyword,"rgba16sint"),rgba16float:new ot("rgba16float",st.keyword,"rgba16float"),rgba32uint:new ot("rgba32uint",st.keyword,"rgba32uint"),rgba32sint:new ot("rgba32sint",st.keyword,"rgba32sint"),rgba32float:new ot("rgba32float",st.keyword,"rgba32float"),static_assert:new ot("static_assert",st.keyword,"static_assert")};Le.tokens={decimal_float_literal:new ot("decimal_float_literal",st.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new ot("hex_float_literal",st.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new ot("int_literal",st.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new ot("uint_literal",st.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new ot("ident",st.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new ot("and",st.token,"&"),and_and:new ot("and_and",st.token,"&&"),arrow:new ot("arrow ",st.token,"->"),attr:new ot("attr",st.token,"@"),forward_slash:new ot("forward_slash",st.token,"/"),bang:new ot("bang",st.token,"!"),bracket_left:new ot("bracket_left",st.token,"["),bracket_right:new ot("bracket_right",st.token,"]"),brace_left:new ot("brace_left",st.token,"{"),brace_right:new ot("brace_right",st.token,"}"),colon:new ot("colon",st.token,":"),comma:new ot("comma",st.token,","),equal:new ot("equal",st.token,"="),equal_equal:new ot("equal_equal",st.token,"=="),not_equal:new ot("not_equal",st.token,"!="),greater_than:new ot("greater_than",st.token,">"),greater_than_equal:new ot("greater_than_equal",st.token,">="),shift_right:new ot("shift_right",st.token,">>"),less_than:new ot("less_than",st.token,"<"),less_than_equal:new ot("less_than_equal",st.token,"<="),shift_left:new ot("shift_left",st.token,"<<"),modulo:new ot("modulo",st.token,"%"),minus:new ot("minus",st.token,"-"),minus_minus:new ot("minus_minus",st.token,"--"),period:new ot("period",st.token,"."),plus:new ot("plus",st.token,"+"),plus_plus:new ot("plus_plus",st.token,"++"),or:new ot("or",st.token,"|"),or_or:new ot("or_or",st.token,"||"),paren_left:new ot("paren_left",st.token,"("),paren_right:new ot("paren_right",st.token,")"),semicolon:new ot("semicolon",st.token,";"),star:new ot("star",st.token,"*"),tilde:new ot("tilde",st.token,"~"),underscore:new ot("underscore",st.token,"_"),xor:new ot("xor",st.token,"^"),plus_equal:new ot("plus_equal",st.token,"+="),minus_equal:new ot("minus_equal",st.token,"-="),times_equal:new ot("times_equal",st.token,"*="),division_equal:new ot("division_equal",st.token,"/="),modulo_equal:new ot("modulo_equal",st.token,"%="),and_equal:new ot("and_equal",st.token,"&="),or_equal:new ot("or_equal",st.token,"|="),xor_equal:new ot("xor_equal",st.token,"^="),shift_right_equal:new ot("shift_right_equal",st.token,">>="),shift_left_equal:new ot("shift_left_equal",st.token,"<<=")};Le.simpleTokens={"@":gt.tokens.attr,"{":gt.tokens.brace_left,"}":gt.tokens.brace_right,":":gt.tokens.colon,",":gt.tokens.comma,"(":gt.tokens.paren_left,")":gt.tokens.paren_right,";":gt.tokens.semicolon};Le.literalTokens={"&":gt.tokens.and,"&&":gt.tokens.and_and,"->":gt.tokens.arrow,"/":gt.tokens.forward_slash,"!":gt.tokens.bang,"[":gt.tokens.bracket_left,"]":gt.tokens.bracket_right,"=":gt.tokens.equal,"==":gt.tokens.equal_equal,"!=":gt.tokens.not_equal,">":gt.tokens.greater_than,">=":gt.tokens.greater_than_equal,">>":gt.tokens.shift_right,"<":gt.tokens.less_than,"<=":gt.tokens.less_than_equal,"<<":gt.tokens.shift_left,"%":gt.tokens.modulo,"-":gt.tokens.minus,"--":gt.tokens.minus_minus,".":gt.tokens.period,"+":gt.tokens.plus,"++":gt.tokens.plus_plus,"|":gt.tokens.or,"||":gt.tokens.or_or,"*":gt.tokens.star,"~":gt.tokens.tilde,_:gt.tokens.underscore,"^":gt.tokens.xor,"+=":gt.tokens.plus_equal,"-=":gt.tokens.minus_equal,"*=":gt.tokens.times_equal,"/=":gt.tokens.division_equal,"%=":gt.tokens.modulo_equal,"&=":gt.tokens.and_equal,"|=":gt.tokens.or_equal,"^=":gt.tokens.xor_equal,">>=":gt.tokens.shift_right_equal,"<<=":gt.tokens.shift_left_equal};Le.regexTokens={decimal_float_literal:gt.tokens.decimal_float_literal,hex_float_literal:gt.tokens.hex_float_literal,int_literal:gt.tokens.int_literal,uint_literal:gt.tokens.uint_literal,ident:gt.tokens.ident};Le.storage_class=[gt.keywords.function,gt.keywords.private,gt.keywords.workgroup,gt.keywords.uniform,gt.keywords.storage];Le.access_mode=[gt.keywords.read,gt.keywords.write,gt.keywords.read_write];Le.sampler_type=[gt.keywords.sampler,gt.keywords.sampler_comparison];Le.sampled_texture_type=[gt.keywords.texture_1d,gt.keywords.texture_2d,gt.keywords.texture_2d_array,gt.keywords.texture_3d,gt.keywords.texture_cube,gt.keywords.texture_cube_array];Le.multisampled_texture_type=[gt.keywords.texture_multisampled_2d];Le.storage_texture_type=[gt.keywords.texture_storage_1d,gt.keywords.texture_storage_2d,gt.keywords.texture_storage_2d_array,gt.keywords.texture_storage_3d];Le.depth_texture_type=[gt.keywords.texture_depth_2d,gt.keywords.texture_depth_2d_array,gt.keywords.texture_depth_cube,gt.keywords.texture_depth_cube_array,gt.keywords.texture_depth_multisampled_2d];Le.texture_external_type=[gt.keywords.texture_external];Le.any_texture_type=[...gt.sampled_texture_type,...gt.multisampled_texture_type,...gt.storage_texture_type,...gt.depth_texture_type,...gt.texture_external_type];Le.texel_format=[gt.keywords.r8unorm,gt.keywords.r8snorm,gt.keywords.r8uint,gt.keywords.r8sint,gt.keywords.r16uint,gt.keywords.r16sint,gt.keywords.r16float,gt.keywords.rg8unorm,gt.keywords.rg8snorm,gt.keywords.rg8uint,gt.keywords.rg8sint,gt.keywords.r32uint,gt.keywords.r32sint,gt.keywords.r32float,gt.keywords.rg16uint,gt.keywords.rg16sint,gt.keywords.rg16float,gt.keywords.rgba8unorm,gt.keywords.rgba8unorm_srgb,gt.keywords.rgba8snorm,gt.keywords.rgba8uint,gt.keywords.rgba8sint,gt.keywords.bgra8unorm,gt.keywords.bgra8unorm_srgb,gt.keywords.rgb10a2unorm,gt.keywords.rg11b10float,gt.keywords.rg32uint,gt.keywords.rg32sint,gt.keywords.rg32float,gt.keywords.rgba16uint,gt.keywords.rgba16sint,gt.keywords.rgba16float,gt.keywords.rgba32uint,gt.keywords.rgba32sint,gt.keywords.rgba32float];Le.const_literal=[gt.tokens.int_literal,gt.tokens.uint_literal,gt.tokens.decimal_float_literal,gt.tokens.hex_float_literal,gt.keywords.true,gt.keywords.false];Le.literal_or_ident=[gt.tokens.ident,gt.tokens.int_literal,gt.tokens.uint_literal,gt.tokens.decimal_float_literal,gt.tokens.hex_float_literal];Le.element_count_expression=[gt.tokens.int_literal,gt.tokens.uint_literal,gt.tokens.ident];Le.template_types=[gt.keywords.vec2,gt.keywords.vec3,gt.keywords.vec4,gt.keywords.mat2x2,gt.keywords.mat2x3,gt.keywords.mat2x4,gt.keywords.mat3x2,gt.keywords.mat3x3,gt.keywords.mat3x4,gt.keywords.mat4x2,gt.keywords.mat4x3,gt.keywords.mat4x4,gt.keywords.atomic,gt.keywords.bitcast,...gt.any_texture_type];Le.attribute_name=[gt.tokens.ident,gt.keywords.block,gt.keywords.diagnostic];Le.assignment_operators=[gt.tokens.equal,gt.tokens.plus_equal,gt.tokens.minus_equal,gt.tokens.times_equal,gt.tokens.division_equal,gt.tokens.modulo_equal,gt.tokens.and_equal,gt.tokens.or_equal,gt.tokens.xor_equal,gt.tokens.shift_right_equal,gt.tokens.shift_left_equal];Le.increment_operators=[gt.tokens.plus_plus,gt.tokens.minus_minus];class iB{constructor(e,t,n){this.type=e,this.lexeme=t,this.line=n}toString(){return this.lexeme}isTemplateType(){return Le.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Le.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class d7{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new iB(Le.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}const t=Le.simpleTokens[e];if(t)return this._addToken(t),!0;let n=Le.none;const i=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)e+=this._advance(),s=this._peekAhead()}if(i){const s=Le.keywords[e];if(s)return this._addToken(s),!0}if(i||o)return this._addToken(Le.tokens.ident),!0;for(;;){let s=this._findType(e);const c=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(c=="=")return this._current++,e+=c,this._addToken(Le.tokens.minus_equal),!0;if(c=="-")return this._current++,e+=c,this._addToken(Le.tokens.minus_minus),!0;const f=this._tokens.length-1;if((Le.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==Le.tokens.paren_right)&&c!=">")return this._addToken(s),!0}if(e==">"&&(c==">"||c=="=")){let f=!1,g=this._tokens.length-1;for(let b=0;b<5&&g>=0&&Le.assignment_operators.indexOf(this._tokens[g].type)===-1;++b,--g)if(this._tokens[g].type===Le.tokens.less_than){g>0&&this._tokens[g-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(s),!0}if(s===Le.none){let f=e,g=0;const b=2;for(let T=0;T<b;++T)if(f+=this._peekAhead(T),s=this._findType(f),s!==Le.none){g=T;break}if(s===Le.none)return n===Le.none?!1:(this._current--,this._addToken(n),!0);e=f,this._current+=g+1}if(n=s,this._isAtEnd())break;e+=this._advance()}return n===Le.none?!1:(this._addToken(n),!0)}_findType(e){for(const n in Le.regexTokens){const i=Le.regexTokens[n];if(this._match(e,i.rule))return i}const t=Le.literalTokens[e];return t||Le.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new iB(e,t,this._line))}}class A7{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new Uz,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,o=n.countNode;if(o instanceof Hb){const c=o.name,f=this._context.constants.get(c);if(f)try{const g=f.evaluate(this._context);i.count=g}catch{}}}this._deferArrayCountEval.length=0}return t}_initialize(e){if(e)if(typeof e=="string"){const t=new d7(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,t){return{token:e,message:t,toString:function(){return`${t}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Le.eof}_match(e){if(e instanceof ot)return this._check(e)?(this._advance(),!0):!1;for(let t=0,n=e.length;t<n;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),t)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;return e.indexOf(n)!=-1}return t.type==e}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Le.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Le.keywords.alias)){const t=this._type_alias();return this._consume(Le.tokens.semicolon,"Expected ';'"),t}if(this._match(Le.keywords.diagnostic)){const t=this._diagnostic();return this._consume(Le.tokens.semicolon,"Expected ';'"),t}if(this._match(Le.keywords.requires)){const t=this._requires_directive();return this._consume(Le.tokens.semicolon,"Expected ';'"),t}if(this._match(Le.keywords.enable)){const t=this._enable_directive();return this._consume(Le.tokens.semicolon,"Expected ';'"),t}const e=this._attribute();if(this._check(Le.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(Le.tokens.semicolon,"Expected ';'."),t}if(this._check(Le.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(Le.tokens.semicolon,"Expected ';'."),t}if(this._check(Le.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(Le.tokens.semicolon,"Expected ';'."),t}if(this._check(Le.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(Le.tokens.semicolon,"Expected ';'."),t}if(this._check(Le.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),t}if(this._check(Le.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),t}return null}_function_decl(){if(!this._match(Le.keywords.fn))return null;const e=this._currentLine,t=this._consume(Le.tokens.ident,"Expected function name.").toString();this._consume(Le.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Le.tokens.paren_right))do{if(this._check(Le.tokens.paren_right))break;const c=this._attribute(),f=this._consume(Le.tokens.ident,"Expected argument name.").toString();this._consume(Le.tokens.colon,"Expected ':' for argument type.");const g=this._attribute(),b=this._type_decl();b!=null&&(b.attributes=g,n.push(new l7(f,b,c)))}while(this._match(Le.tokens.comma));this._consume(Le.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(Le.tokens.arrow)){const c=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=c)}const o=this._compound_statement(),s=this._currentLine;return new Gb(t,n,i,o,e,s)}_compound_statement(){const e=[];for(this._consume(Le.tokens.brace_left,"Expected '{' for block.");!this._check(Le.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(Le.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Le.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Le.tokens.attr)&&this._attribute(),this._check(Le.keywords.if))return this._if_statement();if(this._check(Le.keywords.switch))return this._switch_statement();if(this._check(Le.keywords.loop))return this._loop_statement();if(this._check(Le.keywords.for))return this._for_statement();if(this._check(Le.keywords.while))return this._while_statement();if(this._check(Le.keywords.continuing))return this._continuing_statement();if(this._check(Le.keywords.static_assert))return this._static_assert_statement();if(this._check(Le.tokens.brace_left))return this._compound_statement();let e=null;return this._check(Le.keywords.return)?e=this._return_statement():this._check([Le.keywords.var,Le.keywords.let,Le.keywords.const])?e=this._variable_statement():this._match(Le.keywords.discard)?e=new Qz:this._match(Le.keywords.break)?e=new e7:this._match(Le.keywords.continue)?e=new t7:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(Le.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Le.keywords.static_assert))return null;const e=this._optional_paren_expression();return new zz(e)}_while_statement(){if(!this._match(Le.keywords.while))return null;const e=this._optional_paren_expression();this._check(Le.tokens.attr)&&this._attribute();const t=this._compound_statement();return new Gz(e,t)}_continuing_statement(){if(!this._match(Le.keywords.continuing))return null;const e=this._compound_statement();return new Vz(e)}_for_statement(){if(!this._match(Le.keywords.for))return null;this._consume(Le.tokens.paren_left,"Expected '('.");const e=this._check(Le.tokens.semicolon)?null:this._for_init();this._consume(Le.tokens.semicolon,"Expected ';'.");const t=this._check(Le.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(Le.tokens.semicolon,"Expected ';'.");const n=this._check(Le.tokens.paren_right)?null:this._for_increment();this._consume(Le.tokens.paren_right,"Expected ')'."),this._check(Le.tokens.attr)&&this._attribute();const i=this._compound_statement();return new Hz(e,t,n,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Le.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Le.tokens.equal)&&(t=this._short_circuit_or_expression()),new Of(e.name,e.type,e.storage,e.access,t)}if(this._match(Le.keywords.let)){const e=this._consume(Le.tokens.ident,"Expected name for let.").toString();let t=null;if(this._match(Le.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}this._consume(Le.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new Vb(e,t,null,null,n)}if(this._match(Le.keywords.const)){const e=this._consume(Le.tokens.ident,"Expected name for const.").toString();let t=null;if(this._match(Le.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}this._consume(Le.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new QT(e,t,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(Le.increment_operators))return this._current=e,null;const n=this._consume(Le.increment_operators,"Expected increment operator");return new jz(n.type===Le.tokens.plus_plus?sA.increment:sA.decrement,t)}_assignment_statement(){let e=null;if(this._check(Le.tokens.brace_right))return null;let t=this._match(Le.tokens.underscore);if(t||(e=this._unary_expression()),!t&&e==null)return null;const n=this._consume(Le.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new Jz(Zp.parse(n.lexeme),e,i)}_func_call_statement(){if(!this._check(Le.tokens.ident))return null;const e=this._current,t=this._consume(Le.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):new LF(t.lexeme,n)}_loop_statement(){if(!this._match(Le.keywords.loop))return null;this._check(Le.tokens.attr)&&this._attribute(),this._consume(Le.tokens.brace_left,"Expected '{' for loop.");const e=[];let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.push(i);else e.push(t);t=this._statement()}let n=null;return this._match(Le.keywords.continuing)&&(n=this._compound_statement()),this._consume(Le.tokens.brace_right,"Expected '}' for loop."),new Wz(e,n)}_switch_statement(){if(!this._match(Le.keywords.switch))return null;const e=this._optional_paren_expression();this._check(Le.tokens.attr)&&this._attribute(),this._consume(Le.tokens.brace_left,"Expected '{' for switch.");const t=this._switch_body();if(t==null||t.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Le.tokens.brace_right,"Expected '}' for switch."),new Xz(e,t)}_switch_body(){const e=[];if(this._match(Le.keywords.case)){const t=this._case_selectors();this._match(Le.tokens.colon),this._check(Le.tokens.attr)&&this._attribute(),this._consume(Le.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(Le.tokens.brace_right,"Exected '}' for switch case."),e.push(new a7(t,n))}if(this._match(Le.keywords.default)){this._match(Le.tokens.colon),this._check(Le.tokens.attr)&&this._attribute(),this._consume(Le.tokens.brace_left,"Exected '{' for switch default.");const t=this._case_body();this._consume(Le.tokens.brace_right,"Exected '}' for switch default."),e.push(new c7(t))}if(this._check([Le.keywords.default,Le.keywords.case])){const t=this._switch_body();e.push(t[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(Le.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(Le.keywords.fallthrough))return this._consume(Le.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(Le.keywords.if))return null;const e=this._optional_paren_expression();this._check(Le.tokens.attr)&&this._attribute();const t=this._compound_statement();let n=[];this._match_elseif()&&(this._check(Le.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let i=null;return this._match(Le.keywords.else)&&(this._check(Le.tokens.attr)&&this._attribute(),i=this._compound_statement()),new $z(e,t,n,i)}_match_elseif(){return this._tokens[this._current].type===Le.keywords.else&&this._tokens[this._current+1].type===Le.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(new u7(t,n)),this._match_elseif()&&(this._check(Le.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Le.keywords.return))return null;const e=this._short_circuit_or_expression();return new Kz(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Le.tokens.or_or);)e=new Lc(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Le.tokens.and_and);)e=new Lc(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Le.tokens.or);)e=new Lc(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Le.tokens.xor);)e=new Lc(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(Le.tokens.and);)e=new Lc(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([Le.tokens.equal_equal,Le.tokens.not_equal])?new Lc(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Le.tokens.less_than,Le.tokens.greater_than,Le.tokens.less_than_equal,Le.tokens.greater_than_equal]);)e=new Lc(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Le.tokens.shift_left,Le.tokens.shift_right]);)e=new Lc(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Le.tokens.plus,Le.tokens.minus]);)e=new Lc(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Le.tokens.star,Le.tokens.forward_slash,Le.tokens.modulo]);)e=new Lc(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([Le.tokens.minus,Le.tokens.bang,Le.tokens.tilde,Le.tokens.star,Le.tokens.and])?new o7(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Le.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Le.tokens.bracket_right,"Expected ']'.");const t=new s7(e),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(Le.tokens.period)){const e=this._consume(Le.tokens.ident,"Expected member name."),t=this._postfix_expression(),n=new eB(e.lexeme);return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(Le.tokens.ident)){const n=this._previous().toString();if(this._check(Le.tokens.paren_left)){const i=this._argument_expression_list(),o=this._getStruct(n);return o!=null?new Md(o,i):new zF(n,i)}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return new tB(n,i.value)}return new Hb(n)}if(this._match(Le.const_literal))return new rB(parseFloat(this._previous().toString()));if(this._check(Le.tokens.paren_left))return this._paren_expression();if(this._match(Le.keywords.bitcast)){this._consume(Le.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(Le.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return new n7(n,i)}const e=this._type_decl(),t=this._argument_expression_list();return new i7(e,t)}_argument_expression_list(){if(!this._match(Le.tokens.paren_left))return null;const e=[];do{if(this._check(Le.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Le.tokens.comma));return this._consume(Le.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Le.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Le.tokens.paren_right),new nB([e])}_paren_expression(){this._consume(Le.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Le.tokens.paren_right,"Expected ')'."),new nB([e])}_struct_decl(){if(!this._match(Le.keywords.struct))return null;const e=this._currentLine,t=this._consume(Le.tokens.ident,"Expected name for struct.").toString();this._consume(Le.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Le.tokens.brace_right);){const s=this._attribute(),c=this._consume(Le.tokens.ident,"Expected variable name.").toString();this._consume(Le.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),g=this._type_decl();g!=null&&(g.attributes=f),this._check(Le.tokens.brace_right)?this._match(Le.tokens.comma):this._consume(Le.tokens.comma,"Expected ',' for struct member."),n.push(new f7(c,g,s))}this._consume(Le.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,o=new Df(t,n,e,i);return this._context.structs.set(t,o),o}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(Le.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Le.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(Le.keywords.const))return null;const e=this._consume(Le.tokens.ident,"Expected variable name");let t=null;if(this._match(Le.tokens.colon)){const o=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=o)}let n=null;if(this._match(Le.tokens.equal)){const o=this._short_circuit_or_expression();if(o instanceof Md)n=o;else if(o instanceof tB&&o.initializer instanceof Md)n=o.initializer;else try{const s=o.evaluate(this._context);n=new rB(s)}catch{n=o}}const i=new QT(e.toString(),t,"","",n);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(Le.keywords.let))return null;const e=this._consume(Le.tokens.ident,"Expected variable name");let t=null;if(this._match(Le.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}let n=null;return this._match(Le.tokens.equal)&&(n=this._const_expression()),new Vb(e.toString(),t,"","",n)}_const_expression(){if(this._match(Le.const_literal))return new eB(this._previous().toString());const e=this._type_decl();this._consume(Le.tokens.paren_left,"Expected '('.");let t=[];for(;!this._check(Le.tokens.paren_right)&&(t.push(this._const_expression()),!!this._check(Le.tokens.comma));)this._advance();return this._consume(Le.tokens.paren_right,"Expected ')'."),new Md(e,t)}_variable_decl(){if(!this._match(Le.keywords.var))return null;let e="",t="";this._match(Le.tokens.less_than)&&(e=this._consume(Le.storage_class,"Expected storage_class.").toString(),this._match(Le.tokens.comma)&&(t=this._consume(Le.access_mode,"Expected access_mode.").toString()),this._consume(Le.tokens.greater_than,"Expected '>'."));const n=this._consume(Le.tokens.ident,"Expected variable name");let i=null;if(this._match(Le.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}return new Of(n.toString(),i,e,t,null)}_override_decl(){if(!this._match(Le.keywords.override))return null;const e=this._consume(Le.tokens.ident,"Expected variable name");let t=null;if(this._match(Le.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return new OF(e.toString(),t,null)}_diagnostic(){this._consume(Le.tokens.paren_left,"Expected '('");const e=this._consume(Le.tokens.ident,"Expected severity control name.");this._consume(Le.tokens.comma,"Expected ','");const t=this._consume(Le.tokens.ident,"Expected diagnostic rule name.");return this._consume(Le.tokens.paren_right,"Expected ')'"),new Yz(e.toString(),t.toString())}_enable_directive(){const e=this._consume(Le.tokens.ident,"identity expected.");return new qz(e.toString())}_requires_directive(){const e=[this._consume(Le.tokens.ident,"identity expected.").toString()];for(;this._match(Le.tokens.comma);){const t=this._consume(Le.tokens.ident,"identity expected.");e.push(t.toString())}return new Zz(e)}_type_alias(){const e=this._consume(Le.tokens.ident,"identity expected.");this._consume(Le.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=new NF(e.toString(),t);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Le.tokens.ident,...Le.texel_format,Le.keywords.bool,Le.keywords.f32,Le.keywords.i32,Le.keywords.u32])){const n=this._advance(),i=n.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new sh(n.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(Le.template_types)){let n=this._advance().toString(),i=null,o=null;return this._match(Le.tokens.less_than)&&(i=this._type_decl(),o=null,this._match(Le.tokens.comma)&&(o=this._consume(Le.access_mode,"Expected access_mode for pointer").toString()),this._consume(Le.tokens.greater_than,"Expected '>' for type.")),new kF(n,i,o)}if(this._match(Le.keywords.ptr)){let n=this._previous().toString();this._consume(Le.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(Le.storage_class,"Expected storage_class for pointer");this._consume(Le.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let s=null;return this._match(Le.tokens.comma)&&(s=this._consume(Le.access_mode,"Expected access_mode for pointer").toString()),this._consume(Le.tokens.greater_than,"Expected '>' for pointer."),new r7(n,i.toString(),o,s)}const t=this._attribute();if(this._match(Le.keywords.array)){let n=null,i=-1;const o=this._previous();let s=null;if(this._match(Le.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let f="";if(this._match(Le.tokens.comma)){s=this._shift_expression();try{f=s.evaluate(this._context).toString(),s=null}catch{f="1"}}this._consume(Le.tokens.greater_than,"Expected '>' for array."),i=f?parseInt(f):0}const c=new UF(o.toString(),t,n,i);return s&&this._deferArrayCountEval.push({arrayType:c,countNode:s}),c}return null}_texture_sampler_types(){if(this._match(Le.sampler_type))return new wp(this._previous().toString(),null,null);if(this._match(Le.depth_texture_type))return new wp(this._previous().toString(),null,null);if(this._match(Le.sampled_texture_type)||this._match(Le.multisampled_texture_type)){const e=this._previous();this._consume(Le.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Le.tokens.greater_than,"Expected '>' for sampler type."),new wp(e.toString(),t,null)}if(this._match(Le.storage_texture_type)){const e=this._previous();this._consume(Le.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Le.texel_format,"Invalid texel format.").toString();this._consume(Le.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Le.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Le.tokens.greater_than,"Expected '>' for sampler type."),new wp(e.toString(),t,n)}return null}_attribute(){let e=[];for(;this._match(Le.tokens.attr);){const t=this._consume(Le.attribute_name,"Expected attribute name"),n=new h7(t.toString(),null);if(this._match(Le.tokens.paren_left)){if(n.value=this._consume(Le.literal_or_ident,"Expected attribute value").toString(),this._check(Le.tokens.comma)){this._advance();do{const i=this._consume(Le.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(Le.tokens.comma))}this._consume(Le.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class jd{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class sB{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class p0 extends jd{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Bv extends jd{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class oB extends jd{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}}var Iu;(function(r){r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})(Iu||(Iu={}));class g0{constructor(e,t,n,i,o,s,c){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=o,this.resourceType=s,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class p7{constructor(e,t){this.name=e,this.type=t}}class m0{constructor(e,t){this.align=e,this.size=t}}class g7{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class aB{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class m7{constructor(e,t=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t}}class _7{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class y7{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class v7{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Pl{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new _7,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const n=new A7().parse(e);for(const i of n)i instanceof Gb&&this._functions.set(i.name,new v7(i));for(const i of n)if(i instanceof Df){const o=this._getTypeInfo(i,null);o instanceof p0&&this.structs.push(o)}for(const i of n){if(i instanceof NF){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof OF){const o=i,s=this._getAttributeNum(o.attributes,"id",0),c=o.type!=null?this._getTypeInfo(o.type,o.attributes):null;this.overrides.push(new y7(o.name,c,o.attributes,s));continue}if(this._isUniformVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),c=this._getAttributeNum(o.attributes,"binding",0),f=this._getTypeInfo(o.type,o.attributes),g=new g0(o.name,f,s,c,o.attributes,Iu.Uniform,o.access);this.uniforms.push(g);continue}if(this._isStorageVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),c=this._getAttributeNum(o.attributes,"binding",0),f=this._getTypeInfo(o.type,o.attributes),g=this._isStorageTexture(f),b=new g0(o.name,f,s,c,o.attributes,g?Iu.StorageTexture:Iu.Storage,o.access);this.storage.push(b);continue}if(this._isTextureVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),c=this._getAttributeNum(o.attributes,"binding",0),f=this._getTypeInfo(o.type,o.attributes),g=this._isStorageTexture(f),b=new g0(o.name,f,s,c,o.attributes,g?Iu.StorageTexture:Iu.Texture,o.access);g?this.storage.push(b):this.textures.push(b);continue}if(this._isSamplerVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),c=this._getAttributeNum(o.attributes,"binding",0),f=this._getTypeInfo(o.type,o.attributes),g=new g0(o.name,f,s,c,o.attributes,Iu.Sampler,o.access);this.samplers.push(g);continue}if(i instanceof Gb){const o=this._getAttribute(i,"vertex"),s=this._getAttribute(i,"fragment"),c=this._getAttribute(i,"compute"),f=o||s||c,g=new m7(i.name,f==null?void 0:f.name);g.startLine=i.startLine,g.endLine=i.endLine,this.functions.push(g),this._functions.get(i.name).info=g,f&&(this._functions.get(i.name).inUse=!0,g.inUse=!0,g.resources=this._findResources(i,!!f),g.inputs=this._getInputs(i.args),g.outputs=this._getOutputs(i.returnType),this.entry[f.name].push(g));continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const o=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;o&&t.add(o)}}findResource(e,t){for(const n of this.uniforms)if(n.group==e&&n.binding==t)return n;for(const n of this.storage)if(n.group==e&&n.binding==t)return n;for(const n of this.textures)if(n.group==e&&n.binding==t)return n;for(const n of this.samplers)if(n.group==e&&n.binding==t)return n;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this._getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,o=[];return e.search(s=>{if(s instanceof jm)o.push({});else if(s instanceof Jm)o.pop();else if(s instanceof Of){const c=s;t&&c.type!==null&&this._markStructsFromAST(c.type),o.length>0&&(o[o.length-1][c.name]=c)}else if(s instanceof Md){const c=s;t&&c.type!==null&&this._markStructsFromAST(c.type)}else if(s instanceof Vb){const c=s;t&&c.type!==null&&this._markStructsFromAST(c.type),o.length>0&&(o[o.length-1][c.name]=c)}else if(s instanceof Hb){const c=s;if(o.length>0&&o[o.length-1][c.name])return;const f=i._findResource(c.name);f&&n.push(f)}else if(s instanceof zF){const c=s,f=i._functions.get(c.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=i._findResources(f.node,t)),n.push(...f.resources))}else if(s instanceof LF){const c=s,f=i._functions.get(c.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=i._findResources(f.node,t)),n.push(...f.resources))}}),[...new Map(n.map(s=>[s.name,s])).values()]}getBindGroups(){const e=[];function t(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms){t(n.group,n.binding);const i=e[n.group];i[n.binding]=n}for(const n of this.storage){t(n.group,n.binding);const i=e[n.group];i[n.binding]=n}for(const n of this.textures){t(n.group,n.binding);const i=e[n.group];i[n.binding]=n}for(const n of this.samplers){t(n.group,n.binding);const i=e[n.group];i[n.binding]=n}return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Df)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof Df)this._getStructOutputs(n.type,t);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const o=this._getTypeInfo(n.type,n.type.attributes),s=this._parseInt(i.value),c=new aB(n.name,o,i.name,s);t.push(c)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new aB("",n,t.name,i)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const n of e)if(n.type instanceof Df)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof Df)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),o=this._parseInt(t.value),s=new g7(e.name,i,t.name,o);return n!==null&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new p7(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,t){if(this._types.has(e))return this._types.get(e);if(e instanceof UF){const i=e,o=this._getTypeInfo(i.format,i.attributes),s=new Bv(i.name,t);return s.format=o,s.count=i.count,this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Df){const i=e,o=new p0(i.name,t);o.startLine=i.startLine,o.endLine=i.endLine;for(const s of i.members){const c=this._getTypeInfo(s.type,s.attributes);o.members.push(new sB(s.name,c,s.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof wp){const i=e,o=i.format instanceof sh,s=i.format?o?this._getTypeInfo(i.format,null):new jd(i.format,null):null,c=new oB(i.name,s,t,i.access);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof kF){const i=e,o=i.format?this._getTypeInfo(i.format,null):null,s=new oB(i.name,o,t,i.access);return this._types.set(e,s),this._updateTypeInfo(s),s}const n=new jd(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n;const i=this._getTypeSize(e);if(e.size=(t=i==null?void 0:i.size)!==null&&t!==void 0?t:0,e instanceof Bv){const o=this._getTypeSize(e.format);e.stride=(n=o==null?void 0:o.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(e.format)}e instanceof p0&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,o=0,s=0;for(let c=0,f=e.members.length;c<f;++c){const g=e.members[c],b=this._getTypeSize(g);if(!b)continue;(t=this._getAlias(g.type.name))!==null&&t!==void 0||g.type;const T=b.align,S=b.size;n=this._roundUp(T,n+i),i=S,o=n,s=Math.max(s,T),g.offset=n,g.size=S,this._updateTypeInfo(g.type)}e.size=this._roundUp(s,o+i),e.align=s}_getTypeSize(e){var t,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof sB&&(e=e.type),e instanceof jd){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=Pl._typeInfo[e.name];if(s!==void 0){const c=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new m0(Math.max(o,s.align/c),Math.max(i,s.size/c))}}{const s=Pl._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const c=e.name[e.name.length-1]==="h"?2:1;return new m0(Math.max(o,s.align/c),Math.max(i,s.size/c))}}if(e instanceof Bv){let s=e,c=8,f=8;const g=this._getTypeSize(s.format);g!==null&&(f=g.size,c=g.align);const b=s.count,T=this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(c,f));return f=b*T,i&&(f=i),new m0(Math.max(o,c),Math.max(i,f))}if(e instanceof p0){let s=0,c=0,f=0,g=0,b=0;for(const T of e.members){const S=this._getTypeSize(T.type);S!==null&&(s=Math.max(S.align,s),f=this._roundUp(S.align,f+g),g=S.size,b=f)}return c=this._roundUp(s,b+g),new m0(Math.max(o,s),Math.max(i,c))}return null}_isUniformVar(e){return e instanceof Of&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Of&&e.storage=="storage"}_isTextureVar(e){return e instanceof Of&&e.type!==null&&Pl._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Of&&e.type!==null&&Pl._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let o of i)if(o.name==t)return o;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let i of e)if(i.name==t){let o=i!==null&&i.value!==null?i.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}Pl._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Pl._textureTypes=Le.any_texture_type.map(r=>r.name);Pl._samplerTypes=Le.sampler_type.map(r=>r.name);function b7(r){var o;const e={attributes:[],bindings:[]};let t;try{t=x7(r)}catch(s){return Zt.error(s.message)(),e}for(const s of t.uniforms){const c=[];for(const f of((o=s.type)==null?void 0:o.members)||[])c.push({name:f.name,type:cB(f.type)});e.bindings.push({type:"uniform",name:s.name,location:s.binding,group:s.group,members:c})}const n=t.entry.vertex[0],i=(n==null?void 0:n.inputs.length)||0;for(let s=0;s<i;s++){const c=n.inputs[s];if(c.locationType==="location"){const f=cB(c.type);e.attributes.push({name:c.name,location:Number(c.location),type:f})}}return e}function cB(r){return r.format?`${r.name}<${r.format.name}>`:r.name}function x7(r){try{return new Pl(r)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const w7=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,C7={name:"fp32",vs:w7},E7=[0,1,1,1],T7=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,B7=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,lB={name:"picking",vs:T7,fs:B7,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:E7},getUniforms:S7};function S7(r={},e){const t={};if(r.highlightedObjectColor!==void 0)if(r.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const n=r.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=n}if(r.highlightColor){const n=Array.from(r.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),t.highlightColor=n}return r.isActive!==void 0&&(t.isActive=!!r.isActive,t.isAttribute=!!r.isAttribute),r.useFloatColors!==void 0&&(t.useFloatColors=!!r.useFloatColors),t}function HF(r,e=[],t=0){const n=Math.fround(r),i=r-n;return e[t]=n,e[t+1]=i,e}function I7(r){return r-Math.fround(r)}function M7(r){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let n=0;n<4;++n){const i=t*4+n;HF(r[n*4+t],e,i*2)}return e}const P7=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,R7={ONE:1};function F7(){return R7}const J_={name:"fp64-arithmetic",vs:P7,getUniforms:F7,fp64ify:HF,fp64LowPart:I7,fp64ifyMatrix4:M7},D7=1/Math.PI*180,O7=1/180*Math.PI,L7={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...L7}};const ps=globalThis.mathgl.config;function N7(r,{precision:e=ps.precision}={}){return r=G7(r),`${parseFloat(r.toPrecision(e))}`}function Uu(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function k7(r){return z7(r)}function U7(r){return Za(r)}function z7(r,e){return Ex(r,t=>t*O7,e)}function Za(r,e){return Ex(r,t=>t*D7,e)}function Rl(r,e,t){return Ex(r,n=>Math.max(e,Math.min(t,n)))}function ac(r,e,t){return Uu(r)?r.map((n,i)=>ac(n,e[i],t)):t*e+(1-t)*r}function Sa(r,e,t){const n=ps.EPSILON;t&&(ps.EPSILON=t);try{if(r===e)return!0;if(Uu(r)&&Uu(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!Sa(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=ps.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{ps.EPSILON=n}}function G7(r){return Math.round(r/ps.EPSILON)*ps.EPSILON}function V7(r){return r.clone?r.clone():new Array(r.length)}function Ex(r,e,t){if(Uu(r)){const n=r;t=t||V7(n);for(let i=0;i<t.length&&i<n.length;++i){const o=typeof r=="number"?r:r[i];t[i]=e(o,i,t)}return t}return e(r)}class Tx extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Uu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ps)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+N7(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Sa(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const o=e[i],s=typeof t=="number"?t:t[i];this[i]=o+n*(s-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=t[n];return this.check()}subtract(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=t[n];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ps.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function H7(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function Hn(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function Dp(r,e,t=""){if(ps.debug&&!H7(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function Qa(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}class Bx extends Tx{get x(){return this[0]}set x(e){this[0]=Hn(e)}get y(){return this[1]}set y(e){this[1]=Hn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return Hn(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Hn(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=t[n];return this.check()}divide(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Qa(e>=0&&e<this.ELEMENTS,"index is out of range"),Hn(this[e])}setComponent(e,t){return Qa(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Op=1e-6;let lc=typeof Float32Array<"u"?Float32Array:Array;function j7(){const r=new lc(2);return lc!=Float32Array&&(r[0]=0,r[1]=0),r}function uB(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function J7(r,e){return r[0]=-e[0],r[1]=-e[1],r}function jF(r,e,t,n){const i=e[0],o=e[1];return r[0]=i+n*(t[0]-i),r[1]=o+n*(t[1]-o),r}function W7(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r}function X7(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i+t[4],r[1]=t[1]*n+t[3]*i+t[5],r}function JF(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[3]*i+t[6],r[1]=t[1]*n+t[4]*i+t[7],r}function WF(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r}(function(){const r=j7();return function(e,t,n,i,o,s){let c,f;for(t||(t=2),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],o(r,r,s),e[c]=r[0],e[c+1]=r[1];return e}})();function XF(r,e,t){const n=e[0],i=e[1],o=t[3]*n+t[7]*i||1;return r[0]=(t[0]*n+t[4]*i)/o,r[1]=(t[1]*n+t[5]*i)/o,r}function $F(r,e,t){const n=e[0],i=e[1],o=e[2],s=t[3]*n+t[7]*i+t[11]*o||1;return r[0]=(t[0]*n+t[4]*i+t[8]*o)/s,r[1]=(t[1]*n+t[5]*i+t[9]*o)/s,r[2]=(t[2]*n+t[6]*i+t[10]*o)/s,r}function $7(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r}function K7(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r[3]=e[3],r}function KF(r,e,t){const n=e[0],i=e[1],o=e[2];return r[0]=t[0]*n+t[3]*i+t[6]*o,r[1]=t[1]*n+t[4]*i+t[7]*o,r[2]=t[2]*n+t[5]*i+t[8]*o,r[3]=e[3],r}class Sx extends Bx{constructor(e=0,t=0){super(2),Uu(e)&&arguments.length===1?this.copy(e):(ps.debug&&(Hn(e),Hn(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return ps.debug&&(Hn(e.x),Hn(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return WF(this,this,e),this.check()}transformAsVector(e){return XF(this,this,e),this.check()}transformByMatrix3(e){return JF(this,this,e),this.check()}transformByMatrix2x3(e){return X7(this,this,e),this.check()}transformByMatrix2(e){return W7(this,this,e),this.check()}}function qF(){const r=new lc(3);return lc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function ZF(r){const e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n)}function fB(r,e,t){const n=new lc(3);return n[0]=r,n[1]=e,n[2]=t,n}function q7(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function Z7(r){const e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n}function Y7(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function Q7(r,e){const t=e[0],n=e[1],i=e[2];let o=t*t+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r}function Ix(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Am(r,e,t){const n=e[0],i=e[1],o=e[2],s=t[0],c=t[1],f=t[2];return r[0]=i*f-o*c,r[1]=o*s-n*f,r[2]=n*c-i*s,r}function eG(r,e,t,n){const i=e[0],o=e[1],s=e[2];return r[0]=i+n*(t[0]-i),r[1]=o+n*(t[1]-o),r[2]=s+n*(t[2]-s),r}function Mx(r,e,t){const n=e[0],i=e[1],o=e[2];let s=t[3]*n+t[7]*i+t[11]*o+t[15];return s=s||1,r[0]=(t[0]*n+t[4]*i+t[8]*o+t[12])/s,r[1]=(t[1]*n+t[5]*i+t[9]*o+t[13])/s,r[2]=(t[2]*n+t[6]*i+t[10]*o+t[14])/s,r}function YF(r,e,t){const n=e[0],i=e[1],o=e[2];return r[0]=n*t[0]+i*t[3]+o*t[6],r[1]=n*t[1]+i*t[4]+o*t[7],r[2]=n*t[2]+i*t[5]+o*t[8],r}function QF(r,e,t){const n=t[0],i=t[1],o=t[2],s=t[3],c=e[0],f=e[1],g=e[2];let b=i*g-o*f,T=o*c-n*g,S=n*f-i*c,F=i*S-o*T,k=o*b-n*S,U=n*T-i*b;const j=s*2;return b*=j,T*=j,S*=j,F*=2,k*=2,U*=2,r[0]=c+b+F,r[1]=f+T+k,r[2]=g+S+U,r}function tG(r,e,t,n){const i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=o[0]+t[0],r[1]=o[1]+t[1],r[2]=o[2]+t[2],r}function rG(r,e,t,n){const i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=o[0]+t[0],r[1]=o[1]+t[1],r[2]=o[2]+t[2],r}function nG(r,e,t,n){const i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],r[0]=o[0]+t[0],r[1]=o[1]+t[1],r[2]=o[2]+t[2],r}function iG(r,e){const t=r[0],n=r[1],i=r[2],o=e[0],s=e[1],c=e[2],f=Math.sqrt((t*t+n*n+i*i)*(o*o+s*s+c*c)),g=f&&Ix(r,e)/f;return Math.acos(Math.min(Math.max(g,-1),1))}const eD=q7,tD=ZF,Sv=Z7;(function(){const r=qF();return function(e,t,n,i,o,s){let c,f;for(t||(t=3),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],r[2]=e[c+2],o(r,r,s),e[c]=r[0],e[c+1]=r[1],e[c+2]=r[2];return e}})();const Iv=[0,0,0];let _0;class ft extends Bx{static get ZERO(){return _0||(_0=new ft(0,0,0),Object.freeze(_0)),_0}constructor(e=0,t=0,n=0){super(-0,-0,-0),arguments.length===1&&Uu(e)?this.copy(e):(ps.debug&&(Hn(e),Hn(t),Hn(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ps.debug&&(Hn(e.x),Hn(e.y),Hn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Hn(e)}angle(e){return iG(this,e)}cross(e){return Am(this,this,e),this.check()}rotateX({radians:e,origin:t=Iv}){return tG(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Iv}){return rG(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Iv}){return nG(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Mx(this,this,e),this.check()}transformAsVector(e){return $F(this,this,e),this.check()}transformByMatrix3(e){return YF(this,this,e),this.check()}transformByMatrix2(e){return $7(this,this,e),this.check()}transformByQuaternion(e){return QF(this,this,e),this.check()}}let y0;class Px extends Bx{static get ZERO(){return y0||(y0=new Px(0,0,0,0),Object.freeze(y0)),y0}constructor(e=0,t=0,n=0,i=0){super(-0,-0,-0,-0),Uu(e)&&arguments.length===1?this.copy(e):(ps.debug&&(Hn(e),Hn(t),Hn(n),Hn(i)),this[0]=e,this[1]=t,this[2]=n,this[3]=i)}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return ps.debug&&(Hn(e.x),Hn(e.y),Hn(e.z),Hn(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Hn(e)}get w(){return this[3]}set w(e){this[3]=Hn(e)}transform(e){return Mx(this,this,e),this.check()}transformByMatrix3(e){return KF(this,this,e),this.check()}transformByMatrix2(e){return K7(this,this,e),this.check()}transformByQuaternion(e){return QF(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class rD extends Tx{toString(){let e="[";if(ps.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Hn(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}}function sG(){const r=new lc(9);return lc!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function oG(r,e){if(r===e){const t=e[1],n=e[2],i=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=n,r[7]=i}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function aG(r,e){const t=e[0],n=e[1],i=e[2],o=e[3],s=e[4],c=e[5],f=e[6],g=e[7],b=e[8],T=b*s-c*g,S=-b*o+c*f,F=g*o-s*f;let k=t*T+n*S+i*F;return k?(k=1/k,r[0]=T*k,r[1]=(-b*n+i*g)*k,r[2]=(c*n-i*s)*k,r[3]=S*k,r[4]=(b*t-i*f)*k,r[5]=(-c*t+i*o)*k,r[6]=F*k,r[7]=(-g*t+n*f)*k,r[8]=(s*t-n*o)*k,r):null}function cG(r){const e=r[0],t=r[1],n=r[2],i=r[3],o=r[4],s=r[5],c=r[6],f=r[7],g=r[8];return e*(g*o-s*f)+t*(-g*i+s*c)+n*(f*i-o*c)}function hB(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3],c=e[4],f=e[5],g=e[6],b=e[7],T=e[8],S=t[0],F=t[1],k=t[2],U=t[3],j=t[4],z=t[5],V=t[6],K=t[7],fe=t[8];return r[0]=S*n+F*s+k*g,r[1]=S*i+F*c+k*b,r[2]=S*o+F*f+k*T,r[3]=U*n+j*s+z*g,r[4]=U*i+j*c+z*b,r[5]=U*o+j*f+z*T,r[6]=V*n+K*s+fe*g,r[7]=V*i+K*c+fe*b,r[8]=V*o+K*f+fe*T,r}function lG(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3],c=e[4],f=e[5],g=e[6],b=e[7],T=e[8],S=t[0],F=t[1];return r[0]=n,r[1]=i,r[2]=o,r[3]=s,r[4]=c,r[5]=f,r[6]=S*n+F*s+g,r[7]=S*i+F*c+b,r[8]=S*o+F*f+T,r}function uG(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3],c=e[4],f=e[5],g=e[6],b=e[7],T=e[8],S=Math.sin(t),F=Math.cos(t);return r[0]=F*n+S*s,r[1]=F*i+S*c,r[2]=F*o+S*f,r[3]=F*s-S*n,r[4]=F*c-S*i,r[5]=F*f-S*o,r[6]=g,r[7]=b,r[8]=T,r}function dB(r,e,t){const n=t[0],i=t[1];return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function fG(r,e){const t=e[0],n=e[1],i=e[2],o=e[3],s=t+t,c=n+n,f=i+i,g=t*s,b=n*s,T=n*c,S=i*s,F=i*c,k=i*f,U=o*s,j=o*c,z=o*f;return r[0]=1-T-k,r[3]=b-z,r[6]=S+j,r[1]=b+z,r[4]=1-g-k,r[7]=F-U,r[2]=S-j,r[5]=F+U,r[8]=1-g-T,r}var jb;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(jb||(jb={}));const hG=Object.freeze([1,0,0,0,1,0,0,0,1]);class li extends rD{static get IDENTITY(){return AG()}static get ZERO(){return dG()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return jb}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(hG)}fromObject(e){return this.check()}fromQuaternion(e){return fG(this,e),this.check()}set(e,t,n,i,o,s,c,f,g){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=c,this[7]=f,this[8]=g,this.check()}setRowMajor(e,t,n,i,o,s,c,f,g){return this[0]=e,this[1]=i,this[2]=c,this[3]=t,this[4]=o,this[5]=f,this[6]=n,this[7]=s,this[8]=g,this.check()}determinant(){return cG(this)}transpose(){return oG(this,this),this.check()}invert(){return aG(this,this),this.check()}multiplyLeft(e){return hB(this,e,this),this.check()}multiplyRight(e){return hB(this,this,e),this.check()}rotate(e){return uG(this,this,e),this.check()}scale(e){return Array.isArray(e)?dB(this,this,e):dB(this,this,[e,e]),this.check()}translate(e){return lG(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=JF(t||[-0,-0],e,this);break;case 3:n=YF(t||[-0,-0,-0],e,this);break;case 4:n=KF(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Dp(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let v0,b0=null;function dG(){return v0||(v0=new li([0,0,0,0,0,0,0,0,0]),Object.freeze(v0)),v0}function AG(){return b0||(b0=new li,Object.freeze(b0)),b0}function pG(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function gG(r,e){if(r===e){const t=e[1],n=e[2],i=e[3],o=e[6],s=e[7],c=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=o,r[11]=e[14],r[12]=i,r[13]=s,r[14]=c}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function Jb(r,e){const t=e[0],n=e[1],i=e[2],o=e[3],s=e[4],c=e[5],f=e[6],g=e[7],b=e[8],T=e[9],S=e[10],F=e[11],k=e[12],U=e[13],j=e[14],z=e[15],V=t*c-n*s,K=t*f-i*s,fe=t*g-o*s,Q=n*f-i*c,oe=n*g-o*c,Te=i*g-o*f,ze=b*U-T*k,Ae=b*j-S*k,_e=b*z-F*k,pe=T*j-S*U,X=T*z-F*U,ne=S*z-F*j;let Be=V*ne-K*X+fe*pe+Q*_e-oe*Ae+Te*ze;return Be?(Be=1/Be,r[0]=(c*ne-f*X+g*pe)*Be,r[1]=(i*X-n*ne-o*pe)*Be,r[2]=(U*Te-j*oe+z*Q)*Be,r[3]=(S*oe-T*Te-F*Q)*Be,r[4]=(f*_e-s*ne-g*Ae)*Be,r[5]=(t*ne-i*_e+o*Ae)*Be,r[6]=(j*fe-k*Te-z*K)*Be,r[7]=(b*Te-S*fe+F*K)*Be,r[8]=(s*X-c*_e+g*ze)*Be,r[9]=(n*_e-t*X-o*ze)*Be,r[10]=(k*oe-U*fe+z*V)*Be,r[11]=(T*fe-b*oe-F*V)*Be,r[12]=(c*Ae-s*pe-f*ze)*Be,r[13]=(t*pe-n*Ae+i*ze)*Be,r[14]=(U*K-k*Q-j*V)*Be,r[15]=(b*Q-T*K+S*V)*Be,r):null}function mG(r){const e=r[0],t=r[1],n=r[2],i=r[3],o=r[4],s=r[5],c=r[6],f=r[7],g=r[8],b=r[9],T=r[10],S=r[11],F=r[12],k=r[13],U=r[14],j=r[15],z=e*s-t*o,V=e*c-n*o,K=t*c-n*s,fe=g*k-b*F,Q=g*U-T*F,oe=b*U-T*k,Te=e*oe-t*Q+n*fe,ze=o*oe-s*Q+c*fe,Ae=g*K-b*V+T*z,_e=F*K-k*V+U*z;return f*Te-i*ze+j*Ae-S*_e}function Jf(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3],c=e[4],f=e[5],g=e[6],b=e[7],T=e[8],S=e[9],F=e[10],k=e[11],U=e[12],j=e[13],z=e[14],V=e[15];let K=t[0],fe=t[1],Q=t[2],oe=t[3];return r[0]=K*n+fe*c+Q*T+oe*U,r[1]=K*i+fe*f+Q*S+oe*j,r[2]=K*o+fe*g+Q*F+oe*z,r[3]=K*s+fe*b+Q*k+oe*V,K=t[4],fe=t[5],Q=t[6],oe=t[7],r[4]=K*n+fe*c+Q*T+oe*U,r[5]=K*i+fe*f+Q*S+oe*j,r[6]=K*o+fe*g+Q*F+oe*z,r[7]=K*s+fe*b+Q*k+oe*V,K=t[8],fe=t[9],Q=t[10],oe=t[11],r[8]=K*n+fe*c+Q*T+oe*U,r[9]=K*i+fe*f+Q*S+oe*j,r[10]=K*o+fe*g+Q*F+oe*z,r[11]=K*s+fe*b+Q*k+oe*V,K=t[12],fe=t[13],Q=t[14],oe=t[15],r[12]=K*n+fe*c+Q*T+oe*U,r[13]=K*i+fe*f+Q*S+oe*j,r[14]=K*o+fe*g+Q*F+oe*z,r[15]=K*s+fe*b+Q*k+oe*V,r}function Wm(r,e,t){const n=t[0],i=t[1],o=t[2];let s,c,f,g,b,T,S,F,k,U,j,z;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*o+e[12],r[13]=e[1]*n+e[5]*i+e[9]*o+e[13],r[14]=e[2]*n+e[6]*i+e[10]*o+e[14],r[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(s=e[0],c=e[1],f=e[2],g=e[3],b=e[4],T=e[5],S=e[6],F=e[7],k=e[8],U=e[9],j=e[10],z=e[11],r[0]=s,r[1]=c,r[2]=f,r[3]=g,r[4]=b,r[5]=T,r[6]=S,r[7]=F,r[8]=k,r[9]=U,r[10]=j,r[11]=z,r[12]=s*n+b*i+k*o+e[12],r[13]=c*n+T*i+U*o+e[13],r[14]=f*n+S*i+j*o+e[14],r[15]=g*n+F*i+z*o+e[15]),r}function Rx(r,e,t){const n=t[0],i=t[1],o=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*o,r[9]=e[9]*o,r[10]=e[10]*o,r[11]=e[11]*o,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function _G(r,e,t,n){let i=n[0],o=n[1],s=n[2],c=Math.sqrt(i*i+o*o+s*s),f,g,b,T,S,F,k,U,j,z,V,K,fe,Q,oe,Te,ze,Ae,_e,pe,X,ne,Be,Ze;return c<Op?null:(c=1/c,i*=c,o*=c,s*=c,g=Math.sin(t),f=Math.cos(t),b=1-f,T=e[0],S=e[1],F=e[2],k=e[3],U=e[4],j=e[5],z=e[6],V=e[7],K=e[8],fe=e[9],Q=e[10],oe=e[11],Te=i*i*b+f,ze=o*i*b+s*g,Ae=s*i*b-o*g,_e=i*o*b-s*g,pe=o*o*b+f,X=s*o*b+i*g,ne=i*s*b+o*g,Be=o*s*b-i*g,Ze=s*s*b+f,r[0]=T*Te+U*ze+K*Ae,r[1]=S*Te+j*ze+fe*Ae,r[2]=F*Te+z*ze+Q*Ae,r[3]=k*Te+V*ze+oe*Ae,r[4]=T*_e+U*pe+K*X,r[5]=S*_e+j*pe+fe*X,r[6]=F*_e+z*pe+Q*X,r[7]=k*_e+V*pe+oe*X,r[8]=T*ne+U*Be+K*Ze,r[9]=S*ne+j*Be+fe*Ze,r[10]=F*ne+z*Be+Q*Ze,r[11]=k*ne+V*Be+oe*Ze,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function nD(r,e,t){const n=Math.sin(t),i=Math.cos(t),o=e[4],s=e[5],c=e[6],f=e[7],g=e[8],b=e[9],T=e[10],S=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=o*i+g*n,r[5]=s*i+b*n,r[6]=c*i+T*n,r[7]=f*i+S*n,r[8]=g*i-o*n,r[9]=b*i-s*n,r[10]=T*i-c*n,r[11]=S*i-f*n,r}function yG(r,e,t){const n=Math.sin(t),i=Math.cos(t),o=e[0],s=e[1],c=e[2],f=e[3],g=e[8],b=e[9],T=e[10],S=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=o*i-g*n,r[1]=s*i-b*n,r[2]=c*i-T*n,r[3]=f*i-S*n,r[8]=o*n+g*i,r[9]=s*n+b*i,r[10]=c*n+T*i,r[11]=f*n+S*i,r}function iD(r,e,t){const n=Math.sin(t),i=Math.cos(t),o=e[0],s=e[1],c=e[2],f=e[3],g=e[4],b=e[5],T=e[6],S=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=o*i+g*n,r[1]=s*i+b*n,r[2]=c*i+T*n,r[3]=f*i+S*n,r[4]=g*i-o*n,r[5]=b*i-s*n,r[6]=T*i-c*n,r[7]=S*i-f*n,r}function vG(r,e){const t=e[0],n=e[1],i=e[2],o=e[4],s=e[5],c=e[6],f=e[8],g=e[9],b=e[10];return r[0]=Math.sqrt(t*t+n*n+i*i),r[1]=Math.sqrt(o*o+s*s+c*c),r[2]=Math.sqrt(f*f+g*g+b*b),r}function bG(r,e){const t=e[0],n=e[1],i=e[2],o=e[3],s=t+t,c=n+n,f=i+i,g=t*s,b=n*s,T=n*c,S=i*s,F=i*c,k=i*f,U=o*s,j=o*c,z=o*f;return r[0]=1-T-k,r[1]=b+z,r[2]=S-j,r[3]=0,r[4]=b-z,r[5]=1-g-k,r[6]=F+U,r[7]=0,r[8]=S+j,r[9]=F-U,r[10]=1-g-T,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function xG(r,e,t,n,i,o,s){const c=1/(t-e),f=1/(i-n),g=1/(o-s);return r[0]=o*2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o*2*f,r[6]=0,r[7]=0,r[8]=(t+e)*c,r[9]=(i+n)*f,r[10]=(s+o)*g,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*o*2*g,r[15]=0,r}function wG(r,e,t,n,i){const o=1/Math.tan(e/2);if(r[0]=o/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){const s=1/(n-i);r[10]=(i+n)*s,r[14]=2*i*n*s}else r[10]=-1,r[14]=-2*n;return r}const CG=wG;function EG(r,e,t,n,i,o,s){const c=1/(e-t),f=1/(n-i),g=1/(o-s);return r[0]=-2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*f,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*g,r[11]=0,r[12]=(e+t)*c,r[13]=(i+n)*f,r[14]=(s+o)*g,r[15]=1,r}const TG=EG;function BG(r,e,t,n){let i,o,s,c,f,g,b,T,S,F;const k=e[0],U=e[1],j=e[2],z=n[0],V=n[1],K=n[2],fe=t[0],Q=t[1],oe=t[2];return Math.abs(k-fe)<Op&&Math.abs(U-Q)<Op&&Math.abs(j-oe)<Op?pG(r):(T=k-fe,S=U-Q,F=j-oe,i=1/Math.sqrt(T*T+S*S+F*F),T*=i,S*=i,F*=i,o=V*F-K*S,s=K*T-z*F,c=z*S-V*T,i=Math.sqrt(o*o+s*s+c*c),i?(i=1/i,o*=i,s*=i,c*=i):(o=0,s=0,c=0),f=S*c-F*s,g=F*o-T*c,b=T*s-S*o,i=Math.sqrt(f*f+g*g+b*b),i?(i=1/i,f*=i,g*=i,b*=i):(f=0,g=0,b=0),r[0]=o,r[1]=f,r[2]=T,r[3]=0,r[4]=s,r[5]=g,r[6]=S,r[7]=0,r[8]=c,r[9]=b,r[10]=F,r[11]=0,r[12]=-(o*k+s*U+c*j),r[13]=-(f*k+g*U+b*j),r[14]=-(T*k+S*U+F*j),r[15]=1,r)}function SG(){const r=new lc(4);return lc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function IG(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function Fx(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function MG(r){const e=r[0],t=r[1],n=r[2],i=r[3];return Math.sqrt(e*e+t*t+n*n+i*i)}function PG(r){const e=r[0],t=r[1],n=r[2],i=r[3];return e*e+t*t+n*n+i*i}function RG(r,e){const t=e[0],n=e[1],i=e[2],o=e[3];let s=t*t+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),r[0]=t*s,r[1]=n*s,r[2]=i*s,r[3]=o*s,r}function FG(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function DG(r,e,t,n){const i=e[0],o=e[1],s=e[2],c=e[3];return r[0]=i+n*(t[0]-i),r[1]=o+n*(t[1]-o),r[2]=s+n*(t[2]-s),r[3]=c+n*(t[3]-c),r}function bA(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*o+t[12]*s,r[1]=t[1]*n+t[5]*i+t[9]*o+t[13]*s,r[2]=t[2]*n+t[6]*i+t[10]*o+t[14]*s,r[3]=t[3]*n+t[7]*i+t[11]*o+t[15]*s,r}function OG(r,e,t){const n=e[0],i=e[1],o=e[2],s=t[0],c=t[1],f=t[2],g=t[3],b=g*n+c*o-f*i,T=g*i+f*n-s*o,S=g*o+s*i-c*n,F=-s*n-c*i-f*o;return r[0]=b*g+F*-s+T*-f-S*-c,r[1]=T*g+F*-c+S*-s-b*-f,r[2]=S*g+F*-f+b*-c-T*-s,r[3]=e[3],r}(function(){const r=SG();return function(e,t,n,i,o,s){let c,f;for(t||(t=4),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],r[2]=e[c+2],r[3]=e[c+3],o(r,r,s),e[c]=r[0],e[c+1]=r[1],e[c+2]=r[2],e[c+3]=r[3];return e}})();var Wb;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(Wb||(Wb={}));const LG=45*Math.PI/180,NG=1,Mv=.1,Pv=500,kG=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class dn extends rD{static get IDENTITY(){return zG()}static get ZERO(){return UG()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Wb}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,o,s,c,f,g,b,T,S,F,k,U,j){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=c,this[7]=f,this[8]=g,this[9]=b,this[10]=T,this[11]=S,this[12]=F,this[13]=k,this[14]=U,this[15]=j,this.check()}setRowMajor(e,t,n,i,o,s,c,f,g,b,T,S,F,k,U,j){return this[0]=e,this[1]=o,this[2]=g,this[3]=F,this[4]=t,this[5]=s,this[6]=b,this[7]=k,this[8]=n,this[9]=c,this[10]=T,this[11]=U,this[12]=i,this[13]=f,this[14]=S,this[15]=j,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(kG)}fromObject(e){return this.check()}fromQuaternion(e){return bG(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:o,near:s=Mv,far:c=Pv}=e;return c===1/0?GG(this,t,n,i,o,s):xG(this,t,n,i,o,s,c),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return BG(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:o,near:s=Mv,far:c=Pv}=e;return TG(this,t,n,i,o,s,c),this.check()}orthographic(e){const{fovy:t=LG,aspect:n=NG,focalDistance:i=1,near:o=Mv,far:s=Pv}=e;AB(t);const c=t/2,f=i*Math.tan(c),g=f*n;return this.ortho({left:-g,right:g,bottom:-f,top:f,near:o,far:s})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:o=500}=e;return AB(t),CG(this,t,n,i,o),this.check()}determinant(){return mG(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],o=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*o,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*o,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],o=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*o,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*o,e[8]=this[10]*s,e}transpose(){return gG(this,this),this.check()}invert(){return Jb(this,this),this.check()}multiplyLeft(e){return Jf(this,e,this),this.check()}multiplyRight(e){return Jf(this,this,e),this.check()}rotateX(e){return nD(this,this,e),this.check()}rotateY(e){return yG(this,this,e),this.check()}rotateZ(e){return iD(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return _G(this,this,e,t),this.check()}scale(e){return Rx(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Wm(this,this,e),this.check()}transform(e,t){return e.length===4?(t=bA(t||[-0,-0,-0,-0],e,this),Dp(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=WF(t||[-0,-0],e,this);break;case 3:i=Mx(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Dp(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=XF(t||[-0,-0],e,this);break;case 3:n=$F(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Dp(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let x0,w0;function UG(){return x0||(x0=new dn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(x0)),x0}function zG(){return w0||(w0=new dn,Object.freeze(w0)),w0}function AB(r){if(r>Math.PI*2)throw Error("expected radians")}function GG(r,e,t,n,i,o){const s=2*o/(t-e),c=2*o/(i-n),f=(t+e)/(t-e),g=(i+n)/(i-n),b=-1,T=-1,S=-2*o;return r[0]=s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=0,r[7]=0,r[8]=f,r[9]=g,r[10]=b,r[11]=T,r[12]=0,r[13]=0,r[14]=S,r[15]=0,r}function pB(){const r=new lc(4);return lc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function VG(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function sD(r,e,t){t=t*.5;const n=Math.sin(t);return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=Math.cos(t),r}function gB(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3],c=t[0],f=t[1],g=t[2],b=t[3];return r[0]=n*b+s*c+i*g-o*f,r[1]=i*b+s*f+o*c-n*g,r[2]=o*b+s*g+n*f-i*c,r[3]=s*b-n*c-i*f-o*g,r}function HG(r,e,t){t*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],c=Math.sin(t),f=Math.cos(t);return r[0]=n*f+s*c,r[1]=i*f+o*c,r[2]=o*f-i*c,r[3]=s*f-n*c,r}function jG(r,e,t){t*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],c=Math.sin(t),f=Math.cos(t);return r[0]=n*f-o*c,r[1]=i*f+s*c,r[2]=o*f+n*c,r[3]=s*f-i*c,r}function JG(r,e,t){t*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],c=Math.sin(t),f=Math.cos(t);return r[0]=n*f+i*c,r[1]=i*f-n*c,r[2]=o*f+s*c,r[3]=s*f-o*c,r}function WG(r,e){const t=e[0],n=e[1],i=e[2];return r[0]=t,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-t*t-n*n-i*i)),r}function pm(r,e,t,n){const i=e[0],o=e[1],s=e[2],c=e[3];let f=t[0],g=t[1],b=t[2],T=t[3],S,F,k,U,j;return S=i*f+o*g+s*b+c*T,S<0&&(S=-S,f=-f,g=-g,b=-b,T=-T),1-S>Op?(F=Math.acos(S),j=Math.sin(F),k=Math.sin((1-n)*F)/j,U=Math.sin(n*F)/j):(k=1-n,U=n),r[0]=k*i+U*f,r[1]=k*o+U*g,r[2]=k*s+U*b,r[3]=k*c+U*T,r}function XG(r,e){const t=e[0],n=e[1],i=e[2],o=e[3],s=t*t+n*n+i*i+o*o,c=s?1/s:0;return r[0]=-t*c,r[1]=-n*c,r[2]=-i*c,r[3]=o*c,r}function $G(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function oD(r,e){const t=e[0]+e[4]+e[8];let n;if(t>0)n=Math.sqrt(t+1),r[3]=.5*n,n=.5/n,r[0]=(e[5]-e[7])*n,r[1]=(e[6]-e[2])*n,r[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[o*3+o]-e[s*3+s]+1),r[i]=.5*n,n=.5/n,r[3]=(e[o*3+s]-e[s*3+o])*n,r[o]=(e[o*3+i]+e[i*3+o])*n,r[s]=(e[s*3+i]+e[i*3+s])*n}return r}const KG=IG,qG=Fx,ZG=FG,YG=DG,QG=MG,eV=PG,aD=RG,tV=function(){const r=qF(),e=fB(1,0,0),t=fB(0,1,0);return function(n,i,o){const s=Ix(i,o);return s<-.999999?(Am(r,e,i),tD(r)<1e-6&&Am(r,t,i),Q7(r,r),sD(n,r,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Am(r,i,o),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+s,aD(n,n))}}();(function(){const r=pB(),e=pB();return function(t,n,i,o,s,c){return pm(r,n,s,c),pm(e,i,o,c),pm(t,r,e,2*c*(1-c)),t}})();(function(){const r=sG();return function(e,t,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],aD(e,oD(e,r))}})();const rV=[0,0,0,1];class Yp extends Tx{constructor(e=0,t=0,n=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return oD(this,e),this.check()}fromAxisRotation(e,t){return sD(this,e,t),this.check()}identity(){return VG(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Hn(e)}get y(){return this[1]}set y(e){this[1]=Hn(e)}get z(){return this[2]}set z(e){this[2]=Hn(e)}get w(){return this[3]}set w(e){this[3]=Hn(e)}len(){return QG(this)}lengthSquared(){return eV(this)}dot(e){return ZG(this,e)}rotationTo(e,t){return tV(this,e,t),this.check()}add(e){return KG(this,this,e),this.check()}calculateW(){return WG(this,this),this.check()}conjugate(){return $G(this,this),this.check()}invert(){return XG(this,this),this.check()}lerp(e,t,n){return n===void 0?this.lerp(this,e,t):(YG(this,e,t,n),this.check())}multiplyRight(e){return gB(this,this,e),this.check()}multiplyLeft(e){return gB(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return HG(this,this,e),this.check()}rotateY(e){return jG(this,this,e),this.check()}rotateZ(e){return JG(this,this,e),this.check()}scale(e){return qG(this,this,e),this.check()}slerp(e,t,n){let i,o,s;switch(arguments.length){case 1:({start:i=rV,target:o,ratio:s}=e);break;case 2:i=this,o=e,s=t;break;default:i=e,o=t,s=n}return pm(this,i,o,s),this.check()}transformVector4(e,t=new Px){return OG(t,e,this),Dp(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const nV=.1,iV=1e-12,cD=1e-15,sV=1e-20,mB=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,oV={lightSources:{}};function Rv(r={}){const{color:e=[0,0,0],intensity:t=1}=r;return e.map(n=>n*t/255)}function aV({ambientLight:r,pointLights:e=[],directionalLights:t=[]}){const n={};return r?n["lighting_uAmbientLight.color"]=Rv(r):n["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((i,o)=>{n[`lighting_uPointLight[${o}].color`]=Rv(i),n[`lighting_uPointLight[${o}].position`]=i.position,n[`lighting_uPointLight[${o}].attenuation`]=i.attenuation||[1,0,0]}),n.lighting_uPointLightCount=e.length,t.forEach((i,o)=>{n[`lighting_uDirectionalLight[${o}].color`]=Rv(i),n[`lighting_uDirectionalLight[${o}].direction`]=i.direction}),n.lighting_uDirectionalLightCount=t.length,n}function lD(r=oV){var e,t;if("lightSources"in r){const{ambientLight:n,pointLights:i,directionalLights:o}=r.lightSources||{};return n||i&&i.length>0||o&&o.length>0?Object.assign({},aV({ambientLight:n,pointLights:i,directionalLights:o}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in r){const n={pointLights:[],directionalLights:[]};for(const i of r.lights||[])switch(i.type){case"ambient":n.ambientLight=i;break;case"directional":(e=n.directionalLights)==null||e.push(i);break;case"point":(t=n.pointLights)==null||t.push(i);break}return lD({lightSources:n})}return{}}const Dx={name:"lights",vs:mB,fs:mB,getUniforms:lD,defines:{MAX_LIGHTS:3}},uD=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,cV={};function lV(r){const{ambient:e=.35,diffuse:t=.6,shininess:n=32,specularColor:i=[30,30,30]}=r;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:n,lighting_uSpecularColor:i.map(o=>o/255)}}function fD(r=cV){if(!("material"in r))return{};const{material:e}=r;return e?lV(e):{lighting_uEnabled:!1}}const W_={name:"gouraud-lighting",dependencies:[Dx],vs:uD,defines:{LIGHTING_VERTEX:1},getUniforms:fD},hD={name:"phong-lighting",dependencies:[Dx],fs:uD,defines:{LIGHTING_FRAGMENT:1},getUniforms:fD},uV=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,fV=`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,Ox={name:"pbr",vs:uV,fs:fV,defines:{LIGHTING_FRAGMENT:1},dependencies:[Dx]},dD="#define SMOOTH_EDGE_RADIUS 0.5",hV=`
${dD}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,dV=`
${dD}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,AV={name:"geometry",vs:hV,fs:dV},Wr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Wr,"IDENTITY",{get:()=>(Ur.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const tc={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ia={common:0,meters:1,pixels:2},Xb={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},pV=Object.keys(Wr).map(r=>`const int COORDINATE_SYSTEM_${r} = ${Wr[r]};`).join(""),gV=Object.keys(tc).map(r=>`const int PROJECTION_MODE_${r} = ${tc[r]};`).join(""),mV=Object.keys(ia).map(r=>`const int UNIT_${r.toUpperCase()} = ${ia[r]};`).join(""),_V=`${pV}
${gV}
${mV}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function yV(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}return!1}function gg(r){let e={},t;return n=>{for(const i in n)if(!yV(n[i],e[i])){t=r(n),e=n;break}return t}}const _B=[0,0,0,0],vV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],AD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],bV=[0,0,0],pD=[0,0,0],xV=gg(EV);function gD(r,e,t=pD){t.length<3&&(t=[t[0],t[1],0]);let n=t,i,o=!0;switch(e===Wr.LNGLAT_OFFSETS||e===Wr.METER_OFFSETS?i=t:i=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case tc.WEB_MERCATOR:(e===Wr.LNGLAT||e===Wr.CARTESIAN)&&(i=[0,0,0],o=!1);break;case tc.WEB_MERCATOR_AUTO_OFFSET:e===Wr.LNGLAT?n=i:e===Wr.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],i=r.unprojectPosition(n),n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]);break;case tc.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case tc.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:o}}function wV(r,e,t){const{viewMatrixUncentered:n,projectionMatrix:i}=r;let{viewMatrix:o,viewProjectionMatrix:s}=r,c=_B,f=_B,g=r.cameraPosition;const{geospatialOrigin:b,shaderCoordinateOrigin:T,offsetMode:S}=gD(r,e,t);return S&&(f=r.projectPosition(b||T),g=[g[0]-f[0],g[1]-f[1],g[2]-f[2]],f[3]=1,c=bA([],f,s),o=n||o,s=Jf([],i,o),s=Jf([],s,vV)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:c,originCommon:f,cameraPosCommon:g,shaderCoordinateOrigin:T,geospatialOrigin:b}}function CV({viewport:r,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:n=Wr.DEFAULT,coordinateOrigin:i=pD,autoWrapLongitude:o=!1}){n===Wr.DEFAULT&&(n=r.isGeospatial?Wr.LNGLAT:Wr.CARTESIAN);const s=xV({viewport:r,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i});return s.project_uWrapLongitude=o,s.project_uModelMatrix=t||AD,s}function EV({viewport:r,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:n}){const{projectionCenter:i,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:g}=wV(r,t,n),b=r.getDistanceScales(),T=[r.width*e,r.height*e],S=bA([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,F={project_uCoordinateSystem:t,project_uProjectionMode:r.projectionMode,project_uCoordinateOrigin:f,project_uCommonOrigin:s.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!r._pseudoMeters,project_uViewportSize:T,project_uDevicePixelRatio:e,project_uFocalDistance:S,project_uCommonUnitsPerMeter:b.unitsPerMeter,project_uCommonUnitsPerWorldUnit:b.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:bV,project_uScale:r.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:o,project_uModelMatrix:AD,project_uCameraPosition:c};if(g){const k=r.getDistanceScales(g);switch(t){case Wr.METER_OFFSETS:F.project_uCommonUnitsPerWorldUnit=k.unitsPerMeter,F.project_uCommonUnitsPerWorldUnit2=k.unitsPerMeter2;break;case Wr.LNGLAT:case Wr.LNGLAT_OFFSETS:r._pseudoMeters||(F.project_uCommonUnitsPerMeter=k.unitsPerMeter),F.project_uCommonUnitsPerWorldUnit=k.unitsPerDegree,F.project_uCommonUnitsPerWorldUnit2=k.unitsPerDegree2;break;case Wr.CARTESIAN:F.project_uCommonUnitsPerWorldUnit=[1,1,k.unitsPerMeter[2]],F.project_uCommonUnitsPerWorldUnit2=[0,0,k.unitsPerMeter2[2]];break}}return F}const TV={};function BV(r=TV){return"viewport"in r?CV(r):{}}const Lx={name:"project",dependencies:[C7,AV],vs:_V,getUniforms:BV},SV=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,_o={name:"project32",dependencies:[Lx],vs:SV};function IV(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Jd(r,e){const t=bA([],e,r);return Fx(t,t,1/t[3]),t}function yB(r,e){const t=r%e;return t<0?e+t:t}function $b(r,e,t){return r<e?e:r>t?t:r}function MV(r){return Math.log(r)*Math.LOG2E}const Nx=Math.log2||MV;function kl(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const rc=Math.PI,mD=rc/4,Ia=rc/180,Kb=180/rc,oA=512,Xm=4003e4,vB=85.051129,PV=1.5;function RV(r){return Nx(r)}function Ul(r){const[e,t]=r;kl(Number.isFinite(e)),kl(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*Ia,i=t*Ia,o=oA*(n+rc)/(2*rc),s=oA*(rc+Math.log(Math.tan(mD+i*.5)))/(2*rc);return[o,s]}function Zc(r){const[e,t]=r,n=e/oA*(2*rc)-rc,i=2*(Math.atan(Math.exp(t/oA*(2*rc)-rc))-mD);return[n*Kb,i*Kb]}function FV(r){const{latitude:e}=r;kl(Number.isFinite(e));const t=Math.cos(e*Ia);return RV(Xm*t)-9}function Fv(r){const e=Math.cos(r*Ia);return oA/Xm/e}function qb(r){const{latitude:e,longitude:t,highPrecision:n=!1}=r;kl(Number.isFinite(e)&&Number.isFinite(t));const i=oA,o=Math.cos(e*Ia),s=i/360,c=s/o,f=i/Xm/o,g={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[s,c,f],degreesPerUnit:[1/s,1/c,1/f]};if(n){const b=Ia*Math.tan(e*Ia)/o,T=s*b/2,S=i/Xm*b,F=S/c*f;g.unitsPerDegree2=[0,T,S],g.unitsPerMeter2=[F,0,F]}return g}function _D(r,e){const[t,n,i]=r,[o,s,c]=e,{unitsPerMeter:f,unitsPerMeter2:g}=qb({longitude:t,latitude:n,highPrecision:!0}),b=Ul(r);b[0]+=o*(f[0]+g[0]*s),b[1]+=s*(f[1]+g[1]*s);const T=Zc(b),S=(i||0)+(c||0);return Number.isFinite(i)||Number.isFinite(c)?[T[0],T[1],S]:T}function DV(r){const{height:e,pitch:t,bearing:n,altitude:i,scale:o,center:s}=r,c=IV();Wm(c,c,[0,0,-i]),nD(c,c,-t*Ia),iD(c,c,n*Ia);const f=o/e;return Rx(c,c,[f,f,f]),s&&Wm(c,c,Y7([],s)),c}function OV(r){const{width:e,height:t,altitude:n,pitch:i=0,offset:o,center:s,scale:c,nearZMultiplier:f=1,farZMultiplier:g=1}=r;let{fovy:b=$m(PV)}=r;n!==void 0&&(b=$m(n));const T=b*Ia,S=i*Ia,F=yD(b);let k=F;s&&(k+=s[2]*c/Math.cos(S)/t);const U=T*(.5+(o?o[1]:0)/t),j=Math.sin(U)*k/Math.sin($b(Math.PI/2-S-U,.01,Math.PI-.01)),z=Math.sin(S)*j+k,V=k*10,K=Math.min(z*g,V);return{fov:T,aspect:e/t,focalDistance:F,near:f,far:K}}function $m(r){return 2*Math.atan(.5/r)*Kb}function yD(r){return .5/Math.tan(.5*r*Ia)}function vD(r,e){const[t,n,i=0]=r;return kl(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i)),Jd(e,[t,n,i,1])}function kx(r,e,t=0){const[n,i,o]=r;if(kl(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return Jd(e,[n,i,o,1]);const s=Jd(e,[n,i,0,1]),c=Jd(e,[n,i,1,1]),f=s[2],g=c[2],b=f===g?0:((t||0)-f)/(g-f);return jF([],s,c,b)}function LV(r){const{width:e,height:t,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=r,[[c,f],[g,b]]=n,T=NV(r.padding),S=Ul([c,$b(b,-85.051129,vB)]),F=Ul([g,$b(f,-85.051129,vB)]),k=[Math.max(Math.abs(F[0]-S[0]),i),Math.max(Math.abs(F[1]-S[1]),i)],U=[e-T.left-T.right-Math.abs(s[0])*2,t-T.top-T.bottom-Math.abs(s[1])*2];kl(U[0]>0&&U[1]>0);const j=U[0]/k[0],z=U[1]/k[1],V=(T.right-T.left)/2/j,K=(T.top-T.bottom)/2/z,fe=[(F[0]+S[0])/2+V,(F[1]+S[1])/2+K],Q=Zc(fe),oe=Math.min(o,Nx(Math.abs(Math.min(j,z))));return kl(Number.isFinite(oe)),{longitude:Q[0],latitude:Q[1],zoom:oe}}function NV(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(kl(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const bB=Math.PI/180;function kV(r,e=0){const{width:t,height:n,unproject:i}=r,o={targetZ:e},s=i([0,n],o),c=i([t,n],o);let f,g;const b=r.fovy?.5*r.fovy*bB:Math.atan(.5/r.altitude),T=(90-r.pitch)*bB;return b>T-.01?(f=xB(r,0,e),g=xB(r,t,e)):(f=i([0,0],o),g=i([t,0],o)),[s,c,g,f]}function xB(r,e,t){const{pixelUnprojectionMatrix:n}=r,i=Jd(n,[e,0,1,1]),o=Jd(n,[e,r.height,1,1]),c=(t*r.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),f=jF([],i,o,c),g=Zc(f);return g.push(t),g}const wB=512;function UV(r){const{width:e,height:t,pitch:n=0}=r;let{longitude:i,latitude:o,zoom:s,bearing:c=0}=r;(i<-180||i>180)&&(i=yB(i+180,360)-180),(c<-180||c>180)&&(c=yB(c+180,360)-180);const f=Nx(t/wB);if(s<=f)s=f,o=0;else{const g=t/2/Math.pow(2,s),b=Zc([0,g])[1];if(o<b)o=b;else{const T=Zc([0,wB-g])[1];o>T&&(o=T)}}return{width:e,height:t,longitude:i,latitude:o,zoom:s,pitch:n,bearing:c}}const zV=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,GV=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,VV=gg(XV),HV=gg($V),jV=[0,0,0,1],JV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function WV(r,e){const[t,n,i]=r,o=kx([t,n,i],e);return Number.isFinite(i)?o:[o[0],o[1],0]}function XV({viewport:r,center:e}){return new dn(r.viewProjectionMatrix).invert().transform(e)}function $V({viewport:r,shadowMatrices:e}){const t=[],n=r.pixelUnprojectionMatrix,i=r.isGeospatial?void 0:1,o=[[0,0,i],[r.width,0,i],[0,r.height,i],[r.width,r.height,i],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(s=>WV(s,n));for(const s of e){const c=s.clone().translate(new ft(r.center).negate()),f=o.map(b=>c.transform(b)),g=new dn().ortho({left:Math.min(...f.map(b=>b[0])),right:Math.max(...f.map(b=>b[0])),bottom:Math.min(...f.map(b=>b[1])),top:Math.max(...f.map(b=>b[1])),near:Math.min(...f.map(b=>-b[2])),far:Math.max(...f.map(b=>-b[2]))});t.push(g.multiplyRight(s))}return t}function KV(r,e){const{shadowEnabled:t=!0}=r;if(!t||!r.shadowMatrices||!r.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};const n={shadow_uDrawShadowMap:!!r.drawToShadowMap,shadow_uUseShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,shadow_uColor:r.shadowColor||jV,shadow_uLightId:r.shadowLightId||0,shadow_uLightCount:r.shadowMatrices.length},i=VV({viewport:r.viewport,center:e.project_uCenter}),o=[],s=HV({shadowMatrices:r.shadowMatrices,viewport:r.viewport}).slice();for(let c=0;c<r.shadowMatrices.length;c++){const f=s[c],g=f.clone().translate(new ft(r.viewport.center).negate());e.project_uCoordinateSystem===Wr.LNGLAT&&e.project_uProjectionMode===tc.WEB_MERCATOR?(s[c]=g,o[c]=i):(s[c]=f.clone().multiplyRight(JV),o[c]=g.transform(i))}for(let c=0;c<s.length;c++)n[`shadow_uViewProjectionMatrices[${c}]`]=s[c],n[`shadow_uProjectCenters[${c}]`]=o[c];for(let c=0;c<2;c++)n[`shadow_uShadowMap${c}`]=r.shadowMaps&&r.shadowMaps[c]||r.dummyShadowMap;return n}const CB={name:"shadow",dependencies:[Lx],vs:zV,fs:GV,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(r={},e={})=>"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?KV(r,e):{}},Fo={...lB,defaultUniforms:{...lB.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},qV=[Lx],ZV=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function bD(){const r=Nm.getDefaultShaderAssembler();for(const e of qV)r.addDefaultModule(e);for(const e of ZV)r.addShaderHook(e);return r}const YV=[255,255,255],QV=1;let eH=0;class tH{constructor(e={}){this.type="ambient";const{color:t=YV}=e,{intensity:n=QV}=e;this.id=e.id||`ambient-${eH++}`,this.color=t,this.intensity=n}}const rH=[255,255,255],nH=1,iH=[0,0,-1];let sH=0;class EB{constructor(e={}){this.type="directional";const{color:t=rH}=e,{intensity:n=nH}=e,{direction:i=iH}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${sH++}`,this.color=t,this.intensity=n,this.type="directional",this.direction=new ft(i).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class xD{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Ux extends xD{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,o=e.clearColor??(i?[0,0,0,0]:!1),s=i?1:!1,c=i?0:!1,f=e.colorMask??15,g={viewport:[0,0,t,n]};e.colorMask&&(g.colorMask=f),e.scissorRect&&(g.scissorRect=e.scissorRect);const b=this.device.beginRenderPass({framebuffer:e.target,parameters:g,clearColor:o,clearDepth:s,clearStencil:c});try{return this._drawLayers(b,e)}finally{b.end()}}_drawLayers(e,t){const{target:n,moduleParameters:i,viewports:o,views:s,onViewportActive:c,clearStack:f=!0}=t;t.pass=t.pass||"unknown",f&&(this._lastRenderIndex=-1);const g=[];for(const b of o){const T=s&&s[b.id];c==null||c(b);const S=this._getDrawLayerParams(b,t),F=b.subViewports||[b];for(const k of F){const U=this._drawLayersInViewport(e,{target:n,moduleParameters:i,viewport:k,view:T,pass:t.pass,layers:t.layers},S);g.push(U)}}return g}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:i=!1,layerFilter:o,cullRect:s,effects:c,moduleParameters:f},g=!1){var k;const b=[],T=wD(this._lastRenderIndex+1),S={layer:t[0],viewport:e,isPicking:i,renderPass:n,cullRect:s},F={};for(let U=0;U<t.length;U++){const j=t[U],z=this._shouldDrawLayer(j,S,o,F),V={shouldDrawLayer:z};z&&!g&&(V.layerRenderIndex=T(j,z),V.moduleParameters=this._getModuleParameters(j,c,n,f),V.layerParameters={...(k=j.context.deck)==null?void 0:k.props.parameters,...this.getLayerParameters(j,U,e)}),b[U]=V}return b}_drawLayersInViewport(e,{layers:t,moduleParameters:n,pass:i,target:o,viewport:s,view:c},f){const g=oH(this.device,{moduleParameters:n,target:o,viewport:s});if(c&&c.props.clear){const T=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:g},()=>this.device.clearWebGL(T))}const b={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:g});for(let T=0;T<t.length;T++){const S=t[T],{shouldDrawLayer:F,layerRenderIndex:k,moduleParameters:U,layerParameters:j}=f[T];if(F&&S.props.pickable&&b.pickableCount++,S.isComposite)b.compositeCount++;else if(F){b.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,k),U.viewport=s,S.context.renderPass=e;try{S._drawLayer({renderPass:e,moduleParameters:U,uniforms:{layerIndex:k},parameters:j})}catch(z){S.raiseError(z,`drawing ${S} to ${i}`)}}}return b}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let s=e.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(t))return!1;t.layer=s,s=s.parent}if(n){const c=t.layer.id;if(c in i||(i[c]=n(t)),!i[c])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,n,i){var c,f;const o=this.device.canvasContext.cssToDeviceRatio(),s=Object.assign(Object.create(((c=e.internalState)==null?void 0:c.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:o});if(t)for(const g of t)Object.assign(s,(f=g.getModuleParameters)==null?void 0:f.call(g,e));return Object.assign(s,this.getModuleParameters(e,t),i)}}function wD(r=0,e={}){const t={},n=(i,o)=>{const s=i.props._offset,c=i.id,f=i.parent&&i.parent.id;let g;if(f&&!(f in e)&&n(i.parent,!1),f in t){const b=t[f]=t[f]||wD(e[f],e);g=b(i,o),t[c]=b}else Number.isFinite(s)?(g=s+(e[f]||0),t[c]=null):g=r;return o&&g>=r&&(r=g+1),e[c]=g,g};return n}function oH(r,{moduleParameters:e,target:t,viewport:n}){const i=e&&e.devicePixelRatio||r.canvasContext.cssToDeviceRatio(),[,o]=r.canvasContext.getDrawingBufferSize(),s=t?t.height:o,c=n;return[c.x*i,s-(c.y+c.height)*i,c.width*i,c.height*i]}class aH extends Ux{constructor(e,t){super(e,t),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],o=i.width*n,s=i.height*n,c=[1,1,1,1];(o!==t.width||s!==t.height)&&t.resize({width:o,height:s}),super.render({...e,clearColor:c,target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const cH={color:[255,255,255],intensity:1},TB=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],lH=[0,0,0,200/255];class CD{constructor(e={}){this.id="lighting-effect",this.shadowColor=lH,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(CB),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:o,moduleParameters:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:e})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:e}))},t}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(CB))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=new dn().lookAt({eye:new ft(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new aH(e);this.shadowPasses[t]=n,this.shadowMaps[t]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;!e&&t.length===0&&n.length===0&&(this.ambientLight=new tH(cH),this.directionalLights.push(new EB(TB[0]),new EB(TB[1])))}}class uH{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:i,padding:o=0,copy:s=!1,initialize:c=!1,maxCount:f}){const g=i||e&&e.constructor||Float32Array,b=t*n+o;if(ArrayBuffer.isView(e)){if(b<=e.length)return e;if(b*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new g(e.buffer,0,b)}let T=1/0;f&&(T=f*n+o);const S=this._allocate(g,b,c,T);return e&&s?S.set(e):c||S.fill(0,0,4),this._release(e),S}release(e){this._release(e)}_allocate(e,t,n,i){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>i&&(o=i);const s=this._pool,c=e.BYTES_PER_ELEMENT*o,f=s.findIndex(g=>g.byteLength>=c);if(f>=0){const g=new e(s.splice(f,1)[0],0,o);return n&&g.fill(0),g}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,o=t.findIndex(s=>s.byteLength>=i);o<0?t.push(n):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,n),t.length>this.opts.poolSize&&t.shift()}}const aA=new uH;function Cp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fH(r){return[r[12],r[13],r[14]]}function hH(r){return{left:nd(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:nd(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:nd(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:nd(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:nd(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:nd(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const BB=new ft;function nd(r,e,t,n){BB.set(r,e,t);const i=BB.len();return{distance:n/i,normal:new ft(-r/i,-e/i,-t/i)}}function Ep(r){return r-Math.fround(r)}let cp;function Dv(r,e){const{size:t=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:r.length,o=(i-n)/t;cp=aA.allocate(cp,o,{type:Float32Array,size:t*2});let s=n,c=0;for(;s<i;){for(let f=0;f<t;f++){const g=r[s++];cp[c+f]=g,cp[c+f+t]=Ep(g)}c+=t*2}return cp.subarray(0,o*t*2)}function dH(r){let e=null,t=!1;for(const n of r)n&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const AH=Math.PI/180,pH=Cp(),SB=[0,0,0],gH={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function mH({width:r,height:e,orthographic:t,fovyRadians:n,focalDistance:i,padding:o,near:s,far:c}){const f=r/e,g=t?new dn().orthographic({fovy:n,aspect:f,focalDistance:i,near:s,far:c}):new dn().perspective({fovy:n,aspect:f,near:s,far:c});if(o){const{left:b=0,right:T=0,top:S=0,bottom:F=0}=o,k=Rl((b+r-T)/2,0,r)-r/2,U=Rl((S+e-F)/2,0,e)-e/2;g[8]-=k*2/r,g[9]+=U*2/e}return g}class xA{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||gH,this.focalDistance=e.focalDistance||1,this.position=e.position||SB,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?tc.WEB_MERCATOR:tc.WEB_MERCATOR_AUTO_OFFSET:tc.IDENTITY}equals(e){return e instanceof xA?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Sa(e.projectionMatrix,this.projectionMatrix)&&Sa(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const n=this.projectPosition(e),i=vD(n,this.pixelProjectionMatrix),[o,s]=i,c=t?s:this.height-s;return e.length===2?[o,c]:[o,c,i[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,o,s]=e,c=t?o:this.height-o,f=n&&n*this.distanceScales.unitsPerMeter[2],g=kx([i,c,s],this.pixelUnprojectionMatrix,f),[b,T,S]=this.unprojectPosition(g);return Number.isFinite(s)?[b,T,S]:Number.isFinite(n)?[b,T,n]:[b,T]}projectPosition(e){const[t,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,n,i]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,n,i]}projectFlat(e){if(this.isGeospatial){const t=Ul(e);return t[1]=Rl(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Zc(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],o[0],s[0]),Math.min(n[1],i[1],o[1],s[1]),Math.max(n[0],i[0],o[0],s[0]),Math.max(n[1],i[1],o[1],s[1])]}getDistanceScales(e){return e?qb({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,hH(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=FV({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||qb({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:o,modelMatrix:s}=e;let c=SB;if(o&&(c=s?new dn(s).transformAsVector(o,[]):o),this.isGeospatial){const f=this.projectPosition([t,n,0]);this.center=new ft(c).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(c)}_initMatrices(e){const{viewMatrix:t=pH,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:o,fovy:s=75,near:c=.1,far:f=1e3,padding:g=null,focalDistance:b=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new dn().multiplyRight(t).translate(new ft(this.center).negate()),this.projectionMatrix=n||mH({width:this.width,height:this.height,orthographic:i,fovyRadians:o||s*AH,focalDistance:b,padding:g,near:c,far:f});const T=Cp();Jf(T,T,this.projectionMatrix),Jf(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=Jb([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=fH(this.viewMatrixInverse);const S=Cp(),F=Cp();Rx(S,S,[this.width/2,-this.height/2,1]),Wm(S,S,[1,-1,0]),Jf(F,S,this.viewProjectionMatrix),this.pixelProjectionMatrix=F,this.pixelUnprojectionMatrix=Jb(Cp(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ur.warn("Pixel project matrix not invertible")()}}xA.displayName="Viewport";let Qp=class Zb extends xA{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:o=0,bearing:s=0,nearZMultiplier:c=.1,farZMultiplier:f=1.01,nearZ:g,farZ:b,orthographic:T=!1,projectionMatrix:S,repeat:F=!1,worldOffset:k=0,position:U,padding:j,legacyMeterSizes:z=!1}=e;let{width:V,height:K,altitude:fe=1.5}=e;const Q=Math.pow(2,i);V=V||1,K=K||1;let oe,Te=null;if(S)fe=S[5]/2,oe=$m(fe);else{e.fovy?(oe=e.fovy,fe=yD(oe)):oe=$m(fe);let Ae;if(j){const{top:_e=0,bottom:pe=0}=j;Ae=[0,Rl((_e+K-pe)/2,0,K)-K/2]}Te=OV({width:V,height:K,scale:Q,center:U&&[0,0,U[2]*Fv(t)],offset:Ae,pitch:o,fovy:oe,nearZMultiplier:c,farZMultiplier:f}),Number.isFinite(g)&&(Te.near=g),Number.isFinite(b)&&(Te.far=b)}let ze=DV({height:K,pitch:o,bearing:s,scale:Q,altitude:fe});k&&(ze=new dn().translate([512*k,0,0]).multiplyLeft(ze)),super({...e,width:V,height:K,viewMatrix:ze,longitude:n,latitude:t,zoom:i,...Te,fovy:oe,focalDistance:fe}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=o,this.bearing=s,this.altitude=fe,this.fovy=oe,this.orthographic=T,this._subViewports=F?[]:null,this._pseudoMeters=z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=t;i<=n;i++){const o=i?new Zb({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e),i=(e[2]||0)*Fv(e[1]);return[t,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e),i=(e[2]||0)/Fv(n);return[t,n,i]}addMetersToLngLat(e,t){return _D(e,t)}panByPosition(e,t){const n=kx(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),o=uB([],i,J7([],n)),s=uB([],this.center,o),[c,f]=this.unprojectFlat(s);return{longitude:c,latitude:f}}getBounds(e={}){const t=kV(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:o,latitude:s,zoom:c}=LV({width:n,height:i,bounds:e,...t});return new Zb({width:n,height:i,longitude:o,latitude:s,zoom:c})}};Qp.displayName="WebMercatorViewport";const IB=[0,0,0];function Ov(r,e,t=!1){const n=e.projectPosition(r);if(t&&e instanceof Qp){const[i,o,s=0]=r,c=e.getDistanceScales([i,o]);n[2]=s*c.unitsPerMeter[2]}return n}function _H(r){const{viewport:e,modelMatrix:t,coordinateOrigin:n}=r;let{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:s}=r;return i===Wr.DEFAULT&&(i=e.isGeospatial?Wr.LNGLAT:Wr.CARTESIAN),o===void 0&&(o=i),s===void 0&&(s=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:s}}function ED(r,{viewport:e,modelMatrix:t,coordinateSystem:n,coordinateOrigin:i,offsetMode:o}){let[s,c,f=0]=r;switch(t&&([s,c,f]=bA([],[s,c,f,1],t)),n){case Wr.LNGLAT:return Ov([s,c,f],e,o);case Wr.LNGLAT_OFFSETS:return Ov([s+i[0],c+i[1],f+(i[2]||0)],e,o);case Wr.METER_OFFSETS:return Ov(_D(i,[s,c,f]),e,o);case Wr.CARTESIAN:default:return e.isGeospatial?[s+i[0],c+i[1],f+i[2]]:e.projectPosition([s,c,f])}}function yH(r,e){const{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:c}=_H(e),{autoOffset:f=!0}=e,{geospatialOrigin:g=IB,shaderCoordinateOrigin:b=IB,offsetMode:T=!1}=f?gD(t,n,i):{},S=ED(r,{viewport:t,modelMatrix:o,coordinateSystem:s,coordinateOrigin:c,offsetMode:T});if(T){const F=t.projectPosition(g||b);eD(S,S,F)}return S}let vH=1,bH=1;class TD{constructor(){J(this,"time",0);J(this,"channels",new Map);J(this,"animations",new Map);J(this,"playing",!1);J(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=e,s=vH++,c={time:0,delay:t,duration:n,rate:i,repeat:o};return this._setChannelTime(c,this.time),this.channels.set(s,c),s}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:o,channel:s}=i;o.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=bH++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}let xH=0;const wH={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:r=>console.error(r),stats:Hd.stats.get(`animation-loop-${xH++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class CH{constructor(e){J(this,"device",null);J(this,"canvas",null);J(this,"props");J(this,"animationProps",null);J(this,"timeline",null);J(this,"stats");J(this,"cpuTime");J(this,"gpuTime");J(this,"frameRate");J(this,"display");J(this,"needsRedraw","initialized");J(this,"_initialized",!1);J(this,"_running",!1);J(this,"_animationFrameId",null);J(this,"_nextFramePromise",null);J(this,"_resolveNextFrame",null);J(this,"_cpuStartTime",0);if(this.props={...wH,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new vA({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=Nz(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(kz(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,t;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(t=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:t.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var o,s,c,f;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((s=(o=this.device)==null?void 0:o.canvasContext)==null?void 0:s.getPixelSize())||[1,1];let n=1;const i=(f=(c=this.device)==null?void 0:c.canvasContext)==null?void 0:f.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class MB{constructor(e){J(this,"id");J(this,"userData",{});J(this,"topology");J(this,"bufferLayout",[]);J(this,"vertexCount");J(this,"indices");J(this,"attributes");this.id=e.id||Vl("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&jn(this.indices.usage===$i.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function EH(r,e){if(e instanceof MB)return e;const t=TH(r,e),{attributes:n,bufferLayout:i}=BH(r,e);return new MB({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:n})}function TH(r,e){if(!e.indices)return;const t=e.indices.value;return r.createBuffer({usage:$i.INDEX,data:t})}function BH(r,e){const t=[],n={};for(const[o,s]of Object.entries(e.attributes)){let c=o;switch(o){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}n[c]=r.createBuffer({data:s.value,id:`${o}-buffer`});const{value:f,size:g,normalized:b}=s;t.push({name:c,format:Rz(f,g,b)})}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:t,vertexCount:i}}class SH{constructor(e){J(this,"modules");J(this,"moduleUniforms");J(this,"moduleBindings");J(this,"moduleUniformsChanged");const t=H_(Object.values(e).filter(n=>n.dependencies));for(const n of t)e[n.name]=n;Zt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[n,i]of Object.entries(e)){const o=n;this.moduleUniforms[o]=i.defaultUniforms||{},this.moduleBindings[o]={}}}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const i=n,o=e[i],s=this.modules[i];if(!s){Zt.warn(`Module ${n} not found`)();continue}const c=this.moduleUniforms[i],f=this.moduleBindings[i],g=((t=s.getUniforms)==null?void 0:t.call(s,o,c))||o,{uniforms:b,bindings:T}=Cx(g);this.moduleUniforms[i]={...c,...b},this.moduleBindings[i]={...f,...T}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[o,s]of Object.entries(i))e[`${n}.${o}`]={type:(t=this.modules[n].uniformTypes)==null?void 0:t[o],value:String(s)};return e}}const N_=class N_{constructor(e){J(this,"device");J(this,"_hashCounter",0);J(this,"_hashes",{});J(this,"_renderPipelineCache",{});J(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new N_(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...iA.defaultProps,...e},n=this._hashRenderPipeline(t);if(!this._renderPipelineCache[n]){const i=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=n,this._renderPipelineCache[n]={pipeline:i,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const t={...Hm.defaultProps,...e},n=this._hashComputePipeline(t);if(!this._computePipelineCache[n]){const i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=n,this._computePipelineCache[n]={pipeline:i,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const t=e.hash,n=e instanceof Hm?this._computePipelineCache:this._renderPipelineCache;n[t].useCount--,n[t].useCount===0&&(n[t].pipeline.destroy(),delete n[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=this._getHash(e.vs.source),n=e.fs?this._getHash(e.fs.source):0,i="-",o=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${n}V${i}BL${o}`;default:const s=this._getHash(JSON.stringify(e.parameters));return`${t}/${n}V${i}T${e.topology}P${s}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};J(N_,"defaultProps",{...iA.defaultProps});let Yb=N_;const k_=class k_{constructor(e){J(this,"device");J(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new k_(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n&&(n.useCount--,n.useCount===0&&(delete this._cache[t],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};J(k_,"defaultProps",{...zm.defaultProps});let Qb=k_;function IH(r,e){var i;const t={},n="Values";if(r.attributes.length===0&&!((i=r.varyings)!=null&&i.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const o of r.attributes)if(o){const s=`${o.location} ${o.name}: ${o.type}`;t[`in ${s}`]={[n]:o.stepMode||"vertex"}}for(const o of r.varyings||[]){const s=`${o.location} ${o.name}`;t[`out ${s}`]={[n]:JSON.stringify(o.accessor)}}return t}let Cs=null,Lv=null;function MH(r,{id:e,minimap:t,opaque:n,top:i="0",left:o="0",rgbaScale:s=1}){Cs||(Cs=document.createElement("canvas"),Cs.id=e,Cs.title=e,Cs.style.zIndex="100",Cs.style.position="absolute",Cs.style.top=i,Cs.style.left=o,Cs.style.border="blue 1px solid",Cs.style.transform="scaleY(-1)",document.body.appendChild(Cs),Lv=Cs.getContext("2d")),(Cs.width!==r.width||Cs.height!==r.height)&&(Cs.width=r.width/2,Cs.height=r.height/2,Cs.style.width="400px",Cs.style.height="400px");const c=r.device.readPixelsToArrayWebGL(r),f=Lv.createImageData(r.width,r.height),g=0;for(let b=0;b<c.length;b+=4)f.data[g+b+0]=c[b+0]*s,f.data[g+b+1]=c[b+1]*s,f.data[g+b+2]=c[b+2]*s,f.data[g+b+3]=n?255:c[b+3]*s;Lv.putImageData(f,0,0)}const id=2,PH=1e4,U_=class U_{constructor(e,t){J(this,"device");J(this,"id");J(this,"source");J(this,"vs");J(this,"fs");J(this,"pipelineFactory");J(this,"shaderFactory");J(this,"userData",{});J(this,"parameters");J(this,"topology");J(this,"bufferLayout");J(this,"isInstanced");J(this,"instanceCount",0);J(this,"vertexCount");J(this,"indexBuffer",null);J(this,"bufferAttributes",{});J(this,"constantAttributes",{});J(this,"bindings",{});J(this,"uniforms",{});J(this,"vertexArray");J(this,"transformFeedback",null);J(this,"pipeline");J(this,"shaderInputs");J(this,"_uniformStore");J(this,"_attributeInfos",{});J(this,"_gpuGeometry",null);J(this,"_getModuleUniforms");J(this,"props");J(this,"_pipelineNeedsUpdate","newly created");J(this,"_needsRedraw","initializing");J(this,"_destroyed",!1);J(this,"_lastDrawTimestamp",-1);J(this,"_lastLogTime",0);J(this,"_logOpen",!1);J(this,"_drawCount",0);var c,f,g,b;this.props={...U_.defaultProps,...t},t=this.props,this.id=t.id||Vl("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(((c=this.props.modules)==null?void 0:c.map(T=>[T.name,T]))||[]);this.setShaderInputs(t.shaderInputs||new SH(n));const i=RH(e),o=(((f=this.props.modules)==null?void 0:f.length)>0?this.props.modules:(g=this.shaderInputs)==null?void 0:g.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(b=this.props).shaderLayout||(b.shaderLayout=b7(this.props.source));const{source:T,getUniforms:S}=this.props.shaderAssembler.assembleShader({platformInfo:i,...this.props,modules:o});this.source=T,this._getModuleUniforms=S}else{const{vs:T,fs:S,getUniforms:F}=this.props.shaderAssembler.assembleShaderPair({platformInfo:i,...this.props,modules:o});this.vs=T,this.fs=S,this._getModuleUniforms=F}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Yb.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Qb.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniforms(t.uniforms),t.moduleSettings&&this.updateModuleSettings(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let t;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),km(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:n}=this.vertexArray,i=n?n.byteLength/(n.indexType==="uint32"?4:2):void 0;t=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),t?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",t}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const t=e&&EH(this.device,e);t&&(this.setTopology(t.topology||"triangle-list"),this.bufferLayout=PB(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)),this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?PB(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){zb(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Pz(this.shaderInputs.modules);for(const t of Object.keys(this.shaderInputs.modules)){const n=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){e.indices&&Zt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[n,i]of Object.entries(e)){const o=this.bufferLayout.find(f=>RB(f).includes(n));if(!o){Zt.warn(`Model(${this.id}): Missing layout for buffer "${n}".`)();continue}const s=RB(o);let c=!1;for(const f of s){const g=this._attributeInfos[f];g&&(this.vertexArray.setBuffer(g.location,i),c=!0)}!c&&!((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)&&Zt.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${n}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,i):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||Zt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){km(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:t,uniforms:n}=Cx(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Um?e=Math.max(e,t.texture.updateTimestamp):t instanceof $i||t instanceof ea?e=Math.max(e,t.updateTimestamp):t instanceof Gm||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Zt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:n,fs:i}),this._attributeInfos=MF(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=Zt.level>3?0:PH;Zt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Zt.group(id,`>>> DRAWING MODEL ${this.id}`,{collapsed:Zt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=IH(this.pipeline.shaderLayout,this.id);Zt.table(id,e)();const t=this.shaderInputs.getDebugTable();for(const[i,o]of Object.entries(this.uniforms))t[i]={value:o};Zt.table(id,t)();const n=this._getAttributeDebugTable();Zt.table(id,this._attributeInfos)(),Zt.table(id,n)(),Zt.groupEnd(id)(),this._logOpen=!1}}_logFramebuffer(e){const t=Zt.get("framebuffer");if(this._drawCount++,!t||this._drawCount++>3&&this._drawCount%60)return;const n=e.props.framebuffer;n&&MH(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos))e[n.location]={name:t,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=FF(t);return(e instanceof $i?new n(e.debugData):e).toString()}};J(U_,"defaultProps",{...iA.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Nm.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let mi=U_;function PB(r,e){const t=[...r];for(const n of e){const i=t.findIndex(o=>o.name===n.name);i<0?t.push(n):t[i]=n}return t}function RH(r){return{type:r.type,shaderLanguage:r.info.shadingLanguage,shaderLanguageVersion:r.info.shadingLanguageVersion,gpu:r.info.gpu,features:r.features}}function RB(r){var e;return r.attributes?(e=r.attributes)==null?void 0:e.map(t=>t.attribute):[r.name]}class eg{constructor(e,t=mi.defaultProps){J(this,"device");J(this,"model");J(this,"transformFeedback");jn(eg.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new mi(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||CF(),topology:t.topology||"point-list",...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(t instanceof $i)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:o=n.byteLength}=t;return n.readAsync(i,o)}}const FH="transform_output";class e2{constructor(e,t){J(this,"device");J(this,"model");J(this,"sampler");J(this,"currentIndex",0);J(this,"samplerTextureMap",null);J(this,"bindings",[]);J(this,"resources",{});this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new mi(this.device,{id:t.id||"texture-transform-model",fs:t.fs||CF({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:FH}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(n),n.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getData({packed:e=!1}={}){throw new Error("getData() not implemented")}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:n,targetTexture:i}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,t),i){e.targetTexture=i;const{width:o,height:s}=i;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:s,colorAttachments:[i]}),e.framebuffer.resize({width:o,height:s})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const n in t)t[n].sampler=this.sampler}}class Ts{constructor(e){J(this,"id");J(this,"topology");J(this,"vertexCount");J(this,"indices");J(this,"attributes");J(this,"userData",{});const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||Vl("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[o,s]of Object.entries(t)){const c=ArrayBuffer.isView(s)?{value:s}:s;jn(ArrayBuffer.isView(c.value),`${this._print(o)}: must be typed array or object with value as typed array`),(o==="POSITION"||o==="positions")&&!c.size&&(c.size=3),o==="indices"?(jn(!this.indices),this.indices=c):this.attributes[o]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:o,size:s,constant:c}=i;!c&&o&&s>=1&&(n=Math.min(n,o.length/s))}return jn(Number.isFinite(n)),n}}const DH=`#version 300 es
in vec2 aClipSpacePosition;
in vec2 aTexCoord;
in vec2 aCoordinate;
out vec2 position;
out vec2 coordinate;
out vec2 uv;
void main(void) {
gl_Position = vec4(aClipSpacePosition, 0., 1.);
position = aClipSpacePosition;
coordinate = aCoordinate;
uv = aTexCoord;
}
`,FB=[-1,-1,1,-1,-1,1,1,1];class OH extends mi{constructor(e,t){const n=FB.map(i=>i===-1?0:i);super(e,{...t,vs:DH,vertexCount:4,geometry:new Ts({topology:"triangle-strip",vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(FB)},aTexCoord:{size:2,value:new Float32Array(n)},aCoordinate:{size:2,value:new Float32Array(n)}}})})}}class Km{constructor(e={}){J(this,"id");J(this,"matrix",new dn);J(this,"display",!0);J(this,"position",new ft);J(this,"rotation",new ft);J(this,"scale",new ft(1,1,1));J(this,"userData",{});J(this,"props",{});const{id:t}=e;this.id=t||Vl(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return jn(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return jn(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return jn(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:t,rotation:n,scale:i,update:o=!0}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(n),this}update(e={}){const{position:t,rotation:n,scale:i}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,t){jn(e),t=t||this.matrix;const n=new dn(e).multiplyRight(t),i=n.invert(),o=i.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Wd extends Km{constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:n=[]}=t;Zt.assert(n.every(i=>i instanceof Km),"every child must an instance of ScenegraphNode");super(t);J(this,"children");this.children=n}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,{worldMatrix:i})=>{const o=n.getBounds();if(!o)return;const[s,c]=o,f=new ft(s).add(c).divide([2,2,2]);i.transformAsPoint(f,f);const g=new ft(c).subtract(s).divide([2,2,2]);i.transformAsVector(g,g);for(let b=0;b<8;b++){const T=new ft(b&1?-1:1,b&2?-1:1,b&4?-1:1).multiply(g).add(f);for(let S=0;S<3;S++)t[0][S]=Math.min(t[0][S],T[S]),t[1][S]=Math.max(t[1][S],T[S])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(const n of t)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(t){const n=this.children,i=n.indexOf(t);return i>-1&&n.splice(i,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:n=new dn}={}){const i=new dn(n).multiplyRight(this.matrix);for(const o of this.children)o instanceof Wd?o.traverse(t,{worldMatrix:i}):t(o,{worldMatrix:i})}}class t2 extends Km{constructor(t){super(t);J(this,"model");J(this,"bounds",null);J(this,"managedResources");this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}draw(t){return this.model.draw(t)}}class BD extends Ts{constructor(e={}){const{id:t=Vl("cube-geometry"),indices:n=!0}=e;super(n?{...e,id:t,topology:"triangle-list",indices:{size:1,value:LH},attributes:{...HH,...e.attributes}}:{...e,id:t,topology:"triangle-list",indices:void 0,attributes:{...jH,...e.attributes}})}}const LH=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),NH=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),kH=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),UH=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),zH=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),GH=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),VH=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),HH={POSITION:{size:3,value:NH},NORMAL:{size:3,value:kH},TEXCOORD_0:{size:2,value:UH}},jH={POSITION:{size:3,value:zH},TEXCOORD_0:{size:2,value:GH},COLOR_0:{size:3,value:VH}};class JH extends xD{constructor(e,t){super(e,t);const{module:n,fs:i,id:o}=t,s={depthWriteEnabled:!1,depthCompare:"always"};this.model=new OH(e,{id:o,fs:i,modules:[n],parameters:s})}render(e){this._renderPass(this.device,e)}delete(){this.model.destroy(),this.model=null}_renderPass(e,t){const{clearCanvas:n,inputBuffer:i,outputBuffer:o}=t,s=[i.width,i.height];this.model.shaderInputs.setProps(t.moduleSettings),this.model.setBindings({texSrc:i.colorAttachments[0]}),this.model.setUniforms({texSize:s});const c=this.device.beginRenderPass({framebuffer:o,parameters:{viewport:[0,0,...s]},clearColor:n?[0,0,0,0]:!1,clearDepth:1});this.model.draw(c),c.end()}}class WH{constructor(e,t){this.id=`${e.name}-pass`,this.props=t,PU(e),this.module=e}setup({device:e}){this.passes=XH(e,this.module,this.id)}setProps(e){this.props=e}preRender(){}postRender(e){const t=this.passes,{target:n}=e;let i=e.inputBuffer,o=e.swapBuffer;for(let s=0;s<t.length;s++){const c=s===t.length-1,f=n!==void 0&&c;f&&(o=n);const g=!f||!!e.clearCanvas,b={},T=this.module.passes[s].uniforms;b[this.module.name]={...this.props,...T},t[s].render({clearCanvas:g,inputBuffer:i,outputBuffer:o,moduleSettings:b});const S=o;o=i,i=S}return i}cleanup(){if(this.passes){for(const e of this.passes)e.delete();this.passes=void 0}}}function XH(r,e,t){return e.passes.map((n,i)=>{const o=qH(e,n),s=`${t}-${i}`;return new JH(r,{id:s,module:e,fs:o})})}const SD=`#version 300 es
uniform sampler2D texSrc;
uniform vec2 texSize;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,$H=r=>`${SD}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${r}(fragColor, texSize, coordinate);
}
`,KH=r=>`${SD}
void main() {
  fragColor = ${r}(texSrc, texSize, coordinate);
}
`;function qH(r,e){if(e.filter){const t=typeof e.filter=="string"?e.filter:`${r.name}_filterColor`;return $H(t)}if(e.sampler){const t=typeof e.sampler=="string"?e.sampler:`${r.name}_sampleColor`;return KH(t)}return""}const ZH={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class ID extends Ux{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:o,pickingFBO:s,deviceRect:{x:c,y:f,width:g,height:b},cullRect:T,effects:S,pass:F="picking",pickZ:k,moduleParameters:U}){this.pickZ=k;const j=this._resetColorEncoder(k),z=[c,f,g,b],V=super.render({target:s,layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:o,cullRect:T,effects:S==null?void 0:S.filter(fe=>fe.useInPicking),pass:F,isPicking:!0,moduleParameters:U,clearColor:[0,0,0,0],colorMask:15,scissorRect:z});return this._colorEncoderState=null,{decodePickingColor:j&&QH.bind(null,j),stats:V}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,t,n){const i={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:o,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?i.blend=!1:o&&s.includes("draw")&&(Object.assign(i,ZH),i.blend=!0,i.blendColor=YH(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function YH(r,e,t){const{byLayer:n,byAlpha:i}=r;let o,s=n.get(e);return s?(s.viewports.push(t),o=s.a):(o=n.size+1,o<=255?(s={a:o,layer:e,viewports:[t]},n.set(e,s),i[o]=s):(Ur.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function QH(r,e){const t=r.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Ed={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},qm=Symbol.for("component"),Lu=Symbol.for("propTypes"),Nv=Symbol.for("deprecatedProps"),Xd=Symbol.for("asyncPropDefaults"),$f=Symbol.for("asyncPropOriginal"),Ru=Symbol.for("asyncPropResolved");function X_(r,e=()=>!0){return Array.isArray(r)?MD(r,e,[]):e(r)?[r]:[]}function MD(r,e,t){let n=-1;for(;++n<r.length;){const i=r[n];Array.isArray(i)?MD(i,e,t):e(i)&&t.push(i)}return t}function ej({target:r,source:e,start:t=0,count:n=1}){const i=e.length,o=n*i;let s=0;for(let c=t;s<i;s++)r[c++]=e[s];for(;s<o;)s<o-s?(r.copyWithin(t+s,t,t+s),s*=2):(r.copyWithin(t+s,t,t+o-s),s=o);return r}class tj{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=Nl(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class rj{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:i=!0}){let o=this._resources[e];o?o.setData(t,n):(o=new tj(e,t,this._context),this._resources[e]=o),o.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const n in t){const i=t[n],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:i="default"}){const{_resources:o,protocol:s}=this;e.startsWith(s)&&(e=e.replace(s,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const c=o[e];if(this._track(n,i,c,t),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const o=this._consumers,s=o[e]=o[e]||{};let c=s[t];const f=c&&c.resourceId&&this._resources[c.resourceId];f&&(f.unsubscribe(c),this.prune()),n&&(c?(c.onChange=i,c.resourceId=n.id):c={onChange:i,resourceId:n.id},s[t]=c,n.subscribe(c))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const nj="layerManager.setLayers",ij="layerManager.activateViewport";class sj{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{to(ij,this,c),c&&(this.context.viewport=c)};const{deck:n,stats:i,viewport:o,timeline:s}=t||{};this.layers=[],this.resourceManager=new rj({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:bD(),defaultShaderModules:[],renderPass:void 0,stats:i||new vA({id:"deck.gl"}),viewport:o||new xA({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new TD,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(n=>t.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){to(nj,this,t,e),this._lastRenderedLayers=e;const n=X_(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(n=>n.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(i=>i.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const s of e)n[s.id]?Ur.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(const s of e)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let o=!1;for(const s of i)if(s.hasUniformTransition()){o=`Uniform transition in ${s}`;break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const o=t[i.id];o===null&&Ur.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let s=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),s=i.isComposite?i.getSubLayers():null}catch(c){this._handleError("matching",c,i)}s&&this._updateSublayersRecursively(s,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ed.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Ed.MATCHED,t!==e&&(e.lifecycle=Ed.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Ed.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ed.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function io(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!io(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!io(r[o],e[o],t-1))return!1;return!0}return!1}class oj{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let o=n.length-1;o>=0;--o){const s=n[o];if(s.containsPixel(i)){const c=e.slice();return c[0]-=s.x,c[1]-=s.y,s.unproject(c,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=X_(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!io(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Ur.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=t.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var s;return(s=this.getView(e.id))==null?void 0:s.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,t,n,i){const o=e.controller;if(o&&n){const s={...t,...o,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==o.type)&&(i=this._createController(e,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const o=e[i],s=this.getViewState(o),c=o.makeViewport({viewState:s,width:this.width,height:this.height});let f=t[o.id];const g=!!o.controller;g&&!f&&(n=!0),(n||!g)&&f&&(f.finalize(),f=null),this.controllers[o.id]=this._updateController(o,s,c,f),c&&this._viewports.unshift(c)}for(const i in t){const o=t[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((n,i)=>!e[i].equals(t[i]))}}const aj=/([0-9]+\.?[0-9]*)(%|px)/;function bu(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const e=aj.exec(r);if(e&&e.length>=3){const t=e[2]==="%",n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error(`Could not parse position string ${r}`)}}function xu(r,e){return r.relative?Math.round(r.position*e):r.position}class cA{constructor(e){const{id:t,x:n=0,y:i=0,width:o="100%",height:s="100%",padding:c=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=bu(n),this._y=bu(i),this._width=bu(o),this._height=bu(s),this._padding=c&&{left:bu(c.left||0),right:bu(c.right||0),top:bu(c.top||0),bottom:bu(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&io(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t});return!i.height||!i.width?null:new this.ViewportType({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const n in this.props.viewState)n!=="id"&&(t[n]=this.props.viewState[n]);return t}return e}getDimensions({width:e,height:t}){const n={x:xu(this._x,e),y:xu(this._y,t),width:xu(this._width,e),height:xu(this._height,t)};return this._padding&&(n.padding={left:xu(this._padding.left,e),top:xu(this._padding.top,t),right:xu(this._padding.right,e),bottom:xu(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class $_{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(t=this.settings).onStart)==null||n.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:i}=this;this._handle=n.addChannel({delay:n.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const DB=()=>{},r2={BREAK:1,SNAP_TO_END:2,IGNORE:3},cj=r=>r,lj=r2.BREAK;let uj=class{constructor(e){this._onTransitionUpdate=t=>{const{time:n,settings:{interpolator:i,startProps:o,endProps:s,duration:c,easing:f}}=t,g=f(n/c),b=i.interpolateProps(o,s,g);this.propsInTransition=this.getControllerState({...this.props,...b}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new $_(e.timeline),this.onViewStateChange=e.onViewStateChange||DB,this.onStateChange=e.onStateChange||DB}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:o,endProps:s}=this.transition.settings;i={...n,...o===r2.SNAP_TO_END?s:this.propsInTransition||n}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||t==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===r2.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),o=t.transitionInterpolator,s=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(s===0)return;const c=o.initializeProps(e,i);this.propsInTransition={};const f={duration:s,easing:t.transitionEasing||cj,interpolator:o,interruption:t.transitionInterruption||lj,startProps:c.start,endProps:c.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}};function zs(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}let fj=class{constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!Sa(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const o of this._propsToExtract)(o in e||o in t)&&(n[o]=e[o],i[o]=t[o]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];zs(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}};const hj=["longitude","latitude","zoom","bearing","pitch"],dj=["longitude","latitude","zoom"];let PD=class extends fj{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:hj,required:dj},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:o}=this.opts;if(i&&o){const s=i(e),c=i(t),f=s.unproject(o);n.start.around=o,Object.assign(n.end,{around:c.project(f),aroundPosition:f,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const o of this._propsToExtract)i[o]=ac(e[o]||0,t[o]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...i});Object.assign(i,o.panByPosition(t.aroundPosition,ac(e.around,t.around,n)))}return i}};const wu={transitionDuration:0},Aj=300,C0=r=>1-(1-r)*(1-r),sd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Bf={};class pj{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new uj({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?Aj:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:s=!0,touchZoom:c=!0,touchRotate:f=!1,keyboard:g=!0}=e,b=!!this.onViewStateChange;this.toggleEvents(sd.WHEEL,b&&n),this.toggleEvents(sd.PAN,b),this.toggleEvents(sd.PINCH,b&&(c||f)),this.toggleEvents(sd.TRIPLE_PAN,b&&f),this.toggleEvents(sd.DOUBLE_TAP,b&&s),this.toggleEvents(sd.KEYBOARD,b&&g),this.scrollZoom=n,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=s,this.touchZoom=c,this.touchRotate=f,this.keyboard=g}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(n=>{this._events[n]!==t&&(this._events[n]=t,t?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,t=null,n={}){const i={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),o){const s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,wu,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,wu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:C0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,wu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:C0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let s=2/(1+Math.exp(-Math.abs(o*n)));o<0&&s!==0&&(s=1/s);const c=this.controllerState.zoom({pos:t,scale:s});return this.updateViewport(c,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,wu,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,wu,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:C0},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Bf._startPinchRotation=e.rotation,Bf._lastPinchEvent=e,this.updateViewport(n,wu,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:Bf._startPinchRotation-n})}return this.updateViewport(t,wu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Bf._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=Bf;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let o=this.controllerState.rotateEnd();const s=Math.log2(e.scale),c=(s-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),f=Math.pow(2,s+c*t/2);o=o.zoom({pos:i,scale:f}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:C0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Bf._startPinchRotation=null,Bf._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let f;const g={};switch(e.srcEvent.code){case"Minus":f=t?c.zoomOut(n).zoomOut(n):c.zoomOut(n),g.isZooming=!0;break;case"Equal":f=t?c.zoomIn(n).zoomIn(n):c.zoomIn(n),g.isZooming=!0;break;case"ArrowLeft":t?(f=c.rotateLeft(o),g.isRotating=!0):(f=c.moveLeft(i),g.isPanning=!0);break;case"ArrowRight":t?(f=c.rotateRight(o),g.isRotating=!0):(f=c.moveRight(i),g.isPanning=!0);break;case"ArrowUp":t?(f=c.rotateUp(s),g.isRotating=!0):(f=c.moveUp(i),g.isPanning=!0);break;case"ArrowDown":t?(f=c.rotateDown(s),g.isRotating=!0):(f=c.moveDown(i),g.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),g),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?wu:e?{...t,transitionInterpolator:new PD({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class gj{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const OB=5,mj=1.2;let _j=class extends gj{constructor(e){const{width:t,height:n,latitude:i,longitude:o,zoom:s,bearing:c=0,pitch:f=0,altitude:g=1.5,position:b=[0,0,0],maxZoom:T=20,minZoom:S=0,maxPitch:F=60,minPitch:k=0,startPanLngLat:U,startZoomLngLat:j,startRotatePos:z,startBearing:V,startPitch:K,startZoom:fe,normalize:Q=!0}=e;zs(Number.isFinite(o)),zs(Number.isFinite(i)),zs(Number.isFinite(s)),super({width:t,height:n,latitude:i,longitude:o,zoom:s,bearing:c,pitch:f,altitude:g,maxZoom:T,minZoom:S,maxPitch:F,minPitch:k,normalize:Q,position:b},{startPanLngLat:U,startZoomLngLat:j,startRotatePos:z,startBearing:V,startPitch:K,startZoom:fe}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:o,startPitch:s}=this.getState();if(!i||o===void 0||s===void 0)return this;let c;return e?c=this._getNewRotation(e,i,s,o):c={bearing:o+t,pitch:s+n},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(t)||this._unproject(e)),!o)return this;const{maxZoom:s,minZoom:c}=this.getViewportProps();let f=i+Math.log2(n);f=Rl(f,c,s);const g=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...g.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:o}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(o-t.longitude)>180&&(n.longitude=o<0?o+360:o-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Rl(i,n,t);const{maxPitch:o,minPitch:s,pitch:c}=e;e.pitch=Rl(c,s,o);const{normalize:f=!0}=e;return f&&Object.assign(e,UV(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const o=e[0]-t[0],s=e[1]-t[1],c=e[1],f=t[1],{width:g,height:b}=this.getViewportProps(),T=o/g;let S=0;s>0?Math.abs(b-f)>OB&&(S=s/(f-b)*mj):s<0&&f>OB&&(S=1-c/f),S=Rl(S,-1,1);const{minPitch:F,maxPitch:k}=this.getViewportProps(),U=i+180*T;let j=n;return S>0?j=n+S*(k-n):S<0&&(j=n-S*(F-n)),{pitch:j,bearing:U}}},yj=class extends pj{constructor(){super(...arguments),this.ControllerState=_j,this.transition={transitionDuration:300,transitionInterpolator:new PD({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};class RD extends cA{constructor(e={}){super(e)}get ViewportType(){return Qp}get ControllerType(){return yj}}RD.displayName="MapView";const vj=new CD;function bj(r,e){const t=r.order??1/0,n=e.order??1/0;return t-n}class xj{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(n=>n.id===e.id)){const n=t.findIndex(i=>bj(i,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(io(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const n=[];for(const i of e){const o=t[i.id];let s=i;o&&o!==i?o.setProps?(o.setProps(i.props),s=o):o.cleanup(this._context):o||i.setup(this._context),n.push(s),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof CD)||this._resolvedEffects.push(vj),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class wj extends Ux{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const Cj="deckRenderer.renderLayers";class Ej{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new wj(e),this.pickLayersPass=new ID(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const o=t.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,to(Cj,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[i]}))});for(const n of e)n.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const o of e)if(o.postRender){i.target=o.id===this.lastPostProcessEffect?t.target:void 0;const s=o.postRender(i);i.inputBuffer=s,i.swapBuffer=s===n[0]?n[1]:n[0]}}}const Tj={pickedColor:null,pickedObjectIndex:-1};function Bj({pickedColors:r,decodePickingColor:e,deviceX:t,deviceY:n,deviceRadius:i,deviceRect:o}){const{x:s,y:c,width:f,height:g}=o;let b=i*i,T=-1,S=0;for(let F=0;F<g;F++){const k=F+c-n,U=k*k;if(U>b)S+=4*f;else for(let j=0;j<f;j++){if(r[S+3]-1>=0){const V=j+s-t,K=V*V+U;K<=b&&(b=K,T=S)}S+=4}}if(T>=0){const F=r.slice(T,T+4),k=e(F);if(k){const U=Math.floor(T/4/f),j=T/4-U*f;return{...k,pickedColor:F,pickedX:s+j,pickedY:c+U}}Ur.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Tj}function Sj({pickedColors:r,decodePickingColor:e}){const t=new Map;if(r){for(let n=0;n<r.length;n+=4)if(r[n+3]-1>=0){const o=r.slice(n,n+4),s=o.join(",");if(!t.has(s)){const c=e(o);c?t.set(s,{...c,color:o}):Ur.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function FD({pickInfo:r,viewports:e,pixelRatio:t,x:n,y:i,z:o}){let s=e[0];e.length>1&&(s=Mj((r==null?void 0:r.pickedViewports)||e,{x:n,y:i}));let c;if(s){const f=[n-s.x,i-s.y];o!==void 0&&(f[2]=o),c=s.unproject(f)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:c,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:t}}function Ij(r){const{pickInfo:e,lastPickedInfo:t,mode:n,layers:i}=r,{pickedColor:o,pickedLayer:s,pickedObjectIndex:c}=e,f=s?[s]:[];if(n==="hover"){const T=t.index,S=t.layerId,F=s?s.props.id:null;if(F!==S||c!==T){if(F!==S){const k=i.find(U=>U.props.id===S);k&&f.unshift(k)}t.layerId=F,t.index=c,t.info=null}}const g=FD(r),b=new Map;return b.set(null,g),f.forEach(T=>{let S={...g};T===s&&(S.color=o,S.index=c,S.picked=!0),S=DD({layer:T,info:S,mode:n});const F=S.layer;T===s&&n==="hover"&&(t.info=S),b.set(F.id,S),n==="hover"&&F.updateAutoHighlight(S)}),b}function DD({layer:r,info:e,mode:t}){for(;r&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=r,e=r.getPickingInfo({info:e,mode:t,sourceLayer:n}),r=r.parent}return e}function Mj(r,e){for(let t=r.length-1;t>=0;t--){const n=r[t];if(n.containsPixel(e))return n}return r[0]}class Pj{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new ID(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:i},o=this.lastPickedInfo.info){const s=o&&o.layer&&o.layer.id,c=o&&o.viewport&&o.viewport.id,f=s?n.find(S=>S.id===s):null,g=c&&i.find(S=>S.id===c)||i[0],b=g&&g.unproject([e-g.x,t-g.y]);return{...o,...{x:e,y:t,viewport:g,coordinate:b,layer:f}}}_resizeBuffer(){var t,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:n,x:i,y:o,radius:s=0,depth:c=1,mode:f="query",unproject3D:g,onViewportActive:b,effects:T}){const S=this.device.canvasContext.cssToDeviceRatio(),F=this._getPickable(e);if(!F||n.length===0)return{result:[],emptyInfo:FD({viewports:n,x:i,y:o,pixelRatio:S})};this._resizeBuffer();const k=this.device.canvasContext.cssToDevicePixels([i,o],!0),U=[k.x+Math.floor(k.width/2),k.y+Math.floor(k.height/2)],j=Math.round(s*S),{width:z,height:V}=this.pickingFBO,K=this._getPickingRect({deviceX:U[0],deviceY:U[1],deviceRadius:j,deviceWidth:z,deviceHeight:V}),fe={x:i-s,y:o-s,width:s*2+1,height:s*2+1};let Q;const oe=[],Te=new Set;for(let ze=0;ze<c;ze++){let Ae;if(K){const pe=this._drawAndSample({layers:F,views:t,viewports:n,onViewportActive:b,deviceRect:K,cullRect:fe,effects:T,pass:`picking:${f}`});Ae=Bj({...pe,deviceX:U[0],deviceY:U[1],deviceRadius:j,deviceRect:K})}else Ae={pickedColor:null,pickedObjectIndex:-1};let _e;if(Ae.pickedLayer&&g&&this.depthFBO){const{pickedColors:pe}=this._drawAndSample({layers:[Ae.pickedLayer],views:t,viewports:n,onViewportActive:b,deviceRect:{x:Ae.pickedX,y:Ae.pickedY,width:1,height:1},cullRect:fe,effects:T,pass:`picking:${f}:z`},!0);pe[3]&&(_e=pe[0])}Ae.pickedLayer&&ze+1<c&&(Te.add(Ae.pickedLayer),Ae.pickedLayer.disablePickingIndex(Ae.pickedObjectIndex)),Q=Ij({pickInfo:Ae,lastPickedInfo:this.lastPickedInfo,mode:f,layers:F,viewports:n,x:i,y:o,z:_e,pixelRatio:S});for(const pe of Q.values())pe.layer&&oe.push(pe);if(!Ae.pickedColor)break}for(const ze of Te)ze.restorePickingColors();return{result:oe,emptyInfo:Q.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:n,x:i,y:o,width:s=1,height:c=1,mode:f="query",maxObjects:g=null,onViewportActive:b,effects:T}){const S=this._getPickable(e);if(!S||n.length===0)return[];this._resizeBuffer();const F=this.device.canvasContext.cssToDeviceRatio(),k=this.device.canvasContext.cssToDevicePixels([i,o],!0),U=k.x,j=k.y+k.height,z=this.device.canvasContext.cssToDevicePixels([i+s,o+c],!0),V=z.x+z.width,K=z.y,fe={x:U,y:K,width:V-U,height:j-K},Q=this._drawAndSample({layers:S,views:t,viewports:n,onViewportActive:b,deviceRect:fe,cullRect:{x:i,y:o,width:s,height:c},effects:T,pass:`picking:${f}`}),oe=Sj(Q),Te=new Map,ze=[],Ae=Number.isFinite(g);for(let _e=0;_e<oe.length&&!(Ae&&ze.length>=g);_e++){const pe=oe[_e];let X={color:pe.pickedColor,layer:null,index:pe.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:F};X=DD({layer:pe.pickedLayer,info:X,mode:f});const ne=X.layer.id;Te.has(ne)||Te.set(ne,new Set);const Be=Te.get(ne),Ze=X.object??X.index;Be.has(Ze)||(Be.add(Ze),ze.push(X))}return ze}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:o,cullRect:s,effects:c,pass:f},g=!1){const b=g?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:b,deviceRect:o,cullRect:s,effects:c,pass:f,pickZ:g,preRenderStats:{}};for(const V of c)V.useInPicking&&(T.preRenderStats[V.id]=V.preRender(T));const{decodePickingColor:S}=this.pickLayersPass.render(T),{x:F,y:k,width:U,height:j}=o,z=new(g?Float32Array:Uint8Array)(U*j*4);return this.device.readPixelsToArrayWebGL(b,{sourceX:F,sourceY:k,sourceWidth:U,sourceHeight:j,target:z}),{pickedColors:z,decodePickingColor:S}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:o}){const s=Math.max(0,e-n),c=Math.max(0,t-n),f=Math.min(i,e+n+1)-s,g=Math.min(o,t+n+1)-c;return f<=0||g<=0?null:{x:s,y:c,width:f,height:g}}}const Rj={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Fj="top-left",LB="__root";class Dj{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!io(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=t[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._remove(i),this._add(n)):n!==i&&(i.setProps(n.props),n=i):this._add(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const i=t[n];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:t=null,placement:n=Fj}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,n).append(i),e._element=i}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var s;const n=e||LB;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(s=this.parentElement)==null||s.append(i),this.containers[n]=i);let o=i.querySelector(`.${t}`);return o||(o=document.createElement("div"),o.className=t,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,Rj[t]),i.append(o)),o}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,o=n===LB||i,s=this.containers[n];o?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:e}px`,s.style.height=`${i?i.height:t}px`):s.style.display="none"}}onRedraw({viewports:e,layers:t}){var o,s;const n=e.reduce((c,f)=>(c[f.id]=f,c),{}),{lastViewports:i}=this;for(const c of this.getWidgets()){const{viewId:f}=c;if(f){const g=n[f];g&&(c.onViewportChange&&!g.equals(i[f])&&c.onViewportChange(g),(o=c.onRedraw)==null||o.call(c,{viewports:[g],layers:t}))}else{if(c.onViewportChange)for(const g of e)g.equals(i[g.id])||c.onViewportChange(g);(s=c.onRedraw)==null||s.call(c,{viewports:e,layers:t})}}this.lastViewports=n,this._updateContainers()}onHover(e,t){var n,i;for(const o of this.getWidgets()){const{viewId:s}=o;(!s||s===((n=e.viewport)==null?void 0:n.id))&&((i=o.onHover)==null||i.call(o,e,t))}}onEvent(e,t){var i,o;const n=Xb[t.type];if(n)for(const s of this.getWidgets()){const{viewId:c}=s;(!c||c===((i=e.viewport)==null?void 0:i.id))&&((o=s[n.handler])==null||o.call(s,e,t))}}}const Oj={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Lj{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,Oj),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var Pd;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.R16_EXT=33322]="R16_EXT",r[r.RG16_EXT=33324]="RG16_EXT",r[r.RGB16_EXT=32852]="RGB16_EXT",r[r.RGBA16_EXT=32859]="RGBA16_EXT",r[r.R16_SNORM_EXT=36760]="R16_SNORM_EXT",r[r.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",r[r.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",r[r.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",r[r.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",r[r.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",r[r.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",r[r.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",r[r.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",r[r.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",r[r.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",r[r.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",r[r.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",r[r.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",r[r.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",r[r.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",r[r.LINE_WEBGL=6913]="LINE_WEBGL",r[r.FILL_WEBGL=6914]="FILL_WEBGL",r[r.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",r[r.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",r[r.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",r[r.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",r[r.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",r[r.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",r[r.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",r[r.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",r[r.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",r[r.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",r[r.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",r[r.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",r[r.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",r[r.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",r[r.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",r[r.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",r[r.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",r[r.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",r[r.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",r[r.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",r[r.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",r[r.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",r[r.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",r[r.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Pd||(Pd={}));const zx={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},is=(r,e,t)=>e?r.enable(t):r.disable(t),NB=(r,e,t)=>r.hint(t,e),qo=(r,e,t)=>r.pixelStorei(t,e),kB=(r,e,t)=>{const n=t===36006?36009:36008;return r.bindFramebuffer(n,e)},lp=(r,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];r.bindBuffer(i,e)};function kv(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}const Nj={3042:is,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:is,2885:(r,e)=>r.cullFace(e),2929:is,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:is,35723:NB,35725:(r,e)=>r.useProgram(e),36007:(r,e)=>r.bindRenderbuffer(36161,e),36389:(r,e)=>{var t;return(t=r.bindTransformFeedback)==null?void 0:t.call(r,36386,e)},34229:(r,e)=>r.bindVertexArray(e),36006:kB,36010:kB,34964:lp,36662:lp,36663:lp,35053:lp,35055:lp,2886:(r,e)=>r.frontFace(e),33170:NB,2849:(r,e)=>r.lineWidth(e),32823:is,32824:"polygonOffset",10752:"polygonOffset",35977:is,32926:is,32928:is,32938:"sampleCoverage",32939:"sampleCoverage",3089:is,3088:(r,e)=>r.scissor(...e),2960:is,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),34383:is,10754:is,12288:is,12289:is,12290:is,12291:is,12292:is,12293:is,12294:is,12295:is,3333:qo,3317:qo,37440:qo,37441:qo,37443:qo,3330:qo,3332:qo,3331:qo,3314:qo,32878:qo,3316:qo,3315:qo,32877:qo,framebuffer:(r,e)=>{const t=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,t)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{const t=typeof e=="number"?[e,e]:e;r.blendEquationSeparate(...t)},blendFunc:(r,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;r.blendFuncSeparate(...t)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(...e),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=kv(e)?e:[e,e];const[t,n]=e;r.stencilMaskSeparate(1028,t),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,e)=>{e=kv(e)&&e.length===3?[...e,...e]:e;const[t,n,i,o,s,c]=e;r.stencilFuncSeparate(1028,t,n,i),r.stencilFuncSeparate(1029,o,s,c)},stencilOp:(r,e)=>{e=kv(e)&&e.length===3?[...e,...e]:e;const[t,n,i,o,s,c]=e;r.stencilOpSeparate(1028,t,n,i),r.stencilOpSeparate(1029,o,s,c)},viewport:(r,e)=>r.viewport(...e)};function Wi(r,e,t){return e[r]!==void 0?e[r]:t[r]}const kj={blendEquation:(r,e,t)=>r.blendEquationSeparate(Wi(32777,e,t),Wi(34877,e,t)),blendFunc:(r,e,t)=>r.blendFuncSeparate(Wi(32969,e,t),Wi(32968,e,t),Wi(32971,e,t),Wi(32970,e,t)),polygonOffset:(r,e,t)=>r.polygonOffset(Wi(32824,e,t),Wi(10752,e,t)),sampleCoverage:(r,e,t)=>r.sampleCoverage(Wi(32938,e,t),Wi(32939,e,t)),stencilFuncFront:(r,e,t)=>r.stencilFuncSeparate(1028,Wi(2962,e,t),Wi(2967,e,t),Wi(2963,e,t)),stencilFuncBack:(r,e,t)=>r.stencilFuncSeparate(1029,Wi(34816,e,t),Wi(36003,e,t),Wi(36004,e,t)),stencilOpFront:(r,e,t)=>r.stencilOpSeparate(1028,Wi(2964,e,t),Wi(2965,e,t),Wi(2966,e,t)),stencilOpBack:(r,e,t)=>r.stencilOpSeparate(1029,Wi(34817,e,t),Wi(34818,e,t),Wi(34819,e,t))},UB={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,t)=>r({[e]:t}),hint:(r,e,t)=>r({[e]:t}),useProgram:(r,e)=>r({35725:e}),bindRenderbuffer:(r,e,t)=>r({36007:t}),bindTransformFeedback:(r,e,t)=>r({36389:t}),bindVertexArray:(r,e)=>r({34229:e}),bindFramebuffer:(r,e,t)=>{switch(e){case 36160:return r({36006:t,36010:t});case 36009:return r({36006:t});case 36008:return r({36010:t});default:return null}},bindBuffer:(r,e,t)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?r({[n]:t}):{valueChanged:!0}},blendColor:(r,e,t,n,i)=>r({32773:new Float32Array([e,t,n,i])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,t)=>r({32777:e,34877:t}),blendFunc:(r,e,t)=>r({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(r,e,t,n,i)=>r({32969:e,32968:t,32971:n,32970:i}),clearColor:(r,e,t,n,i)=>r({3106:new Float32Array([e,t,n,i])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,t,n,i)=>r({3107:[e,t,n,i]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,t)=>r({2928:new Float32Array([e,t])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,t)=>r({32824:e,10752:t}),sampleCoverage:(r,e,t)=>r({32938:e,32939:t}),scissor:(r,e,t,n,i)=>r({3088:new Int32Array([e,t,n,i])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,t)=>r({[e===1028?2968:36005]:t}),stencilFunc:(r,e,t,n)=>r({2962:e,2967:t,2963:n,34816:e,36003:t,36004:n}),stencilFuncSeparate:(r,e,t,n,i)=>r({[e===1028?2962:34816]:t,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(r,e,t,n)=>r({2964:e,2965:t,2966:n,34817:e,34818:t,34819:n}),stencilOpSeparate:(r,e,t,n,i)=>r({[e===1028?2964:34817]:t,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(r,e,t,n,i)=>r({2978:[e,t,n,i]})},Nc=(r,e)=>r.isEnabled(e),zB={3042:Nc,2884:Nc,2929:Nc,3024:Nc,32823:Nc,32926:Nc,32928:Nc,3089:Nc,2960:Nc,35977:Nc},Uj=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function wA(r,e){if(Gj(e))return;const t={};for(const i in e){const o=Number(i),s=Nj[i];s&&(typeof s=="string"?t[s]=!0:s(r,e[i],o))}const n=r.state&&r.state.cache;if(n)for(const i in t){const o=kj[i];o(r,e,n)}}function OD(r,e=zx){if(typeof e=="number"){const i=e,o=zB[i];return o?o(r,i):r.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),n={};for(const i of t){const o=zB[i];n[i]=o?o(r,Number(i)):r.getParameter(Number(i))}return n}function zj(r){wA(r,zx)}function Gj(r){for(const e in r)return!1;return!0}function Vj(r,e){if(r===e)return!0;const t=Array.isArray(r)||ArrayBuffer.isView(r),n=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&n&&r.length===e.length){for(let i=0;i<r.length;++i)if(r[i]!==e[i])return!1;return!0}return!1}class Hj{constructor(e,{copyState:t=!1,log:n=()=>{}}={}){J(this,"gl");J(this,"program",null);J(this,"stateStack",[]);J(this,"enable",!0);J(this,"cache");J(this,"log");this.gl=e,this.cache=t?OD(e):Object.assign({},zx),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){jn(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];wA(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in e){jn(o!==void 0);const s=e[o],c=this.cache[o];Vj(s,c)||(t=!0,n=c,i&&!(o in i)&&(i[o]=c),this.cache[o]=s)}return{valueChanged:t,oldValue:n}}}function Kf(r){return r.state}function LD(r,e){const{enable:t=!0,copyState:n}=e;if(jn(n!==void 0),!r.state){r.state=new Hj(r,{copyState:n}),Jj(r);for(const o in UB){const s=UB[o];jj(r,o,s)}GB(r,"getParameter"),GB(r,"isEnabled")}const i=Kf(r);return i.enable=t,r}function K_(r){let e=Kf(r);e||(LD(r,{copyState:!1}),e=Kf(r)),e.push()}function tg(r){const e=Kf(r);jn(e),e.pop()}function GB(r,e){const t=r[e].bind(r);r[e]=function(i){if(i===void 0||Uj.has(i))return t(i);const o=Kf(r);return i in o.cache||(o.cache[i]=t(i)),o.enable?o.cache[i]:t(i)},Object.defineProperty(r[e],"name",{value:`${e}-from-cache`,configurable:!1})}function jj(r,e,t){if(!r[e])return;const n=r[e].bind(r);r[e]=function(...o){const s=Kf(r),{valueChanged:c,oldValue:f}=t(s._updateCache,...o);return c&&n(...o),f},Object.defineProperty(r[e],"name",{value:`${e}-to-cache`,configurable:!1})}function Jj(r){const e=r.useProgram.bind(r);r.useProgram=function(n){const i=Kf(r);i.program!==n&&(e(n),i.program=n)}}const Wj={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function Xj(r,e){e={...Wj,...e};let t=null;const n=o=>t=o.statusMessage||t;r.addEventListener("webglcontextcreationerror",n,!1);let i=null;if(i||(i=r.getContext("webgl2",e)),r.removeEventListener("webglcontextcreationerror",n,!1),!i)throw new Error(`Failed to create WebGL context: ${t||"Unknown error"}`);if(e.onContextLost){const{onContextLost:o}=e;r.addEventListener("webglcontextlost",s=>o(s),!1)}if(e.onContextRestored){const{onContextRestored:o}=e;r.addEventListener("webglcontextrestored",s=>o(s),!1)}return i}function zu(r,e,t){return t[e]===void 0&&(t[e]=r.getExtension(e)||null),t[e]}function $j(r,e){const t=r.getParameter(7936),n=r.getParameter(7937);zu(r,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,o=r.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),s=r.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),c=o||t,f=s||n,g=r.getParameter(7938),b=ND(c,f),T=Kj(c,f),S=qj(c,f);return{type:"webgl",gpu:b,gpuType:S,gpuBackend:T,vendor:c,renderer:f,version:g,shadingLanguage:"glsl",shadingLanguageVersion:300}}function ND(r,e){return/NVIDIA/i.exec(r)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(r)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(r)||/Apple/i.exec(e)?"apple":/AMD/i.exec(r)||/AMD/i.exec(e)||/ATI/i.exec(r)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e)?"software":"unknown"}function Kj(r,e){return/Metal/i.exec(r)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(e)?"opengl":"unknown"}function qj(r,e){if(/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e))return"cpu";switch(ND(r,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function kD(r){switch(r){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(r))}const Ys="texture-compression-bc",ai="texture-compression-astc",kc="texture-compression-etc2",Zj="texture-compression-etc1-webgl",E0="texture-compression-pvrtc-webgl",Uv="texture-compression-atc-webgl",up="float32-renderable-webgl",zv="float16-renderable-webgl",Yj="rgb9e5ufloat_renderable-webgl",Gv="snorm8-renderable-webgl",fp="norm16-renderable-webgl",Vv="snorm16-renderable-webgl",T0="float32-filterable",VB="float16-filterable-webgl",Tp="WEBGL_compressed_texture_s3tc",Bp="WEBGL_compressed_texture_s3tc_srgb",Rd="EXT_texture_compression_rgtc",Fd="EXT_texture_compression_bptc",Qj="WEBGL_compressed_texture_etc",eJ="WEBGL_compressed_texture_astc",tJ="WEBGL_compressed_texture_etc1",rJ="WEBGL_compressed_texture_pvrtc",nJ="WEBGL_compressed_texture_atc",HB="EXT_texture_norm16",jB="EXT_render_snorm",iJ="EXT_color_buffer_float",Gx={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[jB],"norm16-renderable-webgl":[HB],"snorm16-renderable-webgl":[HB,jB],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Tp,Bp,Rd,Fd],"texture-compression-bc5-webgl":[Rd],"texture-compression-bc7-webgl":[Fd],"texture-compression-etc2":[Qj],"texture-compression-astc":[eJ],"texture-compression-etc1-webgl":[tJ],"texture-compression-pvrtc-webgl":[rJ],"texture-compression-atc-webgl":[nJ]};function sJ(r){return r in Gx}function oJ(r,e,t){return(Gx[e]||[]).every(i=>zu(r,i,t))}const q_={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:Gv},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:Gv},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:zv,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:fp,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:Vv},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:Gv},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:zv,filter:VB,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:fp},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:Vv},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:up,filter:T0},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:Yj},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:up,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:fp},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:fp},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:up,filter:T0,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:zv,filter:VB},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:fp,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:Vv},"rgb32float-webgl":{gl:34837,render:up,filter:T0,gl2ext:iJ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:up,filter:T0,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Tp,f:Ys},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Bp,f:Ys},"bc1-rgba-unorm":{gl:33777,x:Tp,f:Ys},"bc1-rgba-unorm-srgb":{gl:35916,x:Bp,f:Ys},"bc2-rgba-unorm":{gl:33778,x:Tp,f:Ys},"bc2-rgba-unorm-srgb":{gl:35918,x:Bp,f:Ys},"bc3-rgba-unorm":{gl:33779,x:Tp,f:Ys},"bc3-rgba-unorm-srgb":{gl:35919,x:Bp,f:Ys},"bc4-r-unorm":{gl:36283,x:Rd,f:Ys},"bc4-r-snorm":{gl:36284,x:Rd,f:Ys},"bc5-rg-unorm":{gl:36285,x:Rd,f:Ys},"bc5-rg-snorm":{gl:36286,x:Rd,f:Ys},"bc6h-rgb-ufloat":{gl:36495,x:Fd,f:Ys},"bc6h-rgb-float":{gl:36494,x:Fd,f:Ys},"bc7-rgba-unorm":{gl:36492,x:Fd,f:Ys},"bc7-rgba-unorm-srgb":{gl:36493,x:Fd,f:Ys},"etc2-rgb8unorm":{gl:37492,f:kc},"etc2-rgb8unorm-srgb":{gl:37494,f:kc},"etc2-rgb8a1unorm":{gl:37496,f:kc},"etc2-rgb8a1unorm-srgb":{gl:37497,f:kc},"etc2-rgba8unorm":{gl:37493,f:kc},"etc2-rgba8unorm-srgb":{gl:37495,f:kc},"eac-r11unorm":{gl:37488,f:kc},"eac-r11snorm":{gl:37489,f:kc},"eac-rg11unorm":{gl:37490,f:kc},"eac-rg11snorm":{gl:37491,f:kc},"astc-4x4-unorm":{gl:37808,f:ai},"astc-4x4-unorm-srgb":{gl:37840,f:ai},"astc-5x4-unorm":{gl:37809,f:ai},"astc-5x4-unorm-srgb":{gl:37841,f:ai},"astc-5x5-unorm":{gl:37810,f:ai},"astc-5x5-unorm-srgb":{gl:37842,f:ai},"astc-6x5-unorm":{gl:37811,f:ai},"astc-6x5-unorm-srgb":{gl:37843,f:ai},"astc-6x6-unorm":{gl:37812,f:ai},"astc-6x6-unorm-srgb":{gl:37844,f:ai},"astc-8x5-unorm":{gl:37813,f:ai},"astc-8x5-unorm-srgb":{gl:37845,f:ai},"astc-8x6-unorm":{gl:37814,f:ai},"astc-8x6-unorm-srgb":{gl:37846,f:ai},"astc-8x8-unorm":{gl:37815,f:ai},"astc-8x8-unorm-srgb":{gl:37847,f:ai},"astc-10x5-unorm":{gl:37819,f:ai},"astc-10x5-unorm-srgb":{gl:37851,f:ai},"astc-10x6-unorm":{gl:37817,f:ai},"astc-10x6-unorm-srgb":{gl:37849,f:ai},"astc-10x8-unorm":{gl:37818,f:ai},"astc-10x8-unorm-srgb":{gl:37850,f:ai},"astc-10x10-unorm":{gl:37819,f:ai},"astc-10x10-unorm-srgb":{gl:37851,f:ai},"astc-12x10-unorm":{gl:37820,f:ai},"astc-12x10-unorm-srgb":{gl:37852,f:ai},"astc-12x12-unorm":{gl:37821,f:ai},"astc-12x12-unorm-srgb":{gl:37853,f:ai},"pvrtc-rgb4unorm-webgl":{gl:35840,f:E0},"pvrtc-rgba4unorm-webgl":{gl:35842,f:E0},"pvrtc-rbg2unorm-webgl":{gl:35841,f:E0},"pvrtc-rgba2unorm-webgl":{gl:35843,f:E0},"etc1-rbg-unorm-webgl":{gl:36196,f:Zj},"atc-rgb-unorm-webgl":{gl:35986,f:Uv},"atc-rgba-unorm-webgl":{gl:35986,f:Uv},"atc-rgbai-unorm-webgl":{gl:34798,f:Uv}},aJ={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},cJ={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Vx(r,e,t){const n=q_[e];if(!n||n.gl===void 0)return!1;const i=n.x||n.gl2ext;return i?!!zu(r,i,t):!0}function UD(r){const e=q_[r],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${r}`);return t}function lJ(r,e,t){if(!Vx(r,e,t)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(TF(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!zu(r,"OES_texture_float_linear, extensions",t):e.endsWith("16float")?!!zu(r,"OES_texture_half_float_linear, extensions",t):!0}function uJ(r,e,t){return!(!Vx(r,e,t)||typeof e=="number")}function Zm(r){var i;const e=q_[r],t=UD(r),n=TF(r);return{format:t,dataFormat:(e==null?void 0:e.dataFormat)||hJ(n.format,n.integer,n.normalized,t),type:n.dataType?kD(n.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:n.compressed}}function fJ(r){const e=q_[r];if(!(e!=null&&e.attachment))throw new Error(`${r} is not a depth stencil format`);return e.attachment}function JB(r){const e=Zm(r),t=aJ[e.dataFormat]||4,n=cJ[e.type]||1;return t*n}function hJ(r,e,t,n){if(n===6408||n===6407)return n;switch(r){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;default:return 6408}}const WB={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class dJ extends KU{constructor(t,n,i){super([],i);J(this,"gl");J(this,"extensions");J(this,"testedFeatures",new Set);this.gl=t,this.extensions=n,zu(t,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const t=this.getFeatures();for(const n of t)this.has(n)&&(yield n);return[]}has(t){return this.disabledFeatures[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),sJ(t)&&oJ(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of t)this.has(n)}getFeatures(){return[...Object.keys(WB),...Object.keys(Gx)]}getWebGLFeature(t){const n=WB[t];return typeof n=="string"?!!zu(this.gl,n,this.extensions):!!n}}class AJ extends $U{constructor(t){super();J(this,"gl");J(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]}}function Fu(r,e,t){if(pJ(e))return t(r);const{nocatch:n=!0}=e;K_(r),wA(r,e);let i;if(n)i=t(r),tg(r);else try{i=t(r)}finally{tg(r)}return i}function pJ(r){for(const e in r)return!1;return!0}function gJ(r,e,t,n){if(km(e))return n(r);const i=r;K_(i.gl);try{return mJ(r,e),wA(i.gl,t),n(r)}finally{tg(i.gl)}}function mJ(r,e){const t=r,{gl:n}=t;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(Wf("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&r.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&r.features.has("provoking-vertex-webgl")){const o=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=Wf("provokingVertex",e.provokingVertex,{first:36429,last:36430});o==null||o.provokingVertexWEBGL(s)}if((e.polygonMode||e.polygonOffsetLine)&&r.features.has("polygon-mode-webgl")){if(e.polygonMode){const o=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=Wf("polygonMode",e.polygonMode,{fill:6914,line:6913});o==null||o.polygonModeWEBGL(1028,s),o==null||o.polygonModeWEBGL(1029,s)}e.polygonOffsetLine&&n.enable(10754)}if(r.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(yJ("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(n2("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Zt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,o=n2("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,o,0,i),n.stencilFuncSeparate(1029,o,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=Hv("stencilPassOperation",e.stencilPassOperation),o=Hv("stencilFailOperation",e.stencilFailOperation),s=Hv("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,o,s,i),n.stencilOpSeparate(1029,o,s,i)}if(e.blendColorOperation||e.blendAlphaOperation){n.enable(3042);const i=XB("blendColorOperation",e.blendColorOperation||"add"),o=XB("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,o);const s=B0("blendColorSrcFactor",e.blendColorSrcFactor||"one"),c=B0("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=B0("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),g=B0("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(s,c,f,g)}}function n2(r,e){return Wf(r,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Hv(r,e){return Wf(r,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function XB(r,e){return Wf(r,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function B0(r,e){return Wf(r,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function _J(r,e){return`Illegal parameter ${e} for ${r}`}function Wf(r,e,t){if(!(e in t))throw new Error(_J(r,e));return t[e]}function yJ(r,e){return e}function zD(r){const e={};return r.addressModeU&&(e[10242]=jv(r.addressModeU)),r.addressModeV&&(e[10243]=jv(r.addressModeV)),r.addressModeW&&(e[32882]=jv(r.addressModeW)),r.magFilter&&(e[10240]=GD(r.magFilter)),(r.minFilter||r.mipmapFilter)&&(e[10241]=vJ(r.minFilter||"linear",r.mipmapFilter)),r.lodMinClamp!==void 0&&(e[33082]=r.lodMinClamp),r.lodMaxClamp!==void 0&&(e[33083]=r.lodMaxClamp),r.type==="comparison-sampler"&&(e[34892]=34894),r.compare&&(e[34893]=n2("compare",r.compare)),r.maxAnisotropy&&(e[34046]=r.maxAnisotropy),e}function jv(r){switch(r){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function GD(r){switch(r){case"nearest":return 9728;case"linear":return 9729}}function vJ(r,e){if(!e)return GD(r);switch(r){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class Nu extends $i{constructor(t,n={}){super(t,n);J(this,"device");J(this,"gl");J(this,"handle");J(this,"glTarget");J(this,"glUsage");J(this,"glIndexType",5123);J(this,"byteLength");J(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const i=typeof n=="object"?n.handle:void 0;this.handle=i||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=bJ(this.props.usage),this.glUsage=xJ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(t,n=0,i=t.byteLength+n){const o=this.glTarget;this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,this.glUsage),this.gl.bufferSubData(o,n,t),this.gl.bindBuffer(o,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(t,n,i),this.trackAllocatedMemory(i)}_initWithByteLength(t){jn(t>=0);let n=t;t===0&&(n=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,n,t.byteLength)}async readAsync(t=0,n){return this.readSyncWebGL(t,n)}readSyncWebGL(t=0,n){n=n??this.byteLength-t;const i=new Uint8Array(n),o=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,o,n),this.gl.bindBuffer(36662,null),this._setDebugData(i,t,n),i}}function bJ(r){return r&$i.INDEX?34963:r&$i.VERTEX?34962:r&$i.UNIFORM?35345:34962}function xJ(r){return r&$i.INDEX||r&$i.VERTEX?35044:r&$i.UNIFORM?35048:35044}class i2 extends Gm{constructor(t,n){super(t,n);J(this,"device");J(this,"handle");J(this,"parameters");this.device=t,this.parameters=zD(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[n,i]of Object.entries(t)){const o=Number(n);switch(o){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,o,i);break;default:this.device.gl.samplerParameteri(this.handle,o,i);break}}}}class Dd extends Um{constructor(t,n){super(t,{...ea.defaultProps,...n});J(this,"device");J(this,"gl");J(this,"handle");J(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const wJ={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},Xp=class Xp extends ea{constructor(t,n){var i;super(t,{...wJ,format:"rgba8unorm",...n});J(this,"MAX_ATTRIBUTES");J(this,"device");J(this,"gl");J(this,"handle");J(this,"sampler");J(this,"view");J(this,"glFormat");J(this,"type");J(this,"dataFormat");J(this,"mipmaps");J(this,"target");J(this,"textureUnit");J(this,"loaded",!1);J(this,"_video");this.device=t,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=CJ(this.props),this.loaded=!1,typeof((i=this.props)==null?void 0:i.data)=="string"&&Object.assign(this.props,{data:Lz(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(t){return new Dd(this.device,{...t,texture:this})}initialize(t={}){if(this.props.dimension==="cube")return this.initializeCube(t);let n=t.data;if(n instanceof Promise)return n.then(z=>this.initialize(Object.assign({},t,{pixels:z,data:z}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(t)),this;const{parameters:o={}}=t,{pixels:s=null,pixelStore:c={},textureUnit:f=void 0,mipmaps:g=!0}=t;n||(n=s);let{width:b,height:T,dataFormat:S,type:F,compressed:k=!1}=t;const{depth:U=0}=t,j=UD(t.format);return{width:b,height:T,compressed:k,dataFormat:S,type:F}=this._deduceParameters({format:t.format,type:F,dataFormat:S,compressed:k,data:n,width:b,height:T}),this.width=b,this.height=T,this.glFormat=j,this.type=F,this.dataFormat=S,this.textureUnit=f,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=g,this.setImageData({data:n,width:b,height:T,depth:U,format:t.format,type:F,dataFormat:S,parameters:c,compressed:k}),this.setSampler(t.sampler),this._setSamplerParameters(o),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),g&&this.device.isTextureFormatFilterable(t.format)&&this.generateMipmap(),i&&(this._video={video:n,parameters:o,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}initializeCube(t){const{mipmaps:n=!0,parameters:i={}}=t;return this.setCubeMapImageData(t).then(()=>{this.loaded=!0,n&&this.generateMipmap(t),this.setSampler(t.sampler),this._setSamplerParameters(i)}),this}setSampler(t={}){let n;t instanceof i2?(this.sampler=t,n=t.props):(this.sampler=new i2(this.device,t),n=t);const i=zD(n);return this._setSamplerParameters(i),this}resize(t){const{height:n,width:i,mipmaps:o=!1}=t;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:o}):this}update(){if(this._video){const{video:t,parameters:n,lastTime:i}=this._video;if(i===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}generateMipmap(t={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Fu(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(t){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(t);this.trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:o=0,glFormat:s=this.glFormat,offset:c=0,parameters:f={}}=t;let{data:g=null,type:b=this.type,width:T=this.width,height:S=this.height,dataFormat:F=this.dataFormat,compressed:k=!1}=t;g||(g=i),{type:b,dataFormat:F,compressed:k,width:T,height:S}=this._deduceParameters({format:this.props.format,type:b,dataFormat:F,compressed:k,data:g,width:T,height:S});const{gl:U}=this;U.bindTexture(this.target,this.handle);let j=null;if({data:g,dataType:j}=this._getDataType({data:g,compressed:k}),Fu(this.gl,f,()=>{switch(j){case"null":U.texImage2D(n,o,s,T,S,0,F,b,g);break;case"typed-array":U.texImage2D(n,o,s,T,S,0,F,b,g,c);break;case"buffer":this.device.gl.bindBuffer(35052,g.handle||g),this.device.gl.texImage2D(n,o,s,T,S,0,F,b,c),this.device.gl.bindBuffer(35052,null);break;case"browser-object":U.texImage2D(n,o,s,T,S,0,F,b,g);break;case"compressed":for(const[z,V]of g.entries())U.compressedTexImage2D(n,z,V.format,V.width,V.height,0,V.data);break;default:jn(!1,"Unknown image data type")}}),g&&g.byteLength)this.trackAllocatedMemory(g.byteLength,"Texture");else{const z=JB(this.props.format);this.trackAllocatedMemory(this.width*this.height*z,"Texture")}return this.loaded=!0,this}setSubImageData({target:t=this.target,pixels:n=null,data:i=null,x:o=0,y:s=0,width:c=this.width,height:f=this.height,level:g=0,glFormat:b=this.glFormat,type:T=this.type,dataFormat:S=this.dataFormat,compressed:F=!1,offset:k=0,parameters:U={}}){if({type:T,dataFormat:S,compressed:F,width:c,height:f}=this._deduceParameters({format:this.props.format,type:T,dataFormat:S,compressed:F,data:i,width:c,height:f}),jn(this.depth===1,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const j=i;i=j.data,c=j.shape[0],f=j.shape[1]}i instanceof Nu&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Fu(this.gl,U,()=>{F?this.gl.compressedTexSubImage2D(t,g,o,s,c,f,b,i):i===null?this.gl.texSubImage2D(t,g,o,s,c,f,S,T,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(t,g,o,s,c,f,S,T,i,k):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(t,g,o,s,c,f,S,T,k),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(t,g,o,s,c,f,S,T,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(t={}){return Zt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t=this.textureUnit){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.target,this.handle),t}unbind(t=this.textureUnit){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.target,null),t}_getDataType({data:t,compressed:n=!1}){return n?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof Nu?{data:t.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&t instanceof WebGLBuffer?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(t){const{format:n,data:i}=t;let{width:o,height:s,dataFormat:c,type:f,compressed:g}=t;const b=Zm(n);return c=c||b.dataFormat,f=f||b.type,g=g||b.compressed,{width:o,height:s}=this._deduceImageSize(i,o,s),{dataFormat:c,type:f,compressed:g,width:o,height:s,format:n,data:i}}_deduceImageSize(t,n,i){let o;return typeof ImageData<"u"&&t instanceof ImageData?o={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?o={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?o={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?o={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?o={width:t.videoWidth,height:t.videoHeight}:t?o={width:n,height:i}:o={width:n>=0?n:1,height:i>=0?i:1},jn(o,"Could not deduced texture size"),jn(n===void 0||o.width===n,"Deduced texture width does not match supplied width"),jn(i===void 0||o.height===i,"Deduced texture height does not match supplied height"),o}async setCubeMapImageData(t){const{gl:n}=this,{width:i,height:o,pixels:s,data:c,format:f=6408,type:g=5121}=t,b=s||c,T=await Promise.all(Xp.FACES.map(S=>{const F=b[S];return Promise.all(Array.isArray(F)?F:[F])}));this.bind(),Xp.FACES.forEach((S,F)=>{T[F].length>1&&this.props.mipmaps!==!1&&Zt.warn(`${this.id} has mipmap and multiple LODs.`)(),T[F].forEach((k,U)=>{i&&o?n.texImage2D(S,U,f,i,o,0,f,g,k):n.texImage2D(S,U,f,f,g,k)})}),this.unbind()}setImageDataForFace(t){const{face:n,width:i,height:o,pixels:s,data:c,format:f=6408,type:g=5121}=t,{gl:b}=this,T=s||c;return this.bind(),T instanceof Promise?T.then(S=>this.setImageDataForFace(Object.assign({},t,{face:n,data:S,pixels:S}))):this.width||this.height?b.texImage2D(n,0,f,i,o,0,f,g,T):b.texImage2D(n,0,f,f,g,T),this}setImageData3D(t){const{level:n=0,dataFormat:i,format:o,type:s,width:c,height:f,depth:g=1,offset:b=0,data:T,parameters:S={}}=t;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const F=Zm(o);if(Fu(this.gl,S,()=>{ArrayBuffer.isView(T)&&this.gl.texImage3D(this.target,n,F.format,c,f,g,0,F.dataFormat,F.type,T),T instanceof Nu&&(this.gl.bindBuffer(35052,T.handle),this.gl.texImage3D(this.target,n,i,c,f,g,0,o,s,b))}),T&&T.byteLength)this.trackAllocatedMemory(T.byteLength,"Texture");else{const k=JB(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*k,"Texture")}return this.loaded=!0,this}_setSamplerParameters(t){if(!km(t)){EJ(t),this.gl.bindTexture(this.target,this.handle);for(const[n,i]of Object.entries(t)){const o=Number(n),s=i;switch(o){case 33082:case 33083:this.gl.texParameterf(this.target,o,s);break;default:this.gl.texParameteri(this.target,o,s);break}}this.gl.bindTexture(this.target,null)}}};J(Xp,"FACES",[34069,34070,34071,34072,34073,34074]);let Wc=Xp;function CJ(r){switch(r.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(r.dimension)}}function EJ(r){Zt.log(1,"texture sampler parameters",r)()}class Lp extends Vm{constructor(t,n){super(t,n);J(this,"device");J(this,"gl");J(this,"handle");const i=n.handle===null;if(this.device=t,this.gl=t.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const o=this.gl.bindFramebuffer(36160,this.handle);for(let s=0;s<this.colorAttachments.length;++s){const c=this.colorAttachments[s],f=36064+s;c&&this._attachOne(f,c)}if(this.depthStencilAttachment&&this._attachOne(fJ(this.depthStencilAttachment.props.format),this.depthStencilAttachment),n.check!==!1){const s=this.gl.checkFramebufferStatus(36160);if(s!==36053)throw new Error(`Framebuffer ${BJ(s)}`)}this.gl.bindFramebuffer(36160,o)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(t){return new Wc(this.device,{id:`${this.id}-depth-stencil`,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,n){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),n===void 0&&(n=this.gl.drawingBufferHeight);for(const i of this.colorAttachments)i.texture.resize({width:t,height:n});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:t,height:n}),this}_attachOne(t,n){if(Array.isArray(n)){const[i,o=0,s=0]=n;return this._attachTexture(t,i,o,s),i}if(n instanceof Wc)return this._attachTexture(t,n,0,0),n;if(n instanceof Dd){const i=n;return this._attachTexture(t,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),n.texture}throw new Error("attach")}_attachTexture(t,n,i,o){const{gl:s}=this.device;switch(s.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:s.framebufferTextureLayer(36160,t,n.target,o,i);break;case 34067:const c=TJ(i);s.framebufferTexture2D(36160,t,c,n.handle,o);break;case 3553:s.framebufferTexture2D(36160,t,3553,n.handle,o);break;default:jn(!1,"Illegal texture type")}s.bindTexture(n.target,null)}}function TJ(r){return r<34069?r+34069:r}function BJ(r){switch(r){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${r}`}}class SJ extends wx{constructor(t,n){super(n);J(this,"device");J(this,"presentationSize");J(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Lp(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(n,t);return}}commit(){}}const IJ={spector:Zt.get("spector")||Zt.get("spectorjs")},MJ="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",PJ=1;let ci=null,$B=!1;async function RJ(r){if(!globalThis.SPECTOR)try{await DF(MJ)}catch(e){Zt.warn(String(e))}}function FJ(r){if(r={...IJ,...r},!(r!=null&&r.spector)||(!ci&&globalThis.SPECTOR&&(Zt.probe(PJ,"SPECTOR found and initialized")(),ci=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=ci)),!ci))return null;if($B||($B=!0,ci.spyCanvases(),ci==null||ci.onCaptureStarted.add(e=>Zt.info("Spector capture started:",e)()),ci==null||ci.onCapture.add(e=>{Zt.info("Spector capture complete:",e)(),ci==null||ci.getResultUI(),ci==null||ci.resultView.display(),ci==null||ci.resultView.addCapture(e)})),r!=null&&r.canvas){if(typeof r.spector=="string"&&r.spector!==r.canvas.id)return ci;ci==null||ci.startCapture(r==null?void 0:r.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Zt.info("Spector capture stopped after 2 seconds")(),ci==null||ci.stopCapture()})}return ci}const DJ="https://unpkg.com/webgl-debug@2.0.1/index.js";function VD(r){return r.luma=r.luma||{},r.luma}async function OJ(){$u()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await DF(DJ))}function LJ(r,e={}){return r?e.debug?kJ(r,e):NJ(r):null}function NJ(r){const e=VD(r);return e.realContext?e.realContext:r}function kJ(r,e){if(!globalThis.WebGLDebugUtils)return Zt.warn("webgl-debug not loaded")(),r;const t=VD(r);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Pd,...r});const n=globalThis.WebGLDebugUtils.makeDebugContext(r,UJ.bind(null,e),zJ.bind(null,e));for(const s in Pd)!(s in n)&&typeof Pd[s]=="number"&&(n[s]=Pd[s]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(r)),Object.setPrototypeOf(i,n);const o=Object.create(i);return t.realContext=r,t.debugContext=o,o.debug=!0,o}function Jv(r,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${r}(${t})`}function UJ(r,e,t,n){n=Array.from(n).map(c=>c===void 0?"undefined":c);const i=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,n),s=`${i} in gl.${t}(${o})`;Zt.error(s)();debugger;if(r.throwOnError)throw new Error(s)}function zJ(r,e,t){let n="";if(Zt.level>=1&&(n=Jv(e,t),Zt.log(1,n)()),r.break&&r.break.length>0&&(n=n||Jv(e,t),r.break.every(o=>n.indexOf(o)!==-1)))debugger;for(const i of t)if(i===void 0){if(n=n||Jv(e,t),r.throwOnError)throw new Error(`Undefined argument: ${n}`);Zt.error(`Undefined argument: ${n}`)();debugger}}function GJ(r){const e=r.split(/\r?\n/),t=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[T,S]=i;t.push({message:S.trim(),type:KB(T),lineNum:0,linePos:0});continue}const[o,s,c,...f]=i;let g=parseInt(c,10);isNaN(g)&&(g=0);let b=parseInt(s,10);isNaN(b)&&(b=0),t.push({message:f.join(":").trim(),type:KB(o),lineNum:g,linePos:b})}return t}function KB(r){const e=["warning","error","info"],t=r.toLowerCase();return e.includes(t)?t:"info"}class VJ extends zm{constructor(t,n){super(t,n);J(this,"device");J(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return GJ(t)}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return n==null?void 0:n.getTranslatedShaderSource(this.handle)}async _compile(t){t=(o=>o.startsWith("#version ")?o:`#version 100
${o}`)(t);const{gl:i}=this.device;if(i.shaderSource(this.handle,t),i.compileShader(this.handle),Zt.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Zt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Zt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async o=>await new Promise(s=>setTimeout(s,o));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const HJ=256,jJ=1024,JJ=16384,Wv=6144,WJ=[1,2,4,8];class XJ extends Db{constructor(t,n){super(t,n);J(this,"device");J(this,"glParameters");this.device=t,K_(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){tg(this.device.gl)}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const n={...this.glParameters};this.props.framebuffer&&(n.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(n.viewport=t.viewport.slice(0,4),n.depthRange=[t.viewport[4],t.viewport[5]]):n.viewport=t.viewport),t.scissorRect&&(n.scissorTest=!0,n.scissor=t.scissorRect),t.blendConstant&&(n.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(n.colorMask=WJ.map(i=>!!(i&t.colorMask))),this.glParameters=n,wA(this.device.gl,n)}beginOcclusionQuery(t){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let n=0;this.props.clearColor!==!1&&(n|=JJ,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=HJ,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=jJ,t.clearStencil=this.props.clearStencil),n!==0&&Fu(this.device.gl,t,()=>{this.device.gl.clear(n)})}clearColorBuffer(t=0,n=[0,0,0,0]){Fu(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int32Array:this.device.gl.clearBufferiv(Wv,t,n);break;case Uint32Array:this.device.gl.clearBufferuiv(Wv,t,n);break;case Float32Array:default:this.device.gl.clearBufferfv(Wv,t,n);break}})}}const $J="Failed to deduce GL constant from typed array";function KJ(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error($J)}}function s2(r,e){const{clamped:t=!0}=e||{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const qJ={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},ZJ={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Np{constructor(...e){J(this,"offset");J(this,"stride");J(this,"type");J(this,"size");J(this,"divisor");J(this,"normalized");J(this,"integer");J(this,"buffer");J(this,"index");e.forEach(t=>this._assign(t)),Object.freeze(this)}static getBytesPerElement(e){return s2(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return jn(e.size),s2(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Np(qJ,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Np.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Np.getBytesPerVertex(this)}_assign(e={}){return e=Dz("Accessor",e,ZJ),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function YJ(r){return QJ.includes(r)}const QJ=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],HD={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function jD(r){const e=HD[r];if(!e)throw new Error("uniform");const[t,n,,i]=e;return{format:i,components:n,glType:t}}function eW(r){const e=HD[r];if(!e)throw new Error("attribute");const[,t,,n,i]=e;return{attributeType:n,vertexFormat:i,components:t}}function tW(r,e){const t={attributes:[],bindings:[]};t.attributes=rW(r,e);const n=sW(r,e);for(const c of n){const f=c.uniforms.map(g=>({name:g.name,format:g.format,byteOffset:g.byteOffset,byteStride:g.byteStride,arrayLength:g.arrayLength}));t.bindings.push({type:"uniform",name:c.name,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:f})}const i=iW(r,e);let o=0;for(const c of i)if(YJ(c.type)){const{viewDimension:f,sampleType:g}=aW(c.type);t.bindings.push({type:"texture",name:c.name,location:o,viewDimension:f,sampleType:g}),c.textureUnit=o,o+=1}i.length&&(t.uniforms=i);const s=nW(r,e);return s!=null&&s.length&&(t.varyings=s),t}function rW(r,e){const t=[],n=r.getProgramParameter(e,35721);for(let i=0;i<n;i++){const o=r.getActiveAttrib(e,i);if(!o)throw new Error("activeInfo");const{name:s,type:c}=o,f=r.getAttribLocation(e,s);if(f>=0){const{attributeType:g}=eW(c),b=/instance/i.test(s)?"instance":"vertex";t.push({name:s,location:f,stepMode:b,type:g})}}return t.sort((i,o)=>i.location-o.location),t}function nW(r,e){const t=[],n=r.getProgramParameter(e,35971);for(let i=0;i<n;i++){const o=r.getTransformFeedbackVarying(e,i);if(!o)throw new Error("activeInfo");const{name:s,type:c,size:f}=o,{glType:g,components:b}=jD(c),T=new Np({type:g,size:f*b}),S={location:i,name:s,accessor:T};t.push(S)}return t.sort((i,o)=>i.location-o.location),t}function iW(r,e){const t=[],n=r.getProgramParameter(e,35718);for(let i=0;i<n;i++){const o=r.getActiveUniform(e,i);if(!o)throw new Error("activeInfo");const{name:s,size:c,type:f}=o,{name:g,isArray:b}=cW(s);let T=r.getUniformLocation(e,g);const S={location:T,name:g,size:c,type:f,isArray:b};if(t.push(S),S.size>1)for(let F=0;F<S.size;F++){const k=`${g}[${F}]`;T=r.getUniformLocation(e,k);const U={...S,name:k,location:T};t.push(U)}}return t}function sW(r,e){const t=(o,s)=>r.getActiveUniformBlockParameter(e,o,s),n=[],i=r.getProgramParameter(e,35382);for(let o=0;o<i;o++){const s={name:r.getActiveUniformBlockName(e,o)||"",location:t(o,35391),byteLength:t(o,35392),vertex:t(o,35396),fragment:t(o,35398),uniformCount:t(o,35394),uniforms:[]},c=t(o,35395)||[],f=r.getActiveUniforms(e,c,35383),g=r.getActiveUniforms(e,c,35384),b=r.getActiveUniforms(e,c,35387),T=r.getActiveUniforms(e,c,35388);for(let S=0;S<s.uniformCount;++S){const F=r.getActiveUniform(e,c[S]);if(!F)throw new Error("activeInfo");s.uniforms.push({name:F.name,format:jD(f[S]).format,type:f[S],arrayLength:g[S],byteOffset:b[S],byteStride:T[S]})}n.push(s)}return n.sort((o,s)=>o.location-s.location),n}const oW={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function aW(r){const e=oW[r];if(!e)throw new Error("sampler");const[t,n]=e;return{viewDimension:t,sampleType:n}}function cW(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(r);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${r}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function lW(r,e,t,n){const i=r;let o=n;o===!0&&(o=1),o===!1&&(o=0);const s=typeof o=="number"?[o]:o;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return r.uniform1i(e,n);case 5126:return r.uniform1fv(e,s);case 35664:return r.uniform2fv(e,s);case 35665:return r.uniform3fv(e,s);case 35666:return r.uniform4fv(e,s);case 5124:return r.uniform1iv(e,s);case 35667:return r.uniform2iv(e,s);case 35668:return r.uniform3iv(e,s);case 35669:return r.uniform4iv(e,s);case 35670:return r.uniform1iv(e,s);case 35671:return r.uniform2iv(e,s);case 35672:return r.uniform3iv(e,s);case 35673:return r.uniform4iv(e,s);case 5125:return i.uniform1uiv(e,s,1);case 36294:return i.uniform2uiv(e,s,2);case 36295:return i.uniform3uiv(e,s,3);case 36296:return i.uniform4uiv(e,s,4);case 35674:return r.uniformMatrix2fv(e,!1,s);case 35675:return r.uniformMatrix3fv(e,!1,s);case 35676:return r.uniformMatrix4fv(e,!1,s);case 35685:return i.uniformMatrix2x3fv(e,!1,s);case 35686:return i.uniformMatrix2x4fv(e,!1,s);case 35687:return i.uniformMatrix3x2fv(e,!1,s);case 35688:return i.uniformMatrix3x4fv(e,!1,s);case 35689:return i.uniformMatrix4x2fv(e,!1,s);case 35690:return i.uniformMatrix4x3fv(e,!1,s)}throw new Error("Illegal uniform")}function uW(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(r)}}function fW(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(r)}}const qB=4;class hW extends iA{constructor(t,n){super(t,n);J(this,"device");J(this,"handle");J(this,"vs");J(this,"fs");J(this,"introspectedLayout");J(this,"uniforms",{});J(this,"bindings",{});J(this,"varyings",null);J(this,"_uniformCount",0);J(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:i,bufferMode:o=35981}=n;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,o)),this._linkShaders(),Zt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=tW(this.device.gl,this.handle),Zt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=bz(this.introspectedLayout,n.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Zt.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,n){for(const[i,o]of Object.entries(t)){const s=this.shaderLayout.bindings.find(c=>c.name===i)||this.shaderLayout.bindings.find(c=>c.name===`${i}Uniforms`);if(!s){const c=this.shaderLayout.bindings.map(f=>`"${f.name}"`).join(", ");n!=null&&n.disableWarnings||Zt.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${c}`)();continue}switch(o||Zt.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(o instanceof Nu)&&!(o.buffer instanceof Nu))throw new Error("buffer value");break;case"texture":if(!(o instanceof Dd||o instanceof Wc||o instanceof Lp))throw new Error("texture value");break;case"sampler":Zt.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(s.type)}this.bindings[i]=o}}draw(t){var j;const{renderPass:n,parameters:i=this.props.parameters,topology:o=this.props.topology,vertexArray:s,vertexCount:c,instanceCount:f,isInstanced:g=!1,firstVertex:b=0,transformFeedback:T}=t,S=uW(o),F=!!s.indexBuffer,k=(j=s.indexBuffer)==null?void 0:j.glIndexType;if(this.linkStatus!=="success")return Zt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||c===0)return Zt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(c===0)return Zt.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),s.bindBeforeRender(n),T&&T.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const U=n;return gJ(this.device,i,U.glParameters,()=>{F&&g?this.device.gl.drawElementsInstanced(S,c||0,k,b,f||0):F?this.device.gl.drawElements(S,c||0,k,b):g?this.device.gl.drawArraysInstanced(S,b,c||0,f||0):this.device.gl.drawArrays(S,b,c||0),T&&T.end()}),s.unbindAfterRender(n),!0}setUniformsWebGL(t){const{bindings:n}=Cx(t);Object.keys(n).forEach(i=>{Zt.warn(`Unsupported value "${JSON.stringify(n[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Zt.time(qB,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),Zt.timeEnd(qB,`linkProgram for ${this.id}`)(),Zt.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}Zt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Zt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}_reportLinkStatus(t){var n;switch(t){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((n=this.fs)==null?void 0:n.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${t}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async o=>await new Promise(s=>setTimeout(s,o));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const[,n]of Object.entries(this.bindings))n instanceof Wc&&(n.update(),t=t&&n.loaded);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let n=0,i=0;for(const o of this.shaderLayout.bindings){const s=this.bindings[o.name]||this.bindings[o.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${o.name} in ${this.id}`);switch(o.type){case"uniform":const{name:c}=o,f=t.getUniformBlockIndex(this.handle,c);if(f===4294967295)throw new Error(`Invalid uniform block name ${c}`);t.uniformBlockBinding(this.handle,i,f),s instanceof Nu?t.bindBufferBase(35345,i,s.handle):t.bindBufferRange(35345,i,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),i+=1;break;case"texture":if(!(s instanceof Dd||s instanceof Wc||s instanceof Lp))throw new Error("texture");let g;if(s instanceof Dd)g=s.texture;else if(s instanceof Wc)g=s;else if(s instanceof Lp&&s.colorAttachments[0]instanceof Dd)Zt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),g=s.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+n),t.bindTexture(g.target,g.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${o.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:n,location:i,type:o,textureUnit:s}=t,c=this.uniforms[n]??s;c!==void 0&&lW(this.device.gl,i,o,c)}}}class dW extends Lb{constructor(t){super(t,{});J(this,"device");J(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const n of t)switch(n.name){case"copy-buffer-to-buffer":AW(this.device,n.options);break;case"copy-buffer-to-texture":pW(this.device,n.options);break;case"copy-texture-to-buffer":gW(this.device,n.options);break;case"copy-texture-to-texture":mW(this.device,n.options);break}}}function AW(r,e){const t=e.source,n=e.destination;r.gl.bindBuffer(36662,t.handle),r.gl.bindBuffer(36663,n.handle),r.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),r.gl.bindBuffer(36662,null),r.gl.bindBuffer(36663,null)}function pW(r,e){throw new Error("Not implemented")}function gW(r,e){const{source:t,mipLevel:n=0,aspect:i="all",width:o=e.source.width,height:s=e.source.height,depthOrArrayLayers:c=0,origin:f=[0,0],destination:g,byteOffset:b=0,bytesPerRow:T,rowsPerImage:S}=e;if(i!=="all")throw new Error("not supported");if(n!==0||c!==0||T||S)throw new Error("not implemented");const{framebuffer:F,destroyFramebuffer:k}=JD(t);let U;try{const j=g,z=o||F.width,V=s||F.height,K=Zm(F.texture.props.format),fe=K.dataFormat,Q=K.type;r.gl.bindBuffer(35051,j.handle),U=r.gl.bindFramebuffer(36160,F.handle),r.gl.readPixels(f[0],f[1],z,V,fe,Q,b)}finally{r.gl.bindBuffer(35051,null),U!==void 0&&r.gl.bindFramebuffer(36160,U),k&&F.destroy()}}function mW(r,e){const{source:t,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:o=[0,0],destination:s}=e;let{width:c=e.destination.width,height:f=e.destination.height}=e;const{framebuffer:g,destroyFramebuffer:b}=JD(t),[T,S]=i,[F,k,U]=o,j=r.gl.bindFramebuffer(36160,g.handle);let z=null,V;if(s instanceof Wc)z=s,c=Number.isFinite(c)?c:z.width,f=Number.isFinite(f)?f:z.height,z.bind(0),V=z.target;else throw new Error("invalid destination");switch(V){case 3553:case 34067:r.gl.copyTexSubImage2D(V,n,F,k,T,S,c,f);break;case 35866:case 32879:r.gl.copyTexSubImage3D(V,n,F,k,U,T,S,c,f);break}z&&z.unbind(),r.gl.bindFramebuffer(36160,j),b&&g.destroy()}function JD(r){if(r instanceof ea){const{width:e,height:t,id:n}=r;return{framebuffer:r.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:t,colorAttachments:[r]}),destroyFramebuffer:!0}}return{framebuffer:r,destroyFramebuffer:!1}}class _W extends Ob{constructor(t,n){super(t,n);J(this,"device");J(this,"commandBuffer");this.device=t,this.commandBuffer=new dW(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,n,i){}}class Hx extends Nb{constructor(t,n){super(t,n);J(this,"device");J(this,"handle");J(this,"buffer",null);J(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return wk()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const n=t;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(t,n){const i=n;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:o,type:s,stride:c,offset:f,normalized:g,integer:b,divisor:T}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),b?this.device.gl.vertexAttribIPointer(t,o,s,c,f):this.device.gl.vertexAttribPointer(t,o,s,g,c,f),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,T||0),this.attributes[t]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,n){this._enable(t,!1),this.attributes[t]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const n=this.attributes[t];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(t,n)}}_getAccessor(t){const n=this.attributeInfos[t];if(!n)throw new Error(`Unknown attribute location ${t}`);const i=kD(n.bufferDataType);return{size:n.bufferComponents,type:i,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(t,n=!0){const o=Hx.isConstantAttributeZeroSupported(this.device)||t!==0;(n||o)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,n){const i=yW(n),o=i.byteLength*t,s=i.length*t;if(this.buffer&&o!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${o} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:o}),c=c||!vW(i,this.bufferValue),c){const f=Ez(n.constructor,s);Tz({target:f,source:i,start:0,count:s}),this.buffer.write(f),this.bufferValue=n}return this.buffer}}function yW(r){return Array.isArray(r)?new Float32Array(r):r}function vW(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}class bW extends kb{constructor(t,n){super(t,n);J(this,"device");J(this,"gl");J(this,"handle");J(this,"layout");J(this,"buffers",{});J(this,"unusedBuffers",{});J(this,"bindOnUse",!0);J(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(fW(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in t)this.setBuffer(n,t[n])})}setBuffer(t,n){const i=this._getVaryingIndex(t),{buffer:o,byteLength:s,byteOffset:c}=this._getBufferRange(n);if(i<0){this.unusedBuffers[t]=o,Zt.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[i]={buffer:o,byteLength:s,byteOffset:c},this.bindOnUse||this._bindBuffer(i,o,c,s)}getBuffer(t){if(ZB(t))return this.buffers[t]||null;const n=this._getVaryingIndex(t);return n>=0?this.buffers[n]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let n;return this._bound?n=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof Nu)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:n,byteOffset:i=0,byteLength:o=t.buffer.byteLength}=t;return{buffer:n,byteOffset:i,byteLength:o}}_getVaryingIndex(t){if(ZB(t))return Number(t);for(const n of this.layout.varyings)if(t===n.name)return n.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:n,byteLength:i,byteOffset:o}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),n,o,i)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,n,i=0,o){const s=n&&n.handle;!s||o===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,i,o)}}function ZB(r){return typeof r=="number"?Number.isInteger(r):/^\d+$/.test(r)}class xW extends Ub{constructor(t,n){super(t,n);J(this,"device");J(this,"handle");J(this,"target",null);J(this,"_queryPending",!1);J(this,"_pollingPromise",null);if(this.device=t,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,o)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>t?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}function WD(r){switch(r){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return jn(!1),0}}function wW(r){switch(r){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return jn(!1),0}}function CW(r,e){var j,z;const{sourceX:t=0,sourceY:n=0,sourceFormat:i=6408,sourceAttachment:o=36064}=e||{};let{target:s=null,sourceWidth:c,sourceHeight:f,sourceType:g}=e||{};const{framebuffer:b,deleteFramebuffer:T}=XD(r);jn(b);const{gl:S,handle:F}=b;c=c||b.width,f=f||b.height;const k=o-36064;g=g||((z=(j=b.colorAttachments[k])==null?void 0:j.texture)==null?void 0:z.type)||5121,s=BW(s,g,i,c,f),g=g||KJ(s);const U=S.bindFramebuffer(36160,F);return S.readPixels(t,n,c,f,i,g,s),S.bindFramebuffer(36160,U||null),T&&b.destroy(),s}function EW(r,e){const{target:t,sourceX:n=0,sourceY:i=0,sourceFormat:o=6408,targetByteOffset:s=0}=e||{};let{sourceWidth:c,sourceHeight:f,sourceType:g}=e||{};const{framebuffer:b,deleteFramebuffer:T}=XD(r);jn(b),c=c||b.width,f=f||b.height;const S=b;g=g||5121;let F=t;if(!F){const U=WD(o),j=wW(g),z=s+c*f*U*j;F=S.device.createBuffer({byteLength:z})}const k=r.device.createCommandEncoder();return k.copyTextureToBuffer({source:r,width:c,height:f,origin:[n,i],destination:F,byteOffset:s}),k.destroy(),T&&b.destroy(),F}function XD(r){return r instanceof Vm?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:TW(r),deleteFramebuffer:!0}}function TW(r,e){const{device:t,width:n,height:i,id:o}=r;return t.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:n,height:i,colorAttachments:[r]})}function BW(r,e,t,n,i){if(r)return r;e=e||5121;const o=s2(e,{clamped:!1}),s=WD(t);return new o(n*i*s)}const SW=256,IW=1024,MW=16384,PW="clear: bad arguments";function RW(r,e){const{framebuffer:t=null,color:n=null,depth:i=null,stencil:o=null}=e||{},s={};t&&(s.framebuffer=t);let c=0;n&&(c|=MW,n!==!0&&(s.clearColor=n)),i&&(c|=SW,i!==!0&&(s.clearDepth=i)),o&&(c|=IW,i!==!0&&(s.clearStencil=i)),jn(c!==0,PW);const f=r.gl;Fu(f,s,()=>{f.clear(c)})}const hp=1,Nf=class Nf extends nA{constructor(t){var f,g;super({...t,id:t.id||Vl("webgl-device")});J(this,"type","webgl");J(this,"handle");J(this,"features");J(this,"limits");J(this,"info");J(this,"canvasContext");J(this,"lost");J(this,"_resolveContextLost");J(this,"renderPass",null);J(this,"gl");J(this,"debug",!1);J(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});J(this,"_extensions",{});J(this,"_polyfilled",!1);J(this,"spectorJS");J(this,"_constants");const n=(f=t.gl)==null?void 0:f.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);const i=((g=t.gl)==null?void 0:g.canvas)||t.canvas;this.canvasContext=new SJ(this,{...t,canvas:i}),this.lost=new Promise(b=>{this._resolveContextLost=b});let o=t.gl||null;if(o||(o=Xj(this.canvasContext.canvas,{...t,onContextLost:b=>{var T;return(T=this._resolveContextLost)==null?void 0:T.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!o)throw new Error("WebGL context creation failed");this.handle=o,this.gl=o,this.gl.device=this,this.gl._version=2,t.spector&&(this.spectorJS=FJ({...this.props,canvas:this.handle.canvas})),this.info=$j(this.gl,this._extensions),this.limits=new AJ(this.gl),this.features=new dJ(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:s=!0,copyState:c=!1}=t;LD(this.gl,{enable:s,copyState:c}),t.debug&&(this.gl=LJ(this.gl,{...t,throwOnError:!0}),this.debug=!0,Zt.level=Math.max(Zt.level,1),Zt.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(t){if(t instanceof Nf)return t;if((t==null?void 0:t.device)instanceof nA)return t.device;if(!FW(t))throw new Error("Invalid WebGL2RenderingContext");return new Nf({gl:t})}static async create(t={}){var c;Zt.groupCollapsed(hp,"WebGLDevice created")();const n=[];t.debug&&n.push(OJ()),t.spector&&n.push(RJ()),typeof t.canvas=="string"&&n.push(wx.pageLoaded);const i=await Promise.allSettled(n);for(const f of i)f.status==="rejected"&&Zt.error(`Failed to initialize debug libraries ${f.reason}`)();if(Zt.probe(hp+1,"DOM is loaded")(),(c=t.gl)!=null&&c.device)return Zt.warn("reattaching existing device")(),Nf.attach(t.gl);const o=new Nf(t),s=`Created ${o.type}${o.debug?" debug":""} context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return Zt.probe(hp,s)(),Zt.table(hp,o.info)(),Zt.groupEnd(hp)(),o}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(t){return Vx(this.gl,t,this._extensions)}isTextureFormatFilterable(t){return lJ(this.gl,t,this._extensions)}isTextureFormatRenderable(t){return uJ(this.gl,t,this._extensions)}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const n=this._getBufferProps(t);return new Nu(this,n)}_createTexture(t){return new Wc(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new i2(this,t)}createShader(t){return new VJ(this,t)}createFramebuffer(t){return new Lp(this,t)}createVertexArray(t){return new Hx(this,t)}createTransformFeedback(t){return new bW(this,t)}createQuerySet(t){return new xW(this,t)}createRenderPipeline(t){return new hW(this,t)}beginRenderPass(t){return new XJ(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t){return new _W(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,n){return CW(t,n)}readPixelsToBufferWebGL(t,n){return EW(t,n)}setParametersWebGL(t){wA(this.gl,t)}getParametersWebGL(t){return OD(this.gl,t)}withParametersWebGL(t,n){return Fu(this.gl,t,n)}clearWebGL(t){RW(this,t)}resetWebGL(){Zt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),zj(this.gl)}loseDevice(){var o;let t=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(t=!0,i.loseContext()),(o=this._resolveContextLost)==null||o.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){K_(this.gl)}popState(){tg(this.gl)}setSpectorMetadata(t,n){t.__SPECTOR_Metadata=n}getGLKey(t,n){n=n||this.gl2||this.gl;const i=Number(t);for(const o in n)if(n[o]===i)return`GL.${o}`;return String(t)}setConstantAttributeWebGL(t,n){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const o=this._constants[t];switch(o&&NW(o,n)&&Zt.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=n,n.constructor){case Float32Array:DW(this,t,n);break;case Int32Array:OW(this,t,n);break;case Uint32Array:LW(this,t,n);break;default:jn(!1)}}getExtension(t){return zu(this.gl,t,this._extensions),this._extensions}};J(Nf,"type","webgl");let kp=Nf;function FW(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}function DW(r,e,t){switch(t.length){case 1:r.gl.vertexAttrib1fv(e,t);break;case 2:r.gl.vertexAttrib2fv(e,t);break;case 3:r.gl.vertexAttrib3fv(e,t);break;case 4:r.gl.vertexAttrib4fv(e,t);break;default:jn(!1)}}function OW(r,e,t){r.gl.vertexAttribI4iv(e,t)}function LW(r,e,t){r.gl.vertexAttribI4uiv(e,t)}function NW(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}var Xv={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var YB;function kW(){return YB||(YB=1,function(r){(function(e,t,n,i){var o=["","webkit","Moz","MS","ms","o"],s=t.createElement("div"),c="function",f=Math.round,g=Math.abs,b=Date.now;function T(xe,Re,Je){return setTimeout(K(xe,Je),Re)}function S(xe,Re,Je){return Array.isArray(xe)?(F(xe,Je[Re],Je),!0):!1}function F(xe,Re,Je){var At;if(xe)if(xe.forEach)xe.forEach(Re,Je);else if(xe.length!==i)for(At=0;At<xe.length;)Re.call(Je,xe[At],At,xe),At++;else for(At in xe)xe.hasOwnProperty(At)&&Re.call(Je,xe[At],At,xe)}function k(xe,Re,Je){var At="DEPRECATED METHOD: "+Re+`
`+Je+` AT 
`;return function(){var Ht=new Error("get-stack-trace"),gr=Ht&&Ht.stack?Ht.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",wr=e.console&&(e.console.warn||e.console.log);return wr&&wr.call(e.console,At,gr),xe.apply(this,arguments)}}var U;typeof Object.assign!="function"?U=function(Re){if(Re===i||Re===null)throw new TypeError("Cannot convert undefined or null to object");for(var Je=Object(Re),At=1;At<arguments.length;At++){var Ht=arguments[At];if(Ht!==i&&Ht!==null)for(var gr in Ht)Ht.hasOwnProperty(gr)&&(Je[gr]=Ht[gr])}return Je}:U=Object.assign;var j=k(function(Re,Je,At){for(var Ht=Object.keys(Je),gr=0;gr<Ht.length;)(!At||At&&Re[Ht[gr]]===i)&&(Re[Ht[gr]]=Je[Ht[gr]]),gr++;return Re},"extend","Use `assign`."),z=k(function(Re,Je){return j(Re,Je,!0)},"merge","Use `assign`.");function V(xe,Re,Je){var At=Re.prototype,Ht;Ht=xe.prototype=Object.create(At),Ht.constructor=xe,Ht._super=At,Je&&U(Ht,Je)}function K(xe,Re){return function(){return xe.apply(Re,arguments)}}function fe(xe,Re){return typeof xe==c?xe.apply(Re&&Re[0]||i,Re):xe}function Q(xe,Re){return xe===i?Re:xe}function oe(xe,Re,Je){F(_e(Re),function(At){xe.addEventListener(At,Je,!1)})}function Te(xe,Re,Je){F(_e(Re),function(At){xe.removeEventListener(At,Je,!1)})}function ze(xe,Re){for(;xe;){if(xe==Re)return!0;xe=xe.parentNode}return!1}function Ae(xe,Re){return xe.indexOf(Re)>-1}function _e(xe){return xe.trim().split(/\s+/g)}function pe(xe,Re,Je){if(xe.indexOf&&!Je)return xe.indexOf(Re);for(var At=0;At<xe.length;){if(Je&&xe[At][Je]==Re||!Je&&xe[At]===Re)return At;At++}return-1}function X(xe){return Array.prototype.slice.call(xe,0)}function ne(xe,Re,Je){for(var At=[],Ht=[],gr=0;gr<xe.length;){var wr=xe[gr][Re];pe(Ht,wr)<0&&At.push(xe[gr]),Ht[gr]=wr,gr++}return At=At.sort(function(Ii,Ui){return Ii[Re]>Ui[Re]}),At}function Be(xe,Re){for(var Je,At,Ht=Re[0].toUpperCase()+Re.slice(1),gr=0;gr<o.length;){if(Je=o[gr],At=Je?Je+Ht:Re,At in xe)return At;gr++}return i}var Ze=1;function Ce(){return Ze++}function Ne(xe){var Re=xe.ownerDocument||xe;return Re.defaultView||Re.parentWindow||e}var Ge=/mobile|tablet|ip(ad|hone|od)|android/i,Qe="ontouchstart"in e,rt=Be(e,"PointerEvent")!==i,tt=Qe&&Ge.test(navigator.userAgent),lt="touch",mt="pen",Tt="mouse",nt="kinect",cr=25,$t=1,Jt=2,Lt=4,lr=8,tn=1,Er=2,Ar=4,In=8,hr=16,pr=Er|Ar,rn=In|hr,Sr=pr|rn,ti=["x","y"],Jn=["clientX","clientY"];function un(xe,Re){var Je=this;this.manager=xe,this.callback=Re,this.element=xe.element,this.target=xe.options.inputTarget,this.domHandler=function(At){fe(xe.options.enable,[xe])&&Je.handler(At)},this.init()}un.prototype={handler:function(){},init:function(){this.evEl&&oe(this.element,this.evEl,this.domHandler),this.evTarget&&oe(this.target,this.evTarget,this.domHandler),this.evWin&&oe(Ne(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Te(this.element,this.evEl,this.domHandler),this.evTarget&&Te(this.target,this.evTarget,this.domHandler),this.evWin&&Te(Ne(this.element),this.evWin,this.domHandler)}};function Kn(xe){var Re,Je=xe.options.inputClass;return Je?Re=Je:rt?Re=Ee:tt?Re=de:Qe?Re=p:Re=kt,new Re(xe,Nn)}function Nn(xe,Re,Je){var At=Je.pointers.length,Ht=Je.changedPointers.length,gr=Re&$t&&At-Ht===0,wr=Re&(Lt|lr)&&At-Ht===0;Je.isFirst=!!gr,Je.isFinal=!!wr,gr&&(xe.session={}),Je.eventType=Re,vn(xe,Je),xe.emit("hammer.input",Je),xe.recognize(Je),xe.session.prevInput=Je}function vn(xe,Re){var Je=xe.session,At=Re.pointers,Ht=At.length;Je.firstInput||(Je.firstInput=dr(Re)),Ht>1&&!Je.firstMultiple?Je.firstMultiple=dr(Re):Ht===1&&(Je.firstMultiple=!1);var gr=Je.firstInput,wr=Je.firstMultiple,ii=wr?wr.center:gr.center,Ii=Re.center=Tr(At);Re.timeStamp=b(),Re.deltaTime=Re.timeStamp-gr.timeStamp,Re.angle=Ot(ii,Ii),Re.distance=Pe(ii,Ii),Wn(Je,Re),Re.offsetDirection=fi(Re.deltaX,Re.deltaY);var Ui=Zr(Re.deltaTime,Re.deltaX,Re.deltaY);Re.overallVelocityX=Ui.x,Re.overallVelocityY=Ui.y,Re.overallVelocity=g(Ui.x)>g(Ui.y)?Ui.x:Ui.y,Re.scale=wr?sr(wr.pointers,At):1,Re.rotation=wr?Vt(wr.pointers,At):0,Re.maxPointers=Je.prevInput?Re.pointers.length>Je.prevInput.maxPointers?Re.pointers.length:Je.prevInput.maxPointers:Re.pointers.length,Ut(Je,Re);var Vs=xe.element;ze(Re.srcEvent.target,Vs)&&(Vs=Re.srcEvent.target),Re.target=Vs}function Wn(xe,Re){var Je=Re.center,At=xe.offsetDelta||{},Ht=xe.prevDelta||{},gr=xe.prevInput||{};(Re.eventType===$t||gr.eventType===Lt)&&(Ht=xe.prevDelta={x:gr.deltaX||0,y:gr.deltaY||0},At=xe.offsetDelta={x:Je.x,y:Je.y}),Re.deltaX=Ht.x+(Je.x-At.x),Re.deltaY=Ht.y+(Je.y-At.y)}function Ut(xe,Re){var Je=xe.lastInterval||Re,At=Re.timeStamp-Je.timeStamp,Ht,gr,wr,ii;if(Re.eventType!=lr&&(At>cr||Je.velocity===i)){var Ii=Re.deltaX-Je.deltaX,Ui=Re.deltaY-Je.deltaY,Vs=Zr(At,Ii,Ui);gr=Vs.x,wr=Vs.y,Ht=g(Vs.x)>g(Vs.y)?Vs.x:Vs.y,ii=fi(Ii,Ui),xe.lastInterval=Re}else Ht=Je.velocity,gr=Je.velocityX,wr=Je.velocityY,ii=Je.direction;Re.velocity=Ht,Re.velocityX=gr,Re.velocityY=wr,Re.direction=ii}function dr(xe){for(var Re=[],Je=0;Je<xe.pointers.length;)Re[Je]={clientX:f(xe.pointers[Je].clientX),clientY:f(xe.pointers[Je].clientY)},Je++;return{timeStamp:b(),pointers:Re,center:Tr(Re),deltaX:xe.deltaX,deltaY:xe.deltaY}}function Tr(xe){var Re=xe.length;if(Re===1)return{x:f(xe[0].clientX),y:f(xe[0].clientY)};for(var Je=0,At=0,Ht=0;Ht<Re;)Je+=xe[Ht].clientX,At+=xe[Ht].clientY,Ht++;return{x:f(Je/Re),y:f(At/Re)}}function Zr(xe,Re,Je){return{x:Re/xe||0,y:Je/xe||0}}function fi(xe,Re){return xe===Re?tn:g(xe)>=g(Re)?xe<0?Er:Ar:Re<0?In:hr}function Pe(xe,Re,Je){Je||(Je=ti);var At=Re[Je[0]]-xe[Je[0]],Ht=Re[Je[1]]-xe[Je[1]];return Math.sqrt(At*At+Ht*Ht)}function Ot(xe,Re,Je){Je||(Je=ti);var At=Re[Je[0]]-xe[Je[0]],Ht=Re[Je[1]]-xe[Je[1]];return Math.atan2(Ht,At)*180/Math.PI}function Vt(xe,Re){return Ot(Re[1],Re[0],Jn)+Ot(xe[1],xe[0],Jn)}function sr(xe,Re){return Pe(Re[0],Re[1],Jn)/Pe(xe[0],xe[1],Jn)}var Ye={mousedown:$t,mousemove:Jt,mouseup:Lt},Mt="mousedown",ge="mousemove mouseup";function kt(){this.evEl=Mt,this.evWin=ge,this.pressed=!1,un.apply(this,arguments)}V(kt,un,{handler:function(Re){var Je=Ye[Re.type];Je&$t&&Re.button===0&&(this.pressed=!0),Je&Jt&&Re.which!==1&&(Je=Lt),this.pressed&&(Je&Lt&&(this.pressed=!1),this.callback(this.manager,Je,{pointers:[Re],changedPointers:[Re],pointerType:Tt,srcEvent:Re}))}});var wt={pointerdown:$t,pointermove:Jt,pointerup:Lt,pointercancel:lr,pointerout:lr},W={2:lt,3:mt,4:Tt,5:nt},yt="pointerdown",Et="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(yt="MSPointerDown",Et="MSPointerMove MSPointerUp MSPointerCancel");function Ee(){this.evEl=yt,this.evWin=Et,un.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}V(Ee,un,{handler:function(Re){var Je=this.store,At=!1,Ht=Re.type.toLowerCase().replace("ms",""),gr=wt[Ht],wr=W[Re.pointerType]||Re.pointerType,ii=wr==lt,Ii=pe(Je,Re.pointerId,"pointerId");gr&$t&&(Re.button===0||ii)?Ii<0&&(Je.push(Re),Ii=Je.length-1):gr&(Lt|lr)&&(At=!0),!(Ii<0)&&(Je[Ii]=Re,this.callback(this.manager,gr,{pointers:Je,changedPointers:[Re],pointerType:wr,srcEvent:Re}),At&&Je.splice(Ii,1))}});var Xe={touchstart:$t,touchmove:Jt,touchend:Lt,touchcancel:lr},ct="touchstart",Z="touchstart touchmove touchend touchcancel";function ie(){this.evTarget=ct,this.evWin=Z,this.started=!1,un.apply(this,arguments)}V(ie,un,{handler:function(Re){var Je=Xe[Re.type];if(Je===$t&&(this.started=!0),!!this.started){var At=ue.call(this,Re,Je);Je&(Lt|lr)&&At[0].length-At[1].length===0&&(this.started=!1),this.callback(this.manager,Je,{pointers:At[0],changedPointers:At[1],pointerType:lt,srcEvent:Re})}}});function ue(xe,Re){var Je=X(xe.touches),At=X(xe.changedTouches);return Re&(Lt|lr)&&(Je=ne(Je.concat(At),"identifier")),[Je,At]}var ve={touchstart:$t,touchmove:Jt,touchend:Lt,touchcancel:lr},Oe="touchstart touchmove touchend touchcancel";function de(){this.evTarget=Oe,this.targetIds={},un.apply(this,arguments)}V(de,un,{handler:function(Re){var Je=ve[Re.type],At=be.call(this,Re,Je);At&&this.callback(this.manager,Je,{pointers:At[0],changedPointers:At[1],pointerType:lt,srcEvent:Re})}});function be(xe,Re){var Je=X(xe.touches),At=this.targetIds;if(Re&($t|Jt)&&Je.length===1)return At[Je[0].identifier]=!0,[Je,Je];var Ht,gr,wr=X(xe.changedTouches),ii=[],Ii=this.target;if(gr=Je.filter(function(Ui){return ze(Ui.target,Ii)}),Re===$t)for(Ht=0;Ht<gr.length;)At[gr[Ht].identifier]=!0,Ht++;for(Ht=0;Ht<wr.length;)At[wr[Ht].identifier]&&ii.push(wr[Ht]),Re&(Lt|lr)&&delete At[wr[Ht].identifier],Ht++;if(ii.length)return[ne(gr.concat(ii),"identifier"),ii]}var ce=2500,Se=25;function p(){un.apply(this,arguments);var xe=K(this.handler,this);this.touch=new de(this.manager,xe),this.mouse=new kt(this.manager,xe),this.primaryTouch=null,this.lastTouches=[]}V(p,un,{handler:function(Re,Je,At){var Ht=At.pointerType==lt,gr=At.pointerType==Tt;if(!(gr&&At.sourceCapabilities&&At.sourceCapabilities.firesTouchEvents)){if(Ht)le.call(this,Je,At);else if(gr&&Ke.call(this,At))return;this.callback(Re,Je,At)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function le(xe,Re){xe&$t?(this.primaryTouch=Re.changedPointers[0].identifier,vt.call(this,Re)):xe&(Lt|lr)&&vt.call(this,Re)}function vt(xe){var Re=xe.changedPointers[0];if(Re.identifier===this.primaryTouch){var Je={x:Re.clientX,y:Re.clientY};this.lastTouches.push(Je);var At=this.lastTouches,Ht=function(){var gr=At.indexOf(Je);gr>-1&&At.splice(gr,1)};setTimeout(Ht,ce)}}function Ke(xe){for(var Re=xe.srcEvent.clientX,Je=xe.srcEvent.clientY,At=0;At<this.lastTouches.length;At++){var Ht=this.lastTouches[At],gr=Math.abs(Re-Ht.x),wr=Math.abs(Je-Ht.y);if(gr<=Se&&wr<=Se)return!0}return!1}var Ct=Be(s.style,"touchAction"),It=Ct!==i,Ft="compute",ut="auto",Dt="manipulation",St="none",zt="pan-x",Fr="pan-y",qt=Gr();function $r(xe,Re){this.manager=xe,this.set(Re)}$r.prototype={set:function(xe){xe==Ft&&(xe=this.compute()),It&&this.manager.element.style&&qt[xe]&&(this.manager.element.style[Ct]=xe),this.actions=xe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var xe=[];return F(this.manager.recognizers,function(Re){fe(Re.options.enable,[Re])&&(xe=xe.concat(Re.getTouchAction()))}),en(xe.join(" "))},preventDefaults:function(xe){var Re=xe.srcEvent,Je=xe.offsetDirection;if(this.manager.session.prevented){Re.preventDefault();return}var At=this.actions,Ht=Ae(At,St)&&!qt[St],gr=Ae(At,Fr)&&!qt[Fr],wr=Ae(At,zt)&&!qt[zt];if(Ht){var ii=xe.pointers.length===1,Ii=xe.distance<2,Ui=xe.deltaTime<250;if(ii&&Ii&&Ui)return}if(!(wr&&gr)&&(Ht||gr&&Je&pr||wr&&Je&rn))return this.preventSrc(Re)},preventSrc:function(xe){this.manager.session.prevented=!0,xe.preventDefault()}};function en(xe){if(Ae(xe,St))return St;var Re=Ae(xe,zt),Je=Ae(xe,Fr);return Re&&Je?St:Re||Je?Re?zt:Fr:Ae(xe,Dt)?Dt:ut}function Gr(){if(!It)return!1;var xe={},Re=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Je){xe[Je]=Re?e.CSS.supports("touch-action",Je):!0}),xe}var Vr=1,Lr=2,hi=4,Hr=8,fr=Hr,Me=16,Wt=32;function Kr(xe){this.options=U({},this.defaults,xe||{}),this.id=Ce(),this.manager=null,this.options.enable=Q(this.options.enable,!0),this.state=Vr,this.simultaneous={},this.requireFail=[]}Kr.prototype={defaults:{},set:function(xe){return U(this.options,xe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(xe){if(S(xe,"recognizeWith",this))return this;var Re=this.simultaneous;return xe=ri(xe,this),Re[xe.id]||(Re[xe.id]=xe,xe.recognizeWith(this)),this},dropRecognizeWith:function(xe){return S(xe,"dropRecognizeWith",this)?this:(xe=ri(xe,this),delete this.simultaneous[xe.id],this)},requireFailure:function(xe){if(S(xe,"requireFailure",this))return this;var Re=this.requireFail;return xe=ri(xe,this),pe(Re,xe)===-1&&(Re.push(xe),xe.requireFailure(this)),this},dropRequireFailure:function(xe){if(S(xe,"dropRequireFailure",this))return this;xe=ri(xe,this);var Re=pe(this.requireFail,xe);return Re>-1&&this.requireFail.splice(Re,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(xe){return!!this.simultaneous[xe.id]},emit:function(xe){var Re=this,Je=this.state;function At(Ht){Re.manager.emit(Ht,xe)}Je<Hr&&At(Re.options.event+Ni(Je)),At(Re.options.event),xe.additionalEvent&&At(xe.additionalEvent),Je>=Hr&&At(Re.options.event+Ni(Je))},tryEmit:function(xe){if(this.canEmit())return this.emit(xe);this.state=Wt},canEmit:function(){for(var xe=0;xe<this.requireFail.length;){if(!(this.requireFail[xe].state&(Wt|Vr)))return!1;xe++}return!0},recognize:function(xe){var Re=U({},xe);if(!fe(this.options.enable,[this,Re])){this.reset(),this.state=Wt;return}this.state&(fr|Me|Wt)&&(this.state=Vr),this.state=this.process(Re),this.state&(Lr|hi|Hr|Me)&&this.tryEmit(Re)},process:function(xe){},getTouchAction:function(){},reset:function(){}};function Ni(xe){return xe&Me?"cancel":xe&Hr?"end":xe&hi?"move":xe&Lr?"start":""}function sa(xe){return xe==hr?"down":xe==In?"up":xe==Er?"left":xe==Ar?"right":""}function ri(xe,Re){var Je=Re.manager;return Je?Je.get(xe):xe}function kn(){Kr.apply(this,arguments)}V(kn,Kr,{defaults:{pointers:1},attrTest:function(xe){var Re=this.options.pointers;return Re===0||xe.pointers.length===Re},process:function(xe){var Re=this.state,Je=xe.eventType,At=Re&(Lr|hi),Ht=this.attrTest(xe);return At&&(Je&lr||!Ht)?Re|Me:At||Ht?Je&Lt?Re|Hr:Re&Lr?Re|hi:Lr:Wt}});function Ie(){kn.apply(this,arguments),this.pX=null,this.pY=null}V(Ie,kn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Sr},getTouchAction:function(){var xe=this.options.direction,Re=[];return xe&pr&&Re.push(Fr),xe&rn&&Re.push(zt),Re},directionTest:function(xe){var Re=this.options,Je=!0,At=xe.distance,Ht=xe.direction,gr=xe.deltaX,wr=xe.deltaY;return Ht&Re.direction||(Re.direction&pr?(Ht=gr===0?tn:gr<0?Er:Ar,Je=gr!=this.pX,At=Math.abs(xe.deltaX)):(Ht=wr===0?tn:wr<0?In:hr,Je=wr!=this.pY,At=Math.abs(xe.deltaY))),xe.direction=Ht,Je&&At>Re.threshold&&Ht&Re.direction},attrTest:function(xe){return kn.prototype.attrTest.call(this,xe)&&(this.state&Lr||!(this.state&Lr)&&this.directionTest(xe))},emit:function(xe){this.pX=xe.deltaX,this.pY=xe.deltaY;var Re=sa(xe.direction);Re&&(xe.additionalEvent=this.options.event+Re),this._super.emit.call(this,xe)}});function Do(){kn.apply(this,arguments)}V(Do,kn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[St]},attrTest:function(xe){return this._super.attrTest.call(this,xe)&&(Math.abs(xe.scale-1)>this.options.threshold||this.state&Lr)},emit:function(xe){if(xe.scale!==1){var Re=xe.scale<1?"in":"out";xe.additionalEvent=this.options.event+Re}this._super.emit.call(this,xe)}});function Un(){Kr.apply(this,arguments),this._timer=null,this._input=null}V(Un,Kr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ut]},process:function(xe){var Re=this.options,Je=xe.pointers.length===Re.pointers,At=xe.distance<Re.threshold,Ht=xe.deltaTime>Re.time;if(this._input=xe,!At||!Je||xe.eventType&(Lt|lr)&&!Ht)this.reset();else if(xe.eventType&$t)this.reset(),this._timer=T(function(){this.state=fr,this.tryEmit()},Re.time,this);else if(xe.eventType&Lt)return fr;return Wt},reset:function(){clearTimeout(this._timer)},emit:function(xe){this.state===fr&&(xe&&xe.eventType&Lt?this.manager.emit(this.options.event+"up",xe):(this._input.timeStamp=b(),this.manager.emit(this.options.event,this._input)))}});function Oo(){kn.apply(this,arguments)}V(Oo,kn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[St]},attrTest:function(xe){return this._super.attrTest.call(this,xe)&&(Math.abs(xe.rotation)>this.options.threshold||this.state&Lr)}});function Si(){kn.apply(this,arguments)}V(Si,kn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:pr|rn,pointers:1},getTouchAction:function(){return Ie.prototype.getTouchAction.call(this)},attrTest:function(xe){var Re=this.options.direction,Je;return Re&(pr|rn)?Je=xe.overallVelocity:Re&pr?Je=xe.overallVelocityX:Re&rn&&(Je=xe.overallVelocityY),this._super.attrTest.call(this,xe)&&Re&xe.offsetDirection&&xe.distance>this.options.threshold&&xe.maxPointers==this.options.pointers&&g(Je)>this.options.velocity&&xe.eventType&Lt},emit:function(xe){var Re=sa(xe.offsetDirection);Re&&this.manager.emit(this.options.event+Re,xe),this.manager.emit(this.options.event,xe)}});function ni(){Kr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}V(ni,Kr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Dt]},process:function(xe){var Re=this.options,Je=xe.pointers.length===Re.pointers,At=xe.distance<Re.threshold,Ht=xe.deltaTime<Re.time;if(this.reset(),xe.eventType&$t&&this.count===0)return this.failTimeout();if(At&&Ht&&Je){if(xe.eventType!=Lt)return this.failTimeout();var gr=this.pTime?xe.timeStamp-this.pTime<Re.interval:!0,wr=!this.pCenter||Pe(this.pCenter,xe.center)<Re.posThreshold;this.pTime=xe.timeStamp,this.pCenter=xe.center,!wr||!gr?this.count=1:this.count+=1,this._input=xe;var ii=this.count%Re.taps;if(ii===0)return this.hasRequireFailures()?(this._timer=T(function(){this.state=fr,this.tryEmit()},Re.interval,this),Lr):fr}return Wt},failTimeout:function(){return this._timer=T(function(){this.state=Wt},this.options.interval,this),Wt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==fr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function wi(xe,Re){return Re=Re||{},Re.recognizers=Q(Re.recognizers,wi.defaults.preset),new ki(xe,Re)}wi.VERSION="2.0.7",wi.defaults={domEvents:!1,touchAction:Ft,enable:!0,inputTarget:null,inputClass:null,preset:[[Oo,{enable:!1}],[Do,{enable:!1},["rotate"]],[Si,{direction:pr}],[Ie,{direction:pr},["swipe"]],[ni],[ni,{event:"doubletap",taps:2},["tap"]],[Un]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Tn=1,ls=2;function ki(xe,Re){this.options=U({},wi.defaults,Re||{}),this.options.inputTarget=this.options.inputTarget||xe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=xe,this.input=Kn(this),this.touchAction=new $r(this,this.options.touchAction),Ss(this,!0),F(this.options.recognizers,function(Je){var At=this.add(new Je[0](Je[1]));Je[2]&&At.recognizeWith(Je[2]),Je[3]&&At.requireFailure(Je[3])},this)}ki.prototype={set:function(xe){return U(this.options,xe),xe.touchAction&&this.touchAction.update(),xe.inputTarget&&(this.input.destroy(),this.input.target=xe.inputTarget,this.input.init()),this},stop:function(xe){this.session.stopped=xe?ls:Tn},recognize:function(xe){var Re=this.session;if(!Re.stopped){this.touchAction.preventDefaults(xe);var Je,At=this.recognizers,Ht=Re.curRecognizer;(!Ht||Ht&&Ht.state&fr)&&(Ht=Re.curRecognizer=null);for(var gr=0;gr<At.length;)Je=At[gr],Re.stopped!==ls&&(!Ht||Je==Ht||Je.canRecognizeWith(Ht))?Je.recognize(xe):Je.reset(),!Ht&&Je.state&(Lr|hi|Hr)&&(Ht=Re.curRecognizer=Je),gr++}},get:function(xe){if(xe instanceof Kr)return xe;for(var Re=this.recognizers,Je=0;Je<Re.length;Je++)if(Re[Je].options.event==xe)return Re[Je];return null},add:function(xe){if(S(xe,"add",this))return this;var Re=this.get(xe.options.event);return Re&&this.remove(Re),this.recognizers.push(xe),xe.manager=this,this.touchAction.update(),xe},remove:function(xe){if(S(xe,"remove",this))return this;if(xe=this.get(xe),xe){var Re=this.recognizers,Je=pe(Re,xe);Je!==-1&&(Re.splice(Je,1),this.touchAction.update())}return this},on:function(xe,Re){if(xe!==i&&Re!==i){var Je=this.handlers;return F(_e(xe),function(At){Je[At]=Je[At]||[],Je[At].push(Re)}),this}},off:function(xe,Re){if(xe!==i){var Je=this.handlers;return F(_e(xe),function(At){Re?Je[At]&&Je[At].splice(pe(Je[At],Re),1):delete Je[At]}),this}},emit:function(xe,Re){this.options.domEvents&&xn(xe,Re);var Je=this.handlers[xe]&&this.handlers[xe].slice();if(!(!Je||!Je.length)){Re.type=xe,Re.preventDefault=function(){Re.srcEvent.preventDefault()};for(var At=0;At<Je.length;)Je[At](Re),At++}},destroy:function(){this.element&&Ss(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ss(xe,Re){var Je=xe.element;if(Je.style){var At;F(xe.options.cssProps,function(Ht,gr){At=Be(Je.style,gr),Re?(xe.oldCssProps[At]=Je.style[At],Je.style[At]=Ht):Je.style[At]=xe.oldCssProps[At]||""}),Re||(xe.oldCssProps={})}}function xn(xe,Re){var Je=t.createEvent("Event");Je.initEvent(xe,!0,!0),Je.gesture=Re,Re.target.dispatchEvent(Je)}U(wi,{INPUT_START:$t,INPUT_MOVE:Jt,INPUT_END:Lt,INPUT_CANCEL:lr,STATE_POSSIBLE:Vr,STATE_BEGAN:Lr,STATE_CHANGED:hi,STATE_ENDED:Hr,STATE_RECOGNIZED:fr,STATE_CANCELLED:Me,STATE_FAILED:Wt,DIRECTION_NONE:tn,DIRECTION_LEFT:Er,DIRECTION_RIGHT:Ar,DIRECTION_UP:In,DIRECTION_DOWN:hr,DIRECTION_HORIZONTAL:pr,DIRECTION_VERTICAL:rn,DIRECTION_ALL:Sr,Manager:ki,Input:un,TouchAction:$r,TouchInput:de,MouseInput:kt,PointerEventInput:Ee,TouchMouseInput:p,SingleTouchInput:ie,Recognizer:Kr,AttrRecognizer:kn,Tap:ni,Pan:Ie,Swipe:Si,Pinch:Do,Rotate:Oo,Press:Un,on:oe,off:Te,each:F,merge:z,extend:j,assign:U,inherit:V,bindFn:K,prefixed:Be});var rl=typeof e<"u"?e:typeof self<"u"?self:{};rl.Hammer=wi,r.exports?r.exports=wi:e[n]=wi})(window,document,"Hammer")}(Xv)),Xv.exports}var mg=kW();const UW=th(mg),Uc=bk({__proto__:null,default:UW},[mg]),$D=1,KD=2,o2=4,zW={mousedown:$D,mousemove:KD,mouseup:o2};function GW(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return!0;return!1}function VW(r){const e=r.prototype.handler;r.prototype.handler=function(n){const i=this.store;n.button>0&&n.type==="pointerdown"&&(GW(i,o=>o.pointerId===n.pointerId)||i.push(n)),e.call(this,n)}}function HW(r){r.prototype.handler=function(t){let n=zW[t.type];n&$D&&t.button>=0&&(this.pressed=!0),n&KD&&t.buttons===0&&(n=o2),this.pressed&&(n&o2&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}VW(mg.PointerEventInput);HW(mg.MouseInput);const jW=mg.Manager;class Z_{constructor(e,t,n){this.element=e,this.callback=t,this.options={enable:!0,...n}}}const JW=Uc?[[Uc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Uc.Rotate,{enable:!1}],[Uc.Pinch,{enable:!1}],[Uc.Swipe,{enable:!1}],[Uc.Pan,{threshold:0,enable:!1}],[Uc.Press,{enable:!1}],[Uc.Tap,{event:"doubletap",taps:2,enable:!1}],[Uc.Tap,{event:"anytap",enable:!1}],[Uc.Tap,{enable:!1}]]:null,QB={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},WW={doubletap:["tap"]},XW={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},jx={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},$W={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},eS={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},KW=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Od=typeof window<"u"?window:global;let a2=!1;try{const r={get passive(){return a2=!0,!0}};Od.addEventListener("test",null,r),Od.removeEventListener("test",null)}catch{a2=!1}const qW=KW.indexOf("firefox")!==-1,{WHEEL_EVENTS:ZW}=jx,tS="wheel",rS=4.000244140625,YW=40,QW=.25;class eX extends Z_{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;Od.WheelEvent&&(qW&&i.deltaMode===Od.WheelEvent.DOM_DELTA_PIXEL&&(o/=Od.devicePixelRatio),i.deltaMode===Od.WheelEvent.DOM_DELTA_LINE&&(o*=YW)),o!==0&&o%rS===0&&(o=Math.floor(o/rS)),i.shiftKey&&o&&(o=o*QW),this.callback({type:tS,center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(ZW),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,a2?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===tS&&(this.options.enable=t)}}const{MOUSE_EVENTS:tX}=jx,nS="pointermove",iS="pointerover",sS="pointerout",oS="pointerenter",aS="pointerleave";class rX extends Z_{constructor(e,t,n){super(e,t,n),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(tX),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===nS&&(this.enableMoveEvent=t),e===iS&&(this.enableOverEvent=t),e===sS&&(this.enableOutEvent=t),e===oS&&(this.enableEnterEvent=t),e===aS&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(iS,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(sS,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(oS,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(aS,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(nS,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:nX}=jx,cS="keydown",lS="keyup";class iX extends Z_{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{const o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:cS,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:lS,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(nX),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===cS&&(this.enableDownEvent=t),e===lS&&(this.enableUpEvent=t)}}const uS="contextmenu";class sX extends Z_{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:uS,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===uS&&(this.options.enable=t)}}const fS=1,c2=2,hS=4,oX={pointerdown:fS,pointermove:c2,pointerup:hS,mousedown:fS,mousemove:c2,mouseup:hS},aX=0,cX=1,lX=2,uX=1,fX=2,hX=4;function dX(r){const e=oX[r.srcEvent.type];if(!e)return null;const{buttons:t,button:n}=r.srcEvent;let i=!1,o=!1,s=!1;return e===c2?(i=!!(t&uX),o=!!(t&hX),s=!!(t&fX)):(i=n===aX,o=n===cX,s=n===lX),{leftButton:i,middleButton:o,rightButton:s}}function AX(r,e){const t=r.center;if(!t)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,o=n.height/e.offsetHeight||1,s={x:(t.x-n.left-e.clientLeft)/i,y:(t.y-n.top-e.clientTop)/o};return{center:t,offsetCenter:s}}const $v={srcElement:"root",priority:0};class pX{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const n=this._normalizeEvent(t);let i=t.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,o=!1){const{handlers:s,handlersByElement:c}=this;let f=$v;typeof n=="string"||n&&n.addEventListener?f={...$v,srcElement:n}:n&&(f={...$v,...n});let g=c.get(f.srcElement);g||(g=[],c.set(f.srcElement,g));const b={type:e,handler:t,srcElement:f.srcElement,priority:f.priority};i&&(b.once=!0),o&&(b.passive=!0),s.push(b),this._active=this._active||!b.passive;let T=g.length-1;for(;T>=0&&!(g[T].priority>=b.priority);)T--;g.splice(T+1,0,b)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let o=n.length-1;o>=0;o--){const s=n[o];if(s.type===e&&s.handler===t){n.splice(o,1);const c=i.get(s.srcElement);c.splice(c.indexOf(s),1),c.length===0&&i.delete(s.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let i=!1;const o=()=>{e.handled=!0},s=()=>{e.handled=!0,i=!0},c=[];for(let f=0;f<n.length;f++){const{type:g,handler:b,once:T}=n[f];if(b({...e,type:g,stopPropagation:o,stopImmediatePropagation:s}),T&&c.push(n[f]),i)break}for(let f=0;f<c.length;f++){const{type:g,handler:b}=c[f];this.remove(g,b)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...dX(e),...AX(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const gX={events:null,recognizers:null,recognizerOptions:{},Manager:jW,touchAction:"none",tabIndex:0};class qD{constructor(e=null,t){this._onBasicInput=i=>{const{srcEvent:o}=i,s=XW[o.type];s&&this.manager.emit(s,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...gX,...t},this.events=new Map,this.setElement(e);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,n=t.Manager;this.manager=new n(e,{touchAction:t.touchAction,recognizers:t.recognizers||JW}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(QB).forEach(i=>{const o=this.manager.get(i);o&&QB[i].forEach(s=>{o.recognizeWith(s)})});for(const i in t.recognizerOptions){const o=this.manager.get(i);if(o){const s=t.recognizerOptions[i];delete s.enable,o.set(s)}}this.wheelInput=new eX(e,this._onOtherEvent,{enable:!1}),this.moveInput=new rX(e,this._onOtherEvent,{enable:!1}),this.keyInput=new iX(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new sX(e,this._onOtherEvent,{enable:!1});for(const[i,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(i,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const i=n.get(e);if(i&&i.options.enable!==t){i.set({enable:t});const o=WW[e];o&&!this.options.recognizers&&o.forEach(s=>{const c=n.get(s);t?(c.requireFailure(e),i.dropRequireFailure(s)):c.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,n,i,o){if(typeof e!="string"){n=t;for(const b in e)this._addEventHandler(b,e[b],n,i,o);return}const{manager:s,events:c}=this,f=eS[e]||e;let g=c.get(f);g||(g=new pX(this),c.set(f,g),g.recognizerName=$W[f]||f,s&&s.on(f,g.handleEvent)),g.add(e,t,n,i,o),g.isEmpty()||this._toggleRecognizer(g.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const s in e)this._removeEventHandler(s,e[s]);return}const{events:n}=this,i=eS[e]||e,o=n.get(i);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:s}=o;let c=!1;for(const f of n.values())if(f.recognizerName===s&&!f.isEmpty()){c=!0;break}c||this._toggleRecognizer(s,!1)}}}function Cu(){}const mX=({isDragging:r})=>r?"grabbing":"grab",ZD={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Cu,onWebGLInitialized:Cu,onResize:Cu,onViewStateChange:Cu,onInteractionStateChange:Cu,onBeforeRender:Cu,onAfterRender:Cu,onLoad:Cu,onError:r=>Ur.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:mX,getTooltip:null,debug:!1,drawPickingColors:!1};class Jx{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new vA({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=Xb[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;const s=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:s,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:f}=c,g=f&&(f[i.handler]||f.props[i.handler]),b=this.props[i.handler];let T=!1;g&&(T=g.call(f,c,n)),T||(b==null||b(c,n),this.widgetManager.onEvent(c,n))},this._onPointerDown=n=>{const i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...ZD,...e},e=this.props,e.viewState&&e.initialViewState&&Ur.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&Ur.error("WebGL1 context not supported.")(),this.device=kp.attach(e.gl));let t=this.device;t||(Hd.registerDevices([kp]),t=Hd.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&aA.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,i,o,s,c,f,g,b;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(o=this.effectManager)==null||o.finalize(),this.effectManager=null,(s=this.deckRenderer)==null||s.finalize(),this.deckRenderer=null,(c=this.deckPicker)==null||c.finalize(),this.deckPicker=null,(f=this.eventManager)==null||f.destroy(),this.eventManager=null,(g=this.widgetManager)==null||g.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((b=this.canvas.parentElement)==null||b.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Ur.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Ur.removed("onLayerClick","onClick")(),e.initialViewState&&!io(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return t=t||n||i||o||s,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return zs(this.viewManager),this.viewManager.views}getViewports(e){return zs(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,n){zs(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),zs(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:t,height:n}=e;if(t||t===0){const o=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=o}if(n||n===0){const o=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var i,o;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,(i=this.viewManager)==null||i.setProps({width:t,height:n}),(o=this.layerManager)==null||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:i,useDevicePixels:o}=t;return new CH({device:e,useDevicePixels:o,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new RD({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,n,i;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:s}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let c=s,f=!1;for(const g of o)c=g,f=((t=g.layer)==null?void 0:t.onHover(g,e.event))||f;f||((i=(n=this.props).onHover)==null||i.call(n,c,e.event),this.widgetManager.onHover(c,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,o;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof kp&&this.props.onWebGLInitialized(this.device.gl);const t=new TD;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new qD(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in Xb)this.eventManager.on(s,this._onEvent);this.viewManager=new oj({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new sj(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new xj({deck:this,device:this.device}),this.deckRenderer=new Ej(this.device),this.deckPicker=new Pj(this.device),this.widgetManager=new Dj({deck:this,parentElement:(o=this.canvas)==null?void 0:o.parentElement}),this.widgetManager.addDefault(new Lj),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var s;const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(s=this.deckRenderer)==null||s.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ur.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=Hd.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Jx.defaultProps=ZD;Jx.VERSION=aU;function _X(r){switch(r){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return FF(r)}}const yX=RF;function S0(r,e){return{attribute:r,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Uf(r){return r.stride||r.size*r.bytesPerElement}function vX(r,e){return r.type===e.type&&r.size===e.size&&Uf(r)===Uf(e)&&(r.offset||0)===(e.offset||0)}function l2(r,e){e.offset&&Ur.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Uf(r),n=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,i=e.elementOffset||0,o=n*t+i*r.bytesPerElement+(r.offset||0);return{...e,offset:o,stride:t}}function bX(r,e){const t=l2(r,e);return{high:t,low:{...t,offset:t.offset+r.size*4}}}class xX{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,o=i==="float64";let{defaultValue:s}=t;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let c;o?c="float32":!i&&t.isIndexed?c="uint32":c=i||"float32";let f=_X(i||c);this.doublePrecision=o,o&&t.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...t,defaultType:f,defaultValue:s,logicalType:i,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Uf(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),aA.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const i=this.value;if(t){const o=l2(this.getAccessor(),t),s=o.offset/i.BYTES_PER_ELEMENT,c=o.size||this.size;n[e]=i.subarray(s,s+c)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),i=[],o={name:this.id,byteStride:Uf(n),attributes:i};if(this.doublePrecision){const s=bX(n,t||{});i.push(S0(e,{...n,...s.high}),S0(`${e}64Low`,{...n,...s.low}))}else if(t){const s=l2(n,t);i.push(S0(e,{...n,...s}))}else i.push(S0(e,n));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,o=n*i;if(t&&o&&t.length>=o){const s=new Array(i).fill(1/0),c=new Array(i).fill(-1/0);for(let f=0;f<o;)for(let g=0;g<i;g++){const b=t[f++];b<s[g]&&(s[g]=b),b>c[g]&&(c[g]=b)}e=[s,c]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof $i?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const s=yX(n.value);i.type=i.normalized?s.replace("int","norm"):s}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Uf(i)}if(t.bounds=null,n.constant){let o=n.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(n.buffer){const o=n.buffer;t.externalBuffer=o,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let o=n.value;t.externalBuffer=null,t.constant=!1,this.value=o;let{buffer:s}=this;const c=Uf(i),f=(i.vertexOffset||0)*c;if(this.doublePrecision&&o instanceof Float64Array&&(o=Dv(o,i)),this.settings.isIndexed){const b=this.settings.defaultType;o.constructor!==b&&(o=new b(o))}const g=o.byteLength+f+c*2;(!s||s.byteLength<g)&&(s=this._createBuffer(g)),s.write(o,f)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Dv(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,i=n.allocatedValue,o=aA.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{byteOffset:s}=this;let{buffer:c}=this;return(!c||c.byteLength<o.byteLength+s)&&(c=this._createBuffer(o.byteLength+s),t&&i&&c.write(i instanceof Float64Array?Dv(i,this):i,s)),n.allocatedValue=o,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof n)&&this.settings.normalized&&!("normalized"in e)&&Ur.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:o}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let s=o;for(;--s>=0;)t[n+s]=i[s];return t}switch(o){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let s=o;for(;--s>=0;)t[n+s]=Number.isFinite(e[s])?e[s]:i[s]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:t?$i.INDEX:$i.VERTEX,indexType:t?n:void 0,byteLength:e}),this._buffer}}const dS=[],AS=[];function el(r,e=0,t=1/0){let n=dS;const i={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(AS.length=r.length,n=AS):n=dS,(e>0||Number.isFinite(t))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,t),i.index=e-1),{iterable:n,objectInfo:i}}function YD(r){return r&&r[Symbol.asyncIterator]}function QD(r,e){const{size:t,stride:n,offset:i,startIndices:o,nested:s}=e,c=r.BYTES_PER_ELEMENT,f=n?n/c:t,g=i?i/c:0,b=Math.floor((r.length-g)/f);return(T,{index:S,target:F})=>{if(!o){const z=S*f+g;for(let V=0;V<t;V++)F[V]=r[z+V];return F}const k=o[S],U=o[S+1]||b;let j;if(s){j=new Array(U-k);for(let z=k;z<U;z++){const V=z*f+g;F=new Array(t);for(let K=0;K<t;K++)F[K]=r[V+K];j[z-k]=F}}else if(f===t)j=r.subarray(k*t+g,U*t+g);else{j=new r.constructor((U-k)*t);let z=0;for(let V=k;V<U;V++){const K=V*f+g;for(let fe=0;fe<t;fe++)j[z++]=r[K+fe]}}return j}}const wX=[],gm=[[0,1/0]];function CX(r,e){if(r===gm||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;const t=[],n=r.length;let i=0;for(let o=0;o<n;o++){const s=r[o];s[1]<e[0]?(t.push(s),i=o+1):s[0]>e[1]?t.push(s):e=[Math.min(s[0],e[0]),Math.max(s[1],e[1])]}return t.splice(i,0,e),t}const EX={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function eO(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const t=r.type||"interpolation";return{...EX[t],...e,...r,type:t}}class tO extends xX{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:gm}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!vX(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,i=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return eO(i,n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:n=0,endRow:i=1/0}=t;this.state.updateRanges=CX(this.state.updateRanges,[n,i])}else this.state.updateRanges=gm}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=wX}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,t.updateRanges!==gm),!0):!1}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:s,noAlloc:c}}=this;let f=!0;if(s){for(const[g,b]of o)s.call(i,this,{data:t,startRow:g,endRow:b,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[g,b]of o){const T=Number.isFinite(g)?this.getVertexOffset(g):0,S=Number.isFinite(b)?this.getVertexOffset(b):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:T,endOffset:S})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const s=e;zs(ArrayBuffer.isView(s.value),`invalid ${i.accessor}`);const c=!!s.size&&s.size!==this.size;return n.binaryAccessor=QD(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:t,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!t)return n;for(const o in t){const s=super._getBufferLayout(o,t[o]);n.attributes.push(...s.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:i,props:o,numInstances:s}){if(e.constant)return;const{settings:c,state:f,value:g,size:b,startIndices:T}=e,{accessor:S,transform:F}=c,k=f.binaryAccessor||(typeof S=="function"?S:o[S]);zs(typeof k=="function",`accessor "${S}" is not a function`);let U=e.getVertexOffset(n);const{iterable:j,objectInfo:z}=el(t,n,i);for(const V of j){z.index++;let K=k(V,z);if(F&&(K=F.call(this,K)),T){const fe=(z.index<T.length-1?T[z.index+1]:s)-T[z.index];if(K&&Array.isArray(K[0])){let Q=U;for(const oe of K)e._normalizeValue(oe,g,Q),Q+=b}else K&&K.length>b?g.set(K,U):(e._normalizeValue(K,z.target,0),ej({target:g,source:z.target,start:U,count:fe}));U+=fe*b}else e._normalizeValue(K,g,U),U+=b}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Kv(r){const{source:e,target:t,start:n=0,size:i,getData:o}=r,s=r.end||t.length,c=e.length,f=s-n;if(c>f){t.set(e.subarray(0,f),n);return}if(t.set(e,n),!o)return;let g=c;for(;g<f;){const b=o(g,e);for(let T=0;T<i;T++)t[n+g]=b[T]||0,g++}}function TX({source:r,target:e,size:t,getData:n,sourceStartIndices:i,targetStartIndices:o}){if(!i||!o)return Kv({source:r,target:e,size:t,getData:n}),e;let s=0,c=0;const f=n&&((b,T)=>n(b+c,T)),g=Math.min(i.length,o.length);for(let b=1;b<g;b++){const T=i[b]*t,S=o[b]*t;Kv({source:r.subarray(s,T),target:e,start:c,end:S,size:t,getData:f}),s=T,c=S}return c<e.length&&Kv({source:[],target:e,start:c,size:t,getData:f}),e}function BX(r){const{device:e,settings:t,value:n}=r,i=new tO(e,t);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function rO(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${r}"`)}}function nO(r){switch(r){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function iO(r){r.push(r.shift())}function SX(r,e){const{doublePrecision:t,settings:n,value:i,size:o}=r,s=t&&i instanceof Float64Array?2:1;let c=0;const{shaderAttributes:f}=r.settings;if(f)for(const g of Object.values(f))c=Math.max(c,g.vertexOffset??0);return(n.noAlloc?i.length:(e+c)*o)*s}function sO({device:r,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=r.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function oO({device:r,buffer:e,attribute:t,fromLength:n,toLength:i,fromStartIndices:o,getData:s=c=>c}){const c=t.doublePrecision&&t.value instanceof Float64Array?2:1,f=t.size*c,g=t.byteOffset,b=t.settings.bytesPerElement<4?g/t.settings.bytesPerElement*4:g,T=t.startIndices,S=o&&T,F=t.isConstant;if(!S&&e&&n>=i)return e;const k=t.value instanceof Float64Array?Float32Array:t.value.constructor,U=F?t.value:new k(t.getBuffer().readSyncWebGL(g,i*k.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!F){const K=s;s=(fe,Q)=>t.normalizeConstant(K(fe,Q))}const j=F?(K,fe)=>s(U,fe):(K,fe)=>s(U.subarray(K+g,K+g+f),fe),z=e?new Float32Array(e.readSyncWebGL(b,n*4).buffer):new Float32Array(0),V=new Float32Array(i);return TX({source:z,target:V,sourceStartIndices:o,targetStartIndices:T,size:f,getData:j}),(!e||e.byteLength<V.byteLength+b)&&(e==null||e.destroy(),e=r.createBuffer({byteLength:V.byteLength+b,usage:35050})),e.write(V,b),e}class aO{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new $_(n),this.attribute=t,this.attributeInTransition=BX(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=SX(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class IX extends aO{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=RX(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:s}=this;iO(o),o[0]=oO({device:this.device,buffer:o[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),o[1]=sO({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:c}=this,f=c.model;let g=Math.floor(this.currentLength/s.size);cO(s)&&(g/=2),f.setVertexCount(g),s.isConstant?(f.setAttributes({aFrom:o[0]}),f.setConstantAttributes({aTo:s.value})):f.setAttributes({aFrom:o[0],aTo:s.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:o}=this.transform;o.setUniforms({time:i}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const MX=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,PX=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function cO(r){return r.doublePrecision&&r.value instanceof Float64Array}function RX(r,e){const t=e.size,n=rO(t),i=nO(t),o=e.getBufferLayout();return cO(e)?new eg(r,{vs:PX,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[J_],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new eg(r,{vs:MX,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:o.attributes[0].format}],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class FX extends aO{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=NX(e),this.framebuffer=kX(e,this.texture),this.transform=LX(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:o,attribute:s}=this;for(let f=0;f<2;f++)o[f]=oO({device:this.device,buffer:o[f],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});o[2]=sO({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?c.setConstantAttributes({aTo:s.value}):c.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,o=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]}),t.model.setUniforms({stiffness:o.stiffness,damping:o.damping}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),iO(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const DX=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,OX=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function LX(r,e){const t=rO(e.size),n=nO(e.size);return new eg(r,{vs:DX,fs:OX,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function NX(r){return r.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function kX(r,e){return r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const UX={interpolation:IX,spring:FX};class zX{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const i in e){const o=e[i],s=o.getTransitionSetting(t);s&&this._updateAttribute(i,o,s)}for(const i in this.transitions){const o=e[i];(!o||!o.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let o=!i||i.type!==n.type;if(o){i&&this._removeTransition(e);const s=UX[n.type];s?this.transitions[e]=new s({attribute:t,timeline:this.timeline,device:this.device}):(Ur.error(`unsupported transition type '${n.type}'`)(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const pS="attributeManager.invalidate",GX="attributeManager.updateStart",VX="attributeManager.updateEnd",HX="attribute.updateStart",jX="attribute.allocate",JX="attribute.updateEnd";class Wx{constructor(e,{id:t="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=gg(dH),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new zX(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);to(pS,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);to(pS,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:i,props:o={},buffers:s={},context:c={}}){let f=!1;to(GX,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const g in this.attributes){const b=this.attributes[g],T=b.settings.accessor;b.startIndices=n,b.numInstances=t,o[g]&&Ur.removed(`props.${g}`,`data.attributes.${g}`)(),b.setExternalBuffer(s[g])||b.setBinaryValue(typeof T=="string"?s[T]:void 0,e.startIndices)||typeof T=="string"&&!s[T]&&b.setConstantValue(o[T])||b.needsUpdate()&&(f=!0,this._updateAttribute({attribute:b,numInstances:t,data:e,props:o,context:c})),this.needsRedraw=this.needsRedraw||b.needsRedraw()}f&&to(VX,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(n=>{var i;return(i=this.attributes[n])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const o in t){const s=t[o];s.needsRedraw(e)&&!n.hasAttribute(o)&&(i[o]=s)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const i=e[n],o={...i,id:n,size:i.isIndexed&&1||i.size||1,...t};this.attributes[n]=new tO(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,o=i[e];return o&&o.forEach(s=>{const c=n[s];c&&c.setNeedsUpdate(c.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(to(HX,t),t.constant){t.setConstantValue(t.value);return}t.allocate(n)&&to(jX,t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,to(JX,t,n))}}class WX extends $_{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:o}}=this,s=o(e/i);this._value=ac(t,n,s)}}const gS=1e-5;function mS(r,e,t,n,i){const o=e-r,c=(t-e)*i,f=-o*n;return c+f+o+e}function XX(r,e,t,n,i){if(Array.isArray(t)){const o=[];for(let s=0;s<t.length;s++)o[s]=mS(r[s],e[s],t[s],n,i);return o}return mS(r,e,t,n,i)}function _S(r,e){if(Array.isArray(r)){let t=0;for(let n=0;n<r.length;n++){const i=r[n]-e[n];t+=i*i}return Math.sqrt(t)}return Math.abs(r-e)}class $X extends $_{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:o=e,_currValue:s=e}=this;let c=XX(o,s,t,n,i);const f=_S(c,t),g=_S(c,s);f<gS&&g<gS&&(c=t,this.end()),this._prevValue=s,this._currValue=c}}const KX={interpolation:WX,spring:$X};class qX{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:o}=this;if(o.has(e)){const f=o.get(e),{value:g=f.settings.fromValue}=f;t=g,this.remove(e)}if(i=eO(i),!i)return;const s=KX[i.type];if(!s){Ur.error(`unsupported transition type '${i.type}'`)();return}const c=new s(this.timeline);c.start({...i,fromValue:t,toValue:n}),o.set(e,c)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function ZX(r){const e=r[Lu];for(const t in e){const n=e[t],{validate:i}=n;if(i&&!i(r[t],n))throw new Error(`Invalid prop ${t}: ${r[t]}`)}}function YX(r,e){const t=Xx({newProps:r,oldProps:e,propTypes:r[Lu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=e$(r,e);let i=!1;return n||(i=t$(r,e)),{dataChanged:n,propsChanged:t,updateTriggersChanged:i,extensionsChanged:r$(r,e),transitionsChanged:QX(r,e)}}function QX(r,e){if(!r.transitions)return!1;const t={},n=r[Lu];let i=!1;for(const o in r.transitions){const s=n[o],c=s&&s.type;(c==="number"||c==="color"||c==="array")&&u2(r[o],e[o],s)&&(t[o]=!0,i=!0)}return i?t:!1}function Xx({newProps:r,oldProps:e,ignoreProps:t={},propTypes:n={},triggerName:i="props"}){if(e===r)return!1;if(typeof r!="object"||r===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const o of Object.keys(r))if(!(o in t)){if(!(o in e))return`${i}.${o} added`;const s=u2(r[o],e[o],n[o]);if(s)return`${i}.${o} ${s}`}for(const o of Object.keys(e))if(!(o in t)){if(!(o in r))return`${i}.${o} dropped`;if(!Object.hasOwnProperty.call(r,o)){const s=u2(r[o],e[o],n[o]);if(s)return`${i}.${o} ${s}`}}return!1}function u2(r,e,t){let n=t&&t.equal;return n&&!n(r,e,t)||!n&&(n=r&&e&&r.equals,n&&!n.call(r,e))?"changed deeply":!n&&e!==r?"changed shallowly":null}function e$(r,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:n,_dataDiff:i}=r;return n?n(r.data,e.data)||(t="Data comparator detected a change"):r.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(r.data,e.data)||t),t}function t$(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&yS(r,e,"all"))return{all:!0};const t={};let n=!1;for(const i in r.updateTriggers)i!=="all"&&yS(r,e,i)&&(t[i]=!0,n=!0);return n?t:!1}function r$(r,e){if(e===null)return!0;const t=e.extensions,{extensions:n}=r;if(n===t)return!1;if(!t||!n||n.length!==t.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(t[i]))return!0;return!1}function yS(r,e,t){let n=r.updateTriggers[t];n=n??{};let i=e.updateTriggers[t];return i=i??{},Xx({oldProps:i,newProps:n,triggerName:t})}const n$="count(): argument not an object",i$="count(): argument not a container";function s$(r){if(!a$(r))throw new Error(n$);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(o$(r))return Object.keys(r).length;throw new Error(i$)}function o$(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function a$(r){return r!==null&&typeof r=="object"}function f2(r,e){if(!e)return r;const t={...r,...e};if("defines"in e&&(t.defines={...r.defines,...e.defines}),"modules"in e&&(t.modules=(r.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=t.modules.findIndex(i=>i.name==="project32");n>=0&&t.modules.splice(n,1)}if("inject"in e)if(!r.inject)t.inject=e.inject;else{const n={...r.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];t.inject=n}return t}const c$={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},h2={};function l$(r,e,t,n){if(t instanceof ea)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const o=e.createTexture({...t,sampler:{...c$,...i,...n}});return h2[o.id]=r,o}function u$(r,e){!e||!(e instanceof ea)||h2[e.id]===r&&(e.delete(),delete h2[e.id])}const f$={boolean:{validate(r,e){return!0},equal(r,e,t){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||d2(r)&&(r.length===3||r.length===4)},equal(r,e,t){return io(r,e,1)}},accessor:{validate(r,e){const t=Ym(r);return t==="function"||t===Ym(e.value)},equal(r,e,t){return typeof e=="function"?!0:io(r,e,1)}},array:{validate(r,e){return e.optional&&!r||d2(r)},equal(r,e,t){const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?io(r,e,i):r===e}},object:{equal(r,e,t){if(t.ignore)return!0;const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?io(r,e,i):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,t){return!t.compare&&t.ignore!==!1||r===e}},data:{transform:(r,e,t)=>{if(!r)return r;const{dataTransform:n}=t.props;return n?n(r):typeof r.shape=="string"&&r.shape.endsWith("-table")&&Array.isArray(r.data)?r.data:r}},image:{transform:(r,e,t)=>{const n=t.context;return!n||!n.device?null:l$(t.id,n.device,r,{...e.parameters,...t.props.textureParameters})},release:(r,e,t)=>{u$(t.id,r)}}};function h$(r){const e={},t={},n={};for(const[i,o]of Object.entries(r)){const s=o==null?void 0:o.deprecatedFor;if(s)n[i]=Array.isArray(s)?s:[s];else{const c=d$(i,o);e[i]=c,t[i]=c.value}}return{propTypes:e,defaultProps:t,deprecatedProps:n}}function d$(r,e){switch(Ym(e)){case"object":return dp(r,e);case"array":return dp(r,{type:"array",value:e,compare:!1});case"boolean":return dp(r,{type:"boolean",value:e});case"number":return dp(r,{type:"number",value:e});case"function":return dp(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function dp(r,e){return"type"in e?{name:r,...f$[e.type],...e}:"value"in e?{name:r,type:Ym(e.value),...e}:{name:r,type:"object",value:e}}function d2(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function Ym(r){return d2(r)?"array":r===null?"null":typeof r}function A$(r,e){let t;for(let o=e.length-1;o>=0;o--){const s=e[o];"extensions"in s&&(t=s.extensions)}const n=A2(r.constructor,t),i=Object.create(n);i[qm]=r,i[$f]={},i[Ru]={};for(let o=0;o<e.length;++o){const s=e[o];for(const c in s)i[c]=s[c]}return Object.freeze(i),i}const p$="_mergedDefaultProps";function A2(r,e){if(!(r instanceof Y_.constructor))return{};let t=p$;if(e)for(const i of e){const o=i.constructor;o&&(t+=`:${o.extensionName||o.name}`)}const n=lO(r,t);return n||(r[t]=g$(r,e||[]))}function g$(r,e){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),i=A2(n),o=lO(r,"defaultProps")||{},s=h$(o),c=Object.assign(Object.create(null),i,s.defaultProps),f=Object.assign(Object.create(null),i==null?void 0:i[Lu],s.propTypes),g=Object.assign(Object.create(null),i==null?void 0:i[Nv],s.deprecatedProps);for(const b of e){const T=A2(b.constructor);T&&(Object.assign(c,T),Object.assign(f,T[Lu]),Object.assign(g,T[Nv]))}return m$(c,r),y$(c,f),_$(c,g),c[Lu]=f,c[Nv]=g,e.length===0&&!$x(r,"_propTypes")&&(r._propTypes=f),c}function m$(r,e){const t=b$(e);Object.defineProperties(r,{id:{writable:!0,value:t}})}function _$(r,e){for(const t in e)Object.defineProperty(r,t,{enumerable:!1,set(n){const i=`${this.id}: ${t}`;for(const o of e[t])$x(this,o)||(this[o]=n);Ur.deprecated(i,e[t].join("/"))()}})}function y$(r,e){const t={},n={};for(const i in e){const o=e[i],{name:s,value:c}=o;o.async&&(t[s]=c,n[s]=v$(s))}r[Xd]=t,r[$f]={},Object.defineProperties(r,n)}function v$(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||YD(e)?this[$f][r]=e:this[Ru][r]=e},get(){if(this[Ru]){if(r in this[Ru])return this[Ru][r]||this[Xd][r];if(r in this[$f]){const e=this[qm]&&this[qm].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[Xd][r]}}return this[Xd][r]}}}function $x(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function lO(r,e){return $x(r,e)&&r[e]}function b$(r){const e=r.componentName;return e||Ur.warn(`${r.name}.componentName not specified`)(),e||r.name}let x$=0;class Y_{constructor(...e){this.props=A$(this,e),this.id=this.props.id,this.count=x$++}clone(e){const{props:t}=this,n={};for(const i in t[Xd])i in t[Ru]?n[i]=t[Ru][i]:i in t[$f]&&(n[i]=t[$f][i]);return new this.constructor({...t,...n,...e})}}Y_.componentName="Component";Y_.defaultProps={};const w$=Object.freeze({});class C${constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||w$}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[qm]||this.component;const t=e[Ru]||{},n=e[$f]||e,i=e[Xd]||{};for(const o in t){const s=t[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s),t[o]=this.getAsyncProp(o)}for(const o in n){const s=n[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(YD(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t===n.resolvedValue||t===n.lastValue?!1:(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(n,o),this._setAsyncPropValue(e,o,i),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let o=[],s=0;for await(const c of t){if(!this.component)return;const{dataTransform:f}=this.component.props;f?o=f(c,o):o=o.concat(c),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(e,o,i)}this._onResolve(e,o)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Lu];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class E$ extends C${constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=n==null?void 0:n.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const T$="layer.changeFlag",B$="layer.initialize",S$="layer.update",I$="layer.finalize",M$="layer.matched",vS=2**24-1,P$=Object.freeze([]),R$=gg(({oldViewport:r,viewport:e})=>r.equals(e));let zc=new Uint8ClampedArray(0);const F$={data:{type:"data",value:P$,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,{propName:e,layer:t,loaders:n,loadOptions:i,signal:o})=>{const{resourceManager:s}=t.context;i=i||t.getLoadOptions(),n=n||t.props.loaders,o&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:o}});let c=s.contains(r);return!c&&!i&&(s.add({resourceId:r,data:Nl(r,n),persistent:!1}),c=!0),c?s.subscribe({resourceId:r,onChange:f=>{var g;return(g=t.internalState)==null?void 0:g.reloadAsyncProp(e,f)},consumerId:t.id,requestId:e}):Nl(r,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Wr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:r})=>[0,-r*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class cs extends Y_{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Ed.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){zs(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=ED(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,s]=vD(n,t.pixelProjectionMatrix);return e.length===2?[i,o]:[i,o,s]}unproject(e){return zs(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){zs(this.internalState);const n=this.internalState.viewport||this.context.viewport;return yH(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Wr.DEFAULT||e===Wr.LNGLAT||e===Wr.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){zs(e instanceof Uint8Array);const[t,n,i]=e;return t+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:s$(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=f2(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=f2(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const i of n)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,o=this.internalState.hasPickingBuffer,s=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(o!==s){this.internalState.hasPickingBuffer=s;const{pickingColors:c,instancePickingColors:f}=t.attributes,g=c||f;g&&(s&&g.constant&&(g.constant=!1,t.invalidate(g.id)),!g.value&&!s&&(g.constant=!0,g.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){var n,i,o,s;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(i=(n=this.props).onError)!=null&&i.call(n,e)||(s=(o=this.context)==null?void 0:o.onError)==null||s.call(o,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!R$({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const i in t)Object.defineProperty(n,i,{value:t[i]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(zc.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>vS&&Ur.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),zc=aA.allocate(zc,t,{size:4,copy:!0,maxCount:Math.max(t,vS)});const i=Math.floor(zc.length/4),o=[];for(let s=n;s<i;s++)this.encodePickingColor(s,o),zc[s*4+0]=o[0],zc[s*4+1]=o[1],zc[s*4+2]=o[2]}e.value=zc.subarray(0,t*4)}_setModelAttributes(e,t,n=!1){var c;if(!Object.keys(t).length)return;if(n){const f=this.getAttributeManager();e.setBufferLayout(f.getBufferLayouts(e)),t=f.getAttributes()}const i=((c=e.userData)==null?void 0:c.excludeAttributes)||{},o={},s={};for(const f in t){if(i[f])continue;const g=t[f].getValue();for(const b in g){const T=g[b];T instanceof $i?t[f].settings.isIndexed?e.setIndexBuffer(T):o[b]=T:T&&(s[b]=T)}}e.setAttributes(o),e.setConstantAttributes(s)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i,s=o&&t.attributes&&t.attributes[o.id];if(s&&s.value){const c=s.value,f=this.encodePickingColor(e);for(let g=0;g<t.length;g++){const b=o.getVertexOffset(g);c[b]===f[0]&&c[b+1]===f[1]&&c[b+2]===f[2]&&this._disablePickingIndex(g)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const o=i.getVertexOffset(e),s=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(s-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==zc.buffer&&(n.value=zc.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){zs(!this.internalState),zs(Number.isFinite(this.props.coordinateSystem)),to(B$,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new E$({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ur.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new qX(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){to(M$,this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(to(S$,this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,o=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||o,this.props=s;try{const c=this._getUpdateParams(),f=this.getModels();if(n.device)this.updateState(c);else try{this.updateState(c)}catch{}for(const b of this.props.extensions)b.updateState.call(this,c,b);const g=this.getModels()[0]!==f[0];this._postUpdate(c,g)}finally{n.viewport=o,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){to(I$,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:t=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;const c=this.props.opacity;n.opacity=Math.pow(c,1/2.2);try{if(t){const{isActive:b,isAttribute:T}=t.picking;this.setModuleParameters(t),this.setShaderModuleProps({picking:{isActive:b,isAttribute:T}})}const{getPolygonOffset:f}=this.props,g=f&&f(n)||[0,0];s.device.setParametersWebGL({polygonOffset:g});for(const b of this.getModels())b.setParameters(i);s.device.withParametersWebGL(i,()=>{const b={renderPass:e,moduleParameters:t,uniforms:n,parameters:i,context:s};for(const T of this.props.extensions)T.draw.call(this,b,T);this.draw(b)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let o=!1;switch(i){case"dataChanged":const s=e[i],c=t[i];s&&Array.isArray(c)&&(t.dataChanged=Array.isArray(s)?c.concat(s):s,o=!0);default:t[i]||(t[i]=e[i],o=!0)}o&&to(T$,this,i,e)}const n=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var i;const n=YX(e,t);if(n.updateTriggersChanged)for(const o in n.updateTriggersChanged)n.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(n.transitionsChanged)for(const o in n.transitionsChanged)this.internalState.uniformTransitions.add(o,t[o],e[o],(i=e.transitions)==null?void 0:i[o]);return this.setChangeFlags(n)}validateProps(){ZX(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Wx(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const o=this.state.model;o!=null&&o.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:c,highlightColor:f}=n;if(t||i.autoHighlight!==s||i.highlightedObjectIndex!==c||i.highlightColor!==f){const g={};Array.isArray(f)&&(g.highlightColor=f),(t||i.autoHighlight!==s||c!==i.highlightedObjectIndex)&&(g.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:g})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(t=t||i,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}cs.defaultProps=F$;cs.layerName="Layer";const D$="compositeLayer.renderLayers";class gs extends cs{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(e={}){var Te;const{opacity:t,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:c,autoHighlight:f,highlightColor:g,coordinateSystem:b,coordinateOrigin:T,wrapLongitude:S,positionFormat:F,modelMatrix:k,extensions:U,fetch:j,operation:z,_subLayerProps:V}=this.props,K={id:"",updateTriggers:{},opacity:t,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:c,autoHighlight:f,highlightColor:g,coordinateSystem:b,coordinateOrigin:T,wrapLongitude:S,positionFormat:F,modelMatrix:k,extensions:U,fetch:j,operation:z},fe=V&&e.id&&V[e.id],Q=fe&&fe.updateTriggers,oe=e.id||"sublayer";if(fe){const ze=this.props[Lu],Ae=e.type?e.type._propTypes:{};for(const _e in fe){const pe=Ae[_e]||ze[_e];pe&&pe.type==="accessor"&&(fe[_e]=this.getSubLayerAccessor(fe[_e]))}}Object.assign(K,e,fe),K.id=`${this.props.id}-${oe}`,K.updateTriggers={all:(Te=this.props.updateTriggers)==null?void 0:Te.all,...e.updateTriggers,...Q};for(const ze of U){const Ae=ze.getSubLayerProps.call(this,ze);Ae&&Object.assign(K,Ae,{updateTriggers:Object.assign(K.updateTriggers,Ae.updateTriggers)})}return K}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const o=this.renderLayers();n=X_(o,Boolean),this.internalState.subLayers=n}to(D$,this,i,n);for(const o of n)o.parent=this}}gs.layerName="CompositeLayer";const I0=Math.PI/180,bS=180/Math.PI,mm=6370972,Ld=256;function O$(){const r=Ld/mm,e=Math.PI/180*Ld;return{unitsPerMeter:[r,r,r],unitsPerMeter2:[0,0,0],metersPerUnit:[1/r,1/r,1/r],unitsPerDegree:[e,e,r],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/r]}}class L$ extends xA{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=0,nearZMultiplier:o=.1,farZMultiplier:s=2,resolution:c=10}=e;let{height:f,altitude:g=1.5}=e;f=f||1,g=Math.max(.75,g);const b=new dn().lookAt({eye:[0,-g,0],up:[0,0,1]}),T=Math.pow(2,i);b.rotateX(t*I0),b.rotateZ(-n*I0),b.scale(T/f);const S=Math.atan(.5/g),F=Ld*2*T/f;super({...e,height:f,viewMatrix:b,longitude:n,latitude:t,zoom:i,distanceScales:O$(),fovyRadians:S*2,focalDistance:g,near:o,far:Math.min(2,1/F+1)*g*s}),this.latitude=t,this.longitude=n,this.resolution=c}get projectionMode(){return tc.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),o=this.unproject([this.width,this.height/2],t),s=this.unproject([this.width/2,this.height],t);return o[0]<this.longitude&&(o[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],o[0],i[0],s[0]),Math.min(n[1],o[1],i[1],s[1]),Math.max(n[0],o[0],i[0],s[0]),Math.max(n[1],o[1],i[1],s[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,o,s]=e,c=t?o:this.height-o,{pixelUnprojectionMatrix:f}=this;let g;if(Number.isFinite(s))g=qv(f,[i,c,s,1]);else{const F=qv(f,[i,c,-1,1]),k=qv(f,[i,c,1,1]),U=((n||0)/mm+1)*Ld,j=Sv(eD([],F,k)),z=Sv(F),V=Sv(k),fe=4*((4*z*V-(j-z-V)**2)/16)/j,Q=Math.sqrt(z-fe),oe=Math.sqrt(Math.max(0,U*U-fe)),Te=(Q-oe)/Math.sqrt(j);g=eG([],F,k,Te)}const[b,T,S]=this.unprojectPosition(g);return Number.isFinite(s)?[b,T,S]:Number.isFinite(n)?[b,T,n]:[b,T]}projectPosition(e){const[t,n,i=0]=e,o=t*I0,s=n*I0,c=Math.cos(s),f=(i/mm+1)*Ld;return[Math.sin(o)*c*f,-Math.cos(o)*c*f,Math.sin(s)*f]}unprojectPosition(e){const[t,n,i]=e,o=tD(e),s=Math.asin(i/o),f=Math.atan2(t,-n)*bS,g=s*bS,b=(o/Ld-1)*mm;return[f,g,b]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function qv(r,e){const t=bA([],e,r);return Fx(t,t,1/t[3]),t}class Kx{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&io(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,n={updateTriggers:{}};for(const i in t)if(i in this.props){const o=t[i],s=this.props[i];n[i]=s,o&&o.type==="accessor"&&(n.updateTriggers[i]=this.props.updateTriggers[i],typeof s=="function"&&(n[i]=this.getSubLayerAccessor(s)))}return n}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}Kx.defaultProps={};Kx.extensionName="LayerExtension";class uO{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=aA,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:n={},getGeometry:i,geometryBuffer:o,positionFormat:s,dataChanged:c,normalize:f=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=o&&o.size||(s==="XY"?2:3),this.buffers=n,this.normalize=f,o&&(zs(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),f||(n.vertexPositions=o)),this.geometryBuffer=n.vertexPositions,Array.isArray(c))for(const g of c)this._rebuildGeometry(g);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?QD(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:n,buffers:i,_attributeDefs:o,typedArrayManager:s}=this;for(const c in o)if(c in i)s.release(n[c]),n[c]=null;else{const f=o[c];f.copy=t,n[c]=s.allocate(n[c],e,f)}}_forEachGeometry(e,t,n){const{data:i,getGeometry:o}=this,{iterable:s,objectInfo:c}=el(i,t,n);for(const f of s){c.index++;const g=o?o(f,c):null;e(g,c.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:n,instanceCount:i}=this;const{data:o,geometryBuffer:s}=this,{startRow:c=0,endRow:f=1/0}=e||{},g={};if(e||(t=[0],n=[0]),this.normalize||!s)this._forEachGeometry((T,S)=>{const F=T&&this.normalizeGeometry(T);g[S]=F,n[S+1]=n[S]+(F?this.getGeometrySize(F):0)},c,f),i=n[n.length-1];else if(n=o.startIndices,i=n[o.length]||0,ArrayBuffer.isView(s))i=i||s.length/this.positionSize;else if(s instanceof $i){const T=this.positionSize*4;i=i||s.byteLength/T}else if(s.buffer){const T=s.stride||this.positionSize*4;i=i||s.buffer.byteLength/T}else if(s.value){const T=s.value,S=s.stride/T.BYTES_PER_ELEMENT||this.positionSize;i=i||T.length/S}this._allocate(i,!!e),this.indexStarts=t,this.vertexStarts=n,this.instanceCount=i;const b={};this._forEachGeometry((T,S)=>{const F=g[S]||T;b.vertexStart=n[S],b.indexStart=t[S];const k=S<n.length-1?n[S+1]:i;b.geometrySize=k-n[S],b.geometryIndex=S,this.updateGeometryAttributes(F,b)},c,f),this.vertexCount=t[t.length-1]}}const N$=typeof window<"u"?Bt.useLayoutEffect:Bt.useEffect;function Qm(r,e){for(;r;){if(r===e)return!0;r=Object.getPrototypeOf(r)}return!1}const k$={position:"absolute",zIndex:-1};function fO(r,e){if(typeof r=="function")return r(e);if(Array.isArray(r))return r.map(t=>fO(t,e));if(Q_(r)){if(U$(r))return e.style=k$,Bt.cloneElement(r,e);if(z$(r))return Bt.cloneElement(r,e)}return r}function Q_(r){return r&&typeof r=="object"&&"type"in r||!1}function U$(r){var e;return(e=r.props)==null?void 0:e.mapStyle}function z$(r){const e=r.type;return e&&e.deckGLViewProps}function p2(r){if(typeof r=="function")return Bt.createElement(cA,{},r);if(Array.isArray(r))return r.map(p2);if(Q_(r)){if(r.type===Bt.Fragment)return p2(r.props.children);if(Qm(r.type,cA))return r}return r}function G$({children:r,layers:e=[],views:t=null}){const n=[],i=[],o={};return Bt.Children.forEach(p2(r),s=>{if(Q_(s)){const c=s.type;if(Qm(c,cs)){const f=V$(c,s.props);i.push(f)}else n.push(s);if(Qm(c,cA)&&c!==cA&&s.props.id){const f=new c(s.props);o[f.id]=f}}else s&&n.push(s)}),Object.keys(o).length>0&&(Array.isArray(t)?t.forEach(s=>{o[s.id]=s}):t&&(o[t.id]=t),t=Object.values(o)),e=i.length>0?[...i,...e]:e,{layers:e,children:n,views:t}}function V$(r,e){const t={},n=r.defaultProps||{};for(const i in e)n[i]!==e[i]&&(t[i]=e[i]);return new r(t)}const H$=Bt.createContext();function j$({children:r,deck:e,ContextProvider:t=H$.Provider}){const{viewManager:n}=e||{};if(!n||!n.views.length)return[];const i={},o=n.views[0].id;for(const s of r){let c=o,f=s;Q_(s)&&Qm(s.type,cA)&&(c=s.props.id||o,f=s.props.children);const g=n.getViewport(c),b=n.getViewState(c);if(g){b.padding=g.padding;const{x:T,y:S,width:F,height:k}=g;f=fO(f,{x:T,y:S,width:F,height:k,viewport:g,viewState:b}),i[c]||(i[c]={viewport:g,children:[]}),i[c].children.push(f)}}return Object.keys(i).map(s=>{const{viewport:c,children:f}=i[s],{x:g,y:b,width:T,height:S}=c,F={position:"absolute",left:g,top:b,width:T,height:S},k=`view-${s}`,U=Bt.createElement("div",{key:k,id:k,style:F},...f),j={deck:e,viewport:c,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:V=>{V.viewId=s,e._onViewStateChange(V)},widgets:[]},z=`view-${s}-context`;return Bt.createElement(t,{key:z,value:j},U)})}const J$={mixBlendMode:null};function W$({width:r,height:e,style:t}){const n={position:"absolute",zIndex:0,left:0,top:0,width:r,height:e},i={left:0,top:0};if(t)for(const o in t)o in J$?i[o]=t[o]:n[o]=t[o];return{containerStyle:n,canvasStyle:i}}function X$(r){return{get deck(){return r.deck},pickObject:e=>r.deck.pickObject(e),pickMultipleObjects:e=>r.deck.pickMultipleObjects(e),pickObjects:e=>r.deck.pickObjects(e)}}function hO(r){r.redrawReason&&(r.deck._drawLayers(r.redrawReason),r.redrawReason=null)}function $$(r,e,t){const n=new e({...t,_customRender:i=>{r.redrawReason=i;const o=n.getViewports();r.lastRenderedViewports!==o?r.forceUpdate():hO(r)}});return n}function K$(r,e){const[t,n]=Bt.useState(0),o=Bt.useRef({control:null,version:t,forceUpdate:()=>n(Q=>Q+1)}).current,s=Bt.useRef(null),c=Bt.useRef(null),f=Bt.useMemo(()=>G$(r),[r.layers,r.views,r.children]);let g=!0;const b=Q=>{var oe;return g&&r.viewState?(o.viewStateUpdateRequested=Q,null):(o.viewStateUpdateRequested=null,(oe=r.onViewStateChange)==null?void 0:oe.call(r,Q))},T=Q=>{var oe;g?o.interactionStateUpdateRequested=Q:(o.interactionStateUpdateRequested=null,(oe=r.onInteractionStateChange)==null||oe.call(r,Q))},S=Bt.useMemo(()=>{const Q={widgets:[],...r,style:null,width:"100%",height:"100%",parent:s.current,canvas:c.current,layers:f.layers,views:f.views,onViewStateChange:b,onInteractionStateChange:T};return delete Q._customRender,o.deck&&o.deck.setProps(Q),Q},[r]);Bt.useEffect(()=>{const Q=r.Deck||Jx;return o.deck=$$(o,Q,{...S,parent:s.current,canvas:c.current}),()=>{var oe;return(oe=o.deck)==null?void 0:oe.finalize()}},[]),N$(()=>{hO(o);const{viewStateUpdateRequested:Q,interactionStateUpdateRequested:oe}=o;Q&&b(Q),oe&&T(oe)}),Bt.useImperativeHandle(e,()=>X$(o),[]);const F=o.deck&&o.deck.isInitialized?o.deck.getViewports():void 0,{ContextProvider:k,width:U="100%",height:j="100%",id:z,style:V}=r,{containerStyle:K,canvasStyle:fe}=Bt.useMemo(()=>W$({width:U,height:j,style:V}),[U,j,V]);if(!o.viewStateUpdateRequested&&o.lastRenderedViewports===F||o.version!==t){o.lastRenderedViewports=F,o.version=t;const Q=j$({children:f.children,deck:o.deck,ContextProvider:k}),oe=Bt.createElement("canvas",{key:"canvas",id:z||"deckgl-overlay",ref:c,style:fe});o.control=Bt.createElement("div",{id:`${z||"deckgl"}-wrapper`,ref:s,style:K},[oe,Q])}return g=!1,o.control}const q$=Bt.forwardRef(K$);var Qs=1e-6,lA=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function Z$(){var r=new lA(4);return lA!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Y$(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function Q$(r,e,t){var n=e[0],i=e[1],o=e[2],s=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*o+t[12]*s,r[1]=t[1]*n+t[5]*i+t[9]*o+t[13]*s,r[2]=t[2]*n+t[6]*i+t[10]*o+t[14]*s,r[3]=t[3]*n+t[7]*i+t[11]*o+t[15]*s,r}(function(){var r=Z$();return function(e,t,n,i,o,s){var c,f;for(t||(t=4),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],r[2]=e[c+2],r[3]=e[c+3],o(r,r,s),e[c]=r[0],e[c+1]=r[1],e[c+2]=r[2],e[c+3]=r[3];return e}})();function _m(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function $d(r,e){const t=Q$([],e,r);return Y$(t,t,1/t[3]),t}function xS(r,e){const t=r%e;return t<0?e+t:t}function eK(r,e,t){return t*e+(1-t)*r}function g2(r,e,t){return r<e?e:r>t?t:r}function tK(r){return Math.log(r)*Math.LOG2E}const qx=Math.log2||tK;function rK(r,e){var t=e[0],n=e[1],i=e[2],o=e[3],s=e[4],c=e[5],f=e[6],g=e[7],b=e[8],T=e[9],S=e[10],F=e[11],k=e[12],U=e[13],j=e[14],z=e[15],V=t*c-n*s,K=t*f-i*s,fe=t*g-o*s,Q=n*f-i*c,oe=n*g-o*c,Te=i*g-o*f,ze=b*U-T*k,Ae=b*j-S*k,_e=b*z-F*k,pe=T*j-S*U,X=T*z-F*U,ne=S*z-F*j,Be=V*ne-K*X+fe*pe+Q*_e-oe*Ae+Te*ze;return Be?(Be=1/Be,r[0]=(c*ne-f*X+g*pe)*Be,r[1]=(i*X-n*ne-o*pe)*Be,r[2]=(U*Te-j*oe+z*Q)*Be,r[3]=(S*oe-T*Te-F*Q)*Be,r[4]=(f*_e-s*ne-g*Ae)*Be,r[5]=(t*ne-i*_e+o*Ae)*Be,r[6]=(j*fe-k*Te-z*K)*Be,r[7]=(b*Te-S*fe+F*K)*Be,r[8]=(s*X-c*_e+g*ze)*Be,r[9]=(n*_e-t*X-o*ze)*Be,r[10]=(k*oe-U*fe+z*V)*Be,r[11]=(T*fe-b*oe-F*V)*Be,r[12]=(c*Ae-s*pe-f*ze)*Be,r[13]=(t*pe-n*Ae+i*ze)*Be,r[14]=(U*K-k*Q-j*V)*Be,r[15]=(b*Q-T*K+S*V)*Be,r):null}function Zv(r,e,t){var n=e[0],i=e[1],o=e[2],s=e[3],c=e[4],f=e[5],g=e[6],b=e[7],T=e[8],S=e[9],F=e[10],k=e[11],U=e[12],j=e[13],z=e[14],V=e[15],K=t[0],fe=t[1],Q=t[2],oe=t[3];return r[0]=K*n+fe*c+Q*T+oe*U,r[1]=K*i+fe*f+Q*S+oe*j,r[2]=K*o+fe*g+Q*F+oe*z,r[3]=K*s+fe*b+Q*k+oe*V,K=t[4],fe=t[5],Q=t[6],oe=t[7],r[4]=K*n+fe*c+Q*T+oe*U,r[5]=K*i+fe*f+Q*S+oe*j,r[6]=K*o+fe*g+Q*F+oe*z,r[7]=K*s+fe*b+Q*k+oe*V,K=t[8],fe=t[9],Q=t[10],oe=t[11],r[8]=K*n+fe*c+Q*T+oe*U,r[9]=K*i+fe*f+Q*S+oe*j,r[10]=K*o+fe*g+Q*F+oe*z,r[11]=K*s+fe*b+Q*k+oe*V,K=t[12],fe=t[13],Q=t[14],oe=t[15],r[12]=K*n+fe*c+Q*T+oe*U,r[13]=K*i+fe*f+Q*S+oe*j,r[14]=K*o+fe*g+Q*F+oe*z,r[15]=K*s+fe*b+Q*k+oe*V,r}function m2(r,e,t){var n=t[0],i=t[1],o=t[2],s,c,f,g,b,T,S,F,k,U,j,z;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*o+e[12],r[13]=e[1]*n+e[5]*i+e[9]*o+e[13],r[14]=e[2]*n+e[6]*i+e[10]*o+e[14],r[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(s=e[0],c=e[1],f=e[2],g=e[3],b=e[4],T=e[5],S=e[6],F=e[7],k=e[8],U=e[9],j=e[10],z=e[11],r[0]=s,r[1]=c,r[2]=f,r[3]=g,r[4]=b,r[5]=T,r[6]=S,r[7]=F,r[8]=k,r[9]=U,r[10]=j,r[11]=z,r[12]=s*n+b*i+k*o+e[12],r[13]=c*n+T*i+U*o+e[13],r[14]=f*n+S*i+j*o+e[14],r[15]=g*n+F*i+z*o+e[15]),r}function dO(r,e,t){var n=t[0],i=t[1],o=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*o,r[9]=e[9]*o,r[10]=e[10]*o,r[11]=e[11]*o,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function nK(r,e,t){var n=Math.sin(t),i=Math.cos(t),o=e[4],s=e[5],c=e[6],f=e[7],g=e[8],b=e[9],T=e[10],S=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=o*i+g*n,r[5]=s*i+b*n,r[6]=c*i+T*n,r[7]=f*i+S*n,r[8]=g*i-o*n,r[9]=b*i-s*n,r[10]=T*i-c*n,r[11]=S*i-f*n,r}function iK(r,e,t){var n=Math.sin(t),i=Math.cos(t),o=e[0],s=e[1],c=e[2],f=e[3],g=e[4],b=e[5],T=e[6],S=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=o*i+g*n,r[1]=s*i+b*n,r[2]=c*i+T*n,r[3]=f*i+S*n,r[4]=g*i-o*n,r[5]=b*i-s*n,r[6]=T*i-c*n,r[7]=S*i-f*n,r}function sK(r,e,t,n,i){var o=1/Math.tan(e/2),s;return r[0]=o/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(s=1/(n-i),r[10]=(i+n)*s,r[14]=2*i*n*s):(r[10]=-1,r[14]=-2*n),r}var oK=sK;function wS(r,e){var t=r[0],n=r[1],i=r[2],o=r[3],s=r[4],c=r[5],f=r[6],g=r[7],b=r[8],T=r[9],S=r[10],F=r[11],k=r[12],U=r[13],j=r[14],z=r[15],V=e[0],K=e[1],fe=e[2],Q=e[3],oe=e[4],Te=e[5],ze=e[6],Ae=e[7],_e=e[8],pe=e[9],X=e[10],ne=e[11],Be=e[12],Ze=e[13],Ce=e[14],Ne=e[15];return Math.abs(t-V)<=Qs*Math.max(1,Math.abs(t),Math.abs(V))&&Math.abs(n-K)<=Qs*Math.max(1,Math.abs(n),Math.abs(K))&&Math.abs(i-fe)<=Qs*Math.max(1,Math.abs(i),Math.abs(fe))&&Math.abs(o-Q)<=Qs*Math.max(1,Math.abs(o),Math.abs(Q))&&Math.abs(s-oe)<=Qs*Math.max(1,Math.abs(s),Math.abs(oe))&&Math.abs(c-Te)<=Qs*Math.max(1,Math.abs(c),Math.abs(Te))&&Math.abs(f-ze)<=Qs*Math.max(1,Math.abs(f),Math.abs(ze))&&Math.abs(g-Ae)<=Qs*Math.max(1,Math.abs(g),Math.abs(Ae))&&Math.abs(b-_e)<=Qs*Math.max(1,Math.abs(b),Math.abs(_e))&&Math.abs(T-pe)<=Qs*Math.max(1,Math.abs(T),Math.abs(pe))&&Math.abs(S-X)<=Qs*Math.max(1,Math.abs(S),Math.abs(X))&&Math.abs(F-ne)<=Qs*Math.max(1,Math.abs(F),Math.abs(ne))&&Math.abs(k-Be)<=Qs*Math.max(1,Math.abs(k),Math.abs(Be))&&Math.abs(U-Ze)<=Qs*Math.max(1,Math.abs(U),Math.abs(Ze))&&Math.abs(j-Ce)<=Qs*Math.max(1,Math.abs(j),Math.abs(Ce))&&Math.abs(z-Ne)<=Qs*Math.max(1,Math.abs(z),Math.abs(Ne))}function aK(){var r=new lA(2);return lA!=Float32Array&&(r[0]=0,r[1]=0),r}function _2(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function cK(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r}function lK(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r}function uK(r){var e=r[0],t=r[1];return Math.hypot(e,t)}function fK(r,e){return r[0]=-e[0],r[1]=-e[1],r}function AO(r,e,t,n){var i=e[0],o=e[1];return r[0]=i+n*(t[0]-i),r[1]=o+n*(t[1]-o),r}var hK=cK;(function(){var r=aK();return function(e,t,n,i,o,s){var c,f;for(t||(t=2),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],o(r,r,s),e[c]=r[0],e[c+1]=r[1];return e}})();function dK(){var r=new lA(3);return lA!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function AK(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function pK(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function gK(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}var mK=pK;(function(){var r=dK();return function(e,t,n,i,o,s){var c,f;for(t||(t=3),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],r[2]=e[c+2],o(r,r,s),e[c]=r[0],e[c+1]=r[1],e[c+2]=r[2];return e}})();function Gu(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const nc=Math.PI,pO=nc/4,$c=nc/180,y2=180/nc,rg=512,CS=4003e4,ES=85.051129,gO=1.5;function v2(r){return Math.pow(2,r)}function _K(r){return qx(r)}function Du(r){const[e,t]=r;Gu(Number.isFinite(e)),Gu(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*$c,i=t*$c,o=rg*(n+nc)/(2*nc),s=rg*(nc+Math.log(Math.tan(pO+i*.5)))/(2*nc);return[o,s]}function ku(r){const[e,t]=r,n=e/rg*(2*nc)-nc,i=2*(Math.atan(Math.exp(t/rg*(2*nc)-nc))-pO);return[n*y2,i*y2]}function yK(r){const{latitude:e,longitude:t,highPrecision:n=!1}=r;Gu(Number.isFinite(e)&&Number.isFinite(t));const i=rg,o=Math.cos(e*$c),s=i/360,c=s/o,f=i/CS/o,g={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[s,c,f],degreesPerUnit:[1/s,1/c,1/f]};if(n){const b=$c*Math.tan(e*$c)/o,T=s*b/2,S=i/CS*b,F=S/c*f;g.unitsPerDegree2=[0,T,S],g.unitsPerMeter2=[F,0,F]}return g}function vK(r){const{height:e,pitch:t,bearing:n,altitude:i,scale:o,center:s}=r,c=_m();m2(c,c,[0,0,-i]),nK(c,c,-t*$c),iK(c,c,n*$c);const f=o/e;return dO(c,c,[f,f,f]),s&&m2(c,c,gK([],s)),c}function bK(r){const{width:e,height:t,altitude:n,pitch:i=0,offset:o,center:s,scale:c,nearZMultiplier:f=1,farZMultiplier:g=1}=r;let{fovy:b=e_(gO)}=r;n!==void 0&&(b=e_(n));const T=b*$c,S=i*$c,F=mO(b);let k=F;s&&(k+=s[2]*c/Math.cos(S)/t);const U=T*(.5+(o?o[1]:0)/t),j=Math.sin(U)*k/Math.sin(g2(Math.PI/2-S-U,.01,Math.PI-.01)),z=Math.sin(S)*j+k,V=k*10,K=Math.min(z*g,V);return{fov:T,aspect:e/t,focalDistance:F,near:f,far:K}}function xK(r){const{fov:e,aspect:t,near:n,far:i}=bK(r);return oK([],e,t,n,i)}function e_(r){return 2*Math.atan(.5/r)*y2}function mO(r){return .5/Math.tan(.5*r*$c)}function wK(r,e){const[t,n,i=0]=r;return Gu(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i)),$d(e,[t,n,i,1])}function TS(r,e,t=0){const[n,i,o]=r;if(Gu(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return $d(e,[n,i,o,1]);const s=$d(e,[n,i,0,1]),c=$d(e,[n,i,1,1]),f=s[2],g=c[2],b=f===g?0:((t||0)-f)/(g-f);return AO([],s,c,b)}function CK(r){const{width:e,height:t,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=r,[[c,f],[g,b]]=n,T=EK(r.padding),S=Du([c,g2(b,-85.051129,ES)]),F=Du([g,g2(f,-85.051129,ES)]),k=[Math.max(Math.abs(F[0]-S[0]),i),Math.max(Math.abs(F[1]-S[1]),i)],U=[e-T.left-T.right-Math.abs(s[0])*2,t-T.top-T.bottom-Math.abs(s[1])*2];Gu(U[0]>0&&U[1]>0);const j=U[0]/k[0],z=U[1]/k[1],V=(T.right-T.left)/2/j,K=(T.top-T.bottom)/2/z,fe=[(F[0]+S[0])/2+V,(F[1]+S[1])/2+K],Q=ku(fe),oe=Math.min(o,qx(Math.abs(Math.min(j,z))));return Gu(Number.isFinite(oe)),{longitude:Q[0],latitude:Q[1],zoom:oe}}function EK(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(Gu(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const BS=Math.PI/180;function TK(r,e=0){const{width:t,height:n,unproject:i}=r,o={targetZ:e},s=i([0,n],o),c=i([t,n],o);let f,g;const b=r.fovy?.5*r.fovy*BS:Math.atan(.5/r.altitude),T=(90-r.pitch)*BS;return b>T-.01?(f=SS(r,0,e),g=SS(r,t,e)):(f=i([0,0],o),g=i([t,0],o)),[s,c,g,f]}function SS(r,e,t){const{pixelUnprojectionMatrix:n}=r,i=$d(n,[e,0,1,1]),o=$d(n,[e,r.height,1,1]),c=(t*r.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),f=AO([],i,o,c),g=ku(f);return g.push(t),g}class Kc{constructor(e={width:1,height:1}){yr(this,"latitude",void 0),yr(this,"longitude",void 0),yr(this,"zoom",void 0),yr(this,"pitch",void 0),yr(this,"bearing",void 0),yr(this,"altitude",void 0),yr(this,"fovy",void 0),yr(this,"meterOffset",void 0),yr(this,"center",void 0),yr(this,"width",void 0),yr(this,"height",void 0),yr(this,"scale",void 0),yr(this,"distanceScales",void 0),yr(this,"viewMatrix",void 0),yr(this,"projectionMatrix",void 0),yr(this,"viewProjectionMatrix",void 0),yr(this,"pixelProjectionMatrix",void 0),yr(this,"pixelUnprojectionMatrix",void 0),yr(this,"equals",z=>z instanceof Kc?z.width===this.width&&z.height===this.height&&wS(z.projectionMatrix,this.projectionMatrix)&&wS(z.viewMatrix,this.viewMatrix):!1),yr(this,"project",(z,V={})=>{const{topLeft:K=!0}=V,fe=this.projectPosition(z),Q=wK(fe,this.pixelProjectionMatrix),[oe,Te]=Q,ze=K?Te:this.height-Te;return z.length===2?[oe,ze]:[oe,ze,Q[2]]}),yr(this,"unproject",(z,V={})=>{const{topLeft:K=!0,targetZ:fe=void 0}=V,[Q,oe,Te]=z,ze=K?oe:this.height-oe,Ae=fe&&fe*this.distanceScales.unitsPerMeter[2],_e=TS([Q,ze,Te],this.pixelUnprojectionMatrix,Ae),[pe,X,ne]=this.unprojectPosition(_e);return Number.isFinite(Te)?[pe,X,ne]:Number.isFinite(fe)?[pe,X,fe]:[pe,X]}),yr(this,"projectPosition",z=>{const[V,K]=Du(z),fe=(z[2]||0)*this.distanceScales.unitsPerMeter[2];return[V,K,fe]}),yr(this,"unprojectPosition",z=>{const[V,K]=ku(z),fe=(z[2]||0)*this.distanceScales.metersPerUnit[2];return[V,K,fe]});let{width:t,height:n,altitude:i=null,fovy:o=null}=e;const{latitude:s=0,longitude:c=0,zoom:f=0,pitch:g=0,bearing:b=0,position:T=null,nearZMultiplier:S=.02,farZMultiplier:F=1.01}=e;t=t||1,n=n||1,o===null&&i===null?(i=gO,o=e_(i)):o===null?o=e_(i):i===null&&(i=mO(o));const k=v2(f);i=Math.max(.75,i);const U=yK({longitude:c,latitude:s}),j=Du([c,s]);j.push(0),T&&AK(j,j,mK([],T,U.unitsPerMeter)),this.projectionMatrix=xK({width:t,height:n,scale:k,center:j,pitch:g,fovy:o,nearZMultiplier:S,farZMultiplier:F}),this.viewMatrix=vK({height:n,scale:k,center:j,pitch:g,bearing:b,altitude:i}),this.width=t,this.height=n,this.scale=k,this.latitude=s,this.longitude=c,this.zoom=f,this.pitch=g,this.bearing=b,this.altitude=i,this.fovy=o,this.center=j,this.meterOffset=T||[0,0,0],this.distanceScales=U,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:t,projectionMatrix:n,viewMatrix:i}=this,o=_m();Zv(o,o,n),Zv(o,o,i),this.viewProjectionMatrix=o;const s=_m();dO(s,s,[e/2,-t/2,1]),m2(s,s,[1,-1,0]),Zv(s,s,o);const c=rK(_m(),s);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=c}projectFlat(e){return Du(e)}unprojectFlat(e){return ku(e)}getMapCenterByLngLatPosition({lngLat:e,pos:t}){const n=TS(t,this.pixelUnprojectionMatrix),i=Du(e),o=_2([],i,fK([],n)),s=_2([],this.center,o);return ku(s)}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:o,latitude:s,zoom:c}=CK(Object.assign({width:n,height:i,bounds:e},t));return new Kc({width:n,height:i,longitude:o,latitude:s,zoom:c})}getBounds(e){const t=this.getBoundingRegion(e),n=Math.min(...t.map(c=>c[0])),i=Math.max(...t.map(c=>c[0])),o=Math.min(...t.map(c=>c[1])),s=Math.max(...t.map(c=>c[1]));return[[n,o],[i,s]]}getBoundingRegion(e={}){return TK(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:t}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:t})}}const IS=512;function BK(r){const{width:e,height:t,pitch:n=0}=r;let{longitude:i,latitude:o,zoom:s,bearing:c=0}=r;(i<-180||i>180)&&(i=xS(i+180,360)-180),(c<-180||c>180)&&(c=xS(c+180,360)-180);const f=qx(t/IS);if(s<=f)s=f,o=0;else{const g=t/2/Math.pow(2,s),b=ku([0,g])[1];if(o<b)o=b;else{const T=ku([0,IS-g])[1];o>T&&(o=T)}}return{width:e,height:t,longitude:i,latitude:o,zoom:s,pitch:n,bearing:c}}const _O=.01,SK=["longitude","latitude","zoom"],yO={curve:1.414,speed:1.2};function IK(r,e,t,n){const{startZoom:i,startCenterXY:o,uDelta:s,w0:c,u1:f,S:g,rho:b,rho2:T,r0:S}=vO(r,e,n);if(f<_O){const fe={};for(const Q of SK){const oe=r[Q],Te=e[Q];fe[Q]=eK(oe,Te,t)}return fe}const F=t*g,k=Math.cosh(S)/Math.cosh(S+b*F),U=c*((Math.cosh(S)*Math.tanh(S+b*F)-Math.sinh(S))/T)/f,j=1/k,z=i+_K(j),V=lK([],s,U);_2(V,V,o);const K=ku(V);return{longitude:K[0],latitude:K[1],zoom:z}}function MK(r,e,t){const n={...yO,...t},{screenSpeed:i,speed:o,maxDuration:s}=n,{S:c,rho:f}=vO(r,e,n),g=1e3*c;let b;return Number.isFinite(i)?b=g/(i/f):b=g/o,Number.isFinite(s)&&b>s?0:b}function vO(r,e,t){t=Object.assign({},yO,t);const n=t.curve,i=r.zoom,o=[r.longitude,r.latitude],s=v2(i),c=e.zoom,f=[e.longitude,e.latitude],g=v2(c-i),b=Du(o),T=Du(f),S=hK([],T,b),F=Math.max(r.width,r.height),k=F/g,U=uK(S)*s,j=Math.max(U,_O),z=n*n,V=(k*k-F*F+z*z*j*j)/(2*F*z*j),K=(k*k-F*F-z*z*j*j)/(2*k*z*j),fe=Math.log(Math.sqrt(V*V+1)-V),Q=Math.log(Math.sqrt(K*K+1)-K),oe=(Q-fe)/n;return{startZoom:i,startCenterXY:b,uDelta:S,w0:F,u1:U,S:oe,rho:n,rho2:z,r0:fe,r1:Q}}var bO=function(){if(typeof Map<"u")return Map;function r(e,t){var n=-1;return e.some(function(i,o){return i[0]===t?(n=o,!0):!1}),n}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t){var n=r(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},e.prototype.set=function(t,n){var i=r(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},e.prototype.delete=function(t){var n=this.__entries__,i=r(n,t);~i&&n.splice(i,1)},e.prototype.has=function(t){return!!~r(this.__entries__,t)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,n){n===void 0&&(n=null);for(var i=0,o=this.__entries__;i<o.length;i++){var s=o[i];t.call(n,s[1],s[0])}},e}()}(),b2=typeof window<"u"&&typeof document<"u"&&window.document===document,t_=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),PK=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(t_):function(r){return setTimeout(function(){return r(Date.now())},1e3/60)}}(),RK=2;function FK(r,e){var t=!1,n=!1,i=0;function o(){t&&(t=!1,r()),n&&c()}function s(){PK(o)}function c(){var f=Date.now();if(t){if(f-i<RK)return;n=!0}else t=!0,n=!1,setTimeout(s,e);i=f}return c}var DK=20,OK=["top","right","bottom","left","width","height","size","weight"],LK=typeof MutationObserver<"u",NK=function(){function r(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=FK(this.refresh.bind(this),DK)}return r.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},r.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},r.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},r.prototype.updateObservers_=function(){var e=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return e.forEach(function(t){return t.broadcastActive()}),e.length>0},r.prototype.connect_=function(){!b2||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),LK?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},r.prototype.disconnect_=function(){!b2||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},r.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=t===void 0?"":t,i=OK.some(function(o){return!!~n.indexOf(o)});i&&this.refresh()},r.getInstance=function(){return this.instance_||(this.instance_=new r),this.instance_},r.instance_=null,r}(),xO=function(r,e){for(var t=0,n=Object.keys(e);t<n.length;t++){var i=n[t];Object.defineProperty(r,i,{value:e[i],enumerable:!1,writable:!1,configurable:!0})}return r},uA=function(r){var e=r&&r.ownerDocument&&r.ownerDocument.defaultView;return e||t_},wO=ey(0,0,0,0);function r_(r){return parseFloat(r)||0}function MS(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.reduce(function(n,i){var o=r["border-"+i+"-width"];return n+r_(o)},0)}function kK(r){for(var e=["top","right","bottom","left"],t={},n=0,i=e;n<i.length;n++){var o=i[n],s=r["padding-"+o];t[o]=r_(s)}return t}function UK(r){var e=r.getBBox();return ey(0,0,e.width,e.height)}function zK(r){var e=r.clientWidth,t=r.clientHeight;if(!e&&!t)return wO;var n=uA(r).getComputedStyle(r),i=kK(n),o=i.left+i.right,s=i.top+i.bottom,c=r_(n.width),f=r_(n.height);if(n.boxSizing==="border-box"&&(Math.round(c+o)!==e&&(c-=MS(n,"left","right")+o),Math.round(f+s)!==t&&(f-=MS(n,"top","bottom")+s)),!VK(r)){var g=Math.round(c+o)-e,b=Math.round(f+s)-t;Math.abs(g)!==1&&(c-=g),Math.abs(b)!==1&&(f-=b)}return ey(i.left,i.top,c,f)}var GK=function(){return typeof SVGGraphicsElement<"u"?function(r){return r instanceof uA(r).SVGGraphicsElement}:function(r){return r instanceof uA(r).SVGElement&&typeof r.getBBox=="function"}}();function VK(r){return r===uA(r).document.documentElement}function HK(r){return b2?GK(r)?UK(r):zK(r):wO}function jK(r){var e=r.x,t=r.y,n=r.width,i=r.height,o=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,s=Object.create(o.prototype);return xO(s,{x:e,y:t,width:n,height:i,top:t,right:e+n,bottom:i+t,left:e}),s}function ey(r,e,t,n){return{x:r,y:e,width:t,height:n}}var JK=function(){function r(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=ey(0,0,0,0),this.target=e}return r.prototype.isActive=function(){var e=HK(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},r.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},r}(),WK=function(){function r(e,t){var n=jK(t);xO(this,{target:e,contentRect:n})}return r}(),XK=function(){function r(e,t,n){if(this.activeObservations_=[],this.observations_=new bO,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=n}return r.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof uA(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new JK(e)),this.controller_.addObserver(this),this.controller_.refresh())}},r.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof uA(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},r.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},r.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},r.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(n){return new WK(n.target,n.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},r.prototype.clearActive=function(){this.activeObservations_.splice(0)},r.prototype.hasActive=function(){return this.activeObservations_.length>0},r}(),CO=typeof WeakMap<"u"?new WeakMap:new bO,EO=function(){function r(e){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t=NK.getInstance(),n=new XK(e,t,this);CO.set(this,n)}return r}();["observe","unobserve","disconnect"].forEach(function(r){EO.prototype[r]=function(){var e;return(e=CO.get(this))[r].apply(e,arguments)}});var $K=function(){return typeof t_.ResizeObserver<"u"?t_.ResizeObserver:EO}(),Ml=typeof document<"u"?document:{};function PS(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function M0(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?PS(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):PS(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function RS(r,e){var t;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=KK(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(g){throw g},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,c;return{s:function(){t=r[Symbol.iterator]()},n:function(){var g=t.next();return o=g.done,g},e:function(g){s=!0,c=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw c}}}}function KK(r,e){if(r){if(typeof r=="string")return FS(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return FS(r,e)}}function FS(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var qK=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Yv(r){if(!r)return null;if(typeof r=="string")return r;r.toJS&&(r=r.toJS());var e={},t=RS(r.layers),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;e[i.id]=i}}catch(s){t.e(s)}finally{t.f()}var o=r.layers.map(function(s){var c=e[s.ref],f=null;if("interactive"in s&&(f=M0({},s),delete f.interactive),c){f=f||M0({},s),delete f.ref;var g=RS(qK),b;try{for(g.s();!(b=g.n()).done;){var T=b.value;T in c&&(f[T]=c[T])}}catch(S){g.e(S)}finally{g.f()}}return f||s});return M0(M0({},r),{},{layers:o})}var DS={};function ZK(){}function YK(r){r&&console.error(r.error)}var TO={container:dt.object,gl:dt.object,mapboxApiAccessToken:dt.string,mapboxApiUrl:dt.string,attributionControl:dt.bool,preserveDrawingBuffer:dt.bool,reuseMaps:dt.bool,transformRequest:dt.func,mapOptions:dt.object,mapStyle:dt.oneOfType([dt.string,dt.object]),preventStyleDiffing:dt.bool,visible:dt.bool,asyncRender:dt.bool,onLoad:dt.func,onError:dt.func,width:dt.number,height:dt.number,viewState:dt.object,longitude:dt.number,latitude:dt.number,zoom:dt.number,bearing:dt.number,pitch:dt.number,altitude:dt.number},ym={container:Ml.body,mapboxApiAccessToken:QK(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:ZK,onError:YK,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function QK(){var r=null;if(typeof window<"u"&&window.location){var e=window.location.search.match(/access_token=([^&\/]*)/);r=e&&e[1]}return!r&&typeof process<"u"&&(r=r||DS.MapboxAccessToken||DS.REACT_APP_MAPBOX_ACCESS_TOKEN),r||"no-token"}function OS(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";r.debug&&dt.checkPropTypes(TO,r,"prop",e)}var oh=function(){function r(e){var t=this;if(Xu(this,r),yr(this,"props",ym),yr(this,"width",0),yr(this,"height",0),yr(this,"_fireLoadEvent",function(){t.props.onLoad({type:"load",target:t._map})}),yr(this,"_handleError",function(n){t.props.onError(n)}),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,r.initialized||(r.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return Wu(r,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(t){this._map=r.savedMap;var n=this._map.getContainer(),i=t.container;for(i.classList.add("mapboxgl-map");n.childNodes.length>0;)i.appendChild(n.childNodes[0]);this._map._container=i,r.savedMap=null,t.mapStyle&&this._map.setStyle(Yv(t.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(t){if(t.reuseMaps&&r.savedMap)this._reuse(t);else{if(t.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,t.gl}}var i={container:t.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:Yv(t.mapStyle),interactive:!1,trackResize:!1,attributionControl:t.attributionControl,preserveDrawingBuffer:t.preserveDrawingBuffer};t.transformRequest&&(i.transformRequest=t.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},i,t.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!r.savedMap?(r.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(t){var n=this;t=Object.assign({},ym,t),OS(t,"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||ym.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var i=t,o=i.container;Object.defineProperty(o,"offsetWidth",{configurable:!0,get:function(){return n.width}}),Object.defineProperty(o,"clientWidth",{configurable:!0,get:function(){return n.width}}),Object.defineProperty(o,"offsetHeight",{configurable:!0,get:function(){return n.height}}),Object.defineProperty(o,"clientHeight",{configurable:!0,get:function(){return n.height}});var s=this._map.getCanvas();s&&(s.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,n){if(this._map){n=Object.assign({},this.props,n),OS(n,"Mapbox");var i=this._updateMapViewport(t,n),o=this._updateMapSize(t,n);this._updateMapStyle(t,n),!n.asyncRender&&(i||o)&&this.redraw(),this.props=n}}},{key:"_updateMapStyle",value:function(t,n){var i=t.mapStyle!==n.mapStyle;i&&this._map.setStyle(Yv(n.mapStyle),{diff:!n.preventStyleDiffing})}},{key:"_updateMapSize",value:function(t,n){var i=t.width!==n.width||t.height!==n.height;return i&&(this.width=n.width,this.height=n.height,this._map.resize()),i}},{key:"_updateMapViewport",value:function(t,n){var i=this._getViewState(t),o=this._getViewState(n),s=o.latitude!==i.latitude||o.longitude!==i.longitude||o.zoom!==i.zoom||o.pitch!==i.pitch||o.bearing!==i.bearing||o.altitude!==i.altitude;return s&&(this._map.jumpTo(this._viewStateToMapboxProps(o)),o.altitude!==i.altitude&&(this._map.transform.altitude=o.altitude)),s}},{key:"_getViewState",value:function(t){var n=t.viewState||t,i=n.longitude,o=n.latitude,s=n.zoom,c=n.pitch,f=c===void 0?0:c,g=n.bearing,b=g===void 0?0:g,T=n.altitude,S=T===void 0?1.5:T;return{longitude:i,latitude:o,zoom:s,pitch:f,bearing:b,altitude:S}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof Ml>"u"))try{var n=Ml.createElement("div");n.className="mapboxgl-map",n.style.display="none",Ml.body.appendChild(n);var i=window.getComputedStyle(n).position!=="static";if(!i){var o=Ml.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),Ml.head.appendChild(o)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),r}();yr(oh,"initialized",!1);yr(oh,"propTypes",TO);yr(oh,"defaultProps",ym);yr(oh,"savedMap",null);var vm={exports:{}},eq=vm.exports,LS;function tq(){return LS||(LS=1,function(r,e){(function(t,n){r.exports=n()})(eq,function(){var t,n,i;function o(s,c){if(!t)t=c;else if(!n)n=c;else{var f="var sharedChunk = {}; ("+t+")(sharedChunk); ("+n+")(sharedChunk);",g={};t(g),i=c(g),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([f],{type:"text/javascript"})))}}return o(["exports"],function(s){function c(a,u){return a(u={exports:{}},u.exports),u.exports}var f=g;function g(a,u,A,x){this.cx=3*a,this.bx=3*(A-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(x-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=x,this.p2x=A,this.p2y=x}g.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},g.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},g.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},g.prototype.solveCurveX=function(a,u){var A,x,E,I,D;for(u===void 0&&(u=1e-6),E=a,D=0;D<8;D++){if(I=this.sampleCurveX(E)-a,Math.abs(I)<u)return E;var N=this.sampleCurveDerivativeX(E);if(Math.abs(N)<1e-6)break;E-=I/N}if((E=a)<(A=0))return A;if(E>(x=1))return x;for(;A<x;){if(I=this.sampleCurveX(E),Math.abs(I-a)<u)return E;a>I?A=E:x=E,E=.5*(x-A)+A}return E},g.prototype.solve=function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))};var b=T;function T(a,u){this.x=a,this.y=u}T.prototype={clone:function(){return new T(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,u){return this.clone()._rotateAround(a,u)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var u=a.x-this.x,A=a.y-this.y;return u*u+A*A},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,u){return Math.atan2(this.x*u-this.y*a,this.x*a+this.y*u)},_matMult:function(a){var u=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=u,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var u=Math.cos(a),A=Math.sin(a),x=A*this.x+u*this.y;return this.x=u*this.x-A*this.y,this.y=x,this},_rotateAround:function(a,u){var A=Math.cos(a),x=Math.sin(a),E=u.y+x*(this.x-u.x)+A*(this.y-u.y);return this.x=u.x+A*(this.x-u.x)-x*(this.y-u.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},T.convert=function(a){return a instanceof T?a:Array.isArray(a)?new T(a[0],a[1]):a};var S=typeof self<"u"?self:{},F=Math.pow(2,53)-1;function k(a,u,A,x){var E=new f(a,u,A,x);return function(I){return E.solve(I)}}var U=k(.25,.1,.25,1);function j(a,u,A){return Math.min(A,Math.max(u,a))}function z(a,u,A){var x=A-u,E=((a-u)%x+x)%x+u;return E===u?A:E}function V(a){for(var u=[],A=arguments.length-1;A-- >0;)u[A]=arguments[A+1];for(var x=0,E=u;x<E.length;x+=1){var I=E[x];for(var D in I)a[D]=I[D]}return a}var K=1;function fe(){return K++}function Q(){return function a(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function oe(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Te(a,u){a.forEach(function(A){u[A]&&(u[A]=u[A].bind(u))})}function ze(a,u){return a.indexOf(u,a.length-u.length)!==-1}function Ae(a,u,A){var x={};for(var E in a)x[E]=u.call(A||this,a[E],E,a);return x}function _e(a,u,A){var x={};for(var E in a)u.call(A||this,a[E],E,a)&&(x[E]=a[E]);return x}function pe(a){return Array.isArray(a)?a.map(pe):typeof a=="object"&&a?Ae(a,pe):a}var X={};function ne(a){X[a]||(typeof console<"u"&&console.warn(a),X[a]=!0)}function Be(a,u,A){return(A.y-a.y)*(u.x-a.x)>(u.y-a.y)*(A.x-a.x)}function Ze(a){for(var u=0,A=0,x=a.length,E=x-1,I=void 0,D=void 0;A<x;E=A++)u+=((D=a[E]).x-(I=a[A]).x)*(I.y+D.y);return u}function Ce(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ne(a){var u={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(x,E,I,D){var N=I||D;return u[E]=!N||N.toLowerCase(),""}),u["max-age"]){var A=parseInt(u["max-age"],10);isNaN(A)?delete u["max-age"]:u["max-age"]=A}return u}var Ge=null;function Qe(a){if(Ge==null){var u=a.navigator?a.navigator.userAgent:null;Ge=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Ge}function rt(a){try{var u=S[a];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch{return!1}}var tt,lt,mt,Tt,nt=S.performance&&S.performance.now?S.performance.now.bind(S.performance):Date.now.bind(Date),cr=S.requestAnimationFrame||S.mozRequestAnimationFrame||S.webkitRequestAnimationFrame||S.msRequestAnimationFrame,$t=S.cancelAnimationFrame||S.mozCancelAnimationFrame||S.webkitCancelAnimationFrame||S.msCancelAnimationFrame,Jt={now:nt,frame:function(a){var u=cr(a);return{cancel:function(){return $t(u)}}},getImageData:function(a,u){u===void 0&&(u=0);var A=S.document.createElement("canvas"),x=A.getContext("2d");if(!x)throw new Error("failed to create canvas 2d context");return A.width=a.width,A.height=a.height,x.drawImage(a,0,0,a.width,a.height),x.getImageData(-u,-u,a.width+2*u,a.height+2*u)},resolveURL:function(a){return tt||(tt=S.document.createElement("a")),tt.href=a,tt.href},hardwareConcurrency:S.navigator&&S.navigator.hardwareConcurrency||4,get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(lt==null&&(lt=S.matchMedia("(prefers-reduced-motion: reduce)")),lt.matches)}},Lt={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},lr={supported:!1,testSupport:function(a){!tn&&Tt&&(Er?Ar(a):mt=a)}},tn=!1,Er=!1;function Ar(a){var u=a.createTexture();a.bindTexture(a.TEXTURE_2D,u);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Tt),a.isContextLost())return;lr.supported=!0}catch{}a.deleteTexture(u),tn=!0}S.document&&((Tt=S.document.createElement("img")).onload=function(){mt&&Ar(mt),mt=null,Er=!0},Tt.onerror=function(){tn=!0,mt=null},Tt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var In="01",hr=function(a,u){this._transformRequestFn=a,this._customAccessToken=u,this._createSkuToken()};function pr(a){return a.indexOf("mapbox:")===0}hr.prototype._createSkuToken=function(){var a=function(){for(var u="",A=0;A<10;A++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",In,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},hr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},hr.prototype.transformRequest=function(a,u){return this._transformRequestFn&&this._transformRequestFn(a,u)||{url:a}},hr.prototype.normalizeStyleURL=function(a,u){if(!pr(a))return a;var A=Jn(a);return A.path="/styles/v1"+A.path,this._makeAPIURL(A,this._customAccessToken||u)},hr.prototype.normalizeGlyphsURL=function(a,u){if(!pr(a))return a;var A=Jn(a);return A.path="/fonts/v1"+A.path,this._makeAPIURL(A,this._customAccessToken||u)},hr.prototype.normalizeSourceURL=function(a,u){if(!pr(a))return a;var A=Jn(a);return A.path="/v4/"+A.authority+".json",A.params.push("secure"),this._makeAPIURL(A,this._customAccessToken||u)},hr.prototype.normalizeSpriteURL=function(a,u,A,x){var E=Jn(a);return pr(a)?(E.path="/styles/v1"+E.path+"/sprite"+u+A,this._makeAPIURL(E,this._customAccessToken||x)):(E.path+=""+u+A,un(E))},hr.prototype.normalizeTileURL=function(a,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!pr(a))return a;var A=Jn(a);A.path=A.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Jt.devicePixelRatio>=2||u===512?"@2x":"")+(lr.supported?".webp":"$1")),A.path=A.path.replace(/^.+\/v4\//,"/"),A.path="/v4"+A.path;var x=this._customAccessToken||function(E){for(var I=0,D=E;I<D.length;I+=1){var N=D[I].match(/^access_token=(.*)$/);if(N)return N[1]}return null}(A.params)||Lt.ACCESS_TOKEN;return Lt.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&A.params.push("sku="+this._skuToken),this._makeAPIURL(A,x)},hr.prototype.canonicalizeTileURL=function(a,u){var A=Jn(a);if(!A.path.match(/(^\/v4\/)/)||!A.path.match(/\.[\w]+$/))return a;var x="mapbox://tiles/";x+=A.path.replace("/v4/","");var E=A.params;return u&&(E=E.filter(function(I){return!I.match(/^access_token=/)})),E.length&&(x+="?"+E.join("&")),x},hr.prototype.canonicalizeTileset=function(a,u){for(var A=!!u&&pr(u),x=[],E=0,I=a.tiles||[];E<I.length;E+=1){var D=I[E];Sr(D)?x.push(this.canonicalizeTileURL(D,A)):x.push(D)}return x},hr.prototype._makeAPIURL=function(a,u){var A="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",x=Jn(Lt.API_URL);if(a.protocol=x.protocol,a.authority=x.authority,a.protocol==="http"){var E=a.params.indexOf("secure");E>=0&&a.params.splice(E,1)}if(x.path!=="/"&&(a.path=""+x.path+a.path),!Lt.REQUIRE_ACCESS_TOKEN)return un(a);if(!(u=u||Lt.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+A);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+A);return a.params=a.params.filter(function(I){return I.indexOf("access_token")===-1}),a.params.push("access_token="+u),un(a)};var rn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Sr(a){return rn.test(a)}var ti=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Jn(a){var u=a.match(ti);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function un(a){var u=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+u}function Kn(a){if(!a)return null;var u=a.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(u[1]).split("").map(function(A){return"%"+("00"+A.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var Nn=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Nn.prototype.getStorageKey=function(a){var u,A=Kn(Lt.ACCESS_TOKEN);return u=A&&A.u?S.btoa(encodeURIComponent(A.u).replace(/%([0-9A-F]{2})/g,function(x,E){return String.fromCharCode(+("0x"+E))})):Lt.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+u:"mapbox.eventData:"+u},Nn.prototype.fetchEventData=function(){var a=rt("localStorage"),u=this.getStorageKey(),A=this.getStorageKey("uuid");if(a)try{var x=S.localStorage.getItem(u);x&&(this.eventData=JSON.parse(x));var E=S.localStorage.getItem(A);E&&(this.anonId=E)}catch{ne("Unable to read from LocalStorage")}},Nn.prototype.saveEventData=function(){var a=rt("localStorage"),u=this.getStorageKey(),A=this.getStorageKey("uuid");if(a)try{S.localStorage.setItem(A,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{ne("Unable to write to LocalStorage")}},Nn.prototype.processRequests=function(a){},Nn.prototype.postEvent=function(a,u,A,x){var E=this;if(Lt.EVENTS_URL){var I=Jn(Lt.EVENTS_URL);I.params.push("access_token="+(x||Lt.ACCESS_TOKEN||""));var D={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:In,userId:this.anonId},N=u?V(D,u):D,H={url:un(I),headers:{"Content-Type":"text/plain"},body:JSON.stringify([N])};this.pendingRequest=ct(H,function(q){E.pendingRequest=null,A(q),E.saveEventData(),E.processRequests(x)})}},Nn.prototype.queueRequest=function(a,u){this.queue.push(a),this.processRequests(u)};var vn,Wn,Ut=function(a){function u(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(A,x,E,I){this.skuToken=E;var D=!(!I&&!Lt.ACCESS_TOKEN),N=Array.isArray(A)&&A.some(function(H){return pr(H)||Sr(H)});Lt.EVENTS_URL&&D&&N&&this.queueRequest({id:x,timestamp:Date.now()},I)},u.prototype.processRequests=function(A){var x=this;if(!this.pendingRequest&&this.queue.length!==0){var E=this.queue.shift(),I=E.id,D=E.timestamp;I&&this.success[I]||(this.anonId||this.fetchEventData(),oe(this.anonId)||(this.anonId=Q()),this.postEvent(D,{skuToken:this.skuToken},function(N){N||I&&(x.success[I]=!0)},A))}},u}(Nn),dr=new(function(a){function u(A){a.call(this,"appUserTurnstile"),this._customAccessToken=A}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(A,x){Lt.EVENTS_URL&&Lt.ACCESS_TOKEN&&Array.isArray(A)&&A.some(function(E){return pr(E)||Sr(E)})&&this.queueRequest(Date.now(),x)},u.prototype.processRequests=function(A){var x=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var E=Kn(Lt.ACCESS_TOKEN),I=E?E.u:Lt.ACCESS_TOKEN,D=I!==this.eventData.tokenU;oe(this.anonId)||(this.anonId=Q(),D=!0);var N=this.queue.shift();if(this.eventData.lastSuccess){var H=new Date(this.eventData.lastSuccess),q=new Date(N),ee=(N-this.eventData.lastSuccess)/864e5;D=D||ee>=1||ee<-1||H.getDate()!==q.getDate()}else D=!0;if(!D)return this.processRequests();this.postEvent(N,{"enabled.telemetry":!1},function(se){se||(x.eventData.lastSuccess=N,x.eventData.tokenU=I)},A)}},u}(Nn)),Tr=dr.postTurnstileEvent.bind(dr),Zr=new Ut,fi=Zr.postMapLoadEvent.bind(Zr),Pe=500,Ot=50;function Vt(){S.caches&&!vn&&(vn=S.caches.open("mapbox-tiles"))}function sr(a){var u=a.indexOf("?");return u<0?a:a.slice(0,u)}var Ye,Mt=1/0;function ge(){return Ye==null&&(Ye=S.OffscreenCanvas&&new S.OffscreenCanvas(1,1).getContext("2d")&&typeof S.createImageBitmap=="function"),Ye}var kt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(kt);var wt=function(a){function u(A,x,E){x===401&&Sr(E)&&(A+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,A),this.status=x,this.url=E,this.name=this.constructor.name,this.message=A}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),W=Ce()?function(){return self.worker&&self.worker.referrer}:function(){return(S.location.protocol==="blob:"?S.parent:S).location.href},yt,Et,Ee=function(a,u){if(!(/^file:/.test(A=a.url)||/^file:/.test(W())&&!/^\w+:/.test(A))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return function(x,E){var I,D=new S.AbortController,N=new S.Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,referrer:W(),signal:D.signal}),H=!1,q=!1,ee=(I=N.url).indexOf("sku=")>0&&Sr(I);x.type==="json"&&N.headers.set("Accept","application/json");var se=function(ye,ke,Ue){if(!q){if(ye&&ye.message!=="SecurityError"&&ne(ye),ke&&Ue)return he(ke);var je=Date.now();S.fetch(N).then(function(Ve){if(Ve.ok){var qe=ee?Ve.clone():null;return he(Ve,qe,je)}return E(new wt(Ve.statusText,Ve.status,x.url))}).catch(function(Ve){Ve.code!==20&&E(new Error(Ve.message))})}},he=function(ye,ke,Ue){(x.type==="arrayBuffer"?ye.arrayBuffer():x.type==="json"?ye.json():ye.text()).then(function(je){q||(ke&&Ue&&function(Ve,qe,at){if(Vt(),vn){var pt={status:qe.status,statusText:qe.statusText,headers:new S.Headers};qe.headers.forEach(function(Pt,Gt){return pt.headers.set(Gt,Pt)});var _t=Ne(qe.headers.get("Cache-Control")||"");_t["no-store"]||(_t["max-age"]&&pt.headers.set("Expires",new Date(at+1e3*_t["max-age"]).toUTCString()),new Date(pt.headers.get("Expires")).getTime()-at<42e4||function(Pt,Gt){if(Wn===void 0)try{new Response(new ReadableStream),Wn=!0}catch{Wn=!1}Wn?Gt(Pt.body):Pt.blob().then(Gt)}(qe,function(Pt){var Gt=new S.Response(Pt,pt);Vt(),vn&&vn.then(function(Xt){return Xt.put(sr(Ve.url),Gt)}).catch(function(Xt){return ne(Xt.message)})}))}}(N,ke,Ue),H=!0,E(null,je,ye.headers.get("Cache-Control"),ye.headers.get("Expires")))}).catch(function(je){q||E(new Error(je.message))})};return ee?function(ye,ke){if(Vt(),!vn)return ke(null);var Ue=sr(ye.url);vn.then(function(je){je.match(Ue).then(function(Ve){var qe=function(at){if(!at)return!1;var pt=new Date(at.headers.get("Expires")||0),_t=Ne(at.headers.get("Cache-Control")||"");return pt>Date.now()&&!_t["no-cache"]}(Ve);je.delete(Ue),qe&&je.put(Ue,Ve.clone()),ke(null,Ve,qe)}).catch(ke)}).catch(ke)}(N,se):se(null,null),{cancel:function(){q=!0,H||D.abort()}}}(a,u);if(Ce()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,u,void 0,!0)}var A;return function(x,E){var I=new S.XMLHttpRequest;for(var D in I.open(x.method||"GET",x.url,!0),x.type==="arrayBuffer"&&(I.responseType="arraybuffer"),x.headers)I.setRequestHeader(D,x.headers[D]);return x.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=x.credentials==="include",I.onerror=function(){E(new Error(I.statusText))},I.onload=function(){if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){var N=I.response;if(x.type==="json")try{N=JSON.parse(I.response)}catch(H){return E(H)}E(null,N,I.getResponseHeader("Cache-Control"),I.getResponseHeader("Expires"))}else E(new wt(I.statusText,I.status,x.url))},I.send(x.body),{cancel:function(){return I.abort()}}}(a,u)},Xe=function(a,u){return Ee(V(a,{type:"arrayBuffer"}),u)},ct=function(a,u){return Ee(V(a,{method:"POST"}),u)},Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";yt=[],Et=0;var ie=function(a,u){if(lr.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Et>=Lt.MAX_PARALLEL_IMAGE_REQUESTS){var A={requestParameters:a,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return yt.push(A),A}Et++;var x=!1,E=function(){if(!x)for(x=!0,Et--;yt.length&&Et<Lt.MAX_PARALLEL_IMAGE_REQUESTS;){var D=yt.shift();D.cancelled||(D.cancel=ie(D.requestParameters,D.callback).cancel)}},I=Xe(a,function(D,N,H,q){E(),D?u(D):N&&(ge()?function(ee,se){var he=new S.Blob([new Uint8Array(ee)],{type:"image/png"});S.createImageBitmap(he).then(function(ye){se(null,ye)}).catch(function(ye){se(new Error("Could not load image because of "+ye.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(N,u):function(ee,se,he,ye){var ke=new S.Image,Ue=S.URL;ke.onload=function(){se(null,ke),Ue.revokeObjectURL(ke.src),ke.onload=null,S.requestAnimationFrame(function(){ke.src=Z})},ke.onerror=function(){return se(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var je=new S.Blob([new Uint8Array(ee)],{type:"image/png"});ke.cacheControl=he,ke.expires=ye,ke.src=ee.byteLength?Ue.createObjectURL(je):Z}(N,u,H,q))});return{cancel:function(){I.cancel(),E()}}};function ue(a,u,A){A[a]&&A[a].indexOf(u)!==-1||(A[a]=A[a]||[],A[a].push(u))}function ve(a,u,A){if(A&&A[a]){var x=A[a].indexOf(u);x!==-1&&A[a].splice(x,1)}}var Oe=function(a,u){u===void 0&&(u={}),V(this,u),this.type=a},de=function(a){function u(A,x){x===void 0&&(x={}),a.call(this,"error",V({error:A},x))}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Oe),be=function(){};be.prototype.on=function(a,u){return this._listeners=this._listeners||{},ue(a,u,this._listeners),this},be.prototype.off=function(a,u){return ve(a,u,this._listeners),ve(a,u,this._oneTimeListeners),this},be.prototype.once=function(a,u){return this._oneTimeListeners=this._oneTimeListeners||{},ue(a,u,this._oneTimeListeners),this},be.prototype.fire=function(a,u){typeof a=="string"&&(a=new Oe(a,u||{}));var A=a.type;if(this.listens(A)){a.target=this;for(var x=0,E=this._listeners&&this._listeners[A]?this._listeners[A].slice():[];x<E.length;x+=1)E[x].call(this,a);for(var I=0,D=this._oneTimeListeners&&this._oneTimeListeners[A]?this._oneTimeListeners[A].slice():[];I<D.length;I+=1){var N=D[I];ve(A,N,this._oneTimeListeners),N.call(this,a)}var H=this._eventedParent;H&&(V(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),H.fire(a))}else a instanceof de&&console.error(a.error);return this},be.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},be.prototype.setEventedParent=function(a,u){return this._eventedParent=a,this._eventedParentData=u,this};var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Se=function(a,u,A,x){this.message=(a?a+": ":"")+A,x&&(this.identifier=x),u!=null&&u.__line__&&(this.line=u.__line__)};function p(a){var u=a.value;return u?[new Se(a.key,u,"constants have been deprecated as of v8")]:[]}function le(a){for(var u=[],A=arguments.length-1;A-- >0;)u[A]=arguments[A+1];for(var x=0,E=u;x<E.length;x+=1){var I=E[x];for(var D in I)a[D]=I[D]}return a}function vt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ke(a){if(Array.isArray(a))return a.map(Ke);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var u={};for(var A in a)u[A]=Ke(a[A]);return u}return vt(a)}var Ct=function(a){function u(A,x){a.call(this,x),this.message=x,this.key=A}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Error),It=function(a,u){u===void 0&&(u=[]),this.parent=a,this.bindings={};for(var A=0,x=u;A<x.length;A+=1){var E=x[A];this.bindings[E[0]]=E[1]}};It.prototype.concat=function(a){return new It(this,a)},It.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},It.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Ft={kind:"null"},ut={kind:"number"},Dt={kind:"string"},St={kind:"boolean"},zt={kind:"color"},Fr={kind:"object"},qt={kind:"value"},$r={kind:"collator"},en={kind:"formatted"},Gr={kind:"resolvedImage"};function Vr(a,u){return{kind:"array",itemType:a,N:u}}function Lr(a){if(a.kind==="array"){var u=Lr(a.itemType);return typeof a.N=="number"?"array<"+u+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+u+">"}return a.kind}var hi=[Ft,ut,Dt,St,zt,en,Fr,Vr(qt),Gr];function Hr(a,u){if(u.kind==="error")return null;if(a.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Hr(a.itemType,u.itemType))&&(typeof a.N!="number"||a.N===u.N))return null}else{if(a.kind===u.kind)return null;if(a.kind==="value"){for(var A=0,x=hi;A<x.length;A+=1)if(!Hr(x[A],u))return null}}return"Expected "+Lr(a)+" but found "+Lr(u)+" instead."}function fr(a,u){return u.some(function(A){return A.kind===a.kind})}function Me(a,u){return u.some(function(A){return A==="null"?a===null:A==="array"?Array.isArray(a):A==="object"?a&&!Array.isArray(a)&&typeof a=="object":A===typeof a})}var Wt=c(function(a,u){var A={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function x(N){return(N=Math.round(N))<0?0:N>255?255:N}function E(N){return x(N[N.length-1]==="%"?parseFloat(N)/100*255:parseInt(N))}function I(N){return(H=N[N.length-1]==="%"?parseFloat(N)/100:parseFloat(N))<0?0:H>1?1:H;var H}function D(N,H,q){return q<0?q+=1:q>1&&(q-=1),6*q<1?N+(H-N)*q*6:2*q<1?H:3*q<2?N+(H-N)*(2/3-q)*6:N}try{u.parseCSSColor=function(N){var H,q=N.replace(/ /g,"").toLowerCase();if(q in A)return A[q].slice();if(q[0]==="#")return q.length===4?(H=parseInt(q.substr(1),16))>=0&&H<=4095?[(3840&H)>>4|(3840&H)>>8,240&H|(240&H)>>4,15&H|(15&H)<<4,1]:null:q.length===7&&(H=parseInt(q.substr(1),16))>=0&&H<=16777215?[(16711680&H)>>16,(65280&H)>>8,255&H,1]:null;var ee=q.indexOf("("),se=q.indexOf(")");if(ee!==-1&&se+1===q.length){var he=q.substr(0,ee),ye=q.substr(ee+1,se-(ee+1)).split(","),ke=1;switch(he){case"rgba":if(ye.length!==4)return null;ke=I(ye.pop());case"rgb":return ye.length!==3?null:[E(ye[0]),E(ye[1]),E(ye[2]),ke];case"hsla":if(ye.length!==4)return null;ke=I(ye.pop());case"hsl":if(ye.length!==3)return null;var Ue=(parseFloat(ye[0])%360+360)%360/360,je=I(ye[1]),Ve=I(ye[2]),qe=Ve<=.5?Ve*(je+1):Ve+je-Ve*je,at=2*Ve-qe;return[x(255*D(at,qe,Ue+1/3)),x(255*D(at,qe,Ue)),x(255*D(at,qe,Ue-1/3)),ke];default:return null}}return null}}catch{}}).parseCSSColor,Kr=function(a,u,A,x){x===void 0&&(x=1),this.r=a,this.g=u,this.b=A,this.a=x};Kr.parse=function(a){if(a){if(a instanceof Kr)return a;if(typeof a=="string"){var u=Wt(a);if(u)return new Kr(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},Kr.prototype.toString=function(){var a=this.toArray(),u=a[1],A=a[2],x=a[3];return"rgba("+Math.round(a[0])+","+Math.round(u)+","+Math.round(A)+","+x+")"},Kr.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},Kr.black=new Kr(0,0,0,1),Kr.white=new Kr(1,1,1,1),Kr.transparent=new Kr(0,0,0,0),Kr.red=new Kr(1,0,0,1);var Ni=function(a,u,A){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=A,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ni.prototype.compare=function(a,u){return this.collator.compare(a,u)},Ni.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var sa=function(a,u,A,x,E){this.text=a,this.image=u,this.scale=A,this.fontStack=x,this.textColor=E},ri=function(a){this.sections=a};ri.fromString=function(a){return new ri([new sa(a,null,null,null,null)])},ri.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},ri.factory=function(a){return a instanceof ri?a:ri.fromString(a)},ri.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},ri.prototype.serialize=function(){for(var a=["format"],u=0,A=this.sections;u<A.length;u+=1){var x=A[u];if(x.image)a.push(["image",x.image.name]);else{a.push(x.text);var E={};x.fontStack&&(E["text-font"]=["literal",x.fontStack.split(",")]),x.scale&&(E["font-scale"]=x.scale),x.textColor&&(E["text-color"]=["rgba"].concat(x.textColor.toArray())),a.push(E)}}return a};var kn=function(a){this.name=a.name,this.available=a.available};function Ie(a,u,A,x){return typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof A=="number"&&A>=0&&A<=255?x===void 0||typeof x=="number"&&x>=0&&x<=1?null:"Invalid rgba value ["+[a,u,A,x].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof x=="number"?[a,u,A,x]:[a,u,A]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Do(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Kr||a instanceof Ni||a instanceof ri||a instanceof kn)return!0;if(Array.isArray(a)){for(var u=0,A=a;u<A.length;u+=1)if(!Do(A[u]))return!1;return!0}if(typeof a=="object"){for(var x in a)if(!Do(a[x]))return!1;return!0}return!1}function Un(a){if(a===null)return Ft;if(typeof a=="string")return Dt;if(typeof a=="boolean")return St;if(typeof a=="number")return ut;if(a instanceof Kr)return zt;if(a instanceof Ni)return $r;if(a instanceof ri)return en;if(a instanceof kn)return Gr;if(Array.isArray(a)){for(var u,A=a.length,x=0,E=a;x<E.length;x+=1){var I=Un(E[x]);if(u){if(u===I)continue;u=qt;break}u=I}return Vr(u||qt,A)}return Fr}function Oo(a){var u=typeof a;return a===null?"":u==="string"||u==="number"||u==="boolean"?String(a):a instanceof Kr||a instanceof ri||a instanceof kn?a.toString():JSON.stringify(a)}kn.prototype.toString=function(){return this.name},kn.fromString=function(a){return a?new kn({name:a,available:!1}):null},kn.prototype.serialize=function(){return["image",this.name]};var Si=function(a,u){this.type=a,this.value=u};Si.parse=function(a,u){if(a.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Do(a[1]))return u.error("invalid value");var A=a[1],x=Un(A),E=u.expectedType;return x.kind!=="array"||x.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(x=E),new Si(x,A)},Si.prototype.evaluate=function(){return this.value},Si.prototype.eachChild=function(){},Si.prototype.outputDefined=function(){return!0},Si.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Kr?["rgba"].concat(this.value.toArray()):this.value instanceof ri?this.value.serialize():this.value};var ni=function(a){this.name="ExpressionEvaluationError",this.message=a};ni.prototype.toJSON=function(){return this.message};var wi={string:Dt,number:ut,boolean:St,object:Fr},Tn=function(a,u){this.type=a,this.args=u};Tn.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var A,x=1,E=a[0];if(E==="array"){var I,D;if(a.length>2){var N=a[1];if(typeof N!="string"||!(N in wi)||N==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);I=wi[N],x++}else I=qt;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);D=a[2],x++}A=Vr(I,D)}else A=wi[E];for(var H=[];x<a.length;x++){var q=u.parse(a[x],x,qt);if(!q)return null;H.push(q)}return new Tn(A,H)},Tn.prototype.evaluate=function(a){for(var u=0;u<this.args.length;u++){var A=this.args[u].evaluate(a);if(!Hr(this.type,Un(A)))return A;if(u===this.args.length-1)throw new ni("Expected value to be of type "+Lr(this.type)+", but found "+Lr(Un(A))+" instead.")}return null},Tn.prototype.eachChild=function(a){this.args.forEach(a)},Tn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Tn.prototype.serialize=function(){var a=this.type,u=[a.kind];if(a.kind==="array"){var A=a.itemType;if(A.kind==="string"||A.kind==="number"||A.kind==="boolean"){u.push(A.kind);var x=a.N;(typeof x=="number"||this.args.length>1)&&u.push(x)}}return u.concat(this.args.map(function(E){return E.serialize()}))};var ls=function(a){this.type=en,this.sections=a};ls.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var A=a[1];if(!Array.isArray(A)&&typeof A=="object")return u.error("First argument must be an image or text section.");for(var x=[],E=!1,I=1;I<=a.length-1;++I){var D=a[I];if(E&&typeof D=="object"&&!Array.isArray(D)){E=!1;var N=null;if(D["font-scale"]&&!(N=u.parse(D["font-scale"],1,ut)))return null;var H=null;if(D["text-font"]&&!(H=u.parse(D["text-font"],1,Vr(Dt))))return null;var q=null;if(D["text-color"]&&!(q=u.parse(D["text-color"],1,zt)))return null;var ee=x[x.length-1];ee.scale=N,ee.font=H,ee.textColor=q}else{var se=u.parse(a[I],1,qt);if(!se)return null;var he=se.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,x.push({content:se,scale:null,font:null,textColor:null})}}return new ls(x)},ls.prototype.evaluate=function(a){return new ri(this.sections.map(function(u){var A=u.content.evaluate(a);return Un(A)===Gr?new sa("",A,null,null,null):new sa(Oo(A),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null)}))},ls.prototype.eachChild=function(a){for(var u=0,A=this.sections;u<A.length;u+=1){var x=A[u];a(x.content),x.scale&&a(x.scale),x.font&&a(x.font),x.textColor&&a(x.textColor)}},ls.prototype.outputDefined=function(){return!1},ls.prototype.serialize=function(){for(var a=["format"],u=0,A=this.sections;u<A.length;u+=1){var x=A[u];a.push(x.content.serialize());var E={};x.scale&&(E["font-scale"]=x.scale.serialize()),x.font&&(E["text-font"]=x.font.serialize()),x.textColor&&(E["text-color"]=x.textColor.serialize()),a.push(E)}return a};var ki=function(a){this.type=Gr,this.input=a};ki.parse=function(a,u){if(a.length!==2)return u.error("Expected two arguments.");var A=u.parse(a[1],1,Dt);return A?new ki(A):u.error("No image name provided.")},ki.prototype.evaluate=function(a){var u=this.input.evaluate(a),A=kn.fromString(u);return A&&a.availableImages&&(A.available=a.availableImages.indexOf(u)>-1),A},ki.prototype.eachChild=function(a){a(this.input)},ki.prototype.outputDefined=function(){return!1},ki.prototype.serialize=function(){return["image",this.input.serialize()]};var Ss={"to-boolean":St,"to-color":zt,"to-number":ut,"to-string":Dt},xn=function(a,u){this.type=a,this.args=u};xn.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var A=a[0];if((A==="to-boolean"||A==="to-string")&&a.length!==2)return u.error("Expected one argument.");for(var x=Ss[A],E=[],I=1;I<a.length;I++){var D=u.parse(a[I],I,qt);if(!D)return null;E.push(D)}return new xn(x,E)},xn.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var u,A,x=0,E=this.args;x<E.length;x+=1){if(A=null,(u=E[x].evaluate(a))instanceof Kr)return u;if(typeof u=="string"){var I=a.parseColor(u);if(I)return I}else if(Array.isArray(u)&&!(A=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Ie(u[0],u[1],u[2],u[3])))return new Kr(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ni(A||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var D=null,N=0,H=this.args;N<H.length;N+=1){if((D=H[N].evaluate(a))===null)return 0;var q=Number(D);if(!isNaN(q))return q}throw new ni("Could not convert "+JSON.stringify(D)+" to number.")}return this.type.kind==="formatted"?ri.fromString(Oo(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?kn.fromString(Oo(this.args[0].evaluate(a))):Oo(this.args[0].evaluate(a))},xn.prototype.eachChild=function(a){this.args.forEach(a)},xn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},xn.prototype.serialize=function(){if(this.type.kind==="formatted")return new ls([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ki(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(u){a.push(u.serialize())}),a};var rl=["Unknown","Point","LineString","Polygon"],xe=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};xe.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},xe.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?rl[this.feature.type]:this.feature.type:null},xe.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},xe.prototype.canonicalID=function(){return this.canonical},xe.prototype.properties=function(){return this.feature&&this.feature.properties||{}},xe.prototype.parseColor=function(a){var u=this._parseColorCache[a];return u||(u=this._parseColorCache[a]=Kr.parse(a)),u};var Re=function(a,u,A,x){this.name=a,this.type=u,this._evaluate=A,this.args=x};Re.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Re.prototype.eachChild=function(a){this.args.forEach(a)},Re.prototype.outputDefined=function(){return!1},Re.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},Re.parse=function(a,u){var A,x=a[0],E=Re.definitions[x];if(!E)return u.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0);for(var I=Array.isArray(E)?E[0]:E.type,D=Array.isArray(E)?[[E[1],E[2]]]:E.overloads,N=D.filter(function(br){var tr=br[0];return!Array.isArray(tr)||tr.length===a.length-1}),H=null,q=0,ee=N;q<ee.length;q+=1){var se=ee[q],he=se[0],ye=se[1];H=new di(u.registry,u.path,null,u.scope);for(var ke=[],Ue=!1,je=1;je<a.length;je++){var Ve=a[je],qe=Array.isArray(he)?he[je-1]:he.type,at=H.parse(Ve,1+ke.length,qe);if(!at){Ue=!0;break}ke.push(at)}if(!Ue)if(Array.isArray(he)&&he.length!==ke.length)H.error("Expected "+he.length+" arguments, but found "+ke.length+" instead.");else{for(var pt=0;pt<ke.length;pt++){var _t=Array.isArray(he)?he[pt]:he.type,Pt=ke[pt];H.concat(pt+1).checkSubtype(_t,Pt.type)}if(H.errors.length===0)return new Re(x,I,ye,ke)}}if(N.length===1)(A=u.errors).push.apply(A,H.errors);else{for(var Gt=(N.length?N:D).map(function(br){var tr;return tr=br[0],Array.isArray(tr)?"("+tr.map(Lr).join(", ")+")":"("+Lr(tr.type)+"...)"}).join(" | "),Xt=[],mr=1;mr<a.length;mr++){var er=u.parse(a[mr],1+Xt.length);if(!er)return null;Xt.push(Lr(er.type))}u.error("Expected arguments of type "+Gt+", but found ("+Xt.join(", ")+") instead.")}return null},Re.register=function(a,u){for(var A in Re.definitions=u,u)a[A]=Re};var Je=function(a,u,A){this.type=$r,this.locale=A,this.caseSensitive=a,this.diacriticSensitive=u};function At(a,u){a[0]=Math.min(a[0],u[0]),a[1]=Math.min(a[1],u[1]),a[2]=Math.max(a[2],u[0]),a[3]=Math.max(a[3],u[1])}function Ht(a,u){return!(a[0]<=u[0]||a[2]>=u[2]||a[1]<=u[1]||a[3]>=u[3])}function gr(a,u){var A=(180+a[0])/360,x=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,E=Math.pow(2,u.z);return[Math.round(A*E*8192),Math.round(x*E*8192)]}function wr(a,u,A){return u[1]>a[1]!=A[1]>a[1]&&a[0]<(A[0]-u[0])*(a[1]-u[1])/(A[1]-u[1])+u[0]}function ii(a,u){for(var A,x,E,I,D,N,H,q=!1,ee=0,se=u.length;ee<se;ee++)for(var he=u[ee],ye=0,ke=he.length;ye<ke-1;ye++){if((I=(A=a)[0]-(x=he[ye])[0])*(H=A[1]-(E=he[ye+1])[1])-(N=A[0]-E[0])*(D=A[1]-x[1])==0&&I*N<=0&&D*H<=0)return!1;wr(a,he[ye],he[ye+1])&&(q=!q)}return q}function Ii(a,u){for(var A=0;A<u.length;A++)if(ii(a,u[A]))return!0;return!1}function Ui(a,u,A,x){var E=x[0]-A[0],I=x[1]-A[1],D=(a[0]-A[0])*I-E*(a[1]-A[1]),N=(u[0]-A[0])*I-E*(u[1]-A[1]);return D>0&&N<0||D<0&&N>0}function Vs(a,u,A){for(var x=0,E=A;x<E.length;x+=1)for(var I=E[x],D=0;D<I.length-1;++D)if((se=[(ee=I[D+1])[0]-(q=I[D])[0],ee[1]-q[1]])[0]*(he=[(H=u)[0]-(N=a)[0],H[1]-N[1]])[1]-se[1]*he[0]!=0&&Ui(N,H,q,ee)&&Ui(q,ee,N,H))return!0;var N,H,q,ee,se,he;return!1}function dh(a,u){for(var A=0;A<a.length;++A)if(!ii(a[A],u))return!1;for(var x=0;x<a.length-1;++x)if(Vs(a[x],a[x+1],u))return!1;return!0}function tf(a,u){for(var A=0;A<u.length;A++)if(dh(a,u[A]))return!0;return!1}function oa(a,u,A){for(var x=[],E=0;E<a.length;E++){for(var I=[],D=0;D<a[E].length;D++){var N=gr(a[E][D],A);At(u,N),I.push(N)}x.push(I)}return x}function nl(a,u,A){for(var x=[],E=0;E<a.length;E++){var I=oa(a[E],u,A);x.push(I)}return x}function il(a,u,A,x){if(a[0]<A[0]||a[0]>A[2]){var E=.5*x,I=a[0]-A[0]>E?-x:A[0]-a[0]>E?x:0;I===0&&(I=a[0]-A[2]>E?-x:A[2]-a[0]>E?x:0),a[0]+=I}At(u,a)}function Ah(a,u,A,x){for(var E=8192*Math.pow(2,x.z),I=[8192*x.x,8192*x.y],D=[],N=0,H=a;N<H.length;N+=1)for(var q=0,ee=H[N];q<ee.length;q+=1){var se=ee[q],he=[se.x+I[0],se.y+I[1]];il(he,u,A,E),D.push(he)}return D}function sl(a,u,A,x){for(var E,I=8192*Math.pow(2,x.z),D=[8192*x.x,8192*x.y],N=[],H=0,q=a;H<q.length;H+=1){for(var ee=[],se=0,he=q[H];se<he.length;se+=1){var ye=he[se],ke=[ye.x+D[0],ye.y+D[1]];At(u,ke),ee.push(ke)}N.push(ee)}if(u[2]-u[0]<=I/2){(E=u)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(var Ue=0,je=N;Ue<je.length;Ue+=1)for(var Ve=0,qe=je[Ue];Ve<qe.length;Ve+=1)il(qe[Ve],u,A,I)}return N}Je.parse=function(a,u){if(a.length!==2)return u.error("Expected one argument.");var A=a[1];if(typeof A!="object"||Array.isArray(A))return u.error("Collator options argument must be an object.");var x=u.parse(A["case-sensitive"]!==void 0&&A["case-sensitive"],1,St);if(!x)return null;var E=u.parse(A["diacritic-sensitive"]!==void 0&&A["diacritic-sensitive"],1,St);if(!E)return null;var I=null;return A.locale&&!(I=u.parse(A.locale,1,Dt))?null:new Je(x,E,I)},Je.prototype.evaluate=function(a){return new Ni(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Je.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Je.prototype.outputDefined=function(){return!1},Je.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Is=function(a,u){this.type=St,this.geojson=a,this.geometries=u};function Lo(a){if(a instanceof Re&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Is)return!1;var u=!0;return a.eachChild(function(A){u&&!Lo(A)&&(u=!1)}),u}function aa(a){if(a instanceof Re&&a.name==="feature-state")return!1;var u=!0;return a.eachChild(function(A){u&&!aa(A)&&(u=!1)}),u}function Ma(a,u){if(a instanceof Re&&u.indexOf(a.name)>=0)return!1;var A=!0;return a.eachChild(function(x){A&&!Ma(x,u)&&(A=!1)}),A}Is.parse=function(a,u){if(a.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Do(a[1])){var A=a[1];if(A.type==="FeatureCollection")for(var x=0;x<A.features.length;++x){var E=A.features[x].geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Is(A,A.features[x].geometry)}else if(A.type==="Feature"){var I=A.geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new Is(A,A.geometry)}else if(A.type==="Polygon"||A.type==="MultiPolygon")return new Is(A,A)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Is.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(u,A){var x=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(A.type==="Polygon"){var D=oa(A.coordinates,E,I),N=Ah(u.geometry(),x,E,I);if(!Ht(x,E))return!1;for(var H=0,q=N;H<q.length;H+=1)if(!ii(q[H],D))return!1}if(A.type==="MultiPolygon"){var ee=nl(A.coordinates,E,I),se=Ah(u.geometry(),x,E,I);if(!Ht(x,E))return!1;for(var he=0,ye=se;he<ye.length;he+=1)if(!Ii(ye[he],ee))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(u,A){var x=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(A.type==="Polygon"){var D=oa(A.coordinates,E,I),N=sl(u.geometry(),x,E,I);if(!Ht(x,E))return!1;for(var H=0,q=N;H<q.length;H+=1)if(!dh(q[H],D))return!1}if(A.type==="MultiPolygon"){var ee=nl(A.coordinates,E,I),se=sl(u.geometry(),x,E,I);if(!Ht(x,E))return!1;for(var he=0,ye=se;he<ye.length;he+=1)if(!tf(ye[he],ee))return!1}return!0}(a,this.geometries)}return!1},Is.prototype.eachChild=function(){},Is.prototype.outputDefined=function(){return!0},Is.prototype.serialize=function(){return["within",this.geojson]};var ca=function(a,u){this.type=u.type,this.name=a,this.boundExpression=u};ca.parse=function(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var A=a[1];return u.scope.has(A)?new ca(A,u.scope.get(A)):u.error('Unknown variable "'+A+'". Make sure "'+A+'" has been bound in an enclosing "let" expression before using it.',1)},ca.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},ca.prototype.eachChild=function(){},ca.prototype.outputDefined=function(){return!1},ca.prototype.serialize=function(){return["var",this.name]};var di=function(a,u,A,x,E){u===void 0&&(u=[]),x===void 0&&(x=new It),E===void 0&&(E=[]),this.registry=a,this.path=u,this.key=u.map(function(I){return"["+I+"]"}).join(""),this.scope=x,this.errors=E,this.expectedType=A};function yo(a,u){for(var A,x=a.length-1,E=0,I=x,D=0;E<=I;)if((A=a[D=Math.floor((E+I)/2)])<=u){if(D===x||u<a[D+1])return D;E=D+1}else{if(!(A>u))throw new ni("Input is not a number.");I=D-1}return 0}di.prototype.parse=function(a,u,A,x,E){return E===void 0&&(E={}),u?this.concat(u,A,x)._parse(a,E):this._parse(a,E)},di.prototype._parse=function(a,u){function A(q,ee,se){return se==="assert"?new Tn(ee,[q]):se==="coerce"?new xn(ee,[q]):q}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var x=a[0];if(typeof x!="string")return this.error("Expression name must be a string, but found "+typeof x+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var E=this.registry[x];if(E){var I=E.parse(a,this);if(!I)return null;if(this.expectedType){var D=this.expectedType,N=I.type;if(D.kind!=="string"&&D.kind!=="number"&&D.kind!=="boolean"&&D.kind!=="object"&&D.kind!=="array"||N.kind!=="value")if(D.kind!=="color"&&D.kind!=="formatted"&&D.kind!=="resolvedImage"||N.kind!=="value"&&N.kind!=="string"){if(this.checkSubtype(D,N))return null}else I=A(I,D,u.typeAnnotation||"coerce");else I=A(I,D,u.typeAnnotation||"assert")}if(!(I instanceof Si)&&I.type.kind!=="resolvedImage"&&function q(ee){if(ee instanceof ca)return q(ee.boundExpression);if(ee instanceof Re&&ee.name==="error"||ee instanceof Je||ee instanceof Is)return!1;var se=ee instanceof xn||ee instanceof Tn,he=!0;return ee.eachChild(function(ye){he=se?he&&q(ye):he&&ye instanceof Si}),!!he&&Lo(ee)&&Ma(ee,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(I)){var H=new xe;try{I=new Si(I.type,I.evaluate(H))}catch(q){return this.error(q.message),null}}return I}return this.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},di.prototype.concat=function(a,u,A){var x=typeof a=="number"?this.path.concat(a):this.path,E=A?this.scope.concat(A):this.scope;return new di(this.registry,x,u||null,E,this.errors)},di.prototype.error=function(a){for(var u=[],A=arguments.length-1;A-- >0;)u[A]=arguments[A+1];var x=""+this.key+u.map(function(E){return"["+E+"]"}).join("");this.errors.push(new Ct(x,a))},di.prototype.checkSubtype=function(a,u){var A=Hr(a,u);return A&&this.error(A),A};var On=function(a,u,A){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(var x=0,E=A;x<E.length;x+=1){var I=E[x],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function si(a,u,A){return a*(1-A)+u*A}On.parse=function(a,u){if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");var A=u.parse(a[1],1,ut);if(!A)return null;var x=[],E=null;u.expectedType&&u.expectedType.kind!=="value"&&(E=u.expectedType);for(var I=1;I<a.length;I+=2){var D=I===1?-1/0:a[I],N=a[I+1],H=I,q=I+1;if(typeof D!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(x.length&&x[x.length-1][0]>=D)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',H);var ee=u.parse(N,q,E);if(!ee)return null;E=E||ee.type,x.push([D,ee])}return new On(E,A,x)},On.prototype.evaluate=function(a){var u=this.labels,A=this.outputs;if(u.length===1)return A[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return A[0].evaluate(a);var E=u.length;return x>=u[E-1]?A[E-1].evaluate(a):A[yo(u,x)].evaluate(a)},On.prototype.eachChild=function(a){a(this.input);for(var u=0,A=this.outputs;u<A.length;u+=1)a(A[u])},On.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},On.prototype.serialize=function(){for(var a=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&a.push(this.labels[u]),a.push(this.outputs[u].serialize());return a};var Pa=Object.freeze({__proto__:null,number:si,color:function(a,u,A){return new Kr(si(a.r,u.r,A),si(a.g,u.g,A),si(a.b,u.b,A),si(a.a,u.a,A))},array:function(a,u,A){return a.map(function(x,E){return si(x,u[E],A)})}}),ol=6/29*3*(6/29),IA=Math.PI/180,MA=180/Math.PI;function rf(a){return a>.008856451679035631?Math.pow(a,1/3):a/ol+4/29}function $l(a){return a>6/29?a*a*a:ol*(a-4/29)}function Ac(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function No(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function nf(a){var u=No(a.r),A=No(a.g),x=No(a.b),E=rf((.4124564*u+.3575761*A+.1804375*x)/.95047),I=rf((.2126729*u+.7151522*A+.072175*x)/1);return{l:116*I-16,a:500*(E-I),b:200*(I-rf((.0193339*u+.119192*A+.9503041*x)/1.08883)),alpha:a.a}}function sf(a){var u=(a.l+16)/116,A=isNaN(a.a)?u:u+a.a/500,x=isNaN(a.b)?u:u-a.b/200;return u=1*$l(u),A=.95047*$l(A),x=1.08883*$l(x),new Kr(Ac(3.2404542*A-1.5371385*u-.4985314*x),Ac(-.969266*A+1.8760108*u+.041556*x),Ac(.0556434*A-.2040259*u+1.0572252*x),a.alpha)}function Kl(a,u,A){var x=u-a;return a+A*(x>180||x<-180?x-360*Math.round(x/360):x)}var lo={forward:nf,reverse:sf,interpolate:function(a,u,A){return{l:si(a.l,u.l,A),a:si(a.a,u.a,A),b:si(a.b,u.b,A),alpha:si(a.alpha,u.alpha,A)}}},Hs={forward:function(a){var u=nf(a),A=u.l,x=u.a,E=u.b,I=Math.atan2(E,x)*MA;return{h:I<0?I+360:I,c:Math.sqrt(x*x+E*E),l:A,alpha:a.a}},reverse:function(a){var u=a.h*IA,A=a.c;return sf({l:a.l,a:Math.cos(u)*A,b:Math.sin(u)*A,alpha:a.alpha})},interpolate:function(a,u,A){return{h:Kl(a.h,u.h,A),c:si(a.c,u.c,A),l:si(a.l,u.l,A),alpha:si(a.alpha,u.alpha,A)}}},of=Object.freeze({__proto__:null,lab:lo,hcl:Hs}),Fi=function(a,u,A,x,E){this.type=a,this.operator=u,this.interpolation=A,this.input=x,this.labels=[],this.outputs=[];for(var I=0,D=E;I<D.length;I+=1){var N=D[I],H=N[1];this.labels.push(N[0]),this.outputs.push(H)}};function al(a,u,A,x){var E=x-A,I=a-A;return E===0?0:u===1?I/E:(Math.pow(u,I)-1)/(Math.pow(u,E)-1)}Fi.interpolationFactor=function(a,u,A,x){var E=0;if(a.name==="exponential")E=al(u,a.base,A,x);else if(a.name==="linear")E=al(u,1,A,x);else if(a.name==="cubic-bezier"){var I=a.controlPoints;E=new f(I[0],I[1],I[2],I[3]).solve(al(u,1,A,x))}return E},Fi.parse=function(a,u){var A=a[0],x=a[1],E=a[2],I=a.slice(3);if(!Array.isArray(x)||x.length===0)return u.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){var D=x[1];if(typeof D!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:D}}else{if(x[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(x[0]),1,0);var N=x.slice(1);if(N.length!==4||N.some(function(je){return typeof je!="number"||je<0||je>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:N}}if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(E=u.parse(E,2,ut)))return null;var H=[],q=null;A==="interpolate-hcl"||A==="interpolate-lab"?q=zt:u.expectedType&&u.expectedType.kind!=="value"&&(q=u.expectedType);for(var ee=0;ee<I.length;ee+=2){var se=I[ee],he=I[ee+1],ye=ee+3,ke=ee+4;if(typeof se!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ye);if(H.length&&H[H.length-1][0]>=se)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ye);var Ue=u.parse(he,ke,q);if(!Ue)return null;q=q||Ue.type,H.push([se,Ue])}return q.kind==="number"||q.kind==="color"||q.kind==="array"&&q.itemType.kind==="number"&&typeof q.N=="number"?new Fi(q,A,x,E,H):u.error("Type "+Lr(q)+" is not interpolatable.")},Fi.prototype.evaluate=function(a){var u=this.labels,A=this.outputs;if(u.length===1)return A[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return A[0].evaluate(a);var E=u.length;if(x>=u[E-1])return A[E-1].evaluate(a);var I=yo(u,x),D=Fi.interpolationFactor(this.interpolation,x,u[I],u[I+1]),N=A[I].evaluate(a),H=A[I+1].evaluate(a);return this.operator==="interpolate"?Pa[this.type.kind.toLowerCase()](N,H,D):this.operator==="interpolate-hcl"?Hs.reverse(Hs.interpolate(Hs.forward(N),Hs.forward(H),D)):lo.reverse(lo.interpolate(lo.forward(N),lo.forward(H),D))},Fi.prototype.eachChild=function(a){a(this.input);for(var u=0,A=this.outputs;u<A.length;u+=1)a(A[u])},Fi.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Fi.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,a,this.input.serialize()],A=0;A<this.labels.length;A++)u.push(this.labels[A],this.outputs[A].serialize());return u};var la=function(a,u){this.type=a,this.args=u};la.parse=function(a,u){if(a.length<2)return u.error("Expectected at least one argument.");var A=null,x=u.expectedType;x&&x.kind!=="value"&&(A=x);for(var E=[],I=0,D=a.slice(1);I<D.length;I+=1){var N=u.parse(D[I],1+E.length,A,void 0,{typeAnnotation:"omit"});if(!N)return null;A=A||N.type,E.push(N)}var H=x&&E.some(function(q){return Hr(x,q.type)});return new la(H?qt:A,E)},la.prototype.evaluate=function(a){for(var u,A=null,x=0,E=0,I=this.args;E<I.length&&(x++,(A=I[E].evaluate(a))&&A instanceof kn&&!A.available&&(u||(u=A.name),A=null,x===this.args.length&&(A=u)),A===null);E+=1);return A},la.prototype.eachChild=function(a){this.args.forEach(a)},la.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},la.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(u){a.push(u.serialize())}),a};var ua=function(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u};ua.prototype.evaluate=function(a){return this.result.evaluate(a)},ua.prototype.eachChild=function(a){for(var u=0,A=this.bindings;u<A.length;u+=1)a(A[u][1]);a(this.result)},ua.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var A=[],x=1;x<a.length-1;x+=2){var E=a[x];if(typeof E!="string")return u.error("Expected string, but found "+typeof E+" instead.",x);if(/[^a-zA-Z0-9_]/.test(E))return u.error("Variable names must contain only alphanumeric characters or '_'.",x);var I=u.parse(a[x+1],x+1);if(!I)return null;A.push([E,I])}var D=u.parse(a[a.length-1],a.length-1,u.expectedType,A);return D?new ua(A,D):null},ua.prototype.outputDefined=function(){return this.result.outputDefined()},ua.prototype.serialize=function(){for(var a=["let"],u=0,A=this.bindings;u<A.length;u+=1){var x=A[u];a.push(x[0],x[1].serialize())}return a.push(this.result.serialize()),a};var fa=function(a,u,A){this.type=a,this.index=u,this.input=A};fa.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var A=u.parse(a[1],1,ut),x=u.parse(a[2],2,Vr(u.expectedType||qt));return A&&x?new fa(x.type.itemType,A,x):null},fa.prototype.evaluate=function(a){var u=this.index.evaluate(a),A=this.input.evaluate(a);if(u<0)throw new ni("Array index out of bounds: "+u+" < 0.");if(u>=A.length)throw new ni("Array index out of bounds: "+u+" > "+(A.length-1)+".");if(u!==Math.floor(u))throw new ni("Array index must be an integer, but found "+u+" instead.");return A[u]},fa.prototype.eachChild=function(a){a(this.index),a(this.input)},fa.prototype.outputDefined=function(){return!1},fa.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Ra=function(a,u){this.type=St,this.needle=a,this.haystack=u};Ra.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var A=u.parse(a[1],1,qt),x=u.parse(a[2],2,qt);return A&&x?fr(A.type,[St,Dt,ut,Ft,qt])?new Ra(A,x):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Lr(A.type)+" instead"):null},Ra.prototype.evaluate=function(a){var u=this.needle.evaluate(a),A=this.haystack.evaluate(a);if(!A)return!1;if(!Me(u,["boolean","string","number","null"]))throw new ni("Expected first argument to be of type boolean, string, number or null, but found "+Lr(Un(u))+" instead.");if(!Me(A,["string","array"]))throw new ni("Expected second argument to be of type array or string, but found "+Lr(Un(A))+" instead.");return A.indexOf(u)>=0},Ra.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Ra.prototype.outputDefined=function(){return!0},Ra.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ha=function(a,u,A){this.type=ut,this.needle=a,this.haystack=u,this.fromIndex=A};ha.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var A=u.parse(a[1],1,qt),x=u.parse(a[2],2,qt);if(!A||!x)return null;if(!fr(A.type,[St,Dt,ut,Ft,qt]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Lr(A.type)+" instead");if(a.length===4){var E=u.parse(a[3],3,ut);return E?new ha(A,x,E):null}return new ha(A,x)},ha.prototype.evaluate=function(a){var u=this.needle.evaluate(a),A=this.haystack.evaluate(a);if(!Me(u,["boolean","string","number","null"]))throw new ni("Expected first argument to be of type boolean, string, number or null, but found "+Lr(Un(u))+" instead.");if(!Me(A,["string","array"]))throw new ni("Expected second argument to be of type array or string, but found "+Lr(Un(A))+" instead.");if(this.fromIndex){var x=this.fromIndex.evaluate(a);return A.indexOf(u,x)}return A.indexOf(u)},ha.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},ha.prototype.outputDefined=function(){return!1},ha.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Fa=function(a,u,A,x,E,I){this.inputType=a,this.type=u,this.input=A,this.cases=x,this.outputs=E,this.otherwise=I};Fa.parse=function(a,u){if(a.length<5)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return u.error("Expected an even number of arguments.");var A,x;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var E={},I=[],D=2;D<a.length-1;D+=2){var N=a[D],H=a[D+1];Array.isArray(N)||(N=[N]);var q=u.concat(D);if(N.length===0)return q.error("Expected at least one branch label.");for(var ee=0,se=N;ee<se.length;ee+=1){var he=se[ee];if(typeof he!="number"&&typeof he!="string")return q.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return q.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof he=="number"&&Math.floor(he)!==he)return q.error("Numeric branch labels must be integer values.");if(A){if(q.checkSubtype(A,Un(he)))return null}else A=Un(he);if(E[String(he)]!==void 0)return q.error("Branch labels must be unique.");E[String(he)]=I.length}var ye=u.parse(H,D,x);if(!ye)return null;x=x||ye.type,I.push(ye)}var ke=u.parse(a[1],1,qt);if(!ke)return null;var Ue=u.parse(a[a.length-1],a.length-1,x);return Ue?ke.type.kind!=="value"&&u.concat(1).checkSubtype(A,ke.type)?null:new Fa(A,x,ke,E,I,Ue):null},Fa.prototype.evaluate=function(a){var u=this.input.evaluate(a);return(Un(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)},Fa.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Fa.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Fa.prototype.serialize=function(){for(var a=this,u=["match",this.input.serialize()],A=[],x={},E=0,I=Object.keys(this.cases).sort();E<I.length;E+=1){var D=I[E];(se=x[this.cases[D]])===void 0?(x[this.cases[D]]=A.length,A.push([this.cases[D],[D]])):A[se][1].push(D)}for(var N=function(ye){return a.inputType.kind==="number"?Number(ye):ye},H=0,q=A;H<q.length;H+=1){var ee=q[H],se=ee[0],he=ee[1];u.push(he.length===1?N(he[0]):he.map(N)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var Da=function(a,u,A){this.type=a,this.branches=u,this.otherwise=A};Da.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return u.error("Expected an odd number of arguments.");var A;u.expectedType&&u.expectedType.kind!=="value"&&(A=u.expectedType);for(var x=[],E=1;E<a.length-1;E+=2){var I=u.parse(a[E],E,St);if(!I)return null;var D=u.parse(a[E+1],E+1,A);if(!D)return null;x.push([I,D]),A=A||D.type}var N=u.parse(a[a.length-1],a.length-1,A);return N?new Da(A,x,N):null},Da.prototype.evaluate=function(a){for(var u=0,A=this.branches;u<A.length;u+=1){var x=A[u],E=x[1];if(x[0].evaluate(a))return E.evaluate(a)}return this.otherwise.evaluate(a)},Da.prototype.eachChild=function(a){for(var u=0,A=this.branches;u<A.length;u+=1){var x=A[u],E=x[1];a(x[0]),a(E)}a(this.otherwise)},Da.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},Da.prototype.serialize=function(){var a=["case"];return this.eachChild(function(u){a.push(u.serialize())}),a};var da=function(a,u,A,x){this.type=a,this.input=u,this.beginIndex=A,this.endIndex=x};function ph(a,u){return a==="=="||a==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function gh(a,u,A,x){return x.compare(u,A)===0}function wn(a,u,A){var x=a!=="=="&&a!=="!=";return function(){function E(I,D,N){this.type=St,this.lhs=I,this.rhs=D,this.collator=N,this.hasUntypedArgument=I.type.kind==="value"||D.type.kind==="value"}return E.parse=function(I,D){if(I.length!==3&&I.length!==4)return D.error("Expected two or three arguments.");var N=I[0],H=D.parse(I[1],1,qt);if(!H)return null;if(!ph(N,H.type))return D.concat(1).error('"'+N+`" comparisons are not supported for type '`+Lr(H.type)+"'.");var q=D.parse(I[2],2,qt);if(!q)return null;if(!ph(N,q.type))return D.concat(2).error('"'+N+`" comparisons are not supported for type '`+Lr(q.type)+"'.");if(H.type.kind!==q.type.kind&&H.type.kind!=="value"&&q.type.kind!=="value")return D.error("Cannot compare types '"+Lr(H.type)+"' and '"+Lr(q.type)+"'.");x&&(H.type.kind==="value"&&q.type.kind!=="value"?H=new Tn(q.type,[H]):H.type.kind!=="value"&&q.type.kind==="value"&&(q=new Tn(H.type,[q])));var ee=null;if(I.length===4){if(H.type.kind!=="string"&&q.type.kind!=="string"&&H.type.kind!=="value"&&q.type.kind!=="value")return D.error("Cannot use collator to compare non-string types.");if(!(ee=D.parse(I[3],3,$r)))return null}return new E(H,q,ee)},E.prototype.evaluate=function(I){var D=this.lhs.evaluate(I),N=this.rhs.evaluate(I);if(x&&this.hasUntypedArgument){var H=Un(D),q=Un(N);if(H.kind!==q.kind||H.kind!=="string"&&H.kind!=="number")throw new ni('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+H.kind+", "+q.kind+") instead.")}if(this.collator&&!x&&this.hasUntypedArgument){var ee=Un(D),se=Un(N);if(ee.kind!=="string"||se.kind!=="string")return u(I,D,N)}return this.collator?A(I,D,N,this.collator.evaluate(I)):u(I,D,N)},E.prototype.eachChild=function(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)},E.prototype.outputDefined=function(){return!0},E.prototype.serialize=function(){var I=[a];return this.eachChild(function(D){I.push(D.serialize())}),I},E}()}da.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var A=u.parse(a[1],1,qt),x=u.parse(a[2],2,ut);if(!A||!x)return null;if(!fr(A.type,[Vr(qt),Dt,qt]))return u.error("Expected first argument to be of type array or string, but found "+Lr(A.type)+" instead");if(a.length===4){var E=u.parse(a[3],3,ut);return E?new da(A.type,A,x,E):null}return new da(A.type,A,x)},da.prototype.evaluate=function(a){var u=this.input.evaluate(a),A=this.beginIndex.evaluate(a);if(!Me(u,["string","array"]))throw new ni("Expected first argument to be of type array or string, but found "+Lr(Un(u))+" instead.");if(this.endIndex){var x=this.endIndex.evaluate(a);return u.slice(A,x)}return u.slice(A)},da.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},da.prototype.outputDefined=function(){return!1},da.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ql=wn("==",function(a,u,A){return u===A},gh),Zl=wn("!=",function(a,u,A){return u!==A},function(a,u,A,x){return!gh(0,u,A,x)}),mh=wn("<",function(a,u,A){return u<A},function(a,u,A,x){return x.compare(u,A)<0}),_h=wn(">",function(a,u,A){return u>A},function(a,u,A,x){return x.compare(u,A)>0}),pc=wn("<=",function(a,u,A){return u<=A},function(a,u,A,x){return x.compare(u,A)<=0}),yh=wn(">=",function(a,u,A){return u>=A},function(a,u,A,x){return x.compare(u,A)>=0}),ko=function(a,u,A,x,E){this.type=Dt,this.number=a,this.locale=u,this.currency=A,this.minFractionDigits=x,this.maxFractionDigits=E};ko.parse=function(a,u){if(a.length!==3)return u.error("Expected two arguments.");var A=u.parse(a[1],1,ut);if(!A)return null;var x=a[2];if(typeof x!="object"||Array.isArray(x))return u.error("NumberFormat options argument must be an object.");var E=null;if(x.locale&&!(E=u.parse(x.locale,1,Dt)))return null;var I=null;if(x.currency&&!(I=u.parse(x.currency,1,Dt)))return null;var D=null;if(x["min-fraction-digits"]&&!(D=u.parse(x["min-fraction-digits"],1,ut)))return null;var N=null;return x["max-fraction-digits"]&&!(N=u.parse(x["max-fraction-digits"],1,ut))?null:new ko(A,E,I,D,N)},ko.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},ko.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},ko.prototype.outputDefined=function(){return!1},ko.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var Uo=function(a){this.type=ut,this.input=a};Uo.parse=function(a,u){if(a.length!==2)return u.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var A=u.parse(a[1],1);return A?A.type.kind!=="array"&&A.type.kind!=="string"&&A.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Lr(A.type)+" instead."):new Uo(A):null},Uo.prototype.evaluate=function(a){var u=this.input.evaluate(a);if(typeof u=="string"||Array.isArray(u))return u.length;throw new ni("Expected value to be of type string or array, but found "+Lr(Un(u))+" instead.")},Uo.prototype.eachChild=function(a){a(this.input)},Uo.prototype.outputDefined=function(){return!1},Uo.prototype.serialize=function(){var a=["length"];return this.eachChild(function(u){a.push(u.serialize())}),a};var js={"==":ql,"!=":Zl,">":_h,"<":mh,">=":yh,"<=":pc,array:Tn,at:fa,boolean:Tn,case:Da,coalesce:la,collator:Je,format:ls,image:ki,in:Ra,"index-of":ha,interpolate:Fi,"interpolate-hcl":Fi,"interpolate-lab":Fi,length:Uo,let:ua,literal:Si,match:Fa,number:Tn,"number-format":ko,object:Tn,slice:da,step:On,string:Tn,"to-boolean":xn,"to-color":xn,"to-number":xn,"to-string":xn,var:ca,within:Is};function vh(a,u){var A=u[0],x=u[1],E=u[2],I=u[3];A=A.evaluate(a),x=x.evaluate(a),E=E.evaluate(a);var D=I?I.evaluate(a):1,N=Ie(A,x,E,D);if(N)throw new ni(N);return new Kr(A/255*D,x/255*D,E/255*D,D)}function Yl(a,u){return a in u}function Ql(a,u){var A=u[a];return A===void 0?null:A}function Oa(a){return{type:a}}function af(a){return{result:"success",value:a}}function zo(a){return{result:"error",value:a}}function Go(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function cl(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Bn(a){return!!a.expression&&a.expression.interpolated}function Mn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function eu(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function PA(a){return a}function gc(a,u,A){return a!==void 0?a:u!==void 0?u:A!==void 0?A:void 0}function bh(a,u,A,x,E){return gc(typeof A===E?x[A]:void 0,a.default,u.default)}function RA(a,u,A){if(Mn(A)!=="number")return gc(a.default,u.default);var x=a.stops.length;if(x===1||A<=a.stops[0][0])return a.stops[0][1];if(A>=a.stops[x-1][0])return a.stops[x-1][1];var E=yo(a.stops.map(function(I){return I[0]}),A);return a.stops[E][1]}function xh(a,u,A){var x=a.base!==void 0?a.base:1;if(Mn(A)!=="number")return gc(a.default,u.default);var E=a.stops.length;if(E===1||A<=a.stops[0][0])return a.stops[0][1];if(A>=a.stops[E-1][0])return a.stops[E-1][1];var I=yo(a.stops.map(function(se){return se[0]}),A),D=function(se,he,ye,ke){var Ue=ke-ye,je=se-ye;return Ue===0?0:he===1?je/Ue:(Math.pow(he,je)-1)/(Math.pow(he,Ue)-1)}(A,x,a.stops[I][0],a.stops[I+1][0]),N=a.stops[I][1],H=a.stops[I+1][1],q=Pa[u.type]||PA;if(a.colorSpace&&a.colorSpace!=="rgb"){var ee=of[a.colorSpace];q=function(se,he){return ee.reverse(ee.interpolate(ee.forward(se),ee.forward(he),D))}}return typeof N.evaluate=="function"?{evaluate:function(){for(var se=[],he=arguments.length;he--;)se[he]=arguments[he];var ye=N.evaluate.apply(void 0,se),ke=H.evaluate.apply(void 0,se);if(ye!==void 0&&ke!==void 0)return q(ye,ke,D)}}:q(N,H,D)}function Ki(a,u,A){return u.type==="color"?A=Kr.parse(A):u.type==="formatted"?A=ri.fromString(A.toString()):u.type==="resolvedImage"?A=kn.fromString(A.toString()):Mn(A)===u.type||u.type==="enum"&&u.values[A]||(A=void 0),gc(A,a.default,u.default)}Re.register(js,{error:[{kind:"error"},[Dt],function(a,u){throw new ni(u[0].evaluate(a))}],typeof:[Dt,[qt],function(a,u){return Lr(Un(u[0].evaluate(a)))}],"to-rgba":[Vr(ut,4),[zt],function(a,u){return u[0].evaluate(a).toArray()}],rgb:[zt,[ut,ut,ut],vh],rgba:[zt,[ut,ut,ut,ut],vh],has:{type:St,overloads:[[[Dt],function(a,u){return Yl(u[0].evaluate(a),a.properties())}],[[Dt,Fr],function(a,u){var A=u[1];return Yl(u[0].evaluate(a),A.evaluate(a))}]]},get:{type:qt,overloads:[[[Dt],function(a,u){return Ql(u[0].evaluate(a),a.properties())}],[[Dt,Fr],function(a,u){var A=u[1];return Ql(u[0].evaluate(a),A.evaluate(a))}]]},"feature-state":[qt,[Dt],function(a,u){return Ql(u[0].evaluate(a),a.featureState||{})}],properties:[Fr,[],function(a){return a.properties()}],"geometry-type":[Dt,[],function(a){return a.geometryType()}],id:[qt,[],function(a){return a.id()}],zoom:[ut,[],function(a){return a.globals.zoom}],"heatmap-density":[ut,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[ut,[],function(a){return a.globals.lineProgress||0}],accumulated:[qt,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[ut,Oa(ut),function(a,u){for(var A=0,x=0,E=u;x<E.length;x+=1)A+=E[x].evaluate(a);return A}],"*":[ut,Oa(ut),function(a,u){for(var A=1,x=0,E=u;x<E.length;x+=1)A*=E[x].evaluate(a);return A}],"-":{type:ut,overloads:[[[ut,ut],function(a,u){var A=u[1];return u[0].evaluate(a)-A.evaluate(a)}],[[ut],function(a,u){return-u[0].evaluate(a)}]]},"/":[ut,[ut,ut],function(a,u){var A=u[1];return u[0].evaluate(a)/A.evaluate(a)}],"%":[ut,[ut,ut],function(a,u){var A=u[1];return u[0].evaluate(a)%A.evaluate(a)}],ln2:[ut,[],function(){return Math.LN2}],pi:[ut,[],function(){return Math.PI}],e:[ut,[],function(){return Math.E}],"^":[ut,[ut,ut],function(a,u){var A=u[1];return Math.pow(u[0].evaluate(a),A.evaluate(a))}],sqrt:[ut,[ut],function(a,u){return Math.sqrt(u[0].evaluate(a))}],log10:[ut,[ut],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN10}],ln:[ut,[ut],function(a,u){return Math.log(u[0].evaluate(a))}],log2:[ut,[ut],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN2}],sin:[ut,[ut],function(a,u){return Math.sin(u[0].evaluate(a))}],cos:[ut,[ut],function(a,u){return Math.cos(u[0].evaluate(a))}],tan:[ut,[ut],function(a,u){return Math.tan(u[0].evaluate(a))}],asin:[ut,[ut],function(a,u){return Math.asin(u[0].evaluate(a))}],acos:[ut,[ut],function(a,u){return Math.acos(u[0].evaluate(a))}],atan:[ut,[ut],function(a,u){return Math.atan(u[0].evaluate(a))}],min:[ut,Oa(ut),function(a,u){return Math.min.apply(Math,u.map(function(A){return A.evaluate(a)}))}],max:[ut,Oa(ut),function(a,u){return Math.max.apply(Math,u.map(function(A){return A.evaluate(a)}))}],abs:[ut,[ut],function(a,u){return Math.abs(u[0].evaluate(a))}],round:[ut,[ut],function(a,u){var A=u[0].evaluate(a);return A<0?-Math.round(-A):Math.round(A)}],floor:[ut,[ut],function(a,u){return Math.floor(u[0].evaluate(a))}],ceil:[ut,[ut],function(a,u){return Math.ceil(u[0].evaluate(a))}],"filter-==":[St,[Dt,qt],function(a,u){var A=u[0],x=u[1];return a.properties()[A.value]===x.value}],"filter-id-==":[St,[qt],function(a,u){var A=u[0];return a.id()===A.value}],"filter-type-==":[St,[Dt],function(a,u){var A=u[0];return a.geometryType()===A.value}],"filter-<":[St,[Dt,qt],function(a,u){var A=u[0],x=u[1],E=a.properties()[A.value],I=x.value;return typeof E==typeof I&&E<I}],"filter-id-<":[St,[qt],function(a,u){var A=u[0],x=a.id(),E=A.value;return typeof x==typeof E&&x<E}],"filter->":[St,[Dt,qt],function(a,u){var A=u[0],x=u[1],E=a.properties()[A.value],I=x.value;return typeof E==typeof I&&E>I}],"filter-id->":[St,[qt],function(a,u){var A=u[0],x=a.id(),E=A.value;return typeof x==typeof E&&x>E}],"filter-<=":[St,[Dt,qt],function(a,u){var A=u[0],x=u[1],E=a.properties()[A.value],I=x.value;return typeof E==typeof I&&E<=I}],"filter-id-<=":[St,[qt],function(a,u){var A=u[0],x=a.id(),E=A.value;return typeof x==typeof E&&x<=E}],"filter->=":[St,[Dt,qt],function(a,u){var A=u[0],x=u[1],E=a.properties()[A.value],I=x.value;return typeof E==typeof I&&E>=I}],"filter-id->=":[St,[qt],function(a,u){var A=u[0],x=a.id(),E=A.value;return typeof x==typeof E&&x>=E}],"filter-has":[St,[qt],function(a,u){return u[0].value in a.properties()}],"filter-has-id":[St,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[St,[Vr(Dt)],function(a,u){return u[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[St,[Vr(qt)],function(a,u){return u[0].value.indexOf(a.id())>=0}],"filter-in-small":[St,[Dt,Vr(qt)],function(a,u){var A=u[0];return u[1].value.indexOf(a.properties()[A.value])>=0}],"filter-in-large":[St,[Dt,Vr(qt)],function(a,u){var A=u[0],x=u[1];return function(E,I,D,N){for(;D<=N;){var H=D+N>>1;if(I[H]===E)return!0;I[H]>E?N=H-1:D=H+1}return!1}(a.properties()[A.value],x.value,0,x.value.length-1)}],all:{type:St,overloads:[[[St,St],function(a,u){var A=u[1];return u[0].evaluate(a)&&A.evaluate(a)}],[Oa(St),function(a,u){for(var A=0,x=u;A<x.length;A+=1)if(!x[A].evaluate(a))return!1;return!0}]]},any:{type:St,overloads:[[[St,St],function(a,u){var A=u[1];return u[0].evaluate(a)||A.evaluate(a)}],[Oa(St),function(a,u){for(var A=0,x=u;A<x.length;A+=1)if(x[A].evaluate(a))return!0;return!1}]]},"!":[St,[St],function(a,u){return!u[0].evaluate(a)}],"is-supported-script":[St,[Dt],function(a,u){var A=a.globals&&a.globals.isSupportedScript;return!A||A(u[0].evaluate(a))}],upcase:[Dt,[Dt],function(a,u){return u[0].evaluate(a).toUpperCase()}],downcase:[Dt,[Dt],function(a,u){return u[0].evaluate(a).toLowerCase()}],concat:[Dt,Oa(qt),function(a,u){return u.map(function(A){return Oo(A.evaluate(a))}).join("")}],"resolved-locale":[Dt,[$r],function(a,u){return u[0].evaluate(a).resolvedLocale()}]});var Aa=function(a,u){this.expression=a,this._warningHistory={},this._evaluator=new xe,this._defaultValue=u?function(A){return A.type==="color"&&eu(A.default)?new Kr(0,0,0,0):A.type==="color"?Kr.parse(A.default)||null:A.default===void 0?null:A.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function uo(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in js}function tu(a,u){var A=new di(js,[],u?function(E){var I={color:zt,string:Dt,number:ut,enum:Dt,boolean:St,formatted:en,resolvedImage:Gr};return E.type==="array"?Vr(I[E.value]||qt,E.length):I[E.type]}(u):void 0),x=A.parse(a,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?af(new Aa(x,u)):zo(A.errors)}Aa.prototype.evaluateWithoutErrorHandling=function(a,u,A,x,E,I){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=A,this._evaluator.canonical=x,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=I,this.expression.evaluate(this._evaluator)},Aa.prototype.evaluate=function(a,u,A,x,E,I){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=A||null,this._evaluator.canonical=x,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=I||null;try{var D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new ni("Expected value to be one of "+Object.keys(this._enumValues).map(function(N){return JSON.stringify(N)}).join(", ")+", but found "+JSON.stringify(D)+" instead.");return D}catch(N){return this._warningHistory[N.message]||(this._warningHistory[N.message]=!0,typeof console<"u"&&console.warn(N.message)),this._defaultValue}};var La=function(a,u){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!aa(u.expression)};La.prototype.evaluateWithoutErrorHandling=function(a,u,A,x,E,I){return this._styleExpression.evaluateWithoutErrorHandling(a,u,A,x,E,I)},La.prototype.evaluate=function(a,u,A,x,E,I){return this._styleExpression.evaluate(a,u,A,x,E,I)};var mc=function(a,u,A,x){this.kind=a,this.zoomStops=A,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!aa(u.expression),this.interpolationType=x};function Ms(a,u){if((a=tu(a,u)).result==="error")return a;var A=a.value.expression,x=Lo(A);if(!x&&!Go(u))return zo([new Ct("","data expressions not supported")]);var E=Ma(A,["zoom"]);if(!E&&!cl(u))return zo([new Ct("","zoom expressions not supported")]);var I=function D(N){var H=null;if(N instanceof ua)H=D(N.result);else if(N instanceof la)for(var q=0,ee=N.args;q<ee.length&&!(H=D(ee[q]));q+=1);else(N instanceof On||N instanceof Fi)&&N.input instanceof Re&&N.input.name==="zoom"&&(H=N);return H instanceof Ct||N.eachChild(function(se){var he=D(se);he instanceof Ct?H=he:!H&&he?H=new Ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):H&&he&&H!==he&&(H=new Ct("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),H}(A);return I||E?I instanceof Ct?zo([I]):I instanceof Fi&&!Bn(u)?zo([new Ct("",'"interpolate" expressions cannot be used with this property')]):af(I?new mc(x?"camera":"composite",a.value,I.labels,I instanceof Fi?I.interpolation:void 0):new La(x?"constant":"source",a.value)):zo([new Ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}mc.prototype.evaluateWithoutErrorHandling=function(a,u,A,x,E,I){return this._styleExpression.evaluateWithoutErrorHandling(a,u,A,x,E,I)},mc.prototype.evaluate=function(a,u,A,x,E,I){return this._styleExpression.evaluate(a,u,A,x,E,I)},mc.prototype.interpolationFactor=function(a,u,A){return this.interpolationType?Fi.interpolationFactor(this.interpolationType,a,u,A):0};var Na=function(a,u){this._parameters=a,this._specification=u,le(this,function A(x,E){var I,D,N,H=E.type==="color",q=x.stops&&typeof x.stops[0][0]=="object",ee=q||!(q||x.property!==void 0),se=x.type||(Bn(E)?"exponential":"interval");if(H&&((x=le({},x)).stops&&(x.stops=x.stops.map(function(er){return[er[0],Kr.parse(er[1])]})),x.default=Kr.parse(x.default?x.default:E.default)),x.colorSpace&&x.colorSpace!=="rgb"&&!of[x.colorSpace])throw new Error("Unknown color space: "+x.colorSpace);if(se==="exponential")I=xh;else if(se==="interval")I=RA;else if(se==="categorical"){I=bh,D=Object.create(null);for(var he=0,ye=x.stops;he<ye.length;he+=1){var ke=ye[he];D[ke[0]]=ke[1]}N=typeof x.stops[0][0]}else{if(se!=="identity")throw new Error('Unknown function type "'+se+'"');I=Ki}if(q){for(var Ue={},je=[],Ve=0;Ve<x.stops.length;Ve++){var qe=x.stops[Ve],at=qe[0].zoom;Ue[at]===void 0&&(Ue[at]={zoom:at,type:x.type,property:x.property,default:x.default,stops:[]},je.push(at)),Ue[at].stops.push([qe[0].value,qe[1]])}for(var pt=[],_t=0,Pt=je;_t<Pt.length;_t+=1){var Gt=Pt[_t];pt.push([Ue[Gt].zoom,A(Ue[Gt],E)])}var Xt={name:"linear"};return{kind:"composite",interpolationType:Xt,interpolationFactor:Fi.interpolationFactor.bind(void 0,Xt),zoomStops:pt.map(function(er){return er[0]}),evaluate:function(er,br){var tr=er.zoom;return xh({stops:pt,base:x.base},E,tr).evaluate(tr,br)}}}if(ee){var mr=se==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:mr,interpolationFactor:Fi.interpolationFactor.bind(void 0,mr),zoomStops:x.stops.map(function(er){return er[0]}),evaluate:function(er){return I(x,E,er.zoom,D,N)}}}return{kind:"source",evaluate:function(er,br){var tr=br&&br.properties?br.properties[x.property]:void 0;return tr===void 0?gc(x.default,E.default):I(x,E,tr,D,N)}}}(this._parameters,this._specification))};function Ps(a){var u=a.key,A=a.value,x=a.valueSpec||{},E=a.objectElementValidators||{},I=a.style,D=a.styleSpec,N=[],H=Mn(A);if(H!=="object")return[new Se(u,A,"object expected, "+H+" found")];for(var q in A){var ee=q.split(".")[0],se=x[ee]||x["*"],he=void 0;if(E[ee])he=E[ee];else if(x[ee])he=nn;else if(E["*"])he=E["*"];else{if(!x["*"]){N.push(new Se(u,A[q],'unknown property "'+q+'"'));continue}he=nn}N=N.concat(he({key:(u&&u+".")+q,value:A[q],valueSpec:se,style:I,styleSpec:D,object:A,objectKey:q},A))}for(var ye in x)E[ye]||x[ye].required&&x[ye].default===void 0&&A[ye]===void 0&&N.push(new Se(u,A,'missing required property "'+ye+'"'));return N}function ka(a){var u=a.value,A=a.valueSpec,x=a.style,E=a.styleSpec,I=a.key,D=a.arrayElementValidator||nn;if(Mn(u)!=="array")return[new Se(I,u,"array expected, "+Mn(u)+" found")];if(A.length&&u.length!==A.length)return[new Se(I,u,"array length "+A.length+" expected, length "+u.length+" found")];if(A["min-length"]&&u.length<A["min-length"])return[new Se(I,u,"array length at least "+A["min-length"]+" expected, length "+u.length+" found")];var N={type:A.value,values:A.values};E.$version<7&&(N.function=A.function),Mn(A.value)==="object"&&(N=A.value);for(var H=[],q=0;q<u.length;q++)H=H.concat(D({array:u,arrayIndex:q,value:u[q],valueSpec:N,style:x,styleSpec:E,key:I+"["+q+"]"}));return H}function _c(a){var u=a.key,A=a.value,x=a.valueSpec,E=Mn(A);return E==="number"&&A!=A&&(E="NaN"),E!=="number"?[new Se(u,A,"number expected, "+E+" found")]:"minimum"in x&&A<x.minimum?[new Se(u,A,A+" is less than the minimum value "+x.minimum)]:"maximum"in x&&A>x.maximum?[new Se(u,A,A+" is greater than the maximum value "+x.maximum)]:[]}function yc(a){var u,A,x,E=a.valueSpec,I=vt(a.value.type),D={},N=I!=="categorical"&&a.value.property===void 0,H=!N,q=Mn(a.value.stops)==="array"&&Mn(a.value.stops[0])==="array"&&Mn(a.value.stops[0][0])==="object",ee=Ps({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(ye){if(I==="identity")return[new Se(ye.key,ye.value,'identity function may not have a "stops" property')];var ke=[],Ue=ye.value;return ke=ke.concat(ka({key:ye.key,value:Ue,valueSpec:ye.valueSpec,style:ye.style,styleSpec:ye.styleSpec,arrayElementValidator:se})),Mn(Ue)==="array"&&Ue.length===0&&ke.push(new Se(ye.key,Ue,"array must have at least one stop")),ke},default:function(ye){return nn({key:ye.key,value:ye.value,valueSpec:E,style:ye.style,styleSpec:ye.styleSpec})}}});return I==="identity"&&N&&ee.push(new Se(a.key,a.value,'missing required property "property"')),I==="identity"||a.value.stops||ee.push(new Se(a.key,a.value,'missing required property "stops"')),I==="exponential"&&a.valueSpec.expression&&!Bn(a.valueSpec)&&ee.push(new Se(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(H&&!Go(a.valueSpec)?ee.push(new Se(a.key,a.value,"property functions not supported")):N&&!cl(a.valueSpec)&&ee.push(new Se(a.key,a.value,"zoom functions not supported"))),I!=="categorical"&&!q||a.value.property!==void 0||ee.push(new Se(a.key,a.value,'"property" property is required')),ee;function se(ye){var ke=[],Ue=ye.value,je=ye.key;if(Mn(Ue)!=="array")return[new Se(je,Ue,"array expected, "+Mn(Ue)+" found")];if(Ue.length!==2)return[new Se(je,Ue,"array length 2 expected, length "+Ue.length+" found")];if(q){if(Mn(Ue[0])!=="object")return[new Se(je,Ue,"object expected, "+Mn(Ue[0])+" found")];if(Ue[0].zoom===void 0)return[new Se(je,Ue,"object stop key must have zoom")];if(Ue[0].value===void 0)return[new Se(je,Ue,"object stop key must have value")];if(x&&x>vt(Ue[0].zoom))return[new Se(je,Ue[0].zoom,"stop zoom values must appear in ascending order")];vt(Ue[0].zoom)!==x&&(x=vt(Ue[0].zoom),A=void 0,D={}),ke=ke.concat(Ps({key:je+"[0]",value:Ue[0],valueSpec:{zoom:{}},style:ye.style,styleSpec:ye.styleSpec,objectElementValidators:{zoom:_c,value:he}}))}else ke=ke.concat(he({key:je+"[0]",value:Ue[0],style:ye.style,styleSpec:ye.styleSpec},Ue));return uo(Ke(Ue[1]))?ke.concat([new Se(je+"[1]",Ue[1],"expressions are not allowed in function stops.")]):ke.concat(nn({key:je+"[1]",value:Ue[1],valueSpec:E,style:ye.style,styleSpec:ye.styleSpec}))}function he(ye,ke){var Ue=Mn(ye.value),je=vt(ye.value),Ve=ye.value!==null?ye.value:ke;if(u){if(Ue!==u)return[new Se(ye.key,Ve,Ue+" stop domain type must match previous stop domain type "+u)]}else u=Ue;if(Ue!=="number"&&Ue!=="string"&&Ue!=="boolean")return[new Se(ye.key,Ve,"stop domain value must be a number, string, or boolean")];if(Ue!=="number"&&I!=="categorical"){var qe="number expected, "+Ue+" found";return Go(E)&&I===void 0&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Se(ye.key,Ve,qe)]}return I!=="categorical"||Ue!=="number"||isFinite(je)&&Math.floor(je)===je?I!=="categorical"&&Ue==="number"&&A!==void 0&&je<A?[new Se(ye.key,Ve,"stop domain values must appear in ascending order")]:(A=je,I==="categorical"&&je in D?[new Se(ye.key,Ve,"stop domain values must be unique")]:(D[je]=!0,[])):[new Se(ye.key,Ve,"integer expected, found "+je)]}}function Ua(a){var u=(a.expressionContext==="property"?Ms:tu)(Ke(a.value),a.valueSpec);if(u.result==="error")return u.value.map(function(x){return new Se(""+a.key+x.key,a.value,x.message)});var A=u.value.expression||u.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!A.outputDefined())return[new Se(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!aa(A))return[new Se(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!aa(A))return[new Se(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Ma(A,["zoom","feature-state"]))return[new Se(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Lo(A))return[new Se(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vc(a){var u=a.key,A=a.value,x=a.valueSpec,E=[];return Array.isArray(x.values)?x.values.indexOf(vt(A))===-1&&E.push(new Se(u,A,"expected one of ["+x.values.join(", ")+"], "+JSON.stringify(A)+" found")):Object.keys(x.values).indexOf(vt(A))===-1&&E.push(new Se(u,A,"expected one of ["+Object.keys(x.values).join(", ")+"], "+JSON.stringify(A)+" found")),E}function ru(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var u=0,A=a.slice(1);u<A.length;u+=1){var x=A[u];if(!ru(x)&&typeof x!="boolean")return!1}return!0;default:return!0}}Na.deserialize=function(a){return new Na(a._parameters,a._specification)},Na.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var ll={type:"boolean",default:!1};function nu(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};ru(a)||(a=ul(a));var u=tu(a,ll);if(u.result==="error")throw new Error(u.value.map(function(A){return A.key+": "+A.message}).join(", "));return{filter:function(A,x,E){return u.value.evaluate(A,x,{},E)},needGeometry:function A(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(var E=1;E<x.length;E++)if(A(x[E]))return!0;return!1}(a)}}function FA(a,u){return a<u?-1:a>u?1:0}function ul(a){if(!a)return!0;var u,A=a[0];return a.length<=1?A!=="any":A==="=="?iu(a[1],a[2],"=="):A==="!="?su(iu(a[1],a[2],"==")):A==="<"||A===">"||A==="<="||A===">="?iu(a[1],a[2],A):A==="any"?(u=a.slice(1),["any"].concat(u.map(ul))):A==="all"?["all"].concat(a.slice(1).map(ul)):A==="none"?["all"].concat(a.slice(1).map(ul).map(su)):A==="in"?bc(a[1],a.slice(2)):A==="!in"?su(bc(a[1],a.slice(2))):A==="has"?za(a[1]):A==="!has"?su(za(a[1])):A!=="within"||a}function iu(a,u,A){switch(a){case"$type":return["filter-type-"+A,u];case"$id":return["filter-id-"+A,u];default:return["filter-"+A,a,u]}}function bc(a,u){if(u.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(A){return typeof A!=typeof u[0]})?["filter-in-large",a,["literal",u.sort(FA)]]:["filter-in-small",a,["literal",u]]}}function za(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function su(a){return["!",a]}function Ga(a){return ru(Ke(a.value))?Ua(le({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(A){var x=A.value,E=A.key;if(Mn(x)!=="array")return[new Se(E,x,"array expected, "+Mn(x)+" found")];var I,D=A.styleSpec,N=[];if(x.length<1)return[new Se(E,x,"filter array must have at least 1 element")];switch(N=N.concat(vc({key:E+"[0]",value:x[0],valueSpec:D.filter_operator,style:A.style,styleSpec:A.styleSpec})),vt(x[0])){case"<":case"<=":case">":case">=":x.length>=2&&vt(x[1])==="$type"&&N.push(new Se(E,x,'"$type" cannot be use with operator "'+x[0]+'"'));case"==":case"!=":x.length!==3&&N.push(new Se(E,x,'filter array for operator "'+x[0]+'" must have 3 elements'));case"in":case"!in":x.length>=2&&(I=Mn(x[1]))!=="string"&&N.push(new Se(E+"[1]",x[1],"string expected, "+I+" found"));for(var H=2;H<x.length;H++)I=Mn(x[H]),vt(x[1])==="$type"?N=N.concat(vc({key:E+"["+H+"]",value:x[H],valueSpec:D.geometry_type,style:A.style,styleSpec:A.styleSpec})):I!=="string"&&I!=="number"&&I!=="boolean"&&N.push(new Se(E+"["+H+"]",x[H],"string, number, or boolean expected, "+I+" found"));break;case"any":case"all":case"none":for(var q=1;q<x.length;q++)N=N.concat(u({key:E+"["+q+"]",value:x[q],style:A.style,styleSpec:A.styleSpec}));break;case"has":case"!has":I=Mn(x[1]),x.length!==2?N.push(new Se(E,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="string"&&N.push(new Se(E+"[1]",x[1],"string expected, "+I+" found"));break;case"within":I=Mn(x[1]),x.length!==2?N.push(new Se(E,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="object"&&N.push(new Se(E+"[1]",x[1],"object expected, "+I+" found"))}return N}(a)}function cf(a,u){var A=a.key,x=a.style,E=a.styleSpec,I=a.value,D=a.objectKey,N=E[u+"_"+a.layerType];if(!N)return[];var H=D.match(/^(.*)-transition$/);if(u==="paint"&&H&&N[H[1]]&&N[H[1]].transition)return nn({key:A,value:I,valueSpec:E.transition,style:x,styleSpec:E});var q,ee=a.valueSpec||N[D];if(!ee)return[new Se(A,I,'unknown property "'+D+'"')];if(Mn(I)==="string"&&Go(ee)&&!ee.tokens&&(q=/^{([^}]+)}$/.exec(I)))return[new Se(A,I,'"'+D+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(q[1])+" }`.")];var se=[];return a.layerType==="symbol"&&(D==="text-field"&&x&&!x.glyphs&&se.push(new Se(A,I,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&eu(Ke(I))&&vt(I.type)==="identity"&&se.push(new Se(A,I,'"text-font" does not support identity functions'))),se.concat(nn({key:a.key,value:I,valueSpec:ee,style:x,styleSpec:E,expressionContext:"property",propertyType:u,propertyKey:D}))}function lf(a){return cf(a,"paint")}function fl(a){return cf(a,"layout")}function wh(a){var u=[],A=a.value,x=a.key,E=a.style,I=a.styleSpec;A.type||A.ref||u.push(new Se(x,A,'either "type" or "ref" is required'));var D,N=vt(A.type),H=vt(A.ref);if(A.id)for(var q=vt(A.id),ee=0;ee<a.arrayIndex;ee++){var se=E.layers[ee];vt(se.id)===q&&u.push(new Se(x,A.id,'duplicate layer id "'+A.id+'", previously used at line '+se.id.__line__))}if("ref"in A)["type","source","source-layer","filter","layout"].forEach(function(ke){ke in A&&u.push(new Se(x,A[ke],'"'+ke+'" is prohibited for ref layers'))}),E.layers.forEach(function(ke){vt(ke.id)===H&&(D=ke)}),D?D.ref?u.push(new Se(x,A.ref,"ref cannot reference another ref layer")):N=vt(D.type):u.push(new Se(x,A.ref,'ref layer "'+H+'" not found'));else if(N!=="background")if(A.source){var he=E.sources&&E.sources[A.source],ye=he&&vt(he.type);he?ye==="vector"&&N==="raster"?u.push(new Se(x,A.source,'layer "'+A.id+'" requires a raster source')):ye==="raster"&&N!=="raster"?u.push(new Se(x,A.source,'layer "'+A.id+'" requires a vector source')):ye!=="vector"||A["source-layer"]?ye==="raster-dem"&&N!=="hillshade"?u.push(new Se(x,A.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="line"||!A.paint||!A.paint["line-gradient"]||ye==="geojson"&&he.lineMetrics||u.push(new Se(x,A,'layer "'+A.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new Se(x,A,'layer "'+A.id+'" must specify a "source-layer"')):u.push(new Se(x,A.source,'source "'+A.source+'" not found'))}else u.push(new Se(x,A,'missing required property "source"'));return u=u.concat(Ps({key:x,value:A,valueSpec:I.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return nn({key:x+".type",value:A.type,valueSpec:I.layer.type,style:a.style,styleSpec:a.styleSpec,object:A,objectKey:"type"})},filter:Ga,layout:function(ke){return Ps({layer:A,key:ke.key,value:ke.value,style:ke.style,styleSpec:ke.styleSpec,objectElementValidators:{"*":function(Ue){return fl(le({layerType:N},Ue))}}})},paint:function(ke){return Ps({layer:A,key:ke.key,value:ke.value,style:ke.style,styleSpec:ke.styleSpec,objectElementValidators:{"*":function(Ue){return lf(le({layerType:N},Ue))}}})}}}))}function Va(a){var u=a.value,A=a.key,x=Mn(u);return x!=="string"?[new Se(A,u,"string expected, "+x+" found")]:[]}var zn={promoteId:function(a){var u=a.key,A=a.value;if(Mn(A)==="string")return Va({key:u,value:A});var x=[];for(var E in A)x.push.apply(x,Va({key:u+"."+E,value:A[E]}));return x}};function ou(a){var u=a.value,A=a.key,x=a.styleSpec,E=a.style;if(!u.type)return[new Se(A,u,'"type" is required')];var I,D=vt(u.type);switch(D){case"vector":case"raster":case"raster-dem":return Ps({key:A,value:u,valueSpec:x["source_"+D.replace("-","_")],style:a.style,styleSpec:x,objectElementValidators:zn});case"geojson":if(I=Ps({key:A,value:u,valueSpec:x.source_geojson,style:E,styleSpec:x,objectElementValidators:zn}),u.cluster)for(var N in u.clusterProperties){var H=u.clusterProperties[N],q=H[0],ee=typeof q=="string"?[q,["accumulated"],["get",N]]:q;I.push.apply(I,Ua({key:A+"."+N+".map",value:H[1],expressionContext:"cluster-map"})),I.push.apply(I,Ua({key:A+"."+N+".reduce",value:ee,expressionContext:"cluster-reduce"}))}return I;case"video":return Ps({key:A,value:u,valueSpec:x.source_video,style:E,styleSpec:x});case"image":return Ps({key:A,value:u,valueSpec:x.source_image,style:E,styleSpec:x});case"canvas":return[new Se(A,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vc({key:A+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Vo(a){var u=a.value,A=a.styleSpec,x=A.light,E=a.style,I=[],D=Mn(u);if(u===void 0)return I;if(D!=="object")return I.concat([new Se("light",u,"object expected, "+D+" found")]);for(var N in u){var H=N.match(/^(.*)-transition$/);I=I.concat(H&&x[H[1]]&&x[H[1]].transition?nn({key:N,value:u[N],valueSpec:A.transition,style:E,styleSpec:A}):x[N]?nn({key:N,value:u[N],valueSpec:x[N],style:E,styleSpec:A}):[new Se(N,u[N],'unknown property "'+N+'"')])}return I}var Ho={"*":function(){return[]},array:ka,boolean:function(a){var u=a.value,A=a.key,x=Mn(u);return x!=="boolean"?[new Se(A,u,"boolean expected, "+x+" found")]:[]},number:_c,color:function(a){var u=a.key,A=a.value,x=Mn(A);return x!=="string"?[new Se(u,A,"color expected, "+x+" found")]:Wt(A)===null?[new Se(u,A,'color expected, "'+A+'" found')]:[]},constants:p,enum:vc,filter:Ga,function:yc,layer:wh,object:Ps,source:ou,light:Vo,string:Va,formatted:function(a){return Va(a).length===0?[]:Ua(a)},resolvedImage:function(a){return Va(a).length===0?[]:Ua(a)}};function nn(a){var u=a.value,A=a.valueSpec,x=a.styleSpec;return A.expression&&eu(vt(u))?yc(a):A.expression&&uo(Ke(u))?Ua(a):A.type&&Ho[A.type]?Ho[A.type](a):Ps(le({},a,{valueSpec:A.type?x[A.type]:A}))}function Pn(a){var u=a.value,A=a.key,x=Va(a);return x.length||(u.indexOf("{fontstack}")===-1&&x.push(new Se(A,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&x.push(new Se(A,u,'"glyphs" url must include a "{range}" token'))),x}function Rs(a,u){u===void 0&&(u=ce);var A=[];return A=A.concat(nn({key:"",value:a,valueSpec:u.$root,styleSpec:u,style:a,objectElementValidators:{glyphs:Pn,"*":function(){return[]}}})),a.constants&&(A=A.concat(p({key:"constants",value:a.constants}))),hl(A)}function hl(a){return[].concat(a).sort(function(u,A){return u.line-A.line})}function xc(a){return function(){for(var u=[],A=arguments.length;A--;)u[A]=arguments[A];return hl(a.apply(this,u))}}Rs.source=xc(ou),Rs.light=xc(Vo),Rs.layer=xc(wh),Rs.filter=xc(Ga),Rs.paintProperty=xc(lf),Rs.layoutProperty=xc(fl);var dl=Rs,DA=dl.light,OA=dl.paintProperty,wc=dl.layoutProperty;function Al(a,u){var A=!1;if(u&&u.length)for(var x=0,E=u;x<E.length;x+=1)a.fire(new de(new Error(E[x].message))),A=!0;return A}var vo=Rn;function Rn(a,u,A){var x=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var E=new Int32Array(this.arrayBuffer);a=E[0],this.d=(u=E[1])+2*(A=E[2]);for(var I=0;I<this.d*this.d;I++){var D=E[3+I],N=E[3+I+1];x.push(D===N?null:E.subarray(D,N))}var H=E[3+x.length+1];this.keys=E.subarray(E[3+x.length],H),this.bboxes=E.subarray(H),this.insert=this._insertReadonly}else{this.d=u+2*A;for(var q=0;q<this.d*this.d;q++)x.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=A,this.scale=u/a,this.uid=0;var ee=A/u*a;this.min=-ee,this.max=a+ee}Rn.prototype.insert=function(a,u,A,x,E){this._forEachCell(u,A,x,E,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(A),this.bboxes.push(x),this.bboxes.push(E)},Rn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Rn.prototype._insertCell=function(a,u,A,x,E,I){this.cells[E].push(I)},Rn.prototype.query=function(a,u,A,x,E){var I=this.min,D=this.max;if(a<=I&&u<=I&&D<=A&&D<=x&&!E)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(a,u,A,x,this._queryCell,N,{},E),N},Rn.prototype._queryCell=function(a,u,A,x,E,I,D,N){var H=this.cells[E];if(H!==null)for(var q=this.keys,ee=this.bboxes,se=0;se<H.length;se++){var he=H[se];if(D[he]===void 0){var ye=4*he;(N?N(ee[ye+0],ee[ye+1],ee[ye+2],ee[ye+3]):a<=ee[ye+2]&&u<=ee[ye+3]&&A>=ee[ye+0]&&x>=ee[ye+1])?(D[he]=!0,I.push(q[he])):D[he]=!1}}},Rn.prototype._forEachCell=function(a,u,A,x,E,I,D,N){for(var H=this._convertToCellCoord(a),q=this._convertToCellCoord(u),ee=this._convertToCellCoord(A),se=this._convertToCellCoord(x),he=H;he<=ee;he++)for(var ye=q;ye<=se;ye++){var ke=this.d*ye+he;if((!N||N(this._convertFromCellCoord(he),this._convertFromCellCoord(ye),this._convertFromCellCoord(he+1),this._convertFromCellCoord(ye+1)))&&E.call(this,a,u,A,x,ke,I,D,N))return}},Rn.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Rn.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Rn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=3+this.cells.length+1+1,A=0,x=0;x<this.cells.length;x++)A+=this.cells[x].length;var E=new Int32Array(u+A+this.keys.length+this.bboxes.length);E[0]=this.extent,E[1]=this.n,E[2]=this.padding;for(var I=u,D=0;D<a.length;D++){var N=a[D];E[3+D]=I,E.set(N,I),I+=N.length}return E[3+a.length]=I,E.set(this.keys,I),E[3+a.length+1]=I+=this.keys.length,E.set(this.bboxes,I),I+=this.bboxes.length,E.buffer};var Cc=S.ImageData,Ch=S.ImageBitmap,_i={};function nr(a,u,A){A===void 0&&(A={}),Object.defineProperty(u,"_classRegistryKey",{value:a,writeable:!1}),_i[a]={klass:u,omit:A.omit||[],shallow:A.shallow||[]}}for(var ms in nr("Object",Object),vo.serialize=function(a,u){var A=a.toArrayBuffer();return u&&u.push(A),{buffer:A}},vo.deserialize=function(a){return new vo(a.buffer)},nr("Grid",vo),nr("Color",Kr),nr("Error",Error),nr("ResolvedImage",kn),nr("StylePropertyFunction",Na),nr("StyleExpression",Aa,{omit:["_evaluator"]}),nr("ZoomDependentExpression",mc),nr("ZoomConstantExpression",La),nr("CompoundExpression",Re,{omit:["_evaluate"]}),js)js[ms]._classRegistryKey||nr("Expression_"+ms,js[ms]);function au(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Fs(a){return Ch&&a instanceof Ch}function Js(a,u){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(au(a)||Fs(a))return u&&u.push(a),a;if(ArrayBuffer.isView(a)){var A=a;return u&&u.push(A.buffer),A}if(a instanceof Cc)return u&&u.push(a.data.buffer),a;if(Array.isArray(a)){for(var x=[],E=0,I=a;E<I.length;E+=1)x.push(Js(I[E],u));return x}if(typeof a=="object"){var D=a.constructor,N=D._classRegistryKey;if(!N)throw new Error("can't serialize object of unregistered class");var H=D.serialize?D.serialize(a,u):{};if(!D.serialize){for(var q in a)if(a.hasOwnProperty(q)&&!(_i[N].omit.indexOf(q)>=0)){var ee=a[q];H[q]=_i[N].shallow.indexOf(q)>=0?ee:Js(ee,u)}a instanceof Error&&(H.message=a.message)}if(H.$name)throw new Error("$name property is reserved for worker serialization logic.");return N!=="Object"&&(H.$name=N),H}throw new Error("can't serialize object of type "+typeof a)}function us(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||au(a)||Fs(a)||ArrayBuffer.isView(a)||a instanceof Cc)return a;if(Array.isArray(a))return a.map(us);if(typeof a=="object"){var u=a.$name||"Object",A=_i[u].klass;if(!A)throw new Error("can't deserialize unregistered class "+u);if(A.deserialize)return A.deserialize(a);for(var x=Object.create(A.prototype),E=0,I=Object.keys(a);E<I.length;E+=1){var D=I[E];if(D!=="$name"){var N=a[D];x[D]=_i[u].shallow.indexOf(D)>=0?N:us(N)}}return x}throw new Error("can't deserialize object of type "+typeof a)}var uf=function(){this.first=!0};uf.prototype.update=function(a,u){var A=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=A,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=A,!0):(this.lastFloorZoom>A?(this.lastIntegerZoom=A+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<A&&(this.lastIntegerZoom=A,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=A,!0))};var Kt={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function ff(a){for(var u=0,A=a;u<A.length;u+=1)if(cu(A[u].charCodeAt(0)))return!0;return!1}function cu(a){return!(a!==746&&a!==747&&(a<4352||!(Kt["Bopomofo Extended"](a)||Kt.Bopomofo(a)||Kt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Kt["CJK Compatibility Ideographs"](a)||Kt["CJK Compatibility"](a)||Kt["CJK Radicals Supplement"](a)||Kt["CJK Strokes"](a)||!(!Kt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Kt["CJK Unified Ideographs Extension A"](a)||Kt["CJK Unified Ideographs"](a)||Kt["Enclosed CJK Letters and Months"](a)||Kt["Hangul Compatibility Jamo"](a)||Kt["Hangul Jamo Extended-A"](a)||Kt["Hangul Jamo Extended-B"](a)||Kt["Hangul Jamo"](a)||Kt["Hangul Syllables"](a)||Kt.Hiragana(a)||Kt["Ideographic Description Characters"](a)||Kt.Kanbun(a)||Kt["Kangxi Radicals"](a)||Kt["Katakana Phonetic Extensions"](a)||Kt.Katakana(a)&&a!==12540||!(!Kt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Kt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Kt["Unified Canadian Aboriginal Syllabics"](a)||Kt["Unified Canadian Aboriginal Syllabics Extended"](a)||Kt["Vertical Forms"](a)||Kt["Yijing Hexagram Symbols"](a)||Kt["Yi Syllables"](a)||Kt["Yi Radicals"](a))))}function hf(a){return!(cu(a)||function(u){return!!(Kt["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||Kt["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Kt["Letterlike Symbols"](u)||Kt["Number Forms"](u)||Kt["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||Kt["Control Pictures"](u)&&u!==9251||Kt["Optical Character Recognition"](u)||Kt["Enclosed Alphanumerics"](u)||Kt["Geometric Shapes"](u)||Kt["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||Kt["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||Kt["CJK Symbols and Punctuation"](u)||Kt.Katakana(u)||Kt["Private Use Area"](u)||Kt["CJK Compatibility Forms"](u)||Kt["Small Form Variants"](u)||Kt["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(a))}function Ws(a){return a>=1424&&a<=2303||Kt["Arabic Presentation Forms-A"](a)||Kt["Arabic Presentation Forms-B"](a)}function _s(a,u){return!(!u&&Ws(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Kt.Khmer(a))}function lu(a){for(var u=0,A=a;u<A.length;u+=1)if(Ws(A[u].charCodeAt(0)))return!0;return!1}var uu=null,ys="unavailable",jo=null,df=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(ys="error"),uu&&uu(a)};function Ec(){yi.fire(new Oe("pluginStateChange",{pluginStatus:ys,pluginURL:jo}))}var yi=new be,Af=function(){return ys},fo=function(){if(ys!=="deferred"||!jo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ys="loading",Ec(),jo&&Xe({url:jo},function(a){a?df(a):(ys="loaded",Ec())})},qi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ys==="loaded"||qi.applyArabicShaping!=null},isLoading:function(){return ys==="loading"},setState:function(a){ys=a.pluginStatus,jo=a.pluginURL},isParsed:function(){return qi.applyArabicShaping!=null&&qi.processBidirectionalText!=null&&qi.processStyledBidirectionalText!=null},getPluginURL:function(){return jo}},Nr=function(a,u){this.zoom=a,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uf,this.transition={})};Nr.prototype.isSupportedScript=function(a){return function(u,A){for(var x=0,E=u;x<E.length;x+=1)if(!_s(E[x].charCodeAt(0),A))return!1;return!0}(a,qi.isLoaded())},Nr.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Nr.prototype.getCrossfadeParameters=function(){var a=this.zoom,u=a-Math.floor(a),A=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*A}:{fromScale:.5,toScale:1,t:1-(1-A)*u}};var bo=function(a,u){this.property=a,this.value=u,this.expression=function(A,x){if(eu(A))return new Na(A,x);if(uo(A)){var E=Ms(A,x);if(E.result==="error")throw new Error(E.value.map(function(D){return D.key+": "+D.message}).join(", "));return E.value}var I=A;return typeof A=="string"&&x.type==="color"&&(I=Kr.parse(A)),{kind:"constant",evaluate:function(){return I}}}(u===void 0?a.specification.default:u,a.specification)};bo.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},bo.prototype.possiblyEvaluate=function(a,u,A){return this.property.possiblyEvaluate(this,a,u,A)};var Xs=function(a){this.property=a,this.value=new bo(a,void 0)};Xs.prototype.transitioned=function(a,u){return new pa(this.property,this.value,u,V({},a.transition,this.transition),a.now)},Xs.prototype.untransitioned=function(){return new pa(this.property,this.value,null,{},0)};var zi=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};zi.prototype.getValue=function(a){return pe(this._values[a].value.value)},zi.prototype.setValue=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new Xs(this._values[a].property)),this._values[a].value=new bo(this._values[a].property,u===null?void 0:pe(u))},zi.prototype.getTransition=function(a){return pe(this._values[a].transition)},zi.prototype.setTransition=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new Xs(this._values[a].property)),this._values[a].transition=pe(u)||void 0},zi.prototype.serialize=function(){for(var a={},u=0,A=Object.keys(this._values);u<A.length;u+=1){var x=A[u],E=this.getValue(x);E!==void 0&&(a[x]=E);var I=this.getTransition(x);I!==void 0&&(a[x+"-transition"]=I)}return a},zi.prototype.transitioned=function(a,u){for(var A=new Jo(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var I=E[x];A._values[I]=this._values[I].transitioned(a,u._values[I])}return A},zi.prototype.untransitioned=function(){for(var a=new Jo(this._properties),u=0,A=Object.keys(this._values);u<A.length;u+=1){var x=A[u];a._values[x]=this._values[x].untransitioned()}return a};var pa=function(a,u,A,x,E){this.property=a,this.value=u,this.begin=E+x.delay||0,this.end=this.begin+x.duration||0,a.specification.transition&&(x.delay||x.duration)&&(this.prior=A)};pa.prototype.possiblyEvaluate=function(a,u,A){var x=a.now||0,E=this.value.possiblyEvaluate(a,u,A),I=this.prior;if(I){if(x>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(x<this.begin)return I.possiblyEvaluate(a,u,A);var D=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(a,u,A),E,function(N){if(N<=0)return 0;if(N>=1)return 1;var H=N*N,q=H*N;return 4*(N<.5?q:3*(N-H)+q-.75)}(D))}return E};var Jo=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};Jo.prototype.possiblyEvaluate=function(a,u,A){for(var x=new pl(this._properties),E=0,I=Object.keys(this._values);E<I.length;E+=1){var D=I[E];x._values[D]=this._values[D].possiblyEvaluate(a,u,A)}return x},Jo.prototype.hasTransition=function(){for(var a=0,u=Object.keys(this._values);a<u.length;a+=1)if(this._values[u[a]].prior)return!0;return!1};var $s=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};$s.prototype.getValue=function(a){return pe(this._values[a].value)},$s.prototype.setValue=function(a,u){this._values[a]=new bo(this._values[a].property,u===null?void 0:pe(u))},$s.prototype.serialize=function(){for(var a={},u=0,A=Object.keys(this._values);u<A.length;u+=1){var x=A[u],E=this.getValue(x);E!==void 0&&(a[x]=E)}return a},$s.prototype.possiblyEvaluate=function(a,u,A){for(var x=new pl(this._properties),E=0,I=Object.keys(this._values);E<I.length;E+=1){var D=I[E];x._values[D]=this._values[D].possiblyEvaluate(a,u,A)}return x};var Zi=function(a,u,A){this.property=a,this.value=u,this.parameters=A};Zi.prototype.isConstant=function(){return this.value.kind==="constant"},Zi.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},Zi.prototype.evaluate=function(a,u,A,x){return this.property.evaluate(this.value,this.parameters,a,u,A,x)};var pl=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};pl.prototype.get=function(a){return this._values[a]};var _r=function(a){this.specification=a};_r.prototype.possiblyEvaluate=function(a,u){return a.expression.evaluate(u)},_r.prototype.interpolate=function(a,u,A){var x=Pa[this.specification.type];return x?x(a,u,A):a};var or=function(a,u){this.specification=a,this.overrides=u};or.prototype.possiblyEvaluate=function(a,u,A,x){return new Zi(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},A,x)}:a.expression,u)},or.prototype.interpolate=function(a,u,A){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new Zi(this,{kind:"constant",value:void 0},a.parameters);var x=Pa[this.specification.type];return x?new Zi(this,{kind:"constant",value:x(a.value.value,u.value.value,A)},a.parameters):a},or.prototype.evaluate=function(a,u,A,x,E,I){return a.kind==="constant"?a.value:a.evaluate(u,A,x,E,I)};var fu=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(A,x,E,I){if(A.value===void 0)return new Zi(this,{kind:"constant",value:void 0},x);if(A.expression.kind==="constant"){var D=A.expression.evaluate(x,null,{},E,I),N=A.property.specification.type==="resolvedImage"&&typeof D!="string"?D.name:D,H=this._calculate(N,N,N,x);return new Zi(this,{kind:"constant",value:H},x)}if(A.expression.kind==="camera"){var q=this._calculate(A.expression.evaluate({zoom:x.zoom-1}),A.expression.evaluate({zoom:x.zoom}),A.expression.evaluate({zoom:x.zoom+1}),x);return new Zi(this,{kind:"constant",value:q},x)}return new Zi(this,A.expression,x)},u.prototype.evaluate=function(A,x,E,I,D,N){if(A.kind==="source"){var H=A.evaluate(x,E,I,D,N);return this._calculate(H,H,H,x)}return A.kind==="composite"?this._calculate(A.evaluate({zoom:Math.floor(x.zoom)-1},E,I),A.evaluate({zoom:Math.floor(x.zoom)},E,I),A.evaluate({zoom:Math.floor(x.zoom)+1},E,I),x):A.value},u.prototype._calculate=function(A,x,E,I){return I.zoom>I.zoomHistory.lastIntegerZoom?{from:A,to:x}:{from:E,to:x}},u.prototype.interpolate=function(A){return A},u}(or),ns=function(a){this.specification=a};ns.prototype.possiblyEvaluate=function(a,u,A,x){if(a.value!==void 0){if(a.expression.kind==="constant"){var E=a.expression.evaluate(u,null,{},A,x);return this._calculate(E,E,E,u)}return this._calculate(a.expression.evaluate(new Nr(Math.floor(u.zoom-1),u)),a.expression.evaluate(new Nr(Math.floor(u.zoom),u)),a.expression.evaluate(new Nr(Math.floor(u.zoom+1),u)),u)}},ns.prototype._calculate=function(a,u,A,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:A,to:u}},ns.prototype.interpolate=function(a){return a};var Gi=function(a){this.specification=a};Gi.prototype.possiblyEvaluate=function(a,u,A,x){return!!a.expression.evaluate(u,null,{},A,x)},Gi.prototype.interpolate=function(){return!1};var Gn=function(a){for(var u in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var A=a[u];A.specification.overridable&&this.overridableProperties.push(u);var x=this.defaultPropertyValues[u]=new bo(A,void 0),E=this.defaultTransitionablePropertyValues[u]=new Xs(A);this.defaultTransitioningPropertyValues[u]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=x.possiblyEvaluate({})}};nr("DataDrivenProperty",or),nr("DataConstantProperty",_r),nr("CrossFadedDataDrivenProperty",fu),nr("CrossFadedProperty",ns),nr("ColorRampProperty",Gi);var Dr=function(a){function u(A,x){if(a.call(this),this.id=A.id,this.type=A.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},A.type!=="custom"&&(this.metadata=(A=A).metadata,this.minzoom=A.minzoom,this.maxzoom=A.maxzoom,A.type!=="background"&&(this.source=A.source,this.sourceLayer=A["source-layer"],this.filter=A.filter),x.layout&&(this._unevaluatedLayout=new $s(x.layout)),x.paint)){for(var E in this._transitionablePaint=new zi(x.paint),A.paint)this.setPaintProperty(E,A.paint[E],{validate:!1});for(var I in A.layout)this.setLayoutProperty(I,A.layout[I],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pl(x.paint)}}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(A){return A==="visibility"?this.visibility:this._unevaluatedLayout.getValue(A)},u.prototype.setLayoutProperty=function(A,x,E){E===void 0&&(E={}),x!=null&&this._validate(wc,"layers."+this.id+".layout."+A,A,x,E)||(A!=="visibility"?this._unevaluatedLayout.setValue(A,x):this.visibility=x)},u.prototype.getPaintProperty=function(A){return ze(A,"-transition")?this._transitionablePaint.getTransition(A.slice(0,-11)):this._transitionablePaint.getValue(A)},u.prototype.setPaintProperty=function(A,x,E){if(E===void 0&&(E={}),x!=null&&this._validate(OA,"layers."+this.id+".paint."+A,A,x,E))return!1;if(ze(A,"-transition"))return this._transitionablePaint.setTransition(A.slice(0,-11),x||void 0),!1;var I=this._transitionablePaint._values[A],D=I.property.specification["property-type"]==="cross-faded-data-driven",N=I.value.isDataDriven(),H=I.value;this._transitionablePaint.setValue(A,x),this._handleSpecialPaintPropertyUpdate(A);var q=this._transitionablePaint._values[A].value;return q.isDataDriven()||N||D||this._handleOverridablePaintPropertyUpdate(A,H,q)},u.prototype._handleSpecialPaintPropertyUpdate=function(A){},u.prototype._handleOverridablePaintPropertyUpdate=function(A,x,E){return!1},u.prototype.isHidden=function(A){return!!(this.minzoom&&A<this.minzoom)||!!(this.maxzoom&&A>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(A){this._transitioningPaint=this._transitionablePaint.transitioned(A,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(A,x){A.getCrossfadeParameters&&(this._crossfadeParameters=A.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(A,void 0,x)),this.paint=this._transitioningPaint.possiblyEvaluate(A,void 0,x)},u.prototype.serialize=function(){var A={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(A.layout=A.layout||{},A.layout.visibility=this.visibility),_e(A,function(x,E){return!(x===void 0||E==="layout"&&!Object.keys(x).length||E==="paint"&&!Object.keys(x).length)})},u.prototype._validate=function(A,x,E,I,D){return D===void 0&&(D={}),(!D||D.validate!==!1)&&Al(this,A.call(dl,{key:x,layerType:this.type,objectKey:E,value:I,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var A in this.paint._values){var x=this.paint.get(A);if(x instanceof Zi&&Go(x.property.specification)&&(x.value.kind==="source"||x.value.kind==="composite")&&x.value.isStateDependent)return!0}return!1},u}(be),Ks={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},cn=function(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},jr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Mi(a,u){u===void 0&&(u=1);var A=0,x=0;return{members:a.map(function(E){var I=Ks[E.type].BYTES_PER_ELEMENT,D=A=hu(A,Math.max(u,I)),N=E.components||1;return x=Math.max(x,I),A+=I*N,{name:E.name,type:E.type,components:N,offset:D}}),size:hu(A,Math.max(x,u)),alignment:u}}function hu(a,u){return Math.ceil(a/u)*u}jr.serialize=function(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},jr.deserialize=function(a){var u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},jr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},jr.prototype.clear=function(){this.length=0},jr.prototype.resize=function(a){this.reserve(a),this.length=a},jr.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},jr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ds=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x){var E=this.length;return this.resize(E+1),this.emplace(E,A,x)},u.prototype.emplace=function(A,x,E){var I=2*A;return this.int16[I+0]=x,this.int16[I+1]=E,A},u}(jr);Ds.prototype.bytesPerElement=4,nr("StructArrayLayout2i4",Ds);var pf=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I){var D=this.length;return this.resize(D+1),this.emplace(D,A,x,E,I)},u.prototype.emplace=function(A,x,E,I,D){var N=4*A;return this.int16[N+0]=x,this.int16[N+1]=E,this.int16[N+2]=I,this.int16[N+3]=D,A},u}(jr);pf.prototype.bytesPerElement=8,nr("StructArrayLayout4i8",pf);var oi=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,D,N){var H=this.length;return this.resize(H+1),this.emplace(H,A,x,E,I,D,N)},u.prototype.emplace=function(A,x,E,I,D,N,H){var q=6*A;return this.int16[q+0]=x,this.int16[q+1]=E,this.int16[q+2]=I,this.int16[q+3]=D,this.int16[q+4]=N,this.int16[q+5]=H,A},u}(jr);oi.prototype.bytesPerElement=12,nr("StructArrayLayout2i4i12",oi);var Yi=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,D,N){var H=this.length;return this.resize(H+1),this.emplace(H,A,x,E,I,D,N)},u.prototype.emplace=function(A,x,E,I,D,N,H){var q=4*A,ee=8*A;return this.int16[q+0]=x,this.int16[q+1]=E,this.uint8[ee+4]=I,this.uint8[ee+5]=D,this.uint8[ee+6]=N,this.uint8[ee+7]=H,A},u}(jr);Yi.prototype.bytesPerElement=8,nr("StructArrayLayout2i4ub8",Yi);var ho=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x){var E=this.length;return this.resize(E+1),this.emplace(E,A,x)},u.prototype.emplace=function(A,x,E){var I=2*A;return this.float32[I+0]=x,this.float32[I+1]=E,A},u}(jr);ho.prototype.bytesPerElement=8,nr("StructArrayLayout2f8",ho);var Ao=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,D,N,H,q,ee,se){var he=this.length;return this.resize(he+1),this.emplace(he,A,x,E,I,D,N,H,q,ee,se)},u.prototype.emplace=function(A,x,E,I,D,N,H,q,ee,se,he){var ye=10*A;return this.uint16[ye+0]=x,this.uint16[ye+1]=E,this.uint16[ye+2]=I,this.uint16[ye+3]=D,this.uint16[ye+4]=N,this.uint16[ye+5]=H,this.uint16[ye+6]=q,this.uint16[ye+7]=ee,this.uint16[ye+8]=se,this.uint16[ye+9]=he,A},u}(jr);Ao.prototype.bytesPerElement=20,nr("StructArrayLayout10ui20",Ao);var jt=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,D,N,H,q,ee,se,he,ye){var ke=this.length;return this.resize(ke+1),this.emplace(ke,A,x,E,I,D,N,H,q,ee,se,he,ye)},u.prototype.emplace=function(A,x,E,I,D,N,H,q,ee,se,he,ye,ke){var Ue=12*A;return this.int16[Ue+0]=x,this.int16[Ue+1]=E,this.int16[Ue+2]=I,this.int16[Ue+3]=D,this.uint16[Ue+4]=N,this.uint16[Ue+5]=H,this.uint16[Ue+6]=q,this.uint16[Ue+7]=ee,this.int16[Ue+8]=se,this.int16[Ue+9]=he,this.int16[Ue+10]=ye,this.int16[Ue+11]=ke,A},u}(jr);jt.prototype.bytesPerElement=24,nr("StructArrayLayout4i4ui4i24",jt);var Yt=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,E)},u.prototype.emplace=function(A,x,E,I){var D=3*A;return this.float32[D+0]=x,this.float32[D+1]=E,this.float32[D+2]=I,A},u}(jr);Yt.prototype.bytesPerElement=12,nr("StructArrayLayout3f12",Yt);var Tc=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A){var x=this.length;return this.resize(x+1),this.emplace(x,A)},u.prototype.emplace=function(A,x){return this.uint32[1*A+0]=x,A},u}(jr);Tc.prototype.bytesPerElement=4,nr("StructArrayLayout1ul4",Tc);var gl=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,D,N,H,q,ee){var se=this.length;return this.resize(se+1),this.emplace(se,A,x,E,I,D,N,H,q,ee)},u.prototype.emplace=function(A,x,E,I,D,N,H,q,ee,se){var he=10*A,ye=5*A;return this.int16[he+0]=x,this.int16[he+1]=E,this.int16[he+2]=I,this.int16[he+3]=D,this.int16[he+4]=N,this.int16[he+5]=H,this.uint32[ye+3]=q,this.uint16[he+8]=ee,this.uint16[he+9]=se,A},u}(jr);gl.prototype.bytesPerElement=20,nr("StructArrayLayout6i1ul2ui20",gl);var Wo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,D,N){var H=this.length;return this.resize(H+1),this.emplace(H,A,x,E,I,D,N)},u.prototype.emplace=function(A,x,E,I,D,N,H){var q=6*A;return this.int16[q+0]=x,this.int16[q+1]=E,this.int16[q+2]=I,this.int16[q+3]=D,this.int16[q+4]=N,this.int16[q+5]=H,A},u}(jr);Wo.prototype.bytesPerElement=12,nr("StructArrayLayout2i2i2i12",Wo);var xo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,D){var N=this.length;return this.resize(N+1),this.emplace(N,A,x,E,I,D)},u.prototype.emplace=function(A,x,E,I,D,N){var H=4*A,q=8*A;return this.float32[H+0]=x,this.float32[H+1]=E,this.float32[H+2]=I,this.int16[q+6]=D,this.int16[q+7]=N,A},u}(jr);xo.prototype.bytesPerElement=16,nr("StructArrayLayout2f1f2i16",xo);var Xo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I){var D=this.length;return this.resize(D+1),this.emplace(D,A,x,E,I)},u.prototype.emplace=function(A,x,E,I,D){var N=12*A,H=3*A;return this.uint8[N+0]=x,this.uint8[N+1]=E,this.float32[H+1]=I,this.float32[H+2]=D,A},u}(jr);Xo.prototype.bytesPerElement=12,nr("StructArrayLayout2ub2f12",Xo);var $o=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,E)},u.prototype.emplace=function(A,x,E,I){var D=3*A;return this.uint16[D+0]=x,this.uint16[D+1]=E,this.uint16[D+2]=I,A},u}(jr);$o.prototype.bytesPerElement=6,nr("StructArrayLayout3ui6",$o);var fs=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,D,N,H,q,ee,se,he,ye,ke,Ue,je,Ve,qe){var at=this.length;return this.resize(at+1),this.emplace(at,A,x,E,I,D,N,H,q,ee,se,he,ye,ke,Ue,je,Ve,qe)},u.prototype.emplace=function(A,x,E,I,D,N,H,q,ee,se,he,ye,ke,Ue,je,Ve,qe,at){var pt=24*A,_t=12*A,Pt=48*A;return this.int16[pt+0]=x,this.int16[pt+1]=E,this.uint16[pt+2]=I,this.uint16[pt+3]=D,this.uint32[_t+2]=N,this.uint32[_t+3]=H,this.uint32[_t+4]=q,this.uint16[pt+10]=ee,this.uint16[pt+11]=se,this.uint16[pt+12]=he,this.float32[_t+7]=ye,this.float32[_t+8]=ke,this.uint8[Pt+36]=Ue,this.uint8[Pt+37]=je,this.uint8[Pt+38]=Ve,this.uint32[_t+10]=qe,this.int16[pt+22]=at,A},u}(jr);fs.prototype.bytesPerElement=48,nr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",fs);var y=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,D,N,H,q,ee,se,he,ye,ke,Ue,je,Ve,qe,at,pt,_t,Pt,Gt,Xt,mr,er,br,tr,Yr){var Mr=this.length;return this.resize(Mr+1),this.emplace(Mr,A,x,E,I,D,N,H,q,ee,se,he,ye,ke,Ue,je,Ve,qe,at,pt,_t,Pt,Gt,Xt,mr,er,br,tr,Yr)},u.prototype.emplace=function(A,x,E,I,D,N,H,q,ee,se,he,ye,ke,Ue,je,Ve,qe,at,pt,_t,Pt,Gt,Xt,mr,er,br,tr,Yr,Mr){var ur=34*A,sn=17*A;return this.int16[ur+0]=x,this.int16[ur+1]=E,this.int16[ur+2]=I,this.int16[ur+3]=D,this.int16[ur+4]=N,this.int16[ur+5]=H,this.int16[ur+6]=q,this.int16[ur+7]=ee,this.uint16[ur+8]=se,this.uint16[ur+9]=he,this.uint16[ur+10]=ye,this.uint16[ur+11]=ke,this.uint16[ur+12]=Ue,this.uint16[ur+13]=je,this.uint16[ur+14]=Ve,this.uint16[ur+15]=qe,this.uint16[ur+16]=at,this.uint16[ur+17]=pt,this.uint16[ur+18]=_t,this.uint16[ur+19]=Pt,this.uint16[ur+20]=Gt,this.uint16[ur+21]=Xt,this.uint16[ur+22]=mr,this.uint32[sn+12]=er,this.float32[sn+13]=br,this.float32[sn+14]=tr,this.float32[sn+15]=Yr,this.float32[sn+16]=Mr,A},u}(jr);y.prototype.bytesPerElement=68,nr("StructArrayLayout8i15ui1ul4f68",y);var _=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A){var x=this.length;return this.resize(x+1),this.emplace(x,A)},u.prototype.emplace=function(A,x){return this.float32[1*A+0]=x,A},u}(jr);_.prototype.bytesPerElement=4,nr("StructArrayLayout1f4",_);var v=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,E)},u.prototype.emplace=function(A,x,E,I){var D=3*A;return this.int16[D+0]=x,this.int16[D+1]=E,this.int16[D+2]=I,A},u}(jr);v.prototype.bytesPerElement=6,nr("StructArrayLayout3i6",v);var w=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,E)},u.prototype.emplace=function(A,x,E,I){var D=4*A;return this.uint32[2*A+0]=x,this.uint16[D+2]=E,this.uint16[D+3]=I,A},u}(jr);w.prototype.bytesPerElement=8,nr("StructArrayLayout1ul2ui8",w);var B=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x){var E=this.length;return this.resize(E+1),this.emplace(E,A,x)},u.prototype.emplace=function(A,x,E){var I=2*A;return this.uint16[I+0]=x,this.uint16[I+1]=E,A},u}(jr);B.prototype.bytesPerElement=4,nr("StructArrayLayout2ui4",B);var M=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A){var x=this.length;return this.resize(x+1),this.emplace(x,A)},u.prototype.emplace=function(A,x){return this.uint16[1*A+0]=x,A},u}(jr);M.prototype.bytesPerElement=2,nr("StructArrayLayout1ui2",M);var O=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I){var D=this.length;return this.resize(D+1),this.emplace(D,A,x,E,I)},u.prototype.emplace=function(A,x,E,I,D){var N=4*A;return this.float32[N+0]=x,this.float32[N+1]=E,this.float32[N+2]=I,this.float32[N+3]=D,A},u}(jr);O.prototype.bytesPerElement=16,nr("StructArrayLayout4f16",O);var l=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var A={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return A.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},A.x1.get=function(){return this._structArray.int16[this._pos2+2]},A.y1.get=function(){return this._structArray.int16[this._pos2+3]},A.x2.get=function(){return this._structArray.int16[this._pos2+4]},A.y2.get=function(){return this._structArray.int16[this._pos2+5]},A.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},A.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},A.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},A.anchorPoint.get=function(){return new b(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,A),u}(cn);l.prototype.size=20;var d=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(A){return new l(this,A)},u}(gl);nr("CollisionBoxArray",d);var h=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var A={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return A.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},A.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},A.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},A.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},A.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},A.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},A.segment.get=function(){return this._structArray.uint16[this._pos2+10]},A.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},A.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},A.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},A.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},A.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},A.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},A.placedOrientation.set=function(x){this._structArray.uint8[this._pos1+37]=x},A.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},A.hidden.set=function(x){this._structArray.uint8[this._pos1+38]=x},A.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},A.crossTileID.set=function(x){this._structArray.uint32[this._pos4+10]=x},A.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,A),u}(cn);h.prototype.size=48;var m=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(A){return new h(this,A)},u}(fs);nr("PlacedSymbolArray",m);var C=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var A={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return A.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},A.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},A.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},A.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},A.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},A.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},A.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},A.key.get=function(){return this._structArray.uint16[this._pos2+8]},A.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},A.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},A.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},A.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},A.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},A.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},A.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},A.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},A.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},A.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},A.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},A.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},A.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},A.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},A.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},A.crossTileID.set=function(x){this._structArray.uint32[this._pos4+12]=x},A.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},A.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},A.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},A.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,A),u}(cn);C.prototype.size=68;var P=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(A){return new C(this,A)},u}(y);nr("SymbolInstanceArray",P);var R=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getoffsetX=function(A){return this.float32[1*A+0]},u}(_);nr("GlyphOffsetArray",R);var L=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getx=function(A){return this.int16[3*A+0]},u.prototype.gety=function(A){return this.int16[3*A+1]},u.prototype.gettileUnitDistanceFromAnchor=function(A){return this.int16[3*A+2]},u}(v);nr("SymbolLineVertexArray",L);var G=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var A={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return A.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},A.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},A.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,A),u}(cn);G.prototype.size=8;var $=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(A){return new G(this,A)},u}(w);nr("FeatureIndexArray",$);var te=Mi([{name:"a_pos",components:2,type:"Int16"}],4).members,Y=function(a){a===void 0&&(a=[]),this.segments=a};function re(a,u){return 256*(a=j(Math.floor(a),0,255))+j(Math.floor(u),0,255)}Y.prototype.prepareSegment=function(a,u,A,x){var E=this.segments[this.segments.length-1];return a>Y.MAX_VERTEX_ARRAY_LENGTH&&ne("Max vertices per segment is "+Y.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!E||E.vertexLength+a>Y.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==x)&&(E={vertexOffset:u.length,primitiveOffset:A.length,vertexLength:0,primitiveLength:0},x!==void 0&&(E.sortKey=x),this.segments.push(E)),E},Y.prototype.get=function(){return this.segments},Y.prototype.destroy=function(){for(var a=0,u=this.segments;a<u.length;a+=1){var A=u[a];for(var x in A.vaos)A.vaos[x].destroy()}},Y.simpleSegment=function(a,u,A,x){return new Y([{vertexOffset:a,primitiveOffset:u,vertexLength:A,primitiveLength:x,vaos:{},sortKey:0}])},Y.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,nr("SegmentVector",Y);var ae=Mi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),we=c(function(a){a.exports=function(u,A){var x,E,I,D,N,H,q,ee;for(E=u.length-(x=3&u.length),I=A,N=3432918353,H=461845907,ee=0;ee<E;)q=255&u.charCodeAt(ee)|(255&u.charCodeAt(++ee))<<8|(255&u.charCodeAt(++ee))<<16|(255&u.charCodeAt(++ee))<<24,++ee,I=27492+(65535&(D=5*(65535&(I=(I^=q=(65535&(q=(q=(65535&q)*N+(((q>>>16)*N&65535)<<16)&4294967295)<<15|q>>>17))*H+(((q>>>16)*H&65535)<<16)&4294967295)<<13|I>>>19))+((5*(I>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch(q=0,x){case 3:q^=(255&u.charCodeAt(ee+2))<<16;case 2:q^=(255&u.charCodeAt(ee+1))<<8;case 1:I^=q=(65535&(q=(q=(65535&(q^=255&u.charCodeAt(ee)))*N+(((q>>>16)*N&65535)<<16)&4294967295)<<15|q>>>17))*H+(((q>>>16)*H&65535)<<16)&4294967295}return I^=u.length,I=2246822507*(65535&(I^=I>>>16))+((2246822507*(I>>>16)&65535)<<16)&4294967295,I=3266489909*(65535&(I^=I>>>13))+((3266489909*(I>>>16)&65535)<<16)&4294967295,(I^=I>>>16)>>>0}}),De=c(function(a){a.exports=function(u,A){for(var x,E=u.length,I=A^E,D=0;E>=4;)x=1540483477*(65535&(x=255&u.charCodeAt(D)|(255&u.charCodeAt(++D))<<8|(255&u.charCodeAt(++D))<<16|(255&u.charCodeAt(++D))<<24))+((1540483477*(x>>>16)&65535)<<16),I=1540483477*(65535&I)+((1540483477*(I>>>16)&65535)<<16)^(x=1540483477*(65535&(x^=x>>>24))+((1540483477*(x>>>16)&65535)<<16)),E-=4,++D;switch(E){case 3:I^=(255&u.charCodeAt(D+2))<<16;case 2:I^=(255&u.charCodeAt(D+1))<<8;case 1:I=1540483477*(65535&(I^=255&u.charCodeAt(D)))+((1540483477*(I>>>16)&65535)<<16)}return I=1540483477*(65535&(I^=I>>>13))+((1540483477*(I>>>16)&65535)<<16),(I^=I>>>15)>>>0}}),me=we,Fe=De;me.murmur3=we,me.murmur2=Fe;var He=function(){this.ids=[],this.positions=[],this.indexed=!1};He.prototype.add=function(a,u,A,x){this.ids.push(it(a)),this.positions.push(u,A,x)},He.prototype.getPositions=function(a){for(var u=it(a),A=0,x=this.ids.length-1;A<x;){var E=A+x>>1;this.ids[E]>=u?x=E:A=E+1}for(var I=[];this.ids[A]===u;)I.push({index:this.positions[3*A],start:this.positions[3*A+1],end:this.positions[3*A+2]}),A++;return I},He.serialize=function(a,u){var A=new Float64Array(a.ids),x=new Uint32Array(a.positions);return function E(I,D,N,H){for(;N<H;){for(var q=I[N+H>>1],ee=N-1,se=H+1;;){do ee++;while(I[ee]<q);do se--;while(I[se]>q);if(ee>=se)break;$e(I,ee,se),$e(D,3*ee,3*se),$e(D,3*ee+1,3*se+1),$e(D,3*ee+2,3*se+2)}se-N<H-se?(E(I,D,N,se),N=se+1):(E(I,D,se+1,H),H=se)}}(A,x,0,A.length-1),u&&u.push(A.buffer,x.buffer),{ids:A,positions:x}},He.deserialize=function(a){var u=new He;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u};var We=Math.pow(2,53)-1;function it(a){var u=+a;return!isNaN(u)&&u<=We?u:me(String(a))}function $e(a,u,A){var x=a[u];a[u]=a[A],a[A]=x}nr("FeaturePositionMap",He);var et=function(a,u){this.gl=a.gl,this.location=u},ht=function(a){function u(A,x){a.call(this,A,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){this.current!==A&&(this.current=A,this.gl.uniform1i(this.location,A))},u}(et),Rt=function(a){function u(A,x){a.call(this,A,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){this.current!==A&&(this.current=A,this.gl.uniform1f(this.location,A))},u}(et),xt=function(a){function u(A,x){a.call(this,A,x),this.current=[0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]||(this.current=A,this.gl.uniform2f(this.location,A[0],A[1]))},u}(et),Nt=function(a){function u(A,x){a.call(this,A,x),this.current=[0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]||(this.current=A,this.gl.uniform3f(this.location,A[0],A[1],A[2]))},u}(et),rr=function(a){function u(A,x){a.call(this,A,x),this.current=[0,0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]&&A[3]===this.current[3]||(this.current=A,this.gl.uniform4f(this.location,A[0],A[1],A[2],A[3]))},u}(et),vr=function(a){function u(A,x){a.call(this,A,x),this.current=Kr.transparent}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){A.r===this.current.r&&A.g===this.current.g&&A.b===this.current.b&&A.a===this.current.a||(this.current=A,this.gl.uniform4f(this.location,A.r,A.g,A.b,A.a))},u}(et),Cr=new Float32Array(16),pn=function(a){function u(A,x){a.call(this,A,x),this.current=Cr}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){if(A[12]!==this.current[12]||A[0]!==this.current[0])return this.current=A,void this.gl.uniformMatrix4fv(this.location,!1,A);for(var x=1;x<16;x++)if(A[x]!==this.current[x]){this.current=A,this.gl.uniformMatrix4fv(this.location,!1,A);break}},u}(et);function ir(a){return[re(255*a.r,255*a.g),re(255*a.b,255*a.a)]}var zr=function(a,u,A){this.value=a,this.uniformNames=u.map(function(x){return"u_"+x}),this.type=A};zr.prototype.setUniform=function(a,u,A){a.set(A.constantOr(this.value))},zr.prototype.getBinding=function(a,u,A){return this.type==="color"?new vr(a,u):new Rt(a,u)};var qr=function(a,u){this.uniformNames=u.map(function(A){return"u_"+A}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};qr.prototype.setConstantPatternPositions=function(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr},qr.prototype.setUniform=function(a,u,A,x){var E=x==="u_pattern_to"?this.patternTo:x==="u_pattern_from"?this.patternFrom:x==="u_pixel_ratio_to"?this.pixelRatioTo:x==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&a.set(E)},qr.prototype.getBinding=function(a,u,A){return A.substr(0,9)==="u_pattern"?new rr(a,u):new Rt(a,u)};var kr=function(a,u,A,x){this.expression=a,this.type=A,this.maxValue=0,this.paintVertexAttributes=u.map(function(E){return{name:"a_"+E,type:"Float32",components:A==="color"?2:1,offset:0}}),this.paintVertexArray=new x};kr.prototype.populatePaintArray=function(a,u,A,x,E){var I=this.paintVertexArray.length,D=this.expression.evaluate(new Nr(0),u,{},x,[],E);this.paintVertexArray.resize(a),this._setPaintValue(I,a,D)},kr.prototype.updatePaintArray=function(a,u,A,x){var E=this.expression.evaluate({zoom:0},A,x);this._setPaintValue(a,u,E)},kr.prototype._setPaintValue=function(a,u,A){if(this.type==="color")for(var x=ir(A),E=a;E<u;E++)this.paintVertexArray.emplace(E,x[0],x[1]);else{for(var I=a;I<u;I++)this.paintVertexArray.emplace(I,A);this.maxValue=Math.max(this.maxValue,Math.abs(A))}},kr.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},kr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Or=function(a,u,A,x,E,I){this.expression=a,this.uniformNames=u.map(function(D){return"u_"+D+"_t"}),this.type=A,this.useIntegerZoom=x,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map(function(D){return{name:"a_"+D,type:"Float32",components:A==="color"?4:2,offset:0}}),this.paintVertexArray=new I};Or.prototype.populatePaintArray=function(a,u,A,x,E){var I=this.expression.evaluate(new Nr(this.zoom),u,{},x,[],E),D=this.expression.evaluate(new Nr(this.zoom+1),u,{},x,[],E),N=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(N,a,I,D)},Or.prototype.updatePaintArray=function(a,u,A,x){var E=this.expression.evaluate({zoom:this.zoom},A,x),I=this.expression.evaluate({zoom:this.zoom+1},A,x);this._setPaintValue(a,u,E,I)},Or.prototype._setPaintValue=function(a,u,A,x){if(this.type==="color")for(var E=ir(A),I=ir(x),D=a;D<u;D++)this.paintVertexArray.emplace(D,E[0],E[1],I[0],I[1]);else{for(var N=a;N<u;N++)this.paintVertexArray.emplace(N,A,x);this.maxValue=Math.max(this.maxValue,Math.abs(A),Math.abs(x))}},Or.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Or.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Or.prototype.setUniform=function(a,u){var A=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,x=j(this.expression.interpolationFactor(A,this.zoom,this.zoom+1),0,1);a.set(x)},Or.prototype.getBinding=function(a,u,A){return new Rt(a,u)};var Xr=function(a,u,A,x,E,I){this.expression=a,this.type=u,this.useIntegerZoom=A,this.zoom=x,this.layerId=I,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E};Xr.prototype.populatePaintArray=function(a,u,A){var x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(x,a,u.patterns&&u.patterns[this.layerId],A)},Xr.prototype.updatePaintArray=function(a,u,A,x,E){this._setPaintValues(a,u,A.patterns&&A.patterns[this.layerId],E)},Xr.prototype._setPaintValues=function(a,u,A,x){if(x&&A){var E=x[A.min],I=x[A.mid],D=x[A.max];if(E&&I&&D)for(var N=a;N<u;N++)this.zoomInPaintVertexArray.emplace(N,I.tl[0],I.tl[1],I.br[0],I.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],I.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(N,I.tl[0],I.tl[1],I.br[0],I.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],I.pixelRatio,D.pixelRatio)}},Xr.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,ae.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,ae.members,this.expression.isStateDependent))},Xr.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Pr=function(a,u,A){this.binders={},this._buffers=[];var x=[];for(var E in a.paint._values)if(A(E)){var I=a.paint.get(E);if(I instanceof Zi&&Go(I.property.specification)){var D=Vi(E,a.type),N=I.value,H=I.property.specification.type,q=I.property.useIntegerZoom,ee=I.property.specification["property-type"],se=ee==="cross-faded"||ee==="cross-faded-data-driven";if(N.kind==="constant")this.binders[E]=se?new qr(N.value,D):new zr(N.value,D,H),x.push("/u_"+E);else if(N.kind==="source"||se){var he=vi(E,H,"source");this.binders[E]=se?new Xr(N,H,q,u,he,a.id):new kr(N,D,H,he),x.push("/a_"+E)}else{var ye=vi(E,H,"composite");this.binders[E]=new Or(N,D,H,q,u,ye),x.push("/z_"+E)}}}this.cacheKey=x.sort().join("")};Pr.prototype.getMaxValue=function(a){var u=this.binders[a];return u instanceof kr||u instanceof Or?u.maxValue:0},Pr.prototype.populatePaintArrays=function(a,u,A,x,E){for(var I in this.binders){var D=this.binders[I];(D instanceof kr||D instanceof Or||D instanceof Xr)&&D.populatePaintArray(a,u,A,x,E)}},Pr.prototype.setConstantPatternPositions=function(a,u){for(var A in this.binders){var x=this.binders[A];x instanceof qr&&x.setConstantPatternPositions(a,u)}},Pr.prototype.updatePaintArrays=function(a,u,A,x,E){var I=!1;for(var D in a)for(var N=0,H=u.getPositions(D);N<H.length;N+=1){var q=H[N],ee=A.feature(q.index);for(var se in this.binders){var he=this.binders[se];if((he instanceof kr||he instanceof Or||he instanceof Xr)&&he.expression.isStateDependent===!0){var ye=x.paint.get(se);he.expression=ye.value,he.updatePaintArray(q.start,q.end,ee,a[D],E),I=!0}}}return I},Pr.prototype.defines=function(){var a=[];for(var u in this.binders){var A=this.binders[u];(A instanceof zr||A instanceof qr)&&a.push.apply(a,A.uniformNames.map(function(x){return"#define HAS_UNIFORM_"+x}))}return a},Pr.prototype.getBinderAttributes=function(){var a=[];for(var u in this.binders){var A=this.binders[u];if(A instanceof kr||A instanceof Or)for(var x=0;x<A.paintVertexAttributes.length;x++)a.push(A.paintVertexAttributes[x].name);else if(A instanceof Xr)for(var E=0;E<ae.members.length;E++)a.push(ae.members[E].name)}return a},Pr.prototype.getBinderUniforms=function(){var a=[];for(var u in this.binders){var A=this.binders[u];if(A instanceof zr||A instanceof qr||A instanceof Or)for(var x=0,E=A.uniformNames;x<E.length;x+=1)a.push(E[x])}return a},Pr.prototype.getPaintVertexBuffers=function(){return this._buffers},Pr.prototype.getUniforms=function(a,u){var A=[];for(var x in this.binders){var E=this.binders[x];if(E instanceof zr||E instanceof qr||E instanceof Or)for(var I=0,D=E.uniformNames;I<D.length;I+=1){var N=D[I];if(u[N]){var H=E.getBinding(a,u[N],N);A.push({name:N,property:x,binding:H})}}}return A},Pr.prototype.setUniforms=function(a,u,A,x){for(var E=0,I=u;E<I.length;E+=1){var D=I[E],N=D.name,H=D.property;this.binders[H].setUniform(D.binding,x,A.get(H),N)}},Pr.prototype.updatePaintBuffers=function(a){for(var u in this._buffers=[],this.binders){var A=this.binders[u];if(a&&A instanceof Xr){var x=a.fromScale===2?A.zoomInPaintVertexBuffer:A.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(A instanceof kr||A instanceof Or)&&A.paintVertexBuffer&&this._buffers.push(A.paintVertexBuffer)}},Pr.prototype.upload=function(a){for(var u in this.binders){var A=this.binders[u];(A instanceof kr||A instanceof Or||A instanceof Xr)&&A.upload(a)}this.updatePaintBuffers()},Pr.prototype.destroy=function(){for(var a in this.binders){var u=this.binders[a];(u instanceof kr||u instanceof Or||u instanceof Xr)&&u.destroy()}};var Ir=function(a,u,A){A===void 0&&(A=function(){return!0}),this.programConfigurations={};for(var x=0,E=a;x<E.length;x+=1){var I=E[x];this.programConfigurations[I.id]=new Pr(I,u,A)}this.needsUpload=!1,this._featureMap=new He,this._bufferOffset=0};function Vi(a,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(u+"-","").replace(/-/g,"_")]}function vi(a,u,A){var x={color:{source:ho,composite:O},number:{source:_,composite:ho}},E=function(I){return{"line-pattern":{source:Ao,composite:Ao},"fill-pattern":{source:Ao,composite:Ao},"fill-extrusion-pattern":{source:Ao,composite:Ao}}[I]}(a);return E&&E[A]||x[u][A]}Ir.prototype.populatePaintArrays=function(a,u,A,x,E,I){for(var D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(a,u,x,E,I);u.id!==void 0&&this._featureMap.add(u.id,A,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Ir.prototype.updatePaintArrays=function(a,u,A,x){for(var E=0,I=A;E<I.length;E+=1){var D=I[E];this.needsUpload=this.programConfigurations[D.id].updatePaintArrays(a,this._featureMap,u,D,x)||this.needsUpload}},Ir.prototype.get=function(a){return this.programConfigurations[a]},Ir.prototype.upload=function(a){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}},Ir.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},nr("ConstantBinder",zr),nr("CrossFadedConstantBinder",qr),nr("SourceExpressionBinder",kr),nr("CrossFadedCompositeBinder",Xr),nr("CompositeExpressionBinder",Or),nr("ProgramConfiguration",Pr,{omit:["_buffers"]}),nr("ProgramConfigurationSet",Ir);var hs=Math.pow(2,14)-1,Qi=-hs-1;function Ai(a){for(var u=8192/a.extent,A=a.loadGeometry(),x=0;x<A.length;x++)for(var E=A[x],I=0;I<E.length;I++){var D=E[I],N=Math.round(D.x*u),H=Math.round(D.y*u);D.x=j(N,Qi,hs),D.y=j(H,Qi,hs),(N<D.x||N>D.x+1||H<D.y||H>D.y+1)&&ne("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return A}function Ci(a,u){return{type:a.type,id:a.id,properties:a.properties,geometry:u?Ai(a):[]}}function qs(a,u,A,x,E){a.emplaceBack(2*u+(x+1)/2,2*A+(E+1)/2)}var vs=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Ds,this.indexArray=new $o,this.segments=new Y,this.programConfigurations=new Ir(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Bc(a,u){for(var A=0;A<a.length;A++)if(ga(u,a[A]))return!0;for(var x=0;x<u.length;x++)if(ga(a,u[x]))return!0;return!!gf(a,u)}function Os(a,u,A){return!!ga(a,u)||!!Sc(u,a,A)}function Ko(a,u){if(a.length===1)return mf(u,a[0]);for(var A=0;A<u.length;A++)for(var x=u[A],E=0;E<x.length;E++)if(ga(a,x[E]))return!0;for(var I=0;I<a.length;I++)if(mf(u,a[I]))return!0;for(var D=0;D<u.length;D++)if(gf(a,u[D]))return!0;return!1}function wo(a,u,A){if(a.length>1){if(gf(a,u))return!0;for(var x=0;x<u.length;x++)if(Sc(u[x],a,A))return!0}for(var E=0;E<a.length;E++)if(Sc(a[E],u,A))return!0;return!1}function gf(a,u){if(a.length===0||u.length===0)return!1;for(var A=0;A<a.length-1;A++)for(var x=a[A],E=a[A+1],I=0;I<u.length-1;I++)if(du(x,E,u[I],u[I+1]))return!0;return!1}function du(a,u,A,x){return Be(a,A,x)!==Be(u,A,x)&&Be(a,u,A)!==Be(a,u,x)}function Sc(a,u,A){var x=A*A;if(u.length===1)return a.distSqr(u[0])<x;for(var E=1;E<u.length;E++)if(Au(a,u[E-1],u[E])<x)return!0;return!1}function Au(a,u,A){var x=u.distSqr(A);if(x===0)return a.distSqr(u);var E=((a.x-u.x)*(A.x-u.x)+(a.y-u.y)*(A.y-u.y))/x;return a.distSqr(E<0?u:E>1?A:A.sub(u)._mult(E)._add(u))}function mf(a,u){for(var A,x,E,I=!1,D=0;D<a.length;D++)for(var N=0,H=(A=a[D]).length-1;N<A.length;H=N++)(x=A[N]).y>u.y!=(E=A[H]).y>u.y&&u.x<(E.x-x.x)*(u.y-x.y)/(E.y-x.y)+x.x&&(I=!I);return I}function ga(a,u){for(var A=!1,x=0,E=a.length-1;x<a.length;E=x++){var I=a[x],D=a[E];I.y>u.y!=D.y>u.y&&u.x<(D.x-I.x)*(u.y-I.y)/(D.y-I.y)+I.x&&(A=!A)}return A}function _f(a,u,A){var x=A[0],E=A[2];if(a.x<x.x&&u.x<x.x||a.x>E.x&&u.x>E.x||a.y<x.y&&u.y<x.y||a.y>E.y&&u.y>E.y)return!1;var I=Be(a,u,A[0]);return I!==Be(a,u,A[1])||I!==Be(a,u,A[2])||I!==Be(a,u,A[3])}function ma(a,u,A){var x=u.paint.get(a).value;return x.kind==="constant"?x.value:A.programConfigurations.get(u.id).getMaxValue(a)}function Hi(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Ha(a,u,A,x,E){if(!u[0]&&!u[1])return a;var I=b.convert(u)._mult(E);A==="viewport"&&I._rotate(-x);for(var D=[],N=0;N<a.length;N++)D.push(a[N].sub(I));return D}vs.prototype.populate=function(a,u,A){var x=this.layers[0],E=[],I=null;x.type==="circle"&&(I=x.layout.get("circle-sort-key"));for(var D=0,N=a;D<N.length;D+=1){var H=N[D],q=H.feature,ee=H.id,se=H.index,he=H.sourceLayerIndex,ye=this.layers[0]._featureFilter.needGeometry,ke=Ci(q,ye);if(this.layers[0]._featureFilter.filter(new Nr(this.zoom),ke,A)){var Ue=I?I.evaluate(ke,{},A):void 0,je={id:ee,properties:q.properties,type:q.type,sourceLayerIndex:he,index:se,geometry:ye?ke.geometry:Ai(q),patterns:{},sortKey:Ue};E.push(je)}}I&&E.sort(function(Xt,mr){return Xt.sortKey-mr.sortKey});for(var Ve=0,qe=E;Ve<qe.length;Ve+=1){var at=qe[Ve],pt=at.geometry,_t=at.index,Pt=at.sourceLayerIndex,Gt=a[_t].feature;this.addFeature(at,pt,_t,A),u.featureIndex.insert(Gt,pt,_t,Pt,this.index)}},vs.prototype.update=function(a,u,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,A)},vs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},vs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},vs.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,te),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},vs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},vs.prototype.addFeature=function(a,u,A,x){for(var E=0,I=u;E<I.length;E+=1)for(var D=0,N=I[E];D<N.length;D+=1){var H=N[D],q=H.x,ee=H.y;if(!(q<0||q>=8192||ee<0||ee>=8192)){var se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),he=se.vertexLength;qs(this.layoutVertexArray,q,ee,-1,-1),qs(this.layoutVertexArray,q,ee,1,-1),qs(this.layoutVertexArray,q,ee,1,1),qs(this.layoutVertexArray,q,ee,-1,1),this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+3,he+2),se.vertexLength+=4,se.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,{},x)},nr("CircleBucket",vs,{omit:["layers"]});var Ic=new Gn({"circle-sort-key":new or(ce.layout_circle["circle-sort-key"])}),ml={paint:new Gn({"circle-radius":new or(ce.paint_circle["circle-radius"]),"circle-color":new or(ce.paint_circle["circle-color"]),"circle-blur":new or(ce.paint_circle["circle-blur"]),"circle-opacity":new or(ce.paint_circle["circle-opacity"]),"circle-translate":new _r(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new _r(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _r(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _r(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new or(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new or(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new or(ce.paint_circle["circle-stroke-opacity"])}),layout:Ic},yn=typeof Float32Array<"u"?Float32Array:Array;function po(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Ls(a,u,A){var x=u[0],E=u[1],I=u[2],D=u[3],N=u[4],H=u[5],q=u[6],ee=u[7],se=u[8],he=u[9],ye=u[10],ke=u[11],Ue=u[12],je=u[13],Ve=u[14],qe=u[15],at=A[0],pt=A[1],_t=A[2],Pt=A[3];return a[0]=at*x+pt*N+_t*se+Pt*Ue,a[1]=at*E+pt*H+_t*he+Pt*je,a[2]=at*I+pt*q+_t*ye+Pt*Ve,a[3]=at*D+pt*ee+_t*ke+Pt*qe,a[4]=(at=A[4])*x+(pt=A[5])*N+(_t=A[6])*se+(Pt=A[7])*Ue,a[5]=at*E+pt*H+_t*he+Pt*je,a[6]=at*I+pt*q+_t*ye+Pt*Ve,a[7]=at*D+pt*ee+_t*ke+Pt*qe,a[8]=(at=A[8])*x+(pt=A[9])*N+(_t=A[10])*se+(Pt=A[11])*Ue,a[9]=at*E+pt*H+_t*he+Pt*je,a[10]=at*I+pt*q+_t*ye+Pt*Ve,a[11]=at*D+pt*ee+_t*ke+Pt*qe,a[12]=(at=A[12])*x+(pt=A[13])*N+(_t=A[14])*se+(Pt=A[15])*Ue,a[13]=at*E+pt*H+_t*he+Pt*je,a[14]=at*I+pt*q+_t*ye+Pt*Ve,a[15]=at*D+pt*ee+_t*ke+Pt*qe,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,u=0,A=arguments.length;A--;)u+=a[A]*a[A];return Math.sqrt(u)});var _l,Ny=Ls;function Eh(a,u,A){var x=u[0],E=u[1],I=u[2],D=u[3];return a[0]=A[0]*x+A[4]*E+A[8]*I+A[12]*D,a[1]=A[1]*x+A[5]*E+A[9]*I+A[13]*D,a[2]=A[2]*x+A[6]*E+A[10]*I+A[14]*D,a[3]=A[3]*x+A[7]*E+A[11]*I+A[15]*D,a}_l=new yn(3),yn!=Float32Array&&(_l[0]=0,_l[1]=0,_l[2]=0),function(){var a=new yn(4);yn!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var ky=(function(){var a=new yn(2);yn!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function u(A){a.call(this,A,ml)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(A){return new vs(A)},u.prototype.queryRadius=function(A){var x=A;return ma("circle-radius",this,x)+ma("circle-stroke-width",this,x)+Hi(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(A,x,E,I,D,N,H,q){for(var ee=Ha(A,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,H),se=this.paint.get("circle-radius").evaluate(x,E)+this.paint.get("circle-stroke-width").evaluate(x,E),he=this.paint.get("circle-pitch-alignment")==="map",ye=he?ee:function(Gt,Xt){return Gt.map(function(mr){return yf(mr,Xt)})}(ee,q),ke=he?se*H:se,Ue=0,je=I;Ue<je.length;Ue+=1)for(var Ve=0,qe=je[Ue];Ve<qe.length;Ve+=1){var at=qe[Ve],pt=he?at:yf(at,q),_t=ke,Pt=Eh([],[at.x,at.y,0,1],q);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?_t*=Pt[3]/N.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(_t*=N.cameraToCenterDistance/Pt[3]),Os(ye,pt,_t))return!0}return!1},u}(Dr));function yf(a,u){var A=Eh([],[a.x,a.y,0,1],u);return new b(A[0]/A[3],A[1]/A[3])}var Dg=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(vs);function pu(a,u,A,x){var E=u.width,I=u.height;if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==E*I*A)throw new RangeError("mismatched image size")}else x=new Uint8Array(E*I*A);return a.width=E,a.height=I,a.data=x,a}function Th(a,u,A){var x=u.width,E=u.height;if(x!==a.width||E!==a.height){var I=pu({},{width:x,height:E},A);Uy(a,I,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,x),height:Math.min(a.height,E)},A),a.width=x,a.height=E,a.data=I.data}}function Uy(a,u,A,x,E,I){if(E.width===0||E.height===0)return u;if(E.width>a.width||E.height>a.height||A.x>a.width-E.width||A.y>a.height-E.height)throw new RangeError("out of range source coordinates for image copy");if(E.width>u.width||E.height>u.height||x.x>u.width-E.width||x.y>u.height-E.height)throw new RangeError("out of range destination coordinates for image copy");for(var D=a.data,N=u.data,H=0;H<E.height;H++)for(var q=((A.y+H)*a.width+A.x)*I,ee=((x.y+H)*u.width+x.x)*I,se=0;se<E.width*I;se++)N[ee+se]=D[q+se];return u}nr("HeatmapBucket",Dg,{omit:["layers"]});var vf=function(a,u){pu(this,a,1,u)};vf.prototype.resize=function(a){Th(this,a,1)},vf.prototype.clone=function(){return new vf({width:this.width,height:this.height},new Uint8Array(this.data))},vf.copy=function(a,u,A,x,E){Uy(a,u,A,x,E,1)};var Zs=function(a,u){pu(this,a,4,u)};Zs.prototype.resize=function(a){Th(this,a,4)},Zs.prototype.replace=function(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Zs.prototype.clone=function(){return new Zs({width:this.width,height:this.height},new Uint8Array(this.data))},Zs.copy=function(a,u,A,x,E){Uy(a,u,A,x,E,4)},nr("AlphaImage",vf),nr("RGBAImage",Zs);var E8={paint:new Gn({"heatmap-radius":new or(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new or(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _r(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gi(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _r(ce.paint_heatmap["heatmap-opacity"])})};function $C(a){var u={},A=a.resolution||256,x=a.clips?a.clips.length:1,E=a.image||new Zs({width:A,height:x}),I=function(ke,Ue,je){u[a.evaluationKey]=je;var Ve=a.expression.evaluate(u);E.data[ke+Ue+0]=Math.floor(255*Ve.r/Ve.a),E.data[ke+Ue+1]=Math.floor(255*Ve.g/Ve.a),E.data[ke+Ue+2]=Math.floor(255*Ve.b/Ve.a),E.data[ke+Ue+3]=Math.floor(255*Ve.a)};if(a.clips)for(var D=0,N=0;D<x;++D,N+=4*A)for(var H=0,q=0;H<A;H++,q+=4){var ee=H/(A-1),se=a.clips[D];I(N,q,se.start*(1-ee)+se.end*ee)}else for(var he=0,ye=0;he<A;he++,ye+=4)I(0,ye,he/(A-1));return E}var T8=function(a){function u(A){a.call(this,A,E8),this._updateColorRamp()}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(A){return new Dg(A)},u.prototype._handleSpecialPaintPropertyUpdate=function(A){A==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=$C({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(Dr),B8={paint:new Gn({"hillshade-illumination-direction":new _r(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _r(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _r(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _r(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _r(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _r(ce.paint_hillshade["hillshade-accent-color"])})},S8=function(a){function u(A){a.call(this,A,B8)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(Dr),I8=Mi([{name:"a_pos",components:2,type:"Int16"}],4).members,zy=Og,M8=Og;function Og(a,u,A){A=A||2;var x,E,I,D,N,H,q,ee=u&&u.length,se=ee?u[0]*A:a.length,he=KC(a,0,se,A,!0),ye=[];if(!he||he.next===he.prev)return ye;if(ee&&(he=function(Ue,je,Ve,qe){var at,pt,_t,Pt=[];for(at=0,pt=je.length;at<pt;at++)(_t=KC(Ue,je[at]*qe,at<pt-1?je[at+1]*qe:Ue.length,qe,!1))===_t.next&&(_t.steiner=!0),Pt.push(k8(_t));for(Pt.sort(O8),at=0;at<Pt.length;at++)L8(Pt[at],Ve),Ve=gu(Ve,Ve.next);return Ve}(a,u,he,A)),a.length>80*A){x=I=a[0],E=D=a[1];for(var ke=A;ke<se;ke+=A)(N=a[ke])<x&&(x=N),(H=a[ke+1])<E&&(E=H),N>I&&(I=N),H>D&&(D=H);q=(q=Math.max(I-x,D-E))!==0?1/q:0}return LA(he,ye,A,x,E,q),ye}function KC(a,u,A,x,E){var I,D;if(E===Hy(a,u,A,x)>0)for(I=u;I<A;I+=x)D=YC(I,a[I],a[I+1],D);else for(I=A-x;I>=u;I-=x)D=YC(I,a[I],a[I+1],D);return D&&Lg(D,D.next)&&(kA(D),D=D.next),D}function gu(a,u){if(!a)return a;u||(u=a);var A,x=a;do if(A=!1,x.steiner||!Lg(x,x.next)&&Di(x.prev,x,x.next)!==0)x=x.next;else{if(kA(x),(x=u=x.prev)===x.next)break;A=!0}while(A||x!==u);return u}function LA(a,u,A,x,E,I,D){if(a){!D&&I&&function(ee,se,he,ye){var ke=ee;do ke.z===null&&(ke.z=Gy(ke.x,ke.y,se,he,ye)),ke.prevZ=ke.prev,ke.nextZ=ke.next,ke=ke.next;while(ke!==ee);ke.prevZ.nextZ=null,ke.prevZ=null,function(Ue){var je,Ve,qe,at,pt,_t,Pt,Gt,Xt=1;do{for(Ve=Ue,Ue=null,pt=null,_t=0;Ve;){for(_t++,qe=Ve,Pt=0,je=0;je<Xt&&(Pt++,qe=qe.nextZ);je++);for(Gt=Xt;Pt>0||Gt>0&&qe;)Pt!==0&&(Gt===0||!qe||Ve.z<=qe.z)?(at=Ve,Ve=Ve.nextZ,Pt--):(at=qe,qe=qe.nextZ,Gt--),pt?pt.nextZ=at:Ue=at,at.prevZ=pt,pt=at;Ve=qe}pt.nextZ=null,Xt*=2}while(_t>1)}(ke)}(a,x,E,I);for(var N,H,q=a;a.prev!==a.next;)if(N=a.prev,H=a.next,I?R8(a,x,E,I):P8(a))u.push(N.i/A),u.push(a.i/A),u.push(H.i/A),kA(a),a=H.next,q=H.next;else if((a=H)===q){D?D===1?LA(a=F8(gu(a),u,A),u,A,x,E,I,2):D===2&&D8(a,u,A,x,E,I):LA(gu(a),u,A,x,E,I,1);break}}}function P8(a){var u=a.prev,A=a,x=a.next;if(Di(u,A,x)>=0)return!1;for(var E=a.next.next;E!==a.prev;){if(Bh(u.x,u.y,A.x,A.y,x.x,x.y,E.x,E.y)&&Di(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function R8(a,u,A,x){var E=a.prev,I=a,D=a.next;if(Di(E,I,D)>=0)return!1;for(var N=E.x>I.x?E.x>D.x?E.x:D.x:I.x>D.x?I.x:D.x,H=E.y>I.y?E.y>D.y?E.y:D.y:I.y>D.y?I.y:D.y,q=Gy(E.x<I.x?E.x<D.x?E.x:D.x:I.x<D.x?I.x:D.x,E.y<I.y?E.y<D.y?E.y:D.y:I.y<D.y?I.y:D.y,u,A,x),ee=Gy(N,H,u,A,x),se=a.prevZ,he=a.nextZ;se&&se.z>=q&&he&&he.z<=ee;){if(se!==a.prev&&se!==a.next&&Bh(E.x,E.y,I.x,I.y,D.x,D.y,se.x,se.y)&&Di(se.prev,se,se.next)>=0||(se=se.prevZ,he!==a.prev&&he!==a.next&&Bh(E.x,E.y,I.x,I.y,D.x,D.y,he.x,he.y)&&Di(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;se&&se.z>=q;){if(se!==a.prev&&se!==a.next&&Bh(E.x,E.y,I.x,I.y,D.x,D.y,se.x,se.y)&&Di(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;he&&he.z<=ee;){if(he!==a.prev&&he!==a.next&&Bh(E.x,E.y,I.x,I.y,D.x,D.y,he.x,he.y)&&Di(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function F8(a,u,A){var x=a;do{var E=x.prev,I=x.next.next;!Lg(E,I)&&qC(E,x,x.next,I)&&NA(E,I)&&NA(I,E)&&(u.push(E.i/A),u.push(x.i/A),u.push(I.i/A),kA(x),kA(x.next),x=a=I),x=x.next}while(x!==a);return gu(x)}function D8(a,u,A,x,E,I){var D=a;do{for(var N=D.next.next;N!==D.prev;){if(D.i!==N.i&&U8(D,N)){var H=ZC(D,N);return D=gu(D,D.next),H=gu(H,H.next),LA(D,u,A,x,E,I),void LA(H,u,A,x,E,I)}N=N.next}D=D.next}while(D!==a)}function O8(a,u){return a.x-u.x}function L8(a,u){if(u=function(x,E){var I,D=E,N=x.x,H=x.y,q=-1/0;do{if(H<=D.y&&H>=D.next.y&&D.next.y!==D.y){var ee=D.x+(H-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(ee<=N&&ee>q){if(q=ee,ee===N){if(H===D.y)return D;if(H===D.next.y)return D.next}I=D.x<D.next.x?D:D.next}}D=D.next}while(D!==E);if(!I)return null;if(N===q)return I;var se,he=I,ye=I.x,ke=I.y,Ue=1/0;D=I;do N>=D.x&&D.x>=ye&&N!==D.x&&Bh(H<ke?N:q,H,ye,ke,H<ke?q:N,H,D.x,D.y)&&(se=Math.abs(H-D.y)/(N-D.x),NA(D,x)&&(se<Ue||se===Ue&&(D.x>I.x||D.x===I.x&&N8(I,D)))&&(I=D,Ue=se)),D=D.next;while(D!==he);return I}(a,u)){var A=ZC(u,a);gu(u,u.next),gu(A,A.next)}}function N8(a,u){return Di(a.prev,a,u.prev)<0&&Di(u.next,a,a.next)<0}function Gy(a,u,A,x,E){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-A)*E)|a<<8))|a<<4))|a<<2))|a<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-x)*E)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function k8(a){var u=a,A=a;do(u.x<A.x||u.x===A.x&&u.y<A.y)&&(A=u),u=u.next;while(u!==a);return A}function Bh(a,u,A,x,E,I,D,N){return(E-D)*(u-N)-(a-D)*(I-N)>=0&&(a-D)*(x-N)-(A-D)*(u-N)>=0&&(A-D)*(I-N)-(E-D)*(x-N)>=0}function U8(a,u){return a.next.i!==u.i&&a.prev.i!==u.i&&!function(A,x){var E=A;do{if(E.i!==A.i&&E.next.i!==A.i&&E.i!==x.i&&E.next.i!==x.i&&qC(E,E.next,A,x))return!0;E=E.next}while(E!==A);return!1}(a,u)&&(NA(a,u)&&NA(u,a)&&function(A,x){var E=A,I=!1,D=(A.x+x.x)/2,N=(A.y+x.y)/2;do E.y>N!=E.next.y>N&&E.next.y!==E.y&&D<(E.next.x-E.x)*(N-E.y)/(E.next.y-E.y)+E.x&&(I=!I),E=E.next;while(E!==A);return I}(a,u)&&(Di(a.prev,a,u.prev)||Di(a,u.prev,u))||Lg(a,u)&&Di(a.prev,a,a.next)>0&&Di(u.prev,u,u.next)>0)}function Di(a,u,A){return(u.y-a.y)*(A.x-u.x)-(u.x-a.x)*(A.y-u.y)}function Lg(a,u){return a.x===u.x&&a.y===u.y}function qC(a,u,A,x){var E=kg(Di(a,u,A)),I=kg(Di(a,u,x)),D=kg(Di(A,x,a)),N=kg(Di(A,x,u));return E!==I&&D!==N||!(E!==0||!Ng(a,A,u))||!(I!==0||!Ng(a,x,u))||!(D!==0||!Ng(A,a,x))||!(N!==0||!Ng(A,u,x))}function Ng(a,u,A){return u.x<=Math.max(a.x,A.x)&&u.x>=Math.min(a.x,A.x)&&u.y<=Math.max(a.y,A.y)&&u.y>=Math.min(a.y,A.y)}function kg(a){return a>0?1:a<0?-1:0}function NA(a,u){return Di(a.prev,a,a.next)<0?Di(a,u,a.next)>=0&&Di(a,a.prev,u)>=0:Di(a,u,a.prev)<0||Di(a,a.next,u)<0}function ZC(a,u){var A=new Vy(a.i,a.x,a.y),x=new Vy(u.i,u.x,u.y),E=a.next,I=u.prev;return a.next=u,u.prev=a,A.next=E,E.prev=A,x.next=A,A.prev=x,I.next=x,x.prev=I,x}function YC(a,u,A,x){var E=new Vy(a,u,A);return x?(E.next=x.next,E.prev=x,x.next.prev=E,x.next=E):(E.prev=E,E.next=E),E}function kA(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Vy(a,u,A){this.i=a,this.x=u,this.y=A,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Hy(a,u,A,x){for(var E=0,I=u,D=A-x;I<A;I+=x)E+=(a[D]-a[I])*(a[I+1]+a[D+1]),D=I;return E}function z8(a,u,A,x,E){(function I(D,N,H,q,ee){for(;q>H;){if(q-H>600){var se=q-H+1,he=N-H+1,ye=Math.log(se),ke=.5*Math.exp(2*ye/3),Ue=.5*Math.sqrt(ye*ke*(se-ke)/se)*(he-se/2<0?-1:1);I(D,N,Math.max(H,Math.floor(N-he*ke/se+Ue)),Math.min(q,Math.floor(N+(se-he)*ke/se+Ue)),ee)}var je=D[N],Ve=H,qe=q;for(UA(D,H,N),ee(D[q],je)>0&&UA(D,H,q);Ve<qe;){for(UA(D,Ve,qe),Ve++,qe--;ee(D[Ve],je)<0;)Ve++;for(;ee(D[qe],je)>0;)qe--}ee(D[H],je)===0?UA(D,H,qe):UA(D,++qe,q),qe<=N&&(H=qe+1),N<=qe&&(q=qe-1)}})(a,u,A,x||a.length-1,E||G8)}function UA(a,u,A){var x=a[u];a[u]=a[A],a[A]=x}function G8(a,u){return a<u?-1:a>u?1:0}function jy(a,u){var A=a.length;if(A<=1)return[a];for(var x,E,I=[],D=0;D<A;D++){var N=Ze(a[D]);N!==0&&(a[D].area=Math.abs(N),E===void 0&&(E=N<0),E===N<0?(x&&I.push(x),x=[a[D]]):x.push(a[D]))}if(x&&I.push(x),u>1)for(var H=0;H<I.length;H++)I[H].length<=u||(z8(I[H],u,1,I[H].length-1,V8),I[H]=I[H].slice(0,u));return I}function V8(a,u){return u.area-a.area}function Jy(a,u,A){for(var x=A.patternDependencies,E=!1,I=0,D=u;I<D.length;I+=1){var N=D[I].paint.get(a+"-pattern");N.isConstant()||(E=!0);var H=N.constantOr(null);H&&(E=!0,x[H.to]=!0,x[H.from]=!0)}return E}function Wy(a,u,A,x,E){for(var I=E.patternDependencies,D=0,N=u;D<N.length;D+=1){var H=N[D],q=H.paint.get(a+"-pattern").value;if(q.kind!=="constant"){var ee=q.evaluate({zoom:x-1},A,{},E.availableImages),se=q.evaluate({zoom:x},A,{},E.availableImages),he=q.evaluate({zoom:x+1},A,{},E.availableImages);se=se&&se.name?se.name:se,he=he&&he.name?he.name:he,I[ee=ee&&ee.name?ee.name:ee]=!0,I[se]=!0,I[he]=!0,A.patterns[H.id]={min:ee,mid:se,max:he}}}return A}Og.deviation=function(a,u,A,x){var E=u&&u.length,I=Math.abs(Hy(a,0,E?u[0]*A:a.length,A));if(E)for(var D=0,N=u.length;D<N;D++)I-=Math.abs(Hy(a,u[D]*A,D<N-1?u[D+1]*A:a.length,A));var H=0;for(D=0;D<x.length;D+=3){var q=x[D]*A,ee=x[D+1]*A,se=x[D+2]*A;H+=Math.abs((a[q]-a[se])*(a[ee+1]-a[q+1])-(a[q]-a[ee])*(a[se+1]-a[q+1]))}return I===0&&H===0?0:Math.abs((H-I)/I)},Og.flatten=function(a){for(var u=a[0][0].length,A={vertices:[],holes:[],dimensions:u},x=0,E=0;E<a.length;E++){for(var I=0;I<a[E].length;I++)for(var D=0;D<u;D++)A.vertices.push(a[E][I][D]);E>0&&A.holes.push(x+=a[E-1].length)}return A},zy.default=M8;var ja=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ds,this.indexArray=new $o,this.indexArray2=new B,this.programConfigurations=new Ir(a.layers,a.zoom),this.segments=new Y,this.segments2=new Y,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};ja.prototype.populate=function(a,u,A){this.hasPattern=Jy("fill",this.layers,u);for(var x=this.layers[0].layout.get("fill-sort-key"),E=[],I=0,D=a;I<D.length;I+=1){var N=D[I],H=N.feature,q=N.id,ee=N.index,se=N.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,ye=Ci(H,he);if(this.layers[0]._featureFilter.filter(new Nr(this.zoom),ye,A)){var ke=x?x.evaluate(ye,{},A,u.availableImages):void 0,Ue={id:q,properties:H.properties,type:H.type,sourceLayerIndex:se,index:ee,geometry:he?ye.geometry:Ai(H),patterns:{},sortKey:ke};E.push(Ue)}}x&&E.sort(function(Gt,Xt){return Gt.sortKey-Xt.sortKey});for(var je=0,Ve=E;je<Ve.length;je+=1){var qe=Ve[je],at=qe.geometry,pt=qe.index,_t=qe.sourceLayerIndex;if(this.hasPattern){var Pt=Wy("fill",this.layers,qe,this.zoom,u);this.patternFeatures.push(Pt)}else this.addFeature(qe,at,pt,A,{});u.featureIndex.insert(a[pt].feature,at,pt,_t,this.index)}},ja.prototype.update=function(a,u,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,A)},ja.prototype.addFeatures=function(a,u,A){for(var x=0,E=this.patternFeatures;x<E.length;x+=1){var I=E[x];this.addFeature(I,I.geometry,I.index,u,A)}},ja.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ja.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ja.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,I8),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},ja.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ja.prototype.addFeature=function(a,u,A,x,E){for(var I=0,D=jy(u,500);I<D.length;I+=1){for(var N=D[I],H=0,q=0,ee=N;q<ee.length;q+=1)H+=ee[q].length;for(var se=this.segments.prepareSegment(H,this.layoutVertexArray,this.indexArray),he=se.vertexLength,ye=[],ke=[],Ue=0,je=N;Ue<je.length;Ue+=1){var Ve=je[Ue];if(Ve.length!==0){Ve!==N[0]&&ke.push(ye.length/2);var qe=this.segments2.prepareSegment(Ve.length,this.layoutVertexArray,this.indexArray2),at=qe.vertexLength;this.layoutVertexArray.emplaceBack(Ve[0].x,Ve[0].y),this.indexArray2.emplaceBack(at+Ve.length-1,at),ye.push(Ve[0].x),ye.push(Ve[0].y);for(var pt=1;pt<Ve.length;pt++)this.layoutVertexArray.emplaceBack(Ve[pt].x,Ve[pt].y),this.indexArray2.emplaceBack(at+pt-1,at+pt),ye.push(Ve[pt].x),ye.push(Ve[pt].y);qe.vertexLength+=Ve.length,qe.primitiveLength+=Ve.length}}for(var _t=zy(ye,ke),Pt=0;Pt<_t.length;Pt+=3)this.indexArray.emplaceBack(he+_t[Pt],he+_t[Pt+1],he+_t[Pt+2]);se.vertexLength+=H,se.primitiveLength+=_t.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,E,x)},nr("FillBucket",ja,{omit:["layers","patternFeatures"]});var H8=new Gn({"fill-sort-key":new or(ce.layout_fill["fill-sort-key"])}),j8={paint:new Gn({"fill-antialias":new _r(ce.paint_fill["fill-antialias"]),"fill-opacity":new or(ce.paint_fill["fill-opacity"]),"fill-color":new or(ce.paint_fill["fill-color"]),"fill-outline-color":new or(ce.paint_fill["fill-outline-color"]),"fill-translate":new _r(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new _r(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new fu(ce.paint_fill["fill-pattern"])}),layout:H8},J8=function(a){function u(A){a.call(this,A,j8)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(A,x){a.prototype.recalculate.call(this,A,x);var E=this.paint._values["fill-outline-color"];E.value.kind==="constant"&&E.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(A){return new ja(A)},u.prototype.queryRadius=function(){return Hi(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(A,x,E,I,D,N,H){return Ko(Ha(A,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,H),I)},u.prototype.isTileClipped=function(){return!0},u}(Dr),W8=Mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,QC=Sh;function Sh(a,u,A,x,E){this.properties={},this.extent=A,this.type=0,this._pbf=a,this._geometry=-1,this._keys=x,this._values=E,a.readFields(X8,this,u)}function X8(a,u,A){a==1?u.id=A.readVarint():a==2?function(x,E){for(var I=x.readVarint()+x.pos;x.pos<I;){var D=E._keys[x.readVarint()],N=E._values[x.readVarint()];E.properties[D]=N}}(A,u):a==3?u.type=A.readVarint():a==4&&(u._geometry=A.pos)}function $8(a){for(var u,A,x=0,E=0,I=a.length,D=I-1;E<I;D=E++)x+=((A=a[D]).x-(u=a[E]).x)*(u.y+A.y);return x}Sh.types=["Unknown","Point","LineString","Polygon"],Sh.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var u,A=a.readVarint()+a.pos,x=1,E=0,I=0,D=0,N=[];a.pos<A;){if(E<=0){var H=a.readVarint();x=7&H,E=H>>3}if(E--,x===1||x===2)I+=a.readSVarint(),D+=a.readSVarint(),x===1&&(u&&N.push(u),u=[]),u.push(new b(I,D));else{if(x!==7)throw new Error("unknown command "+x);u&&u.push(u[0].clone())}}return u&&N.push(u),N},Sh.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var u=a.readVarint()+a.pos,A=1,x=0,E=0,I=0,D=1/0,N=-1/0,H=1/0,q=-1/0;a.pos<u;){if(x<=0){var ee=a.readVarint();A=7&ee,x=ee>>3}if(x--,A===1||A===2)(E+=a.readSVarint())<D&&(D=E),E>N&&(N=E),(I+=a.readSVarint())<H&&(H=I),I>q&&(q=I);else if(A!==7)throw new Error("unknown command "+A)}return[D,H,N,q]},Sh.prototype.toGeoJSON=function(a,u,A){var x,E,I=this.extent*Math.pow(2,A),D=this.extent*a,N=this.extent*u,H=this.loadGeometry(),q=Sh.types[this.type];function ee(ye){for(var ke=0;ke<ye.length;ke++){var Ue=ye[ke];ye[ke]=[360*(Ue.x+D)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ue.y+N)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var se=[];for(x=0;x<H.length;x++)se[x]=H[x][0];ee(H=se);break;case 2:for(x=0;x<H.length;x++)ee(H[x]);break;case 3:for(H=function(ye){var ke=ye.length;if(ke<=1)return[ye];for(var Ue,je,Ve=[],qe=0;qe<ke;qe++){var at=$8(ye[qe]);at!==0&&(je===void 0&&(je=at<0),je===at<0?(Ue&&Ve.push(Ue),Ue=[ye[qe]]):Ue.push(ye[qe]))}return Ue&&Ve.push(Ue),Ve}(H),x=0;x<H.length;x++)for(E=0;E<H[x].length;E++)ee(H[x][E])}H.length===1?H=H[0]:q="Multi"+q;var he={type:"Feature",geometry:{type:q,coordinates:H},properties:this.properties};return"id"in this&&(he.id=this.id),he};var eE=tE;function tE(a,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(K8,this,u),this.length=this._features.length}function K8(a,u,A){a===15?u.version=A.readVarint():a===1?u.name=A.readString():a===5?u.extent=A.readVarint():a===2?u._features.push(A.pos):a===3?u._keys.push(A.readString()):a===4&&u._values.push(function(x){for(var E=null,I=x.readVarint()+x.pos;x.pos<I;){var D=x.readVarint()>>3;E=D===1?x.readString():D===2?x.readFloat():D===3?x.readDouble():D===4?x.readVarint64():D===5?x.readVarint():D===6?x.readSVarint():D===7?x.readBoolean():null}return E}(A))}function q8(a,u,A){if(a===3){var x=new eE(A,A.readVarint()+A.pos);x.length&&(u[x.name]=x)}}tE.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var u=this._pbf.readVarint()+this._pbf.pos;return new QC(this._pbf,u,this.extent,this._keys,this._values)};var Ih={VectorTile:function(a,u){this.layers=a.readFields(q8,{},u)},VectorTileFeature:QC,VectorTileLayer:eE},Z8=Ih.VectorTileFeature.types,Xy=Math.pow(2,13);function zA(a,u,A,x,E,I,D,N){a.emplaceBack(u,A,2*Math.floor(x*Xy)+D,E*Xy*2,I*Xy*2,Math.round(N))}var Ja=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new oi,this.indexArray=new $o,this.programConfigurations=new Ir(a.layers,a.zoom),this.segments=new Y,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Y8(a,u){return a.x===u.x&&(a.x<0||a.x>8192)||a.y===u.y&&(a.y<0||a.y>8192)}Ja.prototype.populate=function(a,u,A){this.features=[],this.hasPattern=Jy("fill-extrusion",this.layers,u);for(var x=0,E=a;x<E.length;x+=1){var I=E[x],D=I.feature,N=I.id,H=I.index,q=I.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,se=Ci(D,ee);if(this.layers[0]._featureFilter.filter(new Nr(this.zoom),se,A)){var he={id:N,sourceLayerIndex:q,index:H,geometry:ee?se.geometry:Ai(D),properties:D.properties,type:D.type,patterns:{}};this.hasPattern?this.features.push(Wy("fill-extrusion",this.layers,he,this.zoom,u)):this.addFeature(he,he.geometry,H,A,{}),u.featureIndex.insert(D,he.geometry,H,q,this.index,!0)}}},Ja.prototype.addFeatures=function(a,u,A){for(var x=0,E=this.features;x<E.length;x+=1){var I=E[x];this.addFeature(I,I.geometry,I.index,u,A)}},Ja.prototype.update=function(a,u,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,A)},Ja.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ja.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ja.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,W8),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ja.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ja.prototype.addFeature=function(a,u,A,x,E){for(var I=0,D=jy(u,500);I<D.length;I+=1){for(var N=D[I],H=0,q=0,ee=N;q<ee.length;q+=1)H+=ee[q].length;for(var se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),he=0,ye=N;he<ye.length;he+=1){var ke=ye[he];if(ke.length!==0&&!((sn=ke).every(function(Jr){return Jr.x<0})||sn.every(function(Jr){return Jr.x>8192})||sn.every(function(Jr){return Jr.y<0})||sn.every(function(Jr){return Jr.y>8192})))for(var Ue=0,je=0;je<ke.length;je++){var Ve=ke[je];if(je>=1){var qe=ke[je-1];if(!Y8(Ve,qe)){se.vertexLength+4>Y.MAX_VERTEX_ARRAY_LENGTH&&(se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var at=Ve.sub(qe)._perp()._unit(),pt=qe.dist(Ve);Ue+pt>32768&&(Ue=0),zA(this.layoutVertexArray,Ve.x,Ve.y,at.x,at.y,0,0,Ue),zA(this.layoutVertexArray,Ve.x,Ve.y,at.x,at.y,0,1,Ue),zA(this.layoutVertexArray,qe.x,qe.y,at.x,at.y,0,0,Ue+=pt),zA(this.layoutVertexArray,qe.x,qe.y,at.x,at.y,0,1,Ue);var _t=se.vertexLength;this.indexArray.emplaceBack(_t,_t+2,_t+1),this.indexArray.emplaceBack(_t+1,_t+2,_t+3),se.vertexLength+=4,se.primitiveLength+=2}}}}if(se.vertexLength+H>Y.MAX_VERTEX_ARRAY_LENGTH&&(se=this.segments.prepareSegment(H,this.layoutVertexArray,this.indexArray)),Z8[a.type]==="Polygon"){for(var Pt=[],Gt=[],Xt=se.vertexLength,mr=0,er=N;mr<er.length;mr+=1){var br=er[mr];if(br.length!==0){br!==N[0]&&Gt.push(Pt.length/2);for(var tr=0;tr<br.length;tr++){var Yr=br[tr];zA(this.layoutVertexArray,Yr.x,Yr.y,0,0,1,1,0),Pt.push(Yr.x),Pt.push(Yr.y)}}}for(var Mr=zy(Pt,Gt),ur=0;ur<Mr.length;ur+=3)this.indexArray.emplaceBack(Xt+Mr[ur],Xt+Mr[ur+2],Xt+Mr[ur+1]);se.primitiveLength+=Mr.length/3,se.vertexLength+=H}}var sn;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,E,x)},nr("FillExtrusionBucket",Ja,{omit:["layers","features"]});var Q8={paint:new Gn({"fill-extrusion-opacity":new _r(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new or(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _r(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _r(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new fu(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new or(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new or(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _r(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},eN=function(a){function u(A){a.call(this,A,Q8)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(A){return new Ja(A)},u.prototype.queryRadius=function(){return Hi(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(A,x,E,I,D,N,H,q){var ee=Ha(A,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,H),se=this.paint.get("fill-extrusion-height").evaluate(x,E),he=this.paint.get("fill-extrusion-base").evaluate(x,E),ye=function(Ue,je,Ve,qe){for(var at=[],pt=0,_t=Ue;pt<_t.length;pt+=1){var Pt=_t[pt],Gt=[Pt.x,Pt.y,0,1];Eh(Gt,Gt,je),at.push(new b(Gt[0]/Gt[3],Gt[1]/Gt[3]))}return at}(ee,q),ke=function(Ue,je,Ve,qe){for(var at=[],pt=[],_t=qe[8]*je,Pt=qe[9]*je,Gt=qe[10]*je,Xt=qe[11]*je,mr=qe[8]*Ve,er=qe[9]*Ve,br=qe[10]*Ve,tr=qe[11]*Ve,Yr=0,Mr=Ue;Yr<Mr.length;Yr+=1){for(var ur=[],sn=[],Jr=0,hn=Mr[Yr];Jr<hn.length;Jr+=1){var xr=hn[Jr],mn=xr.x,Zn=xr.y,bi=qe[0]*mn+qe[4]*Zn+qe[12],pi=qe[1]*mn+qe[5]*Zn+qe[13],Yn=qe[2]*mn+qe[6]*Zn+qe[14],xi=qe[3]*mn+qe[7]*Zn+qe[15],ji=Yn+Gt,Ji=xi+Xt,xs=bi+mr,ts=pi+er,ws=Yn+br,Ei=xi+tr,rs=new b((bi+_t)/Ji,(pi+Pt)/Ji);rs.z=ji/Ji,ur.push(rs);var ln=new b(xs/Ei,ts/Ei);ln.z=ws/Ei,sn.push(ln)}at.push(ur),pt.push(sn)}return[at,pt]}(I,he,se,q);return function(Ue,je,Ve){var qe=1/0;Ko(Ve,je)&&(qe=rE(Ve,je[0]));for(var at=0;at<je.length;at++)for(var pt=je[at],_t=Ue[at],Pt=0;Pt<pt.length-1;Pt++){var Gt=pt[Pt],Xt=[Gt,pt[Pt+1],_t[Pt+1],_t[Pt],Gt];Bc(Ve,Xt)&&(qe=Math.min(qe,rE(Ve,Xt)))}return qe!==1/0&&qe}(ke[0],ke[1],ye)},u}(Dr);function GA(a,u){return a.x*u.x+a.y*u.y}function rE(a,u){if(a.length===1){for(var A,x=0,E=u[x++];!A||E.equals(A);)if(!(A=u[x++]))return 1/0;for(;x<u.length;x++){var I=u[x],D=a[0],N=A.sub(E),H=I.sub(E),q=D.sub(E),ee=GA(N,N),se=GA(N,H),he=GA(H,H),ye=GA(q,N),ke=GA(q,H),Ue=ee*he-se*se,je=(he*ye-se*ke)/Ue,Ve=(ee*ke-se*ye)/Ue,qe=E.z*(1-je-Ve)+A.z*je+I.z*Ve;if(isFinite(qe))return qe}return 1/0}for(var at=1/0,pt=0,_t=u;pt<_t.length;pt+=1)at=Math.min(at,_t[pt].z);return at}var tN=Mi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,rN=Mi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,nN=Ih.VectorTileFeature.types,iN=Math.cos(Math.PI/180*37.5),nE=Math.pow(2,14)/.5,Ns=function(a){var u=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(A){return A.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(A){u.gradients[A.id]={}}),this.layoutVertexArray=new Yi,this.layoutVertexArray2=new ho,this.indexArray=new $o,this.programConfigurations=new Ir(a.layers,a.zoom),this.segments=new Y,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(A){return A.isStateDependent()}).map(function(A){return A.id})};Ns.prototype.populate=function(a,u,A){this.hasPattern=Jy("line",this.layers,u);for(var x=this.layers[0].layout.get("line-sort-key"),E=[],I=0,D=a;I<D.length;I+=1){var N=D[I],H=N.feature,q=N.id,ee=N.index,se=N.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,ye=Ci(H,he);if(this.layers[0]._featureFilter.filter(new Nr(this.zoom),ye,A)){var ke=x?x.evaluate(ye,{},A):void 0,Ue={id:q,properties:H.properties,type:H.type,sourceLayerIndex:se,index:ee,geometry:he?ye.geometry:Ai(H),patterns:{},sortKey:ke};E.push(Ue)}}x&&E.sort(function(Gt,Xt){return Gt.sortKey-Xt.sortKey});for(var je=0,Ve=E;je<Ve.length;je+=1){var qe=Ve[je],at=qe.geometry,pt=qe.index,_t=qe.sourceLayerIndex;if(this.hasPattern){var Pt=Wy("line",this.layers,qe,this.zoom,u);this.patternFeatures.push(Pt)}else this.addFeature(qe,at,pt,A,{});u.featureIndex.insert(a[pt].feature,at,pt,_t,this.index)}},Ns.prototype.update=function(a,u,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,A)},Ns.prototype.addFeatures=function(a,u,A){for(var x=0,E=this.patternFeatures;x<E.length;x+=1){var I=E[x];this.addFeature(I,I.geometry,I.index,u,A)}},Ns.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ns.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ns.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,rN)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,tN),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ns.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ns.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Ns.prototype.addFeature=function(a,u,A,x,E){var I=this.layers[0].layout,D=I.get("line-join").evaluate(a,{}),N=I.get("line-cap"),H=I.get("line-miter-limit"),q=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var ee=0,se=u;ee<se.length;ee+=1)this.addLine(se[ee],a,D,N,H,q);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,E,x)},Ns.prototype.addLine=function(a,u,A,x,E,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var D=0;D<a.length-1;D++)this.totalDistance+=a[D].dist(a[D+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var N=nN[u.type]==="Polygon",H=a.length;H>=2&&a[H-1].equals(a[H-2]);)H--;for(var q=0;q<H-1&&a[q].equals(a[q+1]);)q++;if(!(H<(N?3:2))){A==="bevel"&&(E=1.05);var ee,se=this.overscaling<=16?122880/(512*this.overscaling):0,he=this.segments.prepareSegment(10*H,this.layoutVertexArray,this.indexArray),ye=void 0,ke=void 0,Ue=void 0,je=void 0;this.e1=this.e2=-1,N&&(je=a[q].sub(ee=a[H-2])._unit()._perp());for(var Ve=q;Ve<H;Ve++)if(!(ke=Ve===H-1?N?a[q+1]:void 0:a[Ve+1])||!a[Ve].equals(ke)){je&&(Ue=je),ee&&(ye=ee),ee=a[Ve],je=ke?ke.sub(ee)._unit()._perp():Ue;var qe=(Ue=Ue||je).add(je);qe.x===0&&qe.y===0||qe._unit();var at=Ue.x*je.x+Ue.y*je.y,pt=qe.x*je.x+qe.y*je.y,_t=pt!==0?1/pt:1/0,Pt=2*Math.sqrt(2-2*pt),Gt=pt<iN&&ye&&ke,Xt=Ue.x*je.y-Ue.y*je.x>0;if(Gt&&Ve>q){var mr=ee.dist(ye);if(mr>2*se){var er=ee.sub(ee.sub(ye)._mult(se/mr)._round());this.updateDistance(ye,er),this.addCurrentVertex(er,Ue,0,0,he),ye=er}}var br=ye&&ke,tr=br?A:N?"butt":x;if(br&&tr==="round"&&(_t<I?tr="miter":_t<=2&&(tr="fakeround")),tr==="miter"&&_t>E&&(tr="bevel"),tr==="bevel"&&(_t>2&&(tr="flipbevel"),_t<E&&(tr="miter")),ye&&this.updateDistance(ye,ee),tr==="miter")qe._mult(_t),this.addCurrentVertex(ee,qe,0,0,he);else if(tr==="flipbevel"){if(_t>100)qe=je.mult(-1);else{var Yr=_t*Ue.add(je).mag()/Ue.sub(je).mag();qe._perp()._mult(Yr*(Xt?-1:1))}this.addCurrentVertex(ee,qe,0,0,he),this.addCurrentVertex(ee,qe.mult(-1),0,0,he)}else if(tr==="bevel"||tr==="fakeround"){var Mr=-Math.sqrt(_t*_t-1),ur=Xt?Mr:0,sn=Xt?0:Mr;if(ye&&this.addCurrentVertex(ee,Ue,ur,sn,he),tr==="fakeround")for(var Jr=Math.round(180*Pt/Math.PI/20),hn=1;hn<Jr;hn++){var xr=hn/Jr;if(xr!==.5){var mn=xr-.5;xr+=xr*mn*(xr-1)*((1.0904+at*(at*(3.55645-1.43519*at)-3.2452))*mn*mn+(.848013+at*(.215638*at-1.06021)))}var Zn=je.sub(Ue)._mult(xr)._add(Ue)._unit()._mult(Xt?-1:1);this.addHalfVertex(ee,Zn.x,Zn.y,!1,Xt,0,he)}ke&&this.addCurrentVertex(ee,je,-ur,-sn,he)}else if(tr==="butt")this.addCurrentVertex(ee,qe,0,0,he);else if(tr==="square"){var bi=ye?1:-1;this.addCurrentVertex(ee,qe,bi,bi,he)}else tr==="round"&&(ye&&(this.addCurrentVertex(ee,Ue,0,0,he),this.addCurrentVertex(ee,Ue,1,1,he,!0)),ke&&(this.addCurrentVertex(ee,je,-1,-1,he,!0),this.addCurrentVertex(ee,je,0,0,he)));if(Gt&&Ve<H-1){var pi=ee.dist(ke);if(pi>2*se){var Yn=ee.add(ke.sub(ee)._mult(se/pi)._round());this.updateDistance(ee,Yn),this.addCurrentVertex(Yn,je,0,0,he),ee=Yn}}}}},Ns.prototype.addCurrentVertex=function(a,u,A,x,E,I){I===void 0&&(I=!1);var D=u.y*x-u.x,N=-u.y-u.x*x;this.addHalfVertex(a,u.x+u.y*A,u.y-u.x*A,I,!1,A,E),this.addHalfVertex(a,D,N,I,!0,-x,E),this.distance>nE/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,u,A,x,E,I))},Ns.prototype.addHalfVertex=function(a,u,A,x,E,I,D){var N=.5*(this.lineClips?this.scaledDistance*(nE-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(x?1:0),(a.y<<1)+(E?1:0),Math.round(63*u)+128,Math.round(63*A)+128,1+(I===0?0:I<0?-1:1)|(63&N)<<2,N>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var H=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,H),D.primitiveLength++),E?this.e2=H:this.e1=H},Ns.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ns.prototype.updateDistance=function(a,u){this.distance+=a.dist(u),this.updateScaledDistance()},nr("LineBucket",Ns,{omit:["layers","patternFeatures"]});var sN=new Gn({"line-cap":new _r(ce.layout_line["line-cap"]),"line-join":new or(ce.layout_line["line-join"]),"line-miter-limit":new _r(ce.layout_line["line-miter-limit"]),"line-round-limit":new _r(ce.layout_line["line-round-limit"]),"line-sort-key":new or(ce.layout_line["line-sort-key"])}),iE={paint:new Gn({"line-opacity":new or(ce.paint_line["line-opacity"]),"line-color":new or(ce.paint_line["line-color"]),"line-translate":new _r(ce.paint_line["line-translate"]),"line-translate-anchor":new _r(ce.paint_line["line-translate-anchor"]),"line-width":new or(ce.paint_line["line-width"]),"line-gap-width":new or(ce.paint_line["line-gap-width"]),"line-offset":new or(ce.paint_line["line-offset"]),"line-blur":new or(ce.paint_line["line-blur"]),"line-dasharray":new ns(ce.paint_line["line-dasharray"]),"line-pattern":new fu(ce.paint_line["line-pattern"]),"line-gradient":new Gi(ce.paint_line["line-gradient"])}),layout:sN},sE=new(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(A,x){return x=new Nr(Math.floor(x.zoom),{now:x.now,fadeDuration:x.fadeDuration,zoomHistory:x.zoomHistory,transition:x.transition}),a.prototype.possiblyEvaluate.call(this,A,x)},u.prototype.evaluate=function(A,x,E,I){return x=V({},x,{zoom:Math.floor(x.zoom)}),a.prototype.evaluate.call(this,A,x,E,I)},u}(or))(iE.paint.properties["line-width"].specification);sE.useIntegerZoom=!0;var oN=function(a){function u(A){a.call(this,A,iE),this.gradientVersion=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(A){A==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof On,this.gradientVersion=(this.gradientVersion+1)%F)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(A,x){a.prototype.recalculate.call(this,A,x),this.paint._values["line-floorwidth"]=sE.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,A)},u.prototype.createBucket=function(A){return new Ns(A)},u.prototype.queryRadius=function(A){var x=A,E=oE(ma("line-width",this,x),ma("line-gap-width",this,x)),I=ma("line-offset",this,x);return E/2+Math.abs(I)+Hi(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(A,x,E,I,D,N,H){var q=Ha(A,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,H),ee=H/2*oE(this.paint.get("line-width").evaluate(x,E),this.paint.get("line-gap-width").evaluate(x,E)),se=this.paint.get("line-offset").evaluate(x,E);return se&&(I=function(he,ye){for(var ke=[],Ue=new b(0,0),je=0;je<he.length;je++){for(var Ve=he[je],qe=[],at=0;at<Ve.length;at++){var pt=Ve[at],_t=Ve[at+1],Pt=at===0?Ue:pt.sub(Ve[at-1])._unit()._perp(),Gt=at===Ve.length-1?Ue:_t.sub(pt)._unit()._perp(),Xt=Pt._add(Gt)._unit();Xt._mult(1/(Xt.x*Gt.x+Xt.y*Gt.y)),qe.push(Xt._mult(ye)._add(pt))}ke.push(qe)}return ke}(I,se*H)),function(he,ye,ke){for(var Ue=0;Ue<ye.length;Ue++){var je=ye[Ue];if(he.length>=3){for(var Ve=0;Ve<je.length;Ve++)if(ga(he,je[Ve]))return!0}if(wo(he,je,ke))return!0}return!1}(q,I,ee)},u.prototype.isTileClipped=function(){return!0},u}(Dr);function oE(a,u){return u>0?u+2*a:a}var aN=Mi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),cN=Mi([{name:"a_projected_pos",components:3,type:"Float32"}],4),lN=(Mi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Mi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),aE=(Mi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),uN=Mi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function fN(a,u,A){return a.sections.forEach(function(x){x.text=function(E,I,D){var N=I.layout.get("text-transform").evaluate(D,{});return N==="uppercase"?E=E.toLocaleUpperCase():N==="lowercase"&&(E=E.toLocaleLowerCase()),qi.applyArabicShaping&&(E=qi.applyArabicShaping(E)),E}(x.text,u,A)}),a}Mi([{name:"triangle",components:3,type:"Uint16"}]),Mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mi([{type:"Float32",name:"offsetX"}]),Mi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var VA={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},cE=function(a,u,A,x,E){var I,D,N=8*E-x-1,H=(1<<N)-1,q=H>>1,ee=-7,se=E-1,he=-1,ye=a[u+se];for(se+=he,I=ye&(1<<-ee)-1,ye>>=-ee,ee+=N;ee>0;I=256*I+a[u+se],se+=he,ee-=8);for(D=I&(1<<-ee)-1,I>>=-ee,ee+=x;ee>0;D=256*D+a[u+se],se+=he,ee-=8);if(I===0)I=1-q;else{if(I===H)return D?NaN:1/0*(ye?-1:1);D+=Math.pow(2,x),I-=q}return(ye?-1:1)*D*Math.pow(2,I-x)},lE=function(a,u,A,x,E,I){var D,N,H,q=8*I-E-1,ee=(1<<q)-1,se=ee>>1,he=E===23?Math.pow(2,-24)-Math.pow(2,-77):0,ye=0,ke=1,Ue=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(N=isNaN(u)?1:0,D=ee):(D=Math.floor(Math.log(u)/Math.LN2),u*(H=Math.pow(2,-D))<1&&(D--,H*=2),(u+=D+se>=1?he/H:he*Math.pow(2,1-se))*H>=2&&(D++,H/=2),D+se>=ee?(N=0,D=ee):D+se>=1?(N=(u*H-1)*Math.pow(2,E),D+=se):(N=u*Math.pow(2,se-1)*Math.pow(2,E),D=0));E>=8;a[A+ye]=255&N,ye+=ke,N/=256,E-=8);for(D=D<<E|N,q+=E;q>0;a[A+ye]=255&D,ye+=ke,D/=256,q-=8);a[A+ye-ke]|=128*Ue},Ug=Vn;function Vn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Vn.Varint=0,Vn.Fixed64=1,Vn.Bytes=2,Vn.Fixed32=5;var uE=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function yl(a){return a.type===Vn.Bytes?a.readVarint()+a.pos:a.pos+1}function Mh(a,u,A){return A?4294967296*u+(a>>>0):4294967296*(u>>>0)+(a>>>0)}function fE(a,u,A){var x=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));A.realloc(x);for(var E=A.pos-1;E>=a;E--)A.buf[E+x]=A.buf[E]}function hN(a,u){for(var A=0;A<a.length;A++)u.writeVarint(a[A])}function dN(a,u){for(var A=0;A<a.length;A++)u.writeSVarint(a[A])}function AN(a,u){for(var A=0;A<a.length;A++)u.writeFloat(a[A])}function pN(a,u){for(var A=0;A<a.length;A++)u.writeDouble(a[A])}function gN(a,u){for(var A=0;A<a.length;A++)u.writeBoolean(a[A])}function mN(a,u){for(var A=0;A<a.length;A++)u.writeFixed32(a[A])}function _N(a,u){for(var A=0;A<a.length;A++)u.writeSFixed32(a[A])}function yN(a,u){for(var A=0;A<a.length;A++)u.writeFixed64(a[A])}function vN(a,u){for(var A=0;A<a.length;A++)u.writeSFixed64(a[A])}function zg(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+16777216*a[u+3]}function Ph(a,u,A){a[A]=u,a[A+1]=u>>>8,a[A+2]=u>>>16,a[A+3]=u>>>24}function hE(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+(a[u+3]<<24)}function bN(a,u,A){a===1&&A.readMessage(xN,u)}function xN(a,u,A){if(a===3){var x=A.readMessage(wN,{}),E=x.width,I=x.height,D=x.left,N=x.top,H=x.advance;u.push({id:x.id,bitmap:new vf({width:E+6,height:I+6},x.bitmap),metrics:{width:E,height:I,left:D,top:N,advance:H}})}}function wN(a,u,A){a===1?u.id=A.readVarint():a===2?u.bitmap=A.readBytes():a===3?u.width=A.readVarint():a===4?u.height=A.readVarint():a===5?u.left=A.readSVarint():a===6?u.top=A.readSVarint():a===7&&(u.advance=A.readVarint())}function dE(a){for(var u=0,A=0,x=0,E=a;x<E.length;x+=1){var I=E[x];u+=I.w*I.h,A=Math.max(A,I.w)}a.sort(function(Ue,je){return je.h-Ue.h});for(var D=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),A),h:1/0}],N=0,H=0,q=0,ee=a;q<ee.length;q+=1)for(var se=ee[q],he=D.length-1;he>=0;he--){var ye=D[he];if(!(se.w>ye.w||se.h>ye.h)){if(se.x=ye.x,se.y=ye.y,H=Math.max(H,se.y+se.h),N=Math.max(N,se.x+se.w),se.w===ye.w&&se.h===ye.h){var ke=D.pop();he<D.length&&(D[he]=ke)}else se.h===ye.h?(ye.x+=se.w,ye.w-=se.w):se.w===ye.w?(ye.y+=se.h,ye.h-=se.h):(D.push({x:ye.x+se.w,y:ye.y,w:ye.w-se.w,h:se.h}),ye.y+=se.h,ye.h-=se.h);break}}return{w:N,h:H,fill:u/(N*H)||0}}Vn.prototype={destroy:function(){this.buf=null},readFields:function(a,u,A){for(A=A||this.length;this.pos<A;){var x=this.readVarint(),E=x>>3,I=this.pos;this.type=7&x,a(E,u,this),this.pos===I&&this.skip(x)}return u},readMessage:function(a,u){return this.readFields(a,u,this.readVarint()+this.pos)},readFixed32:function(){var a=zg(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=hE(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=zg(this.buf,this.pos)+4294967296*zg(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=zg(this.buf,this.pos)+4294967296*hE(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=cE(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=cE(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var u,A,x=this.buf;return u=127&(A=x[this.pos++]),A<128?u:(u|=(127&(A=x[this.pos++]))<<7,A<128?u:(u|=(127&(A=x[this.pos++]))<<14,A<128?u:(u|=(127&(A=x[this.pos++]))<<21,A<128?u:function(E,I,D){var N,H,q=D.buf;if(N=(112&(H=q[D.pos++]))>>4,H<128||(N|=(127&(H=q[D.pos++]))<<3,H<128)||(N|=(127&(H=q[D.pos++]))<<10,H<128)||(N|=(127&(H=q[D.pos++]))<<17,H<128)||(N|=(127&(H=q[D.pos++]))<<24,H<128)||(N|=(1&(H=q[D.pos++]))<<31,H<128))return Mh(E,N,I);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(A=x[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&uE?function(A,x,E){return uE.decode(A.subarray(x,E))}(this.buf,u,a):function(A,x,E){for(var I="",D=x;D<E;){var N,H,q,ee=A[D],se=null,he=ee>239?4:ee>223?3:ee>191?2:1;if(D+he>E)break;he===1?ee<128&&(se=ee):he===2?(192&(N=A[D+1]))==128&&(se=(31&ee)<<6|63&N)<=127&&(se=null):he===3?(H=A[D+2],(192&(N=A[D+1]))==128&&(192&H)==128&&((se=(15&ee)<<12|(63&N)<<6|63&H)<=2047||se>=55296&&se<=57343)&&(se=null)):he===4&&(H=A[D+2],q=A[D+3],(192&(N=A[D+1]))==128&&(192&H)==128&&(192&q)==128&&((se=(15&ee)<<18|(63&N)<<12|(63&H)<<6|63&q)<=65535||se>=1114112)&&(se=null)),se===null?(se=65533,he=1):se>65535&&(se-=65536,I+=String.fromCharCode(se>>>10&1023|55296),se=56320|1023&se),I+=String.fromCharCode(se),D+=he}return I}(this.buf,u,a)},readBytes:function(){var a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u},readPackedVarint:function(a,u){if(this.type!==Vn.Bytes)return a.push(this.readVarint(u));var A=yl(this);for(a=a||[];this.pos<A;)a.push(this.readVarint(u));return a},readPackedSVarint:function(a){if(this.type!==Vn.Bytes)return a.push(this.readSVarint());var u=yl(this);for(a=a||[];this.pos<u;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Vn.Bytes)return a.push(this.readBoolean());var u=yl(this);for(a=a||[];this.pos<u;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Vn.Bytes)return a.push(this.readFloat());var u=yl(this);for(a=a||[];this.pos<u;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Vn.Bytes)return a.push(this.readDouble());var u=yl(this);for(a=a||[];this.pos<u;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Vn.Bytes)return a.push(this.readFixed32());var u=yl(this);for(a=a||[];this.pos<u;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Vn.Bytes)return a.push(this.readSFixed32());var u=yl(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Vn.Bytes)return a.push(this.readFixed64());var u=yl(this);for(a=a||[];this.pos<u;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Vn.Bytes)return a.push(this.readSFixed64());var u=yl(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed64());return a},skip:function(a){var u=7&a;if(u===Vn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Vn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Vn.Fixed32)this.pos+=4;else{if(u!==Vn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(a,u){this.writeVarint(a<<3|u)},realloc:function(a){for(var u=this.length||16;u<this.pos+a;)u*=2;if(u!==this.length){var A=new Uint8Array(u);A.set(this.buf),this.buf=A,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Ph(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Ph(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Ph(this.buf,-1&a,this.pos),Ph(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Ph(this.buf,-1&a,this.pos),Ph(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(u,A){var x,E;if(u>=0?(x=u%4294967296|0,E=u/4294967296|0):(E=~(-u/4294967296),4294967295^(x=~(-u%4294967296))?x=x+1|0:(x=0,E=E+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");A.realloc(10),function(I,D,N){N.buf[N.pos++]=127&I|128,I>>>=7,N.buf[N.pos++]=127&I|128,I>>>=7,N.buf[N.pos++]=127&I|128,I>>>=7,N.buf[N.pos++]=127&I|128,N.buf[N.pos]=127&(I>>>=7)}(x,0,A),function(I,D){var N=(7&I)<<4;D.buf[D.pos++]|=N|((I>>>=3)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I)))))}(E,A)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var u=this.pos;this.pos=function(x,E,I){for(var D,N,H=0;H<E.length;H++){if((D=E.charCodeAt(H))>55295&&D<57344){if(!N){D>56319||H+1===E.length?(x[I++]=239,x[I++]=191,x[I++]=189):N=D;continue}if(D<56320){x[I++]=239,x[I++]=191,x[I++]=189,N=D;continue}D=N-55296<<10|D-56320|65536,N=null}else N&&(x[I++]=239,x[I++]=191,x[I++]=189,N=null);D<128?x[I++]=D:(D<2048?x[I++]=D>>6|192:(D<65536?x[I++]=D>>12|224:(x[I++]=D>>18|240,x[I++]=D>>12&63|128),x[I++]=D>>6&63|128),x[I++]=63&D|128)}return I}(this.buf,a,this.pos);var A=this.pos-u;A>=128&&fE(u,A,this),this.pos=u-1,this.writeVarint(A),this.pos+=A},writeFloat:function(a){this.realloc(4),lE(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),lE(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var u=a.length;this.writeVarint(u),this.realloc(u);for(var A=0;A<u;A++)this.buf[this.pos++]=a[A]},writeRawMessage:function(a,u){this.pos++;var A=this.pos;a(u,this);var x=this.pos-A;x>=128&&fE(A,x,this),this.pos=A-1,this.writeVarint(x),this.pos+=x},writeMessage:function(a,u,A){this.writeTag(a,Vn.Bytes),this.writeRawMessage(u,A)},writePackedVarint:function(a,u){u.length&&this.writeMessage(a,hN,u)},writePackedSVarint:function(a,u){u.length&&this.writeMessage(a,dN,u)},writePackedBoolean:function(a,u){u.length&&this.writeMessage(a,gN,u)},writePackedFloat:function(a,u){u.length&&this.writeMessage(a,AN,u)},writePackedDouble:function(a,u){u.length&&this.writeMessage(a,pN,u)},writePackedFixed32:function(a,u){u.length&&this.writeMessage(a,mN,u)},writePackedSFixed32:function(a,u){u.length&&this.writeMessage(a,_N,u)},writePackedFixed64:function(a,u){u.length&&this.writeMessage(a,yN,u)},writePackedSFixed64:function(a,u){u.length&&this.writeMessage(a,vN,u)},writeBytesField:function(a,u){this.writeTag(a,Vn.Bytes),this.writeBytes(u)},writeFixed32Field:function(a,u){this.writeTag(a,Vn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(a,u){this.writeTag(a,Vn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(a,u){this.writeTag(a,Vn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(a,u){this.writeTag(a,Vn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(a,u){this.writeTag(a,Vn.Varint),this.writeVarint(u)},writeSVarintField:function(a,u){this.writeTag(a,Vn.Varint),this.writeSVarint(u)},writeStringField:function(a,u){this.writeTag(a,Vn.Bytes),this.writeString(u)},writeFloatField:function(a,u){this.writeTag(a,Vn.Fixed32),this.writeFloat(u)},writeDoubleField:function(a,u){this.writeTag(a,Vn.Fixed64),this.writeDouble(u)},writeBooleanField:function(a,u){this.writeVarintField(a,!!u)}};var Gg=function(a,u){var A=u.pixelRatio,x=u.version,E=u.stretchX,I=u.stretchY,D=u.content;this.paddedRect=a,this.pixelRatio=A,this.stretchX=E,this.stretchY=I,this.content=D,this.version=x},HA={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};HA.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},HA.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},HA.tlbr.get=function(){return this.tl.concat(this.br)},HA.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Gg.prototype,HA);var jA=function(a,u){var A={},x={};this.haveRenderCallbacks=[];var E=[];this.addImages(a,A,E),this.addImages(u,x,E);var I=dE(E),D=new Zs({width:I.w||1,height:I.h||1});for(var N in a){var H=a[N],q=A[N].paddedRect;Zs.copy(H.data,D,{x:0,y:0},{x:q.x+1,y:q.y+1},H.data)}for(var ee in u){var se=u[ee],he=x[ee].paddedRect,ye=he.x+1,ke=he.y+1,Ue=se.data.width,je=se.data.height;Zs.copy(se.data,D,{x:0,y:0},{x:ye,y:ke},se.data),Zs.copy(se.data,D,{x:0,y:je-1},{x:ye,y:ke-1},{width:Ue,height:1}),Zs.copy(se.data,D,{x:0,y:0},{x:ye,y:ke+je},{width:Ue,height:1}),Zs.copy(se.data,D,{x:Ue-1,y:0},{x:ye-1,y:ke},{width:1,height:je}),Zs.copy(se.data,D,{x:0,y:0},{x:ye+Ue,y:ke},{width:1,height:je})}this.image=D,this.iconPositions=A,this.patternPositions=x};jA.prototype.addImages=function(a,u,A){for(var x in a){var E=a[x],I={x:0,y:0,w:E.data.width+2,h:E.data.height+2};A.push(I),u[x]=new Gg(I,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(x)}},jA.prototype.patchUpdatedImages=function(a,u){for(var A in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[A],a.getImage(A),u),this.patchUpdatedImage(this.patternPositions[A],a.getImage(A),u)},jA.prototype.patchUpdatedImage=function(a,u,A){if(a&&u&&a.version!==u.version){a.version=u.version;var x=a.tl;A.update(u.data,void 0,{x:x[0],y:x[1]})}},nr("ImagePosition",Gg),nr("ImageAtlas",jA);var Co={horizontal:1,vertical:2,horizontalOnly:3},Rh=function(){this.scale=1,this.fontStack="",this.imageName=null};Rh.forText=function(a,u){var A=new Rh;return A.scale=a||1,A.fontStack=u,A},Rh.forImage=function(a){var u=new Rh;return u.imageName=a,u};var bs=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Vg(a,u,A,x,E,I,D,N,H,q,ee,se,he,ye,ke,Ue){var je,Ve=bs.fromFeature(a,E);se===Co.vertical&&Ve.verticalizePunctuation();var qe=qi.processBidirectionalText,at=qi.processStyledBidirectionalText;if(qe&&Ve.sections.length===1){je=[];for(var pt=0,_t=qe(Ve.toString(),$y(Ve,q,I,u,x,ye,ke));pt<_t.length;pt+=1){var Pt=_t[pt],Gt=new bs;Gt.text=Pt,Gt.sections=Ve.sections;for(var Xt=0;Xt<Pt.length;Xt++)Gt.sectionIndex.push(0);je.push(Gt)}}else if(at){je=[];for(var mr=0,er=at(Ve.text,Ve.sectionIndex,$y(Ve,q,I,u,x,ye,ke));mr<er.length;mr+=1){var br=er[mr],tr=new bs;tr.text=br[0],tr.sectionIndex=br[1],tr.sections=Ve.sections,je.push(tr)}}else je=function(ur,sn){for(var Jr=[],hn=ur.text,xr=0,mn=0,Zn=sn;mn<Zn.length;mn+=1){var bi=Zn[mn];Jr.push(ur.substring(xr,bi)),xr=bi}return xr<hn.length&&Jr.push(ur.substring(xr,hn.length)),Jr}(Ve,$y(Ve,q,I,u,x,ye,ke));var Yr=[],Mr={positionedLines:Yr,text:Ve.toString(),top:ee[1],bottom:ee[1],left:ee[0],right:ee[0],writingMode:se,iconsInText:!1,verticalizable:!1};return function(ur,sn,Jr,hn,xr,mn,Zn,bi,pi,Yn,xi,ji){for(var Ji=0,xs=-17,ts=0,ws=0,Ei=bi==="right"?1:bi==="left"?0:.5,rs=0,ln=0,Fn=xr;ln<Fn.length;ln+=1){var Cn=Fn[ln];Cn.trim();var gn=Cn.getMaxScale(),ks=24*(gn-1),ds={positionedGlyphs:[],lineOffset:0};ur.positionedLines[rs]=ds;var Xn=ds.positionedGlyphs,Pi=0;if(Cn.length()){for(var As=0;As<Cn.length();As++){var _n=Cn.getSection(As),Mc=Cn.getSectionIndex(As),Eo=Cn.getCharCode(As),Pc=0,Ti=null,Rc=null,_a=null,zh=24,Cf=!(pi===Co.horizontal||!xi&&!cu(Eo)||xi&&(Hg[Eo]||(wl=Eo,Kt.Arabic(wl)||Kt["Arabic Supplement"](wl)||Kt["Arabic Extended-A"](wl)||Kt["Arabic Presentation Forms-A"](wl)||Kt["Arabic Presentation Forms-B"](wl))));if(_n.imageName){var Gh=hn[_n.imageName];if(!Gh)continue;_a=_n.imageName,ur.iconsInText=ur.iconsInText||!0,Rc=Gh.paddedRect;var xl=Gh.displaySize;_n.scale=24*_n.scale/ji,Pc=ks+(24-xl[1]*_n.scale),zh=(Ti={width:xl[0],height:xl[1],left:1,top:-3,advance:Cf?xl[1]:xl[0]}).advance;var Vh=Cf?xl[0]*_n.scale-24*gn:xl[1]*_n.scale-24*gn;Vh>0&&Vh>Pi&&(Pi=Vh)}else{var Yg=Jr[_n.fontStack],Hh=Yg&&Yg[Eo];if(Hh&&Hh.rect)Rc=Hh.rect,Ti=Hh.metrics;else{var XA=sn[_n.fontStack],Qg=XA&&XA[Eo];if(!Qg)continue;Ti=Qg.metrics}Pc=24*(gn-_n.scale)}Cf?(ur.verticalizable=!0,Xn.push({glyph:Eo,imageName:_a,x:Ji,y:xs+Pc,vertical:Cf,scale:_n.scale,fontStack:_n.fontStack,sectionIndex:Mc,metrics:Ti,rect:Rc}),Ji+=zh*_n.scale+Yn):(Xn.push({glyph:Eo,imageName:_a,x:Ji,y:xs+Pc,vertical:Cf,scale:_n.scale,fontStack:_n.fontStack,sectionIndex:Mc,metrics:Ti,rect:Rc}),Ji+=Ti.advance*_n.scale+Yn)}Xn.length!==0&&(ts=Math.max(Ji-Yn,ts),EN(Xn,0,Xn.length-1,Ei,Pi)),Ji=0;var e0=mn*gn+Pi;ds.lineOffset=Math.max(Pi,ks),xs+=e0,ws=Math.max(e0,ws),++rs}else xs+=mn,++rs}var wl,$A=xs- -17,jh=Ky(Zn),_u=jh.horizontalAlign,Jh=jh.verticalAlign;(function(t0,r0,KA,qA,n0,ZA,YA,QA,i0){var Wh,s0=(r0-KA)*n0;Wh=ZA!==YA?-QA*qA- -17:(-qA*i0+.5)*YA;for(var Xh=0,ep=t0;Xh<ep.length;Xh+=1)for(var Ef=0,tp=ep[Xh].positionedGlyphs;Ef<tp.length;Ef+=1){var $h=tp[Ef];$h.x+=s0,$h.y+=Wh}})(ur.positionedLines,Ei,_u,Jh,ts,ws,mn,$A,xr.length),ur.top+=-Jh*$A,ur.bottom=ur.top+$A,ur.left+=-_u*ts,ur.right=ur.left+ts}(Mr,u,A,x,je,D,N,H,se,q,he,Ue),!function(ur){for(var sn=0,Jr=ur;sn<Jr.length;sn+=1)if(Jr[sn].positionedGlyphs.length!==0)return!1;return!0}(Yr)&&Mr}bs.fromFeature=function(a,u){for(var A=new bs,x=0;x<a.sections.length;x++){var E=a.sections[x];E.image?A.addImageSection(E):A.addTextSection(E,u)}return A},bs.prototype.length=function(){return this.text.length},bs.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},bs.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},bs.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},bs.prototype.verticalizePunctuation=function(){this.text=function(a){for(var u="",A=0;A<a.length;A++){var x=a.charCodeAt(A+1)||null,E=a.charCodeAt(A-1)||null;u+=x&&hf(x)&&!VA[a[A+1]]||E&&hf(E)&&!VA[a[A-1]]||!VA[a[A]]?a[A]:VA[a[A]]}return u}(this.text)},bs.prototype.trim=function(){for(var a=0,u=0;u<this.text.length&&Hg[this.text.charCodeAt(u)];u++)a++;for(var A=this.text.length,x=this.text.length-1;x>=0&&x>=a&&Hg[this.text.charCodeAt(x)];x--)A--;this.text=this.text.substring(a,A),this.sectionIndex=this.sectionIndex.slice(a,A)},bs.prototype.substring=function(a,u){var A=new bs;return A.text=this.text.substring(a,u),A.sectionIndex=this.sectionIndex.slice(a,u),A.sections=this.sections,A},bs.prototype.toString=function(){return this.text},bs.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(u,A){return Math.max(u,a.sections[A].scale)},0)},bs.prototype.addTextSection=function(a,u){this.text+=a.text,this.sections.push(Rh.forText(a.scale,a.fontStack||u));for(var A=this.sections.length-1,x=0;x<a.text.length;++x)this.sectionIndex.push(A)},bs.prototype.addImageSection=function(a){var u=a.image?a.image.name:"";if(u.length!==0){var A=this.getNextImageSectionCharCode();A?(this.text+=String.fromCharCode(A),this.sections.push(Rh.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ne("Reached maximum number of images 6401")}else ne("Can't add FormattedSection with an empty image.")},bs.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Hg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},go={};function AE(a,u,A,x,E,I){if(u.imageName){var D=x[u.imageName];return D?D.displaySize[0]*u.scale*24/I+E:0}var N=A[u.fontStack],H=N&&N[a];return H?H.metrics.advance*u.scale+E:0}function pE(a,u,A,x){var E=Math.pow(a-u,2);return x?a<u?E/2:2*E:E+Math.abs(A)*A}function CN(a,u,A){var x=0;return a===10&&(x-=1e4),A&&(x+=150),a!==40&&a!==65288||(x+=50),u!==41&&u!==65289||(x+=50),x}function gE(a,u,A,x,E,I){for(var D=null,N=pE(u,A,E,I),H=0,q=x;H<q.length;H+=1){var ee=q[H],se=pE(u-ee.x,A,E,I)+ee.badness;se<=N&&(D=ee,N=se)}return{index:a,x:u,priorBreak:D,badness:N}}function $y(a,u,A,x,E,I,D){if(I!=="point")return[];if(!a)return[];for(var N,H=[],q=function(je,Ve,qe,at,pt,_t){for(var Pt=0,Gt=0;Gt<je.length();Gt++){var Xt=je.getSection(Gt);Pt+=AE(je.getCharCode(Gt),Xt,at,pt,Ve,_t)}return Pt/Math.max(1,Math.ceil(Pt/qe))}(a,u,A,x,E,D),ee=a.text.indexOf("")>=0,se=0,he=0;he<a.length();he++){var ye=a.getSection(he),ke=a.getCharCode(he);if(Hg[ke]||(se+=AE(ke,ye,x,E,u,D)),he<a.length()-1){var Ue=!((N=ke)<11904||!(Kt["Bopomofo Extended"](N)||Kt.Bopomofo(N)||Kt["CJK Compatibility Forms"](N)||Kt["CJK Compatibility Ideographs"](N)||Kt["CJK Compatibility"](N)||Kt["CJK Radicals Supplement"](N)||Kt["CJK Strokes"](N)||Kt["CJK Symbols and Punctuation"](N)||Kt["CJK Unified Ideographs Extension A"](N)||Kt["CJK Unified Ideographs"](N)||Kt["Enclosed CJK Letters and Months"](N)||Kt["Halfwidth and Fullwidth Forms"](N)||Kt.Hiragana(N)||Kt["Ideographic Description Characters"](N)||Kt["Kangxi Radicals"](N)||Kt["Katakana Phonetic Extensions"](N)||Kt.Katakana(N)||Kt["Vertical Forms"](N)||Kt["Yi Radicals"](N)||Kt["Yi Syllables"](N)));(go[ke]||Ue||ye.imageName)&&H.push(gE(he+1,se,q,H,CN(ke,a.getCharCode(he+1),Ue&&ee),!1))}}return function je(Ve){return Ve?je(Ve.priorBreak).concat(Ve.index):[]}(gE(a.length(),se,q,H,0,!0))}function Ky(a){var u=.5,A=.5;switch(a){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":A=1;break;case"top":case"top-right":case"top-left":A=0}return{horizontalAlign:u,verticalAlign:A}}function EN(a,u,A,x,E){if(x||E)for(var I=a[A],D=(a[A].x+I.metrics.advance*I.scale)*x,N=u;N<=A;N++)a[N].x-=D,a[N].y+=E}function mE(a,u,A,x,E,I){var D,N=a.image;if(N.content){var H=N.content,q=N.pixelRatio||1;D=[H[0]/q,H[1]/q,N.displaySize[0]-H[2]/q,N.displaySize[1]-H[3]/q]}var ee,se,he,ye,ke=u.left*I,Ue=u.right*I;A==="width"||A==="both"?(ye=E[0]+ke-x[3],se=E[0]+Ue+x[1]):se=(ye=E[0]+(ke+Ue-N.displaySize[0])/2)+N.displaySize[0];var je=u.top*I,Ve=u.bottom*I;return A==="height"||A==="both"?(ee=E[1]+je-x[0],he=E[1]+Ve+x[2]):he=(ee=E[1]+(je+Ve-N.displaySize[1])/2)+N.displaySize[1],{image:N,top:ee,right:se,bottom:he,left:ye,collisionPadding:D}}go[10]=!0,go[32]=!0,go[38]=!0,go[40]=!0,go[41]=!0,go[43]=!0,go[45]=!0,go[47]=!0,go[173]=!0,go[183]=!0,go[8203]=!0,go[8208]=!0,go[8211]=!0,go[8231]=!0;var Fh=function(a){function u(A,x,E,I){a.call(this,A,x),this.angle=E,I!==void 0&&(this.segment=I)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(b);function qy(a,u){var A=u.expression;if(A.kind==="constant")return{kind:"constant",layoutSize:A.evaluate(new Nr(a+1))};if(A.kind==="source")return{kind:"source"};for(var x=A.zoomStops,E=A.interpolationType,I=0;I<x.length&&x[I]<=a;)I++;for(var D=I=Math.max(0,I-1);D<x.length&&x[D]<a+1;)D++;D=Math.min(x.length-1,D);var N=x[I],H=x[D];return A.kind==="composite"?{kind:"composite",minZoom:N,maxZoom:H,interpolationType:E}:{kind:"camera",minZoom:N,maxZoom:H,minSize:A.evaluate(new Nr(N)),maxSize:A.evaluate(new Nr(H)),interpolationType:E}}function _E(a,u,A){var x=u.uSize,E=A.lowerSize;return a.kind==="source"?E/128:a.kind==="composite"?si(E/128,A.upperSize/128,u.uSizeT):x}function yE(a,u){var A=0,x=0;if(a.kind==="constant")x=a.layoutSize;else if(a.kind!=="source"){var E=a.interpolationType,I=E?j(Fi.interpolationFactor(E,u,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?x=si(a.minSize,a.maxSize,I):A=I}return{uSizeT:A,uSize:x}}nr("Anchor",Fh);var TN=Object.freeze({__proto__:null,getSizeData:qy,evaluateSizeForFeature:_E,evaluateSizeForZoom:yE,SIZE_PACK_FACTOR:128});function vE(a,u,A,x,E){if(u.segment===void 0)return!0;for(var I=u,D=u.segment+1,N=0;N>-A/2;){if(--D<0)return!1;N-=a[D].dist(I),I=a[D]}N+=a[D].dist(a[D+1]),D++;for(var H=[],q=0;N<A/2;){var ee=a[D],se=a[D+1];if(!se)return!1;var he=a[D-1].angleTo(ee)-ee.angleTo(se);for(he=Math.abs((he+3*Math.PI)%(2*Math.PI)-Math.PI),H.push({distance:N,angleDelta:he}),q+=he;N-H[0].distance>x;)q-=H.shift().angleDelta;if(q>E)return!1;D++,N+=ee.dist(se)}return!0}function bE(a){for(var u=0,A=0;A<a.length-1;A++)u+=a[A].dist(a[A+1]);return u}function xE(a,u,A){return a?.6*u*A:0}function wE(a,u){return Math.max(a?a.right-a.left:0,u?u.right-u.left:0)}function BN(a,u,A,x,E,I){for(var D=xE(A,E,I),N=wE(A,x)*I,H=0,q=bE(a)/2,ee=0;ee<a.length-1;ee++){var se=a[ee],he=a[ee+1],ye=se.dist(he);if(H+ye>q){var ke=(q-H)/ye,Ue=si(se.x,he.x,ke),je=si(se.y,he.y,ke),Ve=new Fh(Ue,je,he.angleTo(se),ee);return Ve._round(),!D||vE(a,Ve,N,D,u)?Ve:void 0}H+=ye}}function SN(a,u,A,x,E,I,D,N,H){var q=xE(x,I,D),ee=wE(x,E),se=ee*D,he=a[0].x===0||a[0].x===H||a[0].y===0||a[0].y===H;return u-se<u/4&&(u=se+u/4),function ye(ke,Ue,je,Ve,qe,at,pt,_t,Pt){for(var Gt=at/2,Xt=bE(ke),mr=0,er=Ue-je,br=[],tr=0;tr<ke.length-1;tr++){for(var Yr=ke[tr],Mr=ke[tr+1],ur=Yr.dist(Mr),sn=Mr.angleTo(Yr);er+je<mr+ur;){var Jr=((er+=je)-mr)/ur,hn=si(Yr.x,Mr.x,Jr),xr=si(Yr.y,Mr.y,Jr);if(hn>=0&&hn<Pt&&xr>=0&&xr<Pt&&er-Gt>=0&&er+Gt<=Xt){var mn=new Fh(hn,xr,sn,tr);mn._round(),Ve&&!vE(ke,mn,at,Ve,qe)||br.push(mn)}}mr+=ur}return _t||br.length||pt||(br=ye(ke,mr/2,je,Ve,qe,at,pt,!0,Pt)),br}(a,he?u/2*N%u:(ee/2+2*I)*D*N%u,u,q,A,se,he,!1,H)}function CE(a,u,A,x,E){for(var I=[],D=0;D<a.length;D++)for(var N=a[D],H=void 0,q=0;q<N.length-1;q++){var ee=N[q],se=N[q+1];ee.x<u&&se.x<u||(ee.x<u?ee=new b(u,ee.y+(u-ee.x)/(se.x-ee.x)*(se.y-ee.y))._round():se.x<u&&(se=new b(u,ee.y+(u-ee.x)/(se.x-ee.x)*(se.y-ee.y))._round()),ee.y<A&&se.y<A||(ee.y<A?ee=new b(ee.x+(A-ee.y)/(se.y-ee.y)*(se.x-ee.x),A)._round():se.y<A&&(se=new b(ee.x+(A-ee.y)/(se.y-ee.y)*(se.x-ee.x),A)._round()),ee.x>=x&&se.x>=x||(ee.x>=x?ee=new b(x,ee.y+(x-ee.x)/(se.x-ee.x)*(se.y-ee.y))._round():se.x>=x&&(se=new b(x,ee.y+(x-ee.x)/(se.x-ee.x)*(se.y-ee.y))._round()),ee.y>=E&&se.y>=E||(ee.y>=E?ee=new b(ee.x+(E-ee.y)/(se.y-ee.y)*(se.x-ee.x),E)._round():se.y>=E&&(se=new b(ee.x+(E-ee.y)/(se.y-ee.y)*(se.x-ee.x),E)._round()),H&&ee.equals(H[H.length-1])||I.push(H=[ee]),H.push(se)))))}return I}function EE(a,u,A,x){var E=[],I=a.image,D=I.pixelRatio,N=I.paddedRect.w-2,H=I.paddedRect.h-2,q=a.right-a.left,ee=a.bottom-a.top,se=I.stretchX||[[0,N]],he=I.stretchY||[[0,H]],ye=function(hn,xr){return hn+xr[1]-xr[0]},ke=se.reduce(ye,0),Ue=he.reduce(ye,0),je=N-ke,Ve=H-Ue,qe=0,at=ke,pt=0,_t=Ue,Pt=0,Gt=je,Xt=0,mr=Ve;if(I.content&&x){var er=I.content;qe=jg(se,0,er[0]),pt=jg(he,0,er[1]),at=jg(se,er[0],er[2]),_t=jg(he,er[1],er[3]),Pt=er[0]-qe,Xt=er[1]-pt,Gt=er[2]-er[0]-at,mr=er[3]-er[1]-_t}var br=function(hn,xr,mn,Zn){var bi=Jg(hn.stretch-qe,at,q,a.left),pi=Wg(hn.fixed-Pt,Gt,hn.stretch,ke),Yn=Jg(xr.stretch-pt,_t,ee,a.top),xi=Wg(xr.fixed-Xt,mr,xr.stretch,Ue),ji=Jg(mn.stretch-qe,at,q,a.left),Ji=Wg(mn.fixed-Pt,Gt,mn.stretch,ke),xs=Jg(Zn.stretch-pt,_t,ee,a.top),ts=Wg(Zn.fixed-Xt,mr,Zn.stretch,Ue),ws=new b(bi,Yn),Ei=new b(ji,Yn),rs=new b(ji,xs),ln=new b(bi,xs),Fn=new b(pi/D,xi/D),Cn=new b(Ji/D,ts/D),gn=u*Math.PI/180;if(gn){var ks=Math.sin(gn),ds=Math.cos(gn),Xn=[ds,-ks,ks,ds];ws._matMult(Xn),Ei._matMult(Xn),ln._matMult(Xn),rs._matMult(Xn)}var Pi=hn.stretch+hn.fixed,As=xr.stretch+xr.fixed;return{tl:ws,tr:Ei,bl:ln,br:rs,tex:{x:I.paddedRect.x+1+Pi,y:I.paddedRect.y+1+As,w:mn.stretch+mn.fixed-Pi,h:Zn.stretch+Zn.fixed-As},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fn,pixelOffsetBR:Cn,minFontScaleX:Gt/D/q,minFontScaleY:mr/D/ee,isSDF:A}};if(x&&(I.stretchX||I.stretchY))for(var tr=TE(se,je,ke),Yr=TE(he,Ve,Ue),Mr=0;Mr<tr.length-1;Mr++)for(var ur=tr[Mr],sn=tr[Mr+1],Jr=0;Jr<Yr.length-1;Jr++)E.push(br(ur,Yr[Jr],sn,Yr[Jr+1]));else E.push(br({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:N+1},{fixed:0,stretch:H+1}));return E}function jg(a,u,A){for(var x=0,E=0,I=a;E<I.length;E+=1){var D=I[E];x+=Math.max(u,Math.min(A,D[1]))-Math.max(u,Math.min(A,D[0]))}return x}function TE(a,u,A){for(var x=[{fixed:-1,stretch:0}],E=0,I=a;E<I.length;E+=1){var D=I[E],N=D[0],H=D[1],q=x[x.length-1];x.push({fixed:N-q.stretch,stretch:q.stretch}),x.push({fixed:N-q.stretch,stretch:q.stretch+(H-N)})}return x.push({fixed:u+1,stretch:A}),x}function Jg(a,u,A,x){return a/u*A+x}function Wg(a,u,A,x){return a-u*A/x}var Xg=function(a,u,A,x,E,I,D,N,H,q){if(this.boxStartIndex=a.length,H){var ee=I.top,se=I.bottom,he=I.collisionPadding;he&&(ee-=he[1],se+=he[3]);var ye=se-ee;ye>0&&(ye=Math.max(10,ye),this.circleDiameter=ye)}else{var ke=I.top*D-N,Ue=I.bottom*D+N,je=I.left*D-N,Ve=I.right*D+N,qe=I.collisionPadding;if(qe&&(je-=qe[0]*D,ke-=qe[1]*D,Ve+=qe[2]*D,Ue+=qe[3]*D),q){var at=new b(je,ke),pt=new b(Ve,ke),_t=new b(je,Ue),Pt=new b(Ve,Ue),Gt=q*Math.PI/180;at._rotate(Gt),pt._rotate(Gt),_t._rotate(Gt),Pt._rotate(Gt),je=Math.min(at.x,pt.x,_t.x,Pt.x),Ve=Math.max(at.x,pt.x,_t.x,Pt.x),ke=Math.min(at.y,pt.y,_t.y,Pt.y),Ue=Math.max(at.y,pt.y,_t.y,Pt.y)}a.emplaceBack(u.x,u.y,je,ke,Ve,Ue,A,x,E)}this.boxEndIndex=a.length},Dh=function(a,u){if(a===void 0&&(a=[]),u===void 0&&(u=IN),this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(var A=(this.length>>1)-1;A>=0;A--)this._down(A)};function IN(a,u){return a<u?-1:a>u?1:0}function MN(a,u,A){A===void 0&&(A=!1);for(var x=1/0,E=1/0,I=-1/0,D=-1/0,N=a[0],H=0;H<N.length;H++){var q=N[H];(!H||q.x<x)&&(x=q.x),(!H||q.y<E)&&(E=q.y),(!H||q.x>I)&&(I=q.x),(!H||q.y>D)&&(D=q.y)}var ee=Math.min(I-x,D-E),se=ee/2,he=new Dh([],PN);if(ee===0)return new b(x,E);for(var ye=x;ye<I;ye+=ee)for(var ke=E;ke<D;ke+=ee)he.push(new Oh(ye+se,ke+se,se,a));for(var Ue=function(qe){for(var at=0,pt=0,_t=0,Pt=qe[0],Gt=0,Xt=Pt.length,mr=Xt-1;Gt<Xt;mr=Gt++){var er=Pt[Gt],br=Pt[mr],tr=er.x*br.y-br.x*er.y;pt+=(er.x+br.x)*tr,_t+=(er.y+br.y)*tr,at+=3*tr}return new Oh(pt/at,_t/at,0,qe)}(a),je=he.length;he.length;){var Ve=he.pop();(Ve.d>Ue.d||!Ue.d)&&(Ue=Ve,A&&console.log("found best %d after %d probes",Math.round(1e4*Ve.d)/1e4,je)),Ve.max-Ue.d<=u||(he.push(new Oh(Ve.p.x-(se=Ve.h/2),Ve.p.y-se,se,a)),he.push(new Oh(Ve.p.x+se,Ve.p.y-se,se,a)),he.push(new Oh(Ve.p.x-se,Ve.p.y+se,se,a)),he.push(new Oh(Ve.p.x+se,Ve.p.y+se,se,a)),je+=4)}return A&&(console.log("num probes: "+je),console.log("best distance: "+Ue.d)),Ue.p}function PN(a,u){return u.max-a.max}function Oh(a,u,A,x){this.p=new b(a,u),this.h=A,this.d=function(E,I){for(var D=!1,N=1/0,H=0;H<I.length;H++)for(var q=I[H],ee=0,se=q.length,he=se-1;ee<se;he=ee++){var ye=q[ee],ke=q[he];ye.y>E.y!=ke.y>E.y&&E.x<(ke.x-ye.x)*(E.y-ye.y)/(ke.y-ye.y)+ye.x&&(D=!D),N=Math.min(N,Au(E,ye,ke))}return(D?1:-1)*Math.sqrt(N)}(this.p,x),this.max=this.d+this.h*Math.SQRT2}Dh.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Dh.prototype.pop=function(){if(this.length!==0){var a=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),a}},Dh.prototype.peek=function(){return this.data[0]},Dh.prototype._up=function(a){for(var u=this.data,A=this.compare,x=u[a];a>0;){var E=a-1>>1,I=u[E];if(A(x,I)>=0)break;u[a]=I,a=E}u[a]=x},Dh.prototype._down=function(a){for(var u=this.data,A=this.compare,x=this.length>>1,E=u[a];a<x;){var I=1+(a<<1),D=u[I],N=I+1;if(N<this.length&&A(u[N],D)<0&&(I=N,D=u[N]),A(D,E)>=0)break;u[a]=D,a=I}u[a]=E};var Zy=Number.POSITIVE_INFINITY;function BE(a,u){return u[1]!==Zy?function(A,x,E){var I=0,D=0;switch(x=Math.abs(x),E=Math.abs(E),A){case"top-right":case"top-left":case"top":D=E-7;break;case"bottom-right":case"bottom-left":case"bottom":D=7-E}switch(A){case"top-right":case"bottom-right":case"right":I=-x;break;case"top-left":case"bottom-left":case"left":I=x}return[I,D]}(a,u[0],u[1]):function(A,x){var E=0,I=0;x<0&&(x=0);var D=x/Math.sqrt(2);switch(A){case"top-right":case"top-left":I=D-7;break;case"bottom-right":case"bottom-left":I=7-D;break;case"bottom":I=7-x;break;case"top":I=x-7}switch(A){case"top-right":case"bottom-right":E=-D;break;case"top-left":case"bottom-left":E=D;break;case"left":E=x;break;case"right":E=-x}return[E,I]}(a,u[0])}function Yy(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function SE(a,u,A,x,E,I,D,N,H,q,ee,se,he,ye,ke){var Ue=function(pt,_t,Pt,Gt,Xt,mr,er,br){for(var tr=Gt.layout.get("text-rotate").evaluate(mr,{})*Math.PI/180,Yr=[],Mr=0,ur=_t.positionedLines;Mr<ur.length;Mr+=1)for(var sn=ur[Mr],Jr=0,hn=sn.positionedGlyphs;Jr<hn.length;Jr+=1){var xr=hn[Jr];if(xr.rect){var mn=xr.rect||{},Zn=4,bi=!0,pi=1,Yn=0,xi=(Xt||br)&&xr.vertical,ji=xr.metrics.advance*xr.scale/2;if(br&&_t.verticalizable&&(Yn=sn.lineOffset/2-(xr.imageName?-(24-xr.metrics.width*xr.scale)/2:24*(xr.scale-1))),xr.imageName){var Ji=er[xr.imageName];bi=Ji.sdf,Zn=1/(pi=Ji.pixelRatio)}var xs=Xt?[xr.x+ji,xr.y]:[0,0],ts=Xt?[0,0]:[xr.x+ji+Pt[0],xr.y+Pt[1]-Yn],ws=[0,0];xi&&(ws=ts,ts=[0,0]);var Ei=(xr.metrics.left-Zn)*xr.scale-ji+ts[0],rs=(-xr.metrics.top-Zn)*xr.scale+ts[1],ln=Ei+mn.w*xr.scale/pi,Fn=rs+mn.h*xr.scale/pi,Cn=new b(Ei,rs),gn=new b(ln,rs),ks=new b(Ei,Fn),ds=new b(ln,Fn);if(xi){var Xn=new b(-ji,ji- -17),Pi=-Math.PI/2,As=12-ji,_n=new b(22-As,-(xr.imageName?As:0)),Mc=new(Function.prototype.bind.apply(b,[null].concat(ws)));Cn._rotateAround(Pi,Xn)._add(_n)._add(Mc),gn._rotateAround(Pi,Xn)._add(_n)._add(Mc),ks._rotateAround(Pi,Xn)._add(_n)._add(Mc),ds._rotateAround(Pi,Xn)._add(_n)._add(Mc)}if(tr){var Eo=Math.sin(tr),Pc=Math.cos(tr),Ti=[Pc,-Eo,Eo,Pc];Cn._matMult(Ti),gn._matMult(Ti),ks._matMult(Ti),ds._matMult(Ti)}var Rc=new b(0,0),_a=new b(0,0);Yr.push({tl:Cn,tr:gn,bl:ks,br:ds,tex:mn,writingMode:_t.writingMode,glyphOffset:xs,sectionIndex:xr.sectionIndex,isSDF:bi,pixelOffsetTL:Rc,pixelOffsetBR:_a,minFontScaleX:0,minFontScaleY:0})}}return Yr}(0,A,N,E,I,D,x,a.allowVerticalPlacement),je=a.textSizeData,Ve=null;je.kind==="source"?(Ve=[128*E.layout.get("text-size").evaluate(D,{})])[0]>32640&&ne(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):je.kind==="composite"&&((Ve=[128*ye.compositeTextSizes[0].evaluate(D,{},ke),128*ye.compositeTextSizes[1].evaluate(D,{},ke)])[0]>32640||Ve[1]>32640)&&ne(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Ue,Ve,N,I,D,q,u,H.lineStartIndex,H.lineLength,he,ke);for(var qe=0,at=ee;qe<at.length;qe+=1)se[at[qe]]=a.text.placedSymbolArray.length-1;return 4*Ue.length}function IE(a){for(var u in a)return a[u];return null}function RN(a,u,A,x){var E=a.compareText;if(u in E){for(var I=E[u],D=I.length-1;D>=0;D--)if(x.dist(I[D])<A)return!0}else E[u]=[];return E[u].push(x),!1}var FN=Ih.VectorTileFeature.types,DN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $g(a,u,A,x,E,I,D,N,H,q,ee,se,he){var ye=N?Math.min(32640,Math.round(N[0])):0,ke=N?Math.min(32640,Math.round(N[1])):0;a.emplaceBack(u,A,Math.round(32*x),Math.round(32*E),I,D,(ye<<1)+(H?1:0),ke,16*q,16*ee,256*se,256*he)}function Qy(a,u,A){a.emplaceBack(u.x,u.y,A),a.emplaceBack(u.x,u.y,A),a.emplaceBack(u.x,u.y,A),a.emplaceBack(u.x,u.y,A)}function ON(a){for(var u=0,A=a.sections;u<A.length;u+=1)if(lu(A[u].text))return!0;return!1}var Lh=function(a){this.layoutVertexArray=new jt,this.indexArray=new $o,this.programConfigurations=a,this.segments=new Y,this.dynamicLayoutVertexArray=new Yt,this.opacityVertexArray=new Tc,this.placedSymbolArray=new m};Lh.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Lh.prototype.upload=function(a,u,A,x){this.isEmpty()||(A&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,aN.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,cN.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,DN,!0),this.opacityVertexBuffer.itemSize=1),(A||x)&&this.programConfigurations.upload(a))},Lh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},nr("SymbolBuffers",Lh);var JA=function(a,u,A){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new A,this.segments=new Y,this.collisionVertexArray=new Xo};JA.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,lN.members,!0)},JA.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},nr("CollisionBuffers",JA);var Sn=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(I){return I.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=po([]),this.placementViewportMatrix=po([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qy(this.zoom,u["text-size"]),this.iconSizeData=qy(this.zoom,u["icon-size"]);var A=this.layers[0].layout,x=A.get("symbol-sort-key"),E=A.get("symbol-z-order");this.canOverlap=A.get("text-allow-overlap")||A.get("icon-allow-overlap")||A.get("text-ignore-placement")||A.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&x.constantOr(1)!==void 0,this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,A.get("symbol-placement")==="point"&&(this.writingModes=A.get("text-writing-mode").map(function(I){return Co[I]})),this.stateDependentLayerIds=this.layers.filter(function(I){return I.isStateDependent()}).map(function(I){return I.id}),this.sourceID=a.sourceID};Sn.prototype.createArrays=function(){this.text=new Lh(new Ir(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Lh(new Ir(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new R,this.lineVertexArray=new L,this.symbolInstances=new P},Sn.prototype.calculateGlyphDependencies=function(a,u,A,x,E){for(var I=0;I<a.length;I++)if(u[a.charCodeAt(I)]=!0,(A||x)&&E){var D=VA[a.charAt(I)];D&&(u[D.charCodeAt(0)]=!0)}},Sn.prototype.populate=function(a,u,A){var x=this.layers[0],E=x.layout,I=E.get("text-font"),D=E.get("text-field"),N=E.get("icon-image"),H=(D.value.kind!=="constant"||D.value.value instanceof ri&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),q=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,ee=E.get("symbol-sort-key");if(this.features=[],H||q){for(var se=u.iconDependencies,he=u.glyphDependencies,ye=u.availableImages,ke=new Nr(this.zoom),Ue=0,je=a;Ue<je.length;Ue+=1){var Ve=je[Ue],qe=Ve.feature,at=Ve.id,pt=Ve.index,_t=Ve.sourceLayerIndex,Pt=x._featureFilter.needGeometry,Gt=Ci(qe,Pt);if(x._featureFilter.filter(ke,Gt,A)){Pt||(Gt.geometry=Ai(qe));var Xt=void 0;if(H){var mr=x.getValueAndResolveTokens("text-field",Gt,A,ye),er=ri.factory(mr);ON(er)&&(this.hasRTLText=!0),(!this.hasRTLText||Af()==="unavailable"||this.hasRTLText&&qi.isParsed())&&(Xt=fN(er,x,Gt))}var br=void 0;if(q){var tr=x.getValueAndResolveTokens("icon-image",Gt,A,ye);br=tr instanceof kn?tr:kn.fromString(tr)}if(Xt||br){var Yr=this.sortFeaturesByKey?ee.evaluate(Gt,{},A):void 0;if(this.features.push({id:at,text:Xt,icon:br,index:pt,sourceLayerIndex:_t,geometry:Gt.geometry,properties:qe.properties,type:FN[qe.type],sortKey:Yr}),br&&(se[br.name]=!0),Xt){var Mr=I.evaluate(Gt,{},A).join(","),ur=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Co.vertical)>=0;for(var sn=0,Jr=Xt.sections;sn<Jr.length;sn+=1){var hn=Jr[sn];if(hn.image)se[hn.image.name]=!0;else{var xr=ff(Xt.toString()),mn=hn.fontStack||Mr,Zn=he[mn]=he[mn]||{};this.calculateGlyphDependencies(hn.text,Zn,ur,this.allowVerticalPlacement,xr)}}}}}}E.get("symbol-placement")==="line"&&(this.features=function(bi){var pi={},Yn={},xi=[],ji=0;function Ji(Xn){xi.push(bi[Xn]),ji++}function xs(Xn,Pi,As){var _n=Yn[Xn];return delete Yn[Xn],Yn[Pi]=_n,xi[_n].geometry[0].pop(),xi[_n].geometry[0]=xi[_n].geometry[0].concat(As[0]),_n}function ts(Xn,Pi,As){var _n=pi[Pi];return delete pi[Pi],pi[Xn]=_n,xi[_n].geometry[0].shift(),xi[_n].geometry[0]=As[0].concat(xi[_n].geometry[0]),_n}function ws(Xn,Pi,As){var _n=As?Pi[0][Pi[0].length-1]:Pi[0][0];return Xn+":"+_n.x+":"+_n.y}for(var Ei=0;Ei<bi.length;Ei++){var rs=bi[Ei],ln=rs.geometry,Fn=rs.text?rs.text.toString():null;if(Fn){var Cn=ws(Fn,ln),gn=ws(Fn,ln,!0);if(Cn in Yn&&gn in pi&&Yn[Cn]!==pi[gn]){var ks=ts(Cn,gn,ln),ds=xs(Cn,gn,xi[ks].geometry);delete pi[Cn],delete Yn[gn],Yn[ws(Fn,xi[ds].geometry,!0)]=ds,xi[ks].geometry=null}else Cn in Yn?xs(Cn,gn,ln):gn in pi?ts(Cn,gn,ln):(Ji(Ei),pi[Cn]=ji-1,Yn[gn]=ji-1)}else Ji(Ei)}return xi.filter(function(Xn){return Xn.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(bi,pi){return bi.sortKey-pi.sortKey})}},Sn.prototype.update=function(a,u,A){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,A),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,A))},Sn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Sn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Sn.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Sn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Sn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Sn.prototype.addToLineVertexArray=function(a,u){var A=this.lineVertexArray.length;if(a.segment!==void 0){for(var x=a.dist(u[a.segment+1]),E=a.dist(u[a.segment]),I={},D=a.segment+1;D<u.length;D++)I[D]={x:u[D].x,y:u[D].y,tileUnitDistanceFromAnchor:x},D<u.length-1&&(x+=u[D+1].dist(u[D]));for(var N=a.segment||0;N>=0;N--)I[N]={x:u[N].x,y:u[N].y,tileUnitDistanceFromAnchor:E},N>0&&(E+=u[N-1].dist(u[N]));for(var H=0;H<u.length;H++){var q=I[H];this.lineVertexArray.emplaceBack(q.x,q.y,q.tileUnitDistanceFromAnchor)}}return{lineStartIndex:A,lineLength:this.lineVertexArray.length-A}},Sn.prototype.addSymbols=function(a,u,A,x,E,I,D,N,H,q,ee,se){for(var he=a.indexArray,ye=a.layoutVertexArray,ke=a.segments.prepareSegment(4*u.length,ye,he,this.canOverlap?I.sortKey:void 0),Ue=this.glyphOffsetArray.length,je=ke.vertexLength,Ve=this.allowVerticalPlacement&&D===Co.vertical?Math.PI/2:0,qe=I.text&&I.text.sections,at=0;at<u.length;at++){var pt=u[at],_t=pt.tl,Pt=pt.tr,Gt=pt.bl,Xt=pt.br,mr=pt.tex,er=pt.pixelOffsetTL,br=pt.pixelOffsetBR,tr=pt.minFontScaleX,Yr=pt.minFontScaleY,Mr=pt.glyphOffset,ur=pt.isSDF,sn=pt.sectionIndex,Jr=ke.vertexLength,hn=Mr[1];$g(ye,N.x,N.y,_t.x,hn+_t.y,mr.x,mr.y,A,ur,er.x,er.y,tr,Yr),$g(ye,N.x,N.y,Pt.x,hn+Pt.y,mr.x+mr.w,mr.y,A,ur,br.x,er.y,tr,Yr),$g(ye,N.x,N.y,Gt.x,hn+Gt.y,mr.x,mr.y+mr.h,A,ur,er.x,br.y,tr,Yr),$g(ye,N.x,N.y,Xt.x,hn+Xt.y,mr.x+mr.w,mr.y+mr.h,A,ur,br.x,br.y,tr,Yr),Qy(a.dynamicLayoutVertexArray,N,Ve),he.emplaceBack(Jr,Jr+1,Jr+2),he.emplaceBack(Jr+1,Jr+2,Jr+3),ke.vertexLength+=4,ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mr[0]),at!==u.length-1&&sn===u[at+1].sectionIndex||a.programConfigurations.populatePaintArrays(ye.length,I,I.index,{},se,qe&&qe[sn])}a.placedSymbolArray.emplaceBack(N.x,N.y,Ue,this.glyphOffsetArray.length-Ue,je,H,q,N.segment,A?A[0]:0,A?A[1]:0,x[0],x[1],D,0,!1,0,ee)},Sn.prototype._addCollisionDebugVertex=function(a,u,A,x,E,I){return u.emplaceBack(0,0),a.emplaceBack(A.x,A.y,x,E,Math.round(I.x),Math.round(I.y))},Sn.prototype.addCollisionDebugVertices=function(a,u,A,x,E,I,D){var N=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),H=N.vertexLength,q=E.layoutVertexArray,ee=E.collisionVertexArray,se=D.anchorX,he=D.anchorY;this._addCollisionDebugVertex(q,ee,I,se,he,new b(a,u)),this._addCollisionDebugVertex(q,ee,I,se,he,new b(A,u)),this._addCollisionDebugVertex(q,ee,I,se,he,new b(A,x)),this._addCollisionDebugVertex(q,ee,I,se,he,new b(a,x)),N.vertexLength+=4;var ye=E.indexArray;ye.emplaceBack(H,H+1),ye.emplaceBack(H+1,H+2),ye.emplaceBack(H+2,H+3),ye.emplaceBack(H+3,H),N.primitiveLength+=4},Sn.prototype.addDebugCollisionBoxes=function(a,u,A,x){for(var E=a;E<u;E++){var I=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(I.x1,I.y1,I.x2,I.y2,x?this.textCollisionBox:this.iconCollisionBox,I.anchorPoint,A)}},Sn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new JA(Wo,aE.members,B),this.iconCollisionBox=new JA(Wo,aE.members,B);for(var a=0;a<this.symbolInstances.length;a++){var u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},Sn.prototype._deserializeCollisionBoxesForSymbol=function(a,u,A,x,E,I,D,N,H){for(var q={},ee=u;ee<A;ee++){var se=a.get(ee);q.textBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},q.textFeatureIndex=se.featureIndex;break}for(var he=x;he<E;he++){var ye=a.get(he);q.verticalTextBox={x1:ye.x1,y1:ye.y1,x2:ye.x2,y2:ye.y2,anchorPointX:ye.anchorPointX,anchorPointY:ye.anchorPointY},q.verticalTextFeatureIndex=ye.featureIndex;break}for(var ke=I;ke<D;ke++){var Ue=a.get(ke);q.iconBox={x1:Ue.x1,y1:Ue.y1,x2:Ue.x2,y2:Ue.y2,anchorPointX:Ue.anchorPointX,anchorPointY:Ue.anchorPointY},q.iconFeatureIndex=Ue.featureIndex;break}for(var je=N;je<H;je++){var Ve=a.get(je);q.verticalIconBox={x1:Ve.x1,y1:Ve.y1,x2:Ve.x2,y2:Ve.y2,anchorPointX:Ve.anchorPointX,anchorPointY:Ve.anchorPointY},q.verticalIconFeatureIndex=Ve.featureIndex;break}return q},Sn.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var A=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,A.textBoxStartIndex,A.textBoxEndIndex,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A.iconBoxStartIndex,A.iconBoxEndIndex,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex))}},Sn.prototype.hasTextData=function(){return this.text.segments.get().length>0},Sn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Sn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Sn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Sn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Sn.prototype.addIndicesForPlacedSymbol=function(a,u){for(var A=a.placedSymbolArray.get(u),x=A.vertexStartIndex+4*A.numGlyphs,E=A.vertexStartIndex;E<x;E+=4)a.indexArray.emplaceBack(E,E+1,E+2),a.indexArray.emplaceBack(E+1,E+2,E+3)},Sn.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(a),A=Math.cos(a),x=[],E=[],I=[],D=0;D<this.symbolInstances.length;++D){I.push(D);var N=this.symbolInstances.get(D);x.push(0|Math.round(u*N.anchorX+A*N.anchorY)),E.push(N.featureIndex)}return I.sort(function(H,q){return x[H]-x[q]||E[q]-E[H]}),I},Sn.prototype.addToSortKeyRanges=function(a,u){var A=this.sortKeyRanges[this.sortKeyRanges.length-1];A&&A.sortKey===u?A.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})},Sn.prototype.sortFeatures=function(a){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var A=0,x=this.symbolInstanceIndexes;A<x.length;A+=1){var E=this.symbolInstances.get(x[A]);this.featureSortOrder.push(E.featureIndex),[E.rightJustifiedTextSymbolIndex,E.centerJustifiedTextSymbolIndex,E.leftJustifiedTextSymbolIndex].forEach(function(I,D,N){I>=0&&N.indexOf(I)===D&&u.addIndicesForPlacedSymbol(u.text,I)}),E.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,E.verticalPlacedTextSymbolIndex),E.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,E.placedIconSymbolIndex),E.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,E.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},nr("SymbolBucket",Sn,{omit:["layers","collisionBoxArray","features","compareText"]}),Sn.MAX_GLYPHS=65535,Sn.addDynamicAttributes=Qy;var LN=new Gn({"symbol-placement":new _r(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new _r(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _r(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new or(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _r(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _r(ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _r(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new _r(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _r(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new or(ce.layout_symbol["icon-size"]),"icon-text-fit":new _r(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _r(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new or(ce.layout_symbol["icon-image"]),"icon-rotate":new or(ce.layout_symbol["icon-rotate"]),"icon-padding":new _r(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new _r(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new or(ce.layout_symbol["icon-offset"]),"icon-anchor":new or(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _r(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _r(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _r(ce.layout_symbol["text-rotation-alignment"]),"text-field":new or(ce.layout_symbol["text-field"]),"text-font":new or(ce.layout_symbol["text-font"]),"text-size":new or(ce.layout_symbol["text-size"]),"text-max-width":new or(ce.layout_symbol["text-max-width"]),"text-line-height":new _r(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new or(ce.layout_symbol["text-letter-spacing"]),"text-justify":new or(ce.layout_symbol["text-justify"]),"text-radial-offset":new or(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _r(ce.layout_symbol["text-variable-anchor"]),"text-anchor":new or(ce.layout_symbol["text-anchor"]),"text-max-angle":new _r(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new _r(ce.layout_symbol["text-writing-mode"]),"text-rotate":new or(ce.layout_symbol["text-rotate"]),"text-padding":new _r(ce.layout_symbol["text-padding"]),"text-keep-upright":new _r(ce.layout_symbol["text-keep-upright"]),"text-transform":new or(ce.layout_symbol["text-transform"]),"text-offset":new or(ce.layout_symbol["text-offset"]),"text-allow-overlap":new _r(ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _r(ce.layout_symbol["text-ignore-placement"]),"text-optional":new _r(ce.layout_symbol["text-optional"])}),ev={paint:new Gn({"icon-opacity":new or(ce.paint_symbol["icon-opacity"]),"icon-color":new or(ce.paint_symbol["icon-color"]),"icon-halo-color":new or(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new or(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new or(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new _r(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new _r(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new or(ce.paint_symbol["text-opacity"]),"text-color":new or(ce.paint_symbol["text-color"],{runtimeType:zt,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new or(ce.paint_symbol["text-halo-color"]),"text-halo-width":new or(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new or(ce.paint_symbol["text-halo-blur"]),"text-translate":new _r(ce.paint_symbol["text-translate"]),"text-translate-anchor":new _r(ce.paint_symbol["text-translate-anchor"])}),layout:LN},Nh=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Ft,this.defaultValue=a};Nh.prototype.evaluate=function(a){if(a.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},Nh.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},Nh.prototype.outputDefined=function(){return!1},Nh.prototype.serialize=function(){return null},nr("FormatSectionOverride",Nh,{omit:["defaultValue"]});var NN=function(a){function u(A){a.call(this,A,ev)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(A,x){if(a.prototype.recalculate.call(this,A,x),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var E=this.layout.get("text-writing-mode");if(E){for(var I=[],D=0,N=E;D<N.length;D+=1){var H=N[D];I.indexOf(H)<0&&I.push(H)}this.layout._values["text-writing-mode"]=I}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(A,x,E,I){var D=this.layout.get(A).evaluate(x,{},E,I),N=this._unevaluatedLayout._values[A];return N.isDataDriven()||uo(N.value)||!D?D:function(H,q){return q.replace(/{([^{}]+)}/g,function(ee,se){return se in H?String(H[se]):""})}(x.properties,D)},u.prototype.createBucket=function(A){return new Sn(A)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var A=0,x=ev.paint.overridableProperties;A<x.length;A+=1){var E=x[A];if(u.hasPaintOverride(this.layout,E)){var I,D=this.paint.get(E),N=new Nh(D),H=new Aa(N,D.property.specification);I=D.value.kind==="constant"||D.value.kind==="source"?new La("source",H):new mc("composite",H,D.value.zoomStops,D.value._interpolationType),this.paint._values[E]=new Zi(D.property,I,D.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(A,x,E){return!(!this.layout||x.isDataDriven()||E.isDataDriven())&&u.hasPaintOverride(this.layout,A)},u.hasPaintOverride=function(A,x){var E=A.get("text-field"),I=ev.paint.properties[x],D=!1,N=function(ee){for(var se=0,he=ee;se<he.length;se+=1)if(I.overrides&&I.overrides.hasOverride(he[se]))return void(D=!0)};if(E.value.kind==="constant"&&E.value.value instanceof ri)N(E.value.value.sections);else if(E.value.kind==="source"){var H=function(ee){D||(ee instanceof Si&&Un(ee.value)===en?N(ee.value.sections):ee instanceof ls?N(ee.sections):ee.eachChild(H))},q=E.value;q._styleExpression&&H(q._styleExpression.expression)}return D},u}(Dr),kN={paint:new Gn({"background-color":new _r(ce.paint_background["background-color"]),"background-pattern":new ns(ce.paint_background["background-pattern"]),"background-opacity":new _r(ce.paint_background["background-opacity"])})},UN=function(a){function u(A){a.call(this,A,kN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Dr),zN={paint:new Gn({"raster-opacity":new _r(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new _r(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _r(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _r(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new _r(ce.paint_raster["raster-saturation"]),"raster-contrast":new _r(ce.paint_raster["raster-contrast"]),"raster-resampling":new _r(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new _r(ce.paint_raster["raster-fade-duration"])})},GN=function(a){function u(A){a.call(this,A,zN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Dr),VN=function(a){function u(A){a.call(this,A,{}),this.implementation=A}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(A){this.implementation.onAdd&&this.implementation.onAdd(A,A.painter.context.gl)},u.prototype.onRemove=function(A){this.implementation.onRemove&&this.implementation.onRemove(A,A.painter.context.gl)},u}(Dr),HN={circle:ky,heatmap:T8,hillshade:S8,fill:J8,"fill-extrusion":eN,line:oN,symbol:NN,background:UN,raster:GN},ME=S.HTMLImageElement,PE=S.HTMLCanvasElement,RE=S.HTMLVideoElement,FE=S.ImageData,Kg=S.ImageBitmap,bf=function(a,u,A,x){this.context=a,this.format=A,this.texture=a.gl.createTexture(),this.update(u,x)};bf.prototype.update=function(a,u,A){var x=a.width,E=a.height,I=!(this.size&&this.size[0]===x&&this.size[1]===E||A),D=this.context,N=D.gl;if(this.useMipmap=!!(u&&u.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!u||u.premultiply!==!1)),I)this.size=[x,E],a instanceof ME||a instanceof PE||a instanceof RE||a instanceof FE||Kg&&a instanceof Kg?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,a):N.texImage2D(N.TEXTURE_2D,0,this.format,x,E,0,this.format,N.UNSIGNED_BYTE,a.data);else{var H=A||{x:0,y:0},q=H.x,ee=H.y;a instanceof ME||a instanceof PE||a instanceof RE||a instanceof FE||Kg&&a instanceof Kg?N.texSubImage2D(N.TEXTURE_2D,0,q,ee,N.RGBA,N.UNSIGNED_BYTE,a):N.texSubImage2D(N.TEXTURE_2D,0,q,ee,x,E,N.RGBA,N.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)},bf.prototype.bind=function(a,u,A){var x=this.context.gl;x.bindTexture(x.TEXTURE_2D,this.texture),A!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(A=x.LINEAR),a!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,A||a),this.filter=a),u!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,u),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,u),this.wrap=u)},bf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},bf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var tv=function(a){var u=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};tv.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},tv.prototype.remove=function(){delete this._channel,this._callback=function(){}};var kh=function(a,u,A){this.target=a,this.parent=u,this.mapId=A,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Te(["receive","process"],this),this.invoker=new tv(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ce()?a:S};function DE(a,u,A){var x=2*Math.PI*6378137/256/Math.pow(2,A);return[a*x-2*Math.PI*6378137/2,u*x-2*Math.PI*6378137/2]}kh.prototype.send=function(a,u,A,x,E){var I=this;E===void 0&&(E=!1);var D=Math.round(1e18*Math.random()).toString(36).substring(0,10);A&&(this.callbacks[D]=A);var N=Qe(this.globalScope)?void 0:[];return this.target.postMessage({id:D,type:a,hasCallback:!!A,targetMapId:x,mustQueue:E,sourceMapId:this.mapId,data:Js(u,N)},N),{cancel:function(){A&&delete I.callbacks[D],I.target.postMessage({id:D,type:"<cancel>",targetMapId:x,sourceMapId:I.mapId})}}},kh.prototype.receive=function(a){var u=a.data,A=u.id;if(A&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[A];var x=this.cancelCallbacks[A];delete this.cancelCallbacks[A],x&&x()}else Ce()||u.mustQueue?(this.tasks[A]=u,this.taskQueue.push(A),this.invoker.trigger()):this.processTask(A,u)},kh.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),u=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(a,u)}},kh.prototype.processTask=function(a,u){var A=this;if(u.type==="<response>"){var x=this.callbacks[a];delete this.callbacks[a],x&&(u.error?x(us(u.error)):x(null,us(u.data)))}else{var E=!1,I=Qe(this.globalScope)?void 0:[],D=u.hasCallback?function(ee,se){E=!0,delete A.cancelCallbacks[a],A.target.postMessage({id:a,type:"<response>",sourceMapId:A.mapId,error:ee?Js(ee):null,data:Js(se,I)},I)}:function(ee){E=!0},N=null,H=us(u.data);if(this.parent[u.type])N=this.parent[u.type](u.sourceMapId,H,D);else if(this.parent.getWorkerSource){var q=u.type.split(".");N=this.parent.getWorkerSource(u.sourceMapId,q[0],H.source)[q[1]](H,D)}else D(new Error("Could not find function "+u.type));!E&&N&&N.cancel&&(this.cancelCallbacks[a]=N.cancel)}},kh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Oi=function(a,u){a&&(u?this.setSouthWest(a).setNorthEast(u):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};Oi.prototype.setNorthEast=function(a){return this._ne=a instanceof qn?new qn(a.lng,a.lat):qn.convert(a),this},Oi.prototype.setSouthWest=function(a){return this._sw=a instanceof qn?new qn(a.lng,a.lat):qn.convert(a),this},Oi.prototype.extend=function(a){var u,A,x=this._sw,E=this._ne;if(a instanceof qn)u=a,A=a;else{if(!(a instanceof Oi))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Oi.convert(a)):this.extend(qn.convert(a)):this;if(A=a._ne,!(u=a._sw)||!A)return this}return x||E?(x.lng=Math.min(u.lng,x.lng),x.lat=Math.min(u.lat,x.lat),E.lng=Math.max(A.lng,E.lng),E.lat=Math.max(A.lat,E.lat)):(this._sw=new qn(u.lng,u.lat),this._ne=new qn(A.lng,A.lat)),this},Oi.prototype.getCenter=function(){return new qn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Oi.prototype.getSouthWest=function(){return this._sw},Oi.prototype.getNorthEast=function(){return this._ne},Oi.prototype.getNorthWest=function(){return new qn(this.getWest(),this.getNorth())},Oi.prototype.getSouthEast=function(){return new qn(this.getEast(),this.getSouth())},Oi.prototype.getWest=function(){return this._sw.lng},Oi.prototype.getSouth=function(){return this._sw.lat},Oi.prototype.getEast=function(){return this._ne.lng},Oi.prototype.getNorth=function(){return this._ne.lat},Oi.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Oi.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Oi.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Oi.prototype.contains=function(a){var u=qn.convert(a),A=u.lng,x=u.lat,E=this._sw.lng<=A&&A<=this._ne.lng;return this._sw.lng>this._ne.lng&&(E=this._sw.lng>=A&&A>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&E},Oi.convert=function(a){return!a||a instanceof Oi?a:new Oi(a)};var qn=function(a,u){if(isNaN(a)||isNaN(u))throw new Error("Invalid LngLat object: ("+a+", "+u+")");if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};qn.prototype.wrap=function(){return new qn(z(this.lng,-180,180),this.lat)},qn.prototype.toArray=function(){return[this.lng,this.lat]},qn.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},qn.prototype.distanceTo=function(a){var u=Math.PI/180,A=this.lat*u,x=a.lat*u,E=Math.sin(A)*Math.sin(x)+Math.cos(A)*Math.cos(x)*Math.cos((a.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(E,1))},qn.prototype.toBounds=function(a){a===void 0&&(a=0);var u=360*a/40075017,A=u/Math.cos(Math.PI/180*this.lat);return new Oi(new qn(this.lng-A,this.lat-u),new qn(this.lng+A,this.lat+u))},qn.convert=function(a){if(a instanceof qn)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new qn(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new qn(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var OE=2*Math.PI*63710088e-1;function LE(a){return OE*Math.cos(a*Math.PI/180)}function NE(a){return(180+a)/360}function kE(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function UE(a,u){return a/LE(u)}function rv(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var xf=function(a,u,A){A===void 0&&(A=0),this.x=+a,this.y=+u,this.z=+A};xf.fromLngLat=function(a,u){u===void 0&&(u=0);var A=qn.convert(a);return new xf(NE(A.lng),kE(A.lat),UE(u,A.lat))},xf.prototype.toLngLat=function(){return new qn(360*this.x-180,rv(this.y))},xf.prototype.toAltitude=function(){return this.z*LE(rv(this.y))},xf.prototype.meterInMercatorCoordinateUnits=function(){return 1/OE*(a=rv(this.y),1/Math.cos(a*Math.PI/180));var a};var wf=function(a,u,A){this.z=a,this.x=u,this.y=A,this.key=WA(0,a,a,u,A)};wf.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},wf.prototype.url=function(a,u){var A,x,E,I,D,N=(x=this.y,E=this.z,I=DE(256*(A=this.x),256*(x=Math.pow(2,E)-x-1),E),D=DE(256*(A+1),256*(x+1),E),I[0]+","+I[1]+","+D[0]+","+D[1]),H=function(q,ee,se){for(var he,ye="",ke=q;ke>0;ke--)ye+=(ee&(he=1<<ke-1)?1:0)+(se&he?2:0);return ye}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",H).replace("{bbox-epsg-3857}",N)},wf.prototype.getTilePoint=function(a){var u=Math.pow(2,this.z);return new b(8192*(a.x*u-this.x),8192*(a.y*u-this.y))},wf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var zE=function(a,u){this.wrap=a,this.canonical=u,this.key=WA(a,u.z,u.z,u.x,u.y)},Li=function(a,u,A,x,E){this.overscaledZ=a,this.wrap=u,this.canonical=new wf(A,+x,+E),this.key=WA(u,a,A,x,E)};function WA(a,u,A,x,E){(a*=2)<0&&(a=-1*a-1);var I=1<<A;return(I*I*a+I*E+x).toString(36)+A.toString(36)+u.toString(36)}Li.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},Li.prototype.scaledTo=function(a){var u=this.canonical.z-a;return a>this.canonical.z?new Li(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Li(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)},Li.prototype.calculateScaledKey=function(a,u){var A=this.canonical.z-a;return a>this.canonical.z?WA(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):WA(this.wrap*+u,a,a,this.canonical.x>>A,this.canonical.y>>A)},Li.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u},Li.prototype.children=function(a){if(this.overscaledZ>=a)return[new Li(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,A=2*this.canonical.x,x=2*this.canonical.y;return[new Li(u,this.wrap,u,A,x),new Li(u,this.wrap,u,A+1,x),new Li(u,this.wrap,u,A,x+1),new Li(u,this.wrap,u,A+1,x+1)]},Li.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},Li.prototype.wrapped=function(){return new Li(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Li.prototype.unwrapTo=function(a){return new Li(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},Li.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Li.prototype.toUnwrapped=function(){return new zE(this.wrap,this.canonical)},Li.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Li.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new xf(a.x-this.wrap,a.y))},nr("CanonicalTileID",wf),nr("OverscaledTileID",Li,{omit:["posMatrix"]});var vl=function(a,u,A){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(A&&A!=="mapbox"&&A!=="terrarium")return ne('"'+A+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var x=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=A||"mapbox";for(var E=0;E<x;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(x,E)]=this.data[this._idx(x-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,x)]=this.data[this._idx(E,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)]};vl.prototype.get=function(a,u){var A=new Uint8Array(this.data.buffer),x=4*this._idx(a,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(A[x],A[x+1],A[x+2])},vl.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},vl.prototype._idx=function(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)},vl.prototype._unpackMapbox=function(a,u,A){return(256*a*256+256*u+A)/10-1e4},vl.prototype._unpackTerrarium=function(a,u,A){return 256*a+u+A/256-32768},vl.prototype.getPixels=function(){return new Zs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},vl.prototype.backfillBorder=function(a,u,A){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var x=u*this.dim,E=u*this.dim+this.dim,I=A*this.dim,D=A*this.dim+this.dim;switch(u){case-1:x=E-1;break;case 1:E=x+1}switch(A){case-1:I=D-1;break;case 1:D=I+1}for(var N=-u*this.dim,H=-A*this.dim,q=I;q<D;q++)for(var ee=x;ee<E;ee++)this.data[this._idx(ee,q)]=a.data[this._idx(ee+N,q+H)]},nr("DEMData",vl);var qg=function(a){this._stringToNumber={},this._numberToString=[];for(var u=0;u<a.length;u++){var A=a[u];this._stringToNumber[A]=u,this._numberToString[u]=A}};qg.prototype.encode=function(a){return this._stringToNumber[a]},qg.prototype.decode=function(a){return this._numberToString[a]};var Zg=function(a,u,A,x,E){this.type="Feature",this._vectorTileFeature=a,a._z=u,a._x=A,a._y=x,this.properties=a.properties,this.id=E},nv={geometry:{configurable:!0}};nv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},nv.geometry.set=function(a){this._geometry=a},Zg.prototype.toJSON=function(){var a={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(a[u]=this[u]);return a},Object.defineProperties(Zg.prototype,nv);var Uh=function(){this.state={},this.stateChanges={},this.deletedStates={}};Uh.prototype.updateState=function(a,u,A){var x=String(u);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][x]=this.stateChanges[a][x]||{},V(this.stateChanges[a][x],A),this.deletedStates[a]===null)for(var E in this.deletedStates[a]={},this.state[a])E!==x&&(this.deletedStates[a][E]=null);else if(this.deletedStates[a]&&this.deletedStates[a][x]===null)for(var I in this.deletedStates[a][x]={},this.state[a][x])A[I]||(this.deletedStates[a][x][I]=null);else for(var D in A)this.deletedStates[a]&&this.deletedStates[a][x]&&this.deletedStates[a][x][D]===null&&delete this.deletedStates[a][x][D]},Uh.prototype.removeFeatureState=function(a,u,A){if(this.deletedStates[a]!==null){var x=String(u);if(this.deletedStates[a]=this.deletedStates[a]||{},A&&u!==void 0)this.deletedStates[a][x]!==null&&(this.deletedStates[a][x]=this.deletedStates[a][x]||{},this.deletedStates[a][x][A]=null);else if(u!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][x])for(A in this.deletedStates[a][x]={},this.stateChanges[a][x])this.deletedStates[a][x][A]=null;else this.deletedStates[a][x]=null;else this.deletedStates[a]=null}},Uh.prototype.getState=function(a,u){var A=String(u),x=V({},(this.state[a]||{})[A],(this.stateChanges[a]||{})[A]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var E=this.deletedStates[a][u];if(E===null)return{};for(var I in E)delete x[I]}return x},Uh.prototype.initializeTileState=function(a,u){a.setFeatureState(this.state,u)},Uh.prototype.coalesceChanges=function(a,u){var A={};for(var x in this.stateChanges){this.state[x]=this.state[x]||{};var E={};for(var I in this.stateChanges[x])this.state[x][I]||(this.state[x][I]={}),V(this.state[x][I],this.stateChanges[x][I]),E[I]=this.state[x][I];A[x]=E}for(var D in this.deletedStates){this.state[D]=this.state[D]||{};var N={};if(this.deletedStates[D]===null)for(var H in this.state[D])N[H]={},this.state[D][H]={};else for(var q in this.deletedStates[D]){if(this.deletedStates[D][q]===null)this.state[D][q]={};else for(var ee=0,se=Object.keys(this.deletedStates[D][q]);ee<se.length;ee+=1)delete this.state[D][q][se[ee]];N[q]=this.state[D][q]}A[D]=A[D]||{},V(A[D],N)}if(this.stateChanges={},this.deletedStates={},Object.keys(A).length!==0)for(var he in a)a[he].setFeatureState(A,u)};var bl=function(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new vo(8192,16,0),this.grid3D=new vo(8192,16,0),this.featureIndexArray=new $,this.promoteId=u};function GE(a,u,A,x,E){return Ae(a,function(I,D){var N=u instanceof pl?u.get(D):null;return N&&N.evaluate?N.evaluate(A,x,E):N})}function VE(a){for(var u=1/0,A=1/0,x=-1/0,E=-1/0,I=0,D=a;I<D.length;I+=1){var N=D[I];u=Math.min(u,N.x),A=Math.min(A,N.y),x=Math.max(x,N.x),E=Math.max(E,N.y)}return{minX:u,minY:A,maxX:x,maxY:E}}function jN(a,u){return u-a}bl.prototype.insert=function(a,u,A,x,E,I){var D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(A,x,E);for(var N=I?this.grid3D:this.grid,H=0;H<u.length;H++){for(var q=u[H],ee=[1/0,1/0,-1/0,-1/0],se=0;se<q.length;se++){var he=q[se];ee[0]=Math.min(ee[0],he.x),ee[1]=Math.min(ee[1],he.y),ee[2]=Math.max(ee[2],he.x),ee[3]=Math.max(ee[3],he.y)}ee[0]<8192&&ee[1]<8192&&ee[2]>=0&&ee[3]>=0&&N.insert(D,ee[0],ee[1],ee[2],ee[3])}},bl.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ih.VectorTile(new Ug(this.rawTileData)).layers,this.sourceLayerCoder=new qg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},bl.prototype.query=function(a,u,A,x){var E=this;this.loadVTLayers();for(var I=a.params||{},D=8192/a.tileSize/a.scale,N=nu(I.filter),H=a.queryGeometry,q=a.queryPadding*D,ee=VE(H),se=this.grid.query(ee.minX-q,ee.minY-q,ee.maxX+q,ee.maxY+q),he=VE(a.cameraQueryGeometry),ye=this.grid3D.query(he.minX-q,he.minY-q,he.maxX+q,he.maxY+q,function(pt,_t,Pt,Gt){return function(Xt,mr,er,br,tr){for(var Yr=0,Mr=Xt;Yr<Mr.length;Yr+=1){var ur=Mr[Yr];if(mr<=ur.x&&er<=ur.y&&br>=ur.x&&tr>=ur.y)return!0}var sn=[new b(mr,er),new b(mr,tr),new b(br,tr),new b(br,er)];if(Xt.length>2){for(var Jr=0,hn=sn;Jr<hn.length;Jr+=1)if(ga(Xt,hn[Jr]))return!0}for(var xr=0;xr<Xt.length-1;xr++)if(_f(Xt[xr],Xt[xr+1],sn))return!0;return!1}(a.cameraQueryGeometry,pt-q,_t-q,Pt+q,Gt+q)}),ke=0,Ue=ye;ke<Ue.length;ke+=1)se.push(Ue[ke]);se.sort(jN);for(var je,Ve={},qe=function(pt){var _t=se[pt];if(_t!==je){je=_t;var Pt=E.featureIndexArray.get(_t),Gt=null;E.loadMatchingFeature(Ve,Pt.bucketIndex,Pt.sourceLayerIndex,Pt.featureIndex,N,I.layers,I.availableImages,u,A,x,function(Xt,mr,er){return Gt||(Gt=Ai(Xt)),mr.queryIntersectsFeature(H,Xt,er,Gt,E.z,a.transform,D,a.pixelPosMatrix)})}},at=0;at<se.length;at++)qe(at);return Ve},bl.prototype.loadMatchingFeature=function(a,u,A,x,E,I,D,N,H,q,ee){var se=this.bucketLayerIDs[u];if(!I||function(Xt,mr){for(var er=0;er<Xt.length;er++)if(mr.indexOf(Xt[er])>=0)return!0;return!1}(I,se)){var he=this.sourceLayerCoder.decode(A),ye=this.vtLayers[he].feature(x);if(E.needGeometry){var ke=Ci(ye,!0);if(!E.filter(new Nr(this.tileID.overscaledZ),ke,this.tileID.canonical))return}else if(!E.filter(new Nr(this.tileID.overscaledZ),ye))return;for(var Ue=this.getId(ye,he),je=0;je<se.length;je++){var Ve=se[je];if(!(I&&I.indexOf(Ve)<0)){var qe=N[Ve];if(qe){var at={};Ue!==void 0&&q&&(at=q.getState(qe.sourceLayer||"_geojsonTileLayer",Ue));var pt=V({},H[Ve]);pt.paint=GE(pt.paint,qe.paint,ye,at,D),pt.layout=GE(pt.layout,qe.layout,ye,at,D);var _t=!ee||ee(ye,qe,at);if(_t){var Pt=new Zg(ye,this.z,this.x,this.y,Ue);Pt.layer=pt;var Gt=a[Ve];Gt===void 0&&(Gt=a[Ve]=[]),Gt.push({featureIndex:x,feature:Pt,intersectionZ:_t})}}}}}},bl.prototype.lookupSymbolFeatures=function(a,u,A,x,E,I,D,N){var H={};this.loadVTLayers();for(var q=nu(E),ee=0,se=a;ee<se.length;ee+=1)this.loadMatchingFeature(H,A,x,se[ee],q,I,D,N,u);return H},bl.prototype.hasLayer=function(a){for(var u=0,A=this.bucketLayerIDs;u<A.length;u+=1)for(var x=0,E=A[u];x<E.length;x+=1)if(a===E[x])return!0;return!1},bl.prototype.getId=function(a,u){var A=a.id;return this.promoteId&&typeof(A=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(A=Number(A)),A},nr("FeatureIndex",bl,{omit:["rawTileData","sourceLayerCoder"]});var es=function(a,u){this.tileID=a,this.uid=fe(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};es.prototype.registerFadeDuration=function(a){var u=a+this.timeAdded;u<Jt.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},es.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},es.prototype.loadVectorData=function(a,u,A){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var x in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(q,ee){var se={};if(!ee)return se;for(var he=function(){var Ue=ke[ye],je=Ue.layerIds.map(function(at){return ee.getLayer(at)}).filter(Boolean);if(je.length!==0){Ue.layers=je,Ue.stateDependentLayerIds&&(Ue.stateDependentLayers=Ue.stateDependentLayerIds.map(function(at){return je.filter(function(pt){return pt.id===at})[0]}));for(var Ve=0,qe=je;Ve<qe.length;Ve+=1)se[qe[Ve].id]=Ue}},ye=0,ke=q;ye<ke.length;ye+=1)he();return se}(a.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var E=this.buckets[x];if(E instanceof Sn){if(this.hasSymbolBuckets=!0,!A)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var I in this.buckets){var D=this.buckets[I];if(D instanceof Sn&&D.hasRTLText){this.hasRTLText=!0,qi.isLoading()||qi.isLoaded()||Af()!=="deferred"||fo();break}}for(var N in this.queryPadding=0,this.buckets){var H=this.buckets[N];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(N).queryRadius(H))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},es.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},es.prototype.getBucket=function(a){return this.buckets[a.id]},es.prototype.upload=function(a){for(var u in this.buckets){var A=this.buckets[u];A.uploadPending()&&A.upload(a)}var x=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new bf(a,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new bf(a,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)},es.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},es.prototype.queryRenderedFeatures=function(a,u,A,x,E,I,D,N,H,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:E,scale:I,tileSize:this.tileSize,pixelPosMatrix:q,transform:N,params:D,queryPadding:this.queryPadding*H},a,u,A):{}},es.prototype.querySourceFeatures=function(a,u){var A=this.latestFeatureIndex;if(A&&A.rawTileData){var x=A.loadVTLayers(),E=u?u.sourceLayer:"",I=x._geojsonTileLayer||x[E];if(I)for(var D=nu(u&&u.filter),N=this.tileID.canonical,H=N.z,q=N.x,ee=N.y,se={z:H,x:q,y:ee},he=0;he<I.length;he++){var ye=I.feature(he);if(D.needGeometry){var ke=Ci(ye,!0);if(!D.filter(new Nr(this.tileID.overscaledZ),ke,this.tileID.canonical))continue}else if(!D.filter(new Nr(this.tileID.overscaledZ),ye))continue;var Ue=A.getId(ye,E),je=new Zg(ye,H,q,ee,Ue);je.tile=se,a.push(je)}}},es.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},es.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},es.prototype.setExpiryData=function(a){var u=this.expirationTime;if(a.cacheControl){var A=Ne(a.cacheControl);A["max-age"]&&(this.expirationTime=Date.now()+1e3*A["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var x=Date.now(),E=!1;if(this.expirationTime>x)E=!1;else if(u)if(this.expirationTime<u)E=!0;else{var I=this.expirationTime-u;I?this.expirationTime=x+Math.max(I,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},es.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},es.prototype.setFeatureState=function(a,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var A=this.latestFeatureIndex.loadVTLayers();for(var x in this.buckets)if(u.style.hasLayer(x)){var E=this.buckets[x],I=E.layers[0].sourceLayer||"_geojsonTileLayer",D=A[I],N=a[I];if(D&&N&&Object.keys(N).length!==0){E.update(N,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});var H=u&&u.style&&u.style.getLayer(x);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(E)))}}}},es.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},es.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Jt.now()},es.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},es.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Jt.now()+a},es.prototype.setDependencies=function(a,u){for(var A={},x=0,E=u;x<E.length;x+=1)A[E[x]]=!0;this.dependencies[a]=A},es.prototype.hasDependency=function(a,u){for(var A=0,x=a;A<x.length;A+=1){var E=this.dependencies[x[A]];if(E){for(var I=0,D=u;I<D.length;I+=1)if(E[D[I]])return!0}}return!1};var mu=S.performance,HE=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},mu.mark(this._marks.start)};HE.prototype.finish=function(){mu.mark(this._marks.end);var a=mu.getEntriesByName(this._marks.measure);return a.length===0&&(mu.measure(this._marks.measure,this._marks.start,this._marks.end),a=mu.getEntriesByName(this._marks.measure),mu.clearMarks(this._marks.start),mu.clearMarks(this._marks.end),mu.clearMeasures(this._marks.measure)),a},s.Actor=kh,s.AlphaImage=vf,s.CanonicalTileID=wf,s.CollisionBoxArray=d,s.Color=Kr,s.DEMData=vl,s.DataConstantProperty=_r,s.DictionaryCoder=qg,s.EXTENT=8192,s.ErrorEvent=de,s.EvaluationParameters=Nr,s.Event=Oe,s.Evented=be,s.FeatureIndex=bl,s.FillBucket=ja,s.FillExtrusionBucket=Ja,s.ImageAtlas=jA,s.ImagePosition=Gg,s.LineBucket=Ns,s.LngLat=qn,s.LngLatBounds=Oi,s.MercatorCoordinate=xf,s.ONE_EM=24,s.OverscaledTileID=Li,s.Point=b,s.Point$1=b,s.Properties=Gn,s.Protobuf=Ug,s.RGBAImage=Zs,s.RequestManager=hr,s.RequestPerformance=HE,s.ResourceType=kt,s.SegmentVector=Y,s.SourceFeatureState=Uh,s.StructArrayLayout1ui2=M,s.StructArrayLayout2f1f2i16=xo,s.StructArrayLayout2i4=Ds,s.StructArrayLayout3ui6=$o,s.StructArrayLayout4i8=pf,s.SymbolBucket=Sn,s.Texture=bf,s.Tile=es,s.Transitionable=zi,s.Uniform1f=Rt,s.Uniform1i=ht,s.Uniform2f=xt,s.Uniform3f=Nt,s.Uniform4f=rr,s.UniformColor=vr,s.UniformMatrix4f=pn,s.UnwrappedTileID=zE,s.ValidationError=Se,s.WritingMode=Co,s.ZoomHistory=uf,s.add=function(a,u,A){return a[0]=u[0]+A[0],a[1]=u[1]+A[1],a[2]=u[2]+A[2],a},s.addDynamicAttributes=Qy,s.asyncAll=function(a,u,A){if(!a.length)return A(null,[]);var x=a.length,E=new Array(a.length),I=null;a.forEach(function(D,N){u(D,function(H,q){H&&(I=H),E[N]=q,--x==0&&A(I,E)})})},s.bezier=k,s.bindAll=Te,s.browser=Jt,s.cacheEntryPossiblyAdded=function(a){++Mt>Ot&&(a.getActor().send("enforceCacheSizeLimit",Pe),Mt=0)},s.clamp=j,s.clearTileCache=function(a){var u=S.caches.delete("mapbox-tiles");a&&u.catch(a).then(function(){return a()})},s.clipLine=CE,s.clone=function(a){var u=new yn(16);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u},s.clone$1=pe,s.clone$2=function(a){var u=new yn(3);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u},s.collisionCircleLayout=uN,s.config=Lt,s.create=function(){var a=new yn(16);return yn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},s.create$1=function(){var a=new yn(9);return yn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},s.create$2=function(){var a=new yn(4);return yn!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},s.createCommonjsModule=c,s.createExpression=tu,s.createLayout=Mi,s.createStyleLayer=function(a){return a.type==="custom"?new VN(a):new HN[a.type](a)},s.cross=function(a,u,A){var x=u[0],E=u[1],I=u[2],D=A[0],N=A[1],H=A[2];return a[0]=E*H-I*N,a[1]=I*D-x*H,a[2]=x*N-E*D,a},s.deepEqual=function a(u,A){if(Array.isArray(u)){if(!Array.isArray(A)||u.length!==A.length)return!1;for(var x=0;x<u.length;x++)if(!a(u[x],A[x]))return!1;return!0}if(typeof u=="object"&&u!==null&&A!==null){if(typeof A!="object"||Object.keys(u).length!==Object.keys(A).length)return!1;for(var E in u)if(!a(u[E],A[E]))return!1;return!0}return u===A},s.dot=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]},s.dot$1=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]},s.ease=U,s.emitValidationErrors=Al,s.endsWith=ze,s.enforceCacheSizeLimit=function(a){Vt(),vn&&vn.then(function(u){u.keys().then(function(A){for(var x=0;x<A.length-a;x++)u.delete(A[x])})})},s.evaluateSizeForFeature=_E,s.evaluateSizeForZoom=yE,s.evaluateVariableOffset=BE,s.evented=yi,s.extend=V,s.featureFilter=nu,s.filterObject=_e,s.fromRotation=function(a,u){var A=Math.sin(u),x=Math.cos(u);return a[0]=x,a[1]=A,a[2]=0,a[3]=-A,a[4]=x,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},s.getAnchorAlignment=Ky,s.getAnchorJustification=Yy,s.getArrayBuffer=Xe,s.getImage=ie,s.getJSON=function(a,u){return Ee(V(a,{type:"json"}),u)},s.getRTLTextPluginStatus=Af,s.getReferrer=W,s.getVideo=function(a,u){var A,x,E=S.document.createElement("video");E.muted=!0,E.onloadstart=function(){u(null,E)};for(var I=0;I<a.length;I++){var D=S.document.createElement("source");A=a[I],x=void 0,(x=S.document.createElement("a")).href=A,(x.protocol!==S.document.location.protocol||x.host!==S.document.location.host)&&(E.crossOrigin="Anonymous"),D.src=a[I],E.appendChild(D)}return{cancel:function(){}}},s.identity=po,s.invert=function(a,u){var A=u[0],x=u[1],E=u[2],I=u[3],D=u[4],N=u[5],H=u[6],q=u[7],ee=u[8],se=u[9],he=u[10],ye=u[11],ke=u[12],Ue=u[13],je=u[14],Ve=u[15],qe=A*N-x*D,at=A*H-E*D,pt=A*q-I*D,_t=x*H-E*N,Pt=x*q-I*N,Gt=E*q-I*H,Xt=ee*Ue-se*ke,mr=ee*je-he*ke,er=ee*Ve-ye*ke,br=se*je-he*Ue,tr=se*Ve-ye*Ue,Yr=he*Ve-ye*je,Mr=qe*Yr-at*tr+pt*br+_t*er-Pt*mr+Gt*Xt;return Mr?(a[0]=(N*Yr-H*tr+q*br)*(Mr=1/Mr),a[1]=(E*tr-x*Yr-I*br)*Mr,a[2]=(Ue*Gt-je*Pt+Ve*_t)*Mr,a[3]=(he*Pt-se*Gt-ye*_t)*Mr,a[4]=(H*er-D*Yr-q*mr)*Mr,a[5]=(A*Yr-E*er+I*mr)*Mr,a[6]=(je*pt-ke*Gt-Ve*at)*Mr,a[7]=(ee*Gt-he*pt+ye*at)*Mr,a[8]=(D*tr-N*er+q*Xt)*Mr,a[9]=(x*er-A*tr-I*Xt)*Mr,a[10]=(ke*Pt-Ue*pt+Ve*qe)*Mr,a[11]=(se*pt-ee*Pt-ye*qe)*Mr,a[12]=(N*mr-D*br-H*Xt)*Mr,a[13]=(A*br-x*mr+E*Xt)*Mr,a[14]=(Ue*at-ke*_t-je*qe)*Mr,a[15]=(ee*_t-se*at+he*qe)*Mr,a):null},s.isChar=Kt,s.isMapboxURL=pr,s.keysDifference=function(a,u){var A=[];for(var x in a)x in u||A.push(x);return A},s.makeRequest=Ee,s.mapObject=Ae,s.mercatorXfromLng=NE,s.mercatorYfromLat=kE,s.mercatorZfromAltitude=UE,s.mul=Ny,s.multiply=Ls,s.mvt=Ih,s.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},s.normalize=function(a,u){var A=u[0],x=u[1],E=u[2],I=A*A+x*x+E*E;return I>0&&(I=1/Math.sqrt(I)),a[0]=u[0]*I,a[1]=u[1]*I,a[2]=u[2]*I,a},s.number=si,s.offscreenCanvasSupported=ge,s.ortho=function(a,u,A,x,E,I,D){var N=1/(u-A),H=1/(x-E),q=1/(I-D);return a[0]=-2*N,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*H,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*q,a[11]=0,a[12]=(u+A)*N,a[13]=(E+x)*H,a[14]=(D+I)*q,a[15]=1,a},s.parseGlyphPBF=function(a){return new Ug(a).readFields(bN,[])},s.pbf=Ug,s.performSymbolLayout=function(a,u,A,x,E,I,D){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var N=a.layers[0].layout,H=a.layers[0]._unevaluatedLayout._values,q={};if(a.textSizeData.kind==="composite"){var ee=a.textSizeData,se=ee.maxZoom;q.compositeTextSizes=[H["text-size"].possiblyEvaluate(new Nr(ee.minZoom),D),H["text-size"].possiblyEvaluate(new Nr(se),D)]}if(a.iconSizeData.kind==="composite"){var he=a.iconSizeData,ye=he.maxZoom;q.compositeIconSizes=[H["icon-size"].possiblyEvaluate(new Nr(he.minZoom),D),H["icon-size"].possiblyEvaluate(new Nr(ye),D)]}q.layoutTextSize=H["text-size"].possiblyEvaluate(new Nr(a.zoom+1),D),q.layoutIconSize=H["icon-size"].possiblyEvaluate(new Nr(a.zoom+1),D),q.textMaxSize=H["text-size"].possiblyEvaluate(new Nr(18));for(var ke=24*N.get("text-line-height"),Ue=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",je=N.get("text-keep-upright"),Ve=N.get("text-size"),qe=function(){var _t=pt[at],Pt=N.get("text-font").evaluate(_t,{},D).join(","),Gt=Ve.evaluate(_t,{},D),Xt=q.layoutTextSize.evaluate(_t,{},D),mr=q.layoutIconSize.evaluate(_t,{},D),er={horizontal:{},vertical:void 0},br=_t.text,tr=[0,0];if(br){var Yr=br.toString(),Mr=24*N.get("text-letter-spacing").evaluate(_t,{},D),ur=function(ln){for(var Fn=0,Cn=ln;Fn<Cn.length;Fn+=1)if(gn=Cn[Fn].charCodeAt(0),Kt.Arabic(gn)||Kt["Arabic Supplement"](gn)||Kt["Arabic Extended-A"](gn)||Kt["Arabic Presentation Forms-A"](gn)||Kt["Arabic Presentation Forms-B"](gn))return!1;var gn;return!0}(Yr)?Mr:0,sn=N.get("text-anchor").evaluate(_t,{},D),Jr=N.get("text-variable-anchor");if(!Jr){var hn=N.get("text-radial-offset").evaluate(_t,{},D);tr=hn?BE(sn,[24*hn,Zy]):N.get("text-offset").evaluate(_t,{},D).map(function(ln){return 24*ln})}var xr=Ue?"center":N.get("text-justify").evaluate(_t,{},D),mn=N.get("symbol-placement"),Zn=mn==="point"?24*N.get("text-max-width").evaluate(_t,{},D):0,bi=function(){a.allowVerticalPlacement&&ff(Yr)&&(er.vertical=Vg(br,u,A,E,Pt,Zn,ke,sn,"left",ur,tr,Co.vertical,!0,mn,Xt,Gt))};if(!Ue&&Jr){for(var pi=xr==="auto"?Jr.map(function(ln){return Yy(ln)}):[xr],Yn=!1,xi=0;xi<pi.length;xi++){var ji=pi[xi];if(!er.horizontal[ji])if(Yn)er.horizontal[ji]=er.horizontal[0];else{var Ji=Vg(br,u,A,E,Pt,Zn,ke,"center",ji,ur,tr,Co.horizontal,!1,mn,Xt,Gt);Ji&&(er.horizontal[ji]=Ji,Yn=Ji.positionedLines.length===1)}}bi()}else{xr==="auto"&&(xr=Yy(sn));var xs=Vg(br,u,A,E,Pt,Zn,ke,sn,xr,ur,tr,Co.horizontal,!1,mn,Xt,Gt);xs&&(er.horizontal[xr]=xs),bi(),ff(Yr)&&Ue&&je&&(er.vertical=Vg(br,u,A,E,Pt,Zn,ke,sn,xr,ur,tr,Co.vertical,!1,mn,Xt,Gt))}}var ts=void 0,ws=!1;if(_t.icon&&_t.icon.name){var Ei=x[_t.icon.name];Ei&&(ts=function(ln,Fn,Cn){var gn=Ky(Cn),ks=Fn[0]-ln.displaySize[0]*gn.horizontalAlign,ds=Fn[1]-ln.displaySize[1]*gn.verticalAlign;return{image:ln,top:ds,bottom:ds+ln.displaySize[1],left:ks,right:ks+ln.displaySize[0]}}(E[_t.icon.name],N.get("icon-offset").evaluate(_t,{},D),N.get("icon-anchor").evaluate(_t,{},D)),ws=Ei.sdf,a.sdfIcons===void 0?a.sdfIcons=Ei.sdf:a.sdfIcons!==Ei.sdf&&ne("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ei.pixelRatio!==a.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var rs=IE(er.horizontal)||er.vertical;a.iconsInText=!!rs&&rs.iconsInText,(rs||ts)&&function(ln,Fn,Cn,gn,ks,ds,Xn,Pi,As,_n,Mc){var Eo=ds.textMaxSize.evaluate(Fn,{});Eo===void 0&&(Eo=Xn);var Pc,Ti=ln.layers[0].layout,Rc=Ti.get("icon-offset").evaluate(Fn,{},Mc),_a=IE(Cn.horizontal),zh=Xn/24,Cf=ln.tilePixelRatio*zh,Gh=ln.tilePixelRatio*Eo/24,xl=ln.tilePixelRatio*Pi,Vh=ln.tilePixelRatio*Ti.get("symbol-spacing"),Yg=Ti.get("text-padding")*ln.tilePixelRatio,Hh=Ti.get("icon-padding")*ln.tilePixelRatio,XA=Ti.get("text-max-angle")/180*Math.PI,Qg=Ti.get("text-rotation-alignment")==="map"&&Ti.get("symbol-placement")!=="point",e0=Ti.get("icon-rotation-alignment")==="map"&&Ti.get("symbol-placement")!=="point",wl=Ti.get("symbol-placement"),$A=Vh/2,jh=Ti.get("icon-text-fit");gn&&jh!=="none"&&(ln.allowVerticalPlacement&&Cn.vertical&&(Pc=mE(gn,Cn.vertical,jh,Ti.get("icon-text-fit-padding"),Rc,zh)),_a&&(gn=mE(gn,_a,jh,Ti.get("icon-text-fit-padding"),Rc,zh)));var _u=function(JN,rp){rp.x<0||rp.x>=8192||rp.y<0||rp.y>=8192||function(Bi,Wa,WN,yu,av,WE,o0,Fc,a0,np,c0,l0,cv,XE,ip,$E,KE,qE,ZE,YE,To,u0,QE,Dc,XN){var eT,Tf,Kh,qh,Zh,Yh=Bi.addToLineVertexArray(Wa,WN),tT=0,rT=0,nT=0,iT=0,lv=-1,uv=-1,Cl={},sT=me(""),fv=0,hv=0;if(Fc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(fv=(eT=Fc.layout.get("text-offset").evaluate(To,{},Dc).map(function(op){return 24*op}))[0],hv=eT[1]):(fv=24*Fc.layout.get("text-radial-offset").evaluate(To,{},Dc),hv=Zy),Bi.allowVerticalPlacement&&yu.vertical){var oT=Fc.layout.get("text-rotate").evaluate(To,{},Dc)+90;qh=new Xg(a0,Wa,np,c0,l0,yu.vertical,cv,XE,ip,oT),o0&&(Zh=new Xg(a0,Wa,np,c0,l0,o0,KE,qE,ip,oT))}if(av){var dv=Fc.layout.get("icon-rotate").evaluate(To,{}),aT=Fc.layout.get("icon-text-fit")!=="none",cT=EE(av,dv,QE,aT),Av=o0?EE(o0,dv,QE,aT):void 0;Kh=new Xg(a0,Wa,np,c0,l0,av,KE,qE,!1,dv),tT=4*cT.length;var lT=Bi.iconSizeData,sp=null;lT.kind==="source"?(sp=[128*Fc.layout.get("icon-size").evaluate(To,{})])[0]>32640&&ne(Bi.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):lT.kind==="composite"&&((sp=[128*u0.compositeIconSizes[0].evaluate(To,{},Dc),128*u0.compositeIconSizes[1].evaluate(To,{},Dc)])[0]>32640||sp[1]>32640)&&ne(Bi.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Bi.addSymbols(Bi.icon,cT,sp,YE,ZE,To,!1,Wa,Yh.lineStartIndex,Yh.lineLength,-1,Dc),lv=Bi.icon.placedSymbolArray.length-1,Av&&(rT=4*Av.length,Bi.addSymbols(Bi.icon,Av,sp,YE,ZE,To,Co.vertical,Wa,Yh.lineStartIndex,Yh.lineLength,-1,Dc),uv=Bi.icon.placedSymbolArray.length-1)}for(var uT in yu.horizontal){var f0=yu.horizontal[uT];if(!Tf){sT=me(f0.text);var $N=Fc.layout.get("text-rotate").evaluate(To,{},Dc);Tf=new Xg(a0,Wa,np,c0,l0,f0,cv,XE,ip,$N)}var fT=f0.positionedLines.length===1;if(nT+=SE(Bi,Wa,f0,WE,Fc,ip,To,$E,Yh,yu.vertical?Co.horizontal:Co.horizontalOnly,fT?Object.keys(yu.horizontal):[uT],Cl,lv,u0,Dc),fT)break}yu.vertical&&(iT+=SE(Bi,Wa,yu.vertical,WE,Fc,ip,To,$E,Yh,Co.vertical,["vertical"],Cl,uv,u0,Dc));var KN=Tf?Tf.boxStartIndex:Bi.collisionBoxArray.length,qN=Tf?Tf.boxEndIndex:Bi.collisionBoxArray.length,ZN=qh?qh.boxStartIndex:Bi.collisionBoxArray.length,YN=qh?qh.boxEndIndex:Bi.collisionBoxArray.length,QN=Kh?Kh.boxStartIndex:Bi.collisionBoxArray.length,ek=Kh?Kh.boxEndIndex:Bi.collisionBoxArray.length,tk=Zh?Zh.boxStartIndex:Bi.collisionBoxArray.length,rk=Zh?Zh.boxEndIndex:Bi.collisionBoxArray.length,Oc=-1,h0=function(op,dT){return op&&op.circleDiameter?Math.max(op.circleDiameter,dT):dT};Oc=h0(Tf,Oc),Oc=h0(qh,Oc),Oc=h0(Kh,Oc);var hT=(Oc=h0(Zh,Oc))>-1?1:0;hT&&(Oc*=XN/24),Bi.glyphOffsetArray.length>=Sn.MAX_GLYPHS&&ne("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),To.sortKey!==void 0&&Bi.addToSortKeyRanges(Bi.symbolInstances.length,To.sortKey),Bi.symbolInstances.emplaceBack(Wa.x,Wa.y,Cl.right>=0?Cl.right:-1,Cl.center>=0?Cl.center:-1,Cl.left>=0?Cl.left:-1,Cl.vertical||-1,lv,uv,sT,KN,qN,ZN,YN,QN,ek,tk,rk,np,nT,iT,tT,rT,hT,0,cv,fv,hv,Oc)}(ln,rp,JN,Cn,gn,ks,Pc,ln.layers[0],ln.collisionBoxArray,Fn.index,Fn.sourceLayerIndex,ln.index,Cf,Yg,Qg,As,xl,Hh,e0,Rc,Fn,ds,_n,Mc,Xn)};if(wl==="line")for(var Jh=0,t0=CE(Fn.geometry,0,0,8192,8192);Jh<t0.length;Jh+=1)for(var r0=t0[Jh],KA=0,qA=SN(r0,Vh,XA,Cn.vertical||_a,gn,24,Gh,ln.overscaling,8192);KA<qA.length;KA+=1){var n0=qA[KA];_a&&RN(ln,_a.text,$A,n0)||_u(r0,n0)}else if(wl==="line-center")for(var ZA=0,YA=Fn.geometry;ZA<YA.length;ZA+=1){var QA=YA[ZA];if(QA.length>1){var i0=BN(QA,XA,Cn.vertical||_a,gn,24,Gh);i0&&_u(QA,i0)}}else if(Fn.type==="Polygon")for(var Wh=0,s0=jy(Fn.geometry,0);Wh<s0.length;Wh+=1){var Xh=s0[Wh],ep=MN(Xh,16);_u(Xh[0],new Fh(ep.x,ep.y,0))}else if(Fn.type==="LineString")for(var Ef=0,tp=Fn.geometry;Ef<tp.length;Ef+=1){var $h=tp[Ef];_u($h,new Fh($h[0].x,$h[0].y,0))}else if(Fn.type==="Point")for(var iv=0,jE=Fn.geometry;iv<jE.length;iv+=1)for(var sv=0,JE=jE[iv];sv<JE.length;sv+=1){var ov=JE[sv];_u([ov],new Fh(ov.x,ov.y,0))}}(a,_t,er,ts,x,q,Xt,mr,tr,ws,D)},at=0,pt=a.features;at<pt.length;at+=1)qe();I&&a.generateCollisionDebugBuffers()},s.perspective=function(a,u,A,x,E){var I,D=1/Math.tan(u/2);return a[0]=D/A,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,E!=null&&E!==1/0?(a[10]=(E+x)*(I=1/(x-E)),a[14]=2*E*x*I):(a[10]=-1,a[14]=-2*x),a},s.pick=function(a,u){for(var A={},x=0;x<u.length;x++){var E=u[x];E in a&&(A[E]=a[E])}return A},s.plugin=qi,s.polygonIntersectsPolygon=Bc,s.postMapLoadEvent=fi,s.postTurnstileEvent=Tr,s.potpack=dE,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=nr,s.registerForPluginStateChange=function(a){return a({pluginStatus:ys,pluginURL:jo}),yi.on("pluginStateChange",a),a},s.renderColorRamp=$C,s.rotate=function(a,u,A){var x=u[0],E=u[1],I=u[2],D=u[3],N=Math.sin(A),H=Math.cos(A);return a[0]=x*H+I*N,a[1]=E*H+D*N,a[2]=x*-N+I*H,a[3]=E*-N+D*H,a},s.rotateX=function(a,u,A){var x=Math.sin(A),E=Math.cos(A),I=u[4],D=u[5],N=u[6],H=u[7],q=u[8],ee=u[9],se=u[10],he=u[11];return u!==a&&(a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[4]=I*E+q*x,a[5]=D*E+ee*x,a[6]=N*E+se*x,a[7]=H*E+he*x,a[8]=q*E-I*x,a[9]=ee*E-D*x,a[10]=se*E-N*x,a[11]=he*E-H*x,a},s.rotateZ=function(a,u,A){var x=Math.sin(A),E=Math.cos(A),I=u[0],D=u[1],N=u[2],H=u[3],q=u[4],ee=u[5],se=u[6],he=u[7];return u!==a&&(a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[0]=I*E+q*x,a[1]=D*E+ee*x,a[2]=N*E+se*x,a[3]=H*E+he*x,a[4]=q*E-I*x,a[5]=ee*E-D*x,a[6]=se*E-N*x,a[7]=he*E-H*x,a},s.scale=function(a,u,A){var x=A[0],E=A[1],I=A[2];return a[0]=u[0]*x,a[1]=u[1]*x,a[2]=u[2]*x,a[3]=u[3]*x,a[4]=u[4]*E,a[5]=u[5]*E,a[6]=u[6]*E,a[7]=u[7]*E,a[8]=u[8]*I,a[9]=u[9]*I,a[10]=u[10]*I,a[11]=u[11]*I,a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a},s.scale$1=function(a,u,A){return a[0]=u[0]*A,a[1]=u[1]*A,a[2]=u[2]*A,a[3]=u[3]*A,a},s.scale$2=function(a,u,A){return a[0]=u[0]*A,a[1]=u[1]*A,a[2]=u[2]*A,a},s.setCacheLimits=function(a,u){Pe=a,Ot=u},s.setRTLTextPlugin=function(a,u,A){if(A===void 0&&(A=!1),ys==="deferred"||ys==="loading"||ys==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");jo=Jt.resolveURL(a),ys="deferred",uu=u,Ec(),A||fo()},s.sphericalToCartesian=function(a){var u=a[0],A=a[1],x=a[2];return A+=90,A*=Math.PI/180,x*=Math.PI/180,{x:u*Math.cos(A)*Math.sin(x),y:u*Math.sin(A)*Math.sin(x),z:u*Math.cos(x)}},s.sqrLen=function(a){var u=a[0],A=a[1];return u*u+A*A},s.styleSpec=ce,s.sub=function(a,u,A){return a[0]=u[0]-A[0],a[1]=u[1]-A[1],a[2]=u[2]-A[2],a},s.symbolSize=TN,s.transformMat3=function(a,u,A){var x=u[0],E=u[1],I=u[2];return a[0]=x*A[0]+E*A[3]+I*A[6],a[1]=x*A[1]+E*A[4]+I*A[7],a[2]=x*A[2]+E*A[5]+I*A[8],a},s.transformMat4=Eh,s.translate=function(a,u,A){var x,E,I,D,N,H,q,ee,se,he,ye,ke,Ue=A[0],je=A[1],Ve=A[2];return u===a?(a[12]=u[0]*Ue+u[4]*je+u[8]*Ve+u[12],a[13]=u[1]*Ue+u[5]*je+u[9]*Ve+u[13],a[14]=u[2]*Ue+u[6]*je+u[10]*Ve+u[14],a[15]=u[3]*Ue+u[7]*je+u[11]*Ve+u[15]):(E=u[1],I=u[2],D=u[3],N=u[4],H=u[5],q=u[6],ee=u[7],se=u[8],he=u[9],ye=u[10],ke=u[11],a[0]=x=u[0],a[1]=E,a[2]=I,a[3]=D,a[4]=N,a[5]=H,a[6]=q,a[7]=ee,a[8]=se,a[9]=he,a[10]=ye,a[11]=ke,a[12]=x*Ue+N*je+se*Ve+u[12],a[13]=E*Ue+H*je+he*Ve+u[13],a[14]=I*Ue+q*je+ye*Ve+u[14],a[15]=D*Ue+ee*je+ke*Ve+u[15]),a},s.triggerPluginCompletionEvent=df,s.uniqueId=fe,s.validateCustomStyleLayer=function(a){var u=[],A=a.id;return A===void 0&&u.push({message:"layers."+A+': missing required property "id"'}),a.render===void 0&&u.push({message:"layers."+A+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&u.push({message:"layers."+A+': property "renderingMode" must be either "2d" or "3d"'}),u},s.validateLight=DA,s.validateStyle=dl,s.values=function(a){var u=[];for(var A in a)u.push(a[A]);return u},s.vectorTile=Ih,s.version="1.13.3",s.warnOnce=ne,s.webpSupported=lr,s.window=S,s.wrap=z}),o(["./shared"],function(s){function c(Z){var ie=typeof Z;if(ie==="number"||ie==="boolean"||ie==="string"||Z==null)return JSON.stringify(Z);if(Array.isArray(Z)){for(var ue="[",ve=0,Oe=Z;ve<Oe.length;ve+=1)ue+=c(Oe[ve])+",";return ue+"]"}for(var de=Object.keys(Z).sort(),be="{",ce=0;ce<de.length;ce++)be+=JSON.stringify(de[ce])+":"+c(Z[de[ce]])+",";return be+"}"}function f(Z){for(var ie="",ue=0,ve=s.refProperties;ue<ve.length;ue+=1)ie+="/"+c(Z[ve[ue]]);return ie}var g=function(Z){this.keyCache={},Z&&this.replace(Z)};g.prototype.replace=function(Z){this._layerConfigs={},this._layers={},this.update(Z,[])},g.prototype.update=function(Z,ie){for(var ue=this,ve=0,Oe=Z;ve<Oe.length;ve+=1){var de=Oe[ve];this._layerConfigs[de.id]=de;var be=this._layers[de.id]=s.createStyleLayer(de);be._featureFilter=s.featureFilter(be.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(var ce=0,Se=ie;ce<Se.length;ce+=1){var p=Se[ce];delete this.keyCache[p],delete this._layerConfigs[p],delete this._layers[p]}this.familiesBySource={};for(var le=0,vt=function(St,zt){for(var Fr={},qt=0;qt<St.length;qt++){var $r=zt&&zt[St[qt].id]||f(St[qt]);zt&&(zt[St[qt].id]=$r);var en=Fr[$r];en||(en=Fr[$r]=[]),en.push(St[qt])}var Gr=[];for(var Vr in Fr)Gr.push(Fr[Vr]);return Gr}(s.values(this._layerConfigs),this.keyCache);le<vt.length;le+=1){var Ke=vt[le].map(function(St){return ue._layers[St.id]}),Ct=Ke[0];if(Ct.visibility!=="none"){var It=Ct.source||"",Ft=this.familiesBySource[It];Ft||(Ft=this.familiesBySource[It]={});var ut=Ct.sourceLayer||"_geojsonTileLayer",Dt=Ft[ut];Dt||(Dt=Ft[ut]=[]),Dt.push(Ke)}}};var b=function(Z){var ie={},ue=[];for(var ve in Z){var Oe=Z[ve],de=ie[ve]={};for(var be in Oe){var ce=Oe[+be];if(ce&&ce.bitmap.width!==0&&ce.bitmap.height!==0){var Se={x:0,y:0,w:ce.bitmap.width+2,h:ce.bitmap.height+2};ue.push(Se),de[be]={rect:Se,metrics:ce.metrics}}}}var p=s.potpack(ue),le=new s.AlphaImage({width:p.w||1,height:p.h||1});for(var vt in Z){var Ke=Z[vt];for(var Ct in Ke){var It=Ke[+Ct];if(It&&It.bitmap.width!==0&&It.bitmap.height!==0){var Ft=ie[vt][Ct].rect;s.AlphaImage.copy(It.bitmap,le,{x:0,y:0},{x:Ft.x+1,y:Ft.y+1},It.bitmap)}}}this.image=le,this.positions=ie};s.register("GlyphAtlas",b);var T=function(Z){this.tileID=new s.OverscaledTileID(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId};function S(Z,ie,ue){for(var ve=new s.EvaluationParameters(ie),Oe=0,de=Z;Oe<de.length;Oe+=1)de[Oe].recalculate(ve,ue)}function F(Z,ie){var ue=s.getArrayBuffer(Z.request,function(ve,Oe,de,be){ve?ie(ve):Oe&&ie(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(Oe)),rawData:Oe,cacheControl:de,expires:be})});return function(){ue.cancel(),ie()}}T.prototype.parse=function(Z,ie,ue,ve,Oe){var de=this;this.status="parsing",this.data=Z,this.collisionBoxArray=new s.CollisionBoxArray;var be=new s.DictionaryCoder(Object.keys(Z.layers).sort()),ce=new s.FeatureIndex(this.tileID,this.promoteId);ce.bucketLayerIDs=[];var Se,p,le,vt,Ke={},Ct={featureIndex:ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ue},It=ie.familiesBySource[this.source];for(var Ft in It){var ut=Z.layers[Ft];if(ut){ut.version===1&&s.warnOnce('Vector tile source "'+this.source+'" layer "'+Ft+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Dt=be.encode(Ft),St=[],zt=0;zt<ut.length;zt++){var Fr=ut.feature(zt),qt=ce.getId(Fr,Ft);St.push({feature:Fr,id:qt,index:zt,sourceLayerIndex:Dt})}for(var $r=0,en=It[Ft];$r<en.length;$r+=1){var Gr=en[$r],Vr=Gr[0];Vr.minzoom&&this.zoom<Math.floor(Vr.minzoom)||Vr.maxzoom&&this.zoom>=Vr.maxzoom||Vr.visibility!=="none"&&(S(Gr,this.zoom,ue),(Ke[Vr.id]=Vr.createBucket({index:ce.bucketLayerIDs.length,layers:Gr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Dt,sourceID:this.source})).populate(St,Ct,this.tileID.canonical),ce.bucketLayerIDs.push(Gr.map(function(Me){return Me.id})))}}}var Lr=s.mapObject(Ct.glyphDependencies,function(Me){return Object.keys(Me).map(Number)});Object.keys(Lr).length?ve.send("getGlyphs",{uid:this.uid,stacks:Lr},function(Me,Wt){Se||(Se=Me,p=Wt,fr.call(de))}):p={};var hi=Object.keys(Ct.iconDependencies);hi.length?ve.send("getImages",{icons:hi,source:this.source,tileID:this.tileID,type:"icons"},function(Me,Wt){Se||(Se=Me,le=Wt,fr.call(de))}):le={};var Hr=Object.keys(Ct.patternDependencies);function fr(){if(Se)return Oe(Se);if(p&&le&&vt){var Me=new b(p),Wt=new s.ImageAtlas(le,vt);for(var Kr in Ke){var Ni=Ke[Kr];Ni instanceof s.SymbolBucket?(S(Ni.layers,this.zoom,ue),s.performSymbolLayout(Ni,p,Me.positions,le,Wt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Ni.hasPattern&&(Ni instanceof s.LineBucket||Ni instanceof s.FillBucket||Ni instanceof s.FillExtrusionBucket)&&(S(Ni.layers,this.zoom,ue),Ni.addFeatures(Ct,this.tileID.canonical,Wt.patternPositions))}this.status="done",Oe(null,{buckets:s.values(Ke).filter(function(sa){return!sa.isEmpty()}),featureIndex:ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Me.image,imageAtlas:Wt,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?le:null,glyphPositions:this.returnDependencies?Me.positions:null})}}Hr.length?ve.send("getImages",{icons:Hr,source:this.source,tileID:this.tileID,type:"patterns"},function(Me,Wt){Se||(Se=Me,vt=Wt,fr.call(de))}):vt={},fr.call(this)};var k=function(Z,ie,ue,ve){this.actor=Z,this.layerIndex=ie,this.availableImages=ue,this.loadVectorData=ve||F,this.loading={},this.loaded={}};k.prototype.loadTile=function(Z,ie){var ue=this,ve=Z.uid;this.loading||(this.loading={});var Oe=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new s.RequestPerformance(Z.request),de=this.loading[ve]=new T(Z);de.abort=this.loadVectorData(Z,function(be,ce){if(delete ue.loading[ve],be||!ce)return de.status="done",ue.loaded[ve]=de,ie(be);var Se=ce.rawData,p={};ce.expires&&(p.expires=ce.expires),ce.cacheControl&&(p.cacheControl=ce.cacheControl);var le={};if(Oe){var vt=Oe.finish();vt&&(le.resourceTiming=JSON.parse(JSON.stringify(vt)))}de.vectorTile=ce.vectorTile,de.parse(ce.vectorTile,ue.layerIndex,ue.availableImages,ue.actor,function(Ke,Ct){if(Ke||!Ct)return ie(Ke);ie(null,s.extend({rawTileData:Se.slice(0)},Ct,p,le))}),ue.loaded=ue.loaded||{},ue.loaded[ve]=de})},k.prototype.reloadTile=function(Z,ie){var ue=this,ve=this.loaded,Oe=Z.uid,de=this;if(ve&&ve[Oe]){var be=ve[Oe];be.showCollisionBoxes=Z.showCollisionBoxes;var ce=function(Se,p){var le=be.reloadCallback;le&&(delete be.reloadCallback,be.parse(be.vectorTile,de.layerIndex,ue.availableImages,de.actor,le)),ie(Se,p)};be.status==="parsing"?be.reloadCallback=ce:be.status==="done"&&(be.vectorTile?be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,ce):ce())}},k.prototype.abortTile=function(Z,ie){var ue=this.loading,ve=Z.uid;ue&&ue[ve]&&ue[ve].abort&&(ue[ve].abort(),delete ue[ve]),ie()},k.prototype.removeTile=function(Z,ie){var ue=this.loaded,ve=Z.uid;ue&&ue[ve]&&delete ue[ve],ie()};var U=s.window.ImageBitmap,j=function(){this.loaded={}};function z(Z,ie){if(Z.length!==0){V(Z[0],ie);for(var ue=1;ue<Z.length;ue++)V(Z[ue],!1)}}function V(Z,ie){for(var ue=0,ve=0,Oe=0,de=Z.length,be=de-1;Oe<de;be=Oe++){var ce=(Z[Oe][0]-Z[be][0])*(Z[be][1]+Z[Oe][1]),Se=ue+ce;ve+=Math.abs(ue)>=Math.abs(ce)?ue-Se+ce:ce-Se+ue,ue=Se}ue+ve>=0!=!!ie&&Z.reverse()}j.prototype.loadTile=function(Z,ie){var ue=Z.uid,ve=Z.encoding,Oe=Z.rawImageData,de=U&&Oe instanceof U?this.getImageData(Oe):Oe,be=new s.DEMData(ue,de,ve);this.loaded=this.loaded||{},this.loaded[ue]=be,ie(null,be)},j.prototype.getImageData=function(Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);var ie=this.offscreenCanvasContext.getImageData(-1,-1,Z.width+2,Z.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:ie.width,height:ie.height},ie.data)},j.prototype.removeTile=function(Z){var ie=this.loaded,ue=Z.uid;ie&&ie[ue]&&delete ie[ue]};var K=s.vectorTile.VectorTileFeature.prototype.toGeoJSON,fe=function(Z){this._feature=Z,this.extent=s.EXTENT,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))};fe.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Z=[],ie=0,ue=this._feature.geometry;ie<ue.length;ie+=1){var ve=ue[ie];Z.push([new s.Point$1(ve[0],ve[1])])}return Z}for(var Oe=[],de=0,be=this._feature.geometry;de<be.length;de+=1){for(var ce=[],Se=0,p=be[de];Se<p.length;Se+=1){var le=p[Se];ce.push(new s.Point$1(le[0],le[1]))}Oe.push(ce)}return Oe},fe.prototype.toGeoJSON=function(Z,ie,ue){return K.call(this,Z,ie,ue)};var Q=function(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=Z.length,this._features=Z};Q.prototype.feature=function(Z){return new fe(this._features[Z])};var oe=s.vectorTile.VectorTileFeature,Te=ze;function ze(Z,ie){this.options=ie||{},this.features=Z,this.length=Z.length}function Ae(Z,ie){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=ie||4096}ze.prototype.feature=function(Z){return new Ae(this.features[Z],this.options.extent)},Ae.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var ie=0;ie<Z.length;ie++){for(var ue=Z[ie],ve=[],Oe=0;Oe<ue.length;Oe++)ve.push(new s.Point$1(ue[Oe][0],ue[Oe][1]));this.geometry.push(ve)}return this.geometry},Ae.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,ie=1/0,ue=-1/0,ve=1/0,Oe=-1/0,de=0;de<Z.length;de++)for(var be=Z[de],ce=0;ce<be.length;ce++){var Se=be[ce];ie=Math.min(ie,Se.x),ue=Math.max(ue,Se.x),ve=Math.min(ve,Se.y),Oe=Math.max(Oe,Se.y)}return[ie,ve,ue,Oe]},Ae.prototype.toGeoJSON=oe.prototype.toGeoJSON;var _e=X,pe=Te;function X(Z){var ie=new s.pbf;return function(ue,ve){for(var Oe in ue.layers)ve.writeMessage(3,ne,ue.layers[Oe])}(Z,ie),ie.finish()}function ne(Z,ie){var ue;ie.writeVarintField(15,Z.version||1),ie.writeStringField(1,Z.name||""),ie.writeVarintField(5,Z.extent||4096);var ve={keys:[],values:[],keycache:{},valuecache:{}};for(ue=0;ue<Z.length;ue++)ve.feature=Z.feature(ue),ie.writeMessage(2,Be,ve);var Oe=ve.keys;for(ue=0;ue<Oe.length;ue++)ie.writeStringField(3,Oe[ue]);var de=ve.values;for(ue=0;ue<de.length;ue++)ie.writeMessage(4,Qe,de[ue])}function Be(Z,ie){var ue=Z.feature;ue.id!==void 0&&ie.writeVarintField(1,ue.id),ie.writeMessage(2,Ze,Z),ie.writeVarintField(3,ue.type),ie.writeMessage(4,Ge,ue)}function Ze(Z,ie){var ue=Z.feature,ve=Z.keys,Oe=Z.values,de=Z.keycache,be=Z.valuecache;for(var ce in ue.properties){var Se=de[ce];Se===void 0&&(ve.push(ce),de[ce]=Se=ve.length-1),ie.writeVarint(Se);var p=ue.properties[ce],le=typeof p;le!=="string"&&le!=="boolean"&&le!=="number"&&(p=JSON.stringify(p));var vt=le+":"+p,Ke=be[vt];Ke===void 0&&(Oe.push(p),be[vt]=Ke=Oe.length-1),ie.writeVarint(Ke)}}function Ce(Z,ie){return(ie<<3)+(7&Z)}function Ne(Z){return Z<<1^Z>>31}function Ge(Z,ie){for(var ue=Z.loadGeometry(),ve=Z.type,Oe=0,de=0,be=ue.length,ce=0;ce<be;ce++){var Se=ue[ce],p=1;ve===1&&(p=Se.length),ie.writeVarint(Ce(1,p));for(var le=ve===3?Se.length-1:Se.length,vt=0;vt<le;vt++){vt===1&&ve!==1&&ie.writeVarint(Ce(2,le-1));var Ke=Se[vt].x-Oe,Ct=Se[vt].y-de;ie.writeVarint(Ne(Ke)),ie.writeVarint(Ne(Ct)),Oe+=Ke,de+=Ct}ve===3&&ie.writeVarint(Ce(7,1))}}function Qe(Z,ie){var ue=typeof Z;ue==="string"?ie.writeStringField(1,Z):ue==="boolean"?ie.writeBooleanField(7,Z):ue==="number"&&(Z%1!=0?ie.writeDoubleField(3,Z):Z<0?ie.writeSVarintField(6,Z):ie.writeVarintField(5,Z))}function rt(Z,ie,ue,ve){tt(Z,ue,ve),tt(ie,2*ue,2*ve),tt(ie,2*ue+1,2*ve+1)}function tt(Z,ie,ue){var ve=Z[ie];Z[ie]=Z[ue],Z[ue]=ve}function lt(Z,ie,ue,ve){var Oe=Z-ue,de=ie-ve;return Oe*Oe+de*de}_e.fromVectorTileJs=X,_e.fromGeojsonVt=function(Z,ie){ie=ie||{};var ue={};for(var ve in Z)ue[ve]=new Te(Z[ve].features,ie),ue[ve].name=ve,ue[ve].version=ie.version,ue[ve].extent=ie.extent;return X({layers:ue})},_e.GeoJSONWrapper=pe;var mt=function(Z){return Z[0]},Tt=function(Z){return Z[1]},nt=function(Z,ie,ue,ve,Oe){ie===void 0&&(ie=mt),ue===void 0&&(ue=Tt),ve===void 0&&(ve=64),Oe===void 0&&(Oe=Float64Array),this.nodeSize=ve,this.points=Z;for(var de=Z.length<65536?Uint16Array:Uint32Array,be=this.ids=new de(Z.length),ce=this.coords=new Oe(2*Z.length),Se=0;Se<Z.length;Se++)be[Se]=Se,ce[2*Se]=ie(Z[Se]),ce[2*Se+1]=ue(Z[Se]);(function p(le,vt,Ke,Ct,It,Ft){if(!(It-Ct<=Ke)){var ut=Ct+It>>1;(function Dt(St,zt,Fr,qt,$r,en){for(;$r>qt;){if($r-qt>600){var Gr=$r-qt+1,Vr=Fr-qt+1,Lr=Math.log(Gr),hi=.5*Math.exp(2*Lr/3),Hr=.5*Math.sqrt(Lr*hi*(Gr-hi)/Gr)*(Vr-Gr/2<0?-1:1);Dt(St,zt,Fr,Math.max(qt,Math.floor(Fr-Vr*hi/Gr+Hr)),Math.min($r,Math.floor(Fr+(Gr-Vr)*hi/Gr+Hr)),en)}var fr=zt[2*Fr+en],Me=qt,Wt=$r;for(rt(St,zt,qt,Fr),zt[2*$r+en]>fr&&rt(St,zt,qt,$r);Me<Wt;){for(rt(St,zt,Me,Wt),Me++,Wt--;zt[2*Me+en]<fr;)Me++;for(;zt[2*Wt+en]>fr;)Wt--}zt[2*qt+en]===fr?rt(St,zt,qt,Wt):rt(St,zt,++Wt,$r),Wt<=Fr&&(qt=Wt+1),Fr<=Wt&&($r=Wt-1)}})(le,vt,ut,Ct,It,Ft%2),p(le,vt,Ke,Ct,ut-1,Ft+1),p(le,vt,Ke,ut+1,It,Ft+1)}})(be,ce,ve,0,be.length-1,0)};nt.prototype.range=function(Z,ie,ue,ve){return function(Oe,de,be,ce,Se,p,le){for(var vt,Ke,Ct=[0,Oe.length-1,0],It=[];Ct.length;){var Ft=Ct.pop(),ut=Ct.pop(),Dt=Ct.pop();if(ut-Dt<=le)for(var St=Dt;St<=ut;St++)Ke=de[2*St+1],(vt=de[2*St])>=be&&vt<=Se&&Ke>=ce&&Ke<=p&&It.push(Oe[St]);else{var zt=Math.floor((Dt+ut)/2);Ke=de[2*zt+1],(vt=de[2*zt])>=be&&vt<=Se&&Ke>=ce&&Ke<=p&&It.push(Oe[zt]);var Fr=(Ft+1)%2;(Ft===0?be<=vt:ce<=Ke)&&(Ct.push(Dt),Ct.push(zt-1),Ct.push(Fr)),(Ft===0?Se>=vt:p>=Ke)&&(Ct.push(zt+1),Ct.push(ut),Ct.push(Fr))}}return It}(this.ids,this.coords,Z,ie,ue,ve,this.nodeSize)},nt.prototype.within=function(Z,ie,ue){return function(ve,Oe,de,be,ce,Se){for(var p=[0,ve.length-1,0],le=[],vt=ce*ce;p.length;){var Ke=p.pop(),Ct=p.pop(),It=p.pop();if(Ct-It<=Se)for(var Ft=It;Ft<=Ct;Ft++)lt(Oe[2*Ft],Oe[2*Ft+1],de,be)<=vt&&le.push(ve[Ft]);else{var ut=Math.floor((It+Ct)/2),Dt=Oe[2*ut],St=Oe[2*ut+1];lt(Dt,St,de,be)<=vt&&le.push(ve[ut]);var zt=(Ke+1)%2;(Ke===0?de-ce<=Dt:be-ce<=St)&&(p.push(It),p.push(ut-1),p.push(zt)),(Ke===0?de+ce>=Dt:be+ce>=St)&&(p.push(ut+1),p.push(Ct),p.push(zt))}}return le}(this.ids,this.coords,Z,ie,ue,this.nodeSize)};var cr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Z){return Z}},$t=function(Z){this.options=In(Object.create(cr),Z),this.trees=new Array(this.options.maxZoom+1)};function Jt(Z,ie,ue,ve,Oe){return{x:Z,y:ie,zoom:1/0,id:ue,parentId:-1,numPoints:ve,properties:Oe}}function Lt(Z,ie){var ue=Z.geometry.coordinates,ve=ue[1];return{x:Er(ue[0]),y:Ar(ve),zoom:1/0,index:ie,parentId:-1}}function lr(Z){return{type:"Feature",id:Z.id,properties:tn(Z),geometry:{type:"Point",coordinates:[(ve=Z.x,360*(ve-.5)),(ie=Z.y,ue=(180-360*ie)*Math.PI/180,360*Math.atan(Math.exp(ue))/Math.PI-90)]}};var ie,ue,ve}function tn(Z){var ie=Z.numPoints,ue=ie>=1e4?Math.round(ie/1e3)+"k":ie>=1e3?Math.round(ie/100)/10+"k":ie;return In(In({},Z.properties),{cluster:!0,cluster_id:Z.id,point_count:ie,point_count_abbreviated:ue})}function Er(Z){return Z/360+.5}function Ar(Z){var ie=Math.sin(Z*Math.PI/180),ue=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ue<0?0:ue>1?1:ue}function In(Z,ie){for(var ue in ie)Z[ue]=ie[ue];return Z}function hr(Z){return Z.x}function pr(Z){return Z.y}function rn(Z,ie,ue,ve,Oe,de){var be=Oe-ue,ce=de-ve;if(be!==0||ce!==0){var Se=((Z-ue)*be+(ie-ve)*ce)/(be*be+ce*ce);Se>1?(ue=Oe,ve=de):Se>0&&(ue+=be*Se,ve+=ce*Se)}return(be=Z-ue)*be+(ce=ie-ve)*ce}function Sr(Z,ie,ue,ve){var Oe={id:Z===void 0?null:Z,type:ie,geometry:ue,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var be=de.geometry,ce=de.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")ti(de,be);else if(ce==="Polygon"||ce==="MultiLineString")for(var Se=0;Se<be.length;Se++)ti(de,be[Se]);else if(ce==="MultiPolygon")for(Se=0;Se<be.length;Se++)for(var p=0;p<be[Se].length;p++)ti(de,be[Se][p])}(Oe),Oe}function ti(Z,ie){for(var ue=0;ue<ie.length;ue+=3)Z.minX=Math.min(Z.minX,ie[ue]),Z.minY=Math.min(Z.minY,ie[ue+1]),Z.maxX=Math.max(Z.maxX,ie[ue]),Z.maxY=Math.max(Z.maxY,ie[ue+1])}function Jn(Z,ie,ue,ve){if(ie.geometry){var Oe=ie.geometry.coordinates,de=ie.geometry.type,be=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2),ce=[],Se=ie.id;if(ue.promoteId?Se=ie.properties[ue.promoteId]:ue.generateId&&(Se=ve||0),de==="Point")un(Oe,ce);else if(de==="MultiPoint")for(var p=0;p<Oe.length;p++)un(Oe[p],ce);else if(de==="LineString")Kn(Oe,ce,be,!1);else if(de==="MultiLineString"){if(ue.lineMetrics){for(p=0;p<Oe.length;p++)Kn(Oe[p],ce=[],be,!1),Z.push(Sr(Se,"LineString",ce,ie.properties));return}Nn(Oe,ce,be,!1)}else if(de==="Polygon")Nn(Oe,ce,be,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(p=0;p<ie.geometry.geometries.length;p++)Jn(Z,{id:Se,geometry:ie.geometry.geometries[p],properties:ie.properties},ue,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(p=0;p<Oe.length;p++){var le=[];Nn(Oe[p],le,be,!0),ce.push(le)}}Z.push(Sr(Se,de,ce,ie.properties))}}function un(Z,ie){ie.push(vn(Z[0])),ie.push(Wn(Z[1])),ie.push(0)}function Kn(Z,ie,ue,ve){for(var Oe,de,be=0,ce=0;ce<Z.length;ce++){var Se=vn(Z[ce][0]),p=Wn(Z[ce][1]);ie.push(Se),ie.push(p),ie.push(0),ce>0&&(be+=ve?(Oe*p-Se*de)/2:Math.sqrt(Math.pow(Se-Oe,2)+Math.pow(p-de,2))),Oe=Se,de=p}var le=ie.length-3;ie[2]=1,function vt(Ke,Ct,It,Ft){for(var ut,Dt=Ft,St=It-Ct>>1,zt=It-Ct,Fr=Ke[Ct],qt=Ke[Ct+1],$r=Ke[It],en=Ke[It+1],Gr=Ct+3;Gr<It;Gr+=3){var Vr=rn(Ke[Gr],Ke[Gr+1],Fr,qt,$r,en);if(Vr>Dt)ut=Gr,Dt=Vr;else if(Vr===Dt){var Lr=Math.abs(Gr-St);Lr<zt&&(ut=Gr,zt=Lr)}}Dt>Ft&&(ut-Ct>3&&vt(Ke,Ct,ut,Ft),Ke[ut+2]=Dt,It-ut>3&&vt(Ke,ut,It,Ft))}(ie,0,le,ue),ie[le+2]=1,ie.size=Math.abs(be),ie.start=0,ie.end=ie.size}function Nn(Z,ie,ue,ve){for(var Oe=0;Oe<Z.length;Oe++){var de=[];Kn(Z[Oe],de,ue,ve),ie.push(de)}}function vn(Z){return Z/360+.5}function Wn(Z){var ie=Math.sin(Z*Math.PI/180),ue=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ue<0?0:ue>1?1:ue}function Ut(Z,ie,ue,ve,Oe,de,be,ce){if(ve/=ie,de>=(ue/=ie)&&be<ve)return Z;if(be<ue||de>=ve)return null;for(var Se=[],p=0;p<Z.length;p++){var le=Z[p],vt=le.geometry,Ke=le.type,Ct=Oe===0?le.minX:le.minY,It=Oe===0?le.maxX:le.maxY;if(Ct>=ue&&It<ve)Se.push(le);else if(!(It<ue||Ct>=ve)){var Ft=[];if(Ke==="Point"||Ke==="MultiPoint")dr(vt,Ft,ue,ve,Oe);else if(Ke==="LineString")Tr(vt,Ft,ue,ve,Oe,!1,ce.lineMetrics);else if(Ke==="MultiLineString")fi(vt,Ft,ue,ve,Oe,!1);else if(Ke==="Polygon")fi(vt,Ft,ue,ve,Oe,!0);else if(Ke==="MultiPolygon")for(var ut=0;ut<vt.length;ut++){var Dt=[];fi(vt[ut],Dt,ue,ve,Oe,!0),Dt.length&&Ft.push(Dt)}if(Ft.length){if(ce.lineMetrics&&Ke==="LineString"){for(ut=0;ut<Ft.length;ut++)Se.push(Sr(le.id,Ke,Ft[ut],le.tags));continue}Ke!=="LineString"&&Ke!=="MultiLineString"||(Ft.length===1?(Ke="LineString",Ft=Ft[0]):Ke="MultiLineString"),Ke!=="Point"&&Ke!=="MultiPoint"||(Ke=Ft.length===3?"Point":"MultiPoint"),Se.push(Sr(le.id,Ke,Ft,le.tags))}}}return Se.length?Se:null}function dr(Z,ie,ue,ve,Oe){for(var de=0;de<Z.length;de+=3){var be=Z[de+Oe];be>=ue&&be<=ve&&(ie.push(Z[de]),ie.push(Z[de+1]),ie.push(Z[de+2]))}}function Tr(Z,ie,ue,ve,Oe,de,be){for(var ce,Se,p=Zr(Z),le=Oe===0?Ot:Vt,vt=Z.start,Ke=0;Ke<Z.length-3;Ke+=3){var Ct=Z[Ke],It=Z[Ke+1],Ft=Z[Ke+2],ut=Z[Ke+3],Dt=Z[Ke+4],St=Oe===0?Ct:It,zt=Oe===0?ut:Dt,Fr=!1;be&&(ce=Math.sqrt(Math.pow(Ct-ut,2)+Math.pow(It-Dt,2))),St<ue?zt>ue&&(Se=le(p,Ct,It,ut,Dt,ue),be&&(p.start=vt+ce*Se)):St>ve?zt<ve&&(Se=le(p,Ct,It,ut,Dt,ve),be&&(p.start=vt+ce*Se)):Pe(p,Ct,It,Ft),zt<ue&&St>=ue&&(Se=le(p,Ct,It,ut,Dt,ue),Fr=!0),zt>ve&&St<=ve&&(Se=le(p,Ct,It,ut,Dt,ve),Fr=!0),!de&&Fr&&(be&&(p.end=vt+ce*Se),ie.push(p),p=Zr(Z)),be&&(vt+=ce)}var qt=Z.length-3;Ct=Z[qt],It=Z[qt+1],Ft=Z[qt+2],(St=Oe===0?Ct:It)>=ue&&St<=ve&&Pe(p,Ct,It,Ft),qt=p.length-3,de&&qt>=3&&(p[qt]!==p[0]||p[qt+1]!==p[1])&&Pe(p,p[0],p[1],p[2]),p.length&&ie.push(p)}function Zr(Z){var ie=[];return ie.size=Z.size,ie.start=Z.start,ie.end=Z.end,ie}function fi(Z,ie,ue,ve,Oe,de){for(var be=0;be<Z.length;be++)Tr(Z[be],ie,ue,ve,Oe,de,!1)}function Pe(Z,ie,ue,ve){Z.push(ie),Z.push(ue),Z.push(ve)}function Ot(Z,ie,ue,ve,Oe,de){var be=(de-ie)/(ve-ie);return Z.push(de),Z.push(ue+(Oe-ue)*be),Z.push(1),be}function Vt(Z,ie,ue,ve,Oe,de){var be=(de-ue)/(Oe-ue);return Z.push(ie+(ve-ie)*be),Z.push(de),Z.push(1),be}function sr(Z,ie){for(var ue=[],ve=0;ve<Z.length;ve++){var Oe,de=Z[ve],be=de.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")Oe=Ye(de.geometry,ie);else if(be==="MultiLineString"||be==="Polygon"){Oe=[];for(var ce=0;ce<de.geometry.length;ce++)Oe.push(Ye(de.geometry[ce],ie))}else if(be==="MultiPolygon")for(Oe=[],ce=0;ce<de.geometry.length;ce++){for(var Se=[],p=0;p<de.geometry[ce].length;p++)Se.push(Ye(de.geometry[ce][p],ie));Oe.push(Se)}ue.push(Sr(de.id,be,Oe,de.tags))}return ue}function Ye(Z,ie){var ue=[];ue.size=Z.size,Z.start!==void 0&&(ue.start=Z.start,ue.end=Z.end);for(var ve=0;ve<Z.length;ve+=3)ue.push(Z[ve]+ie,Z[ve+1],Z[ve+2]);return ue}function Mt(Z,ie){if(Z.transformed)return Z;var ue,ve,Oe,de=1<<Z.z,be=Z.x,ce=Z.y;for(ue=0;ue<Z.features.length;ue++){var Se=Z.features[ue],p=Se.geometry,le=Se.type;if(Se.geometry=[],le===1)for(ve=0;ve<p.length;ve+=2)Se.geometry.push(ge(p[ve],p[ve+1],ie,de,be,ce));else for(ve=0;ve<p.length;ve++){var vt=[];for(Oe=0;Oe<p[ve].length;Oe+=2)vt.push(ge(p[ve][Oe],p[ve][Oe+1],ie,de,be,ce));Se.geometry.push(vt)}}return Z.transformed=!0,Z}function ge(Z,ie,ue,ve,Oe,de){return[Math.round(ue*(Z*ve-Oe)),Math.round(ue*(ie*ve-de))]}function kt(Z,ie,ue,ve,Oe){for(var de=ie===Oe.maxZoom?0:Oe.tolerance/((1<<ie)*Oe.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ue,y:ve,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ce=0;ce<Z.length;ce++){be.numFeatures++,wt(be,Z[ce],de,Oe);var Se=Z[ce].minX,p=Z[ce].minY,le=Z[ce].maxX,vt=Z[ce].maxY;Se<be.minX&&(be.minX=Se),p<be.minY&&(be.minY=p),le>be.maxX&&(be.maxX=le),vt>be.maxY&&(be.maxY=vt)}return be}function wt(Z,ie,ue,ve){var Oe=ie.geometry,de=ie.type,be=[];if(de==="Point"||de==="MultiPoint")for(var ce=0;ce<Oe.length;ce+=3)be.push(Oe[ce]),be.push(Oe[ce+1]),Z.numPoints++,Z.numSimplified++;else if(de==="LineString")W(be,Oe,Z,ue,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(ce=0;ce<Oe.length;ce++)W(be,Oe[ce],Z,ue,de==="Polygon",ce===0);else if(de==="MultiPolygon")for(var Se=0;Se<Oe.length;Se++){var p=Oe[Se];for(ce=0;ce<p.length;ce++)W(be,p[ce],Z,ue,!0,ce===0)}if(be.length){var le=ie.tags||null;if(de==="LineString"&&ve.lineMetrics){for(var vt in le={},ie.tags)le[vt]=ie.tags[vt];le.mapbox_clip_start=Oe.start/Oe.size,le.mapbox_clip_end=Oe.end/Oe.size}var Ke={geometry:be,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:le};ie.id!==null&&(Ke.id=ie.id),Z.features.push(Ke)}}function W(Z,ie,ue,ve,Oe,de){var be=ve*ve;if(ve>0&&ie.size<(Oe?be:ve))ue.numPoints+=ie.length/3;else{for(var ce=[],Se=0;Se<ie.length;Se+=3)(ve===0||ie[Se+2]>be)&&(ue.numSimplified++,ce.push(ie[Se]),ce.push(ie[Se+1])),ue.numPoints++;Oe&&function(p,le){for(var vt=0,Ke=0,Ct=p.length,It=Ct-2;Ke<Ct;It=Ke,Ke+=2)vt+=(p[Ke]-p[It])*(p[Ke+1]+p[It+1]);if(vt>0===le)for(Ke=0,Ct=p.length;Ke<Ct/2;Ke+=2){var Ft=p[Ke],ut=p[Ke+1];p[Ke]=p[Ct-2-Ke],p[Ke+1]=p[Ct-1-Ke],p[Ct-2-Ke]=Ft,p[Ct-1-Ke]=ut}}(ce,de),Z.push(ce)}}function yt(Z,ie){var ue=(ie=this.options=function(Oe,de){for(var be in de)Oe[be]=de[be];return Oe}(Object.create(this.options),ie)).debug;if(ue&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var ve=function(Oe,de){var be=[];if(Oe.type==="FeatureCollection")for(var ce=0;ce<Oe.features.length;ce++)Jn(be,Oe.features[ce],de,ce);else Jn(be,Oe.type==="Feature"?Oe:{geometry:Oe},de);return be}(Z,ie);this.tiles={},this.tileCoords=[],ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ve=function(Oe,de){var be=de.buffer/de.extent,ce=Oe,Se=Ut(Oe,1,-1-be,be,0,-1,2,de),p=Ut(Oe,1,1-be,2+be,0,-1,2,de);return(Se||p)&&(ce=Ut(Oe,1,-be,1+be,0,-1,2,de)||[],Se&&(ce=sr(Se,1).concat(ce)),p&&(ce=ce.concat(sr(p,-1)))),ce}(ve,ie)).length&&this.splitTile(ve,0,0,0),ue&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Et(Z,ie,ue){return 32*((1<<Z)*ue+ie)+Z}function Ee(Z,ie){var ue=Z.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);var ve=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!ve)return ie(null,null);var Oe=new Q(ve.features),de=_e(Oe);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),ie(null,{vectorTile:Oe,rawData:de.buffer})}$t.prototype.load=function(Z){var ie=this.options,ue=ie.log,ve=ie.minZoom,Oe=ie.maxZoom,de=ie.nodeSize;ue&&console.time("total time");var be="prepare "+Z.length+" points";ue&&console.time(be),this.points=Z;for(var ce=[],Se=0;Se<Z.length;Se++)Z[Se].geometry&&ce.push(Lt(Z[Se],Se));this.trees[Oe+1]=new nt(ce,hr,pr,de,Float32Array),ue&&console.timeEnd(be);for(var p=Oe;p>=ve;p--){var le=+Date.now();ce=this._cluster(ce,p),this.trees[p]=new nt(ce,hr,pr,de,Float32Array),ue&&console.log("z%d: %d clusters in %dms",p,ce.length,+Date.now()-le)}return ue&&console.timeEnd("total time"),this},$t.prototype.getClusters=function(Z,ie){var ue=((Z[0]+180)%360+360)%360-180,ve=Math.max(-90,Math.min(90,Z[1])),Oe=Z[2]===180?180:((Z[2]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ue=-180,Oe=180;else if(ue>Oe){var be=this.getClusters([ue,ve,180,de],ie),ce=this.getClusters([-180,ve,Oe,de],ie);return be.concat(ce)}for(var Se=this.trees[this._limitZoom(ie)],p=[],le=0,vt=Se.range(Er(ue),Ar(de),Er(Oe),Ar(ve));le<vt.length;le+=1){var Ke=Se.points[vt[le]];p.push(Ke.numPoints?lr(Ke):this.points[Ke.index])}return p},$t.prototype.getChildren=function(Z){var ie=this._getOriginId(Z),ue=this._getOriginZoom(Z),ve="No cluster with the specified id.",Oe=this.trees[ue];if(!Oe)throw new Error(ve);var de=Oe.points[ie];if(!de)throw new Error(ve);for(var be=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),ce=[],Se=0,p=Oe.within(de.x,de.y,be);Se<p.length;Se+=1){var le=Oe.points[p[Se]];le.parentId===Z&&ce.push(le.numPoints?lr(le):this.points[le.index])}if(ce.length===0)throw new Error(ve);return ce},$t.prototype.getLeaves=function(Z,ie,ue){var ve=[];return this._appendLeaves(ve,Z,ie=ie||10,ue=ue||0,0),ve},$t.prototype.getTile=function(Z,ie,ue){var ve=this.trees[this._limitZoom(Z)],Oe=Math.pow(2,Z),de=this.options,be=de.radius/de.extent,ce=(ue-be)/Oe,Se=(ue+1+be)/Oe,p={features:[]};return this._addTileFeatures(ve.range((ie-be)/Oe,ce,(ie+1+be)/Oe,Se),ve.points,ie,ue,Oe,p),ie===0&&this._addTileFeatures(ve.range(1-be/Oe,ce,1,Se),ve.points,Oe,ue,Oe,p),ie===Oe-1&&this._addTileFeatures(ve.range(0,ce,be/Oe,Se),ve.points,-1,ue,Oe,p),p.features.length?p:null},$t.prototype.getClusterExpansionZoom=function(Z){for(var ie=this._getOriginZoom(Z)-1;ie<=this.options.maxZoom;){var ue=this.getChildren(Z);if(ie++,ue.length!==1)break;Z=ue[0].properties.cluster_id}return ie},$t.prototype._appendLeaves=function(Z,ie,ue,ve,Oe){for(var de=0,be=this.getChildren(ie);de<be.length;de+=1){var ce=be[de],Se=ce.properties;if(Se&&Se.cluster?Oe+Se.point_count<=ve?Oe+=Se.point_count:Oe=this._appendLeaves(Z,Se.cluster_id,ue,ve,Oe):Oe<ve?Oe++:Z.push(ce),Z.length===ue)break}return Oe},$t.prototype._addTileFeatures=function(Z,ie,ue,ve,Oe,de){for(var be=0,ce=Z;be<ce.length;be+=1){var Se=ie[ce[be]],p=Se.numPoints,le={type:1,geometry:[[Math.round(this.options.extent*(Se.x*Oe-ue)),Math.round(this.options.extent*(Se.y*Oe-ve))]],tags:p?tn(Se):this.points[Se.index].properties},vt=void 0;p?vt=Se.id:this.options.generateId?vt=Se.index:this.points[Se.index].id&&(vt=this.points[Se.index].id),vt!==void 0&&(le.id=vt),de.features.push(le)}},$t.prototype._limitZoom=function(Z){return Math.max(this.options.minZoom,Math.min(+Z,this.options.maxZoom+1))},$t.prototype._cluster=function(Z,ie){for(var ue=[],ve=this.options,Oe=ve.reduce,de=ve.minPoints,be=ve.radius/(ve.extent*Math.pow(2,ie)),ce=0;ce<Z.length;ce++){var Se=Z[ce];if(!(Se.zoom<=ie)){Se.zoom=ie;for(var p=this.trees[ie+1],le=p.within(Se.x,Se.y,be),vt=Se.numPoints||1,Ke=vt,Ct=0,It=le;Ct<It.length;Ct+=1){var Ft=p.points[It[Ct]];Ft.zoom>ie&&(Ke+=Ft.numPoints||1)}if(Ke>=de){for(var ut=Se.x*vt,Dt=Se.y*vt,St=Oe&&vt>1?this._map(Se,!0):null,zt=(ce<<5)+(ie+1)+this.points.length,Fr=0,qt=le;Fr<qt.length;Fr+=1){var $r=p.points[qt[Fr]];if(!($r.zoom<=ie)){$r.zoom=ie;var en=$r.numPoints||1;ut+=$r.x*en,Dt+=$r.y*en,$r.parentId=zt,Oe&&(St||(St=this._map(Se,!0)),Oe(St,this._map($r)))}}Se.parentId=zt,ue.push(Jt(ut/Ke,Dt/Ke,zt,Ke,St))}else if(ue.push(Se),Ke>1)for(var Gr=0,Vr=le;Gr<Vr.length;Gr+=1){var Lr=p.points[Vr[Gr]];Lr.zoom<=ie||(Lr.zoom=ie,ue.push(Lr))}}}return ue},$t.prototype._getOriginId=function(Z){return Z-this.points.length>>5},$t.prototype._getOriginZoom=function(Z){return(Z-this.points.length)%32},$t.prototype._map=function(Z,ie){if(Z.numPoints)return ie?In({},Z.properties):Z.properties;var ue=this.points[Z.index].properties,ve=this.options.map(ue);return ie&&ve===ue?In({},ve):ve},yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(Z,ie,ue,ve,Oe,de,be){for(var ce=[Z,ie,ue,ve],Se=this.options,p=Se.debug;ce.length;){ve=ce.pop(),ue=ce.pop(),ie=ce.pop(),Z=ce.pop();var le=1<<ie,vt=Et(ie,ue,ve),Ke=this.tiles[vt];if(!Ke&&(p>1&&console.time("creation"),Ke=this.tiles[vt]=kt(Z,ie,ue,ve,Se),this.tileCoords.push({z:ie,x:ue,y:ve}),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,ue,ve,Ke.numFeatures,Ke.numPoints,Ke.numSimplified),console.timeEnd("creation"));var Ct="z"+ie;this.stats[Ct]=(this.stats[Ct]||0)+1,this.total++}if(Ke.source=Z,Oe){if(ie===Se.maxZoom||ie===Oe)continue;var It=1<<Oe-ie;if(ue!==Math.floor(de/It)||ve!==Math.floor(be/It))continue}else if(ie===Se.indexMaxZoom||Ke.numPoints<=Se.indexMaxPoints)continue;if(Ke.source=null,Z.length!==0){p>1&&console.time("clipping");var Ft,ut,Dt,St,zt,Fr,qt=.5*Se.buffer/Se.extent,$r=.5-qt,en=.5+qt,Gr=1+qt;Ft=ut=Dt=St=null,zt=Ut(Z,le,ue-qt,ue+en,0,Ke.minX,Ke.maxX,Se),Fr=Ut(Z,le,ue+$r,ue+Gr,0,Ke.minX,Ke.maxX,Se),Z=null,zt&&(Ft=Ut(zt,le,ve-qt,ve+en,1,Ke.minY,Ke.maxY,Se),ut=Ut(zt,le,ve+$r,ve+Gr,1,Ke.minY,Ke.maxY,Se),zt=null),Fr&&(Dt=Ut(Fr,le,ve-qt,ve+en,1,Ke.minY,Ke.maxY,Se),St=Ut(Fr,le,ve+$r,ve+Gr,1,Ke.minY,Ke.maxY,Se),Fr=null),p>1&&console.timeEnd("clipping"),ce.push(Ft||[],ie+1,2*ue,2*ve),ce.push(ut||[],ie+1,2*ue,2*ve+1),ce.push(Dt||[],ie+1,2*ue+1,2*ve),ce.push(St||[],ie+1,2*ue+1,2*ve+1)}}},yt.prototype.getTile=function(Z,ie,ue){var ve=this.options,Oe=ve.extent,de=ve.debug;if(Z<0||Z>24)return null;var be=1<<Z,ce=Et(Z,ie=(ie%be+be)%be,ue);if(this.tiles[ce])return Mt(this.tiles[ce],Oe);de>1&&console.log("drilling down to z%d-%d-%d",Z,ie,ue);for(var Se,p=Z,le=ie,vt=ue;!Se&&p>0;)p--,le=Math.floor(le/2),vt=Math.floor(vt/2),Se=this.tiles[Et(p,le,vt)];return Se&&Se.source?(de>1&&console.log("found parent tile z%d-%d-%d",p,le,vt),de>1&&console.time("drilling down"),this.splitTile(Se.source,p,le,vt,Z,ie,ue),de>1&&console.timeEnd("drilling down"),this.tiles[ce]?Mt(this.tiles[ce],Oe):null):null};var Xe=function(Z){function ie(ue,ve,Oe,de){Z.call(this,ue,ve,Oe,Ee),de&&(this.loadGeoJSON=de)}return Z&&(ie.__proto__=Z),(ie.prototype=Object.create(Z&&Z.prototype)).constructor=ie,ie.prototype.loadData=function(ue,ve){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ve,this._pendingLoadDataParams=ue,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ie.prototype._loadData=function(){var ue=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ve=this._pendingCallback,Oe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var de=!!(Oe&&Oe.request&&Oe.request.collectResourceTiming)&&new s.RequestPerformance(Oe.request);this.loadGeoJSON(Oe,function(be,ce){if(be||!ce)return ve(be);if(typeof ce!="object")return ve(new Error("Input data given to '"+Oe.source+"' is not a valid GeoJSON object."));(function Ke(Ct,It){var Ft,ut=Ct&&Ct.type;if(ut==="FeatureCollection")for(Ft=0;Ft<Ct.features.length;Ft++)Ke(Ct.features[Ft],It);else if(ut==="GeometryCollection")for(Ft=0;Ft<Ct.geometries.length;Ft++)Ke(Ct.geometries[Ft],It);else if(ut==="Feature")Ke(Ct.geometry,It);else if(ut==="Polygon")z(Ct.coordinates,It);else if(ut==="MultiPolygon")for(Ft=0;Ft<Ct.coordinates.length;Ft++)z(Ct.coordinates[Ft],It);return Ct})(ce,!0);try{if(Oe.filter){var Se=s.createExpression(Oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(function(Ke){return Ke.key+": "+Ke.message}).join(", "));var p=ce.features.filter(function(Ke){return Se.value.evaluate({zoom:0},Ke)});ce={type:"FeatureCollection",features:p}}ue._geoJSONIndex=Oe.cluster?new $t(function(Ke){var Ct=Ke.superclusterOptions,It=Ke.clusterProperties;if(!It||!Ct)return Ct;for(var Ft={},ut={},Dt={accumulated:null,zoom:0},St={properties:null},zt=Object.keys(It),Fr=0,qt=zt;Fr<qt.length;Fr+=1){var $r=qt[Fr],en=It[$r],Gr=en[0],Vr=s.createExpression(en[1]),Lr=s.createExpression(typeof Gr=="string"?[Gr,["accumulated"],["get",$r]]:Gr);Ft[$r]=Vr.value,ut[$r]=Lr.value}return Ct.map=function(hi){St.properties=hi;for(var Hr={},fr=0,Me=zt;fr<Me.length;fr+=1){var Wt=Me[fr];Hr[Wt]=Ft[Wt].evaluate(Dt,St)}return Hr},Ct.reduce=function(hi,Hr){St.properties=Hr;for(var fr=0,Me=zt;fr<Me.length;fr+=1){var Wt=Me[fr];Dt.accumulated=hi[Wt],hi[Wt]=ut[Wt].evaluate(Dt,St)}},Ct}(Oe)).load(ce.features):function(Ke,Ct){return new yt(Ke,Ct)}(ce,Oe.geojsonVtOptions)}catch(Ke){return ve(Ke)}ue.loaded={};var le={};if(de){var vt=de.finish();vt&&(le.resourceTiming={},le.resourceTiming[Oe.source]=JSON.parse(JSON.stringify(vt)))}ve(null,le)})}},ie.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ie.prototype.reloadTile=function(ue,ve){var Oe=this.loaded;return Oe&&Oe[ue.uid]?Z.prototype.reloadTile.call(this,ue,ve):this.loadTile(ue,ve)},ie.prototype.loadGeoJSON=function(ue,ve){if(ue.request)s.getJSON(ue.request,ve);else{if(typeof ue.data!="string")return ve(new Error("Input data given to '"+ue.source+"' is not a valid GeoJSON object."));try{return ve(null,JSON.parse(ue.data))}catch{return ve(new Error("Input data given to '"+ue.source+"' is not a valid GeoJSON object."))}}},ie.prototype.removeSource=function(ue,ve){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ve()},ie.prototype.getClusterExpansionZoom=function(ue,ve){try{ve(null,this._geoJSONIndex.getClusterExpansionZoom(ue.clusterId))}catch(Oe){ve(Oe)}},ie.prototype.getClusterChildren=function(ue,ve){try{ve(null,this._geoJSONIndex.getChildren(ue.clusterId))}catch(Oe){ve(Oe)}},ie.prototype.getClusterLeaves=function(ue,ve){try{ve(null,this._geoJSONIndex.getLeaves(ue.clusterId,ue.limit,ue.offset))}catch(Oe){ve(Oe)}},ie}(k),ct=function(Z){var ie=this;this.self=Z,this.actor=new s.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:k,geojson:Xe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ue,ve){if(ie.workerSourceTypes[ue])throw new Error('Worker source with name "'+ue+'" already registered.');ie.workerSourceTypes[ue]=ve},this.self.registerRTLTextPlugin=function(ue){if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=ue.applyArabicShaping,s.plugin.processBidirectionalText=ue.processBidirectionalText,s.plugin.processStyledBidirectionalText=ue.processStyledBidirectionalText}};return ct.prototype.setReferrer=function(Z,ie){this.referrer=ie},ct.prototype.setImages=function(Z,ie,ue){for(var ve in this.availableImages[Z]=ie,this.workerSources[Z]){var Oe=this.workerSources[Z][ve];for(var de in Oe)Oe[de].availableImages=ie}ue()},ct.prototype.setLayers=function(Z,ie,ue){this.getLayerIndex(Z).replace(ie),ue()},ct.prototype.updateLayers=function(Z,ie,ue){this.getLayerIndex(Z).update(ie.layers,ie.removedIds),ue()},ct.prototype.loadTile=function(Z,ie,ue){this.getWorkerSource(Z,ie.type,ie.source).loadTile(ie,ue)},ct.prototype.loadDEMTile=function(Z,ie,ue){this.getDEMWorkerSource(Z,ie.source).loadTile(ie,ue)},ct.prototype.reloadTile=function(Z,ie,ue){this.getWorkerSource(Z,ie.type,ie.source).reloadTile(ie,ue)},ct.prototype.abortTile=function(Z,ie,ue){this.getWorkerSource(Z,ie.type,ie.source).abortTile(ie,ue)},ct.prototype.removeTile=function(Z,ie,ue){this.getWorkerSource(Z,ie.type,ie.source).removeTile(ie,ue)},ct.prototype.removeDEMTile=function(Z,ie){this.getDEMWorkerSource(Z,ie.source).removeTile(ie)},ct.prototype.removeSource=function(Z,ie,ue){if(this.workerSources[Z]&&this.workerSources[Z][ie.type]&&this.workerSources[Z][ie.type][ie.source]){var ve=this.workerSources[Z][ie.type][ie.source];delete this.workerSources[Z][ie.type][ie.source],ve.removeSource!==void 0?ve.removeSource(ie,ue):ue()}},ct.prototype.loadWorkerSource=function(Z,ie,ue){try{this.self.importScripts(ie.url),ue()}catch(ve){ue(ve.toString())}},ct.prototype.syncRTLPluginState=function(Z,ie,ue){try{s.plugin.setState(ie);var ve=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ve!=null){this.self.importScripts(ve);var Oe=s.plugin.isParsed();ue(Oe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ve),Oe)}}catch(de){ue(de.toString())}},ct.prototype.getAvailableImages=function(Z){var ie=this.availableImages[Z];return ie||(ie=[]),ie},ct.prototype.getLayerIndex=function(Z){var ie=this.layerIndexes[Z];return ie||(ie=this.layerIndexes[Z]=new g),ie},ct.prototype.getWorkerSource=function(Z,ie,ue){var ve=this;return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][ie]||(this.workerSources[Z][ie]={}),this.workerSources[Z][ie][ue]||(this.workerSources[Z][ie][ue]=new this.workerSourceTypes[ie]({send:function(Oe,de,be){ve.actor.send(Oe,de,be,Z)}},this.getLayerIndex(Z),this.getAvailableImages(Z))),this.workerSources[Z][ie][ue]},ct.prototype.getDEMWorkerSource=function(Z,ie){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][ie]||(this.demWorkerSources[Z][ie]=new j),this.demWorkerSources[Z][ie]},ct.prototype.enforceCacheSizeLimit=function(Z,ie){s.enforceCacheSizeLimit(ie)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ct(self)),ct}),o(["./shared"],function(s){var c=s.createCommonjsModule(function(l){function d(C){return!h(C)}function h(C){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,L,G=new Blob([""],{type:"text/javascript"}),$=URL.createObjectURL(G);try{L=new Worker($),R=!0}catch{R=!1}return L&&L.terminate(),URL.revokeObjectURL($),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var L=R.getContext("2d");if(!L)return!1;var G=L.getImageData(0,0,1,1);return G&&G.width===R.width}()?(m[P=C&&C.failIfMajorPerformanceCaveat]===void 0&&(m[P]=function(R){var L=function($){var te=document.createElement("canvas"),Y=Object.create(d.webGLContextAttributes);return Y.failIfMajorPerformanceCaveat=$,te.probablySupportsContext?te.probablySupportsContext("webgl",Y)||te.probablySupportsContext("experimental-webgl",Y):te.supportsContext?te.supportsContext("webgl",Y)||te.supportsContext("experimental-webgl",Y):te.getContext("webgl",Y)||te.getContext("experimental-webgl",Y)}(R);if(!L)return!1;var G=L.createShader(L.VERTEX_SHADER);return!(!G||L.isContextLost())&&(L.shaderSource(G,"void main() {}"),L.compileShader(G),L.getShaderParameter(G,L.COMPILE_STATUS)===!0)}(P)),m[P]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var P}l.exports?l.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var m={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),f={create:function(l,d,h){var m=s.window.document.createElement(l);return d!==void 0&&(m.className=d),h&&h.appendChild(m),m},createNS:function(l,d){return s.window.document.createElementNS(l,d)}},g=s.window.document&&s.window.document.documentElement.style;function b(l){if(!g)return l[0];for(var d=0;d<l.length;d++)if(l[d]in g)return l[d];return l[0]}var T,S=b(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);f.disableDrag=function(){g&&S&&(T=g[S],g[S]="none")},f.enableDrag=function(){g&&S&&(g[S]=T)};var F=b(["transform","WebkitTransform"]);f.setTransform=function(l,d){l.style[F]=d};var k=!1;try{var U=Object.defineProperty({},"passive",{get:function(){k=!0}});s.window.addEventListener("test",U,U),s.window.removeEventListener("test",U,U)}catch{k=!1}f.addEventListener=function(l,d,h,m){m===void 0&&(m={}),l.addEventListener(d,h,"passive"in m&&k?m:m.capture)},f.removeEventListener=function(l,d,h,m){m===void 0&&(m={}),l.removeEventListener(d,h,"passive"in m&&k?m:m.capture)};var j=function(l){l.preventDefault(),l.stopPropagation(),s.window.removeEventListener("click",j,!0)};function z(l){var d=l.userImage;return!!(d&&d.render&&d.render())&&(l.data.replace(new Uint8Array(d.data.buffer)),!0)}f.suppressClick=function(){s.window.addEventListener("click",j,!0),s.window.setTimeout(function(){s.window.removeEventListener("click",j,!0)},0)},f.mousePos=function(l,d){var h=l.getBoundingClientRect();return new s.Point(d.clientX-h.left-l.clientLeft,d.clientY-h.top-l.clientTop)},f.touchPos=function(l,d){for(var h=l.getBoundingClientRect(),m=[],C=0;C<d.length;C++)m.push(new s.Point(d[C].clientX-h.left-l.clientLeft,d[C].clientY-h.top-l.clientTop));return m},f.mouseButton=function(l){return s.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},f.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var V=function(l){function d(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var m=0,C=this.requestors;m<C.length;m+=1){var P=C[m];this._notify(P.ids,P.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,m){this._validate(h,m)&&(this.images[h]=m)},d.prototype._validate=function(h,m){var C=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new s.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),C=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new s.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),C=!1),this._validateContent(m.content,m)||(this.fire(new s.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),C=!1),C},d.prototype._validateStretch=function(h,m){if(!h)return!0;for(var C=0,P=0,R=h;P<R.length;P+=1){var L=R[P];if(L[0]<C||L[1]<L[0]||m<L[1])return!1;C=L[1]}return!0},d.prototype._validateContent=function(h,m){return!(h&&(h.length!==4||h[0]<0||m.data.width<h[0]||h[1]<0||m.data.height<h[1]||h[2]<0||m.data.width<h[2]||h[3]<0||m.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,m){m.version=this.images[h].version+1,this.images[h]=m,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var m=this.images[h];delete this.images[h],delete this.patterns[h],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,m){var C=!0;if(!this.isLoaded())for(var P=0,R=h;P<R.length;P+=1)this.images[R[P]]||(C=!1);this.isLoaded()||C?this._notify(h,m):this.requestors.push({ids:h,callback:m})},d.prototype._notify=function(h,m){for(var C={},P=0,R=h;P<R.length;P+=1){var L=R[P];this.images[L]||this.fire(new s.Event("styleimagemissing",{id:L}));var G=this.images[L];G?C[L]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:!!(G.userImage&&G.userImage.render)}:s.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}m(null,C)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var m=this.patterns[h],C=this.getImage(h);if(!C)return null;if(m&&m.position.version===C.version)return m.position;if(m)m.position.version=C.version;else{var P={w:C.data.width+2,h:C.data.height+2,x:0,y:0},R=new s.ImagePosition(P,C);this.patterns[h]={bin:P,position:R}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var m=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(h,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var m in this.patterns)h.push(this.patterns[m].bin);var C=s.potpack(h),P=C.w,R=C.h,L=this.atlasImage;for(var G in L.resize({width:P||1,height:R||1}),this.patterns){var $=this.patterns[G].bin,te=$.x+1,Y=$.y+1,re=this.images[G].data,ae=re.width,we=re.height;s.RGBAImage.copy(re,L,{x:0,y:0},{x:te,y:Y},{width:ae,height:we}),s.RGBAImage.copy(re,L,{x:0,y:we-1},{x:te,y:Y-1},{width:ae,height:1}),s.RGBAImage.copy(re,L,{x:0,y:0},{x:te,y:Y+we},{width:ae,height:1}),s.RGBAImage.copy(re,L,{x:ae-1,y:0},{x:te-1,y:Y},{width:1,height:we}),s.RGBAImage.copy(re,L,{x:0,y:0},{x:te+ae,y:Y},{width:1,height:we})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var m=0,C=h;m<C.length;m+=1){var P=C[m];if(!this.callbackDispatchedThisFrame[P]){this.callbackDispatchedThisFrame[P]=!0;var R=this.images[P];z(R)&&this.updateImage(P,R)}}},d}(s.Evented),K=oe,fe=oe,Q=1e20;function oe(l,d,h,m,C,P){this.fontSize=l||24,this.buffer=d===void 0?3:d,this.cutoff=m||.25,this.fontFamily=C||"sans-serif",this.fontWeight=P||"normal",this.radius=h||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Te(l,d,h,m,C,P,R){for(var L=0;L<d;L++){for(var G=0;G<h;G++)m[G]=l[G*d+L];for(ze(m,C,P,R,h),G=0;G<h;G++)l[G*d+L]=C[G]}for(G=0;G<h;G++){for(L=0;L<d;L++)m[L]=l[G*d+L];for(ze(m,C,P,R,d),L=0;L<d;L++)l[G*d+L]=Math.sqrt(C[L])}}function ze(l,d,h,m,C){h[0]=0,m[0]=-1e20,m[1]=1e20;for(var P=1,R=0;P<C;P++){for(var L=(l[P]+P*P-(l[h[R]]+h[R]*h[R]))/(2*P-2*h[R]);L<=m[R];)R--,L=(l[P]+P*P-(l[h[R]]+h[R]*h[R]))/(2*P-2*h[R]);h[++R]=P,m[R]=L,m[R+1]=1e20}for(P=0,R=0;P<C;P++){for(;m[R+1]<P;)R++;d[P]=(P-h[R])*(P-h[R])+l[h[R]]}}oe.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),m=0;m<this.size*this.size;m++){var C=d.data[4*m+3]/255;this.gridOuter[m]=C===1?0:C===0?Q:Math.pow(Math.max(0,.5-C),2),this.gridInner[m]=C===1?Q:C===0?0:Math.pow(Math.max(0,C-.5),2)}for(Te(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Te(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),m=0;m<this.size*this.size;m++)h[m]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[m]-this.gridInner[m])/this.radius+this.cutoff))));return h},K.default=fe;var Ae=function(l,d){this.requestManager=l,this.localIdeographFontFamily=d,this.entries={}};Ae.prototype.setURL=function(l){this.url=l},Ae.prototype.getGlyphs=function(l,d){var h=this,m=[];for(var C in l)for(var P=0,R=l[C];P<R.length;P+=1)m.push({stack:C,id:R[P]});s.asyncAll(m,function(L,G){var $=L.stack,te=L.id,Y=h.entries[$];Y||(Y=h.entries[$]={glyphs:{},requests:{},ranges:{}});var re=Y.glyphs[te];if(re===void 0){if(re=h._tinySDF(Y,$,te))return Y.glyphs[te]=re,void G(null,{stack:$,id:te,glyph:re});var ae=Math.floor(te/256);if(256*ae>65535)G(new Error("glyphs > 65535 not supported"));else if(Y.ranges[ae])G(null,{stack:$,id:te,glyph:re});else{var we=Y.requests[ae];we||(we=Y.requests[ae]=[],Ae.loadGlyphRange($,ae,h.url,h.requestManager,function(De,me){if(me){for(var Fe in me)h._doesCharSupportLocalGlyph(+Fe)||(Y.glyphs[+Fe]=me[+Fe]);Y.ranges[ae]=!0}for(var He=0,We=we;He<We.length;He+=1)(0,We[He])(De,me);delete Y.requests[ae]})),we.push(function(De,me){De?G(De):me&&G(null,{stack:$,id:te,glyph:me[te]||null})})}}else G(null,{stack:$,id:te,glyph:re})},function(L,G){if(L)d(L);else if(G){for(var $={},te=0,Y=G;te<Y.length;te+=1){var re=Y[te],ae=re.stack,we=re.id,De=re.glyph;($[ae]||($[ae]={}))[we]=De&&{id:De.id,bitmap:De.bitmap.clone(),metrics:De.metrics}}d(null,$)}})},Ae.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(s.isChar["CJK Unified Ideographs"](l)||s.isChar["Hangul Syllables"](l)||s.isChar.Hiragana(l)||s.isChar.Katakana(l))},Ae.prototype._tinySDF=function(l,d,h){var m=this.localIdeographFontFamily;if(m&&this._doesCharSupportLocalGlyph(h)){var C=l.tinySDF;if(!C){var P="400";/bold/i.test(d)?P="900":/medium/i.test(d)?P="500":/light/i.test(d)&&(P="200"),C=l.tinySDF=new Ae.TinySDF(24,3,8,.25,m,P)}return{id:h,bitmap:new s.AlphaImage({width:30,height:30},C.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Ae.loadGlyphRange=function(l,d,h,m,C){var P=256*d,R=P+255,L=m.transformRequest(m.normalizeGlyphsURL(h).replace("{fontstack}",l).replace("{range}",P+"-"+R),s.ResourceType.Glyphs);s.getArrayBuffer(L,function(G,$){if(G)C(G);else if($){for(var te={},Y=0,re=s.parseGlyphPBF($);Y<re.length;Y+=1){var ae=re[Y];te[ae.id]=ae}C(null,te)}})},Ae.TinySDF=K;var _e=function(){this.specification=s.styleSpec.light.position};_e.prototype.possiblyEvaluate=function(l,d){return s.sphericalToCartesian(l.expression.evaluate(d))},_e.prototype.interpolate=function(l,d,h){return{x:s.number(l.x,d.x,h),y:s.number(l.y,d.y,h),z:s.number(l.z,d.z,h)}};var pe=new s.Properties({anchor:new s.DataConstantProperty(s.styleSpec.light.anchor),position:new _e,color:new s.DataConstantProperty(s.styleSpec.light.color),intensity:new s.DataConstantProperty(s.styleSpec.light.intensity)}),X=function(l){function d(h){l.call(this),this._transitionable=new s.Transitionable(pe),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,m){if(m===void 0&&(m={}),!this._validate(s.validateLight,h,m))for(var C in h){var P=h[C];s.endsWith(C,"-transition")?this._transitionable.setTransition(C.slice(0,-11),P):this._transitionable.setValue(C,P)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,m,C){return(!C||C.validate!==!1)&&s.emitValidationErrors(this,h.call(s.validateStyle,s.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:s.styleSpec})))},d}(s.Evented),ne=function(l,d){this.width=l,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ne.prototype.getDash=function(l,d){var h=l.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(l,d)),this.dashEntry[h]},ne.prototype.getDashRanges=function(l,d,h){var m=[],C=l.length%2==1?-l[l.length-1]*h:0,P=l[0]*h,R=!0;m.push({left:C,right:P,isDash:R,zeroLength:l[0]===0});for(var L=l[0],G=1;G<l.length;G++){var $=l[G];m.push({left:C=L*h,right:P=(L+=$)*h,isDash:R=!R,zeroLength:$===0})}return m},ne.prototype.addRoundDash=function(l,d,h){for(var m=d/2,C=-h;C<=h;C++)for(var P=this.width*(this.nextRow+h+C),R=0,L=l[R],G=0;G<this.width;G++){G/L.right>1&&(L=l[++R]);var $=Math.abs(G-L.left),te=Math.abs(G-L.right),Y=Math.min($,te),re=void 0,ae=C/h*(m+1);if(L.isDash){var we=m-Math.abs(ae);re=Math.sqrt(Y*Y+we*we)}else re=m-Math.sqrt(Y*Y+ae*ae);this.data[P+G]=Math.max(0,Math.min(255,re+128))}},ne.prototype.addRegularDash=function(l){for(var d=l.length-1;d>=0;--d){var h=l[d],m=l[d+1];h.zeroLength?l.splice(d,1):m&&m.isDash===h.isDash&&(m.left=h.left,l.splice(d,1))}var C=l[0],P=l[l.length-1];C.isDash===P.isDash&&(C.left=P.left-this.width,P.right=C.right+this.width);for(var R=this.width*this.nextRow,L=0,G=l[L],$=0;$<this.width;$++){$/G.right>1&&(G=l[++L]);var te=Math.abs($-G.left),Y=Math.abs($-G.right),re=Math.min(te,Y);this.data[R+$]=Math.max(0,Math.min(255,(G.isDash?re:-re)+128))}},ne.prototype.addDash=function(l,d){var h=d?7:0,m=2*h+1;if(this.nextRow+m>this.height)return s.warnOnce("LineAtlas out of space"),null;for(var C=0,P=0;P<l.length;P++)C+=l[P];if(C!==0){var R=this.width/C,L=this.getDashRanges(l,this.width,R);d?this.addRoundDash(L,R,h):this.addRegularDash(L)}var G={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:C};return this.nextRow+=m,this.dirty=!0,G},ne.prototype.bind=function(l){var d=l.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var Be=function l(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=s.uniqueId();for(var m=this.workerPool.acquire(this.id),C=0;C<m.length;C++){var P=new l.Actor(m[C],h,this.id);P.name="Worker "+C,this.actors.push(P)}};function Ze(l,d,h){var m=function(C,P){if(C)return h(C);if(P){var R=s.pick(s.extend(P,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(R.vectorLayers=P.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(L){return L.id})),R.tiles=d.canonicalizeTileset(R,l.url),h(null,R)}};return l.url?s.getJSON(d.transformRequest(d.normalizeSourceURL(l.url),s.ResourceType.Source),m):s.browser.frame(function(){return m(null,l)})}Be.prototype.broadcast=function(l,d,h){s.asyncAll(this.actors,function(m,C){m.send(l,d,C)},h=h||function(){})},Be.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Be.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Be.Actor=s.Actor;var Ce=function(l,d,h){this.bounds=s.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=h||24};Ce.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Ce.prototype.contains=function(l){var d=Math.pow(2,l.z),h=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*d),m=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*d),C=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*d),P=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*d);return l.x>=h&&l.x<C&&l.y>=m&&l.y<P};var Ne=function(l){function d(h,m,C,P){if(l.call(this),this.id=h,this.dispatcher=C,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(m,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(P)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ze(this._options,this.map._requestManager,function(m,C){h._tileJSONRequest=null,h._loaded=!0,m?h.fire(new s.ErrorEvent(m)):C&&(s.extend(h,C),C.bounds&&(h.tileBounds=new Ce(C.bounds,h.minzoom,h.maxzoom)),s.postTurnstileEvent(C.tiles,h.map._requestManager._customAccessToken),s.postMapLoadEvent(C.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var m=this;return this.setSourceProperty(function(){m._options.tiles=h}),this},d.prototype.setUrl=function(h){var m=this;return this.setSourceProperty(function(){m.url=h,m._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return s.extend({},this._options)},d.prototype.loadTile=function(h,m){var C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),P={request:this.map._requestManager.transformRequest(C,s.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(L,G){return delete h.request,h.aborted?m(null):L&&L.status!==404?m(L):(G&&G.resourceTiming&&(h.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&h.setExpiryData(G),h.loadVectorData(G,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}P.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=m:h.request=h.actor.send("reloadTile",P,R.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",P,R.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(s.Evented),Ge=function(l){function d(h,m,C,P){l.call(this),this.id=h,this.dispatcher=C,this.setEventedParent(P),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},m),s.extend(this,s.pick(m,["url","scheme","tileSize"]))}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ze(this._options,this.map._requestManager,function(m,C){h._tileJSONRequest=null,h._loaded=!0,m?h.fire(new s.ErrorEvent(m)):C&&(s.extend(h,C),C.bounds&&(h.tileBounds=new Ce(C.bounds,h.minzoom,h.maxzoom)),s.postTurnstileEvent(C.tiles),s.postMapLoadEvent(C.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return s.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,m){var C=this,P=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=s.getImage(this.map._requestManager.transformRequest(P,s.ResourceType.Tile),function(R,L){if(delete h.request,h.aborted)h.state="unloaded",m(null);else if(R)h.state="errored",m(R);else if(L){C.map._refreshExpiredTiles&&h.setExpiryData(L),delete L.cacheControl,delete L.expires;var G=C.map.painter.context,$=G.gl;h.texture=C.map.painter.getTileTexture(L.width),h.texture?h.texture.update(L,{useMipmap:!0}):(h.texture=new s.Texture(G,L,$.RGBA,{useMipmap:!0}),h.texture.bind($.LINEAR,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&$.texParameterf($.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),h.state="loaded",s.cacheEntryPossiblyAdded(C.dispatcher),m(null)}})},d.prototype.abortTile=function(h,m){h.request&&(h.request.cancel(),delete h.request),m()},d.prototype.unloadTile=function(h,m){h.texture&&this.map.painter.saveTileTexture(h.texture),m()},d.prototype.hasTransition=function(){return!1},d}(s.Evented),Qe=function(l){function d(h,m,C,P){l.call(this,h,m,C,P),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox"}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,m){var C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function P(R,L){R&&(h.state="errored",m(R)),L&&(h.dem=L,h.needsHillshadePrepare=!0,h.state="loaded",m(null))}h.request=s.getImage(this.map._requestManager.transformRequest(C,s.ResourceType.Tile),(function(R,L){if(delete h.request,h.aborted)h.state="unloaded",m(null);else if(R)h.state="errored",m(R);else if(L){this.map._refreshExpiredTiles&&h.setExpiryData(L),delete L.cacheControl,delete L.expires;var G=s.window.ImageBitmap&&L instanceof s.window.ImageBitmap&&s.offscreenCanvasSupported()?L:s.browser.getImageData(L,1),$={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:G,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",$,P.bind(this)))}}).bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var m=h.canonical,C=Math.pow(2,m.z),P=(m.x-1+C)%C,R=m.x===0?h.wrap-1:h.wrap,L=(m.x+1+C)%C,G=m.x+1===C?h.wrap+1:h.wrap,$={};return $[new s.OverscaledTileID(h.overscaledZ,R,m.z,P,m.y).key]={backfilled:!1},$[new s.OverscaledTileID(h.overscaledZ,G,m.z,L,m.y).key]={backfilled:!1},m.y>0&&($[new s.OverscaledTileID(h.overscaledZ,R,m.z,P,m.y-1).key]={backfilled:!1},$[new s.OverscaledTileID(h.overscaledZ,h.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},$[new s.OverscaledTileID(h.overscaledZ,G,m.z,L,m.y-1).key]={backfilled:!1}),m.y+1<C&&($[new s.OverscaledTileID(h.overscaledZ,R,m.z,P,m.y+1).key]={backfilled:!1},$[new s.OverscaledTileID(h.overscaledZ,h.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},$[new s.OverscaledTileID(h.overscaledZ,G,m.z,L,m.y+1).key]={backfilled:!1}),$},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(Ge),rt=function(l){function d(h,m,C,P){l.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=C.getActor(),this.setEventedParent(P),this._data=m.data,this._options=s.extend({},m),this._collectResourceTiming=m.collectResourceTiming,this._resourceTiming=[],m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;var R=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*R,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*R,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?Math.min(m.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:s.EXTENT,radius:(m.clusterRadius||50)*R,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(m){if(m)h.fire(new s.ErrorEvent(m));else{var C={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(C.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new s.Event("data",C))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var m=this;return this._data=h,this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(C){if(C)m.fire(new s.ErrorEvent(C));else{var P={dataType:"source",sourceDataType:"content"};m._collectResourceTiming&&m._resourceTiming&&m._resourceTiming.length>0&&(P.resourceTiming=m._resourceTiming,m._resourceTiming=[]),m.fire(new s.Event("data",P))}}),this},d.prototype.getClusterExpansionZoom=function(h,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},m),this},d.prototype.getClusterChildren=function(h,m){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},m),this},d.prototype.getClusterLeaves=function(h,m,C,P){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:m,offset:C},P),this},d.prototype._updateWorkerData=function(h){var m=this;this._loaded=!1;var C=s.extend({},this.workerOptions),P=this._data;typeof P=="string"?(C.request=this.map._requestManager.transformRequest(s.browser.resolveURL(P),s.ResourceType.Source),C.request.collectResourceTiming=this._collectResourceTiming):C.data=JSON.stringify(P),this.actor.send(this.type+".loadData",C,function(R,L){m._removed||L&&L.abandoned||(m._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[m.id]&&(m._resourceTiming=L.resourceTiming[m.id].slice(0)),m.actor.send(m.type+".coalesce",{source:C.source},null),h(R))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,m){var C=this,P=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(P,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,L){return delete h.request,h.unloadVectorData(),h.aborted?m(null):R?m(R):(h.loadVectorData(L,C.map.painter,P==="reloadTile"),m(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return s.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(s.Evented),tt=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),lt=function(l){function d(h,m,C,P){l.call(this),this.id=h,this.dispatcher=C,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(P),this.options=m}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(h,m){var C=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),function(P,R){C._loaded=!0,P?C.fire(new s.ErrorEvent(P)):R&&(C.image=R,h&&(C.coordinates=h),m&&m(),C._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var m=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){m.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var m=this;this.coordinates=h;var C=h.map(s.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var L=1/0,G=1/0,$=-1/0,te=-1/0,Y=0,re=R;Y<re.length;Y+=1){var ae=re[Y];L=Math.min(L,ae.x),G=Math.min(G,ae.y),$=Math.max($,ae.x),te=Math.max(te,ae.y)}var we=Math.max($-L,te-G),De=Math.max(0,Math.floor(-Math.log(we)/Math.LN2)),me=Math.pow(2,De);return new s.CanonicalTileID(De,Math.floor((L+$)/2*me),Math.floor((G+te)/2*me))}(C),this.minzoom=this.maxzoom=this.tileID.z;var P=C.map(function(R){return m.tileID.getTilePoint(R)._round()});return this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(P[0].x,P[0].y,0,0),this._boundsArray.emplaceBack(P[1].x,P[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(P[3].x,P[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(P[2].x,P[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,m=h.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(h,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[C];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.loadTile=function(h,m){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},m(null)):(h.state="errored",m(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(s.Evented),mt=function(l){function d(h,m,C,P){l.call(this,h,m,C,P),this.roundZoom=!0,this.type="video",this.options=m}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var m=this.options;this.urls=[];for(var C=0,P=m.urls;C<P.length;C+=1)this.urls.push(this.map._requestManager.transformRequest(P[C],s.ResourceType.Source).url);s.getVideo(this.urls,function(R,L){h._loaded=!0,R?h.fire(new s.ErrorEvent(R)):L&&(h.video=L,h.video.loop=!0,h.video.setAttribute("playsinline",""),h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var m=this.video.seekable;h<m.start(0)||h>m.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+m.start(0)+" and "+m.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,m=h.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(h,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[C];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(lt),Tt=function(l){function d(h,m,C,P){l.call(this,h,m,C,P),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(L){return typeof L!="number"})})||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var m=this.map.painter.context,C=m.gl;for(var P in this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(m,this.canvas,C.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[P];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,m=[this.canvas.width,this.canvas.height];h<m.length;h+=1){var C=m[h];if(isNaN(C)||C<=0)return!0}return!1},d}(lt),nt={vector:Ne,raster:Ge,"raster-dem":Qe,geojson:rt,video:mt,image:lt,canvas:Tt};function cr(l,d){var h=s.identity([]);return s.translate(h,h,[1,1,0]),s.scale(h,h,[.5*l.width,.5*l.height,1]),s.multiply(h,h,l.calculatePosMatrix(d.toUnwrapped()))}function $t(l,d,h,m,C,P){var R=function(De,me,Fe){if(De)for(var He=0,We=De;He<We.length;He+=1){var it=me[We[He]];if(it&&it.source===Fe&&it.type==="fill-extrusion")return!0}else for(var $e in me){var et=me[$e];if(et.source===Fe&&et.type==="fill-extrusion")return!0}return!1}(C&&C.layers,d,l.id),L=P.maxPitchScaleFactor(),G=l.tilesIn(m,L,R);G.sort(Jt);for(var $=[],te=0,Y=G;te<Y.length;te+=1){var re=Y[te];$.push({wrappedTileID:re.tileID.wrapped().key,queryResults:re.tile.queryRenderedFeatures(d,h,l._state,re.queryGeometry,re.cameraQueryGeometry,re.scale,C,P,L,cr(l.transform,re.tileID))})}var ae=function(De){for(var me={},Fe={},He=0,We=De;He<We.length;He+=1){var it=We[He],$e=it.queryResults,et=it.wrappedTileID,ht=Fe[et]=Fe[et]||{};for(var Rt in $e)for(var xt=$e[Rt],Nt=ht[Rt]=ht[Rt]||{},rr=me[Rt]=me[Rt]||[],vr=0,Cr=xt;vr<Cr.length;vr+=1){var pn=Cr[vr];Nt[pn.featureIndex]||(Nt[pn.featureIndex]=!0,rr.push(pn))}}return me}($);for(var we in ae)ae[we].forEach(function(De){var me=De.feature,Fe=l.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=Fe});return ae}function Jt(l,d){var h=l.tileID,m=d.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}var Lt=function(l,d){this.max=l,this.onRemove=d,this.reset()};Lt.prototype.reset=function(){for(var l in this.data)for(var d=0,h=this.data[l];d<h.length;d+=1){var m=h[d];m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value)}return this.data={},this.order=[],this},Lt.prototype.add=function(l,d,h){var m=this,C=l.wrapped().key;this.data[C]===void 0&&(this.data[C]=[]);var P={value:d,timeout:void 0};if(h!==void 0&&(P.timeout=setTimeout(function(){m.remove(l,P)},h)),this.data[C].push(P),this.order.push(C),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},Lt.prototype.has=function(l){return l.wrapped().key in this.data},Lt.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Lt.prototype._getAndRemoveByKey=function(l){var d=this.data[l].shift();return d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),d.value},Lt.prototype.getByKey=function(l){var d=this.data[l];return d?d[0].value:null},Lt.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Lt.prototype.remove=function(l,d){if(!this.has(l))return this;var h=l.wrapped().key,m=d===void 0?0:this.data[h].indexOf(d),C=this.data[h][m];return this.data[h].splice(m,1),C.timeout&&clearTimeout(C.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(C.value),this.order.splice(this.order.indexOf(h),1),this},Lt.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Lt.prototype.filter=function(l){var d=[];for(var h in this.data)for(var m=0,C=this.data[h];m<C.length;m+=1){var P=C[m];l(P.value)||d.push(P)}for(var R=0,L=d;R<L.length;R+=1){var G=L[R];this.remove(G.value.tileID,G)}};var lr=function(l,d,h){this.context=l;var m=l.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};lr.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},lr.prototype.updateData=function(l){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},lr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var tn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Er=function(l,d,h,m){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=m,this.context=l;var C=l.gl;this.buffer=C.createBuffer(),l.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Er.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Er.prototype.updateData=function(l){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)},Er.prototype.enableAttributes=function(l,d){for(var h=0;h<this.attributes.length;h++){var m=d.attributes[this.attributes[h].name];m!==void 0&&l.enableVertexAttribArray(m)}},Er.prototype.setVertexAttribPointers=function(l,d,h){for(var m=0;m<this.attributes.length;m++){var C=this.attributes[m],P=d.attributes[C.name];P!==void 0&&l.vertexAttribPointer(P,C.components,l[tn[C.type]],!1,this.itemSize,C.offset+this.itemSize*(h||0))}},Er.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ar=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Ar.prototype.get=function(){return this.current},Ar.prototype.set=function(l){},Ar.prototype.getDefault=function(){return this.default},Ar.prototype.setDefault=function(){this.set(this.default)};var In=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return s.Color.transparent},d.prototype.set=function(h){var m=this.current;(h.r!==m.r||h.g!==m.g||h.b!==m.b||h.a!==m.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(Ar),hr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(Ar),pr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(Ar),rn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||h[3]!==m[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(Ar),Sr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(Ar),ti=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(Ar),Jn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var m=this.current;(h.func!==m.func||h.ref!==m.ref||h.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(Ar),un=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(Ar),Kn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(Ar),Nn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(Ar),vn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(Ar),Wn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(Ar),Ut=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.BLEND):m.disable(m.BLEND),this.current=h,this.dirty=!1}},d}(Ar),dr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(Ar),Tr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return s.Color.transparent},d.prototype.set=function(h){var m=this.current;(h.r!==m.r||h.g!==m.g||h.b!==m.b||h.a!==m.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(Ar),Zr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(Ar),fi=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=h,this.dirty=!1}},d}(Ar),Pe=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(Ar),Ot=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(Ar),Vt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(Ar),sr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(Ar),Ye=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||h[3]!==m[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(Ar),Mt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(Ar),ge=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(Ar),kt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindTexture(m.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(Ar),wt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(Ar),W=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(Ar),yt=function(l){function d(h){l.call(this,h),this.vao=h.extVertexArrayObject}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(Ar),Et=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(Ar),Ee=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(Ar),Xe=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(Ar),ct=function(l){function d(h,m){l.call(this,h),this.context=h,this.parent=m}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(Ar),Z=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(ct),ie=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(ct),ue=function(l,d,h,m){this.context=l,this.width=d,this.height=h;var C=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Z(l,C),m&&(this.depthAttachment=new ie(l,C))};ue.prototype.destroy=function(){var l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&l.deleteRenderbuffer(h)}l.deleteFramebuffer(this.framebuffer)};var ve=function(l,d,h){this.func=l,this.mask=d,this.range=h};ve.ReadOnly=!1,ve.ReadWrite=!0,ve.disabled=new ve(519,ve.ReadOnly,[0,1]);var Oe=function(l,d,h,m,C,P){this.test=l,this.ref=d,this.mask=h,this.fail=m,this.depthFail=C,this.pass=P};Oe.disabled=new Oe({func:519,mask:0},0,0,7680,7680,7680);var de=function(l,d,h){this.blendFunction=l,this.blendColor=d,this.mask=h};de.disabled=new de(de.Replace=[1,0],s.Color.transparent,[!1,!1,!1,!1]),de.unblended=new de(de.Replace,s.Color.transparent,[!0,!0,!0,!0]),de.alphaBlended=new de([1,771],s.Color.transparent,[!0,!0,!0,!0]);var be=function(l,d,h){this.enable=l,this.mode=d,this.frontFace=h};be.disabled=new be(!1,1029,2305),be.backCCW=new be(!0,1029,2305);var ce=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new In(this),this.clearDepth=new hr(this),this.clearStencil=new pr(this),this.colorMask=new rn(this),this.depthMask=new Sr(this),this.stencilMask=new ti(this),this.stencilFunc=new Jn(this),this.stencilOp=new un(this),this.stencilTest=new Kn(this),this.depthRange=new Nn(this),this.depthTest=new vn(this),this.depthFunc=new Wn(this),this.blend=new Ut(this),this.blendFunc=new dr(this),this.blendColor=new Tr(this),this.blendEquation=new Zr(this),this.cullFace=new fi(this),this.cullFaceSide=new Pe(this),this.frontFace=new Ot(this),this.program=new Vt(this),this.activeTexture=new sr(this),this.viewport=new Ye(this),this.bindFramebuffer=new Mt(this),this.bindRenderbuffer=new ge(this),this.bindTexture=new kt(this),this.bindVertexBuffer=new wt(this),this.bindElementBuffer=new W(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yt(this),this.pixelStoreUnpack=new Et(this),this.pixelStoreUnpackPremultiplyAlpha=new Ee(this),this.pixelStoreUnpackFlipY=new Xe(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ce.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ce.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ce.prototype.createIndexBuffer=function(l,d){return new lr(this,l,d)},ce.prototype.createVertexBuffer=function(l,d,h){return new Er(this,l,d,h)},ce.prototype.createRenderbuffer=function(l,d,h){var m=this.gl,C=m.createRenderbuffer();return this.bindRenderbuffer.set(C),m.renderbufferStorage(m.RENDERBUFFER,l,d,h),this.bindRenderbuffer.set(null),C},ce.prototype.createFramebuffer=function(l,d,h){return new ue(this,l,d,h)},ce.prototype.clear=function(l){var d=l.color,h=l.depth,m=this.gl,C=0;d&&(C|=m.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(C|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),m.clear(C)},ce.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ce.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ce.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ce.prototype.setColorMode=function(l){s.deepEqual(l.blendFunction,de.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ce.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Se=function(l){function d(h,m,C){var P=this;l.call(this),this.id=h,this.dispatcher=C,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(P._sourceLoaded=!0),P._sourceLoaded&&!P._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(P.reload(),P.transform&&P.update(P.transform))}),this.on("error",function(){P._sourceErrored=!0}),this._source=function(R,L,G,$){var te=new nt[L.type](R,L,G,$);if(te.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+te.id);return s.bindAll(["load","abort","unload","serialize","prepare"],te),te}(h,m,C,this),this._tiles={},this._cache=new Lt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new s.SourceFeatureState}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var m=this._tiles[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,m){return this._source.loadTile(h,m)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var m in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var C=this._tiles[m];C.upload(h),C.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return s.values(this._tiles).map(function(h){return h.tileID}).sort(p).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var m=this,C=[];for(var P in this._tiles)this._isIdRenderable(P,h)&&C.push(this._tiles[P]);return h?C.sort(function(R,L){var G=R.tileID,$=L.tileID,te=new s.Point(G.canonical.x,G.canonical.y)._rotate(m.transform.angle),Y=new s.Point($.canonical.x,$.canonical.y)._rotate(m.transform.angle);return G.overscaledZ-$.overscaledZ||Y.y-te.y||Y.x-te.x}).map(function(R){return R.tileID.key}):C.map(function(R){return R.tileID}).sort(p).map(function(R){return R.key})},d.prototype.hasRenderableParent=function(h){var m=this.findLoadedParent(h,0);return!!m&&this._isIdRenderable(m.tileID.key)},d.prototype._isIdRenderable=function(h,m){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(m||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,m){var C=this._tiles[h];C&&(C.state!=="loading"&&(C.state=m),this._loadTile(C,this._tileLoaded.bind(this,C,h,m)))},d.prototype._tileLoaded=function(h,m,C,P){if(P)return h.state="errored",void(P.status!==404?this._source.fire(new s.ErrorEvent(P,{tile:h})):this.update(this.transform));h.timeAdded=s.browser.now(),C==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(m,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new s.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var m=this.getRenderableIds(),C=0;C<m.length;C++){var P=m[C];if(h.neighboringTiles&&h.neighboringTiles[P]){var R=this.getTileByID(P);L(h,R),L(R,h)}}function L(G,$){G.needsHillshadePrepare=!0;var te=$.tileID.canonical.x-G.tileID.canonical.x,Y=$.tileID.canonical.y-G.tileID.canonical.y,re=Math.pow(2,G.tileID.canonical.z),ae=$.tileID.key;te===0&&Y===0||Math.abs(Y)>1||(Math.abs(te)>1&&(Math.abs(te+re)===1?te+=re:Math.abs(te-re)===1&&(te-=re)),$.dem&&G.dem&&(G.dem.backfillBorder($.dem,te,Y),G.neighboringTiles&&G.neighboringTiles[ae]&&(G.neighboringTiles[ae].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,m,C,P){for(var R in this._tiles){var L=this._tiles[R];if(!(P[R]||!L.hasData()||L.tileID.overscaledZ<=m||L.tileID.overscaledZ>C)){for(var G=L.tileID;L&&L.tileID.overscaledZ>m+1;){var $=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[$.key])&&L.hasData()&&(G=$)}for(var te=G;te.overscaledZ>m;)if(h[(te=te.scaledTo(te.overscaledZ-1)).key]){P[G.key]=G;break}}}},d.prototype.findLoadedParent=function(h,m){if(h.key in this._loadedParentTiles){var C=this._loadedParentTiles[h.key];return C&&C.tileID.overscaledZ>=m?C:null}for(var P=h.overscaledZ-1;P>=m;P--){var R=h.scaledTo(P),L=this._getLoadedTile(R);if(L)return L}},d.prototype._getLoadedTile=function(h){var m=this._tiles[h.key];return m&&m.hasData()?m:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var m=Math.ceil(h.width/this._source.tileSize)+1,C=Math.ceil(h.height/this._source.tileSize)+1,P=Math.floor(m*C*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(R)},d.prototype.handleWrapJump=function(h){var m=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,m){var C={};for(var P in this._tiles){var R=this._tiles[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+m),C[R.tileID.key]=R}for(var L in this._tiles=C,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},d.prototype.update=function(h){var m=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var C;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?C=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(ht){return new s.OverscaledTileID(ht.canonical.z,ht.wrap,ht.canonical.z,ht.canonical.x,ht.canonical.y)}):(C=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(C=C.filter(function(ht){return m._source.hasTile(ht)}))):C=[];var P=h.coveringZoomLevel(this._source),R=Math.max(P-d.maxOverzooming,this._source.minzoom),L=Math.max(P+d.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(C,P);if(le(this._source.type)){for(var $={},te={},Y=0,re=Object.keys(G);Y<re.length;Y+=1){var ae=re[Y],we=G[ae],De=this._tiles[ae];if(De&&!(De.fadeEndTime&&De.fadeEndTime<=s.browser.now())){var me=this.findLoadedParent(we,R);me&&(this._addTile(me.tileID),$[me.tileID.key]=me.tileID),te[ae]=we}}for(var Fe in this._retainLoadedChildren(te,P,L,G),$)G[Fe]||(this._coveredTiles[Fe]=!0,G[Fe]=$[Fe])}for(var He in G)this._tiles[He].clearFadeHold();for(var We=0,it=s.keysDifference(this._tiles,G);We<it.length;We+=1){var $e=it[We],et=this._tiles[$e];et.hasSymbolBuckets&&!et.holdingForFade()?et.setHoldDuration(this.map._fadeDuration):et.hasSymbolBuckets&&!et.symbolFadeFinished()||this._removeTile($e)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,m){for(var C={},P={},R=Math.max(m-d.maxOverzooming,this._source.minzoom),L=Math.max(m+d.maxUnderzooming,this._source.minzoom),G={},$=0,te=h;$<te.length;$+=1){var Y=te[$],re=this._addTile(Y);C[Y.key]=Y,re.hasData()||m<this._source.maxzoom&&(G[Y.key]=Y)}this._retainLoadedChildren(G,m,L,C);for(var ae=0,we=h;ae<we.length;ae+=1){var De=we[ae],me=this._tiles[De.key];if(!me.hasData()){if(m+1>this._source.maxzoom){var Fe=De.children(this._source.maxzoom)[0],He=this.getTile(Fe);if(He&&He.hasData()){C[Fe.key]=Fe;continue}}else{var We=De.children(this._source.maxzoom);if(C[We[0].key]&&C[We[1].key]&&C[We[2].key]&&C[We[3].key])continue}for(var it=me.wasRequested(),$e=De.overscaledZ-1;$e>=R;--$e){var et=De.scaledTo($e);if(P[et.key]||(P[et.key]=!0,!(me=this.getTile(et))&&it&&(me=this._addTile(et)),me&&(C[et.key]=et,it=me.wasRequested(),me.hasData())))break}}}return C},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var m=[],C=void 0,P=this._tiles[h].tileID;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){C=this._loadedParentTiles[P.key];break}m.push(P.key);var R=P.scaledTo(P.overscaledZ-1);if(C=this._getLoadedTile(R))break;P=R}for(var L=0,G=m;L<G.length;L+=1)this._loadedParentTiles[G[L]]=C}},d.prototype._addTile=function(h){var m=this._tiles[h.key];if(m)return m;(m=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,m),m.tileID=h,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,m)));var C=!!m;return C||(m=new s.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,h.key,m.state))),m?(m.uses++,this._tiles[h.key]=m,C||this._source.fire(new s.Event("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m):null},d.prototype._setTileReloadTimer=function(h,m){var C=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var P=m.getExpiryTimeout();P&&(this._timers[h]=setTimeout(function(){C._reloadTile(h,"expired"),delete C._timers[h]},P))},d.prototype._removeTile=function(h){var m=this._tiles[h];m&&(m.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,m,C){var P=this,R=[],L=this.transform;if(!L)return R;for(var G=C?L.getCameraQueryGeometry(h):h,$=h.map(function($e){return L.pointCoordinate($e)}),te=G.map(function($e){return L.pointCoordinate($e)}),Y=this.getIds(),re=1/0,ae=1/0,we=-1/0,De=-1/0,me=0,Fe=te;me<Fe.length;me+=1){var He=Fe[me];re=Math.min(re,He.x),ae=Math.min(ae,He.y),we=Math.max(we,He.x),De=Math.max(De,He.y)}for(var We=function($e){var et=P._tiles[Y[$e]];if(!et.holdingForFade()){var ht=et.tileID,Rt=Math.pow(2,L.zoom-et.tileID.overscaledZ),xt=m*et.queryPadding*s.EXTENT/et.tileSize/Rt,Nt=[ht.getTilePoint(new s.MercatorCoordinate(re,ae)),ht.getTilePoint(new s.MercatorCoordinate(we,De))];if(Nt[0].x-xt<s.EXTENT&&Nt[0].y-xt<s.EXTENT&&Nt[1].x+xt>=0&&Nt[1].y+xt>=0){var rr=$.map(function(Cr){return ht.getTilePoint(Cr)}),vr=te.map(function(Cr){return ht.getTilePoint(Cr)});R.push({tile:et,tileID:ht,queryGeometry:rr,cameraQueryGeometry:vr,scale:Rt})}}},it=0;it<Y.length;it++)We(it);return R},d.prototype.getVisibleCoordinates=function(h){for(var m=this,C=this.getRenderableIds(h).map(function(G){return m._tiles[G].tileID}),P=0,R=C;P<R.length;P+=1){var L=R[P];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return C},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(le(this._source.type))for(var h in this._tiles){var m=this._tiles[h];if(m.fadeEndTime!==void 0&&m.fadeEndTime>=s.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,m,C){this._state.updateState(h=h||"_geojsonTileLayer",m,C)},d.prototype.removeFeatureState=function(h,m,C){this._state.removeFeatureState(h=h||"_geojsonTileLayer",m,C)},d.prototype.getFeatureState=function(h,m){return this._state.getState(h=h||"_geojsonTileLayer",m)},d.prototype.setDependencies=function(h,m,C){var P=this._tiles[h];P&&P.setDependencies(m,C)},d.prototype.reloadTilesForDependencies=function(h,m){for(var C in this._tiles)this._tiles[C].hasDependency(h,m)&&this._reloadTile(C,"reloading");this._cache.filter(function(P){return!P.hasDependency(h,m)})},d}(s.Evented);function p(l,d){var h=Math.abs(2*l.wrap)-+(l.wrap<0),m=Math.abs(2*d.wrap)-+(d.wrap<0);return l.overscaledZ-d.overscaledZ||m-h||d.canonical.y-l.canonical.y||d.canonical.x-l.canonical.x}function le(l){return l==="raster"||l==="image"||l==="video"}function vt(){return new s.window.Worker(O.workerUrl)}Se.maxOverzooming=10,Se.maxUnderzooming=3;var Ke="mapboxgl_preloaded_worker_pool",Ct=function(){this.active={}};Ct.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<Ct.workerCount;)this.workers.push(new vt);return this.active[l]=!0,this.workers.slice()},Ct.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Ct.prototype.isPreloaded=function(){return!!this.active[Ke]},Ct.prototype.numActive=function(){return Object.keys(this.active).length};var It,Ft=Math.floor(s.browser.hardwareConcurrency/2);function ut(){return It||(It=new Ct),It}function Dt(l,d){var h={};for(var m in l)m!=="ref"&&(h[m]=l[m]);return s.refProperties.forEach(function(C){C in d&&(h[C]=d[C])}),h}function St(l){l=l.slice();for(var d=Object.create(null),h=0;h<l.length;h++)d[l[h].id]=l[h];for(var m=0;m<l.length;m++)"ref"in l[m]&&(l[m]=Dt(l[m],d[l[m].ref]));return l}Ct.workerCount=Math.max(Math.min(Ft,6),1);var zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Fr(l,d,h){h.push({command:zt.addSource,args:[l,d[l]]})}function qt(l,d,h){d.push({command:zt.removeSource,args:[l]}),h[l]=!0}function $r(l,d,h,m){qt(l,h,m),Fr(l,d,h)}function en(l,d,h){var m;for(m in l[h])if(l[h].hasOwnProperty(m)&&m!=="data"&&!s.deepEqual(l[h][m],d[h][m]))return!1;for(m in d[h])if(d[h].hasOwnProperty(m)&&m!=="data"&&!s.deepEqual(l[h][m],d[h][m]))return!1;return!0}function Gr(l,d,h,m,C,P){var R;for(R in d=d||{},l=l||{})l.hasOwnProperty(R)&&(s.deepEqual(l[R],d[R])||h.push({command:P,args:[m,R,d[R],C]}));for(R in d)d.hasOwnProperty(R)&&!l.hasOwnProperty(R)&&(s.deepEqual(l[R],d[R])||h.push({command:P,args:[m,R,d[R],C]}))}function Vr(l){return l.id}function Lr(l,d){return l[d.id]=d,l}var hi=function(l,d){this.reset(l,d)};hi.prototype.reset=function(l,d){this.points=l||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},hi.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=s.clamp(l,0,1);for(var d=1,h=this._distances[d],m=l*this.paddedLength+this.padding;h<m&&d<this._distances.length;)h=this._distances[++d];var C=d-1,P=this._distances[C],R=h-P,L=R>0?(m-P)/R:0;return this.points[C].mult(1-L).add(this.points[d].mult(L))};var Hr=function(l,d,h){var m=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(l/h),this.yCellCount=Math.ceil(d/h);for(var P=0;P<this.xCellCount*this.yCellCount;P++)m.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function fr(l,d,h,m,C){var P=s.create();return d?(s.scale(P,P,[1/C,1/C,1]),h||s.rotateZ(P,P,m.angle)):s.multiply(P,m.labelPlaneMatrix,l),P}function Me(l,d,h,m,C){if(d){var P=s.clone(l);return s.scale(P,P,[C,C,1]),h||s.rotateZ(P,P,-m.angle),P}return m.glCoordMatrix}function Wt(l,d){var h=[l.x,l.y,0,1];ni(h,h,d);var m=h[3];return{point:new s.Point(h[0]/m,h[1]/m),signedDistanceFromCamera:m}}function Kr(l,d){return .5+l/d*.5}function Ni(l,d){var h=l[0]/l[3],m=l[1]/l[3];return h>=-d[0]&&h<=d[0]&&m>=-d[1]&&m<=d[1]}function sa(l,d,h,m,C,P,R,L){var G=m?l.textSizeData:l.iconSizeData,$=s.evaluateSizeForZoom(G,h.transform.zoom),te=[256/h.width*2+1,256/h.height*2+1],Y=m?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;Y.clear();for(var re=l.lineVertexArray,ae=m?l.text.placedSymbolArray:l.icon.placedSymbolArray,we=h.transform.width/h.transform.height,De=!1,me=0;me<ae.length;me++){var Fe=ae.get(me);if(Fe.hidden||Fe.writingMode===s.WritingMode.vertical&&!De)Si(Fe.numGlyphs,Y);else{De=!1;var He=[Fe.anchorX,Fe.anchorY,0,1];if(s.transformMat4(He,He,d),Ni(He,te)){var We=Kr(h.transform.cameraToCenterDistance,He[3]),it=s.evaluateSizeForFeature(G,$,Fe),$e=R?it/We:it*We,et=new s.Point(Fe.anchorX,Fe.anchorY),ht=Wt(et,C).point,Rt={},xt=Ie(Fe,$e,!1,L,d,C,P,l.glyphOffsetArray,re,Y,ht,et,Rt,we);De=xt.useVertical,(xt.notEnoughRoom||De||xt.needsFlipping&&Ie(Fe,$e,!0,L,d,C,P,l.glyphOffsetArray,re,Y,ht,et,Rt,we).notEnoughRoom)&&Si(Fe.numGlyphs,Y)}else Si(Fe.numGlyphs,Y)}}m?l.text.dynamicLayoutVertexBuffer.updateData(Y):l.icon.dynamicLayoutVertexBuffer.updateData(Y)}function ri(l,d,h,m,C,P,R,L,G,$,te){var Y=L.glyphStartIndex+L.numGlyphs,re=L.lineStartIndex,ae=L.lineStartIndex+L.lineLength,we=d.getoffsetX(L.glyphStartIndex),De=d.getoffsetX(Y-1),me=Un(l*we,h,m,C,P,R,L.segment,re,ae,G,$,te);if(!me)return null;var Fe=Un(l*De,h,m,C,P,R,L.segment,re,ae,G,$,te);return Fe?{first:me,last:Fe}:null}function kn(l,d,h,m){return l===s.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*m?{useVertical:!0}:(l===s.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function Ie(l,d,h,m,C,P,R,L,G,$,te,Y,re,ae){var we,De=d/24,me=l.lineOffsetX*De,Fe=l.lineOffsetY*De;if(l.numGlyphs>1){var He=l.glyphStartIndex+l.numGlyphs,We=l.lineStartIndex,it=l.lineStartIndex+l.lineLength,$e=ri(De,L,me,Fe,h,te,Y,l,G,P,re);if(!$e)return{notEnoughRoom:!0};var et=Wt($e.first.point,R).point,ht=Wt($e.last.point,R).point;if(m&&!h){var Rt=kn(l.writingMode,et,ht,ae);if(Rt)return Rt}we=[$e.first];for(var xt=l.glyphStartIndex+1;xt<He-1;xt++)we.push(Un(De*L.getoffsetX(xt),me,Fe,h,te,Y,l.segment,We,it,G,P,re));we.push($e.last)}else{if(m&&!h){var Nt=Wt(Y,C).point,rr=l.lineStartIndex+l.segment+1,vr=new s.Point(G.getx(rr),G.gety(rr)),Cr=Wt(vr,C),pn=Cr.signedDistanceFromCamera>0?Cr.point:Do(Y,vr,Nt,1,C),ir=kn(l.writingMode,Nt,pn,ae);if(ir)return ir}var zr=Un(De*L.getoffsetX(l.glyphStartIndex),me,Fe,h,te,Y,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,G,P,re);if(!zr)return{notEnoughRoom:!0};we=[zr]}for(var qr=0,kr=we;qr<kr.length;qr+=1){var Or=kr[qr];s.addDynamicAttributes($,Or.point,Or.angle)}return{}}function Do(l,d,h,m,C){var P=Wt(l.add(l.sub(d)._unit()),C).point,R=h.sub(P);return h.add(R._mult(m/R.mag()))}function Un(l,d,h,m,C,P,R,L,G,$,te,Y){var re=m?l-d:l+d,ae=re>0?1:-1,we=0;m&&(ae*=-1,we=Math.PI),ae<0&&(we+=Math.PI);for(var De=ae>0?L+R:L+R+1,me=C,Fe=C,He=0,We=0,it=Math.abs(re),$e=[];He+We<=it;){if((De+=ae)<L||De>=G)return null;if(Fe=me,$e.push(me),(me=Y[De])===void 0){var et=new s.Point($.getx(De),$.gety(De)),ht=Wt(et,te);if(ht.signedDistanceFromCamera>0)me=Y[De]=ht.point;else{var Rt=De-ae;me=Do(He===0?P:new s.Point($.getx(Rt),$.gety(Rt)),et,Fe,it-He+1,te)}}He+=We,We=Fe.dist(me)}var xt=(it-He)/We,Nt=me.sub(Fe),rr=Nt.mult(xt)._add(Fe);rr._add(Nt._unit()._perp()._mult(h*ae));var vr=we+Math.atan2(me.y-Fe.y,me.x-Fe.x);return $e.push(rr),{point:rr,angle:vr,path:$e}}Hr.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Hr.prototype.insert=function(l,d,h,m,C){this._forEachCell(d,h,m,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(C)},Hr.prototype.insertCircle=function(l,d,h,m){this._forEachCell(d-m,h-m,d+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(h),this.circles.push(m)},Hr.prototype._insertBoxCell=function(l,d,h,m,C,P){this.boxCells[C].push(P)},Hr.prototype._insertCircleCell=function(l,d,h,m,C,P){this.circleCells[C].push(P)},Hr.prototype._query=function(l,d,h,m,C,P){if(h<0||l>this.width||m<0||d>this.height)return!C&&[];var R=[];if(l<=0&&d<=0&&this.width<=h&&this.height<=m){if(C)return!0;for(var L=0;L<this.boxKeys.length;L++)R.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var G=0;G<this.circleKeys.length;G++){var $=this.circles[3*G],te=this.circles[3*G+1],Y=this.circles[3*G+2];R.push({key:this.circleKeys[G],x1:$-Y,y1:te-Y,x2:$+Y,y2:te+Y})}return P?R.filter(P):R}return this._forEachCell(l,d,h,m,this._queryCell,R,{hitTest:C,seenUids:{box:{},circle:{}}},P),C?R.length>0:R},Hr.prototype._queryCircle=function(l,d,h,m,C){var P=l-h,R=l+h,L=d-h,G=d+h;if(R<0||P>this.width||G<0||L>this.height)return!m&&[];var $=[];return this._forEachCell(P,L,R,G,this._queryCellCircle,$,{hitTest:m,circle:{x:l,y:d,radius:h},seenUids:{box:{},circle:{}}},C),m?$.length>0:$},Hr.prototype.query=function(l,d,h,m,C){return this._query(l,d,h,m,!1,C)},Hr.prototype.hitTest=function(l,d,h,m,C){return this._query(l,d,h,m,!0,C)},Hr.prototype.hitTestCircle=function(l,d,h,m){return this._queryCircle(l,d,h,!0,m)},Hr.prototype._queryCell=function(l,d,h,m,C,P,R,L){var G=R.seenUids,$=this.boxCells[C];if($!==null)for(var te=this.bboxes,Y=0,re=$;Y<re.length;Y+=1){var ae=re[Y];if(!G.box[ae]){G.box[ae]=!0;var we=4*ae;if(l<=te[we+2]&&d<=te[we+3]&&h>=te[we+0]&&m>=te[we+1]&&(!L||L(this.boxKeys[ae]))){if(R.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[ae],x1:te[we],y1:te[we+1],x2:te[we+2],y2:te[we+3]})}}}var De=this.circleCells[C];if(De!==null)for(var me=this.circles,Fe=0,He=De;Fe<He.length;Fe+=1){var We=He[Fe];if(!G.circle[We]){G.circle[We]=!0;var it=3*We;if(this._circleAndRectCollide(me[it],me[it+1],me[it+2],l,d,h,m)&&(!L||L(this.circleKeys[We]))){if(R.hitTest)return P.push(!0),!0;var $e=me[it],et=me[it+1],ht=me[it+2];P.push({key:this.circleKeys[We],x1:$e-ht,y1:et-ht,x2:$e+ht,y2:et+ht})}}}},Hr.prototype._queryCellCircle=function(l,d,h,m,C,P,R,L){var G=R.circle,$=R.seenUids,te=this.boxCells[C];if(te!==null)for(var Y=this.bboxes,re=0,ae=te;re<ae.length;re+=1){var we=ae[re];if(!$.box[we]){$.box[we]=!0;var De=4*we;if(this._circleAndRectCollide(G.x,G.y,G.radius,Y[De+0],Y[De+1],Y[De+2],Y[De+3])&&(!L||L(this.boxKeys[we])))return P.push(!0),!0}}var me=this.circleCells[C];if(me!==null)for(var Fe=this.circles,He=0,We=me;He<We.length;He+=1){var it=We[He];if(!$.circle[it]){$.circle[it]=!0;var $e=3*it;if(this._circlesCollide(Fe[$e],Fe[$e+1],Fe[$e+2],G.x,G.y,G.radius)&&(!L||L(this.circleKeys[it])))return P.push(!0),!0}}},Hr.prototype._forEachCell=function(l,d,h,m,C,P,R,L){for(var G=this._convertToXCellCoord(l),$=this._convertToYCellCoord(d),te=this._convertToXCellCoord(h),Y=this._convertToYCellCoord(m),re=G;re<=te;re++)for(var ae=$;ae<=Y;ae++)if(C.call(this,l,d,h,m,this.xCellCount*ae+re,P,R,L))return},Hr.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Hr.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Hr.prototype._circlesCollide=function(l,d,h,m,C,P){var R=m-l,L=C-d,G=h+P;return G*G>R*R+L*L},Hr.prototype._circleAndRectCollide=function(l,d,h,m,C,P,R){var L=(P-m)/2,G=Math.abs(l-(m+L));if(G>L+h)return!1;var $=(R-C)/2,te=Math.abs(d-(C+$));if(te>$+h)return!1;if(G<=L||te<=$)return!0;var Y=G-L,re=te-$;return Y*Y+re*re<=h*h};var Oo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Si(l,d){for(var h=0;h<l;h++){var m=d.length;d.resize(m+4),d.float32.set(Oo,3*m)}}function ni(l,d,h){var m=d[0],C=d[1];return l[0]=h[0]*m+h[4]*C+h[12],l[1]=h[1]*m+h[5]*C+h[13],l[3]=h[3]*m+h[7]*C+h[15],l}var wi=function(l,d,h){d===void 0&&(d=new Hr(l.width+200,l.height+200,25)),h===void 0&&(h=new Hr(l.width+200,l.height+200,25)),this.transform=l,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Tn(l,d,h){return d*(s.EXTENT/(l.tileSize*Math.pow(2,h-l.tileID.overscaledZ)))}wi.prototype.placeCollisionBox=function(l,d,h,m,C){var P=this.projectAndGetPerspectiveRatio(m,l.anchorPointX,l.anchorPointY),R=h*P.perspectiveRatio,L=l.x1*R+P.point.x,G=l.y1*R+P.point.y,$=l.x2*R+P.point.x,te=l.y2*R+P.point.y;return!this.isInsideGrid(L,G,$,te)||!d&&this.grid.hitTest(L,G,$,te,C)?{box:[],offscreen:!1}:{box:[L,G,$,te],offscreen:this.isOffscreen(L,G,$,te)}},wi.prototype.placeCollisionCircles=function(l,d,h,m,C,P,R,L,G,$,te,Y,re){var ae=[],we=new s.Point(d.anchorX,d.anchorY),De=Wt(we,P),me=Kr(this.transform.cameraToCenterDistance,De.signedDistanceFromCamera),Fe=($?C/me:C*me)/s.ONE_EM,He=Wt(we,R).point,We=ri(Fe,m,d.lineOffsetX*Fe,d.lineOffsetY*Fe,!1,He,we,d,h,R,{}),it=!1,$e=!1,et=!0;if(We){for(var ht=.5*Y*me+re,Rt=new s.Point(-100,-100),xt=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),Nt=new hi,rr=We.first,vr=We.last,Cr=[],pn=rr.path.length-1;pn>=1;pn--)Cr.push(rr.path[pn]);for(var ir=1;ir<vr.path.length;ir++)Cr.push(vr.path[ir]);var zr=2.5*ht;if(L){var qr=Cr.map(function(wo){return Wt(wo,L)});Cr=qr.some(function(wo){return wo.signedDistanceFromCamera<=0})?[]:qr.map(function(wo){return wo.point})}var kr=[];if(Cr.length>0){for(var Or=Cr[0].clone(),Xr=Cr[0].clone(),Pr=1;Pr<Cr.length;Pr++)Or.x=Math.min(Or.x,Cr[Pr].x),Or.y=Math.min(Or.y,Cr[Pr].y),Xr.x=Math.max(Xr.x,Cr[Pr].x),Xr.y=Math.max(Xr.y,Cr[Pr].y);kr=Or.x>=Rt.x&&Xr.x<=xt.x&&Or.y>=Rt.y&&Xr.y<=xt.y?[Cr]:Xr.x<Rt.x||Or.x>xt.x||Xr.y<Rt.y||Or.y>xt.y?[]:s.clipLine([Cr],Rt.x,Rt.y,xt.x,xt.y)}for(var Ir=0,Vi=kr;Ir<Vi.length;Ir+=1){var vi;Nt.reset(Vi[Ir],.25*ht),vi=Nt.length<=.5*ht?1:Math.ceil(Nt.paddedLength/zr)+1;for(var hs=0;hs<vi;hs++){var Qi=hs/Math.max(vi-1,1),Ai=Nt.lerp(Qi),Ci=Ai.x+100,qs=Ai.y+100;ae.push(Ci,qs,ht,0);var vs=Ci-ht,Bc=qs-ht,Os=Ci+ht,Ko=qs+ht;if(et=et&&this.isOffscreen(vs,Bc,Os,Ko),$e=$e||this.isInsideGrid(vs,Bc,Os,Ko),!l&&this.grid.hitTestCircle(Ci,qs,ht,te)&&(it=!0,!G))return{circles:[],offscreen:!1,collisionDetected:it}}}}return{circles:!G&&it||!$e?[]:ae,offscreen:et,collisionDetected:it}},wi.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,m=1/0,C=-1/0,P=-1/0,R=0,L=l;R<L.length;R+=1){var G=L[R],$=new s.Point(G.x+100,G.y+100);h=Math.min(h,$.x),m=Math.min(m,$.y),C=Math.max(C,$.x),P=Math.max(P,$.y),d.push($)}for(var te={},Y={},re=0,ae=this.grid.query(h,m,C,P).concat(this.ignoredGrid.query(h,m,C,P));re<ae.length;re+=1){var we=ae[re],De=we.key;if(te[De.bucketInstanceId]===void 0&&(te[De.bucketInstanceId]={}),!te[De.bucketInstanceId][De.featureIndex]){var me=[new s.Point(we.x1,we.y1),new s.Point(we.x2,we.y1),new s.Point(we.x2,we.y2),new s.Point(we.x1,we.y2)];s.polygonIntersectsPolygon(d,me)&&(te[De.bucketInstanceId][De.featureIndex]=!0,Y[De.bucketInstanceId]===void 0&&(Y[De.bucketInstanceId]=[]),Y[De.bucketInstanceId].push(De.featureIndex))}}return Y},wi.prototype.insertCollisionBox=function(l,d,h,m,C){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:C},l[0],l[1],l[2],l[3])},wi.prototype.insertCollisionCircles=function(l,d,h,m,C){for(var P=d?this.ignoredGrid:this.grid,R={bucketInstanceId:h,featureIndex:m,collisionGroupID:C},L=0;L<l.length;L+=4)P.insertCircle(R,l[L],l[L+1],l[L+2])},wi.prototype.projectAndGetPerspectiveRatio=function(l,d,h){var m=[d,h,0,1];return ni(m,m,l),{point:new s.Point((m[0]/m[3]+1)/2*this.transform.width+100,(-m[1]/m[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}},wi.prototype.isOffscreen=function(l,d,h,m){return h<100||l>=this.screenRightBoundary||m<100||d>this.screenBottomBoundary},wi.prototype.isInsideGrid=function(l,d,h,m){return h>=0&&l<this.gridRightBoundary&&m>=0&&d<this.gridBottomBoundary},wi.prototype.getViewportMatrix=function(){var l=s.identity([]);return s.translate(l,l,[-100,-100,0]),l};var ls=function(l,d,h,m){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):m&&h?1:0,this.placed=h};ls.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var ki=function(l,d,h,m,C){this.text=new ls(l?l.text:null,d,h,C),this.icon=new ls(l?l.icon:null,d,m,C)};ki.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ss=function(l,d,h){this.text=l,this.icon=d,this.skipFade=h},xn=function(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]},rl=function(l,d,h,m,C){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=C},xe=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Re(l,d,h,m,C){var P=s.getAnchorAlignment(l),R=-(P.horizontalAlign-.5)*d,L=-(P.verticalAlign-.5)*h,G=s.evaluateVariableOffset(l,m);return new s.Point(R+G[0]*C,L+G[1]*C)}function Je(l,d,h,m,C,P){var R=l.x1,L=l.x2,G=l.y1,$=l.y2,te=l.anchorPointX,Y=l.anchorPointY,re=new s.Point(d,h);return m&&re._rotate(C?P:-P),{x1:R+re.x,y1:G+re.y,x2:L+re.x,y2:$+re.y,anchorPointX:te,anchorPointY:Y}}xe.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[l]};var At=function(l,d,h,m){this.transform=l.clone(),this.collisionIndex=new wi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new xe(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}};function Ht(l,d,h,m,C){l.emplaceBack(d?1:0,h?1:0,m||0,C||0),l.emplaceBack(d?1:0,h?1:0,m||0,C||0),l.emplaceBack(d?1:0,h?1:0,m||0,C||0),l.emplaceBack(d?1:0,h?1:0,m||0,C||0)}At.prototype.getBucketParts=function(l,d,h,m){var C=h.getBucket(d),P=h.latestFeatureIndex;if(C&&P&&d.id===C.layerIds[0]){var R=h.collisionBoxArray,L=C.layers[0].layout,G=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),$=h.tileSize/s.EXTENT,te=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),Y=L.get("text-pitch-alignment")==="map",re=L.get("text-rotation-alignment")==="map",ae=Tn(h,1,this.transform.zoom),we=fr(te,Y,re,this.transform,ae),De=null;if(Y){var me=Me(te,Y,re,this.transform,ae);De=s.multiply([],this.transform.labelPlaneMatrix,me)}this.retainedQueryData[C.bucketInstanceId]=new rl(C.bucketInstanceId,P,C.sourceLayerIndex,C.index,h.tileID);var Fe={bucket:C,layout:L,posMatrix:te,textLabelPlaneMatrix:we,labelToScreenMatrix:De,scale:G,textPixelRatio:$,holdingForFade:h.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(m)for(var He=0,We=C.sortKeyRanges;He<We.length;He+=1){var it=We[He];l.push({sortKey:it.sortKey,symbolInstanceStart:it.symbolInstanceStart,symbolInstanceEnd:it.symbolInstanceEnd,parameters:Fe})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Fe})}},At.prototype.attemptAnchorPlacement=function(l,d,h,m,C,P,R,L,G,$,te,Y,re,ae,we){var De,me=[Y.textOffset0,Y.textOffset1],Fe=Re(l,h,m,me,C),He=this.collisionIndex.placeCollisionBox(Je(d,Fe.x,Fe.y,P,R,this.transform.angle),te,L,G,$.predicate);if(!we||this.collisionIndex.placeCollisionBox(Je(we,Fe.x,Fe.y,P,R,this.transform.angle),te,L,G,$.predicate).box.length!==0)return He.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(De=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),this.variableOffsets[Y.crossTileID]={textOffset:me,width:h,height:m,anchor:l,textBoxScale:C,prevAnchor:De},this.markUsedJustification(re,l,Y,ae),re.allowVerticalPlacement&&(this.markUsedOrientation(re,ae,Y),this.placedOrientations[Y.crossTileID]=ae),{shift:Fe,placedGlyphBoxes:He}):void 0},At.prototype.placeLayerBucketPart=function(l,d,h){var m=this,C=l.parameters,P=C.bucket,R=C.layout,L=C.posMatrix,G=C.textLabelPlaneMatrix,$=C.labelToScreenMatrix,te=C.textPixelRatio,Y=C.holdingForFade,re=C.collisionBoxArray,ae=C.partiallyEvaluatedTextSize,we=C.collisionGroup,De=R.get("text-optional"),me=R.get("icon-optional"),Fe=R.get("text-allow-overlap"),He=R.get("icon-allow-overlap"),We=R.get("text-rotation-alignment")==="map",it=R.get("text-pitch-alignment")==="map",$e=R.get("icon-text-fit")!=="none",et=R.get("symbol-z-order")==="viewport-y",ht=Fe&&(He||!P.hasIconData()||me),Rt=He&&(Fe||!P.hasTextData()||De);!P.collisionArrays&&re&&P.deserializeCollisionBoxes(re);var xt=function(ir,zr){if(!d[ir.crossTileID])if(Y)m.placements[ir.crossTileID]=new Ss(!1,!1,!1);else{var qr,kr=!1,Or=!1,Xr=!0,Pr=null,Ir={box:null,offscreen:null},Vi={box:null,offscreen:null},vi=null,hs=null,Qi=0,Ai=0,Ci=0;zr.textFeatureIndex?Qi=zr.textFeatureIndex:ir.useRuntimeCollisionCircles&&(Qi=ir.featureIndex),zr.verticalTextFeatureIndex&&(Ai=zr.verticalTextFeatureIndex);var qs=zr.textBox;if(qs){var vs=function(yn){var po=s.WritingMode.horizontal;if(P.allowVerticalPlacement&&!yn&&m.prevPlacement){var Ls=m.prevPlacement.placedOrientations[ir.crossTileID];Ls&&(m.placedOrientations[ir.crossTileID]=Ls,m.markUsedOrientation(P,po=Ls,ir))}return po},Bc=function(yn,po){if(P.allowVerticalPlacement&&ir.numVerticalGlyphVertices>0&&zr.verticalTextBox)for(var Ls=0,_l=P.writingModes;Ls<_l.length&&(_l[Ls]===s.WritingMode.vertical?(Ir=po(),Vi=Ir):Ir=yn(),!(Ir&&Ir.box&&Ir.box.length));Ls+=1);else Ir=yn()};if(R.get("text-variable-anchor")){var Os=R.get("text-variable-anchor");if(m.prevPlacement&&m.prevPlacement.variableOffsets[ir.crossTileID]){var Ko=m.prevPlacement.variableOffsets[ir.crossTileID];Os.indexOf(Ko.anchor)>0&&(Os=Os.filter(function(yn){return yn!==Ko.anchor})).unshift(Ko.anchor)}var wo=function(yn,po,Ls){for(var _l=yn.x2-yn.x1,Ny=yn.y2-yn.y1,Eh=ir.textBoxScale,ky=$e&&!He?po:null,yf={box:[],offscreen:!1},Dg=Fe?2*Os.length:Os.length,pu=0;pu<Dg;++pu){var Th=m.attemptAnchorPlacement(Os[pu%Os.length],yn,_l,Ny,Eh,We,it,te,L,we,pu>=Os.length,ir,P,Ls,ky);if(Th&&(yf=Th.placedGlyphBoxes)&&yf.box&&yf.box.length){kr=!0,Pr=Th.shift;break}}return yf};Bc(function(){return wo(qs,zr.iconBox,s.WritingMode.horizontal)},function(){var yn=zr.verticalTextBox;return P.allowVerticalPlacement&&!(Ir&&Ir.box&&Ir.box.length)&&ir.numVerticalGlyphVertices>0&&yn?wo(yn,zr.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),Ir&&(kr=Ir.box,Xr=Ir.offscreen);var gf=vs(Ir&&Ir.box);if(!kr&&m.prevPlacement){var du=m.prevPlacement.variableOffsets[ir.crossTileID];du&&(m.variableOffsets[ir.crossTileID]=du,m.markUsedJustification(P,du.anchor,ir,gf))}}else{var Sc=function(yn,po){var Ls=m.collisionIndex.placeCollisionBox(yn,Fe,te,L,we.predicate);return Ls&&Ls.box&&Ls.box.length&&(m.markUsedOrientation(P,po,ir),m.placedOrientations[ir.crossTileID]=po),Ls};Bc(function(){return Sc(qs,s.WritingMode.horizontal)},function(){var yn=zr.verticalTextBox;return P.allowVerticalPlacement&&ir.numVerticalGlyphVertices>0&&yn?Sc(yn,s.WritingMode.vertical):{box:null,offscreen:null}}),vs(Ir&&Ir.box&&Ir.box.length)}}if(kr=(qr=Ir)&&qr.box&&qr.box.length>0,Xr=qr&&qr.offscreen,ir.useRuntimeCollisionCircles){var Au=P.text.placedSymbolArray.get(ir.centerJustifiedTextSymbolIndex),mf=s.evaluateSizeForFeature(P.textSizeData,ae,Au),ga=R.get("text-padding");vi=m.collisionIndex.placeCollisionCircles(Fe,Au,P.lineVertexArray,P.glyphOffsetArray,mf,L,G,$,h,it,we.predicate,ir.collisionCircleDiameter,ga),kr=Fe||vi.circles.length>0&&!vi.collisionDetected,Xr=Xr&&vi.offscreen}if(zr.iconFeatureIndex&&(Ci=zr.iconFeatureIndex),zr.iconBox){var _f=function(yn){var po=$e&&Pr?Je(yn,Pr.x,Pr.y,We,it,m.transform.angle):yn;return m.collisionIndex.placeCollisionBox(po,He,te,L,we.predicate)};Or=Vi&&Vi.box&&Vi.box.length&&zr.verticalIconBox?(hs=_f(zr.verticalIconBox)).box.length>0:(hs=_f(zr.iconBox)).box.length>0,Xr=Xr&&hs.offscreen}var ma=De||ir.numHorizontalGlyphVertices===0&&ir.numVerticalGlyphVertices===0,Hi=me||ir.numIconVertices===0;if(ma||Hi?Hi?ma||(Or=Or&&kr):kr=Or&&kr:Or=kr=Or&&kr,kr&&qr&&qr.box&&m.collisionIndex.insertCollisionBox(qr.box,R.get("text-ignore-placement"),P.bucketInstanceId,Vi&&Vi.box&&Ai?Ai:Qi,we.ID),Or&&hs&&m.collisionIndex.insertCollisionBox(hs.box,R.get("icon-ignore-placement"),P.bucketInstanceId,Ci,we.ID),vi&&(kr&&m.collisionIndex.insertCollisionCircles(vi.circles,R.get("text-ignore-placement"),P.bucketInstanceId,Qi,we.ID),h)){var Ha=P.bucketInstanceId,Ic=m.collisionCircleArrays[Ha];Ic===void 0&&(Ic=m.collisionCircleArrays[Ha]=new xn);for(var ml=0;ml<vi.circles.length;ml+=4)Ic.circles.push(vi.circles[ml+0]),Ic.circles.push(vi.circles[ml+1]),Ic.circles.push(vi.circles[ml+2]),Ic.circles.push(vi.collisionDetected?1:0)}m.placements[ir.crossTileID]=new Ss(kr||ht,Or||Rt,Xr||P.justReloaded),d[ir.crossTileID]=!0}};if(et)for(var Nt=P.getSortedSymbolIndexes(this.transform.angle),rr=Nt.length-1;rr>=0;--rr){var vr=Nt[rr];xt(P.symbolInstances.get(vr),P.collisionArrays[vr])}else for(var Cr=l.symbolInstanceStart;Cr<l.symbolInstanceEnd;Cr++)xt(P.symbolInstances.get(Cr),P.collisionArrays[Cr]);if(h&&P.bucketInstanceId in this.collisionCircleArrays){var pn=this.collisionCircleArrays[P.bucketInstanceId];s.invert(pn.invProjMatrix,L),pn.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1},At.prototype.markUsedJustification=function(l,d,h,m){var C;C=m===s.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(d)];for(var P=0,R=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];P<R.length;P+=1){var L=R[P];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=C>=0&&L!==C?0:h.crossTileID)}},At.prototype.markUsedOrientation=function(l,d,h){for(var m=d===s.WritingMode.horizontal||d===s.WritingMode.horizontalOnly?d:0,C=d===s.WritingMode.vertical?d:0,P=0,R=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];P<R.length;P+=1)l.text.placedSymbolArray.get(R[P]).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=C)},At.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var m=d?d.symbolFadeChange(l):1,C=d?d.opacities:{},P=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(var L in this.placements){var G=this.placements[L],$=C[L];$?(this.opacities[L]=new ki($,m,G.text,G.icon),h=h||G.text!==$.text.placed||G.icon!==$.icon.placed):(this.opacities[L]=new ki(null,m,G.text,G.icon,G.skipFade),h=h||G.text||G.icon)}for(var te in C){var Y=C[te];if(!this.opacities[te]){var re=new ki(Y,m,!1,!1);re.isHidden()||(this.opacities[te]=re,h=h||Y.text.placed||Y.icon.placed)}}for(var ae in P)this.variableOffsets[ae]||!this.opacities[ae]||this.opacities[ae].isHidden()||(this.variableOffsets[ae]=P[ae]);for(var we in R)this.placedOrientations[we]||!this.opacities[we]||this.opacities[we].isHidden()||(this.placedOrientations[we]=R[we]);h?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)},At.prototype.updateLayerOpacities=function(l,d){for(var h={},m=0,C=d;m<C.length;m+=1){var P=C[m],R=P.getBucket(l);R&&P.latestFeatureIndex&&l.id===R.layerIds[0]&&this.updateBucketOpacities(R,h,P.collisionBoxArray)}},At.prototype.updateBucketOpacities=function(l,d,h){var m=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var C=l.layers[0].layout,P=new ki(null,0,!1,!1,!0),R=C.get("text-allow-overlap"),L=C.get("icon-allow-overlap"),G=C.get("text-variable-anchor"),$=C.get("text-rotation-alignment")==="map",te=C.get("text-pitch-alignment")==="map",Y=C.get("icon-text-fit")!=="none",re=new ki(null,0,R&&(L||!l.hasIconData()||C.get("icon-optional")),L&&(R||!l.hasTextData()||C.get("text-optional")),!0);!l.collisionArrays&&h&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(h);for(var ae=function(Fe,He,We){for(var it=0;it<He/4;it++)Fe.opacityVertexArray.emplaceBack(We)},we=function(Fe){var He=l.symbolInstances.get(Fe),We=He.numHorizontalGlyphVertices,it=He.numVerticalGlyphVertices,$e=He.crossTileID,et=m.opacities[$e];d[$e]?et=P:et||(m.opacities[$e]=et=re),d[$e]=!0;var ht=He.numIconVertices>0,Rt=m.placedOrientations[He.crossTileID],xt=Rt===s.WritingMode.vertical,Nt=Rt===s.WritingMode.horizontal||Rt===s.WritingMode.horizontalOnly;if(We>0||it>0){var rr=tf(et.text);ae(l.text,We,xt?oa:rr),ae(l.text,it,Nt?oa:rr);var vr=et.text.isHidden();[He.rightJustifiedTextSymbolIndex,He.centerJustifiedTextSymbolIndex,He.leftJustifiedTextSymbolIndex].forEach(function(Ir){Ir>=0&&(l.text.placedSymbolArray.get(Ir).hidden=vr||xt?1:0)}),He.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(He.verticalPlacedTextSymbolIndex).hidden=vr||Nt?1:0);var Cr=m.variableOffsets[He.crossTileID];Cr&&m.markUsedJustification(l,Cr.anchor,He,Rt);var pn=m.placedOrientations[He.crossTileID];pn&&(m.markUsedJustification(l,"left",He,pn),m.markUsedOrientation(l,pn,He))}if(ht){var ir=tf(et.icon),zr=!(Y&&He.verticalPlacedIconSymbolIndex&&xt);He.placedIconSymbolIndex>=0&&(ae(l.icon,He.numIconVertices,zr?ir:oa),l.icon.placedSymbolArray.get(He.placedIconSymbolIndex).hidden=et.icon.isHidden()),He.verticalPlacedIconSymbolIndex>=0&&(ae(l.icon,He.numVerticalIconVertices,zr?oa:ir),l.icon.placedSymbolArray.get(He.verticalPlacedIconSymbolIndex).hidden=et.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var qr=l.collisionArrays[Fe];if(qr){var kr=new s.Point(0,0);if(qr.textBox||qr.verticalTextBox){var Or=!0;if(G){var Xr=m.variableOffsets[$e];Xr?(kr=Re(Xr.anchor,Xr.width,Xr.height,Xr.textOffset,Xr.textBoxScale),$&&kr._rotate(te?m.transform.angle:-m.transform.angle)):Or=!1}qr.textBox&&Ht(l.textCollisionBox.collisionVertexArray,et.text.placed,!Or||xt,kr.x,kr.y),qr.verticalTextBox&&Ht(l.textCollisionBox.collisionVertexArray,et.text.placed,!Or||Nt,kr.x,kr.y)}var Pr=!!(!Nt&&qr.verticalIconBox);qr.iconBox&&Ht(l.iconCollisionBox.collisionVertexArray,et.icon.placed,Pr,Y?kr.x:0,Y?kr.y:0),qr.verticalIconBox&&Ht(l.iconCollisionBox.collisionVertexArray,et.icon.placed,!Pr,Y?kr.x:0,Y?kr.y:0)}}},De=0;De<l.symbolInstances.length;De++)we(De);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var me=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=me.invProjMatrix,l.placementViewportMatrix=me.viewportMatrix,l.collisionCircleArray=me.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},At.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},At.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},At.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},At.prototype.stillRecent=function(l,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>l},At.prototype.setStale=function(){this.stale=!0};var gr=Math.pow(2,25),wr=Math.pow(2,24),ii=Math.pow(2,17),Ii=Math.pow(2,16),Ui=Math.pow(2,9),Vs=Math.pow(2,8),dh=Math.pow(2,1);function tf(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var d=l.placed?1:0,h=Math.floor(127*l.opacity);return h*gr+d*wr+h*ii+d*Ii+h*Ui+d*Vs+h*dh+d}var oa=0,nl=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};nl.prototype.continuePlacement=function(l,d,h,m,C){for(var P=this._bucketParts;this._currentTileIndex<l.length;)if(d.getBucketParts(P,m,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(function(R,L){return R.sortKey-L.sortKey}));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,C())return!0;return!1};var il=function(l,d,h,m,C,P,R){this.placement=new At(l,C,P,R),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1};il.prototype.isDone=function(){return this._done},il.prototype.continuePlacement=function(l,d,h){for(var m=this,C=s.browser.now(),P=function(){var G=s.browser.now()-C;return!m._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var R=d[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=L)&&(!R.maxzoom||R.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new nl(R)),this._inProgressLayer.continuePlacement(h[R.source],this.placement,this._showCollisionBoxes,R,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},il.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ah=512/s.EXTENT/2,sl=function(l,d,h){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var m=0;m<d.length;m++){var C=d.get(m),P=C.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,l)})}};sl.prototype.getScaledCoordinates=function(l,d){var h=Ah/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*s.EXTENT+l.anchorX)*h),y:Math.floor((d.canonical.y*s.EXTENT+l.anchorY)*h)}},sl.prototype.findMatches=function(l,d,h){for(var m=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),C=0;C<l.length;C++){var P=l.get(C);if(!P.crossTileID){var R=this.indexedSymbolInstances[P.key];if(R)for(var L=this.getScaledCoordinates(P,d),G=0,$=R;G<$.length;G+=1){var te=$[G];if(Math.abs(te.coord.x-L.x)<=m&&Math.abs(te.coord.y-L.y)<=m&&!h[te.crossTileID]){h[te.crossTileID]=!0,P.crossTileID=te.crossTileID;break}}}}};var Is=function(){this.maxCrossTileID=0};Is.prototype.generate=function(){return++this.maxCrossTileID};var Lo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Lo.prototype.handleWrapJump=function(l){var d=Math.round((l-this.lng)/360);if(d!==0)for(var h in this.indexes){var m=this.indexes[h],C={};for(var P in m){var R=m[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),C[R.tileID.key]=R}this.indexes[h]=C}this.lng=l},Lo.prototype.addBucket=function(l,d,h){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var m=0;m<d.symbolInstances.length;m++)d.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var C=this.usedCrossTileIDs[l.overscaledZ];for(var P in this.indexes){var R=this.indexes[P];if(Number(P)>l.overscaledZ)for(var L in R){var G=R[L];G.tileID.isChildOf(l)&&G.findMatches(d.symbolInstances,l,C)}else{var $=R[l.scaledTo(Number(P)).key];$&&$.findMatches(d.symbolInstances,l,C)}}for(var te=0;te<d.symbolInstances.length;te++){var Y=d.symbolInstances.get(te);Y.crossTileID||(Y.crossTileID=h.generate(),C[Y.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new sl(l,d.symbolInstances,d.bucketInstanceId),!0},Lo.prototype.removeBucketCrossTileIDs=function(l,d){for(var h in d.indexedSymbolInstances)for(var m=0,C=d.indexedSymbolInstances[h];m<C.length;m+=1)delete this.usedCrossTileIDs[l][C[m].crossTileID]},Lo.prototype.removeStaleBuckets=function(l){var d=!1;for(var h in this.indexes){var m=this.indexes[h];for(var C in m)l[m[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[C]),delete m[C],d=!0)}return d};var aa=function(){this.layerIndexes={},this.crossTileIDs=new Is,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};aa.prototype.addLayer=function(l,d,h){var m=this.layerIndexes[l.id];m===void 0&&(m=this.layerIndexes[l.id]=new Lo);var C=!1,P={};m.handleWrapJump(h);for(var R=0,L=d;R<L.length;R+=1){var G=L[R],$=G.getBucket(l);$&&l.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(G.tileID,$,this.crossTileIDs)&&(C=!0),P[$.bucketInstanceId]=!0)}return m.removeStaleBuckets(P)&&(C=!0),C},aa.prototype.pruneUnusedLayers=function(l){var d={};for(var h in l.forEach(function(m){d[m]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var Ma=function(l,d){return s.emitValidationErrors(l,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},ca=s.pick(zt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),di=s.pick(zt,["setCenter","setZoom","setBearing","setPitch"]),yo=function(){var l={},d=s.styleSpec.$version;for(var h in s.styleSpec.$root){var m,C=s.styleSpec.$root[h];C.required&&(m=h==="version"?d:C.type==="array"?[]:{})!=null&&(l[h]=m)}return l}(),On=function(l){function d(h,m){var C=this;m===void 0&&(m={}),l.call(this),this.map=h,this.dispatcher=new Be(ut(),this),this.imageManager=new V,this.imageManager.setEventedParent(this),this.glyphManager=new Ae(h._requestManager,m.localIdeographFontFamily),this.lineAtlas=new ne(256,512),this.crossTileSymbolIndex=new aa,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());var P=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(R){P.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(L,G){if(s.triggerPluginCompletionEvent(L),G&&G.every(function(te){return te}))for(var $ in P.sourceCaches)P.sourceCaches[$].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var L=C.sourceCaches[R.sourceId];if(L){var G=L.getSource();if(G&&G.vectorLayerIds)for(var $ in C._layers){var te=C._layers[$];te.source===G.id&&C._validateLayer(te)}}}})}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.loadURL=function(h,m){var C=this;m===void 0&&(m={}),this.fire(new s.Event("dataloading",{dataType:"style"}));var P=typeof m.validate=="boolean"?m.validate:!s.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,m.accessToken);var R=this.map._requestManager.transformRequest(h,s.ResourceType.Style);this._request=s.getJSON(R,function(L,G){C._request=null,L?C.fire(new s.ErrorEvent(L)):G&&C._load(G,P)})},d.prototype.loadJSON=function(h,m){var C=this;m===void 0&&(m={}),this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.browser.frame(function(){C._request=null,C._load(h,m.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(yo,!1)},d.prototype._load=function(h,m){if(!m||!Ma(this,s.validateStyle(h))){for(var C in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(C,h.sources[C],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var P=St(this.stylesheet.layers);this._order=P.map(function($){return $.id}),this._layers={},this._serializedLayers={};for(var R=0,L=P;R<L.length;R+=1){var G=L[R];(G=s.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new X(this.stylesheet.light),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}},d.prototype._loadSprite=function(h){var m=this;this._spriteRequest=function(C,P,R){var L,G,$,te=s.browser.devicePixelRatio>1?"@2x":"",Y=s.getJSON(P.transformRequest(P.normalizeSpriteURL(C,te,".json"),s.ResourceType.SpriteJSON),function(we,De){Y=null,$||($=we,L=De,ae())}),re=s.getImage(P.transformRequest(P.normalizeSpriteURL(C,te,".png"),s.ResourceType.SpriteImage),function(we,De){re=null,$||($=we,G=De,ae())});function ae(){if($)R($);else if(L&&G){var we=s.browser.getImageData(G),De={};for(var me in L){var Fe=L[me],He=Fe.width,We=Fe.height,it=Fe.x,$e=Fe.y,et=Fe.sdf,ht=Fe.pixelRatio,Rt=Fe.stretchX,xt=Fe.stretchY,Nt=Fe.content,rr=new s.RGBAImage({width:He,height:We});s.RGBAImage.copy(we,rr,{x:it,y:$e},{x:0,y:0},{width:He,height:We}),De[me]={data:rr,pixelRatio:ht,sdf:et,stretchX:Rt,stretchY:xt,content:Nt}}R(null,De)}}return{cancel:function(){Y&&(Y.cancel(),Y=null),re&&(re.cancel(),re=null)}}}(h,this.map._requestManager,function(C,P){if(m._spriteRequest=null,C)m.fire(new s.ErrorEvent(C));else if(P)for(var R in P)m.imageManager.addImage(R,P[R]);m.imageManager.setLoaded(!0),m._availableImages=m.imageManager.listImages(),m.dispatcher.broadcast("setImages",m._availableImages),m.fire(new s.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var m=this.sourceCaches[h.source];if(m){var C=h.sourceLayer;if(C){var P=m.getSource();(P.type==="geojson"||P.vectorLayerIds&&P.vectorLayerIds.indexOf(C)===-1)&&this.fire(new s.ErrorEvent(new Error('Source layer "'+C+'" does not exist on source "'+P.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var m=[],C=0,P=h;C<P.length;C+=1){var R=this._layers[P[C]];R.type!=="custom"&&m.push(R.serialize())}return m},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var m in this._layers)if(this._layers[m].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var m=this._changed;if(this._changed){var C=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);for(var R in(C.length||P.length)&&this._updateWorkerLayers(C,P),this._updatedSources){var L=this._updatedSources[R];L==="reload"?this._reloadSource(R):L==="clear"&&this._clearSource(R)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var $={};for(var te in this.sourceCaches){var Y=this.sourceCaches[te];$[te]=Y.used,Y.used=!1}for(var re=0,ae=this._order;re<ae.length;re+=1){var we=this._layers[ae[re]];we.recalculate(h,this._availableImages),!we.isHidden(h.zoom)&&we.source&&(this.sourceCaches[we.source].used=!0)}for(var De in $){var me=this.sourceCaches[De];$[De]!==me.used&&me.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:De}))}this.light.recalculate(h),this.z=h.zoom,m&&this.fire(new s.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:m})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var m=this;if(this._checkLoaded(),Ma(this,s.validateStyle(h)))return!1;(h=s.clone$1(h)).layers=St(h.layers);var C=function(R,L){if(!R)return[{command:zt.setStyle,args:[L]}];var G=[];try{if(!s.deepEqual(R.version,L.version))return[{command:zt.setStyle,args:[L]}];s.deepEqual(R.center,L.center)||G.push({command:zt.setCenter,args:[L.center]}),s.deepEqual(R.zoom,L.zoom)||G.push({command:zt.setZoom,args:[L.zoom]}),s.deepEqual(R.bearing,L.bearing)||G.push({command:zt.setBearing,args:[L.bearing]}),s.deepEqual(R.pitch,L.pitch)||G.push({command:zt.setPitch,args:[L.pitch]}),s.deepEqual(R.sprite,L.sprite)||G.push({command:zt.setSprite,args:[L.sprite]}),s.deepEqual(R.glyphs,L.glyphs)||G.push({command:zt.setGlyphs,args:[L.glyphs]}),s.deepEqual(R.transition,L.transition)||G.push({command:zt.setTransition,args:[L.transition]}),s.deepEqual(R.light,L.light)||G.push({command:zt.setLight,args:[L.light]});var $={},te=[];(function(re,ae,we,De){var me;for(me in ae=ae||{},re=re||{})re.hasOwnProperty(me)&&(ae.hasOwnProperty(me)||qt(me,we,De));for(me in ae)ae.hasOwnProperty(me)&&(re.hasOwnProperty(me)?s.deepEqual(re[me],ae[me])||(re[me].type==="geojson"&&ae[me].type==="geojson"&&en(re,ae,me)?we.push({command:zt.setGeoJSONSourceData,args:[me,ae[me].data]}):$r(me,ae,we,De)):Fr(me,ae,we))})(R.sources,L.sources,te,$);var Y=[];R.layers&&R.layers.forEach(function(re){$[re.source]?G.push({command:zt.removeLayer,args:[re.id]}):Y.push(re)}),G=G.concat(te),function(re,ae,we){ae=ae||[];var De,me,Fe,He,We,it,$e,et=(re=re||[]).map(Vr),ht=ae.map(Vr),Rt=re.reduce(Lr,{}),xt=ae.reduce(Lr,{}),Nt=et.slice(),rr=Object.create(null);for(De=0,me=0;De<et.length;De++)xt.hasOwnProperty(Fe=et[De])?me++:(we.push({command:zt.removeLayer,args:[Fe]}),Nt.splice(Nt.indexOf(Fe,me),1));for(De=0,me=0;De<ht.length;De++)Nt[Nt.length-1-De]!==(Fe=ht[ht.length-1-De])&&(Rt.hasOwnProperty(Fe)?(we.push({command:zt.removeLayer,args:[Fe]}),Nt.splice(Nt.lastIndexOf(Fe,Nt.length-me),1)):me++,we.push({command:zt.addLayer,args:[xt[Fe],it=Nt[Nt.length-De]]}),Nt.splice(Nt.length-De,0,Fe),rr[Fe]=!0);for(De=0;De<ht.length;De++)if(He=Rt[Fe=ht[De]],We=xt[Fe],!rr[Fe]&&!s.deepEqual(He,We))if(s.deepEqual(He.source,We.source)&&s.deepEqual(He["source-layer"],We["source-layer"])&&s.deepEqual(He.type,We.type)){for($e in Gr(He.layout,We.layout,we,Fe,null,zt.setLayoutProperty),Gr(He.paint,We.paint,we,Fe,null,zt.setPaintProperty),s.deepEqual(He.filter,We.filter)||we.push({command:zt.setFilter,args:[Fe,We.filter]}),s.deepEqual(He.minzoom,We.minzoom)&&s.deepEqual(He.maxzoom,We.maxzoom)||we.push({command:zt.setLayerZoomRange,args:[Fe,We.minzoom,We.maxzoom]}),He)He.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&($e.indexOf("paint.")===0?Gr(He[$e],We[$e],we,Fe,$e.slice(6),zt.setPaintProperty):s.deepEqual(He[$e],We[$e])||we.push({command:zt.setLayerProperty,args:[Fe,$e,We[$e]]}));for($e in We)We.hasOwnProperty($e)&&!He.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&($e.indexOf("paint.")===0?Gr(He[$e],We[$e],we,Fe,$e.slice(6),zt.setPaintProperty):s.deepEqual(He[$e],We[$e])||we.push({command:zt.setLayerProperty,args:[Fe,$e,We[$e]]}))}else we.push({command:zt.removeLayer,args:[Fe]}),it=Nt[Nt.lastIndexOf(Fe)+1],we.push({command:zt.addLayer,args:[We,it]})}(Y,L.layers,G)}catch(re){console.warn("Unable to compute style diff:",re),G=[{command:zt.setStyle,args:[L]}]}return G}(this.serialize(),h).filter(function(R){return!(R.command in di)});if(C.length===0)return!1;var P=C.filter(function(R){return!(R.command in ca)});if(P.length>0)throw new Error("Unimplemented: "+P.map(function(R){return R.command}).join(", ")+".");return C.forEach(function(R){R.command!=="setTransition"&&m[R.command].apply(m,R.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,m){if(this.getImage(h))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,m),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,m){this.imageManager.updateImage(h,m)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,m,C){var P=this;if(C===void 0&&(C={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(m).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(s.validateStyle.source,"sources."+h,m,null,C))){this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);var R=this.sourceCaches[h]=new Se(h,m,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:P.loaded(),source:R.serialize(),sourceId:h}}),R.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var m in this._layers)if(this._layers[m].source===h)return this.fire(new s.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+m+'" is using it.')));var C=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],C.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),C.setEventedParent(null),C.clearTiles(),C.onRemove&&C.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,m){this._checkLoaded(),this.sourceCaches[h].getSource().setData(m),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,m,C){C===void 0&&(C={}),this._checkLoaded();var P=h.id;if(this.getLayer(P))this.fire(new s.ErrorEvent(new Error('Layer with id "'+P+'" already exists on this map')));else{var R;if(h.type==="custom"){if(Ma(this,s.validateCustomStyleLayer(h)))return;R=s.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(P,h.source),h=s.clone$1(h),h=s.extend(h,{source:P})),this._validate(s.validateStyle.layer,"layers."+P,h,{arrayIndex:-1},C))return;R=s.createStyleLayer(h),this._validateLayer(R),R.setEventedParent(this,{layer:{id:P}}),this._serializedLayers[R.id]=R.serialize()}var L=m?this._order.indexOf(m):this._order.length;if(m&&L===-1)this.fire(new s.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.')));else{if(this._order.splice(L,0,P),this._layerOrderChanged=!0,this._layers[P]=R,this._removedLayers[P]&&R.source&&R.type!=="custom"){var G=this._removedLayers[P];delete this._removedLayers[P],G.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},d.prototype.moveLayer=function(h,m){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==m){var C=this._order.indexOf(h);this._order.splice(C,1);var P=m?this._order.indexOf(m):this._order.length;m&&P===-1?this.fire(new s.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.'))):(this._order.splice(P,0,h),this._layerOrderChanged=!0)}}else this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var m=this._layers[h];if(m){m.setEventedParent(null);var C=this._order.indexOf(h);this._order.splice(C,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=m,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],m.onRemove&&m.onRemove(this.map)}else this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,m,C){this._checkLoaded();var P=this.getLayer(h);P?P.minzoom===m&&P.maxzoom===C||(m!=null&&(P.minzoom=m),C!=null&&(P.maxzoom=C),this._updateLayer(P)):this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,m,C){C===void 0&&(C={}),this._checkLoaded();var P=this.getLayer(h);if(P){if(!s.deepEqual(P.filter,m))return m==null?(P.filter=void 0,void this._updateLayer(P)):void(this._validate(s.validateStyle.filter,"layers."+P.id+".filter",m,null,C)||(P.filter=s.clone$1(m),this._updateLayer(P)))}else this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return s.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,m,C,P){P===void 0&&(P={}),this._checkLoaded();var R=this.getLayer(h);R?s.deepEqual(R.getLayoutProperty(m),C)||(R.setLayoutProperty(m,C,P),this._updateLayer(R)):this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,m){var C=this.getLayer(h);if(C)return C.getLayoutProperty(m);this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,m,C,P){P===void 0&&(P={}),this._checkLoaded();var R=this.getLayer(h);R?s.deepEqual(R.getPaintProperty(m),C)||(R.setPaintProperty(m,C,P)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,m){return this.getLayer(h).getPaintProperty(m)},d.prototype.setFeatureState=function(h,m){this._checkLoaded();var C=h.source,P=h.sourceLayer,R=this.sourceCaches[C];if(R!==void 0){var L=R.getSource().type;L==="geojson"&&P?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||P?(h.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(P,h.id,m)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,m){this._checkLoaded();var C=h.source,P=this.sourceCaches[C];if(P!==void 0){var R=P.getSource().type,L=R==="vector"?h.sourceLayer:void 0;R!=="vector"||L?m&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):P.removeFeatureState(L,h.id,m):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var m=h.source,C=h.sourceLayer,P=this.sourceCaches[m];if(P!==void 0){if(P.getSource().type!=="vector"||C)return h.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),P.getFeatureState(C,h.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+m+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var m=this,C=function(Rt){return m._layers[Rt].type==="fill-extrusion"},P={},R=[],L=this._order.length-1;L>=0;L--){var G=this._order[L];if(C(G)){P[G]=L;for(var $=0,te=h;$<te.length;$+=1){var Y=te[$][G];if(Y)for(var re=0,ae=Y;re<ae.length;re+=1)R.push(ae[re])}}}R.sort(function(Rt,xt){return xt.intersectionZ-Rt.intersectionZ});for(var we=[],De=this._order.length-1;De>=0;De--){var me=this._order[De];if(C(me))for(var Fe=R.length-1;Fe>=0;Fe--){var He=R[Fe].feature;if(P[He.layer.id]<De)break;we.push(He),R.pop()}else for(var We=0,it=h;We<it.length;We+=1){var $e=it[We][me];if($e)for(var et=0,ht=$e;et<ht.length;et+=1)we.push(ht[et].feature)}}return we},d.prototype.queryRenderedFeatures=function(h,m,C){m&&m.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",m.filter,null,m);var P={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,L=m.layers;R<L.length;R+=1){var G=L[R],$=this._layers[G];if(!$)return this.fire(new s.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];P[$.source]=!0}}var te=[];for(var Y in m.availableImages=this._availableImages,this.sourceCaches)m.layers&&!P[Y]||te.push($t(this.sourceCaches[Y],this._layers,this._serializedLayers,h,m,C));return this.placement&&te.push(function(re,ae,we,De,me,Fe,He){for(var We={},it=Fe.queryRenderedSymbols(De),$e=[],et=0,ht=Object.keys(it).map(Number);et<ht.length;et+=1)$e.push(He[ht[et]]);$e.sort(Jt);for(var Rt=function(){var Cr=Nt[xt],pn=Cr.featureIndex.lookupSymbolFeatures(it[Cr.bucketInstanceId],ae,Cr.bucketIndex,Cr.sourceLayerIndex,me.filter,me.layers,me.availableImages,re);for(var ir in pn){var zr=We[ir]=We[ir]||[],qr=pn[ir];qr.sort(function(Xr,Pr){var Ir=Cr.featureSortOrder;if(Ir){var Vi=Ir.indexOf(Xr.featureIndex);return Ir.indexOf(Pr.featureIndex)-Vi}return Pr.featureIndex-Xr.featureIndex});for(var kr=0,Or=qr;kr<Or.length;kr+=1)zr.push(Or[kr])}},xt=0,Nt=$e;xt<Nt.length;xt+=1)Rt();var rr=function(Cr){We[Cr].forEach(function(pn){var ir=pn.feature,zr=we[re[Cr].source].getFeatureState(ir.layer["source-layer"],ir.id);ir.source=ir.layer.source,ir.layer["source-layer"]&&(ir.sourceLayer=ir.layer["source-layer"]),ir.state=zr})};for(var vr in We)rr(vr);return We}(this._layers,this._serializedLayers,this.sourceCaches,h,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(te)},d.prototype.querySourceFeatures=function(h,m){m&&m.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",m.filter,null,m);var C=this.sourceCaches[h];return C?function(P,R){for(var L=P.getRenderableIds().map(function(ae){return P.getTileByID(ae)}),G=[],$={},te=0;te<L.length;te++){var Y=L[te],re=Y.tileID.canonical.key;$[re]||($[re]=!0,Y.querySourceFeatures(G,R))}return G}(C,m):[]},d.prototype.addSourceType=function(h,m,C){return d.getSourceType(h)?C(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:m.workerSourceURL},C):C(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,m){m===void 0&&(m={}),this._checkLoaded();var C=this.light.getLight(),P=!1;for(var R in h)if(!s.deepEqual(h[R],C[R])){P=!0;break}if(P){var L={now:s.browser.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,m),this.light.updateTransitions(L)}},d.prototype._validate=function(h,m,C,P,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Ma(this,h.call(s.validateStyle,s.extend({key:m,style:this.serialize(),value:C,styleSpec:s.styleSpec},P)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var m in this.sourceCaches)this.sourceCaches[m].clearTiles(),this.sourceCaches[m].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var m in this.sourceCaches)this.sourceCaches[m].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,m,C,P,R){R===void 0&&(R=!1);for(var L=!1,G=!1,$={},te=0,Y=this._order;te<Y.length;te+=1){var re=this._layers[Y[te]];if(re.type==="symbol"){if(!$[re.source]){var ae=this.sourceCaches[re.source];$[re.source]=ae.getRenderableIds(!0).map(function(He){return ae.getTileByID(He)}).sort(function(He,We){return We.tileID.overscaledZ-He.tileID.overscaledZ||(He.tileID.isLessThan(We.tileID)?-1:1)})}var we=this.crossTileSymbolIndex.addLayer(re,$[re.source],h.center.lng);L=L||we}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||C===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.browser.now(),h.zoom))&&(this.pauseablePlacement=new il(h,this._order,R,m,C,P,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.browser.now()),G=!0),L&&this.pauseablePlacement.placement.setStale()),G||L)for(var De=0,me=this._order;De<me.length;De+=1){var Fe=this._layers[me[De]];Fe.type==="symbol"&&this.placement.updateLayerOpacities(Fe,$[Fe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,m,C){this.imageManager.getImages(m.icons,C),this._updateTilesForChangedImages();var P=this.sourceCaches[m.source];P&&P.setDependencies(m.tileID.key,m.type,m.icons)},d.prototype.getGlyphs=function(h,m,C){this.glyphManager.getGlyphs(m.stacks,C)},d.prototype.getResource=function(h,m,C){return s.makeRequest(m,C)},d}(s.Evented);On.getSourceType=function(l){return nt[l]},On.setSourceType=function(l,d){nt[l]=d},On.registerForPluginStateChange=s.registerForPluginStateChange;var si=s.createLayout([{name:"a_pos",type:"Int16",components:2}]),Pa=wn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ol=wn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),IA=wn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),MA=wn(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),rf=wn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),$l=wn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ac=wn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),No=wn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),nf=wn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),sf=wn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Kl=wn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),lo=wn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Hs=wn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),of=wn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Fi=wn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),al=wn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),la=wn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ua=wn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),fa=wn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ra=wn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ha=wn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Fa=wn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Da=wn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),da=wn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ph=wn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),gh=wn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function wn(l,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=d.match(/attribute ([\w]+) ([\w]+)/g),C=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=P?P.concat(C):C,L={};return{fragmentSource:l=l.replace(h,function(G,$,te,Y,re){return L[re]=!0,$==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
varying `+te+" "+Y+" "+re+`;
#else
uniform `+te+" "+Y+" u_"+re+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+re+`
    `+te+" "+Y+" "+re+" = u_"+re+`;
#endif
`}),vertexSource:d=d.replace(h,function(G,$,te,Y,re){var ae=Y==="float"?"vec2":"vec4",we=re.match(/color/)?"color":ae;return L[re]?$==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
uniform lowp float u_`+re+`_t;
attribute `+te+" "+ae+" a_"+re+`;
varying `+te+" "+Y+" "+re+`;
#else
uniform `+te+" "+Y+" u_"+re+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+re+`
    `+re+" = a_"+re+`;
#else
    `+te+" "+Y+" "+re+" = u_"+re+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+re+`
    `+re+" = unpack_mix_"+we+"(a_"+re+", u_"+re+`_t);
#else
    `+te+" "+Y+" "+re+" = u_"+re+`;
#endif
`:$==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
uniform lowp float u_`+re+`_t;
attribute `+te+" "+ae+" a_"+re+`;
#else
uniform `+te+" "+Y+" u_"+re+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+re+`
    `+te+" "+Y+" "+re+" = a_"+re+`;
#else
    `+te+" "+Y+" "+re+" = u_"+re+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+re+`
    `+te+" "+Y+" "+re+" = unpack_mix_"+we+"(a_"+re+", u_"+re+`_t);
#else
    `+te+" "+Y+" "+re+" = u_"+re+`;
#endif
`}),staticAttributes:m,staticUniforms:R}}var ql=Object.freeze({__proto__:null,prelude:Pa,background:ol,backgroundPattern:IA,circle:MA,clippingMask:rf,heatmap:$l,heatmapTexture:Ac,collisionBox:No,collisionCircle:nf,debug:sf,fill:Kl,fillOutline:lo,fillOutlinePattern:Hs,fillPattern:of,fillExtrusion:Fi,fillExtrusionPattern:al,hillshadePrepare:la,hillshade:ua,line:fa,lineGradient:Ra,linePattern:ha,lineSDF:Fa,raster:Da,symbolIcon:da,symbolSDF:ph,symbolTextAndIcon:gh}),Zl=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function mh(l){for(var d=[],h=0;h<l.length;h++)if(l[h]!==null){var m=l[h].split(" ");d.push(m.pop())}return d}Zl.prototype.bind=function(l,d,h,m,C,P,R,L){this.context=l;for(var G=this.boundPaintVertexBuffers.length!==m.length,$=0;!G&&$<m.length;$++)this.boundPaintVertexBuffers[$]!==m[$]&&(G=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!G&&this.boundIndexBuffer===C&&this.boundVertexOffset===P&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),R&&R.bind(),C&&C.dynamicDraw&&C.bind(),L&&L.bind()):this.freshBind(d,h,m,C,P,R,L)},Zl.prototype.freshBind=function(l,d,h,m,C,P,R){var L,G=l.numAttributes,$=this.context,te=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R;else{L=$.currentNumAttributes||0;for(var Y=G;Y<L;Y++)te.disableVertexAttribArray(Y)}d.enableAttributes(te,l);for(var re=0,ae=h;re<ae.length;re+=1)ae[re].enableAttributes(te,l);P&&P.enableAttributes(te,l),R&&R.enableAttributes(te,l),d.bind(),d.setVertexAttribPointers(te,l,C);for(var we=0,De=h;we<De.length;we+=1){var me=De[we];me.bind(),me.setVertexAttribPointers(te,l,C)}P&&(P.bind(),P.setVertexAttribPointers(te,l,C)),m&&m.bind(),R&&(R.bind(),R.setVertexAttribPointers(te,l,C)),$.currentNumAttributes=G},Zl.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var _h=function(l,d,h,m,C,P){var R=l.gl;this.program=R.createProgram();for(var L=mh(h.staticAttributes),G=m?m.getBinderAttributes():[],$=L.concat(G),te=h.staticUniforms?mh(h.staticUniforms):[],Y=m?m.getBinderUniforms():[],re=[],ae=0,we=te.concat(Y);ae<we.length;ae+=1){var De=we[ae];re.indexOf(De)<0&&re.push(De)}var me=m?m.defines():[];P&&me.push("#define OVERDRAW_INSPECTOR;");var Fe=me.concat(Pa.fragmentSource,h.fragmentSource).join(`
`),He=me.concat(Pa.vertexSource,h.vertexSource).join(`
`),We=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(We,Fe),R.compileShader(We),R.attachShader(this.program,We);var it=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(it,He),R.compileShader(it),R.attachShader(this.program,it),this.attributes={};var $e={};this.numAttributes=$.length;for(var et=0;et<this.numAttributes;et++)$[et]&&(R.bindAttribLocation(this.program,et,$[et]),this.attributes[$[et]]=et);R.linkProgram(this.program),R.deleteShader(it),R.deleteShader(We);for(var ht=0;ht<re.length;ht++){var Rt=re[ht];if(Rt&&!$e[Rt]){var xt=R.getUniformLocation(this.program,Rt);xt&&($e[Rt]=xt)}}this.fixedUniforms=C(l,$e),this.binderUniforms=m?m.getUniforms(l,$e):[]}}};function pc(l,d,h){var m=1/Tn(h,1,d.transform.tileZoom),C=Math.pow(2,h.tileID.overscaledZ),P=h.tileSize*Math.pow(2,d.transform.tileZoom)/C,R=P*(h.tileID.canonical.x+h.tileID.wrap*C),L=P*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[R>>16,L>>16],u_pixel_coord_lower:[65535&R,65535&L]}}_h.prototype.draw=function(l,d,h,m,C,P,R,L,G,$,te,Y,re,ae,we,De){var me,Fe=l.gl;if(!this.failedToCreate){for(var He in l.program.set(this.program),l.setDepthMode(h),l.setStencilMode(m),l.setColorMode(C),l.setCullFace(P),this.fixedUniforms)this.fixedUniforms[He].set(R[He]);ae&&ae.setUniforms(l,this.binderUniforms,Y,{zoom:re});for(var We=(me={},me[Fe.LINES]=2,me[Fe.TRIANGLES]=3,me[Fe.LINE_STRIP]=1,me)[d],it=0,$e=te.get();it<$e.length;it+=1){var et=$e[it],ht=et.vaos||(et.vaos={});(ht[L]||(ht[L]=new Zl)).bind(l,this,G,ae?ae.getPaintVertexBuffers():[],$,et.vertexOffset,we,De),Fe.drawElements(d,et.primitiveLength*We,Fe.UNSIGNED_SHORT,et.primitiveOffset*We*2)}}};var yh=function(l,d,h,m){var C=d.style.light,P=C.properties.get("position"),R=[P.x,P.y,P.z],L=s.create$1();C.properties.get("anchor")==="viewport"&&s.fromRotation(L,-d.transform.angle),s.transformMat3(R,R,L);var G=C.properties.get("color");return{u_matrix:l,u_lightpos:R,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+h,u_opacity:m}},ko=function(l,d,h,m,C,P,R){return s.extend(yh(l,d,h,m),pc(P,d,R),{u_height_factor:-Math.pow(2,C.overscaledZ)/R.tileSize/8})},Uo=function(l){return{u_matrix:l}},js=function(l,d,h,m){return s.extend(Uo(l),pc(h,d,m))},vh=function(l,d){return{u_matrix:l,u_world:d}},Yl=function(l,d,h,m,C){return s.extend(js(l,d,h,m),{u_world:C})},Ql=function(l,d,h,m){var C,P,R=l.transform;if(m.paint.get("circle-pitch-alignment")==="map"){var L=Tn(h,1,R.zoom);C=!0,P=[L,L]}else C=!1,P=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(d.posMatrix,h,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+C,u_device_pixel_ratio:s.browser.devicePixelRatio,u_extrude_scale:P}},Oa=function(l,d,h){var m=Tn(h,1,d.zoom),C=Math.pow(2,d.zoom-h.tileID.overscaledZ),P=h.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[d.pixelsToGLUnits[0]/(m*C),d.pixelsToGLUnits[1]/(m*C)],u_overscale_factor:P}},af=function(l,d,h){return{u_matrix:l,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},zo=function(l,d,h){return h===void 0&&(h=1),{u_matrix:l,u_color:d,u_overlay:0,u_overlay_scale:h}},Go=function(l){return{u_matrix:l}},cl=function(l,d,h,m){return{u_matrix:l,u_extrude_scale:Tn(d,1,h),u_intensity:m}},Bn=function(l,d,h){var m=l.transform;return{u_matrix:bh(l,d,h),u_ratio:1/Tn(d,1,m.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Mn=function(l,d,h,m){return s.extend(Bn(l,d,h),{u_image:0,u_image_height:m})},eu=function(l,d,h,m){var C=l.transform,P=gc(d,C);return{u_matrix:bh(l,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/Tn(d,1,C.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_image:0,u_scale:[P,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},PA=function(l,d,h,m,C){var P=l.lineAtlas,R=gc(d,l.transform),L=h.layout.get("line-cap")==="round",G=P.getDash(m.from,L),$=P.getDash(m.to,L),te=G.width*C.fromScale,Y=$.width*C.toScale;return s.extend(Bn(l,d,h),{u_patternscale_a:[R/te,-G.height/2],u_patternscale_b:[R/Y,-$.height/2],u_sdfgamma:P.width/(256*Math.min(te,Y)*s.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:$.y,u_mix:C.t})};function gc(l,d){return 1/Tn(l,1,d.tileZoom)}function bh(l,d,h){return l.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var RA=function(l,d,h,m,C){return{u_matrix:l,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(R=C.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(P=C.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:xh(C.paint.get("raster-hue-rotate"))};var P,R};function xh(l){l*=Math.PI/180;var d=Math.sin(l),h=Math.cos(l);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var Ki,Aa=function(l,d,h,m,C,P,R,L,G,$){var te=C.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_pitch:te.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:te.width/te.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:R,u_coord_matrix:L,u_is_text:+G,u_pitch_with_map:+m,u_texsize:$,u_texture:0}},uo=function(l,d,h,m,C,P,R,L,G,$,te){var Y=C.transform;return s.extend(Aa(l,d,h,m,C,P,R,L,G,$),{u_gamma_scale:m?Math.cos(Y._pitch)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:s.browser.devicePixelRatio,u_is_halo:1})},tu=function(l,d,h,m,C,P,R,L,G,$){return s.extend(uo(l,d,h,m,C,P,R,L,!0,G),{u_texsize_icon:$,u_texture_icon:1})},La=function(l,d,h){return{u_matrix:l,u_opacity:d,u_color:h}},mc=function(l,d,h,m,C,P){return s.extend(function(R,L,G,$){var te=G.imageManager.getPattern(R.from.toString()),Y=G.imageManager.getPattern(R.to.toString()),re=G.imageManager.getPixelSize(),ae=re.width,we=re.height,De=Math.pow(2,$.tileID.overscaledZ),me=$.tileSize*Math.pow(2,G.transform.tileZoom)/De,Fe=me*($.tileID.canonical.x+$.tileID.wrap*De),He=me*$.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:te.tl,u_pattern_br_a:te.br,u_pattern_tl_b:Y.tl,u_pattern_br_b:Y.br,u_texsize:[ae,we],u_mix:L.t,u_pattern_size_a:te.displaySize,u_pattern_size_b:Y.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Tn($,1,G.transform.tileZoom),u_pixel_coord_upper:[Fe>>16,He>>16],u_pixel_coord_lower:[65535&Fe,65535&He]}}(m,P,h,C),{u_matrix:l,u_opacity:d})},Ms={fillExtrusion:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_lightpos:new s.Uniform3f(l,d.u_lightpos),u_lightintensity:new s.Uniform1f(l,d.u_lightintensity),u_lightcolor:new s.Uniform3f(l,d.u_lightcolor),u_vertical_gradient:new s.Uniform1f(l,d.u_vertical_gradient),u_opacity:new s.Uniform1f(l,d.u_opacity)}},fillExtrusionPattern:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_lightpos:new s.Uniform3f(l,d.u_lightpos),u_lightintensity:new s.Uniform1f(l,d.u_lightintensity),u_lightcolor:new s.Uniform3f(l,d.u_lightcolor),u_vertical_gradient:new s.Uniform1f(l,d.u_vertical_gradient),u_height_factor:new s.Uniform1f(l,d.u_height_factor),u_image:new s.Uniform1i(l,d.u_image),u_texsize:new s.Uniform2f(l,d.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,d.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,d.u_scale),u_fade:new s.Uniform1f(l,d.u_fade),u_opacity:new s.Uniform1f(l,d.u_opacity)}},fill:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix)}},fillPattern:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_image:new s.Uniform1i(l,d.u_image),u_texsize:new s.Uniform2f(l,d.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,d.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,d.u_scale),u_fade:new s.Uniform1f(l,d.u_fade)}},fillOutline:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_world:new s.Uniform2f(l,d.u_world)}},fillOutlinePattern:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_world:new s.Uniform2f(l,d.u_world),u_image:new s.Uniform1i(l,d.u_image),u_texsize:new s.Uniform2f(l,d.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,d.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,d.u_scale),u_fade:new s.Uniform1f(l,d.u_fade)}},circle:function(l,d){return{u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(l,d.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(l,d.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(l,d.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(l,d.u_matrix)}},collisionBox:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(l,d.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(l,d.u_extrude_scale),u_overscale_factor:new s.Uniform1f(l,d.u_overscale_factor)}},collisionCircle:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_inv_matrix:new s.UniformMatrix4f(l,d.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(l,d.u_viewport_size)}},debug:function(l,d){return{u_color:new s.UniformColor(l,d.u_color),u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_overlay:new s.Uniform1i(l,d.u_overlay),u_overlay_scale:new s.Uniform1f(l,d.u_overlay_scale)}},clippingMask:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix)}},heatmap:function(l,d){return{u_extrude_scale:new s.Uniform1f(l,d.u_extrude_scale),u_intensity:new s.Uniform1f(l,d.u_intensity),u_matrix:new s.UniformMatrix4f(l,d.u_matrix)}},heatmapTexture:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_world:new s.Uniform2f(l,d.u_world),u_image:new s.Uniform1i(l,d.u_image),u_color_ramp:new s.Uniform1i(l,d.u_color_ramp),u_opacity:new s.Uniform1f(l,d.u_opacity)}},hillshade:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_image:new s.Uniform1i(l,d.u_image),u_latrange:new s.Uniform2f(l,d.u_latrange),u_light:new s.Uniform2f(l,d.u_light),u_shadow:new s.UniformColor(l,d.u_shadow),u_highlight:new s.UniformColor(l,d.u_highlight),u_accent:new s.UniformColor(l,d.u_accent)}},hillshadePrepare:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_image:new s.Uniform1i(l,d.u_image),u_dimension:new s.Uniform2f(l,d.u_dimension),u_zoom:new s.Uniform1f(l,d.u_zoom),u_unpack:new s.Uniform4f(l,d.u_unpack)}},line:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_ratio:new s.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,d.u_units_to_pixels)}},lineGradient:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_ratio:new s.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,d.u_units_to_pixels),u_image:new s.Uniform1i(l,d.u_image),u_image_height:new s.Uniform1f(l,d.u_image_height)}},linePattern:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_texsize:new s.Uniform2f(l,d.u_texsize),u_ratio:new s.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_image:new s.Uniform1i(l,d.u_image),u_units_to_pixels:new s.Uniform2f(l,d.u_units_to_pixels),u_scale:new s.Uniform3f(l,d.u_scale),u_fade:new s.Uniform1f(l,d.u_fade)}},lineSDF:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_ratio:new s.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,d.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(l,d.u_patternscale_a),u_patternscale_b:new s.Uniform2f(l,d.u_patternscale_b),u_sdfgamma:new s.Uniform1f(l,d.u_sdfgamma),u_image:new s.Uniform1i(l,d.u_image),u_tex_y_a:new s.Uniform1f(l,d.u_tex_y_a),u_tex_y_b:new s.Uniform1f(l,d.u_tex_y_b),u_mix:new s.Uniform1f(l,d.u_mix)}},raster:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_tl_parent:new s.Uniform2f(l,d.u_tl_parent),u_scale_parent:new s.Uniform1f(l,d.u_scale_parent),u_buffer_scale:new s.Uniform1f(l,d.u_buffer_scale),u_fade_t:new s.Uniform1f(l,d.u_fade_t),u_opacity:new s.Uniform1f(l,d.u_opacity),u_image0:new s.Uniform1i(l,d.u_image0),u_image1:new s.Uniform1i(l,d.u_image1),u_brightness_low:new s.Uniform1f(l,d.u_brightness_low),u_brightness_high:new s.Uniform1f(l,d.u_brightness_high),u_saturation_factor:new s.Uniform1f(l,d.u_saturation_factor),u_contrast_factor:new s.Uniform1f(l,d.u_contrast_factor),u_spin_weights:new s.Uniform3f(l,d.u_spin_weights)}},symbolIcon:function(l,d){return{u_is_size_zoom_constant:new s.Uniform1i(l,d.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,d.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,d.u_size_t),u_size:new s.Uniform1f(l,d.u_size),u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,d.u_pitch),u_rotate_symbol:new s.Uniform1i(l,d.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,d.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,d.u_fade_change),u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,d.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,d.u_coord_matrix),u_is_text:new s.Uniform1i(l,d.u_is_text),u_pitch_with_map:new s.Uniform1i(l,d.u_pitch_with_map),u_texsize:new s.Uniform2f(l,d.u_texsize),u_texture:new s.Uniform1i(l,d.u_texture)}},symbolSDF:function(l,d){return{u_is_size_zoom_constant:new s.Uniform1i(l,d.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,d.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,d.u_size_t),u_size:new s.Uniform1f(l,d.u_size),u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,d.u_pitch),u_rotate_symbol:new s.Uniform1i(l,d.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,d.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,d.u_fade_change),u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,d.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,d.u_coord_matrix),u_is_text:new s.Uniform1i(l,d.u_is_text),u_pitch_with_map:new s.Uniform1i(l,d.u_pitch_with_map),u_texsize:new s.Uniform2f(l,d.u_texsize),u_texture:new s.Uniform1i(l,d.u_texture),u_gamma_scale:new s.Uniform1f(l,d.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(l,d.u_is_halo)}},symbolTextAndIcon:function(l,d){return{u_is_size_zoom_constant:new s.Uniform1i(l,d.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,d.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,d.u_size_t),u_size:new s.Uniform1f(l,d.u_size),u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,d.u_pitch),u_rotate_symbol:new s.Uniform1i(l,d.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,d.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,d.u_fade_change),u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,d.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,d.u_coord_matrix),u_is_text:new s.Uniform1i(l,d.u_is_text),u_pitch_with_map:new s.Uniform1i(l,d.u_pitch_with_map),u_texsize:new s.Uniform2f(l,d.u_texsize),u_texsize_icon:new s.Uniform2f(l,d.u_texsize_icon),u_texture:new s.Uniform1i(l,d.u_texture),u_texture_icon:new s.Uniform1i(l,d.u_texture_icon),u_gamma_scale:new s.Uniform1f(l,d.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(l,d.u_is_halo)}},background:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_opacity:new s.Uniform1f(l,d.u_opacity),u_color:new s.UniformColor(l,d.u_color)}},backgroundPattern:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_opacity:new s.Uniform1f(l,d.u_opacity),u_image:new s.Uniform1i(l,d.u_image),u_pattern_tl_a:new s.Uniform2f(l,d.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(l,d.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(l,d.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(l,d.u_pattern_br_b),u_texsize:new s.Uniform2f(l,d.u_texsize),u_mix:new s.Uniform1f(l,d.u_mix),u_pattern_size_a:new s.Uniform2f(l,d.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(l,d.u_pattern_size_b),u_scale_a:new s.Uniform1f(l,d.u_scale_a),u_scale_b:new s.Uniform1f(l,d.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,d.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(l,d.u_tile_units_to_pixels)}}};function Na(l,d,h,m,C,P,R){for(var L=l.context,G=L.gl,$=l.useProgram("collisionBox"),te=[],Y=0,re=0,ae=0;ae<m.length;ae++){var we=m[ae],De=d.getTile(we),me=De.getBucket(h);if(me){var Fe=we.posMatrix;C[0]===0&&C[1]===0||(Fe=l.translatePosMatrix(we.posMatrix,De,C,P));var He=R?me.textCollisionBox:me.iconCollisionBox,We=me.collisionCircleArray;if(We.length>0){var it=s.create(),$e=Fe;s.mul(it,me.placementInvProjMatrix,l.transform.glCoordMatrix),s.mul(it,it,me.placementViewportMatrix),te.push({circleArray:We,circleOffset:re,transform:$e,invTransform:it}),re=Y+=We.length/4}He&&$.draw(L,G.LINES,ve.disabled,Oe.disabled,l.colorModeForRenderPass(),be.disabled,Oa(Fe,l.transform,De),h.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,l.transform.zoom,null,null,He.collisionVertexBuffer)}}if(R&&te.length){var et=l.useProgram("collisionCircle"),ht=new s.StructArrayLayout2f1f2i16;ht.resize(4*Y),ht._trim();for(var Rt=0,xt=0,Nt=te;xt<Nt.length;xt+=1)for(var rr=Nt[xt],vr=0;vr<rr.circleArray.length/4;vr++){var Cr=4*vr,pn=rr.circleArray[Cr+0],ir=rr.circleArray[Cr+1],zr=rr.circleArray[Cr+2],qr=rr.circleArray[Cr+3];ht.emplace(Rt++,pn,ir,zr,qr,0),ht.emplace(Rt++,pn,ir,zr,qr,1),ht.emplace(Rt++,pn,ir,zr,qr,2),ht.emplace(Rt++,pn,ir,zr,qr,3)}(!Ki||Ki.length<2*Y)&&(Ki=function(vi){var hs=2*vi,Qi=new s.StructArrayLayout3ui6;Qi.resize(hs),Qi._trim();for(var Ai=0;Ai<hs;Ai++){var Ci=6*Ai;Qi.uint16[Ci+0]=4*Ai+0,Qi.uint16[Ci+1]=4*Ai+1,Qi.uint16[Ci+2]=4*Ai+2,Qi.uint16[Ci+3]=4*Ai+2,Qi.uint16[Ci+4]=4*Ai+3,Qi.uint16[Ci+5]=4*Ai+0}return Qi}(Y));for(var kr=L.createIndexBuffer(Ki,!0),Or=L.createVertexBuffer(ht,s.collisionCircleLayout.members,!0),Xr=0,Pr=te;Xr<Pr.length;Xr+=1){var Ir=Pr[Xr],Vi=af(Ir.transform,Ir.invTransform,l.transform);et.draw(L,G.TRIANGLES,ve.disabled,Oe.disabled,l.colorModeForRenderPass(),be.disabled,Vi,h.id,Or,kr,s.SegmentVector.simpleSegment(0,2*Ir.circleOffset,Ir.circleArray.length,Ir.circleArray.length/2),null,l.transform.zoom,null,null,null)}Or.destroy(),kr.destroy()}}var Ps=s.identity(new Float32Array(16));function ka(l,d,h,m,C,P){var R=s.getAnchorAlignment(l),L=-(R.horizontalAlign-.5)*d,G=-(R.verticalAlign-.5)*h,$=s.evaluateVariableOffset(l,m);return new s.Point((L/C+$[0])*P,(G/C+$[1])*P)}function _c(l,d,h,m,C,P,R,L,G,$,te){var Y=l.text.placedSymbolArray,re=l.text.dynamicLayoutVertexArray,ae=l.icon.dynamicLayoutVertexArray,we={};re.clear();for(var De=0;De<Y.length;De++){var me=Y.get(De),Fe=me.hidden||!me.crossTileID||l.allowVerticalPlacement&&!me.placedOrientation?null:m[me.crossTileID];if(Fe){var He=new s.Point(me.anchorX,me.anchorY),We=Wt(He,h?L:R),it=Kr(P.cameraToCenterDistance,We.signedDistanceFromCamera),$e=C.evaluateSizeForFeature(l.textSizeData,$,me)*it/s.ONE_EM;h&&($e*=l.tilePixelRatio/G);for(var et=ka(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textBoxScale,$e),ht=h?Wt(He.add(et),R).point:We.point.add(d?et.rotate(-P.angle):et),Rt=l.allowVerticalPlacement&&me.placedOrientation===s.WritingMode.vertical?Math.PI/2:0,xt=0;xt<me.numGlyphs;xt++)s.addDynamicAttributes(re,ht,Rt);te&&me.associatedIconIndex>=0&&(we[me.associatedIconIndex]={shiftedAnchor:ht,angle:Rt})}else Si(me.numGlyphs,re)}if(te){ae.clear();for(var Nt=l.icon.placedSymbolArray,rr=0;rr<Nt.length;rr++){var vr=Nt.get(rr);if(vr.hidden)Si(vr.numGlyphs,ae);else{var Cr=we[rr];if(Cr)for(var pn=0;pn<vr.numGlyphs;pn++)s.addDynamicAttributes(ae,Cr.shiftedAnchor,Cr.angle);else Si(vr.numGlyphs,ae)}}l.icon.dynamicLayoutVertexBuffer.updateData(ae)}l.text.dynamicLayoutVertexBuffer.updateData(re)}function yc(l,d,h){return h.iconsInText&&d?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Ua(l,d,h,m,C,P,R,L,G,$,te,Y){for(var re=l.context,ae=re.gl,we=l.transform,De=L==="map",me=G==="map",Fe=De&&h.layout.get("symbol-placement")!=="point",He=De&&!me&&!Fe,We=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,it=!1,$e=l.depthModeForSublayer(0,ve.ReadOnly),et=h.layout.get("text-variable-anchor"),ht=[],Rt=0,xt=m;Rt<xt.length;Rt+=1){var Nt=xt[Rt],rr=d.getTile(Nt),vr=rr.getBucket(h);if(vr){var Cr=C?vr.text:vr.icon;if(Cr&&Cr.segments.get().length){var pn=Cr.programConfigurations.get(h.id),ir=C||vr.sdfIcons,zr=C?vr.textSizeData:vr.iconSizeData,qr=me||we.pitch!==0,kr=l.useProgram(yc(ir,C,vr),pn),Or=s.evaluateSizeForZoom(zr,we.zoom),Xr=void 0,Pr=[0,0],Ir=void 0,Vi=void 0,vi=null,hs=void 0;if(C)Ir=rr.glyphAtlasTexture,Vi=ae.LINEAR,Xr=rr.glyphAtlasTexture.size,vr.iconsInText&&(Pr=rr.imageAtlasTexture.size,vi=rr.imageAtlasTexture,hs=qr||l.options.rotating||l.options.zooming||zr.kind==="composite"||zr.kind==="camera"?ae.LINEAR:ae.NEAREST);else{var Qi=h.layout.get("icon-size").constantOr(0)!==1||vr.iconsNeedLinear;Ir=rr.imageAtlasTexture,Vi=ir||l.options.rotating||l.options.zooming||Qi||qr?ae.LINEAR:ae.NEAREST,Xr=rr.imageAtlasTexture.size}var Ai=Tn(rr,1,l.transform.zoom),Ci=fr(Nt.posMatrix,me,De,l.transform,Ai),qs=Me(Nt.posMatrix,me,De,l.transform,Ai),vs=et&&vr.hasTextData(),Bc=h.layout.get("icon-text-fit")!=="none"&&vs&&vr.hasIconData();Fe&&sa(vr,Nt.posMatrix,l,C,Ci,qs,me,$);var Os=l.translatePosMatrix(Nt.posMatrix,rr,P,R),Ko=Fe||C&&et||Bc?Ps:Ci,wo=l.translatePosMatrix(qs,rr,P,R,!0),gf=ir&&h.paint.get(C?"text-halo-width":"icon-halo-width").constantOr(1)!==0,du={program:kr,buffers:Cr,uniformValues:ir?vr.iconsInText?tu(zr.kind,Or,He,me,l,Os,Ko,wo,Xr,Pr):uo(zr.kind,Or,He,me,l,Os,Ko,wo,C,Xr):Aa(zr.kind,Or,He,me,l,Os,Ko,wo,C,Xr),atlasTexture:Ir,atlasTextureIcon:vi,atlasInterpolation:Vi,atlasInterpolationIcon:hs,isSDF:ir,hasHalo:gf};if(We&&vr.canOverlap){it=!0;for(var Sc=0,Au=Cr.segments.get();Sc<Au.length;Sc+=1){var mf=Au[Sc];ht.push({segments:new s.SegmentVector([mf]),sortKey:mf.sortKey,state:du})}}else ht.push({segments:Cr.segments,sortKey:0,state:du})}}}it&&ht.sort(function(Ic,ml){return Ic.sortKey-ml.sortKey});for(var ga=0,_f=ht;ga<_f.length;ga+=1){var ma=_f[ga],Hi=ma.state;if(re.activeTexture.set(ae.TEXTURE0),Hi.atlasTexture.bind(Hi.atlasInterpolation,ae.CLAMP_TO_EDGE),Hi.atlasTextureIcon&&(re.activeTexture.set(ae.TEXTURE1),Hi.atlasTextureIcon&&Hi.atlasTextureIcon.bind(Hi.atlasInterpolationIcon,ae.CLAMP_TO_EDGE)),Hi.isSDF){var Ha=Hi.uniformValues;Hi.hasHalo&&(Ha.u_is_halo=1,vc(Hi.buffers,ma.segments,h,l,Hi.program,$e,te,Y,Ha)),Ha.u_is_halo=0}vc(Hi.buffers,ma.segments,h,l,Hi.program,$e,te,Y,Hi.uniformValues)}}function vc(l,d,h,m,C,P,R,L,G){var $=m.context;C.draw($,$.gl.TRIANGLES,P,R,L,be.disabled,G,h.id,l.layoutVertexBuffer,l.indexBuffer,d,h.paint,m.transform.zoom,l.programConfigurations.get(h.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function ru(l,d,h,m,C,P,R){var L,G,$,te,Y,re=l.context.gl,ae=h.paint.get("fill-pattern"),we=ae&&ae.constantOr(1),De=h.getCrossfadeParameters();R?(G=we&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=re.LINES):(G=we?"fillPattern":"fill",L=re.TRIANGLES);for(var me=0,Fe=m;me<Fe.length;me+=1){var He=Fe[me],We=d.getTile(He);if(!we||We.patternsLoaded()){var it=We.getBucket(h);if(it){var $e=it.programConfigurations.get(h.id),et=l.useProgram(G,$e);we&&(l.context.activeTexture.set(re.TEXTURE0),We.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),$e.updatePaintBuffers(De));var ht=ae.constantOr(null);if(ht&&We.imageAtlas){var Rt=We.imageAtlas,xt=Rt.patternPositions[ht.to.toString()],Nt=Rt.patternPositions[ht.from.toString()];xt&&Nt&&$e.setConstantPatternPositions(xt,Nt)}var rr=l.translatePosMatrix(He.posMatrix,We,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(R){te=it.indexBuffer2,Y=it.segments2;var vr=[re.drawingBufferWidth,re.drawingBufferHeight];$=G==="fillOutlinePattern"&&we?Yl(rr,l,De,We,vr):vh(rr,vr)}else te=it.indexBuffer,Y=it.segments,$=we?js(rr,l,De,We):Uo(rr);et.draw(l.context,L,C,l.stencilModeForClipping(He),P,be.disabled,$,h.id,it.layoutVertexBuffer,te,Y,h.paint,l.transform.zoom,$e)}}}}function ll(l,d,h,m,C,P,R){for(var L=l.context,G=L.gl,$=h.paint.get("fill-extrusion-pattern"),te=$.constantOr(1),Y=h.getCrossfadeParameters(),re=h.paint.get("fill-extrusion-opacity"),ae=0,we=m;ae<we.length;ae+=1){var De=we[ae],me=d.getTile(De),Fe=me.getBucket(h);if(Fe){var He=Fe.programConfigurations.get(h.id),We=l.useProgram(te?"fillExtrusionPattern":"fillExtrusion",He);te&&(l.context.activeTexture.set(G.TEXTURE0),me.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),He.updatePaintBuffers(Y));var it=$.constantOr(null);if(it&&me.imageAtlas){var $e=me.imageAtlas,et=$e.patternPositions[it.to.toString()],ht=$e.patternPositions[it.from.toString()];et&&ht&&He.setConstantPatternPositions(et,ht)}var Rt=l.translatePosMatrix(De.posMatrix,me,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),xt=h.paint.get("fill-extrusion-vertical-gradient"),Nt=te?ko(Rt,l,xt,re,De,Y,me):yh(Rt,l,xt,re);We.draw(L,L.gl.TRIANGLES,C,P,R,be.backCCW,Nt,h.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,h.paint,l.transform.zoom,He)}}}function nu(l,d,h,m,C,P){var R=l.context,L=R.gl,G=d.fbo;if(G){var $=l.useProgram("hillshade");R.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,G.colorAttachment.get());var te=function(Y,re,ae){var we=ae.paint.get("hillshade-shadow-color"),De=ae.paint.get("hillshade-highlight-color"),me=ae.paint.get("hillshade-accent-color"),Fe=ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(Fe-=Y.transform.angle);var He,We,it,$e=!Y.options.moving;return{u_matrix:Y.transform.calculatePosMatrix(re.tileID.toUnwrapped(),$e),u_image:0,u_latrange:(He=re.tileID,We=Math.pow(2,He.canonical.z),it=He.canonical.y,[new s.MercatorCoordinate(0,it/We).toLngLat().lat,new s.MercatorCoordinate(0,(it+1)/We).toLngLat().lat]),u_light:[ae.paint.get("hillshade-exaggeration"),Fe],u_shadow:we,u_highlight:De,u_accent:me}}(l,d,h);$.draw(R,L.TRIANGLES,m,C,P,be.disabled,te,h.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function FA(l,d,h,m,C,P){var R=l.context,L=R.gl,G=d.dem;if(G&&G.data){var $=G.dim,te=G.stride,Y=G.getPixels();if(R.activeTexture.set(L.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||l.getTileTexture(te),d.demTexture){var re=d.demTexture;re.update(Y,{premultiply:!1}),re.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else d.demTexture=new s.Texture(R,Y,L.RGBA,{premultiply:!1}),d.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);R.activeTexture.set(L.TEXTURE0);var ae=d.fbo;if(!ae){var we=new s.Texture(R,{width:$,height:$,data:null},L.RGBA);we.bind(L.LINEAR,L.CLAMP_TO_EDGE),(ae=d.fbo=R.createFramebuffer($,$,!0)).colorAttachment.set(we.texture)}R.bindFramebuffer.set(ae.framebuffer),R.viewport.set([0,0,$,$]),l.useProgram("hillshadePrepare").draw(R,L.TRIANGLES,m,C,P,be.disabled,function(De,me){var Fe=me.stride,He=s.create();return s.ortho(He,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(He,He,[0,-s.EXTENT,0]),{u_matrix:He,u_image:1,u_dimension:[Fe,Fe],u_zoom:De.overscaledZ,u_unpack:me.getUnpackVector()}}(d.tileID,G),h.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function ul(l,d,h,m,C){var P=m.paint.get("raster-fade-duration");if(P>0){var R=s.browser.now(),L=(R-l.timeAdded)/P,G=d?(R-d.timeAdded)/P:-1,$=h.getSource(),te=C.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),Y=!d||Math.abs(d.tileID.overscaledZ-te)>Math.abs(l.tileID.overscaledZ-te),re=Y&&l.refreshedUponExpiration?1:s.clamp(Y?L:1-G,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),d?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}var iu=new s.Color(1,0,0,1),bc=new s.Color(0,1,0,1),za=new s.Color(0,0,1,1),su=new s.Color(1,0,1,1),Ga=new s.Color(0,1,1,1);function cf(l,d,h,m){fl(l,0,d+h/2,l.transform.width,h,m)}function lf(l,d,h,m){fl(l,d-h/2,0,h,l.transform.height,m)}function fl(l,d,h,m,C,P){var R=l.context,L=R.gl;L.enable(L.SCISSOR_TEST),L.scissor(d*s.browser.devicePixelRatio,h*s.browser.devicePixelRatio,m*s.browser.devicePixelRatio,C*s.browser.devicePixelRatio),R.clear({color:P}),L.disable(L.SCISSOR_TEST)}function wh(l,d,h){var m=l.context,C=m.gl,P=h.posMatrix,R=l.useProgram("debug"),L=ve.disabled,G=Oe.disabled,$=l.colorModeForRenderPass();m.activeTexture.set(C.TEXTURE0),l.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),R.draw(m,C.LINE_STRIP,L,G,$,be.disabled,zo(P,s.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var te=d.getTileByID(h.key).latestRawTileData,Y=Math.floor((te&&te.byteLength||0)/1024),re=d.getTile(h).tileSize,ae=512/Math.min(re,512)*(h.overscaledZ/l.transform.zoom)*.5,we=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(we+=" => "+h.overscaledZ),function(De,me){De.initDebugOverlayCanvas();var Fe=De.debugOverlayCanvas,He=De.context.gl,We=De.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,Fe.width,Fe.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(me,5,5),We.strokeText(me,5,5),De.debugOverlayTexture.update(Fe),De.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(l,we+" "+Y+"kb"),R.draw(m,C.TRIANGLES,L,G,de.alphaBlended,be.disabled,zo(P,s.Color.transparent,ae),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Va={symbol:function(l,d,h,m,C){if(l.renderPass==="translucent"){var P=Oe.disabled,R=l.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(L,G,$,te,Y,re,ae){for(var we=G.transform,De=Y==="map",me=re==="map",Fe=0,He=L;Fe<He.length;Fe+=1){var We=He[Fe],it=te.getTile(We),$e=it.getBucket($);if($e&&$e.text&&$e.text.segments.get().length){var et=s.evaluateSizeForZoom($e.textSizeData,we.zoom),ht=Tn(it,1,G.transform.zoom),Rt=fr(We.posMatrix,me,De,G.transform,ht),xt=$.layout.get("icon-text-fit")!=="none"&&$e.hasIconData();if(et){var Nt=Math.pow(2,we.zoom-it.tileID.overscaledZ);_c($e,De,me,ae,s.symbolSize,we,Rt,We.posMatrix,Nt,et,xt)}}}}(m,l,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),C),h.paint.get("icon-opacity").constantOr(1)!==0&&Ua(l,d,h,m,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),P,R),h.paint.get("text-opacity").constantOr(1)!==0&&Ua(l,d,h,m,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),P,R),d.map.showCollisionBoxes&&(Na(l,d,h,m,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Na(l,d,h,m,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(l,d,h,m){if(l.renderPass==="translucent"){var C=h.paint.get("circle-opacity"),P=h.paint.get("circle-stroke-width"),R=h.paint.get("circle-stroke-opacity"),L=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(C.constantOr(1)!==0||P.constantOr(1)!==0&&R.constantOr(1)!==0){for(var G=l.context,$=G.gl,te=l.depthModeForSublayer(0,ve.ReadOnly),Y=Oe.disabled,re=l.colorModeForRenderPass(),ae=[],we=0;we<m.length;we++){var De=m[we],me=d.getTile(De),Fe=me.getBucket(h);if(Fe){var He=Fe.programConfigurations.get(h.id),We={programConfiguration:He,program:l.useProgram("circle",He),layoutVertexBuffer:Fe.layoutVertexBuffer,indexBuffer:Fe.indexBuffer,uniformValues:Ql(l,De,me,h)};if(L)for(var it=0,$e=Fe.segments.get();it<$e.length;it+=1){var et=$e[it];ae.push({segments:new s.SegmentVector([et]),sortKey:et.sortKey,state:We})}else ae.push({segments:Fe.segments,sortKey:0,state:We})}}L&&ae.sort(function(rr,vr){return rr.sortKey-vr.sortKey});for(var ht=0,Rt=ae;ht<Rt.length;ht+=1){var xt=Rt[ht],Nt=xt.state;Nt.program.draw(G,$.TRIANGLES,te,Y,re,be.disabled,Nt.uniformValues,h.id,Nt.layoutVertexBuffer,Nt.indexBuffer,xt.segments,h.paint,l.transform.zoom,Nt.programConfiguration)}}}},heatmap:function(l,d,h,m){if(h.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var C=l.context,P=C.gl,R=Oe.disabled,L=new de([P.ONE,P.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(ae,we,De){var me=ae.gl;ae.activeTexture.set(me.TEXTURE1),ae.viewport.set([0,0,we.width/4,we.height/4]);var Fe=De.heatmapFbo;if(Fe)me.bindTexture(me.TEXTURE_2D,Fe.colorAttachment.get()),ae.bindFramebuffer.set(Fe.framebuffer);else{var He=me.createTexture();me.bindTexture(me.TEXTURE_2D,He),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MAG_FILTER,me.LINEAR),Fe=De.heatmapFbo=ae.createFramebuffer(we.width/4,we.height/4,!1),function(We,it,$e,et){var ht=We.gl;ht.texImage2D(ht.TEXTURE_2D,0,ht.RGBA,it.width/4,it.height/4,0,ht.RGBA,We.extRenderToTextureHalfFloat?We.extTextureHalfFloat.HALF_FLOAT_OES:ht.UNSIGNED_BYTE,null),et.colorAttachment.set($e)}(ae,we,He,Fe)}})(C,l,h),C.clear({color:s.Color.transparent});for(var G=0;G<m.length;G++){var $=m[G];if(!d.hasRenderableParent($)){var te=d.getTile($),Y=te.getBucket(h);if(Y){var re=Y.programConfigurations.get(h.id);l.useProgram("heatmap",re).draw(C,P.TRIANGLES,ve.disabled,R,L,be.disabled,cl($.posMatrix,te,l.transform.zoom,h.paint.get("heatmap-intensity")),h.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,h.paint,l.transform.zoom,re)}}}C.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(ae,we){var De=ae.context,me=De.gl,Fe=we.heatmapFbo;if(Fe){De.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,Fe.colorAttachment.get()),De.activeTexture.set(me.TEXTURE1);var He=we.colorRampTexture;He||(He=we.colorRampTexture=new s.Texture(De,we.colorRamp,me.RGBA)),He.bind(me.LINEAR,me.CLAMP_TO_EDGE),ae.useProgram("heatmapTexture").draw(De,me.TRIANGLES,ve.disabled,Oe.disabled,ae.colorModeForRenderPass(),be.disabled,function(We,it,$e,et){var ht=s.create();s.ortho(ht,0,We.width,We.height,0,0,1);var Rt=We.context.gl;return{u_matrix:ht,u_world:[Rt.drawingBufferWidth,Rt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:it.paint.get("heatmap-opacity")}}(ae,we),we.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments,we.paint,ae.transform.zoom)}}(l,h))},line:function(l,d,h,m){if(l.renderPass==="translucent"){var C=h.paint.get("line-opacity"),P=h.paint.get("line-width");if(C.constantOr(1)!==0&&P.constantOr(1)!==0)for(var R=l.depthModeForSublayer(0,ve.ReadOnly),L=l.colorModeForRenderPass(),G=h.paint.get("line-dasharray"),$=h.paint.get("line-pattern"),te=$.constantOr(1),Y=h.paint.get("line-gradient"),re=h.getCrossfadeParameters(),ae=te?"linePattern":G?"lineSDF":Y?"lineGradient":"line",we=l.context,De=we.gl,me=!0,Fe=0,He=m;Fe<He.length;Fe+=1){var We=He[Fe],it=d.getTile(We);if(!te||it.patternsLoaded()){var $e=it.getBucket(h);if($e){var et=$e.programConfigurations.get(h.id),ht=l.context.program.get(),Rt=l.useProgram(ae,et),xt=me||Rt.program!==ht,Nt=$.constantOr(null);if(Nt&&it.imageAtlas){var rr=it.imageAtlas,vr=rr.patternPositions[Nt.to.toString()],Cr=rr.patternPositions[Nt.from.toString()];vr&&Cr&&et.setConstantPatternPositions(vr,Cr)}var pn=te?eu(l,it,h,re):G?PA(l,it,h,G,re):Y?Mn(l,it,h,$e.lineClipsArray.length):Bn(l,it,h);if(te)we.activeTexture.set(De.TEXTURE0),it.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),et.updatePaintBuffers(re);else if(G&&(xt||l.lineAtlas.dirty))we.activeTexture.set(De.TEXTURE0),l.lineAtlas.bind(we);else if(Y){var ir=$e.gradients[h.id],zr=ir.texture;if(h.gradientVersion!==ir.version){var qr=256;if(h.stepInterpolant){var kr=d.getSource().maxzoom,Or=We.canonical.z===kr?Math.ceil(1<<l.transform.maxZoom-We.canonical.z):1;qr=s.clamp(s.nextPowerOfTwo($e.maxLineLength/s.EXTENT*1024*Or),256,we.maxTextureSize)}ir.gradient=s.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:qr,image:ir.gradient||void 0,clips:$e.lineClipsArray}),ir.texture?ir.texture.update(ir.gradient):ir.texture=new s.Texture(we,ir.gradient,De.RGBA),ir.version=h.gradientVersion,zr=ir.texture}we.activeTexture.set(De.TEXTURE0),zr.bind(h.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}Rt.draw(we,De.TRIANGLES,R,l.stencilModeForClipping(We),L,be.disabled,pn,h.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,h.paint,l.transform.zoom,et,$e.layoutVertexBuffer2),me=!1}}}}},fill:function(l,d,h,m){var C=h.paint.get("fill-color"),P=h.paint.get("fill-opacity");if(P.constantOr(1)!==0){var R=l.colorModeForRenderPass(),L=h.paint.get("fill-pattern"),G=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&C.constantOr(s.Color.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===G){var $=l.depthModeForSublayer(1,l.renderPass==="opaque"?ve.ReadWrite:ve.ReadOnly);ru(l,d,h,m,$,R,!1)}if(l.renderPass==="translucent"&&h.paint.get("fill-antialias")){var te=l.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,ve.ReadOnly);ru(l,d,h,m,te,R,!0)}}},"fill-extrusion":function(l,d,h,m){var C=h.paint.get("fill-extrusion-opacity");if(C!==0&&l.renderPass==="translucent"){var P=new ve(l.context.gl.LEQUAL,ve.ReadWrite,l.depthRangeFor3D);if(C!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))ll(l,d,h,m,P,Oe.disabled,de.disabled),ll(l,d,h,m,P,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var R=l.colorModeForRenderPass();ll(l,d,h,m,P,Oe.disabled,R)}}},hillshade:function(l,d,h,m){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var C=l.context,P=l.depthModeForSublayer(0,ve.ReadOnly),R=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(m):[{},m],G=L[0],$=0,te=L[1];$<te.length;$+=1){var Y=te[$],re=d.getTile(Y);re.needsHillshadePrepare&&l.renderPass==="offscreen"?FA(l,re,h,P,Oe.disabled,R):l.renderPass==="translucent"&&nu(l,re,h,P,G[Y.overscaledZ],R)}C.viewport.set([0,0,l.width,l.height])}},raster:function(l,d,h,m){if(l.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&m.length)for(var C=l.context,P=C.gl,R=d.getSource(),L=l.useProgram("raster"),G=l.colorModeForRenderPass(),$=R instanceof lt?[{},m]:l.stencilConfigForOverlap(m),te=$[0],Y=$[1],re=Y[Y.length-1].overscaledZ,ae=!l.options.moving,we=0,De=Y;we<De.length;we+=1){var me=De[we],Fe=l.depthModeForSublayer(me.overscaledZ-re,h.paint.get("raster-opacity")===1?ve.ReadWrite:ve.ReadOnly,P.LESS),He=d.getTile(me),We=l.transform.calculatePosMatrix(me.toUnwrapped(),ae);He.registerFadeDuration(h.paint.get("raster-fade-duration"));var it=d.findLoadedParent(me,0),$e=ul(He,it,d,h,l.transform),et=void 0,ht=void 0,Rt=h.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;C.activeTexture.set(P.TEXTURE0),He.texture.bind(Rt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(P.TEXTURE1),it?(it.texture.bind(Rt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),et=Math.pow(2,it.tileID.overscaledZ-He.tileID.overscaledZ),ht=[He.tileID.canonical.x*et%1,He.tileID.canonical.y*et%1]):He.texture.bind(Rt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);var xt=RA(We,ht||[0,0],et||1,$e,h);R instanceof lt?L.draw(C,P.TRIANGLES,Fe,Oe.disabled,G,be.disabled,xt,h.id,R.boundsBuffer,l.quadTriangleIndexBuffer,R.boundsSegments):L.draw(C,P.TRIANGLES,Fe,te[me.overscaledZ],G,be.disabled,xt,h.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,d,h){var m=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(C!==0){var P=l.context,R=P.gl,L=l.transform,G=L.tileSize,$=h.paint.get("background-pattern");if(!l.isPatternMissing($)){var te=!$&&m.a===1&&C===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===te){var Y=Oe.disabled,re=l.depthModeForSublayer(0,te==="opaque"?ve.ReadWrite:ve.ReadOnly),ae=l.colorModeForRenderPass(),we=l.useProgram($?"backgroundPattern":"background"),De=L.coveringTiles({tileSize:G});$&&(P.activeTexture.set(R.TEXTURE0),l.imageManager.bind(l.context));for(var me=h.getCrossfadeParameters(),Fe=0,He=De;Fe<He.length;Fe+=1){var We=He[Fe],it=l.transform.calculatePosMatrix(We.toUnwrapped()),$e=$?mc(it,C,l,$,{tileID:We,tileSize:G},me):La(it,C,m);we.draw(P,R.TRIANGLES,re,Y,ae,be.disabled,$e,h.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,d,h){for(var m=0;m<h.length;m++)wh(l,d,h[m])},custom:function(l,d,h){var m=l.context,C=h.implementation;if(l.renderPass==="offscreen"){var P=C.prerender;P&&(l.setCustomLayerDefaults(),m.setColorMode(l.colorModeForRenderPass()),P.call(C,m.gl,l.transform.customLayerMatrix()),m.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),m.setColorMode(l.colorModeForRenderPass()),m.setStencilMode(Oe.disabled);var R=C.renderingMode==="3d"?new ve(l.context.gl.LEQUAL,ve.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ve.ReadOnly);m.setDepthMode(R),C.render(m.gl,l.transform.customLayerMatrix()),m.setDirty(),l.setBaseState(),m.bindFramebuffer.set(null)}}},zn=function(l,d){this.context=new ce(l),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=Se.maxUnderzooming+Se.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new aa,this.gpuTimers={}};zn.prototype.resize=function(l,d){if(this.width=l*s.browser.devicePixelRatio,this.height=d*s.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,m=this.style._order;h<m.length;h+=1)this.style._layers[m[h]].resize()},zn.prototype.setup=function(){var l=this.context,d=new s.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(s.EXTENT,0),d.emplaceBack(0,s.EXTENT),d.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(d,si.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);var h=new s.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(s.EXTENT,0),h.emplaceBack(0,s.EXTENT),h.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=l.createVertexBuffer(h,si.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);var m=new s.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(s.EXTENT,0,s.EXTENT,0),m.emplaceBack(0,s.EXTENT,0,s.EXTENT),m.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(m,tt.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);var C=new s.StructArrayLayout2i4;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(C,si.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);var P=new s.StructArrayLayout1ui2;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(P);var R=new s.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(R),this.emptyTexture=new s.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Oe({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},zn.prototype.clearStencil=function(){var l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=s.create();s.ortho(h,0,this.width,this.height,0,0,1),s.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,d.TRIANGLES,ve.disabled,this.stencilClearMode,de.disabled,be.disabled,Go(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},zn.prototype._renderTileClippingMasks=function(l,d){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&d&&d.length){this.currentStencilSource=l.source;var h=this.context,m=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(de.disabled),h.setDepthMode(ve.disabled);var C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var P=0,R=d;P<R.length;P+=1){var L=R[P],G=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;C.draw(h,m.TRIANGLES,ve.disabled,new Oe({func:m.ALWAYS,mask:0},G,255,m.KEEP,m.KEEP,m.REPLACE),de.disabled,be.disabled,Go(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},zn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,d=this.context.gl;return new Oe({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)},zn.prototype.stencilModeForClipping=function(l){var d=this.context.gl;return new Oe({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)},zn.prototype.stencilConfigForOverlap=function(l){var d,h=this.context.gl,m=l.sort(function(G,$){return $.overscaledZ-G.overscaledZ}),C=m[m.length-1].overscaledZ,P=m[0].overscaledZ-C+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();for(var R={},L=0;L<P;L++)R[L+C]=new Oe({func:h.GEQUAL,mask:255},L+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=P,[R,m]}return[(d={},d[C]=Oe.disabled,d),m]},zn.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new de([l.CONSTANT_COLOR,l.ONE],new s.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?de.unblended:de.alphaBlended},zn.prototype.depthModeForSublayer=function(l,d,h){if(!this.opaquePassEnabledForLayer())return ve.disabled;var m=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ve(h||this.context.gl.LEQUAL,d,[m,m])},zn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},zn.prototype.render=function(l,d){var h=this;this.style=l,this.options=d,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(s.browser.now()),this.imageManager.beginFrame();var m=this.style._order,C=this.style.sourceCaches;for(var P in C){var R=C[P];R.used&&R.prepare(this.context)}var L,G,$={},te={},Y={};for(var re in C){var ae=C[re];$[re]=ae.getVisibleCoordinates(),te[re]=$[re].slice().reverse(),Y[re]=ae.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var we=0;we<m.length;we++)if(this.style._layers[m[we]].is3D()){this.opaquePassCutoff=we;break}this.renderPass="offscreen";for(var De=0,me=m;De<me.length;De+=1){var Fe=this.style._layers[me[De]];if(Fe.hasOffscreenPass()&&!Fe.isHidden(this.transform.zoom)){var He=te[Fe.source];(Fe.type==="custom"||He.length)&&this.renderLayer(this,C[Fe.source],Fe,He)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){var We=this.style._layers[m[this.currentLayer]],it=C[We.source],$e=$[We.source];this._renderTileClippingMasks(We,$e),this.renderLayer(this,it,We,$e)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){var et=this.style._layers[m[this.currentLayer]],ht=C[et.source],Rt=(et.type==="symbol"?Y:te)[et.source];this._renderTileClippingMasks(et,$[et.source]),this.renderLayer(this,ht,et,Rt)}this.options.showTileBoundaries&&(s.values(this.style._layers).forEach(function(xt){xt.source&&!xt.isHidden(h.transform.zoom)&&(xt.source!==(G&&G.id)&&(G=h.style.sourceCaches[xt.source]),(!L||L.getSource().maxzoom<G.getSource().maxzoom)&&(L=G))}),L&&Va.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(xt){var Nt=xt.transform.padding;cf(xt,xt.transform.height-(Nt.top||0),3,iu),cf(xt,Nt.bottom||0,3,bc),lf(xt,Nt.left||0,3,za),lf(xt,xt.transform.width-(Nt.right||0),3,su);var rr=xt.transform.centerPoint;(function(vr,Cr,pn,ir){fl(vr,Cr-1,pn-10,2,20,ir),fl(vr,Cr-10,pn-1,20,2,ir)})(xt,rr.x,xt.transform.height-rr.y,Ga)}(this),this.context.setDefault()},zn.prototype.renderLayer=function(l,d,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||m.length)&&(this.id=h.id,this.gpuTimingStart(h),Va[h.type](l,d,h,m,this.style.placement.variableOffsets),this.gpuTimingEnd())},zn.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[l.id];h||(h=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},zn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},zn.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},zn.prototype.queryGpuTimers=function(l){var d={};for(var h in l){var m=l[h],C=this.context.extTimerQuery,P=C.getQueryObjectEXT(m.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(m.query),d[h]=P}return d},zn.prototype.translatePosMatrix=function(l,d,h,m,C){if(!h[0]&&!h[1])return l;var P=C?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(P){var R=Math.sin(P),L=Math.cos(P);h=[h[0]*L-h[1]*R,h[0]*R+h[1]*L]}var G=[C?h[0]:Tn(d,h[0],this.transform.zoom),C?h[1]:Tn(d,h[1],this.transform.zoom),0],$=new Float32Array(16);return s.translate($,l,G),$},zn.prototype.saveTileTexture=function(l){var d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]},zn.prototype.getTileTexture=function(l){var d=this._tileTextures[l];return d&&d.length>0?d.pop():null},zn.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var d=this.imageManager.getPattern(l.from.toString()),h=this.imageManager.getPattern(l.to.toString());return!d||!h},zn.prototype.useProgram=function(l,d){this.cache=this.cache||{};var h=""+l+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new _h(this.context,l,ql[l],d,Ms[l],this._showOverdrawInspector)),this.cache[h]},zn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},zn.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},zn.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},zn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ou=function(l,d){this.points=l,this.planes=d};ou.fromInvProjectionMatrix=function(l,d,h){var m=Math.pow(2,h),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return s.transformMat4([],R,l)}).map(function(R){return s.scale$1([],R,1/R[3]/d*m)}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var L=s.sub([],C[R[0]],C[R[1]]),G=s.sub([],C[R[2]],C[R[1]]),$=s.normalize([],s.cross([],L,G)),te=-s.dot($,C[R[1]]);return $.concat(te)});return new ou(C,P)};var Vo=function(l,d){this.min=l,this.max=d,this.center=s.scale$2([],s.add([],this.min,this.max),.5)};Vo.prototype.quadrant=function(l){for(var d=[l%2==0,l<2],h=s.clone$2(this.min),m=s.clone$2(this.max),C=0;C<d.length;C++)h[C]=d[C]?this.min[C]:this.center[C],m[C]=d[C]?this.center[C]:this.max[C];return m[2]=this.max[2],new Vo(h,m)},Vo.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Vo.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Vo.prototype.intersects=function(l){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,m=0;m<l.planes.length;m++){for(var C=l.planes[m],P=0,R=0;R<d.length;R++)P+=s.dot$1(C,d[R])>=0;if(P===0)return 0;P!==d.length&&(h=!1)}if(h)return 2;for(var L=0;L<3;L++){for(var G=Number.MAX_VALUE,$=-Number.MAX_VALUE,te=0;te<l.points.length;te++){var Y=l.points[te][L]-this.min[L];G=Math.min(G,Y),$=Math.max($,Y)}if($<0||G>this.max[L]-this.min[L])return 0}return 1};var Ho=function(l,d,h,m){if(l===void 0&&(l=0),d===void 0&&(d=0),h===void 0&&(h=0),m===void 0&&(m=0),isNaN(l)||l<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=h,this.right=m};Ho.prototype.interpolate=function(l,d,h){return d.top!=null&&l.top!=null&&(this.top=s.number(l.top,d.top,h)),d.bottom!=null&&l.bottom!=null&&(this.bottom=s.number(l.bottom,d.bottom,h)),d.left!=null&&l.left!=null&&(this.left=s.number(l.left,d.left,h)),d.right!=null&&l.right!=null&&(this.right=s.number(l.right,d.right,h)),this},Ho.prototype.getCenter=function(l,d){var h=s.clamp((this.left+l-this.right)/2,0,l),m=s.clamp((this.top+d-this.bottom)/2,0,d);return new s.Point(h,m)},Ho.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Ho.prototype.clone=function(){return new Ho(this.top,this.bottom,this.left,this.right)},Ho.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var nn=function(l,d,h,m,C){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=C===void 0||C,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=h??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ho,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pn={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};nn.prototype.clone=function(){var l=new nn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Pn.minZoom.get=function(){return this._minZoom},Pn.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Pn.maxZoom.get=function(){return this._maxZoom},Pn.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Pn.minPitch.get=function(){return this._minPitch},Pn.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Pn.maxPitch.get=function(){return this._maxPitch},Pn.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Pn.renderWorldCopies.get=function(){return this._renderWorldCopies},Pn.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Pn.worldSize.get=function(){return this.tileSize*this.scale},Pn.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pn.size.get=function(){return new s.Point(this.width,this.height)},Pn.bearing.get=function(){return-this.angle/Math.PI*180},Pn.bearing.set=function(l){var d=-s.wrap(l,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=s.create$2(),s.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pn.pitch.get=function(){return this._pitch/Math.PI*180},Pn.pitch.set=function(l){var d=s.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},Pn.fov.get=function(){return this._fov/Math.PI*180},Pn.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Pn.zoom.get=function(){return this._zoom},Pn.zoom.set=function(l){var d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},Pn.center.get=function(){return this._center},Pn.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Pn.padding.get=function(){return this._edgeInsets.toJSON()},Pn.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Pn.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},nn.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},nn.prototype.interpolatePadding=function(l,d,h){this._unmodified=!1,this._edgeInsets.interpolate(l,d,h),this._constrain(),this._calcMatrices()},nn.prototype.coveringZoomLevel=function(l){var d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)},nn.prototype.getVisibleUnwrappedCoordinates=function(l){var d=[new s.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new s.Point(0,0)),m=this.pointCoordinate(new s.Point(this.width,0)),C=this.pointCoordinate(new s.Point(this.width,this.height)),P=this.pointCoordinate(new s.Point(0,this.height)),R=Math.floor(Math.min(h.x,m.x,C.x,P.x)),L=Math.floor(Math.max(h.x,m.x,C.x,P.x)),G=R-1;G<=L+1;G++)G!==0&&d.push(new s.UnwrappedTileID(G,l));return d},nn.prototype.coveringTiles=function(l){var d=this.coveringZoomLevel(l),h=d;if(l.minzoom!==void 0&&d<l.minzoom)return[];l.maxzoom!==void 0&&d>l.maxzoom&&(d=l.maxzoom);var m=s.MercatorCoordinate.fromLngLat(this.center),C=Math.pow(2,d),P=[C*m.x,C*m.y,0],R=ou.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=d);var G=function(xt){return{aabb:new Vo([xt*C,0,0],[(xt+1)*C,C,0]),zoom:0,x:0,y:0,wrap:xt,fullyVisible:!1}},$=[],te=[],Y=d,re=l.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var ae=1;ae<=3;ae++)$.push(G(-ae)),$.push(G(ae));for($.push(G(0));$.length>0;){var we=$.pop(),De=we.x,me=we.y,Fe=we.fullyVisible;if(!Fe){var He=we.aabb.intersects(R);if(He===0)continue;Fe=He===2}var We=we.aabb.distanceX(P),it=we.aabb.distanceY(P),$e=Math.max(Math.abs(We),Math.abs(it));if(we.zoom===Y||$e>3+(1<<Y-we.zoom)-2&&we.zoom>=L)te.push({tileID:new s.OverscaledTileID(we.zoom===Y?re:we.zoom,we.wrap,we.zoom,De,me),distanceSq:s.sqrLen([P[0]-.5-De,P[1]-.5-me])});else for(var et=0;et<4;et++){var ht=(De<<1)+et%2,Rt=(me<<1)+(et>>1);$.push({aabb:we.aabb.quadrant(et),zoom:we.zoom+1,x:ht,y:Rt,wrap:we.wrap,fullyVisible:Fe})}}return te.sort(function(xt,Nt){return xt.distanceSq-Nt.distanceSq}).map(function(xt){return xt.tileID})},nn.prototype.resize=function(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()},Pn.unmodified.get=function(){return this._unmodified},nn.prototype.zoomScale=function(l){return Math.pow(2,l)},nn.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},nn.prototype.project=function(l){var d=s.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.Point(s.mercatorXfromLng(l.lng)*this.worldSize,s.mercatorYfromLat(d)*this.worldSize)},nn.prototype.unproject=function(l){return new s.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Pn.point.get=function(){return this.project(this.center)},nn.prototype.setLocationAtPoint=function(l,d){var h=this.pointCoordinate(d),m=this.pointCoordinate(this.centerPoint),C=this.locationCoordinate(l),P=new s.MercatorCoordinate(C.x-(h.x-m.x),C.y-(h.y-m.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())},nn.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},nn.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},nn.prototype.locationCoordinate=function(l){return s.MercatorCoordinate.fromLngLat(l)},nn.prototype.coordinateLocation=function(l){return l.toLngLat()},nn.prototype.pointCoordinate=function(l){var d=[l.x,l.y,0,1],h=[l.x,l.y,1,1];s.transformMat4(d,d,this.pixelMatrixInverse),s.transformMat4(h,h,this.pixelMatrixInverse);var m=d[3],C=h[3],P=d[1]/m,R=h[1]/C,L=d[2]/m,G=h[2]/C,$=L===G?0:(0-L)/(G-L);return new s.MercatorCoordinate(s.number(d[0]/m,h[0]/C,$)/this.worldSize,s.number(P,R,$)/this.worldSize)},nn.prototype.coordinatePoint=function(l){var d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.transformMat4(d,d,this.pixelMatrix),new s.Point(d[0]/d[3],d[1]/d[3])},nn.prototype.getBounds=function(){return new s.LngLatBounds().extend(this.pointLocation(new s.Point(0,0))).extend(this.pointLocation(new s.Point(this.width,0))).extend(this.pointLocation(new s.Point(this.width,this.height))).extend(this.pointLocation(new s.Point(0,this.height)))},nn.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},nn.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},nn.prototype.calculatePosMatrix=function(l,d){d===void 0&&(d=!1);var h=l.key,m=d?this._alignedPosMatrixCache:this._posMatrixCache;if(m[h])return m[h];var C=l.canonical,P=this.worldSize/this.zoomScale(C.z),R=C.x+Math.pow(2,C.z)*l.wrap,L=s.identity(new Float64Array(16));return s.translate(L,L,[R*P,C.y*P,0]),s.scale(L,L,[P/s.EXTENT,P/s.EXTENT,1]),s.multiply(L,d?this.alignedProjMatrix:this.projMatrix,L),m[h]=new Float32Array(L),m[h]},nn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},nn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,d,h,m,C=-90,P=90,R=-180,L=180,G=this.size,$=this._unmodified;if(this.latRange){var te=this.latRange;C=s.mercatorYfromLat(te[1])*this.worldSize,l=(P=s.mercatorYfromLat(te[0])*this.worldSize)-C<G.y?G.y/(P-C):0}if(this.lngRange){var Y=this.lngRange;R=s.mercatorXfromLng(Y[0])*this.worldSize,d=(L=s.mercatorXfromLng(Y[1])*this.worldSize)-R<G.x?G.x/(L-R):0}var re=this.point,ae=Math.max(d||0,l||0);if(ae)return this.center=this.unproject(new s.Point(d?(L+R)/2:re.x,l?(P+C)/2:re.y)),this.zoom+=this.scaleZoom(ae),this._unmodified=$,void(this._constraining=!1);if(this.latRange){var we=re.y,De=G.y/2;we-De<C&&(m=C+De),we+De>P&&(m=P-De)}if(this.lngRange){var me=re.x,Fe=G.x/2;me-Fe<R&&(h=R+Fe),me+Fe>L&&(h=L-Fe)}h===void 0&&m===void 0||(this.center=this.unproject(new s.Point(h!==void 0?h:re.x,m!==void 0?m:re.y))),this._unmodified=$,this._constraining=!1}},nn.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+l.y/this.height),m=Math.sin(h)*this.cameraToCenterDistance/Math.sin(s.clamp(Math.PI-d-h,.01,Math.PI-.01)),C=this.point,P=C.x,R=C.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*m+this.cameraToCenterDistance),G=this.height/50,$=new Float64Array(16);s.perspective($,this._fov,this.width/this.height,G,L),$[8]=2*-l.x/this.width,$[9]=2*l.y/this.height,s.scale($,$,[1,-1,1]),s.translate($,$,[0,0,-this.cameraToCenterDistance]),s.rotateX($,$,this._pitch),s.rotateZ($,$,this.angle),s.translate($,$,[-P,-R,0]),this.mercatorMatrix=s.scale([],$,[this.worldSize,this.worldSize,this.worldSize]),s.scale($,$,[1,1,s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=$,this.invProjMatrix=s.invert([],this.projMatrix);var te=this.width%2/2,Y=this.height%2/2,re=Math.cos(this.angle),ae=Math.sin(this.angle),we=P-Math.round(P)+re*te+ae*Y,De=R-Math.round(R)+re*Y+ae*te,me=new Float64Array($);if(s.translate(me,me,[we>.5?we-1:we,De>.5?De-1:De,0]),this.alignedProjMatrix=me,$=s.create(),s.scale($,$,[this.width/2,-this.height/2,1]),s.translate($,$,[1,-1,0]),this.labelPlaneMatrix=$,$=s.create(),s.scale($,$,[1,-1,1]),s.translate($,$,[-1,-1,0]),s.scale($,$,[2/this.width,2/this.height,1]),this.glCoordMatrix=$,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!($=s.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=$,this._posMatrixCache={},this._alignedPosMatrixCache={}}},nn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new s.Point(0,0)),d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},nn.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,l))},nn.prototype.getCameraQueryGeometry=function(l){var d=this.getCameraPoint();if(l.length===1)return[l[0],d];for(var h=d.x,m=d.y,C=d.x,P=d.y,R=0,L=l;R<L.length;R+=1){var G=L[R];h=Math.min(h,G.x),m=Math.min(m,G.y),C=Math.max(C,G.x),P=Math.max(P,G.y)}return[new s.Point(h,m),new s.Point(C,m),new s.Point(C,P),new s.Point(h,P),new s.Point(h,m)]},Object.defineProperties(nn.prototype,Pn);var Rs=function(l){var d,h,m,C;this._hashName=l&&encodeURIComponent(l),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,m=null,C=function(){m=null,h&&(d(),m=setTimeout(C,300),h=!1)},function(){return h=!0,m||C(),m})};Rs.prototype.addTo=function(l){return this._map=l,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Rs.prototype.remove=function(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Rs.prototype.getHashString=function(l){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,m),P=Math.round(d.lng*C)/C,R=Math.round(d.lat*C)/C,L=this._map.getBearing(),G=this._map.getPitch(),$="";if($+=l?"/"+P+"/"+R+"/"+h:h+"/"+R+"/"+P,(L||G)&&($+="/"+Math.round(10*L)/10),G&&($+="/"+Math.round(G)),this._hashName){var te=this._hashName,Y=!1,re=s.window.location.hash.slice(1).split("&").map(function(ae){var we=ae.split("=")[0];return we===te?(Y=!0,we+"="+$):ae}).filter(function(ae){return ae});return Y||re.push(te+"="+$),"#"+re.join("&")}return"#"+$},Rs.prototype._getCurrentHash=function(){var l,d=this,h=s.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(m){return m.split("=")}).forEach(function(m){m[0]===d._hashName&&(l=m)}),(l&&l[1]||"").split("/")):h.split("/")},Rs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0}return!1},Rs.prototype._updateHashUnthrottled=function(){var l=s.window.location.href.replace(/(#.+)?$/,this.getHashString());try{s.window.history.replaceState(s.window.history.state,null,l)}catch{}};var hl={linearity:.3,easing:s.bezier(0,0,.3,1)},xc=s.extend({deceleration:2500,maxSpeed:1400},hl),dl=s.extend({deceleration:20,maxSpeed:1400},hl),DA=s.extend({deceleration:1e3,maxSpeed:360},hl),OA=s.extend({deceleration:1e3,maxSpeed:90},hl),wc=function(l){this._map=l,this.clear()};function Al(l,d){(!l.duration||l.duration<d.duration)&&(l.duration=d.duration,l.easing=d.easing)}function vo(l,d,h){var m=h.maxSpeed,C=h.linearity,P=h.deceleration,R=s.clamp(l*C/(d/1e3),-m,m),L=Math.abs(R)/(P*C);return{easing:h.easing,duration:1e3*L,amount:R*(L/2)}}wc.prototype.clear=function(){this._inertiaBuffer=[]},wc.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.browser.now(),settings:l})},wc.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,d=s.browser.now();l.length>0&&d-l[0].time>160;)l.shift()},wc.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0},h=0,m=this._inertiaBuffer;h<m.length;h+=1){var C=m[h].settings;d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround)}var P=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(d.pan.mag()){var L=vo(d.pan.mag(),P,s.extend({},xc,l||{}));R.offset=d.pan.mult(L.amount/d.pan.mag()),R.center=this._map.transform.center,Al(R,L)}if(d.zoom){var G=vo(d.zoom,P,dl);R.zoom=this._map.transform.zoom+G.amount,Al(R,G)}if(d.bearing){var $=vo(d.bearing,P,DA);R.bearing=this._map.transform.bearing+s.clamp($.amount,-179,179),Al(R,$)}if(d.pitch){var te=vo(d.pitch,P,OA);R.pitch=this._map.transform.pitch+te.amount,Al(R,te)}if(R.zoom||R.bearing){var Y=d.pinchAround===void 0?d.around:d.pinchAround;R.around=Y?this._map.unproject(Y):this._map.getCenter()}return this.clear(),s.extend(R,{noMoveStart:!0})}};var Rn=function(l){function d(m,C,P,R){R===void 0&&(R={});var L=f.mousePos(C.getCanvasContainer(),P),G=C.unproject(L);l.call(this,m,s.extend({point:L,lngLat:G,originalEvent:P},R)),this._defaultPrevented=!1,this.target=C}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(s.Event),Cc=function(l){function d(m,C,P){var R=m==="touchend"?P.changedTouches:P.touches,L=f.touchPos(C.getCanvasContainer(),R),G=L.map(function(Y){return C.unproject(Y)}),$=L.reduce(function(Y,re,ae,we){return Y.add(re.div(we.length))},new s.Point(0,0)),te=C.unproject($);l.call(this,m,{points:L,point:$,lngLats:G,lngLat:te,originalEvent:P}),this._defaultPrevented=!1}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(s.Event),Ch=function(l){function d(m,C,P){l.call(this,m,{originalEvent:P}),this._defaultPrevented=!1}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(s.Event),_i=function(l,d){this._map=l,this._clickTolerance=d.clickTolerance};_i.prototype.reset=function(){delete this._mousedownPos},_i.prototype.wheel=function(l){return this._firePreventable(new Ch(l.type,this._map,l))},_i.prototype.mousedown=function(l,d){return this._mousedownPos=d,this._firePreventable(new Rn(l.type,this._map,l))},_i.prototype.mouseup=function(l){this._map.fire(new Rn(l.type,this._map,l))},_i.prototype.click=function(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Rn(l.type,this._map,l))},_i.prototype.dblclick=function(l){return this._firePreventable(new Rn(l.type,this._map,l))},_i.prototype.mouseover=function(l){this._map.fire(new Rn(l.type,this._map,l))},_i.prototype.mouseout=function(l){this._map.fire(new Rn(l.type,this._map,l))},_i.prototype.touchstart=function(l){return this._firePreventable(new Cc(l.type,this._map,l))},_i.prototype.touchmove=function(l){this._map.fire(new Cc(l.type,this._map,l))},_i.prototype.touchend=function(l){this._map.fire(new Cc(l.type,this._map,l))},_i.prototype.touchcancel=function(l){this._map.fire(new Cc(l.type,this._map,l))},_i.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},_i.prototype.isEnabled=function(){return!0},_i.prototype.isActive=function(){return!1},_i.prototype.enable=function(){},_i.prototype.disable=function(){};var nr=function(l){this._map=l};nr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},nr.prototype.mousemove=function(l){this._map.fire(new Rn(l.type,this._map,l))},nr.prototype.mousedown=function(){this._delayContextMenu=!0},nr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Rn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},nr.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Rn(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},nr.prototype.isEnabled=function(){return!0},nr.prototype.isActive=function(){return!1},nr.prototype.enable=function(){},nr.prototype.disable=function(){};var ms=function(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1};function au(l,d){for(var h={},m=0;m<l.length;m++)h[l[m].identifier]=d[m];return h}ms.prototype.isEnabled=function(){return!!this._enabled},ms.prototype.isActive=function(){return!!this._active},ms.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ms.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ms.prototype.mousedown=function(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(f.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},ms.prototype.mousemoveWindow=function(l,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var m=this._startPos;this._lastPos=h,this._box||(this._box=f.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var C=Math.min(m.x,h.x),P=Math.max(m.x,h.x),R=Math.min(m.y,h.y),L=Math.max(m.y,h.y);f.setTransform(this._box,"translate("+C+"px,"+R+"px)"),this._box.style.width=P-C+"px",this._box.style.height=L-R+"px"}}},ms.prototype.mouseupWindow=function(l,d){var h=this;if(this._active&&l.button===0){var m=this._startPos,C=d;if(this.reset(),f.suppressClick(),m.x!==C.x||m.y!==C.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(P){return P.fitScreenCoordinates(m,C,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},ms.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},ms.prototype.blur=function(){this.reset()},ms.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(f.remove(this._box),this._box=null),f.enableDrag(),delete this._startPos,delete this._lastPos},ms.prototype._fireEvent=function(l,d){return this._map.fire(new s.Event(l,{originalEvent:d}))};var Fs=function(l){this.reset(),this.numTouches=l.numTouches};Fs.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Fs.prototype.touchstart=function(l,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){for(var C=new s.Point(0,0),P=0,R=m;P<R.length;P+=1)C._add(R[P]);return C.div(m.length)}(d),this.touches=au(h,d)))},Fs.prototype.touchmove=function(l,d,h){if(!this.aborted&&this.centroid){var m=au(h,d);for(var C in this.touches){var P=m[C];(!P||P.dist(this.touches[C])>30)&&(this.aborted=!0)}}},Fs.prototype.touchend=function(l,d,h){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var m=!this.aborted&&this.centroid;if(this.reset(),m)return m}};var Js=function(l){this.singleTap=new Fs(l),this.numTaps=l.numTaps,this.reset()};Js.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Js.prototype.touchstart=function(l,d,h){this.singleTap.touchstart(l,d,h)},Js.prototype.touchmove=function(l,d,h){this.singleTap.touchmove(l,d,h)},Js.prototype.touchend=function(l,d,h){var m=this.singleTap.touchend(l,d,h);if(m){var C=l.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(m)<30;if(C&&P||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}};var us=function(){this._zoomIn=new Js({numTouches:1,numTaps:2}),this._zoomOut=new Js({numTouches:2,numTaps:1}),this.reset()};us.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},us.prototype.touchstart=function(l,d,h){this._zoomIn.touchstart(l,d,h),this._zoomOut.touchstart(l,d,h)},us.prototype.touchmove=function(l,d,h){this._zoomIn.touchmove(l,d,h),this._zoomOut.touchmove(l,d,h)},us.prototype.touchend=function(l,d,h){var m=this,C=this._zoomIn.touchend(l,d,h),P=this._zoomOut.touchend(l,d,h);return C?(this._active=!0,l.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(C)},{originalEvent:l})}}):P?(this._active=!0,l.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(P)},{originalEvent:l})}}):void 0},us.prototype.touchcancel=function(){this.reset()},us.prototype.enable=function(){this._enabled=!0},us.prototype.disable=function(){this._enabled=!1,this.reset()},us.prototype.isEnabled=function(){return this._enabled},us.prototype.isActive=function(){return this._active};var uf={0:1,2:2},Kt=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Kt.prototype.blur=function(){this.reset()},Kt.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Kt.prototype._correctButton=function(l,d){return!1},Kt.prototype._move=function(l,d){return{}},Kt.prototype.mousedown=function(l,d){if(!this._lastPoint){var h=f.mouseButton(l);this._correctButton(l,h)&&(this._lastPoint=d,this._eventButton=h)}},Kt.prototype.mousemoveWindow=function(l,d){var h=this._lastPoint;if(h){if(l.preventDefault(),function(m,C){var P=uf[C];return m.buttons===void 0||(m.buttons&P)!==P}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},Kt.prototype.mouseupWindow=function(l){this._lastPoint&&f.mouseButton(l)===this._eventButton&&(this._moved&&f.suppressClick(),this.reset())},Kt.prototype.enable=function(){this._enabled=!0},Kt.prototype.disable=function(){this._enabled=!1,this.reset()},Kt.prototype.isEnabled=function(){return this._enabled},Kt.prototype.isActive=function(){return this._active};var ff=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.mousedown=function(h,m){l.prototype.mousedown.call(this,h,m),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,m){return m===0&&!h.ctrlKey},d.prototype._move=function(h,m){return{around:m,panDelta:m.sub(h)}},d}(Kt),cu=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype._correctButton=function(h,m){return m===0&&h.ctrlKey||m===2},d.prototype._move=function(h,m){var C=.8*(m.x-h.x);if(C)return this._active=!0,{bearingDelta:C}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Kt),hf=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype._correctButton=function(h,m){return m===0&&h.ctrlKey||m===2},d.prototype._move=function(h,m){var C=-.5*(m.y-h.y);if(C)return this._active=!0,{pitchDelta:C}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Kt),Ws=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ws.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)},Ws.prototype.touchstart=function(l,d,h){return this._calculateTransform(l,d,h)},Ws.prototype.touchmove=function(l,d,h){if(this._active&&!(h.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,d,h)},Ws.prototype.touchend=function(l,d,h){this._calculateTransform(l,d,h),this._active&&h.length<this._minTouches&&this.reset()},Ws.prototype.touchcancel=function(){this.reset()},Ws.prototype._calculateTransform=function(l,d,h){h.length>0&&(this._active=!0);var m=au(h,d),C=new s.Point(0,0),P=new s.Point(0,0),R=0;for(var L in m){var G=m[L],$=this._touches[L];$&&(C._add(G),P._add(G.sub($)),R++,m[L]=G)}if(this._touches=m,!(R<this._minTouches)&&P.mag()){var te=P.div(R);if(this._sum._add(te),!(this._sum.mag()<this._clickTolerance))return{around:C.div(R),panDelta:te}}},Ws.prototype.enable=function(){this._enabled=!0},Ws.prototype.disable=function(){this._enabled=!1,this.reset()},Ws.prototype.isEnabled=function(){return this._enabled},Ws.prototype.isActive=function(){return this._active};var _s=function(){this.reset()};function lu(l,d,h){for(var m=0;m<l.length;m++)if(l[m].identifier===h)return d[m]}function uu(l,d){return Math.log(l/d)/Math.LN2}_s.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},_s.prototype._start=function(l){},_s.prototype._move=function(l,d,h){return{}},_s.prototype.touchstart=function(l,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},_s.prototype.touchmove=function(l,d,h){if(this._firstTwoTouches){l.preventDefault();var m=this._firstTwoTouches,C=m[1],P=lu(h,d,m[0]),R=lu(h,d,C);if(P&&R){var L=this._aroundCenter?null:P.add(R).div(2);return this._move([P,R],L,l)}}},_s.prototype.touchend=function(l,d,h){if(this._firstTwoTouches){var m=this._firstTwoTouches,C=m[1],P=lu(h,d,m[0]),R=lu(h,d,C);P&&R||(this._active&&f.suppressClick(),this.reset())}},_s.prototype.touchcancel=function(){this.reset()},_s.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},_s.prototype.disable=function(){this._enabled=!1,this.reset()},_s.prototype.isEnabled=function(){return this._enabled},_s.prototype.isActive=function(){return this._active};var ys=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,m){var C=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(uu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:uu(this._distance,C),pinchAround:m}},d}(_s);function jo(l,d){return 180*l.angleWith(d)/Math.PI}var df=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,m){var C=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:jo(this._vector,C),pinchAround:m}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var m=25/(Math.PI*this._minDiameter)*360,C=jo(h,this._startVector);return Math.abs(C)<m},d}(_s);function Ec(l){return Math.abs(l.y)>Math.abs(l.x)}var yi=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,Ec(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,m,C){var P=h[0].sub(this._lastPoints[0]),R=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(P,R,C.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(P.y+R.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,m,C){if(this._valid!==void 0)return this._valid;var P=h.mag()>=2,R=m.mag()>=2;if(P||R){if(!P||!R)return this._firstMove===void 0&&(this._firstMove=C),C-this._firstMove<100&&void 0;var L=h.y>0==m.y>0;return Ec(h)&&Ec(m)&&L}},d}(_s),Af={panStep:100,bearingStep:15,pitchStep:10},fo=function(){var l=Af;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function qi(l){return l*(2-l)}fo.prototype.blur=function(){this.reset()},fo.prototype.reset=function(){this._active=!1},fo.prototype.keydown=function(l){var d=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var h=0,m=0,C=0,P=0,R=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?m=-1:(l.preventDefault(),P=-1);break;case 39:l.shiftKey?m=1:(l.preventDefault(),P=1);break;case 38:l.shiftKey?C=1:(l.preventDefault(),R=-1);break;case 40:l.shiftKey?C=-1:(l.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(m=0,C=0),{cameraAnimation:function(L){var G=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:qi,zoom:h?Math.round(G)+h*(l.shiftKey?2:1):G,bearing:L.getBearing()+m*d._bearingStep,pitch:L.getPitch()+C*d._pitchStep,offset:[-P*d._panStep,-R*d._panStep],center:L.getCenter()},{originalEvent:l})}}}},fo.prototype.enable=function(){this._enabled=!0},fo.prototype.disable=function(){this._enabled=!1,this.reset()},fo.prototype.isEnabled=function(){return this._enabled},fo.prototype.isActive=function(){return this._active},fo.prototype.disableRotation=function(){this._rotationDisabled=!0},fo.prototype.enableRotation=function(){this._rotationDisabled=!1};var Nr=function(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,s.bindAll(["_onTimeout"],this)};Nr.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Nr.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Nr.prototype.isEnabled=function(){return!!this._enabled},Nr.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Nr.prototype.isZooming=function(){return!!this._zooming},Nr.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Nr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Nr.prototype.wheel=function(l){if(this.isEnabled()){var d=l.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,h=s.browser.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(m*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}},Nr.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Nr.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=f.mousePos(this._el,l);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Nr.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,m=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&m!==0&&(m=1/m);var C=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(C*m))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var P,R=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,L=this._startZoom,G=this._easing,$=!1;if(this._type==="wheel"&&L&&G){var te=Math.min((s.browser.now()-this._lastWheelEventTime)/200,1),Y=G(te);P=s.number(L,R,Y),te<1?this._frameId||(this._frameId=!0):$=!0}else P=R,$=!0;return this._active=!0,$&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!$,zoomDelta:P-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Nr.prototype._smoothOutEasing=function(l){var d=s.ease;if(this._prevEase){var h=this._prevEase,m=(s.browser.now()-h.start)/h.duration,C=h.easing(m+.01)-h.easing(m),P=.27/Math.sqrt(C*C+1e-4)*.01,R=Math.sqrt(.0729-P*P);d=s.bezier(P,R,.25,1)}return this._prevEase={start:s.browser.now(),duration:l,easing:d},d},Nr.prototype.blur=function(){this.reset()},Nr.prototype.reset=function(){this._active=!1};var bo=function(l,d){this._clickZoom=l,this._tapZoom=d};bo.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},bo.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},bo.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},bo.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Xs=function(){this.reset()};Xs.prototype.reset=function(){this._active=!1},Xs.prototype.blur=function(){this.reset()},Xs.prototype.dblclick=function(l,d){return l.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(l.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:l})}}},Xs.prototype.enable=function(){this._enabled=!0},Xs.prototype.disable=function(){this._enabled=!1,this.reset()},Xs.prototype.isEnabled=function(){return this._enabled},Xs.prototype.isActive=function(){return this._active};var zi=function(){this._tap=new Js({numTouches:1,numTaps:1}),this.reset()};zi.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},zi.prototype.touchstart=function(l,d,h){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(l,d,h))},zi.prototype.touchmove=function(l,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var m=d[0],C=m.y-this._swipePoint.y;return this._swipePoint=m,l.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(l,d,h)},zi.prototype.touchend=function(l,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(l,d,h)&&(this._tapTime=l.timeStamp)},zi.prototype.touchcancel=function(){this.reset()},zi.prototype.enable=function(){this._enabled=!0},zi.prototype.disable=function(){this._enabled=!1,this.reset()},zi.prototype.isEnabled=function(){return this._enabled},zi.prototype.isActive=function(){return this._active};var pa=function(l,d,h){this._el=l,this._mousePan=d,this._touchPan=h};pa.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},pa.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},pa.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},pa.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Jo=function(l,d,h){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};Jo.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Jo.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Jo.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Jo.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var $s=function(l,d,h,m){this._el=l,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0};$s.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},$s.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},$s.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},$s.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},$s.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},$s.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Zi=function(l){return l.zoom||l.drag||l.pitch||l.rotate},pl=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d}(s.Event);function _r(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var or=function(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wc(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),s.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[s.window,"blur",void 0]];for(var m=0,C=this._listeners;m<C.length;m+=1){var P=C[m],R=P[0];f.addEventListener(R,P[1],R===s.window.document?this.handleWindowEvent:this.handleEvent,P[2])}};or.prototype.destroy=function(){for(var l=0,d=this._listeners;l<d.length;l+=1){var h=d[l],m=h[0];f.removeEventListener(m,h[1],m===s.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},or.prototype._addDefaultHandlers=function(l){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new _i(d,l));var m=d.boxZoom=new ms(d,l);this._add("boxZoom",m);var C=new us,P=new Xs;d.doubleClickZoom=new bo(P,C),this._add("tapZoom",C),this._add("clickZoom",P);var R=new zi;this._add("tapDragZoom",R);var L=d.touchPitch=new yi;this._add("touchPitch",L);var G=new cu(l),$=new hf(l);d.dragRotate=new Jo(l,G,$),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);var te=new ff(l),Y=new Ws(l);d.dragPan=new pa(h,te,Y),this._add("mousePan",te),this._add("touchPan",Y,["touchZoom","touchRotate"]);var re=new df,ae=new ys;d.touchZoomRotate=new $s(h,ae,re,R),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]);var we=d.scrollZoom=new Nr(d,this);this._add("scrollZoom",we,["mousePan"]);var De=d.keyboard=new fo;this._add("keyboard",De),this._add("blockableMapEvent",new nr(d));for(var me=0,Fe=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];me<Fe.length;me+=1){var He=Fe[me];l.interactive&&l[He]&&d[He].enable(l[He])}},or.prototype._add=function(l,d,h){this._handlers.push({handlerName:l,handler:d,allowed:h}),this._handlersById[l]=d},or.prototype.stop=function(l){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},or.prototype.isActive=function(){for(var l=0,d=this._handlers;l<d.length;l+=1)if(d[l].handler.isActive())return!0;return!1},or.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},or.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},or.prototype.isMoving=function(){return!!Zi(this._eventsInProgress)||this.isZooming()},or.prototype._blockedByActive=function(l,d,h){for(var m in l)if(m!==h&&(!d||d.indexOf(m)<0))return!0;return!1},or.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},or.prototype._getMapTouches=function(l){for(var d=[],h=0,m=l;h<m.length;h+=1){var C=m[h];this._el.contains(C.target)&&d.push(C)}return d},or.prototype.handleEvent=function(l,d){this._updatingCamera=!0;for(var h=l.type==="renderFrame"?void 0:l,m={needsRenderFrame:!1},C={},P={},R=l.touches?this._getMapTouches(l.touches):void 0,L=R?f.touchPos(this._el,R):f.mousePos(this._el,l),G=0,$=this._handlers;G<$.length;G+=1){var te=$[G],Y=te.handlerName,re=te.handler,ae=te.allowed;if(re.isEnabled()){var we=void 0;this._blockedByActive(P,ae,Y)?re.reset():re[d||l.type]&&(we=re[d||l.type](l,L,R),this.mergeHandlerResult(m,C,we,Y,h),we&&we.needsRenderFrame&&this._triggerRenderFrame()),(we||re.isActive())&&(P[Y]=re)}}var De={};for(var me in this._previousActiveHandlers)P[me]||(De[me]=h);this._previousActiveHandlers=P,(Object.keys(De).length||_r(m))&&(this._changes.push([m,C,De]),this._triggerRenderFrame()),(Object.keys(P).length||_r(m))&&this._map._stop(!0),this._updatingCamera=!1;var Fe=m.cameraAnimation;Fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Fe(this._map))},or.prototype.mergeHandlerResult=function(l,d,h,m,C){if(h){s.extend(l,h);var P={handlerName:m,originalEvent:h.originalEvent||C};h.zoomDelta!==void 0&&(d.zoom=P),h.panDelta!==void 0&&(d.drag=P),h.pitchDelta!==void 0&&(d.pitch=P),h.bearingDelta!==void 0&&(d.rotate=P)}},or.prototype._applyChanges=function(){for(var l={},d={},h={},m=0,C=this._changes;m<C.length;m+=1){var P=C[m],R=P[0],L=P[1],G=P[2];R.panDelta&&(l.panDelta=(l.panDelta||new s.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(l.around=R.around),R.pinchAround!==void 0&&(l.pinchAround=R.pinchAround),R.noInertia&&(l.noInertia=R.noInertia),s.extend(d,L),s.extend(h,G)}this._updateMapTransform(l,d,h),this._changes=[]},or.prototype._updateMapTransform=function(l,d,h){var m=this._map,C=m.transform;if(!_r(l))return this._fireEvents(d,h,!0);var P=l.panDelta,R=l.zoomDelta,L=l.bearingDelta,G=l.pitchDelta,$=l.around,te=l.pinchAround;te!==void 0&&($=te),m._stop(!0),$=$||m.transform.centerPoint;var Y=C.pointLocation(P?$.sub(P):$);L&&(C.bearing+=L),G&&(C.pitch+=G),R&&(C.zoom+=R),C.setLocationAtPoint(Y,$),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,h,!0)},or.prototype._fireEvents=function(l,d,h){var m=this,C=Zi(this._eventsInProgress),P=Zi(l),R={};for(var L in l)this._eventsInProgress[L]||(R[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var G in!C&&P&&this._fireEvent("movestart",P.originalEvent),R)this._fireEvent(G,R[G]);for(var $ in P&&this._fireEvent("move",P.originalEvent),l)this._fireEvent($,l[$].originalEvent);var te,Y={};for(var re in this._eventsInProgress){var ae=this._eventsInProgress[re],we=ae.handlerName,De=ae.originalEvent;this._handlersById[we].isActive()||(delete this._eventsInProgress[re],Y[re+"end"]=te=d[we]||De)}for(var me in Y)this._fireEvent(me,Y[me]);var Fe=Zi(this._eventsInProgress);if(h&&(C||P)&&!Fe){this._updatingCamera=!0;var He=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),We=function(it){return it!==0&&-m._bearingSnap<it&&it<m._bearingSnap};He?(We(He.bearing||this._map.getBearing())&&(He.bearing=0),this._map.easeTo(He,{originalEvent:te})):(this._map.fire(new s.Event("moveend",{originalEvent:te})),We(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},or.prototype._fireEvent=function(l,d){this._map.fire(new s.Event(l,d?{originalEvent:d}:{}))},or.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete l._frameId,l.handleEvent(new pl("renderFrame",{timeStamp:d})),l._applyChanges()})},or.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var fu=function(l){function d(h,m){l.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=m.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getCenter=function(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,m){return this.jumpTo({center:h},m)},d.prototype.panBy=function(h,m,C){return h=s.Point.convert(h).mult(-1),this.panTo(this.transform.center,s.extend({offset:h},m),C)},d.prototype.panTo=function(h,m,C){return this.easeTo(s.extend({center:h},m),C)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,m){return this.jumpTo({zoom:h},m),this},d.prototype.zoomTo=function(h,m,C){return this.easeTo(s.extend({zoom:h},m),C)},d.prototype.zoomIn=function(h,m){return this.zoomTo(this.getZoom()+1,h,m),this},d.prototype.zoomOut=function(h,m){return this.zoomTo(this.getZoom()-1,h,m),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,m){return this.jumpTo({bearing:h},m),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,m){return this.jumpTo({padding:h},m),this},d.prototype.rotateTo=function(h,m,C){return this.easeTo(s.extend({bearing:h},m),C)},d.prototype.resetNorth=function(h,m){return this.rotateTo(0,s.extend({duration:1e3},h),m),this},d.prototype.resetNorthPitch=function(h,m){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},h),m),this},d.prototype.snapToNorth=function(h,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,m):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,m){return this.jumpTo({pitch:h},m),this},d.prototype.cameraForBounds=function(h,m){h=s.LngLatBounds.convert(h);var C=m&&m.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),C,m)},d.prototype._cameraForBoxAndBearing=function(h,m,C,P){var R={top:0,bottom:0,right:0,left:0};if(typeof(P=s.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},P)).padding=="number"){var L=P.padding;P.padding={top:L,bottom:L,right:L,left:L}}P.padding=s.extend(R,P.padding);var G=this.transform,$=G.padding,te=G.project(s.LngLat.convert(h)),Y=G.project(s.LngLat.convert(m)),re=te.rotate(-C*Math.PI/180),ae=Y.rotate(-C*Math.PI/180),we=new s.Point(Math.max(re.x,ae.x),Math.max(re.y,ae.y)),De=new s.Point(Math.min(re.x,ae.x),Math.min(re.y,ae.y)),me=we.sub(De),Fe=(G.width-($.left+$.right+P.padding.left+P.padding.right))/me.x,He=(G.height-($.top+$.bottom+P.padding.top+P.padding.bottom))/me.y;if(!(He<0||Fe<0)){var We=Math.min(G.scaleZoom(G.scale*Math.min(Fe,He)),P.maxZoom),it=typeof P.offset.x=="number"?new s.Point(P.offset.x,P.offset.y):s.Point.convert(P.offset),$e=new s.Point((P.padding.left-P.padding.right)/2,(P.padding.top-P.padding.bottom)/2).rotate(C*Math.PI/180),et=it.add($e).mult(G.scale/G.zoomScale(We));return{center:G.unproject(te.add(Y).div(2).sub(et)),zoom:We,bearing:C}}s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,m,C){return this._fitInternal(this.cameraForBounds(h,m),m,C)},d.prototype.fitScreenCoordinates=function(h,m,C,P,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.Point.convert(h)),this.transform.pointLocation(s.Point.convert(m)),C,P),P,R)},d.prototype._fitInternal=function(h,m,C){return h?(delete(m=s.extend(h,m)).padding,m.linear?this.easeTo(m,C):this.flyTo(m,C)):this},d.prototype.jumpTo=function(h,m){this.stop();var C=this.transform,P=!1,R=!1,L=!1;return"zoom"in h&&C.zoom!==+h.zoom&&(P=!0,C.zoom=+h.zoom),h.center!==void 0&&(C.center=s.LngLat.convert(h.center)),"bearing"in h&&C.bearing!==+h.bearing&&(R=!0,C.bearing=+h.bearing),"pitch"in h&&C.pitch!==+h.pitch&&(L=!0,C.pitch=+h.pitch),h.padding==null||C.isPaddingEqual(h.padding)||(C.padding=h.padding),this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),P&&this.fire(new s.Event("zoomstart",m)).fire(new s.Event("zoom",m)).fire(new s.Event("zoomend",m)),R&&this.fire(new s.Event("rotatestart",m)).fire(new s.Event("rotate",m)).fire(new s.Event("rotateend",m)),L&&this.fire(new s.Event("pitchstart",m)).fire(new s.Event("pitch",m)).fire(new s.Event("pitchend",m)),this.fire(new s.Event("moveend",m))},d.prototype.easeTo=function(h,m){var C=this;this._stop(!1,h.easeId),((h=s.extend({offset:[0,0],duration:500,easing:s.ease},h)).animate===!1||!h.essential&&s.browser.prefersReducedMotion)&&(h.duration=0);var P=this.transform,R=this.getZoom(),L=this.getBearing(),G=this.getPitch(),$=this.getPadding(),te="zoom"in h?+h.zoom:R,Y="bearing"in h?this._normalizeBearing(h.bearing,L):L,re="pitch"in h?+h.pitch:G,ae="padding"in h?h.padding:P.padding,we=s.Point.convert(h.offset),De=P.centerPoint.add(we),me=P.pointLocation(De),Fe=s.LngLat.convert(h.center||me);this._normalizeCenter(Fe);var He,We,it=P.project(me),$e=P.project(Fe).sub(it),et=P.zoomScale(te-R);h.around&&(He=s.LngLat.convert(h.around),We=P.locationPoint(He));var ht={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||te!==R,this._rotating=this._rotating||L!==Y,this._pitching=this._pitching||re!==G,this._padding=!P.isPaddingEqual(ae),this._easeId=h.easeId,this._prepareEase(m,h.noMoveStart,ht),this._ease(function(Rt){if(C._zooming&&(P.zoom=s.number(R,te,Rt)),C._rotating&&(P.bearing=s.number(L,Y,Rt)),C._pitching&&(P.pitch=s.number(G,re,Rt)),C._padding&&(P.interpolatePadding($,ae,Rt),De=P.centerPoint.add(we)),He)P.setLocationAtPoint(He,We);else{var xt=P.zoomScale(P.zoom-R),Nt=te>R?Math.min(2,et):Math.max(.5,et),rr=Math.pow(Nt,1-Rt),vr=P.unproject(it.add($e.mult(Rt*rr)).mult(xt));P.setLocationAtPoint(P.renderWorldCopies?vr.wrap():vr,De)}C._fireMoveEvents(m)},function(Rt){C._afterEase(m,Rt)},h),this},d.prototype._prepareEase=function(h,m,C){C===void 0&&(C={}),this._moving=!0,m||C.moving||this.fire(new s.Event("movestart",h)),this._zooming&&!C.zooming&&this.fire(new s.Event("zoomstart",h)),this._rotating&&!C.rotating&&this.fire(new s.Event("rotatestart",h)),this._pitching&&!C.pitching&&this.fire(new s.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new s.Event("move",h)),this._zooming&&this.fire(new s.Event("zoom",h)),this._rotating&&this.fire(new s.Event("rotate",h)),this._pitching&&this.fire(new s.Event("pitch",h))},d.prototype._afterEase=function(h,m){if(!this._easeId||!m||this._easeId!==m){delete this._easeId;var C=this._zooming,P=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,C&&this.fire(new s.Event("zoomend",h)),P&&this.fire(new s.Event("rotateend",h)),R&&this.fire(new s.Event("pitchend",h)),this.fire(new s.Event("moveend",h))}},d.prototype.flyTo=function(h,m){var C=this;if(!h.essential&&s.browser.prefersReducedMotion){var P=s.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(P,m)}this.stop(),h=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},h);var R=this.transform,L=this.getZoom(),G=this.getBearing(),$=this.getPitch(),te=this.getPadding(),Y="zoom"in h?s.clamp(+h.zoom,R.minZoom,R.maxZoom):L,re="bearing"in h?this._normalizeBearing(h.bearing,G):G,ae="pitch"in h?+h.pitch:$,we="padding"in h?h.padding:R.padding,De=R.zoomScale(Y-L),me=s.Point.convert(h.offset),Fe=R.centerPoint.add(me),He=R.pointLocation(Fe),We=s.LngLat.convert(h.center||He);this._normalizeCenter(We);var it=R.project(He),$e=R.project(We).sub(it),et=h.curve,ht=Math.max(R.width,R.height),Rt=ht/De,xt=$e.mag();if("minZoom"in h){var Nt=s.clamp(Math.min(h.minZoom,L,Y),R.minZoom,R.maxZoom),rr=ht/R.zoomScale(Nt-L);et=Math.sqrt(rr/xt*2)}var vr=et*et;function Cr(Pr){var Ir=(Rt*Rt-ht*ht+(Pr?-1:1)*vr*vr*xt*xt)/(2*(Pr?Rt:ht)*vr*xt);return Math.log(Math.sqrt(Ir*Ir+1)-Ir)}function pn(Pr){return(Math.exp(Pr)-Math.exp(-Pr))/2}function ir(Pr){return(Math.exp(Pr)+Math.exp(-Pr))/2}var zr=Cr(0),qr=function(Pr){return ir(zr)/ir(zr+et*Pr)},kr=function(Pr){return ht*((ir(zr)*(pn(Ir=zr+et*Pr)/ir(Ir))-pn(zr))/vr)/xt;var Ir},Or=(Cr(1)-zr)/et;if(Math.abs(xt)<1e-6||!isFinite(Or)){if(Math.abs(ht-Rt)<1e-6)return this.easeTo(h,m);var Xr=Rt<ht?-1:1;Or=Math.abs(Math.log(Rt/ht))/et,kr=function(){return 0},qr=function(Pr){return Math.exp(Xr*et*Pr)}}return h.duration="duration"in h?+h.duration:1e3*Or/("screenSpeed"in h?+h.screenSpeed/et:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=G!==re,this._pitching=ae!==$,this._padding=!R.isPaddingEqual(we),this._prepareEase(m,!1),this._ease(function(Pr){var Ir=Pr*Or,Vi=1/qr(Ir);R.zoom=Pr===1?Y:L+R.scaleZoom(Vi),C._rotating&&(R.bearing=s.number(G,re,Pr)),C._pitching&&(R.pitch=s.number($,ae,Pr)),C._padding&&(R.interpolatePadding(te,we,Pr),Fe=R.centerPoint.add(me));var vi=Pr===1?We:R.unproject(it.add($e.mult(kr(Ir))).mult(Vi));R.setLocationAtPoint(R.renderWorldCopies?vi.wrap():vi,Fe),C._fireMoveEvents(m)},function(){return C._afterEase(m)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var C=this._onEaseEnd;delete this._onEaseEnd,C.call(this,m)}if(!h){var P=this.handlers;P&&P.stop(!1)}return this},d.prototype._ease=function(h,m,C){C.animate===!1||C.duration===0?(h(1),m()):(this._easeStart=s.browser.now(),this._easeOptions=C,this._onEaseFrame=h,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((s.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,m){h=s.wrap(h,-180,180);var C=Math.abs(h-m);return Math.abs(h-360-m)<C&&(h-=360),Math.abs(h+360-m)<C&&(h+=360),h},d.prototype._normalizeCenter=function(h){var m=this.transform;if(m.renderWorldCopies&&!m.lngRange){var C=h.lng-m.center.lng;h.lng+=C>180?-360:C<-180?360:0}},d}(s.Evented),ns=function(l){l===void 0&&(l={}),this.options=l,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ns.prototype.getDefaultPosition=function(){return"bottom-right"},ns.prototype.onAdd=function(l){var d=this.options&&this.options.compact;return this._map=l,this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=f.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=f.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ns.prototype.onRemove=function(){f.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ns.prototype._setElementTitle=function(l,d){var h=this._map._getUIString("AttributionControl."+d);l.title=h,l.setAttribute("aria-label",h)},ns.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ns.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(l){var h=d.reduce(function(m,C,P){return C.value&&(m+=C.key+"="+C.value+(P<d.length-1?"&":"")),m},"?");l.href=s.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},ns.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ns.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var m in h){var C=h[m];if(C.used){var P=C.getSource();P.attribution&&l.indexOf(P.attribution)<0&&l.push(P.attribution)}}l.sort(function(L,G){return L.length-G.length});var R=(l=l.filter(function(L,G){for(var $=G+1;$<l.length;$++)if(l[$].indexOf(L)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,l.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ns.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Gi=function(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)};Gi.prototype.onAdd=function(l){this._map=l,this._container=f.create("div","mapboxgl-ctrl");var d=f.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Gi.prototype.onRemove=function(){f.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Gi.prototype.getDefaultPosition=function(){return"bottom-left"},Gi.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Gi.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var d in l)if(l[d].getSource().mapbox_logo)return!0;return!1}},Gi.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var Gn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Gn.prototype.add=function(l){var d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d},Gn.prototype.remove=function(l){for(var d=this._currentlyRunning,h=0,m=d?this._queue.concat(d):this._queue;h<m.length;h+=1){var C=m[h];if(C.id===l)return void(C.cancelled=!0)}},Gn.prototype.run=function(l){l===void 0&&(l=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,m=d;h<m.length;h+=1){var C=m[h];if(!C.cancelled&&(C.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Gn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Dr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ks=s.window.HTMLImageElement,cn=s.window.HTMLElement,jr=s.window.ImageBitmap,Mi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},hu=function(l){function d(m){var C=this;if((m=s.extend({},Mi,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var P=new nn(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies);if(l.call(this,P,m),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Gn,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Dr,m.locale),this._clickTolerance=m.clickTolerance,this._requestManager=new s.RequestManager(m.transformRequest,m.accessToken),typeof m.container=="string"){if(this._container=s.window.document.getElementById(m.container),!this._container)throw new Error("Container '"+m.container+"' not found.")}else{if(!(m.container instanceof cn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return C._update(!1)}),this.on("moveend",function(){return C._update(!1)}),this.on("zoom",function(){return C._update(!0)}),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new or(this,m),this._hash=m.hash&&new Rs(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,s.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new ns({customAttribution:m.customAttribution})),this.addControl(new Gi,m.logoPosition),this.on("style.load",function(){C.transform.unmodified&&C.jumpTo(C.style.stylesheet)}),this.on("data",function(R){C._update(R.dataType==="style"),C.fire(new s.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){C.fire(new s.Event(R.dataType+"dataloading",R))})}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(m,C){if(C===void 0&&(C=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var P=m.onAdd(this);this._controls.push(m);var R=this._controlPositions[C];return C.indexOf("bottom")!==-1?R.insertBefore(P,R.firstChild):R.appendChild(P),this},d.prototype.removeControl=function(m){if(!m||!m.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var C=this._controls.indexOf(m);return C>-1&&this._controls.splice(C,1),m.onRemove(this),this},d.prototype.hasControl=function(m){return this._controls.indexOf(m)>-1},d.prototype.resize=function(m){var C=this._containerDimensions(),P=C[0],R=C[1];if(P===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(P,R),this.transform.resize(P,R),this.painter.resize(P,R);var L=!this._moving;return L&&this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),this.fire(new s.Event("resize",m)),L&&this.fire(new s.Event("moveend",m)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(m){return this.transform.setMaxBounds(s.LngLatBounds.convert(m)),this._update()},d.prototype.setMinZoom=function(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(m){if((m=m??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(m){return this.transform.renderWorldCopies=m,this._update()},d.prototype.project=function(m){return this.transform.locationPoint(s.LngLat.convert(m))},d.prototype.unproject=function(m){return this.transform.pointLocation(s.Point.convert(m))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(m,C,P){var R,L=this;if(m==="mouseenter"||m==="mouseover"){var G=!1;return{layer:C,listener:P,delegates:{mousemove:function(te){var Y=L.getLayer(C)?L.queryRenderedFeatures(te.point,{layers:[C]}):[];Y.length?G||(G=!0,P.call(L,new Rn(m,L,te.originalEvent,{features:Y}))):G=!1},mouseout:function(){G=!1}}}}if(m==="mouseleave"||m==="mouseout"){var $=!1;return{layer:C,listener:P,delegates:{mousemove:function(te){(L.getLayer(C)?L.queryRenderedFeatures(te.point,{layers:[C]}):[]).length?$=!0:$&&($=!1,P.call(L,new Rn(m,L,te.originalEvent)))},mouseout:function(te){$&&($=!1,P.call(L,new Rn(m,L,te.originalEvent)))}}}}return{layer:C,listener:P,delegates:(R={},R[m]=function(te){var Y=L.getLayer(C)?L.queryRenderedFeatures(te.point,{layers:[C]}):[];Y.length&&(te.features=Y,P.call(L,te),delete te.features)},R)}},d.prototype.on=function(m,C,P){if(P===void 0)return l.prototype.on.call(this,m,C);var R=this._createDelegatedListener(m,C,P);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(R),R.delegates)this.on(L,R.delegates[L]);return this},d.prototype.once=function(m,C,P){if(P===void 0)return l.prototype.once.call(this,m,C);var R=this._createDelegatedListener(m,C,P);for(var L in R.delegates)this.once(L,R.delegates[L]);return this},d.prototype.off=function(m,C,P){var R=this;return P===void 0?l.prototype.off.call(this,m,C):(this._delegatedListeners&&this._delegatedListeners[m]&&function(L){for(var G=L[m],$=0;$<G.length;$++){var te=G[$];if(te.layer===C&&te.listener===P){for(var Y in te.delegates)R.off(Y,te.delegates[Y]);return G.splice($,1),R}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(m,C){if(!this.style)return[];var P;if(C!==void 0||m===void 0||m instanceof s.Point||Array.isArray(m)||(C=m,m=void 0),C=C||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof s.Point||typeof m[0]=="number")P=[s.Point.convert(m)];else{var R=s.Point.convert(m[0]),L=s.Point.convert(m[1]);P=[R,new s.Point(L.x,R.y),L,new s.Point(R.x,L.y),R]}return this.style.queryRenderedFeatures(P,C,this.transform)},d.prototype.querySourceFeatures=function(m,C){return this.style.querySourceFeatures(m,C)},d.prototype.setStyle=function(m,C){return(C=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},C)).diff!==!1&&C.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,C),this):(this._localIdeographFontFamily=C.localIdeographFontFamily,this._updateStyle(m,C))},d.prototype._getUIString=function(m){var C=this._locale[m];if(C==null)throw new Error("Missing UI string '"+m+"'");return C},d.prototype._updateStyle=function(m,C){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new On(this,C||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new On(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(m,C){var P=this;if(typeof m=="string"){var R=this._requestManager.normalizeStyleURL(m),L=this._requestManager.transformRequest(R,s.ResourceType.Style);s.getJSON(L,function(G,$){G?P.fire(new s.ErrorEvent(G)):$&&P._updateDiff($,C)})}else typeof m=="object"&&this._updateDiff(m,C)},d.prototype._updateDiff=function(m,C){try{this.style.setState(m)&&this._update(!0)}catch(P){s.warnOnce("Unable to perform style diff: "+(P.message||P.error||P)+".  Rebuilding the style from scratch."),this._updateStyle(m,C)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(m,C){return this._lazyInitEmptyStyle(),this.style.addSource(m,C),this._update(!0)},d.prototype.isSourceLoaded=function(m){var C=this.style&&this.style.sourceCaches[m];if(C!==void 0)return C.loaded();this.fire(new s.ErrorEvent(new Error("There is no source with ID '"+m+"'")))},d.prototype.areTilesLoaded=function(){var m=this.style&&this.style.sourceCaches;for(var C in m){var P=m[C]._tiles;for(var R in P){var L=P[R];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(m,C,P){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,C,P)},d.prototype.removeSource=function(m){return this.style.removeSource(m),this._update(!0)},d.prototype.getSource=function(m){return this.style.getSource(m)},d.prototype.addImage=function(m,C,P){P===void 0&&(P={});var R=P.pixelRatio;R===void 0&&(R=1);var L=P.sdf;L===void 0&&(L=!1);var G=P.stretchX,$=P.stretchY,te=P.content;if(this._lazyInitEmptyStyle(),C instanceof Ks||jr&&C instanceof jr){var Y=s.browser.getImageData(C);this.style.addImage(m,{data:new s.RGBAImage({width:Y.width,height:Y.height},Y.data),pixelRatio:R,stretchX:G,stretchY:$,content:te,sdf:L,version:0})}else{if(C.width===void 0||C.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var re=C;this.style.addImage(m,{data:new s.RGBAImage({width:C.width,height:C.height},new Uint8Array(C.data)),pixelRatio:R,stretchX:G,stretchY:$,content:te,sdf:L,version:0,userImage:re}),re.onAdd&&re.onAdd(this,m)}},d.prototype.updateImage=function(m,C){var P=this.style.getImage(m);if(!P)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=C instanceof Ks||jr&&C instanceof jr?s.browser.getImageData(C):C,L=R.width,G=R.height,$=R.data;return L===void 0||G===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==P.data.width||G!==P.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(P.data.replace($,!(C instanceof Ks||jr&&C instanceof jr)),void this.style.updateImage(m,P))},d.prototype.hasImage=function(m){return m?!!this.style.getImage(m):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(m){this.style.removeImage(m)},d.prototype.loadImage=function(m,C){s.getImage(this._requestManager.transformRequest(m,s.ResourceType.Image),C)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(m,C){return this._lazyInitEmptyStyle(),this.style.addLayer(m,C),this._update(!0)},d.prototype.moveLayer=function(m,C){return this.style.moveLayer(m,C),this._update(!0)},d.prototype.removeLayer=function(m){return this.style.removeLayer(m),this._update(!0)},d.prototype.getLayer=function(m){return this.style.getLayer(m)},d.prototype.setLayerZoomRange=function(m,C,P){return this.style.setLayerZoomRange(m,C,P),this._update(!0)},d.prototype.setFilter=function(m,C,P){return P===void 0&&(P={}),this.style.setFilter(m,C,P),this._update(!0)},d.prototype.getFilter=function(m){return this.style.getFilter(m)},d.prototype.setPaintProperty=function(m,C,P,R){return R===void 0&&(R={}),this.style.setPaintProperty(m,C,P,R),this._update(!0)},d.prototype.getPaintProperty=function(m,C){return this.style.getPaintProperty(m,C)},d.prototype.setLayoutProperty=function(m,C,P,R){return R===void 0&&(R={}),this.style.setLayoutProperty(m,C,P,R),this._update(!0)},d.prototype.getLayoutProperty=function(m,C){return this.style.getLayoutProperty(m,C)},d.prototype.setLight=function(m,C){return C===void 0&&(C={}),this._lazyInitEmptyStyle(),this.style.setLight(m,C),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(m,C){return this.style.setFeatureState(m,C),this._update()},d.prototype.removeFeatureState=function(m,C){return this.style.removeFeatureState(m,C),this._update()},d.prototype.getFeatureState=function(m){return this.style.getFeatureState(m)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var m=0,C=0;return this._container&&(m=this._container.clientWidth||400,C=this._container.clientHeight||300),[m,C]},d.prototype._detectMissingCSS=function(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=f.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();var C=this._canvasContainer=f.create("div","mapboxgl-canvas-container",m);this._interactive&&C.classList.add("mapboxgl-interactive"),this._canvas=f.create("canvas","mapboxgl-canvas",C),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var P=this._containerDimensions();this._resizeCanvas(P[0],P[1]);var R=this._controlContainer=f.create("div","mapboxgl-control-container",m),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){L[G]=f.create("div","mapboxgl-ctrl-"+G,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(m,C){var P=s.browser.devicePixelRatio||1;this._canvas.width=P*m,this._canvas.height=P*C,this._canvas.style.width=m+"px",this._canvas.style.height=C+"px"},d.prototype._setupPainter=function(){var m=s.extend({},c.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),C=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);C?(this.painter=new zn(C,this.transform),s.webpSupported.testSupport(C)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:m}))},d.prototype._contextRestored=function(m){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:m}))},d.prototype._onMapScroll=function(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(m){return this._update(),this._renderTaskQueue.add(m)},d.prototype._cancelRenderFrame=function(m){this._renderTaskQueue.remove(m)},d.prototype._render=function(m){var C,P=this,R=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(C=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,C),R=s.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var $=this.transform.zoom,te=s.browser.now();this.style.zoomHistory.update($,te);var Y=new s.EvaluationParameters($,{now:te,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),re=Y.crossFadingFactor();re===1&&re===this._crossFadingFactor||(G=!0,this._crossFadingFactor=re),this.style.update(Y)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ae=s.browser.now()-R;L.endQueryEXT(L.TIME_ELAPSED_EXT,C),setTimeout(function(){var me=L.getQueryObjectEXT(C,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(C),P.fire(new s.Event("gpu-timing-frame",{cpuTime:ae,gpuTime:me}))},50)}if(this.listens("gpu-timing-layer")){var we=this.painter.collectGpuTimers();setTimeout(function(){var me=P.painter.queryGpuTimers(we);P.fire(new s.Event("gpu-timing-layer",{layerTimes:me}))},50)}var De=this._sourcesDirty||this._styleDirty||this._placementDirty;return De||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||De||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var m=0,C=this._controls;m<C.length;m+=1)C[m].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));var P=this.painter.context.gl.getExtension("WEBGL_lose_context");P&&P.loseContext(),Ds(this._canvasContainer),Ds(this._controlContainer),Ds(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new s.Event("remove"))},d.prototype.triggerRepaint=function(){var m=this;this.style&&!this._frame&&(this._frame=s.browser.frame(function(C){m._frame=null,m._render(C)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(m){this._trackResize&&this.resize({originalEvent:m})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(m){this._showPadding!==m&&(this._showPadding=m,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(m){this._vertices=m,this._update()},d.prototype._setCacheLimits=function(m,C){s.setCacheLimits(m,C)},h.version.get=function(){return s.version},Object.defineProperties(d.prototype,h),d}(fu);function Ds(l){l.parentNode&&l.parentNode.removeChild(l)}var pf={showCompass:!0,showZoom:!0,visualizePitch:!1},oi=function(l){var d=this;this.options=s.extend({},pf,l),this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),f.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),f.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=f.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};oi.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),d=l===this._map.getMaxZoom(),h=l===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},oi.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},oi.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yi(this._map,this._compass,this.options.visualizePitch)),this._container},oi.prototype.onRemove=function(){f.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},oi.prototype._createButton=function(l,d){var h=f.create("button",l,this._container);return h.type="button",h.addEventListener("click",d),h},oi.prototype._setButtonTitle=function(l,d){var h=this._map._getUIString("NavigationControl."+d);l.title=h,l.setAttribute("aria-label",h)};var Yi=function(l,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new cu({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,h&&(this.mousePitch=new hf({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener(d,"mousedown",this.mousedown),f.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),f.addEventListener(d,"touchmove",this.touchmove),f.addEventListener(d,"touchend",this.touchend),f.addEventListener(d,"touchcancel",this.reset)};function ho(l,d,h){if(l=new s.LngLat(l.lng,l.lat),d){var m=new s.LngLat(l.lng-360,l.lat),C=new s.LngLat(l.lng+360,l.lat),P=h.locationPoint(l).distSqr(d);h.locationPoint(m).distSqr(d)<P?l=m:h.locationPoint(C).distSqr(d)<P&&(l=C)}for(;Math.abs(l.lng-h.center.lng)>180;){var R=h.locationPoint(l);if(R.x>=0&&R.y>=0&&R.x<=h.width&&R.y<=h.height)break;l.lng>h.center.lng?l.lng-=360:l.lng+=360}return l}Yi.prototype.down=function(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),f.disableDrag()},Yi.prototype.move=function(l,d){var h=this.map,m=this.mouseRotate.mousemoveWindow(l,d);if(m&&m.bearingDelta&&h.setBearing(h.getBearing()+m.bearingDelta),this.mousePitch){var C=this.mousePitch.mousemoveWindow(l,d);C&&C.pitchDelta&&h.setPitch(h.getPitch()+C.pitchDelta)}},Yi.prototype.off=function(){var l=this.element;f.removeEventListener(l,"mousedown",this.mousedown),f.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),f.removeEventListener(l,"touchmove",this.touchmove),f.removeEventListener(l,"touchend",this.touchend),f.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Yi.prototype.offTemp=function(){f.enableDrag(),f.removeEventListener(s.window,"mousemove",this.mousemove),f.removeEventListener(s.window,"mouseup",this.mouseup)},Yi.prototype.mousedown=function(l){this.down(s.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),f.mousePos(this.element,l)),f.addEventListener(s.window,"mousemove",this.mousemove),f.addEventListener(s.window,"mouseup",this.mouseup)},Yi.prototype.mousemove=function(l){this.move(l,f.mousePos(this.element,l))},Yi.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Yi.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=f.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Yi.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=f.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Yi.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Yi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ao={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jt(l,d,h){var m=l.classList;for(var C in Ao)m.remove("mapboxgl-"+h+"-anchor-"+C);m.add("mapboxgl-"+h+"-anchor-"+d)}var Yt,Tc=function(l){function d(h,m){if(l.call(this),(h instanceof s.window.HTMLElement||m)&&(h=s.extend({element:h},m)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=s.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=f.create("div"),this._element.setAttribute("aria-label","Map marker");var C=f.createNS("http://www.w3.org/2000/svg","svg");C.setAttributeNS(null,"display","block"),C.setAttributeNS(null,"height","41px"),C.setAttributeNS(null,"width","27px"),C.setAttributeNS(null,"viewBox","0 0 27 41");var P=f.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");var R=f.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var L=f.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var G=0,$=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<$.length;G+=1){var te=$[G],Y=f.createNS("http://www.w3.org/2000/svg","ellipse");Y.setAttributeNS(null,"opacity","0.04"),Y.setAttributeNS(null,"cx","10.5"),Y.setAttributeNS(null,"cy","5.80029008"),Y.setAttributeNS(null,"rx",te.rx),Y.setAttributeNS(null,"ry",te.ry),L.appendChild(Y)}var re=f.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"fill",this._color);var ae=f.createNS("http://www.w3.org/2000/svg","path");ae.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),re.appendChild(ae);var we=f.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"fill","#000000");var De=f.createNS("http://www.w3.org/2000/svg","path");De.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),we.appendChild(De);var me=f.createNS("http://www.w3.org/2000/svg","g");me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),me.setAttributeNS(null,"fill","#FFFFFF");var Fe=f.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");var He=f.createNS("http://www.w3.org/2000/svg","circle");He.setAttributeNS(null,"fill","#000000"),He.setAttributeNS(null,"opacity","0.25"),He.setAttributeNS(null,"cx","5.5"),He.setAttributeNS(null,"cy","5.5"),He.setAttributeNS(null,"r","5.4999962");var We=f.createNS("http://www.w3.org/2000/svg","circle");We.setAttributeNS(null,"fill","#FFFFFF"),We.setAttributeNS(null,"cx","5.5"),We.setAttributeNS(null,"cy","5.5"),We.setAttributeNS(null,"r","5.4999962"),Fe.appendChild(He),Fe.appendChild(We),R.appendChild(L),R.appendChild(re),R.appendChild(we),R.appendChild(me),R.appendChild(Fe),C.appendChild(R),C.setAttributeNS(null,"height",41*this._scale+"px"),C.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(C),this._offset=s.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(it){it.preventDefault()}),this._element.addEventListener("mousedown",function(it){it.preventDefault()}),jt(this._element,this._anchor,"marker"),this._popup=null}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),f.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=s.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var m=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var m=h.code,C=h.charCode||h.keyCode;m!=="Space"&&m!=="Enter"&&C!==32&&C!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var m=h.originalEvent.target,C=this._element;this._popup&&(m===C||C.contains(m))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ho(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(m="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),f.setTransform(this._element,Ao[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+C+" "+m)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=s.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var m=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(s.Evented),gl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Wo=0,xo=!1,Xo=function(l){function d(h){l.call(this),this.options=s.extend({},gl,h),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.onAdd=function(h){var m;return this._map=h,this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),m=this._setupUI,Yt!==void 0?m(Yt):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(function(C){m(Yt=C.state!=="denied")}):m(Yt=!!s.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),f.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Wo=0,xo=!1},d.prototype._isOutOfMapMaxBounds=function(h){var m=this._map.getMaxBounds(),C=h.coords;return m&&(C.longitude<m.getWest()||C.longitude>m.getEast()||C.latitude<m.getSouth()||C.latitude>m.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var m=new s.LngLat(h.coords.longitude,h.coords.latitude),C=h.coords.accuracy,P=this._map.getBearing(),R=s.extend({bearing:P},this.options.fitBoundsOptions);this._map.fitBounds(m.toBounds(C),R,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var m=new s.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,m=this._map.unproject([0,h]),C=this._map.unproject([1,h]),P=m.distanceTo(C),R=Math.ceil(2*this._accuracy/P);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&xo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var m=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=f.create("button","mapboxgl-ctrl-geolocate",this._container),f.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var C=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}else{var P=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=P,this._geolocateButton.setAttribute("aria-label",P)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=f.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Tc(this._dotElement),this._circleElement=f.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Tc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||m._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(m._watchState="BACKGROUND",m._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),m._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),m.fire(new s.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wo--,xo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Wo>1?(h={maximumAge:6e5,timeout:0},xo=!0):(h=this.options.positionOptions,xo=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(s.Evented),$o={maxWidth:100,unit:"metric"},fs=function(l){this.options=s.extend({},$o,l),s.bindAll(["_onMove","setUnit"],this)};function y(l,d,h){var m=h&&h.maxWidth||100,C=l._container.clientHeight/2,P=l.unproject([0,C]),R=l.unproject([m,C]),L=P.distanceTo(R);if(h&&h.unit==="imperial"){var G=3.2808*L;G>5280?_(d,m,G/5280,l._getUIString("ScaleControl.Miles")):_(d,m,G,l._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?_(d,m,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?_(d,m,L/1e3,l._getUIString("ScaleControl.Kilometers")):_(d,m,L,l._getUIString("ScaleControl.Meters"))}function _(l,d,h,m){var C,P,R,L=(C=h,(P=Math.pow(10,(""+Math.floor(C)).length-1))*(R=(R=C/P)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(G){var $=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*$)/$}(R)));l.style.width=d*(L/h)+"px",l.innerHTML=L+"&nbsp;"+m}fs.prototype.getDefaultPosition=function(){return"bottom-left"},fs.prototype._onMove=function(){y(this._map,this._container,this.options)},fs.prototype.onAdd=function(l){return this._map=l,this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},fs.prototype.onRemove=function(){f.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},fs.prototype.setUnit=function(l){this.options.unit=l,y(this._map,this._container,this.options)};var v=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof s.window.HTMLElement?this._container=l.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in s.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in s.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in s.window.document&&(this._fullscreenchange="MSFullscreenChange")};v.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},v.prototype.onRemove=function(){f.remove(this._controlContainer),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},v.prototype._checkFullscreenSupport=function(){return!!(s.window.document.fullscreenEnabled||s.window.document.mozFullScreenEnabled||s.window.document.msFullscreenEnabled||s.window.document.webkitFullscreenEnabled)},v.prototype._setupUI=function(){var l=this._fullscreenButton=f.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);f.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},v.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},v.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},v.prototype._isFullscreen=function(){return this._fullscreen},v.prototype._changeIcon=function(){(s.window.document.fullscreenElement||s.window.document.mozFullScreenElement||s.window.document.webkitFullscreenElement||s.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},v.prototype._onClickFullscreen=function(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.mozCancelFullScreen?s.window.document.mozCancelFullScreen():s.window.document.msExitFullscreen?s.window.document.msExitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var w={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},B=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),M=function(l){function d(h){l.call(this),this.options=s.extend(Object.create(w),h),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&f.remove(this._content),this._container&&(f.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=s.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(s.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var m,C=s.window.document.createDocumentFragment(),P=s.window.document.createElement("body");for(P.innerHTML=h;m=P.firstChild;)C.appendChild(m);return this.setDOMContent(C)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=f.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=f.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var m=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=f.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=f.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Y){return m._container.classList.add(Y)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ho(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var C=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),P=this.options.anchor,R=function Y(re){if(re){if(typeof re=="number"){var ae=Math.round(Math.sqrt(.5*Math.pow(re,2)));return{center:new s.Point(0,0),top:new s.Point(0,re),"top-left":new s.Point(ae,ae),"top-right":new s.Point(-ae,ae),bottom:new s.Point(0,-re),"bottom-left":new s.Point(ae,-ae),"bottom-right":new s.Point(-ae,-ae),left:new s.Point(re,0),right:new s.Point(-re,0)}}if(re instanceof s.Point||Array.isArray(re)){var we=s.Point.convert(re);return{center:we,top:we,"top-left":we,"top-right":we,bottom:we,"bottom-left":we,"bottom-right":we,left:we,right:we}}return{center:s.Point.convert(re.center||[0,0]),top:s.Point.convert(re.top||[0,0]),"top-left":s.Point.convert(re["top-left"]||[0,0]),"top-right":s.Point.convert(re["top-right"]||[0,0]),bottom:s.Point.convert(re.bottom||[0,0]),"bottom-left":s.Point.convert(re["bottom-left"]||[0,0]),"bottom-right":s.Point.convert(re["bottom-right"]||[0,0]),left:s.Point.convert(re.left||[0,0]),right:s.Point.convert(re.right||[0,0])}}return Y(new s.Point(0,0))}(this.options.offset);if(!P){var L,G=this._container.offsetWidth,$=this._container.offsetHeight;L=C.y+R.bottom.y<$?["top"]:C.y>this._map.transform.height-$?["bottom"]:[],C.x<G/2?L.push("left"):C.x>this._map.transform.width-G/2&&L.push("right"),P=L.length===0?"bottom":L.join("-")}var te=C.add(R[P]).round();f.setTransform(this._container,Ao[P]+" translate("+te.x+"px,"+te.y+"px)"),jt(this._container,P,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(B);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(s.Evented),O={version:s.version,supported:c,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:hu,NavigationControl:oi,GeolocateControl:Xo,AttributionControl:ns,ScaleControl:fs,FullscreenControl:v,Popup:M,Marker:Tc,Style:On,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,config:s.config,prewarm:function(){ut().acquire(Ke)},clearPrewarmedResources:function(){var l=It;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ke),It=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(l){s.config.ACCESS_TOKEN=l},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(l){s.config.API_URL=l},get workerCount(){return Ct.workerCount},set workerCount(l){Ct.workerCount=l},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){s.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){s.clearTileCache(l)},workerUrl:""};return O}),i})}(vm)),vm.exports}var rq=tq();const Yc=th(rq);var nq=1e-7;function x2(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function BO(r,e){if(r===e)return!0;if(x2(r)&&x2(e)){if(r.length!==e.length)return!1;for(var t=0;t<r.length;++t)if(!BO(r[t],e[t]))return!1;return!0}return Math.abs(r-e)<=nq}function P0(r,e,t){return Math.max(e,Math.min(t,r))}function n_(r,e,t){return x2(r)?r.map(function(n,i){return n_(n,e[i],t)}):t*e+(1-t)*r}function qa(r,e){if(!r)throw new Error(e||"react-map-gl: assertion failed.")}function NS(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function kS(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?NS(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):NS(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var zf={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},Qv={pitch:0,bearing:0,altitude:1.5},US=5,iq=1.2,Kd=function(){function r(e){var t=e.width,n=e.height,i=e.latitude,o=e.longitude,s=e.zoom,c=e.bearing,f=c===void 0?Qv.bearing:c,g=e.pitch,b=g===void 0?Qv.pitch:g,T=e.altitude,S=T===void 0?Qv.altitude:T,F=e.maxZoom,k=F===void 0?zf.maxZoom:F,U=e.minZoom,j=U===void 0?zf.minZoom:U,z=e.maxPitch,V=z===void 0?zf.maxPitch:z,K=e.minPitch,fe=K===void 0?zf.minPitch:K,Q=e.transitionDuration,oe=e.transitionEasing,Te=e.transitionInterpolator,ze=e.transitionInterruption,Ae=e.startPanLngLat,_e=e.startZoomLngLat,pe=e.startRotatePos,X=e.startBearing,ne=e.startPitch,Be=e.startZoom;Xu(this,r),qa(Number.isFinite(t),"`width` must be supplied"),qa(Number.isFinite(n),"`height` must be supplied"),qa(Number.isFinite(o),"`longitude` must be supplied"),qa(Number.isFinite(i),"`latitude` must be supplied"),qa(Number.isFinite(s),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:t,height:n,latitude:i,longitude:o,zoom:s,bearing:f,pitch:b,altitude:S,maxZoom:k,minZoom:j,maxPitch:V,minPitch:fe,transitionDuration:Q,transitionEasing:oe,transitionInterpolator:Te,transitionInterruption:ze}),this._state={startPanLngLat:Ae,startZoomLngLat:_e,startRotatePos:pe,startBearing:X,startPitch:ne,startZoom:Be}}return Wu(r,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(t){var n=t.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(n)})}},{key:"pan",value:function(t){var n=t.pos,i=t.startPos,o=this._state.startPanLngLat||this._unproject(i);if(!o)return this;var s=this._calculateNewLngLat({startPanLngLat:o,pos:n}),c=as(s,2),f=c[0],g=c[1];return this._getUpdatedMapState({longitude:f,latitude:g})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){var n=t.pos;return this._getUpdatedMapState({startRotatePos:n,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var n=t.pos,i=t.deltaAngleX,o=i===void 0?0:i,s=t.deltaAngleY,c=s===void 0?0:s,f=this._state,g=f.startRotatePos,b=f.startBearing,T=f.startPitch;if(!Number.isFinite(b)||!Number.isFinite(T))return this;var S;return n?S=this._calculateNewPitchAndBearing(kS(kS({},this._getRotationParams(n,g)),{},{startBearing:b,startPitch:T})):S={bearing:b+o,pitch:T+c},this._getUpdatedMapState(S)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var n=t.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(n),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var n=t.pos,i=t.startPos,o=t.scale;qa(o>0,"`scale` must be a positive number");var s=this._state,c=s.startZoom,f=s.startZoomLngLat;Number.isFinite(c)||(c=this._viewportProps.zoom,f=this._unproject(i)||this._unproject(n)),qa(f,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var g=this._calculateNewZoom({scale:o,startZoom:c||0}),b=new Kc(Object.assign({},this._viewportProps,{zoom:g})),T=b.getMapCenterByLngLatPosition({lngLat:f,pos:n}),S=as(T,2),F=S[0],k=S[1];return this._getUpdatedMapState({zoom:g,longitude:F,latitude:k})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(t){return new r(Object.assign({},this._viewportProps,this._state,t))}},{key:"_applyConstraints",value:function(t){var n=t.maxZoom,i=t.minZoom,o=t.zoom;t.zoom=P0(o,i,n);var s=t.maxPitch,c=t.minPitch,f=t.pitch;return t.pitch=P0(f,c,s),Object.assign(t,BK(t)),t}},{key:"_unproject",value:function(t){var n=new Kc(this._viewportProps);return t&&n.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var n=t.startPanLngLat,i=t.pos,o=new Kc(this._viewportProps);return o.getMapCenterByLngLatPosition({lngLat:n,pos:i})}},{key:"_calculateNewZoom",value:function(t){var n=t.scale,i=t.startZoom,o=this._viewportProps,s=o.maxZoom,c=o.minZoom,f=i+Math.log2(n);return P0(f,c,s)}},{key:"_calculateNewPitchAndBearing",value:function(t){var n=t.deltaScaleX,i=t.deltaScaleY,o=t.startBearing,s=t.startPitch;i=P0(i,-1,1);var c=this._viewportProps,f=c.minPitch,g=c.maxPitch,b=o+180*n,T=s;return i>0?T=s+i*(g-s):i<0&&(T=s-i*(f-s)),{pitch:T,bearing:b}}},{key:"_getRotationParams",value:function(t,n){var i=t[0]-n[0],o=t[1]-n[1],s=t[1],c=n[1],f=this._viewportProps,g=f.width,b=f.height,T=i/g,S=0;return o>0?Math.abs(b-c)>US&&(S=o/(c-b)*iq):o<0&&c>US&&(S=1-s/c),S=Math.min(1,Math.max(-1,S)),{deltaScaleX:T,deltaScaleY:S}}}]),r}();function sq(r){return r[0].toLowerCase()+r.slice(1)}function oq(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:zf;for(var t in e){var n=t.slice(0,3),i=sq(t.slice(3));if(n==="min"&&r[i]<e[t]||n==="max"&&r[i]>e[t])return!1}return!0}function zS(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function GS(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zS(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):zS(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var ah=Bt.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),Zx=ah.Provider;function aq(r){var e=r.value,t=r.children,n=Bt.useState(null),i=as(n,2),o=i[0],s=i[1],c=Bt.useContext(ah);return e=GS(GS({setMap:s},c),{},{map:c&&c.map||o},e),Bt.createElement(Zx,{value:e},t)}ah.Provider=aq;var w2=typeof window<"u"?Bt.useLayoutEffect:Bt.useEffect;function VS(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Ka(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?VS(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):VS(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var cq="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",SO="A valid API access token is required to use Mapbox data";function lq(){}function IO(r){var e=r.props,t=r.width,n=r.height;return new Kc(Ka(Ka(Ka({},e),e.viewState),{},{width:t,height:n}))}var uq=401,HS={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},fq=Object.assign({},oh.propTypes,{width:dt.oneOfType([dt.number,dt.string]),height:dt.oneOfType([dt.number,dt.string]),onResize:dt.func,disableTokenWarning:dt.bool,visible:dt.bool,className:dt.string,style:dt.object,visibilityConstraints:dt.object}),hq=Object.assign({},oh.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:lq,className:"",style:null,visibilityConstraints:zf});function dq(){var r={position:"absolute",left:0,top:0};return Bt.createElement("div",{key:"warning",id:"no-token-warning",style:r},Bt.createElement("h3",{key:"header"},SO),Bt.createElement("div",{key:"text"},"For information on setting up your basemap, read"),Bt.createElement("a",{key:"link",href:cq},"Note on Map Tokens"))}function Aq(r){return{getMap:function(){return r.current&&r.current.getMap()},queryRenderedFeatures:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.current&&r.current.getMap();return i&&i.queryRenderedFeatures(t,n)}}}var jl=Bt.forwardRef(function(r,e){var t=Bt.useState(!0),n=as(t,2),i=n[0],o=n[1],s=Bt.useState({width:0,height:0}),c=as(s,2),f=c[0],g=c[1],b=Bt.useRef(null),T=Bt.useRef(null),S=Bt.useRef(null),F=Bt.useRef(null),k=Bt.useContext(ah);w2(function(){if(jl.supported()){var _e=new oh(Ka(Ka(Ka({},r),f),{},{mapboxgl:Yc,container:T.current,onError:function(ne){var Be=ne.error&&ne.error.status||ne.status;Be===uq&&i&&(console.error(SO),o(!1)),r.onError(ne)}}));b.current=_e,k&&k.setMap&&k.setMap(_e.getMap());var pe=new $K(function(X){if(X[0].contentRect){var ne=X[0].contentRect,Be=ne.width,Ze=ne.height;g({width:Be,height:Ze}),r.onResize({width:Be,height:Ze})}});return pe.observe(S.current),function(){_e.finalize(),b.current=null,pe.disconnect()}}},[]),w2(function(){b.current&&b.current.setProps(Ka(Ka({},r),f))});var U=b.current&&b.current.getMap();Bt.useImperativeHandle(e,function(){return Aq(b)},[]);var j=Bt.useCallback(function(_e){var pe=_e.target;pe===F.current&&pe.scrollTo(0,0)},[]),z=U&&Bt.createElement(Zx,{value:Ka(Ka({},k),{},{viewport:k.viewport||IO(Ka({map:U,props:r},f)),map:U,container:k.container||S.current})},Bt.createElement("div",{key:"map-overlays",className:"overlays",ref:F,style:HS,onScroll:j},r.children)),V=r.className,K=r.width,fe=r.height,Q=r.style,oe=r.visibilityConstraints,Te=Object.assign({position:"relative"},Q,{width:K,height:fe}),ze=r.visible&&oq(r.viewState||r,oe),Ae=Object.assign({},HS,{visibility:ze?"inherit":"hidden"});return Bt.createElement("div",{key:"map-container",ref:S,style:Te},Bt.createElement("div",{key:"map-mapbox",ref:T,style:Ae,className:V}),z,!i&&!r.disableTokenWarning&&Bt.createElement(dq,null))});jl.supported=function(){return Yc&&Yc.supported()};jl.propTypes=fq;jl.defaultProps=hq;function pq(r,e){var t;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=gq(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(g){throw g},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,c;return{s:function(){t=r[Symbol.iterator]()},n:function(){var g=t.next();return o=g.done,g},e:function(g){s=!0,c=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw c}}}}function gq(r,e){if(r){if(typeof r=="string")return jS(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return jS(r,e)}}function jS(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var MO=function(){function r(){Xu(this,r),yr(this,"propNames",[])}return Wu(r,[{key:"arePropsEqual",value:function(t,n){var i=pq(this.propNames||[]),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;if(!BO(t[s],n[s]))return!1}}catch(c){i.e(c)}finally{i.f()}return!0}},{key:"initializeProps",value:function(t,n){return{start:t,end:n}}},{key:"interpolateProps",value:function(t,n,i){qa(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(t,n){return n.transitionDuration}}]),r}(),mq={longitude:1,bearing:1};function i_(r){return Number.isFinite(r)||Array.isArray(r)}function _q(r){return r in mq}function C2(r,e,t){return _q(r)&&Math.abs(t-e)>180&&(t=t<0?t+360:t-360),t}function e1(r,e){var t;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=yq(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(g){throw g},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,c;return{s:function(){t=r[Symbol.iterator]()},n:function(){var g=t.next();return o=g.done,g},e:function(g){s=!0,c=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw c}}}}function yq(r,e){if(r){if(typeof r=="string")return JS(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return JS(r,e)}}function JS(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function vq(r){var e=bq();return function(){var n=tA(r),i;if(e){var o=tA(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return fx(this,i)}}function bq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var xq=["longitude","latitude","zoom","bearing","pitch"],wq=["latitude","longitude","zoom","width","height"],WS=["bearing","pitch"],Cq={speed:1.2,curve:1.414};(function(r){ux(t,r);var e=vq(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Xu(this,t),n=e.call(this),yr(Bu(n),"propNames",xq),n.props=Object.assign({},Cq,i),n}return Wu(t,[{key:"initializeProps",value:function(i,o){var s={},c={},f=e1(wq),g;try{for(f.s();!(g=f.n()).done;){var b=g.value,T=i[b],S=o[b];qa(i_(T)&&i_(S),"".concat(b," must be supplied for transition")),s[b]=T,c[b]=C2(b,T,S)}}catch(V){f.e(V)}finally{f.f()}var F=e1(WS),k;try{for(F.s();!(k=F.n()).done;){var U=k.value,j=i[U]||0,z=o[U]||0;s[U]=j,c[U]=C2(U,j,z)}}catch(V){F.e(V)}finally{F.f()}return{start:s,end:c}}},{key:"interpolateProps",value:function(i,o,s){var c=IK(i,o,s,this.props),f=e1(WS),g;try{for(f.s();!(g=f.n()).done;){var b=g.value;c[b]=n_(i[b],o[b],s)}}catch(T){f.e(T)}finally{f.f()}return c}},{key:"getDuration",value:function(i,o){var s=o.transitionDuration;return s==="auto"&&(s=MK(i,o,this.props)),s}}]),t})(MO);function XS(r,e){var t;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=Eq(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(g){throw g},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,c;return{s:function(){t=r[Symbol.iterator]()},n:function(){var g=t.next();return o=g.done,g},e:function(g){s=!0,c=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw c}}}}function Eq(r,e){if(r){if(typeof r=="string")return $S(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $S(r,e)}}function $S(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Tq(r){var e=Bq();return function(){var n=tA(r),i;if(e){var o=tA(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return fx(this,i)}}function Bq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Sq=["longitude","latitude","zoom","bearing","pitch"],Up=function(r){ux(t,r);var e=Tq(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Xu(this,t),n=e.call(this),Array.isArray(i)&&(i={transitionProps:i}),n.propNames=i.transitionProps||Sq,i.around&&(n.around=i.around),n}return Wu(t,[{key:"initializeProps",value:function(i,o){var s={},c={};if(this.around){s.around=this.around;var f=new Kc(i).unproject(this.around);Object.assign(c,o,{around:new Kc(o).project(f),aroundLngLat:f})}var g=XS(this.propNames),b;try{for(g.s();!(b=g.n()).done;){var T=b.value,S=i[T],F=o[T];qa(i_(S)&&i_(F),"".concat(T," must be supplied for transition")),s[T]=S,c[T]=C2(T,S,F)}}catch(k){g.e(k)}finally{g.f()}return{start:s,end:c}}},{key:"interpolateProps",value:function(i,o,s){var c={},f=XS(this.propNames),g;try{for(f.s();!(g=f.n()).done;){var b=g.value;c[b]=n_(i[b],o[b],s)}}catch(U){f.e(U)}finally{f.f()}if(o.around){var T=new Kc(Object.assign({},o,c)).getMapCenterByLngLatPosition({lngLat:o.aroundLngLat,pos:n_(i.around,o.around,s)}),S=as(T,2),F=S[0],k=S[1];c.longitude=F,c.latitude=k}return c}}]),t}(MO),zp=function(){};function Iq(r,e){var t=r(e);return function(n){return 1/(1-t)*(r(n*(1-e)+e)-t)}}var Gp={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},Mq={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new Up,transitionInterruption:Gp.BREAK,onTransitionStart:zp,onTransitionInterrupt:zp,onTransitionEnd:zp},Yx=function(){function r(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Xu(this,r),yr(this,"_animationFrame",null),yr(this,"_onTransitionFrame",function(){e._animationFrame=requestAnimationFrame(e._onTransitionFrame),e._updateViewport()}),this.props=null,this.onViewportChange=t.onViewportChange||zp,this.onStateChange=t.onStateChange||zp,this.time=t.getTime||Date.now}return Wu(r,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(t){var n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){var i=Object.assign({},n),o=Object.assign({},t);if(this._isTransitionInProgress()&&(n.onTransitionInterrupt(),this.state.interruption===Gp.SNAP_TO_END?Object.assign(i,this.state.endProps):Object.assign(i,this.state.propsInTransition),this.state.interruption===Gp.UPDATE)){var s=this.time(),c=(s-this.state.startTime)/this.state.duration;o.transitionDuration=this.state.duration-(s-this.state.startTime),o.transitionEasing=Iq(this.state.easing,c),o.transitionInterpolator=i.transitionInterpolator}return o.onTransitionStart(),this._triggerTransition(i,o),!0}return this._isTransitionInProgress()&&(n.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(t){var n=t.transitionDuration,i=t.transitionInterpolator;return(n>0||n==="auto")&&!!i}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(t,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(t,n){return t?this._isTransitionInProgress()?this.state.interruption===Gp.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(t,n):!0:!0}},{key:"_triggerTransition",value:function(t,n){qa(this._isTransitionEnabled(n)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var i=n.transitionInterpolator,o=i.getDuration?i.getDuration(t,n):n.transitionDuration;if(o!==0){var s=n.transitionInterpolator.initializeProps(t,n),c={inTransition:!0,isZooming:t.zoom!==n.zoom,isPanning:t.longitude!==n.longitude||t.latitude!==n.latitude,isRotating:t.bearing!==n.bearing||t.pitch!==n.pitch};this.state={duration:o,easing:n.transitionEasing,interpolator:n.transitionInterpolator,interruption:n.transitionInterruption,startTime:this.time(),startProps:s.start,endProps:s.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(c)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var t=this.time(),n=this.state,i=n.startTime,o=n.duration,s=n.easing,c=n.interpolator,f=n.startProps,g=n.endProps,b=!1,T=(t-i)/o;T>=1&&(T=1,b=!0),T=s(T);var S=c.interpolateProps(f,g,T),F=new Kd(Object.assign({},this.props,S));this.state.propsInTransition=F.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),b&&(this._endTransition(),this.props.onTransitionEnd())}}]),r}();yr(Yx,"defaultProps",Mq);function KS(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function mo(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?KS(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):KS(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Sf={transitionDuration:0},Bl={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new Up,transitionInterruption:Gp.BREAK},R0=300,F0=function(e){return 1-(1-e)*(1-e)},od={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},PO=function(){function r(){var e=this;Xu(this,r),yr(this,"events",[]),yr(this,"scrollZoom",!0),yr(this,"dragPan",!0),yr(this,"dragRotate",!0),yr(this,"doubleClickZoom",!0),yr(this,"touchZoom",!0),yr(this,"touchRotate",!1),yr(this,"keyboard",!0),yr(this,"_interactionState",{isDragging:!1}),yr(this,"_events",{}),yr(this,"_setInteractionState",function(t){Object.assign(e._interactionState,t),e.onStateChange&&e.onStateChange(e._interactionState)}),yr(this,"_onTransition",function(t,n){e.onViewportChange(t,e._interactionState,n)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new Yx({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return Wu(r,[{key:"handleEvent",value:function(t){this.mapState=this.getMapState();var n=this._eventStartBlocked;switch(t.type){case"panstart":return n?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return n?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return n?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var n=t.offsetCenter,i=n.x,o=n.y;return[i,o]}},{key:"isFunctionKeyPressed",value:function(t){var n=t.srcEvent;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}},{key:"blockEvents",value:function(t){var n=this,i=setTimeout(function(){n._eventStartBlocked===i&&(n._eventStartBlocked=null)},t);this._eventStartBlocked=i}},{key:"updateViewport",value:function(t,n,i){var o=this.mapState instanceof Kd?this.mapState.getViewportProps():this.mapState,s=mo(mo({},t.getViewportProps()),n),c=Object.keys(s).some(function(f){return o[f]!==s[f]});this._state=t.getState(),this._setInteractionState(i),c&&this.onViewportChange(s,this._interactionState,o)}},{key:"getMapState",value:function(t){return new Kd(mo(mo(mo({},this.mapStateProps),this._state),t))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(t){var n=t.onViewportChange,i=t.onStateChange,o=t.eventManager,s=o===void 0?this.eventManager:o,c=t.isInteractive,f=c===void 0?!0:c,g=t.scrollZoom,b=g===void 0?this.scrollZoom:g,T=t.dragPan,S=T===void 0?this.dragPan:T,F=t.dragRotate,k=F===void 0?this.dragRotate:F,U=t.doubleClickZoom,j=U===void 0?this.doubleClickZoom:U,z=t.touchZoom,V=z===void 0?this.touchZoom:z,K=t.touchRotate,fe=K===void 0?this.touchRotate:K,Q=t.keyboard,oe=Q===void 0?this.keyboard:Q;this.onViewportChange=n,this.onStateChange=i;var Te=this.mapStateProps||{},ze=Te.height!==t.height||Te.width!==t.width;this.mapStateProps=t,ze&&(this.mapState=Te,this.updateViewport(new Kd(t))),this._transitionManager.processViewportChange(t),this.eventManager!==s&&(this.eventManager=s,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(od.WHEEL,f&&!!b),this.toggleEvents(od.PAN,f&&!!(S||k)),this.toggleEvents(od.PINCH,f&&!!(V||fe)),this.toggleEvents(od.TRIPLE_PAN,f&&!!fe),this.toggleEvents(od.DOUBLE_TAP,f&&!!j),this.toggleEvents(od.KEYBOARD,f&&!!oe),this.scrollZoom=b,this.dragPan=S,this.dragRotate=k,this.doubleClickZoom=j,this.touchZoom=V,this.touchRotate=fe,this.keyboard=oe}},{key:"toggleEvents",value:function(t,n){var i=this;this.eventManager&&t.forEach(function(o){i._events[o]!==n&&(i._events[o]=n,n?i.eventManager.on(o,i.handleEvent):i.eventManager.off(o,i.handleEvent))})}},{key:"_onPanStart",value:function(t){var n=this.getCenter(t);this._panRotate=this.isFunctionKeyPressed(t)||t.rightButton;var i=this._panRotate?this.mapState.rotateStart({pos:n}):this.mapState.panStart({pos:n});return this.updateViewport(i,Sf,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotate(t):this._onPanMove(t):!1}},{key:"_onPanEnd",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotateEnd(t):this._onPanMoveEnd(t):!1}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var n=this.getCenter(t),i=this.mapState.pan({pos:n});return this.updateViewport(i,Sf,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(t){if(this.dragPan){var n=this.dragPan.inertia,i=n===void 0?R0:n;if(i&&t.velocity){var o=this.getCenter(t),s=[o[0]+t.velocityX*i/2,o[1]+t.velocityY*i/2],c=this.mapState.pan({pos:s}).panEnd();return this.updateViewport(c,mo(mo({},Bl),{},{transitionDuration:i,transitionEasing:F0}),{isDragging:!1,isPanning:!0}),!0}}var f=this.mapState.panEnd();return this.updateViewport(f,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var n=this.getCenter(t),i=this.mapState.rotate({pos:n});return this.updateViewport(i,Sf,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(t){if(this.dragRotate){var n=this.dragRotate.inertia,i=n===void 0?R0:n;if(i&&t.velocity){var o=this.getCenter(t),s=[o[0]+t.velocityX*i/2,o[1]+t.velocityY*i/2],c=this.mapState.rotate({pos:s}).rotateEnd();return this.updateViewport(c,mo(mo({},Bl),{},{transitionDuration:i,transitionEasing:F0}),{isDragging:!1,isRotating:!0}),!0}}var f=this.mapState.panEnd();return this.updateViewport(f,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;var n=this.scrollZoom,i=n.speed,o=i===void 0?.01:i,s=n.smooth,c=s===void 0?!1:s;t.preventDefault();var f=this.getCenter(t),g=t.delta,b=2/(1+Math.exp(-Math.abs(g*o)));g<0&&b!==0&&(b=1/b);var T=this.mapState.zoom({pos:f,scale:b});return T.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(T,mo(mo({},Bl),{},{transitionInterpolator:new Up({around:f}),transitionDuration:c?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(t){var n=this.getCenter(t),i=this.mapState.zoomStart({pos:n}).rotateStart({pos:n});return this._startPinchRotation=t.rotation,this._lastPinchEvent=t,this.updateViewport(i,Sf,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var n=this.mapState;if(this.touchZoom){var i=t.scale,o=this.getCenter(t);n=n.zoom({pos:o,scale:i})}if(this.touchRotate){var s=t.rotation;n=n.rotate({deltaAngleX:this._startPinchRotation-s})}return this.updateViewport(n,Sf,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=t,!0}},{key:"_onPinchEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchZoom){var n=this.touchZoom.inertia,i=n===void 0?R0:n,o=this._lastPinchEvent;if(i&&o&&t.scale!==o.scale){var s=this.getCenter(t),c=this.mapState.rotateEnd(),f=Math.log2(t.scale),g=(f-Math.log2(o.scale))/(t.deltaTime-o.deltaTime),b=Math.pow(2,f+g*i/2);return c=c.zoom({pos:s,scale:b}).zoomEnd(),this.updateViewport(c,mo(mo({},Bl),{},{transitionInterpolator:new Up({around:s}),transitionDuration:i,transitionEasing:F0}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(i),!0}}var T=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(T,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(t){var n=this.getCenter(t),i=this.mapState.rotateStart({pos:n});return this.updateViewport(i,Sf,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(t){if(!this.isDragging()||!this.touchRotate)return!1;var n=this.getCenter(t);n[0]-=t.deltaX;var i=this.mapState.rotate({pos:n});return this.updateViewport(i,Sf,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchRotate){var n=this.touchRotate.inertia,i=n===void 0?R0:n;if(i&&t.velocityY){var o=this.getCenter(t),s=[o[0],o[1]+=t.velocityY*i/2],c=this.mapState.rotate({pos:s});return this.updateViewport(c,mo(mo({},Bl),{},{transitionDuration:i,transitionEasing:F0}),{isDragging:!1,isRotating:!0}),this.blockEvents(i),!1}}var f=this.mapState.rotateEnd();return this.updateViewport(f,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var n=this.getCenter(t),i=this.isFunctionKeyPressed(t),o=this.mapState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(o,Object.assign({},Bl,{transitionInterpolator:new Up({around:n})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var n=this.isFunctionKeyPressed(t),i=this.keyboard,o=i.zoomSpeed,s=o===void 0?2:o,c=i.moveSpeed,f=c===void 0?100:c,g=i.rotateSpeedX,b=g===void 0?15:g,T=i.rotateSpeedY,S=T===void 0?10:T,F=this.mapStateProps,k;switch(t.srcEvent.keyCode){case 189:n?k=this.getMapState({zoom:F.zoom-Math.log2(s)-1}):k=this.getMapState({zoom:F.zoom-Math.log2(s)});break;case 187:n?k=this.getMapState({zoom:F.zoom+Math.log2(s)+1}):k=this.getMapState({zoom:F.zoom+Math.log2(s)});break;case 37:n?k=this.getMapState({bearing:F.bearing-b}):k=this.mapState.pan({pos:[f,0],startPos:[0,0]});break;case 39:n?k=this.getMapState({bearing:F.bearing+b}):k=this.mapState.pan({pos:[-f,0],startPos:[0,0]});break;case 38:n?k=this.getMapState({pitch:F.pitch+S}):k=this.mapState.pan({pos:[0,f],startPos:[0,0]});break;case 40:n?k=this.getMapState({pitch:F.pitch-S}):k=this.mapState.pan({pos:[0,-f],startPos:[0,0]});break;default:return!1}return this.updateViewport(k,Bl)}}]),r}();function qS(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function El(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?qS(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):qS(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Pq=Object.assign({},jl.propTypes,{maxZoom:dt.number,minZoom:dt.number,maxPitch:dt.number,minPitch:dt.number,onViewStateChange:dt.func,onViewportChange:dt.func,onInteractionStateChange:dt.func,transitionDuration:dt.oneOfType([dt.number,dt.string]),transitionInterpolator:dt.object,transitionInterruption:dt.number,transitionEasing:dt.func,onTransitionStart:dt.func,onTransitionInterrupt:dt.func,onTransitionEnd:dt.func,scrollZoom:dt.oneOfType([dt.bool,dt.object]),dragPan:dt.oneOfType([dt.bool,dt.object]),dragRotate:dt.oneOfType([dt.bool,dt.object]),doubleClickZoom:dt.bool,touchZoom:dt.oneOfType([dt.bool,dt.object]),touchRotate:dt.oneOfType([dt.bool,dt.object]),keyboard:dt.oneOfType([dt.bool,dt.object]),onHover:dt.func,onClick:dt.func,onDblClick:dt.func,onContextMenu:dt.func,onMouseDown:dt.func,onMouseMove:dt.func,onMouseUp:dt.func,onTouchStart:dt.func,onTouchMove:dt.func,onTouchEnd:dt.func,onMouseEnter:dt.func,onMouseLeave:dt.func,onMouseOut:dt.func,onWheel:dt.func,touchAction:dt.string,eventRecognizerOptions:dt.object,clickRadius:dt.number,interactiveLayerIds:dt.array,getCursor:dt.func,controller:dt.instanceOf(PO)}),Rq=function(e){var t=e.isDragging,n=e.isHovering;return t?"grabbing":n?"pointer":"grab"},Fq=Object.assign({},jl.defaultProps,zf,Yx.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:Rq});function Qx(r){if(r.lngLat||!r.offsetCenter)return r;var e=r.offsetCenter,t=e.x,n=e.y;if(!Number.isFinite(t)||!Number.isFinite(n))return r;var i=[t,n];return r.point=i,r.lngLat=this.viewport.unproject(i),r}function RO(r){var e=this.map;if(!e||!r)return null;var t={},n=this.props.clickRadius;this.props.interactiveLayerIds&&(t.layers=this.props.interactiveLayerIds);try{return e.queryRenderedFeatures(n?[[r[0]-n,r[1]+n],[r[0]+n,r[1]-n]]:r,t)}catch{return null}}function Fl(r,e){var t=this.props[r];t&&t(Qx.call(this,e))}function Dq(r){Fl.call(this,r.pointerType==="touch"?"onTouchStart":"onMouseDown",r)}function Oq(r){Fl.call(this,r.pointerType==="touch"?"onTouchEnd":"onMouseUp",r)}function Lq(r){if(Fl.call(this,r.pointerType==="touch"?"onTouchMove":"onMouseMove",r),!this.state.isDragging){var e=this.props,t=e.onHover,n=e.interactiveLayerIds,i;r=Qx.call(this,r),(n||t)&&(i=RO.call(this,r.point));var o=!!(n&&i&&i.length>0),s=o&&!this.state.isHovering,c=!o&&this.state.isHovering;(t||s)&&(r.features=i,t&&t(r)),s&&Fl.call(this,"onMouseEnter",r),c&&Fl.call(this,"onMouseLeave",r),(s||c)&&this.setState({isHovering:o})}}function ZS(r){var e=this.props,t=e.onClick,n=e.onNativeClick,i=e.onDblClick,o=e.doubleClickZoom,s=[],c=i||o;switch(r.type){case"anyclick":s.push(n),c||s.push(t);break;case"click":c&&s.push(t);break}s=s.filter(Boolean),s.length&&(r=Qx.call(this,r),r.features=RO.call(this,r.point),s.forEach(function(f){return f(r)}))}function Nq(r){return{getMap:r.current&&r.current.getMap,queryRenderedFeatures:r.current&&r.current.queryRenderedFeatures}}var ew=Bt.forwardRef(function(r,e){var t=Bt.useContext(ah),n=Bt.useMemo(function(){return r.controller||new PO},[]),i=Bt.useMemo(function(){return new qD(null,{touchAction:r.touchAction,recognizerOptions:r.eventRecognizerOptions})},[]),o=Bt.useRef(null),s=Bt.useRef(null),c=Bt.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),f=c.current;f.props=r,f.map=s.current&&s.current.getMap(),f.setState=function(oe){f.state=El(El({},f.state),oe),o.current.style.cursor=r.getCursor(f.state)};var g=!0,b,T,S=function(Te,ze,Ae){if(g){b=[Te,ze,Ae];return}var _e=f.props,pe=_e.onViewStateChange,X=_e.onViewportChange;pe&&pe({viewState:Te,interactionState:ze,oldViewState:Ae}),X&&X(Te,ze,Ae)};Bt.useImperativeHandle(e,function(){return Nq(s)},[]);var F=Bt.useMemo(function(){return El(El({},t),{},{eventManager:i,container:t.container||o.current})},[t,o.current]);F.onViewportChange=S,F.viewport=t.viewport||IO(f),f.viewport=F.viewport;var k=function(Te){var ze=Te.isDragging,Ae=ze===void 0?!1:ze;if(Ae!==f.state.isDragging&&f.setState({isDragging:Ae}),g){T=Te;return}var _e=f.props.onInteractionStateChange;_e&&_e(Te)},U=function(){f.width&&f.height&&n.setOptions(El(El(El({},f.props),f.props.viewState),{},{isInteractive:!!(f.props.onViewStateChange||f.props.onViewportChange),onViewportChange:S,onStateChange:k,eventManager:i,width:f.width,height:f.height}))},j=function(Te){var ze=Te.width,Ae=Te.height;f.width=ze,f.height=Ae,U(),f.props.onResize({width:ze,height:Ae})};Bt.useEffect(function(){return i.setElement(o.current),i.on({pointerdown:Dq.bind(f),pointermove:Lq.bind(f),pointerup:Oq.bind(f),pointerleave:Fl.bind(f,"onMouseOut"),click:ZS.bind(f),anyclick:ZS.bind(f),dblclick:Fl.bind(f,"onDblClick"),wheel:Fl.bind(f,"onWheel"),contextmenu:Fl.bind(f,"onContextMenu")}),function(){i.destroy()}},[]),w2(function(){b&&S.apply(void 0,hk(b)),T&&k(T)}),U();var z=r.width,V=r.height,K=r.style,fe=r.getCursor,Q=Bt.useMemo(function(){return El(El({position:"relative"},K),{},{width:z,height:V,cursor:fe(f.state)})},[K,z,V,fe,f.state]);return(!b||!f._child)&&(f._child=Bt.createElement(Zx,{value:F},Bt.createElement("div",{key:"event-canvas",ref:o,style:Q},Bt.createElement(jl,kR({},r,{width:"100%",height:"100%",style:null,onResize:j,ref:s}))))),g=!1,f._child});ew.supported=jl.supported;ew.propTypes=Pq;ew.defaultProps=Fq;dt.string.isRequired;var kq=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade"];dt.oneOf(kq).isRequired;var Ku={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},hc={captureScroll:dt.bool,captureDrag:dt.bool,captureClick:dt.bool,captureDoubleClick:dt.bool,capturePointerMove:dt.bool};function Uq(r){var e=r.containerRef.current,t=r.context.eventManager;if(!(!e||!t)){var n={wheel:function(o){var s=r.props;s.captureScroll&&o.stopPropagation(),s.onScroll&&s.onScroll(o,r)},panstart:function(o){var s=r.props;s.captureDrag&&o.stopPropagation(),s.onDragStart&&s.onDragStart(o,r)},anyclick:function(o){var s=r.props;s.captureClick&&o.stopPropagation(),s.onNativeClick&&s.onNativeClick(o,r)},click:function(o){var s=r.props;s.captureClick&&o.stopPropagation(),s.onClick&&s.onClick(o,r)},dblclick:function(o){var s=r.props;s.captureDoubleClick&&o.stopPropagation(),s.onDoubleClick&&s.onDoubleClick(o,r)},pointermove:function(o){var s=r.props;s.capturePointerMove&&o.stopPropagation(),s.onPointerMove&&s.onPointerMove(o,r)}};return t.watch(n,e),function(){t.off(n)}}}function qu(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Bt.useContext(ah),t=Bt.useRef(null),n=Bt.useRef({props:r,state:{},context:e,containerRef:t}),i=n.current;return i.props=r,i.context=e,Bt.useEffect(function(){return Uq(i)},[e.eventManager]),i}function zq(r){var e=Gq();return function(){var n=tA(r),i;if(e){var o=tA(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return fx(this,i)}}function Gq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Vq(r){var e=r.instance,t=qu(r),n=t.context,i=t.containerRef;return e._context=n,e._containerRef=i,e._render()}var FO=function(r){ux(t,r);var e=zq(t);function t(){var n;Xu(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=e.call.apply(e,[this].concat(o)),yr(Bu(n),"_context",{}),yr(Bu(n),"_containerRef",Bt.createRef()),yr(Bu(n),"_onScroll",function(c){}),yr(Bu(n),"_onDragStart",function(c){}),yr(Bu(n),"_onDblClick",function(c){}),yr(Bu(n),"_onClick",function(c){}),yr(Bu(n),"_onPointerMove",function(c){}),n}return Wu(t,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return Bt.createElement(Vq,kR({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),t}(Bt.PureComponent);yr(FO,"propTypes",hc);yr(FO,"defaultProps",Ku);function YS(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function QS(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?YS(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):YS(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Hq=Object.assign({},hc,{draggable:dt.bool,onDrag:dt.func,onDragEnd:dt.func,onDragStart:dt.func,offsetLeft:dt.number,offsetTop:dt.number}),jq=Object.assign({},Ku,{draggable:!1,offsetLeft:0,offsetTop:0});function DO(r){var e=r.offsetCenter,t=e.x,n=e.y;return[t,n]}function Jq(r,e){var t=r.center,n=t.x,i=t.y;if(e){var o=e.getBoundingClientRect();return[o.left-n,o.top-i]}return null}function tw(r,e,t,n){var i=r[0]+e[0]-t.offsetLeft,o=r[1]+e[1]-t.offsetTop;return n.viewport.unproject([i,o])}function Wq(r,e){var t=e.props,n=e.callbacks,i=e.state,o=e.context,s=e.containerRef,c=t.draggable;if(c){r.stopPropagation();var f=DO(r),g=Jq(r,s.current);if(i.setDragPos(f),i.setDragOffset(g),n.onDragStart&&g){var b=Object.assign({},r);b.lngLat=tw(f,g,t,o),n.onDragStart(b)}}}function Xq(r,e){var t=e.props,n=e.callbacks,i=e.state,o=e.context;r.stopPropagation();var s=DO(r);i.setDragPos(s);var c=i.dragOffset;if(n.onDrag&&c){var f=Object.assign({},r);f.lngLat=tw(s,c,t,o),n.onDrag(f)}}function $q(r,e){var t=e.props,n=e.callbacks,i=e.state,o=e.context;r.stopPropagation();var s=i.dragPos,c=i.dragOffset;if(i.setDragPos(null),i.setDragOffset(null),n.onDragEnd&&s&&c){var f=Object.assign({},r);f.lngLat=tw(s,c,t,o),n.onDragEnd(f)}}function Kq(r,e){var t=e.state;r.stopPropagation(),t.setDragPos(null),t.setDragOffset(null)}function qq(r){var e=r.context.eventManager;if(!(!e||!r.state.dragPos)){var t={panmove:function(i){return Xq(i,r)},panend:function(i){return $q(i,r)},pancancel:function(i){return Kq(i,r)}};return e.watch(t),function(){e.off(t)}}}function Zq(r){var e=Bt.useState(null),t=as(e,2),n=t[0],i=t[1],o=Bt.useState(null),s=as(o,2),c=s[0],f=s[1],g=qu(QS(QS({},r),{},{onDragStart:Wq}));return g.callbacks=r,g.state.dragPos=n,g.state.setDragPos=i,g.state.dragOffset=c,g.state.setDragOffset=f,Bt.useEffect(function(){return qq(g)},[g.context.eventManager,!!n]),g}var eI=typeof window<"u"&&window.devicePixelRatio||1,ng=function(e){return Math.round(e*eI)/eI},tI=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(e===null)return t;var i=n==="x"?e.offsetWidth:e.offsetHeight;return ng(t/100*i)/i*100};function rI(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Yq(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?rI(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):rI(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Qq=Object.assign({},Hq,{className:dt.string,longitude:dt.number.isRequired,latitude:dt.number.isRequired,style:dt.object}),eZ=Object.assign({},jq,{className:""});function tZ(r){var e=r.props,t=r.state,n=r.context,i=e.longitude,o=e.latitude,s=e.offsetLeft,c=e.offsetTop,f=t.dragPos,g=t.dragOffset;if(f&&g)return[f[0]+g[0],f[1]+g[1]];var b=n.viewport.project([i,o]),T=as(b,2),S=T[0],F=T[1];return S+=s,F+=c,[S,F]}function rw(r){var e=Zq(r),t=e.state,n=e.containerRef,i=r.children,o=r.className,s=r.draggable,c=r.style,f=t.dragPos,g=tZ(e),b=as(g,2),T=b[0],S=b[1],F="translate(".concat(ng(T),"px, ").concat(ng(S),"px)"),k=s?f?"grabbing":"grab":"auto",U=Bt.useMemo(function(){var z=Yq({position:"absolute",left:0,top:0,transform:F,cursor:k},c);return Bt.createElement("div",{className:"mapboxgl-marker ".concat(o),ref:e.containerRef,style:z},i)},[i,o]),j=n.current;return j&&(j.style.transform=F,j.style.cursor=k),U}rw.defaultProps=eZ;rw.propTypes=Qq;Bt.memo(rw);var ig={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},rZ=Object.keys(ig);function nZ(r){var e=r.x,t=r.y,n=r.width,i=r.height,o=r.selfWidth,s=r.selfHeight,c=r.anchor,f=r.padding,g=f===void 0?0:f,b=ig[c],T=b.x,S=b.y,F=t-S*s,k=F+s,U=Math.max(0,g-F)+Math.max(0,k-i+g);if(U>0){var j=S,z=U;for(S=0;S<=1;S+=.5)F=t-S*s,k=F+s,U=Math.max(0,g-F)+Math.max(0,k-i+g),U<z&&(z=U,j=S);S=j}var V=.5;S===.5&&(T=Math.floor(T),V=1);var K=e-T*o,fe=K+o,Q=Math.max(0,g-K)+Math.max(0,fe-n+g);if(Q>0){var oe=T,Te=Q;for(T=0;T<=1;T+=V)K=e-T*o,fe=K+o,Q=Math.max(0,g-K)+Math.max(0,fe-n+g),Q<Te&&(Te=Q,oe=T);T=oe}return rZ.find(function(ze){var Ae=ig[ze];return Ae.x===T&&Ae.y===S})||c}var iZ=Object.assign({},hc,{className:dt.string,longitude:dt.number.isRequired,latitude:dt.number.isRequired,altitude:dt.number,offsetLeft:dt.number,offsetTop:dt.number,tipSize:dt.number,closeButton:dt.bool,closeOnClick:dt.bool,anchor:dt.oneOf(Object.keys(ig)),dynamicPosition:dt.bool,sortByDepth:dt.bool,onClose:dt.func}),sZ=Object.assign({},Ku,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function oZ(r,e,t,n){var i=as(n,2),o=i[0],s=i[1],c=r.anchor,f=r.dynamicPosition,g=r.tipSize;return t&&f?nZ({x:o,y:s,anchor:c,padding:g,width:e.width,height:e.height,selfWidth:t.clientWidth,selfHeight:t.clientHeight}):c}function aZ(r,e,t,n,i){var o=as(n,3),s=o[0],c=o[1],f=o[2],g=r.offsetLeft,b=r.offsetTop,T=r.sortByDepth,S=ig[i],F=s+g,k=c+b,U=tI(t,-S.x*100),j=tI(t,-S.y*100,"y"),z={position:"absolute",transform:`
      translate(`.concat(U,"%, ").concat(j,`%)
      translate(`).concat(ng(F),"px, ").concat(ng(k),`px)
    `),display:void 0,zIndex:void 0};return T&&(f>1||f<-1||s<0||s>e.width||c<0||c>e.height?z.display="none":z.zIndex=Math.floor((1-f)/2*1e5)),z}function nw(r){var e=Bt.useRef(null),t=qu(r),n=t.context,i=t.containerRef,o=Bt.useState(!1),s=as(o,2),c=s[1];Bt.useEffect(function(){c(!0)},[e.current]),Bt.useEffect(function(){if(n.eventManager&&r.closeOnClick){var fe=function(){return t.props.onClose()};return n.eventManager.on("anyclick",fe),function(){n.eventManager.off("anyclick",fe)}}},[n.eventManager,r.closeOnClick]);var f=n.viewport,g=r.className,b=r.longitude,T=r.latitude,S=r.altitude,F=r.tipSize,k=r.closeButton,U=r.children,j=f.project([b,T,S]),z=oZ(r,f,e.current,j),V=aZ(r,f,i.current,j,z),K=Bt.useCallback(function(fe){t.props.onClose();var Q=t.context.eventManager;Q&&Q.once("click",function(oe){return oe.stopPropagation()},fe.target)},[]);return Bt.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(z," ").concat(g),style:V,ref:i},Bt.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:F}}),Bt.createElement("div",{key:"content",ref:e,className:"mapboxgl-popup-content"},k&&Bt.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:K},""),U))}nw.propTypes=iZ;nw.defaultProps=sZ;Bt.memo(nw);function nI(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function cZ(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?nI(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):nI(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var lZ=Object.assign({},hc,{toggleLabel:dt.string,className:dt.string,style:dt.object,compact:dt.bool,customAttribution:dt.oneOfType([dt.string,dt.arrayOf(dt.string)])}),uZ=Object.assign({},Ku,{className:"",toggleLabel:"Toggle Attribution"});function fZ(r,e,t,n){var i=new Yc.AttributionControl(r);return i._map=e,i._container=t,i._innerContainer=n,i._updateAttributions(),i._updateEditLink(),e.on("styledata",i._updateData),e.on("sourcedata",i._updateData),i}function hZ(r){r._map.off("styledata",r._updateData),r._map.off("sourcedata",r._updateData)}function iw(r){var e=qu(r),t=e.context,n=e.containerRef,i=Bt.useRef(null),o=Bt.useState(!1),s=as(o,2),c=s[0],f=s[1];Bt.useEffect(function(){var S;return t.map&&(S=fZ({customAttribution:r.customAttribution},t.map,n.current,i.current)),function(){return S&&hZ(S)}},[t.map]);var g=r.compact===void 0?t.viewport.width<=640:r.compact;Bt.useEffect(function(){!g&&c&&f(!1)},[g]);var b=Bt.useCallback(function(){return f(function(S){return!S})},[]),T=Bt.useMemo(function(){return cZ({position:"absolute"},r.style)},[r.style]);return Bt.createElement("div",{style:T,className:r.className},Bt.createElement("div",{ref:n,"aria-pressed":c,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(g?"mapboxgl-compact":""," ").concat(c?"mapboxgl-compact-show":"")},Bt.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:r.toggleLabel,onClick:b}),Bt.createElement("div",{ref:i,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}iw.propTypes=lZ;iw.defaultProps=uZ;Bt.memo(iw);function iI(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function dZ(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?iI(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):iI(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var AZ=Object.assign({},hc,{className:dt.string,style:dt.object,container:dt.object,label:dt.string}),pZ=Object.assign({},Ku,{className:"",container:null,label:"Toggle fullscreen"});function sw(r){var e=qu(r),t=e.context,n=e.containerRef,i=Bt.useState(!1),o=as(i,2),s=o[0],c=o[1],f=Bt.useState(!1),g=as(f,2),b=g[0],T=g[1],S=Bt.useState(null),F=as(S,2),k=F[0],U=F[1];Bt.useEffect(function(){var Q=new Yc.FullscreenControl;U(Q),T(Q._checkFullscreenSupport());var oe=function(){var ze=!Q._fullscreen;Q._fullscreen=ze,c(ze)};return Ml.addEventListener(Q._fullscreenchange,oe),function(){Ml.removeEventListener(Q._fullscreenchange,oe)}},[]);var j=function(){k&&(k._container=r.container||t.container,k._onClickFullscreen())},z=Bt.useMemo(function(){return dZ({position:"absolute"},r.style)},[r.style]);if(!b)return null;var V=r.className,K=r.label,fe=s?"shrink":"fullscreen";return Bt.createElement("div",{style:z,className:V},Bt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Bt.createElement("button",{key:fe,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(fe),type:"button",title:K,onClick:j},Bt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}sw.propTypes=AZ;sw.defaultProps=pZ;Bt.memo(sw);var ad;function gZ(){return ad!==void 0?Promise.resolve(ad):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(r){return ad=r.state!=="denied",ad}):(ad=!!window.navigator.geolocation,Promise.resolve(ad))}function sI(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function mZ(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?sI(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):sI(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var oI=function(){},_Z=Object.assign({},hc,{className:dt.string,style:dt.object,label:dt.string,disabledLabel:dt.string,auto:dt.bool,positionOptions:dt.object,fitBoundsOptions:dt.object,trackUserLocation:dt.bool,showUserLocation:dt.bool,showAccuracyCircle:dt.bool,showUserHeading:dt.bool,onViewStateChange:dt.func,onViewportChange:dt.func,onGeolocate:dt.func}),yZ=Object.assign({},Ku,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function vZ(r){var e=new Yc.LngLat(r.coords.longitude,r.coords.latitude),t=r.coords.accuracy,n=e.toBounds(t);return[[n._ne.lng,n._ne.lat],[n._sw.lng,n._sw.lat]]}function bZ(r,e,t){var n=new Yc.GeolocateControl(e);n._container=Ml.createElement("div"),n._map={on:function(){},_getUIString:function(){return""}},n._setupUI(!0),n._map=r.map,n._geolocateButton=t;var i=r.eventManager;return n.options.trackUserLocation&&i&&i.on("panstart",function(){n._watchState==="ACTIVE_LOCK"&&(n._watchState="BACKGROUND",t.classList.add("mapboxgl-ctrl-geolocate-background"),t.classList.remove("mapboxgl-ctrl-geolocate-active"))}),n.on("geolocate",e.onGeolocate),n}function xZ(r,e){var t=e.context,n=e.props,i=vZ(r),o=t.viewport.fitBounds(i,n.fitBoundsOptions),s=o.longitude,c=o.latitude,f=o.zoom,g=Object.assign({},t.viewport,{longitude:s,latitude:c,zoom:f}),b=new Kd(g),T=Object.assign({},b.getViewportProps(),Bl),S=n.onViewportChange||t.onViewportChange||oI,F=n.onViewStateChange||t.onViewStateChange||oI;F({viewState:T}),S(T)}function ow(r){var e=qu(r),t=e.context,n=e.containerRef,i=Bt.useRef(null),o=Bt.useState(null),s=as(o,2),c=s[0],f=s[1],g=Bt.useState(!1),b=as(g,2),T=b[0],S=b[1];Bt.useEffect(function(){var K;return t.map&&gZ().then(function(fe){S(fe),i.current&&(K=bZ(t,r,i.current),K._updateCamera=function(Q){return xZ(Q,e)},f(K))}),function(){K&&K._clearWatch()}},[t.map]);var F=Bt.useCallback(function(){c&&(c.options=e.props,c.trigger())},[c]);Bt.useEffect(function(){r.auto&&F()},[c,r.auto]),Bt.useEffect(function(){c&&c._onZoom()},[t.viewport.zoom]);var k=r.className,U=r.label,j=r.disabledLabel,z=r.trackUserLocation,V=Bt.useMemo(function(){return mZ({position:"absolute"},r.style)},[r.style]);return Bt.createElement("div",{style:V,className:k},Bt.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Bt.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:i,disabled:!T,"aria-pressed":!z,type:"button",title:T?U:j,"aria-label":T?U:j,onClick:F},Bt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}ow.propTypes=_Z;ow.defaultProps=yZ;Bt.memo(ow);function wZ(r,e){for(var t=(r||"").split(".").map(Number),n=e.split(".").map(Number),i=0;i<3;i++){var o=t[i]||0,s=n[i]||0;if(o<s)return-1;if(o>s)return 1}return 0}function aI(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function CZ(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?aI(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):aI(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var cI=function(){},EZ=Object.assign({},hc,{className:dt.string,style:dt.object,onViewStateChange:dt.func,onViewportChange:dt.func,showCompass:dt.bool,showZoom:dt.bool,zoomInLabel:dt.string,zoomOutLabel:dt.string,compassLabel:dt.string}),TZ=Object.assign({},Ku,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),BZ=1,E2=2;function SZ(r){return wZ(r,"1.6.0")>=0?E2:BZ}function t1(r,e,t){var n=r.viewport,i=new Kd(Object.assign({},n,t)),o=Object.assign({},i.getViewportProps(),Bl),s=e.onViewportChange||r.onViewportChange||cI,c=e.onViewStateChange||r.onViewStateChange||cI;c({viewState:o}),s(o)}function r1(r,e,t,n){return Bt.createElement("button",{key:r,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(r),type:"button",title:e,onClick:t},n||Bt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function IZ(r){var e=Bt.useMemo(function(){return r.map?SZ(r.map.version):E2},[r.map]),t=r.viewport.bearing,n={transform:"rotate(".concat(-t,"deg)")};return e===E2?Bt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:n}):Bt.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:n})}function aw(r){var e=qu(r),t=e.context,n=e.containerRef,i=function(){t1(t,r,{zoom:t.viewport.zoom+1})},o=function(){t1(t,r,{zoom:t.viewport.zoom-1})},s=function(){t1(t,r,{bearing:0,pitch:0})},c=r.className,f=r.showCompass,g=r.showZoom,b=r.zoomInLabel,T=r.zoomOutLabel,S=r.compassLabel,F=Bt.useMemo(function(){return CZ({position:"absolute"},r.style)},[r.style]);return Bt.createElement("div",{style:F,className:c},Bt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},g&&r1("zoom-in",b,i),g&&r1("zoom-out",T,o),f&&r1("compass",S,s,IZ(t))))}aw.propTypes=EZ;aw.defaultProps=TZ;const MZ=Bt.memo(aw);function lI(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function PZ(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?lI(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):lI(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var RZ=Object.assign({},hc,{className:dt.string,style:dt.object,maxWidth:dt.number,unit:dt.oneOf(["imperial","metric","nautical"])}),FZ=Object.assign({},Ku,{className:"",maxWidth:100,unit:"metric"});function cw(r){var e=qu(r),t=e.context,n=e.containerRef,i=Bt.useState(null),o=as(i,2),s=o[0],c=o[1];Bt.useEffect(function(){if(t.map){var g=new Yc.ScaleControl;g._map=t.map,g._container=n.current,c(g)}},[t.map]),s&&(s.options=r,s._onMove&&s._onMove());var f=Bt.useMemo(function(){return PZ({position:"absolute"},r.style)},[r.style]);return Bt.createElement("div",{style:f,className:r.className},Bt.createElement("div",{ref:n,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}cw.propTypes=RZ;cw.defaultProps=FZ;Bt.memo(cw);Object.assign({},hc,{redraw:dt.func.isRequired});Object.assign({},hc,{redraw:dt.func.isRequired,style:dt.object});Object.assign({},hc,{redraw:dt.func.isRequired,style:dt.object});Yc&&Yc.setRTLTextPlugin;const uI=100;class DZ{constructor(e,t){J(this,"schema");J(this,"options");J(this,"shape");J(this,"length",0);J(this,"rows",null);J(this,"cursor",0);J(this,"_headers",[]);if(this.options=t,this.schema=e,!Array.isArray(e)){this._headers=[];for(const n in e)this._headers[e[n].index]=e[n].name}}rowCount(){return this.length}addArrayRow(e,t){Number.isFinite(t)&&(this.cursor=t),this.shape="array-row-table",this.rows=this.rows||new Array(uI),this.rows[this.length]=e,this.length++}addObjectRow(e,t){Number.isFinite(t)&&(this.cursor=t),this.shape="object-row-table",this.rows=this.rows||new Array(uI),this.rows[this.length]=e,this.length++}getBatch(){let e=this.rows;return e?(e=e.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function OO(r,e){if(!r)throw new Error("null row");const t={};if(e)for(let n=0;n<e.length;n++)t[e[n]]=r[n];else for(let n=0;n<r.length;n++){const i=`column-${n}`;t[i]=r[n]}return t}function LO(r,e){if(!r)throw new Error("null row");if(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=r[e[n]];return t}return Object.values(r)}function OZ(r){const e=[];for(let t=0;t<r.length;t++){const n=`column-${t}`;e.push(n)}return e}function LZ(r){return Object.keys(r)}const fI=100;class NZ{constructor(e,t){J(this,"schema");J(this,"options");J(this,"length",0);J(this,"objectRows",null);J(this,"arrayRows",null);J(this,"cursor",0);J(this,"_headers",null);if(this.options=t,this.schema=e,e){this._headers=[];for(const n in e)this._headers[e[n].index]=e[n].name}}rowCount(){return this.length}addArrayRow(e,t){switch(Number.isFinite(t)&&(this.cursor=t),this._headers||(this._headers=OZ(e)),this.options.shape){case"object-row-table":const n=OO(e,this._headers);this.addObjectRow(n,t);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(fI),this.arrayRows[this.length]=e,this.length++;break}}addObjectRow(e,t){switch(Number.isFinite(t)&&(this.cursor=t),this._headers||(this._headers=LZ(e)),this.options.shape){case"array-row-table":const n=LO(e,this._headers);this.addArrayRow(n,t);break;case"object-row-table":this.objectRows=this.objectRows||new Array(fI),this.objectRows[this.length]=e,this.length++;break}}getBatch(){let e=this.arrayRows||this.objectRows;return e?(e=e.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const kZ=100;class UZ{constructor(e,t){J(this,"schema");J(this,"length",0);J(this,"allocated",0);J(this,"columns",{});this.schema=e,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(e){this._reallocateColumns();let t=0;for(const n in this.columns)this.columns[n][this.length]=e[t++];this.length++}addObjectRow(e){this._reallocateColumns();for(const t in e)this.columns[t][this.length]=e[t];this.length++}getBatch(){this._pruneColumns();const e=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const n in this.schema){const i=this.schema[n];e[i.name]=this.columns[i.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:e,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:kZ,this.columns={};for(const e in this.schema){const t=this.schema[e],n=t.type||Float32Array,i=this.columns[t.index];if(i&&ArrayBuffer.isView(i)){const o=new n(this.allocated);o.set(i),this.columns[t.index]=o}else i?(i.length=this.allocated,this.columns[t.index]=i):this.columns[t.index]=new n(this.allocated)}}}_pruneColumns(){for(const[e,t]of Object.entries(this.columns))this.columns[e]=t.slice(0,this.length)}}const zZ={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},GZ="TableBatchBuilder",$p=class $p{constructor(e,t){J(this,"schema");J(this,"options");J(this,"aggregator",null);J(this,"batchCount",0);J(this,"bytesUsed",0);J(this,"isChunkComplete",!1);J(this,"lastBatchEmittedMs",Date.now());J(this,"totalLength",0);J(this,"totalBytes",0);J(this,"rowBytes",0);this.schema=e,this.options={...zZ,...t}}limitReached(){var e,t;return!!((e=this.options)!=null&&e.limit&&this.totalLength>=this.options.limit||(t=this.options)!=null&&t._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(e){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(e),this.totalBytes+=this.rowBytes,Array.isArray(e)?this.addArrayRow(e):this.addObjectRow(e))}addArrayRow(e){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addArrayRow(e)}addObjectRow(e){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addObjectRow(e)}chunkComplete(e){e instanceof ArrayBuffer&&(this.bytesUsed+=e.byteLength),typeof e=="string"&&(this.bytesUsed+=e.length),this.isChunkComplete=!0}getFullBatch(e){return this._isFull()?this._getBatch(e):null}getFinalBatch(e){return this._getBatch(e)}_estimateRowMB(e){return Array.isArray(e)?e.length*8:Object.keys(e).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(e){if(!this.aggregator)return null;e!=null&&e.bytesUsed&&(this.bytesUsed=e.bytesUsed);const t=this.aggregator.getBatch();return t.count=this.batchCount,t.bytesUsed=this.bytesUsed,Object.assign(t,e),this.batchCount++,this.aggregator=null,t}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return NZ;case"columnar-table":return UZ;case"arrow-table":if(!$p.ArrowBatch)throw new Error(GZ);return $p.ArrowBatch;default:return DZ}}};J($p,"ArrowBatch");let T2=$p;class hI extends Array{enqueue(e){return this.push(e)}dequeue(){return this.shift()}}class VZ{constructor(){J(this,"_values");J(this,"_settlers");J(this,"_closed");this._values=new hI,this._settlers=new hI,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const t=this._settlers.dequeue();e instanceof Error?t.reject(e):t.resolve({value:e})}else this._values.enqueue(e)}next(){if(this._values.length>0){const e=this._values.dequeue();return e instanceof Error?Promise.reject(e):Promise.resolve({value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((e,t)=>{this._settlers.enqueue({resolve:e,reject:t})})}}/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const dI="\uFEFF";function HZ(r,e={},t=JZ){e=e||{};var n=e.dynamicTyping||!1;ic(n)&&(e.dynamicTypingFunction=n,n={}),e.dynamicTyping=n,e.transform=ic(e.transform)?e.transform:!1;var i=new t(e);return i.stream(r)}function jZ(r,e){var t=!1,n=!0,i=",",o=`\r
`,s='"',c=s+s,f=!1,g=null;T();var b=new RegExp(sg(s),"g");if(typeof r=="string"&&(r=JSON.parse(r)),Array.isArray(r)){if(!r.length||Array.isArray(r[0]))return S(null,r,f);if(typeof r[0]=="object")return S(g||Object.keys(r[0]),r,f)}else if(typeof r=="object")return typeof r.data=="string"&&(r.data=JSON.parse(r.data)),Array.isArray(r.data)&&(r.fields||(r.fields=r.meta&&r.meta.fields),r.fields||(r.fields=Array.isArray(r.data[0])?r.fields:Object.keys(r.data[0])),!Array.isArray(r.data[0])&&typeof r.data[0]!="object"&&(r.data=[r.data])),S(r.fields||[],r.data||[],f);throw new Error("Unable to serialize unrecognized input");function T(){if(typeof e=="object"){if(typeof e.delimiter=="string"&&!wa.BAD_DELIMITERS.filter(function(U){return e.delimiter.indexOf(U)!==-1}).length&&(i=e.delimiter),(typeof e.quotes=="boolean"||Array.isArray(e.quotes))&&(t=e.quotes),(typeof e.skipEmptyLines=="boolean"||typeof e.skipEmptyLines=="string")&&(f=e.skipEmptyLines),typeof e.newline=="string"&&(o=e.newline),typeof e.quoteChar=="string"&&(s=e.quoteChar),typeof e.header=="boolean"&&(n=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");g=e.columns}e.escapeChar!==void 0&&(c=e.escapeChar+s)}}function S(U,j,z){var V="";typeof U=="string"&&(U=JSON.parse(U)),typeof j=="string"&&(j=JSON.parse(j));var K=Array.isArray(U)&&U.length>0,fe=!Array.isArray(j[0]);if(K&&n){for(var Q=0;Q<U.length;Q++)Q>0&&(V+=i),V+=F(U[Q],Q);j.length>0&&(V+=o)}for(var oe=0;oe<j.length;oe++){var Te=K?U.length:j[oe].length,ze=!1,Ae=K?Object.keys(j[oe]).length===0:j[oe].length===0;if(z&&!K&&(ze=z==="greedy"?j[oe].join("").trim()==="":j[oe].length===1&&j[oe][0].length===0),z==="greedy"&&K){for(var _e=[],pe=0;pe<Te;pe++){var X=fe?U[pe]:pe;_e.push(j[oe][X])}ze=_e.join("").trim()===""}if(!ze){for(var ne=0;ne<Te;ne++){ne>0&&!Ae&&(V+=i);var Be=K&&fe?U[ne]:ne;V+=F(j[oe][Be],ne)}oe<j.length-1&&(!z||Te>0&&!Ae)&&(V+=o)}}return V}function F(U,j){if(typeof U>"u"||U===null)return"";if(U.constructor===Date)return JSON.stringify(U).slice(1,25);U=U.toString().replace(b,c);var z=typeof t=="boolean"&&t||Array.isArray(t)&&t[j]||k(U,wa.BAD_DELIMITERS)||U.indexOf(i)>-1||U.charAt(0)===" "||U.charAt(U.length-1)===" ";return z?s+U+s:U}function k(U,j){for(var z=0;z<j.length;z++)if(U.indexOf(j[z])>-1)return!0;return!1}}let NO=class{constructor(e){J(this,"_handle");J(this,"_config");J(this,"_finished",!1);J(this,"_completed",!1);J(this,"_input",null);J(this,"_baseIndex",0);J(this,"_partialLine","");J(this,"_rowCount",0);J(this,"_start",0);J(this,"isFirstChunk",!0);J(this,"_completeResults",{data:[],errors:[],meta:{}});var t={...e};t.chunkSize=parseInt(t.chunkSize),!e.step&&!e.chunk&&(t.chunkSize=null),this._handle=new kO(t),this._handle.streamer=this,this._config=t}parseChunk(e,t){if(this.isFirstChunk&&ic(this._config.beforeFirstChunk)){var n=this._config.beforeFirstChunk(e);n!==void 0&&(e=n)}this.isFirstChunk=!1;var i=this._partialLine+e;this._partialLine="";var o=this._handle.parse(i,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var s=o.meta.cursor;this._finished||(this._partialLine=i.substring(s-this._baseIndex),this._baseIndex=s),o&&o.data&&(this._rowCount+=o.data.length);var c=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(ic(this._config.chunk)&&!t){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return;o=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),!this._completed&&c&&ic(this._config.complete)&&(!o||!o.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),o}}_sendError(e){ic(this._config.error)&&this._config.error(e)}};class JZ extends NO{constructor(t={}){super(t);J(this,"remaining")}stream(t){return this.remaining=t,this._nextChunk()}_nextChunk(){if(!this._finished){var t=this._config.chunkSize,n=t?this.remaining.substr(0,t):this.remaining;return this.remaining=t?this.remaining.substr(t):"",this._finished=!this.remaining,this.parseChunk(n)}}}const WZ=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,XZ=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/;class kO{constructor(e){J(this,"_config");J(this,"_stepCounter",0);J(this,"_rowCounter",0);J(this,"_input");J(this,"_parser");J(this,"_paused",!1);J(this,"_aborted",!1);J(this,"_delimiterError",!1);J(this,"_fields",[]);J(this,"_results",{data:[],errors:[],meta:{}});if(ic(e.step)){var t=e.step;e.step=n=>{if(this._results=n,this.needsHeaderRow())this.processResults();else{if(this.processResults(),!this._results.data||this._results.data.length===0)return;this._stepCounter+=n.data.length,e.preview&&this._stepCounter>e.preview?this._parser.abort():t(this._results,this)}}}this._config=e}parse(e,t,n){var i=this._config.quoteChar||'"';if(this._config.newline||(this._config.newline=$Z(e,i)),this._delimiterError=!1,this._config.delimiter)ic(this._config.delimiter)&&(this._config.delimiter=this._config.delimiter(e),this._results.meta.delimiter=this._config.delimiter);else{var o=this.guessDelimiter(e,this._config.newline,this._config.skipEmptyLines,this._config.comments,this._config.delimitersToGuess);o.successful?this._config.delimiter=o.bestDelimiter:(this._delimiterError=!0,this._config.delimiter=wa.DefaultDelimiter),this._results.meta.delimiter=this._config.delimiter}var s=UO(this._config);return this._config.preview&&this._config.header&&s.preview++,this._input=e,this._parser=new B2(s),this._results=this._parser.parse(this._input,t,n),this.processResults(),this._paused?{meta:{paused:!0}}:this._results||{meta:{paused:!1}}}paused(){return this._paused}pause(){this._paused=!0,this._parser.abort(),this._input=this._input.substr(this._parser.getCharIndex())}resume(){this._paused=!1,this.streamer.parseChunk(this._input,!0)}aborted(){return this._aborted}abort(){this._aborted=!0,this._parser.abort(),this._results.meta.aborted=!0,ic(this._config.complete)&&this._config.complete(this._results),this._input=""}testEmptyLine(e){return this._config.skipEmptyLines==="greedy"?e.join("").trim()==="":e.length===1&&e[0].length===0}processResults(){if(this._results&&this._delimiterError&&(this.addError("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+wa.DefaultDelimiter+"'"),this._delimiterError=!1),this._config.skipEmptyLines)for(var e=0;e<this._results.data.length;e++)this.testEmptyLine(this._results.data[e])&&this._results.data.splice(e--,1);return this.needsHeaderRow()&&this.fillHeaderFields(),this.applyHeaderAndDynamicTypingAndTransformation()}needsHeaderRow(){return this._config.header&&this._fields.length===0}fillHeaderFields(){if(!this._results)return;const e=n=>{ic(this._config.transformHeader)&&(n=this._config.transformHeader(n)),this._fields.push(n)};if(Array.isArray(this._results.data[0])){for(var t=0;this.needsHeaderRow()&&t<this._results.data.length;t++)this._results.data[t].forEach(e);this._results.data.splice(0,1)}else this._results.data.forEach(e)}shouldApplyDynamicTyping(e){return this._config.dynamicTypingFunction&&this._config.dynamicTyping[e]===void 0&&(this._config.dynamicTyping[e]=this._config.dynamicTypingFunction(e)),(this._config.dynamicTyping[e]||this._config.dynamicTyping)===!0}parseDynamic(e,t){return this.shouldApplyDynamicTyping(e)?t==="true"||t==="TRUE"?!0:t==="false"||t==="FALSE"?!1:WZ.test(t)?parseFloat(t):XZ.test(t)?new Date(t):t===""?null:t:t}applyHeaderAndDynamicTypingAndTransformation(){if(!this._results||!this._results.data||!this._config.header&&!this._config.dynamicTyping&&!this._config.transform)return this._results;var e=1;return!this._results.data[0]||Array.isArray(this._results.data[0])?(this._results.data=this._results.data.map(this.processRow.bind(this)),e=this._results.data.length):this._results.data=this.processRow(this._results.data,0),this._config.header&&this._results.meta&&(this._results.meta.fields=this._fields),this._rowCounter+=e,this._results}processRow(e,t){var n=this._config.header?{}:[],i;for(i=0;i<e.length;i++){var o=i,s=e[i];this._config.header&&(o=i>=this._fields.length?"__parsed_extra":this._fields[i]),this._config.transform&&(s=this._config.transform(s,o)),s=this.parseDynamic(o,s),o==="__parsed_extra"?(n[o]=n[o]||[],n[o].push(s)):n[o]=s}return this._config.header&&(i>this._fields.length?this.addError("FieldMismatch","TooManyFields","Too many fields: expected "+this._fields.length+" fields but parsed "+i,this._rowCounter+t):i<this._fields.length&&this.addError("FieldMismatch","TooFewFields","Too few fields: expected "+this._fields.length+" fields but parsed "+i,this._rowCounter+t)),n}guessDelimiter(e,t,n,i,o){var s,c,f;o=o||[",","	","|",";",wa.RECORD_SEP,wa.UNIT_SEP];for(var g=0;g<o.length;g++){var b=o[g],T=0,S=0,F=0;f=void 0;for(var k=new B2({comments:i,delimiter:b,newline:t,preview:10}).parse(e),U=0;U<k.data.length;U++){if(n&&this.testEmptyLine(k.data[U])){F++;continue}var j=k.data[U].length;if(S+=j,typeof f>"u"){f=0;continue}else j>1&&(T+=Math.abs(j-f),f=j)}k.data.length>0&&(S/=k.data.length-F),(typeof c>"u"||T>c)&&S>1.99&&(c=T,s=b)}return this._config.delimiter=s,{successful:!!s,bestDelimiter:s}}addError(e,t,n,i){this._results.errors.push({type:e,code:t,message:n,row:i})}}function $Z(r,e){r=r.substr(0,1024*1024);var t=new RegExp(sg(e)+"([^]*?)"+sg(e),"gm");r=r.replace(t,"");var n=r.split("\r"),i=r.split(`
`),o=i.length>1&&i[0].length<n[0].length;if(n.length===1||o)return`
`;for(var s=0,c=0;c<n.length;c++)n[c][0]===`
`&&s++;return s>=n.length/2?`\r
`:"\r"}function sg(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function B2(r){r=r||{};var e=r.delimiter,t=r.newline,n=r.comments,i=r.step,o=r.preview,s=r.fastMode,c;r.quoteChar===void 0?c='"':c=r.quoteChar;var f=c;if(r.escapeChar!==void 0&&(f=r.escapeChar),(typeof e!="string"||wa.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),n===e)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||wa.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),t!==`
`&&t!=="\r"&&t!==`\r
`&&(t=`
`);var g=0,b=!1;this.parse=function(T,S,F){if(typeof T!="string")throw new Error("Input must be a string");var k=T.length,U=e.length,j=t.length,z=n.length,V=ic(i);g=0;var K=[],fe=[],Q=[],oe=0;if(!T)return tt();if(s||s!==!1&&T.indexOf(c)===-1){for(var Te=T.split(t),ze=0;ze<Te.length;ze++){const mt=Te[ze];if(g+=mt.length,ze!==Te.length-1)g+=t.length;else if(F)return tt();if(!(n&&mt.substr(0,z)===n)){if(V){if(K=[],Ne(mt.split(e)),lt(),b)return tt()}else Ne(mt.split(e));if(o&&ze>=o)return K=K.slice(0,o),tt(!0)}}return tt()}for(var Ae=T.indexOf(e,g),_e=T.indexOf(t,g),pe=new RegExp(sg(f)+sg(c),"g"),X;;){if(T[g]===c){for(X=g,g++;;){if(X=T.indexOf(c,X+1),X===-1)return F||fe.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:K.length,index:g}),Qe();if(X===k-1){var ne=T.substring(g,X).replace(pe,c);return Qe(ne)}if(c===f&&T[X+1]===f){X++;continue}if(!(c!==f&&X!==0&&T[X-1]===f)){var Be=_e===-1?Ae:Math.min(Ae,_e),Ze=Ge(Be);if(T[X+1+Ze]===e){if(Q.push(T.substring(g,X).replace(pe,c)),g=X+1+Ze+U,Ae=T.indexOf(e,g),_e=T.indexOf(t,g),V&&(lt(),b))return tt();if(o&&K.length>=o)return tt(!0);break}var Ce=Ge(_e);if(T.substr(X+1+Ce,j)===t){if(Q.push(T.substring(g,X).replace(pe,c)),rt(X+1+Ce+j),Ae=T.indexOf(e,g),V&&(lt(),b))return tt();if(o&&K.length>=o)return tt(!0);break}fe.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:K.length,index:g}),X++}}if(V&&(lt(),b))return tt();if(o&&K.length>=o)return tt(!0);continue}if(n&&Q.length===0&&T.substr(g,z)===n){if(_e===-1)return tt();g=_e+j,_e=T.indexOf(t,g),Ae=T.indexOf(e,g);continue}if(Ae!==-1&&(Ae<_e||_e===-1)){Q.push(T.substring(g,Ae)),g=Ae+U,Ae=T.indexOf(e,g);continue}if(_e!==-1){if(Q.push(T.substring(g,_e)),rt(_e+j),V&&(lt(),b))return tt();if(o&&K.length>=o)return tt(!0);continue}break}return Qe();function Ne(mt){K.push(mt),oe=g}function Ge(mt){var Tt=0;if(mt!==-1){var nt=T.substring(X+1,mt);nt&&nt.trim()===""&&(Tt=nt.length)}return Tt}function Qe(mt){return F||(typeof mt>"u"&&(mt=T.substr(g)),Q.push(mt),g=k,Ne(Q),V&&lt()),tt()}function rt(mt){g=mt,Ne(Q),Q=[],_e=T.indexOf(t,g)}function tt(mt,Tt){var nt=Tt||!1;return{data:nt?K[0]:K,errors:fe,meta:{delimiter:e,linebreak:t,aborted:b,truncated:!!mt,cursor:oe+(S||0)}}}function lt(){i(tt(void 0,!0)),K=[],fe=[]}},this.abort=function(){b=!0},this.getCharIndex=function(){return g}}function UO(r){if(typeof r!="object"||r===null)return r;var e=Array.isArray(r)?[]:{};for(var t in r)e[t]=UO(r[t]);return e}function ic(r){return typeof r=="function"}const wa={parse:HZ,unparse:jZ,RECORD_SEP:"",UNIT_SEP:"",BYTE_ORDER_MARK:dI,BAD_DELIMITERS:["\r",`
`,'"',dI],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:B2,ParserHandle:kO,ChunkStreamer:NO},{ChunkStreamer:KZ}=wa;class qZ extends KZ{constructor(t={}){super(t);J(this,"textDecoder",new TextDecoder(this._config.encoding))}async stream(t){this._input=t;try{for await(const n of t)this.parseChunk(this.getStringChunk(n));this._finished=!0,this.parseChunk("")}catch(n){this._sendError(n)}}_nextChunk(){}getStringChunk(t){return typeof t=="string"?t:this.textDecoder.decode(t,{stream:!0})}}const ZZ="4.3.2",lw="object-row-table",uw={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:ZZ,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(r,e)=>AI(new TextDecoder().decode(r),e),parseText:(r,e)=>AI(r,e),parseInBatches:YZ,options:{csv:{shape:lw,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function AI(r,e){const t={...uw.options.csv,...e==null?void 0:e.csv},n=QZ(r),o=t.header==="auto"?zO(n):!!t.header,s={...t,header:o,download:!1,transformHeader:o?GO():void 0,error:T=>{throw new Error(T)}},c=wa.parse(r,s),f=c.data,g=c.meta.fields||VO(t.columnPrefix,n.length),b=t.shape||lw;switch(b){case"object-row-table":return{shape:"object-row-table",data:f.map(T=>Array.isArray(T)?OO(T,g):T)};case"array-row-table":return{shape:"array-row-table",data:f.map(T=>Array.isArray(T)?T:LO(T,g))};default:throw new Error(b)}}function YZ(r,e){e={...e},e.batchSize==="auto"&&(e.batchSize=4e3);const t={...uw.options.csv,...e==null?void 0:e.csv},n=new VZ;let i=!0,o=null,s=null,c=null;const f={...t,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(g){let b=g.data;if(t.skipEmptyLines&&b.flat().join("").trim()==="")return;const T=g.meta.cursor;if(i&&!o&&(t.header==="auto"?zO(b):!!t.header)){o=b.map(GO());return}i&&(i=!1,o||(o=VO(t.columnPrefix,b.length)),c=eY(b,o)),t.optimizeMemoryUsage&&(b=JSON.parse(JSON.stringify(b)));const S=t.shape||lw;s=s||new T2(c,{shape:S,...e});try{s.addRow(b);const F=s&&s.getFullBatch({bytesUsed:T});F&&n.enqueue(F)}catch(F){n.enqueue(F)}},complete(g){try{const b=g.meta.cursor,T=s&&s.getFinalBatch({bytesUsed:b});T&&n.enqueue(T)}catch(b){n.enqueue(b)}n.close()}};return wa.parse(r,f,qZ),n}function zO(r){return r&&r.every(e=>typeof e=="string")}function QZ(r){return wa.parse(r,{dynamicTyping:!0,preview:1}).data[0]}function GO(){const r=new Set;return e=>{let t=e,n=1;for(;r.has(t);)t=`${e}.${n}`,n++;return r.add(t),t}}function VO(r,e=0){const t=[];for(let n=0;n<e;n++)t.push(`${r}${n+1}`);return t}function eY(r,e){const t=e?{}:[];for(let n=0;n<r.length;n++){const i=e&&e[n]||n;switch(typeof r[n]){case"number":case"boolean":t[i]={name:String(i),index:n,type:Float32Array};break;case"string":default:t[i]={name:String(i),index:n,type:Array}}}return t}const tY="4.3.2";async function HO(r,e,t,n){return n._parse(r,e,t,n)}function qf(r,e){if(!r)throw new Error("loader assertion failed.")}const jO=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),pI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);pI&&parseFloat(pI[1]);function rY(r){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,r)}function nY(r){var t,n;return((n=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:n[r])||null}function iY(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const sY=iY();function oY(r,e){if(!r)throw new Error("loaders.gl assertion failed.")}const _g=typeof process!="object"||String(process)!=="[object process]"||process.browser,fw=typeof importScripts=="function",gI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);gI&&parseFloat(gI[1]);const n1={};async function Xf(r,e=null,t={},n=null){return e&&(r=aY(r,e,t,n)),n1[r]=n1[r]||cY(r),await n1[r]}function aY(r,e,t={},n=null){if(!t.useLocalLibraries&&r.startsWith("http"))return r;n=n||r;const i=t.modules||{};return i[n]?i[n]:_g?t.CDN?(oY(t.CDN.startsWith("http")),`${t.CDN}/${e}@${sY}/dist/libs/${n}`):fw?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function cY(r){if(r.endsWith("wasm"))return await uY(r);if(!_g)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(r))}catch(t){return console.error(t),null}if(fw)return importScripts(r);const e=await fY(r);return lY(e,r)}function lY(r,e){if(!_g){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(r,e)}if(fw)return eval.call(globalThis,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function uY(r){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return _g||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function fY(r){const{readFileAsText:e}=globalThis.loaders||{};return _g||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}function hY(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?mI(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?mI(r,0,e):""}function mI(r,e,t){if(r.byteLength<=e+t)return"";const n=new DataView(r);let i="";for(let o=0;o<t;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}function dY(r){try{return JSON.parse(r)}catch{throw new Error(`Failed to parse JSON from data starting with "${hY(r)}"`)}}function JO(r,e,t){const n=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(n).buffer}function yg(r,e){return qf(r>=0),qf(e>0),r+(e-1)&-4}function AY(r,e,t){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,o=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,o)}return e.set(n,t),t+yg(n.byteLength,4)}var NR;const pY=(NR=globalThis.loaders)==null?void 0:NR.parseImageNode,S2=typeof Image<"u",I2=typeof ImageBitmap<"u",gY=!!pY,M2=jO?!0:gY;function mY(r){switch(r){case"auto":return I2||S2||M2;case"imagebitmap":return I2;case"image":return S2;case"data":return M2;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function _Y(){if(I2)return"imagebitmap";if(S2)return"image";if(M2)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function yY(r){const e=vY(r);if(!e)throw new Error("Not an image");return e}function WO(r){switch(yY(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function vY(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const bY=/^data:image\/svg\+xml/,xY=/\.svg((\?|#).*)?$/;function hw(r){return r&&(bY.test(r)||xY.test(r))}function wY(r,e){if(hw(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return XO(r,e)}function XO(r,e){if(hw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function $O(r,e,t){const n=wY(r,t),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await CY(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function CY(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const EY={};let _I=!0;async function TY(r,e,t){let n;hw(t)?n=await $O(r,e,t):n=XO(r,t);const i=e&&e.imagebitmap;return await BY(n,i)}async function BY(r,e=null){if((SY(e)||!_I)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),_I=!1}return await createImageBitmap(r)}function SY(r){for(const e in r||EY)return!1;return!0}function IY(r){return!FY(r,"ftyp",4)||!(r[8]&96)?null:MY(r)}function MY(r){switch(PY(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function PY(r,e,t){return String.fromCharCode(...r.slice(e,t))}function RY(r){return[...r].map(e=>e.charCodeAt(0))}function FY(r,e,t=0){const n=RY(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const jc=!1,Vp=!0;function dw(r){const e=vg(r);return OY(e)||kY(e)||LY(e)||NY(e)||DY(e)}function DY(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=IY(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function OY(r){const e=vg(r);return e.byteLength>=24&&e.getUint32(0,jc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,jc),height:e.getUint32(20,jc)}:null}function LY(r){const e=vg(r);return e.byteLength>=10&&e.getUint32(0,jc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Vp),height:e.getUint16(8,Vp)}:null}function NY(r){const e=vg(r);return e.byteLength>=14&&e.getUint16(0,jc)===16973&&e.getUint32(2,Vp)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Vp),height:e.getUint32(22,Vp)}:null}function kY(r){const e=vg(r);if(!(e.byteLength>=3&&e.getUint16(0,jc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=UY();let o=2;for(;o+9<e.byteLength;){const s=e.getUint16(o,jc);if(i.has(s))return{mimeType:"image/jpeg",height:e.getUint16(o+5,jc),width:e.getUint16(o+7,jc)};if(!n.has(s))return null;o+=2,o+=e.getUint16(o,jc)}return null}function UY(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function vg(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function zY(r,e){var i;const{mimeType:t}=dw(r)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return qf(n),await n(r,t)}async function GY(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=t||{},s=VY(i);let c;switch(s){case"imagebitmap":c=await TY(r,e,o);break;case"image":c=await $O(r,e,o);break;case"data":c=await zY(r);break;default:qf(!1)}return i==="data"&&(c=WO(c)),c}function VY(r){switch(r){case"auto":case"data":return _Y();default:return mY(r),r}}const HY=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],jY=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],JY={image:{type:"auto",decode:!0}},WY={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:tY,mimeTypes:jY,extensions:HY,parse:GY,tests:[r=>!!dw(new DataView(r))],options:JY},i1={};function XY(r){if(i1[r]===void 0){const e=jO?KY(r):$Y(r);i1[r]=e}return i1[r]}function $Y(r){var i,o;const e=["image/png","image/jpeg","image/gif"],t=((i=globalThis.loaders)==null?void 0:i.imageFormatsNode)||e;return!!((o=globalThis.loaders)==null?void 0:o.parseImageNode)&&t.includes(r)}function KY(r){switch(r){case"image/avif":case"image/webp":return qY(r);default:return!0}}function qY(r){try{return document.createElement("canvas").toDataURL(r).indexOf(`data:${r}`)===0}catch{return!1}}function Ca(r,e){if(!r)throw new Error(e||"assert failed: gltf")}const KO={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qO={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},yI=["SCALAR","VEC2","VEC3","VEC4"],ZY=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],YY=new Map(ZY),QY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},eQ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},tQ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function ZO(r){return yI[r-1]||yI[0]}function ty(r){const e=YY.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function YO(r,e){const t=tQ[r.componentType],n=QY[r.type],i=eQ[r.componentType],o=r.count*n,s=r.count*n*i;Ca(s>=0&&s<=e.byteLength);const c=qO[r.componentType],f=KO[r.type];return{ArrayType:t,length:o,byteLength:s,componentByteSize:c,numberOfComponentsInElement:f}}function rQ(r,e,t){const n=r.bufferViews[t];Ca(n);const i=n.buffer,o=e[i];Ca(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function nQ(r,e,t){var U,j;const n=typeof t=="number"?(U=r.accessors)==null?void 0:U[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(j=r.bufferViews)==null?void 0:j[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],c=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:f,length:g,componentByteSize:b,numberOfComponentsInElement:T}=YO(n,i),S=b*T,F=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new f(o,c,g);const k=new f(g);for(let z=0;z<n.count;z++){const V=new f(o,c+z*F,T);k.set(V,z*T)}return k}function iQ(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let Bs=class{constructor(e){J(this,"gltf");J(this,"sourceBuffers");J(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||iQ(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];Ca(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return nQ(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(i,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e,t={}){return Ca(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Ca(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:o=4}=e,c={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(n){const f=this._addIndices(n);c.primitives[0].indices=f}return Number.isFinite(i)&&(c.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=dw(e),i=t||(n==null?void 0:n.mimeType),s={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const i=e.byteLength;Ca(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=yg(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:ZO(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:ty(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var o,s;const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const c of this.sourceBuffers||[])i=AY(c,n,i);(s=(o=this.json)==null?void 0:o.buffers)!=null&&s[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const i=e[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);t[o]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const o of i)n.min.push(o),n.max.push(o);for(let o=t;o<e.length;o+=t)for(let s=0;s<t;s++)n.min[0+s]=Math.min(n.min[0+s],e[o+s]),n.max[0+s]=Math.max(n.max[0+s],e[o+s]);return n}};function vI(r){return(r%1+1)%1}const QO={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},sQ={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},e6={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Aw(r,e){return e6[e]*QO[r]}function ry(r,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=r.getTypedArrayForBufferView(e),o=ny(i,"SCALAR",t,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function ny(r,e,t,n=1){const i=QO[e],o=sQ[t],s=e6[t],c=n*i,f=c*s;let g=r.buffer,b=r.byteOffset;return b%s!==0&&(g=new Uint8Array(g).slice(b,b+f).buffer,b=0),new o(g,b,c)}function pw(r,e,t){var g,b,T,S,F;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],o=r.getTypedArrayForAccessor(i),s=r.gltf.json,c=e.index,f=(b=(g=s.textures)==null?void 0:g[c])==null?void 0:b.source;if(typeof f<"u"){const k=(S=(T=s.images)==null?void 0:T[f])==null?void 0:S.mimeType,U=(F=r.gltf.images)==null?void 0:F[f];if(U&&typeof U.width<"u"){const j=[];for(let z=0;z<o.length;z+=2){const V=oQ(U,k,o,z,e.channels);j.push(V)}return j}}return[]}function t6(r,e,t,n,i){if(!(t!=null&&t.length))return;const o=[];for(const b of t){let T=n.findIndex(S=>S===b);T===-1&&(T=n.push(b)-1),o.push(T)}const s=new Uint32Array(o),c=r.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,f=r.addBufferView(s,c,0),g=r.addAccessor(f,{size:1,componentType:ty(s),count:s.length});i.attributes[e]=g}function oQ(r,e,t,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=t[n],c=t[n+1];let f=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(f=4);const g=aQ(s,c,r,f);let b=0;for(const T of i){const S=typeof T=="number"?Object.values(o)[T]:o[T],F=g+S.offset,k=WO(r);if(k.data.length<=F)throw new Error(`${k.data.length} <= ${F}`);const U=k.data[F];b|=U<<S.shift}return b}function aQ(r,e,t,n=1){const i=t.width,o=vI(r)*(i-1),s=Math.round(o),c=t.height,f=vI(e)*(c-1),g=Math.round(f),b=t.components?t.components:n;return(g*i+s)*b}function r6(r,e,t,n,i){const o=[];for(let s=0;s<e;s++){const c=t[s],f=t[s+1]-t[s];if(f+c>n)break;const g=c/i,b=f/i;o.push(r.slice(g,g+b))}return o}function n6(r,e,t){const n=[];for(let i=0;i<e;i++){const o=i*t;n.push(r.slice(o,o+t))}return n}function i6(r,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let c=0;c<r;c++){const f=n[c+1]-n[c];if(f+s<=e.length){const g=e.subarray(s,f+s),b=o.decode(g);i.push(b),s+=f}}return i}return[]}const qd="EXT_mesh_features",cQ=qd;async function lQ(r,e){const t=new Bs(r);fQ(t,e)}function uQ(r,e){const t=new Bs(r);return dQ(t),t.createBinaryChunk(),t.gltf}function fQ(r,e){const t=r.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)hQ(r,i,e)}function hQ(r,e,t){var o,s,c;if(!((o=t==null?void 0:t.gltf)!=null&&o.loadBuffers))return;const n=(s=e.extensions)==null?void 0:s[qd],i=n==null?void 0:n.featureIds;if(i)for(const f of i){let g;if(typeof f.attribute<"u"){const b=`_FEATURE_ID_${f.attribute}`,T=e.attributes[b];g=r.getTypedArrayForAccessor(T)}else typeof f.texture<"u"&&((c=t==null?void 0:t.gltf)!=null&&c.loadImages)?g=pw(r,f.texture,e):g=[];f.data=g}}function dQ(r,e){const t=r.gltf.json.meshes;if(t)for(const n of t)for(const i of n.primitives)pQ(r,i)}function AQ(r,e,t,n){e.extensions||(e.extensions={});let i=e.extensions[qd];i||(i={featureIds:[]},e.extensions[qd]=i);const{featureIds:o}=i,s={featureCount:t.length,propertyTable:n,data:t};o.push(s),r.addObjectExtension(e,qd,i)}function pQ(r,e){var i;const t=(i=e.extensions)==null?void 0:i[qd];if(!t)return;const n=t.featureIds;n.forEach((o,s)=>{if(o.data){const{accessorKey:c,index:f}=gQ(e.attributes),g=new Uint32Array(o.data);n[s]={featureCount:g.length,propertyTable:o.propertyTable,attribute:f},r.gltf.buffers.push({arrayBuffer:g.buffer,byteOffset:g.byteOffset,byteLength:g.byteLength});const b=r.addBufferView(g),T=r.addAccessor(b,{size:1,componentType:ty(g),count:g.length});e.attributes[c]=T}})}function gQ(r){const e="_FEATURE_ID_",t=Object.keys(r).filter(o=>o.indexOf(e)===0);let n=-1;for(const o of t){const s=Number(o.substring(e.length));s>n&&(n=s)}return n++,{accessorKey:`${e}${n}`,index:n}}const mQ=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:AQ,decode:lQ,encode:uQ,name:cQ},Symbol.toStringTag,{value:"Module"})),fA="EXT_structural_metadata",_Q=fA;async function yQ(r,e){const t=new Bs(r);bQ(t,e)}function vQ(r,e){const t=new Bs(r);return NQ(t),t.createBinaryChunk(),t.gltf}function bQ(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(fA);t&&((i=e.gltf)!=null&&i.loadImages&&xQ(r,t),wQ(r,t))}function xQ(r,e){const t=e.propertyTextures,n=r.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)EQ(r,t,o,e)}function wQ(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=CQ(i,o);s&&BQ(r,t,s)}}function CQ(r,e){for(const t of r)if(t.class===e)return t;return null}function EQ(r,e,t,n){var s;if(!e)return;const i=(s=t.extensions)==null?void 0:s[fA],o=i==null?void 0:i.propertyTextures;if(o)for(const c of o){const f=e[c];TQ(r,f,t,n)}}function TQ(r,e,t,n){var o;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const s in e.properties){const c=`${i}_${s}`,f=(o=e.properties)==null?void 0:o[s];if(!f)continue;f.data||(f.data=[]);const g=f.data,b=pw(r,f,t);b!==null&&(t6(r,c,b,g,t),f.data=g,n.dataAttributeNames.push(c))}}function BQ(r,e,t){var o,s;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],g=(s=t.properties)==null?void 0:s[c];if(g){const b=SQ(r,e,f,i,g);g.data=b}}}function SQ(r,e,t,n,i){let o=[];const s=i.values,c=r.getTypedArrayForBufferView(s),f=IQ(r,t,i,n),g=MQ(r,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=PQ(t,n,c,f);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{o=i6(n,c,f,g);break}case"ENUM":{o=RQ(e,t,n,c,f);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return o}function IQ(r,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?ry(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function MQ(r,e,t){return typeof e.stringOffsets<"u"?ry(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function PQ(r,e,t,n){const i=r.array,o=r.count,s=Aw(r.type,r.componentType),c=t.byteLength/s;let f;return r.componentType?f=ny(t,r.type,r.componentType,c):f=t,i?n?r6(f,e,n,t.length,s):o?n6(f,e,o):[]:f}function RQ(r,e,t,n,i){var T;const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=(T=r.enums)==null?void 0:T[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const c=s.valueType||"UINT16",f=Aw(e.type,c),g=n.byteLength/f;let b=ny(n,e.type,c,g);if(b||(b=n),e.array){if(i)return FQ({valuesData:b,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:f,enumEntry:s});const S=e.count;return S?DQ(b,t,S,s):[]}return gw(b,0,t,s)}function FQ(r){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=r,c=[];for(let f=0;f<t;f++){const g=n[f],b=n[f+1]-n[f];if(b+g>i)break;const T=g/o,S=b/o,F=gw(e,T,S,s);c.push(F)}return c}function DQ(r,e,t,n){const i=[];for(let o=0;o<e;o++){const s=t*o,c=gw(r,s,t,n);i.push(c)}return i}function gw(r,e,t,n){const i=[];for(let o=0;o<t;o++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)i.push("");else{const s=r[e+o],c=OQ(n,s);c?i.push(c.name):i.push("")}return i}function OQ(r,e){for(const t of r.values)if(t.value===e)return t;return null}const LQ="schemaClassId";function NQ(r,e){var n,i;const t=r.getExtension(fA);if(t&&t.propertyTables)for(const o of t.propertyTables){const s=o.class,c=(i=(n=t.schema)==null?void 0:n.classes)==null?void 0:i[s];o.properties&&c&&kQ(o,c,r)}}function kQ(r,e,t){for(const n in r.properties){const i=r.properties[n].data;if(i){const o=e.properties[n];if(o){const s=VQ(i,o,t);r.properties[n]=s}}}}function UQ(r,e,t=LQ){let n=r.getExtension(fA);n||(n=r.addExtension(fA)),n.schema=zQ(e,t,n.schema);const i=GQ(e,t,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function zQ(r,e,t){const n=t??{id:"schema_id"},i={properties:{}};for(const o of r){const s={type:o.elementType,componentType:o.componentType};i.properties[o.name]=s}return n.classes={},n.classes[e]=i,n}function GQ(r,e,t){var s;const n={class:e,count:0};let i=0;const o=(s=t.classes)==null?void 0:s[e];for(const c of r){if(i===0&&(i=c.values.length),i!==c.values.length&&c.values.length)throw new Error("Illegal values in attributes");(o==null?void 0:o.properties[c.name])&&(n.properties||(n.properties={}),n.properties[c.name]={values:0,data:c.values})}return n.count=i,n}function VQ(r,e,t){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:o}=JQ(r);n.stringOffsets=s1(o,t),n.values=s1(i,t)}else if(e.type==="SCALAR"&&e.componentType){const i=jQ(r,e.componentType);n.values=s1(i,t)}return n}const HQ={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function jQ(r,e){const t=[];for(const i of r)t.push(Number(i));const n=HQ[e];if(!n)throw new Error("Illegal component type");return new n(t)}function JQ(r){const e=new TextEncoder,t=[];let n=0;for(const f of r){const g=e.encode(f);n+=g.length,t.push(g)}const i=new Uint8Array(n),o=[];let s=0;for(const f of t)i.set(f,s),o.push(s),s+=f.length;o.push(s);const c=new Uint32Array(o);return{stringData:i,stringOffsets:c}}function s1(r,e){return e.gltf.buffers.push({arrayBuffer:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}),e.addBufferView(r)}const WQ=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:UQ,decode:yQ,encode:vQ,name:_Q},Symbol.toStringTag,{value:"Module"})),s6="EXT_feature_metadata",XQ=s6;async function $Q(r,e){const t=new Bs(r);KQ(t,e)}function KQ(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(s6);t&&((i=e.gltf)!=null&&i.loadImages&&qQ(r,t),ZQ(r,t))}function qQ(r,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],c=QQ(i,o);c&&tee(r,c,s)}}function ZQ(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=YQ(i,o);s&&eee(r,t,s)}}function YQ(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function QQ(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function eee(r,e,t){var o,s;if(!t.class)return;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],g=(s=t.properties)==null?void 0:s[c];if(g){const b=ree(r,e,f,i,g);g.data=b}}}function tee(r,e,t){var i;const n=e.class;for(const o in t.properties){const s=(i=e==null?void 0:e.properties)==null?void 0:i[o];if(s){const c=aee(r,s,n);s.data=c}}}function ree(r,e,t,n,i){let o=[];const s=i.bufferView,c=r.getTypedArrayForBufferView(s),f=nee(r,t,i,n),g=iee(r,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?o=i6(n,c,f,g):see(t)&&(o=oee(t,n,c,f)),o}function nee(r,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?ry(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function iee(r,e,t,n){return typeof t.stringOffsetBufferView<"u"?ry(r,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function see(r){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function oee(r,e,t,n){const i=r.type==="ARRAY",o=r.componentCount,s="SCALAR",c=r.componentType||r.type,f=Aw(s,c),g=t.byteLength/f,b=ny(t,s,c,g);return i?n?r6(b,e,n,t.length,f):o?n6(b,e,o):[]:b}function aee(r,e,t){const n=r.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)cee(r,t,e,i,s);return i}function cee(r,e,t,n,i){const o={channels:t.channels,...t.texture},s=pw(r,o,i);s&&t6(r,e,s,n,i)}const lee=Object.freeze(Object.defineProperty({__proto__:null,decode:$Q,name:XQ},Symbol.toStringTag,{value:"Module"})),uee="4.3.2",fee="4.3.2",s_={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let bI;async function xI(r){rY(r.modules);const e=nY("basis");return e||(bI||(bI=hee(r)),await bI)}async function hee(r){let e=null,t=null;return[e,t]=await Promise.all([await Xf(s_.TRANSCODER,"textures",r),await Xf(s_.TRANSCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await dee(e,t)}function dee(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:o,initializeBasis:s}=i;s(),n({BasisFile:o})})})}let o1;async function wI(r){const e=r.modules||{};return e.basisEncoder?e.basisEncoder:(o1=o1||Aee(r),await o1)}async function Aee(r){let e=null,t=null;return[e,t]=await Promise.all([await Xf(s_.ENCODER,"textures",r),await Xf(s_.ENCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await pee(e,t)}function pee(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:o,KTX2File:s,initializeBasis:c,BasisEncoder:f}=i;c(),n({BasisFile:o,KTX2File:s,BasisEncoder:f})})})}const cd={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},gee=["","WEBKIT_","MOZ_"],CI={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let D0=null;function mee(r){if(!D0){r=r||_ee()||void 0,D0=new Set;for(const e of gee)for(const t in CI)if(r&&r.getExtension(`${e}${t}`)){const n=CI[t];D0.add(n)}}return D0}function _ee(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Zo=[171,75,84,88,32,50,48,187,13,10,26,10];function yee(r){const e=new Uint8Array(r);return!(e.byteLength<Zo.length||e[0]!==Zo[0]||e[1]!==Zo[1]||e[2]!==Zo[2]||e[3]!==Zo[3]||e[4]!==Zo[4]||e[5]!==Zo[5]||e[6]!==Zo[6]||e[7]!==Zo[7]||e[8]!==Zo[8]||e[9]!==Zo[9]||e[10]!==Zo[10]||e[11]!==Zo[11])}const vee={etc1:{basisFormat:0,compressed:!0,format:cd.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:cd.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:cd.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:cd.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:cd.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:cd.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function bee(r,e){if(e.basis.containerFormat==="auto"){if(yee(r)){const n=await wI(e);return EI(n.KTX2File,r,e)}const{BasisFile:t}=await xI(e);return a1(t,r,e)}switch(e.basis.module){case"encoder":const t=await wI(e);switch(e.basis.containerFormat){case"ktx2":return EI(t.KTX2File,r,e);case"basis":default:return a1(t.BasisFile,r,e)}case"transcoder":default:const{BasisFile:n}=await xI(e);return a1(n,r,e)}}function a1(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),o=[];for(let s=0;s<i;s++){const c=n.getNumLevels(s),f=[];for(let g=0;g<c;g++)f.push(xee(n,s,g,t));o.push(f)}return o}finally{n.close(),n.delete()}}function xee(r,e,t,n){const i=r.getImageWidth(e,t),o=r.getImageHeight(e,t),s=r.getHasAlpha(),{compressed:c,format:f,basisFormat:g}=o6(n,s),b=r.getImageTranscodedSizeInBytes(e,t,g),T=new Uint8Array(b);if(!r.transcodeImage(T,e,t,g,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:o,data:T,compressed:c,format:f,hasAlpha:s}}function EI(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),o=[];for(let s=0;s<i;s++)o.push(wee(n,s,t));return[o]}finally{n.close(),n.delete()}}function wee(r,e,t){const{alphaFlag:n,height:i,width:o}=r.getImageLevelInfo(e,0,0),{compressed:s,format:c,basisFormat:f}=o6(t,n),g=r.getImageTranscodedSizeInBytes(e,0,0,f),b=new Uint8Array(g);if(!r.transcodeImage(b,e,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:i,data:b,compressed:s,levelSize:g,hasAlpha:n,format:c}}function o6(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=a6()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),vee[t]}function a6(){const r=mee();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const Cee={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:fee,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Eee={...Cee,parse:bee},hA=!0,TI=1735152710,mw=12,o_=8,Tee=1313821514,Bee=5130562,See=0,Iee=0,Mee=1;function Pee(r,e=0){return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function Ree(r,e=0,t={}){const n=new DataView(r),{magic:i=TI}=t,o=n.getUint32(e,!1);return o===i||o===TI}function Fee(r,e,t=0,n={}){const i=new DataView(e),o=Pee(i,t+0),s=i.getUint32(t+4,hA),c=i.getUint32(t+8,hA);switch(Object.assign(r,{header:{byteOffset:t,byteLength:c,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),t+=mw,r.version){case 1:return Dee(r,i,t);case 2:return Oee(r,i,t,n={});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function Dee(r,e,t){qf(r.header.byteLength>mw+o_);const n=e.getUint32(t+0,hA),i=e.getUint32(t+4,hA);return t+=o_,qf(i===See),P2(r,e,t,n),t+=n,t+=R2(r,e,t,r.header.byteLength),t}function Oee(r,e,t,n){return qf(r.header.byteLength>mw+o_),Lee(r,e,t,n),t+r.header.byteLength}function Lee(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,hA),o=e.getUint32(t+4,hA);switch(t+=o_,o){case Tee:P2(r,e,t,i);break;case Bee:R2(r,e,t,i);break;case Iee:n.strict||P2(r,e,t,i);break;case Mee:n.strict||R2(r,e,t,i);break}t+=yg(i,4)}return t}function P2(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),s=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(s),yg(n,4)}function R2(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),yg(n,4)}function c6(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return n.substr(0,n.lastIndexOf("/")+1)+r}const Nee="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",kee="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Uee=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),zee=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Gee={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Vee={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Hee(r,e,t,n,i,o="NONE"){const s=await jee();Xee(s,s.exports[Vee[i]],r,e,t,n,s.exports[Gee[o||"NONE"]])}let c1;async function jee(){return c1||(c1=Jee()),c1}async function Jee(){let r=Nee;WebAssembly.validate(Uee)&&(r=kee,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(Wee(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function Wee(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?zee[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function Xee(r,e,t,n,i,o,s){const c=r.exports.sbrk,f=n+3&-4,g=c(f*i),b=c(o.length),T=new Uint8Array(r.exports.memory.buffer);T.set(o,b);const S=e(g,n,i,b,o.length);if(S===0&&s&&s(g,f,i),t.set(T.subarray(g,g+n*i)),c(g-c(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const a_="EXT_meshopt_compression",$ee=a_;async function Kee(r,e){var i,o;const t=new Bs(r);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((o=e.gltf)!=null&&o.loadBuffers))return;const n=[];for(const s of r.json.bufferViews||[])n.push(qee(t,s));await Promise.all(n),t.removeExtension(a_)}async function qee(r,e){const t=r.getObjectExtension(e,a_);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:c,filter:f="NONE",buffer:g}=t,b=r.gltf.buffers[g],T=new Uint8Array(b.arrayBuffer,b.byteOffset+n,i),S=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Hee(S,s,o,T,c,f),r.removeObjectExtension(e,a_)}}const Zee=Object.freeze(Object.defineProperty({__proto__:null,decode:Kee,name:$ee},Symbol.toStringTag,{value:"Module"})),Td="EXT_texture_webp",Yee=Td;function Qee(r,e){const t=new Bs(r);if(!XY("image/webp")){if(t.getRequiredExtensions().includes(Td))throw new Error(`gltf: Required extension ${Td} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Td);o&&(i.source=o.source),t.removeObjectExtension(i,Td)}t.removeExtension(Td)}const ete=Object.freeze(Object.defineProperty({__proto__:null,name:Yee,preprocess:Qee},Symbol.toStringTag,{value:"Module"})),bm="KHR_texture_basisu",tte=bm;function rte(r,e){const t=new Bs(r),{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,bm);o&&(i.source=o.source,t.removeObjectExtension(i,bm))}t.removeExtension(bm)}const nte=Object.freeze(Object.defineProperty({__proto__:null,name:tte,preprocess:rte},Symbol.toStringTag,{value:"Module"})),ite="4.3.2",ste={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:ite,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function ote(r){switch(r.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function ate(r){let e=1/0,t=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0;const c=r.POSITION?r.POSITION.value:[],f=c&&c.length;for(let g=0;g<f;g+=3){const b=c[g],T=c[g+1],S=c[g+2];e=b<e?b:e,t=T<t?T:t,n=S<n?S:n,i=b>i?b:i,o=T>o?T:o,s=S>s?S:s}return[[e,t,n],[i,o,s]]}function cte(r,e,t){const n=ote(e.value),i=t||lte(e);return{name:r,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function lte(r){const e={};return"byteOffset"in r&&(e.byteOffset=r.byteOffset.toString(10)),"byteStride"in r&&(e.byteStride=r.byteStride.toString(10)),"normalized"in r&&(e.normalized=r.normalized.toString()),e}function ute(r,e,t){const n=l6(e.metadata),i=[],o=fte(e.attributes);for(const s in r){const c=r[s],f=BI(s,c,o[s]);i.push(f)}if(t){const s=BI("indices",t);i.push(s)}return{fields:i,metadata:n}}function fte(r){const e={};for(const t in r){const n=r[t];e[n.name||"undefined"]=n}return e}function BI(r,e,t){const n=t?l6(t.metadata):void 0;return cte(r,e,n)}function l6(r){Object.entries(r);const e={};for(const t in r)e[`${t}.string`]=JSON.stringify(r[t]);return e}const SI={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},hte={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},dte=4;let Ate=class{constructor(e){J(this,"draco");J(this,"decoder");J(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),o=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(i){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(n,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(n,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){const S=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(S)}const c=this._getDracoLoaderData(o,i,t),f=this._getMeshData(o,c,t),g=ate(f.attributes),b=ute(f.attributes,c,f.indices);return{loader:"draco",loaderData:c,header:{vertexCount:o.num_points(),boundingBox:g},...f,schema:b}}finally{this.draco.destroy(n),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:o}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const o=this.decoder.GetAttribute(e,i),s=this._getAttributeMetadata(e,i);n[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:i,metadata:s};const c=this._getQuantizationTransform(o,t);c&&(n[o.unique_id()].quantization_transform=c);const f=this._getOctahedronTransform(o,t);f&&(n[o.unique_id()].octahedron_transform=f)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const o of Object.values(e.attributes)){const s=this._deduceAttributeName(o,n);o.name=s;const c=this._getAttributeValues(t,o);if(c){const{value:f,size:g}=c;i[s]={value:f,size:g,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*dte,o=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,o),new Uint32Array(this.draco.HEAPF32.buffer,o,n).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),mte(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=hte[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,s=e.num_points()*i,c=s*n.BYTES_PER_ELEMENT,f=pte(this.draco,n);let g;const b=this.draco._malloc(c);try{const T=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,T,f,c,b),g=new n(this.draco.HEAPF32.buffer,b,s).slice()}finally{this.draco._free(b)}return{value:g,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[s,c]of Object.entries(t.extraAttributes||{}))if(c===n)return s;const i=e.attribute_type;for(const s in SI)if(this.draco[s]===i)return SI[s];const o=t.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const o=this.metadataQuerier.GetEntryName(e,i);t[o]=this._getDracoMetadataField(e,o)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=gte(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const o of i)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(c=>s.min_value(c))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}};function pte(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function gte(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function mte(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}const _te="1.5.6",yte="1.4.1",l1=`https://www.gstatic.com/draco/versioned/decoders/${_te}`,Io={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},u1={[Io.DECODER]:`${l1}/${Io.DECODER}`,[Io.DECODER_WASM]:`${l1}/${Io.DECODER_WASM}`,[Io.FALLBACK_DECODER]:`${l1}/${Io.FALLBACK_DECODER}`,[Io.ENCODER]:`https://raw.githubusercontent.com/google/draco/${yte}/javascript/${Io.ENCODER}`};let f1;async function vte(r){const e=r.modules||{};return e.draco3d?f1||(f1=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):f1||(f1=bte(r)),await f1}async function bte(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await Xf(u1[Io.FALLBACK_DECODER],"draco",r,Io.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await Xf(u1[Io.DECODER],"draco",r,Io.DECODER),await Xf(u1[Io.DECODER_WASM],"draco",r,Io.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await xte(e,t)}function xte(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r({...t,onModuleLoaded:i=>n({draco:i})})})}const wte={...ste,parse:Cte};async function Cte(r,e){const{draco:t}=await vte(e),n=new Ate(t);try{return n.parseSync(r,e==null?void 0:e.draco)}finally{n.destroy()}}function Ete(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=u6(n);e[t]=i}}return e}function u6(r){const{buffer:e,size:t,count:n}=Tte(r);return{value:e,size:t,byteOffset:0,count:n,type:ZO(t),componentType:ty(e)}}function Tte(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=Bte(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function Bte(r,e,t=!1){return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const Vu="KHR_draco_mesh_compression",Ste=Vu;function Ite(r,e,t){const n=new Bs(r);for(const i of f6(n))n.getObjectExtension(i,Vu)}async function Mte(r,e,t){var o;if(!((o=e==null?void 0:e.gltf)!=null&&o.decompressMeshes))return;const n=new Bs(r),i=[];for(const s of f6(n))n.getObjectExtension(s,Vu)&&i.push(Rte(n,s,e,t));await Promise.all(i),n.removeExtension(Vu)}function Pte(r,e={}){const t=new Bs(r);for(const n of t.json.meshes||[])Fte(n),t.addRequiredExtension(Vu)}async function Rte(r,e,t,n){const i=r.getObjectExtension(e,Vu);if(!i)return;const o=r.getTypedArrayForBufferView(i.bufferView),s=JO(o.buffer,o.byteOffset),c={...t};delete c["3d-tiles"];const f=await HO(s,wte,c,n),g=Ete(f.attributes);for(const[b,T]of Object.entries(g))if(b in e.attributes){const S=e.attributes[b],F=r.getAccessor(S);F!=null&&F.min&&(F!=null&&F.max)&&(T.min=F.min,T.max=F.max)}e.attributes=g,f.indices&&(e.indices=u6(f.indices)),r.removeObjectExtension(e,Vu),Dte(e)}function Fte(r,e,t=4,n,i){var b;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:r}),s=(b=i==null?void 0:i.parseSync)==null?void 0:b.call(i,{attributes:r}),c=n._addFauxAttributes(s.attributes),f=n.addBufferView(o);return{primitives:[{attributes:c,mode:t,extensions:{[Vu]:{bufferView:f,attributes:c}}}]}}function Dte(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*f6(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const Ote=Object.freeze(Object.defineProperty({__proto__:null,decode:Mte,encode:Pte,name:Ste,preprocess:Ite},Symbol.toStringTag,{value:"Module"})),iy="KHR_texture_transform",Lte=iy,O0=new ft,Nte=new li,kte=new li;async function Ute(r,e){var o;if(!new Bs(r).hasExtension(iy)||!((o=e.gltf)!=null&&o.loadBuffers))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)zte(s,r)}function zte(r,e){var o,s,c,f;const t=(o=e.json.materials)==null?void 0:o[r],n=[(s=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:s.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(c=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:c.metallicRoughnessTexture],i=[];for(const g of n)g&&((f=g==null?void 0:g.extensions)!=null&&f[iy])&&Gte(e,r,g,i)}function Gte(r,e,t,n){const i=Vte(t,n);if(!i)return;const o=r.json.meshes||[];for(const s of o)for(const c of s.primitives){const f=c.material;Number.isFinite(f)&&e===f&&Hte(r,c,i)}}function Vte(r,e){var s;const t=(s=r.extensions)==null?void 0:s[iy],{texCoord:n=0}=r,{texCoord:i=n}=t;if(!(e.findIndex(([c,f])=>c===n&&f===i)!==-1)){const c=Wte(t);return n!==i&&(r.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:c}}return null}function Hte(r,e,t){var c,f;const{originalTexCoord:n,texCoord:i,matrix:o}=t,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const g=(c=r.json.accessors)==null?void 0:c[s];if(g&&g.bufferView){const b=(f=r.json.bufferViews)==null?void 0:f[g.bufferView];if(b){const{arrayBuffer:T,byteOffset:S}=r.buffers[b.buffer],F=(S||0)+(g.byteOffset||0)+(b.byteOffset||0),{ArrayType:k,length:U}=YO(g,b),j=qO[g.componentType],z=KO[g.type],V=b.byteStride||j*z,K=new Float32Array(U);for(let fe=0;fe<g.count;fe++){const Q=new k(T,F+fe*V,2);O0.set(Q[0],Q[1],1),O0.transformByMatrix3(o),K.set([O0[0],O0[1]],fe*z)}n===i?jte(g,b,r.buffers,K):Jte(i,g,e,r,K)}}}}function jte(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function Jte(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=s.length-1)}function Wte(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new li().set(1,0,0,0,1,0,e[0],e[1],1),o=Nte.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),s=kte.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const Xte=Object.freeze(Object.defineProperty({__proto__:null,decode:Ute,name:Lte},Symbol.toStringTag,{value:"Module"})),Gf="KHR_lights_punctual",$te=Gf;async function Kte(r){const e=new Bs(r),{json:t}=e,n=e.getExtension(Gf);n&&(e.json.lights=n.lights,e.removeExtension(Gf));for(const i of t.nodes||[]){const o=e.getObjectExtension(i,Gf);o&&(i.light=o.light),e.removeObjectExtension(i,Gf)}}async function qte(r){const e=new Bs(r),{json:t}=e;if(t.lights){const n=e.addExtension(Gf);Ca(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,Gf,n)}delete e.json.lights}}const Zte=Object.freeze(Object.defineProperty({__proto__:null,decode:Kte,encode:qte,name:$te},Symbol.toStringTag,{value:"Module"})),og="KHR_materials_unlit",Yte=og;async function Qte(r){const e=new Bs(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,og);e.removeExtension(og)}function ere(r){const e=new Bs(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,og,{}),e.addExtension(og))}const tre=Object.freeze(Object.defineProperty({__proto__:null,decode:Qte,encode:ere,name:Yte},Symbol.toStringTag,{value:"Module"})),Sp="KHR_techniques_webgl",rre=Sp;async function nre(r){const e=new Bs(r),{json:t}=e,n=e.getExtension(Sp);if(n){const i=sre(n,e);for(const o of t.materials||[]){const s=e.getObjectExtension(o,Sp);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=ore(o.technique,e)),e.removeObjectExtension(o,Sp)}e.removeExtension(Sp)}}async function ire(r,e){}function sre(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=t[s.program]}),i}function ore(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const are=Object.freeze(Object.defineProperty({__proto__:null,decode:nre,encode:ire,name:rre},Symbol.toStringTag,{value:"Module"})),h6=[WQ,mQ,Zee,ete,nte,Ote,Zte,tre,are,Xte,lee];function cre(r,e={},t){var i;const n=h6.filter(o=>d6(o.name,e));for(const o of n)(i=o.preprocess)==null||i.call(o,r,e,t)}async function lre(r,e={},t){var i;const n=h6.filter(o=>d6(o.name,e));for(const o of n)await((i=o.decode)==null?void 0:i.call(o,r,e,t))}function d6(r,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(r in t&&!t[r])}const h1="KHR_binary_glTF";function ure(r){const e=new Bs(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,h1);i&&Object.assign(n,i),e.removeObjectExtension(n,h1)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(h1)}const II={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},fre={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let hre=class{constructor(){J(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});J(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),ure(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in II)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const o=n[i];o.id=o.id||i;const s=e[t].length;e[t].push(o),this.idToIndexMap[t][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in II)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:o}=t;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const o=n[i],s=this._convertIdToIndex(o,i);n[i]=s}}_convertIdToIndex(e,t){const n=fre[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const o of e.materials){o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=((t=o.values)==null?void 0:t.tex)||((n=o.values)==null?void 0:n.texture2d_0)||((i=o.values)==null?void 0:i.diffuseTex),c=e.textures.findIndex(f=>f.id===s);c!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:c})}}};function dre(r,e={}){return new hre().normalize(r,e)}async function Are(r,e,t=0,n,i){var o,s,c;return pre(r,e,t,n),dre(r,{normalize:(o=n==null?void 0:n.gltf)==null?void 0:o.normalize}),cre(r,n,i),(s=n==null?void 0:n.gltf)!=null&&s.loadBuffers&&r.json.buffers&&await gre(r,n,i),(c=n==null?void 0:n.gltf)!=null&&c.loadImages&&await mre(r,n,i),await lre(r,n,i),r}function pre(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!Ree(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=dY(e);else if(e instanceof ArrayBuffer){const s={};t=Fee(s,e,t,n.glb),Ca(s.type==="glTF",`Invalid GLB magic string ${s.type}`),r._glb=s,r.json=s.json}else Ca(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:s}=r._glb;r.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=r.json.images||[];r.images=new Array(o.length).fill({})}async function gre(r,e,t){var i,o;const n=r.json.buffers||[];for(let s=0;s<n.length;++s){const c=n[s];if(c.uri){const{fetch:f}=t;Ca(f);const g=c6(c.uri,e),b=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,g)),T=await((o=b==null?void 0:b.arrayBuffer)==null?void 0:o.call(b));r.buffers[s]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete c.uri}else r.buffers[s]===null&&(r.buffers[s]={arrayBuffer:new ArrayBuffer(c.byteLength),byteOffset:0,byteLength:c.byteLength})}}async function mre(r,e,t){const n=_re(r),i=r.json.images||[],o=[];for(const s of n)o.push(yre(r,i[s],s,e,t));return await Promise.all(o)}function _re(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function yre(r,e,t,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const c=c6(e.uri,n),{fetch:f}=i;o=await(await f(c)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const c=rQ(r.json,r.buffers,e.bufferView);o=JO(c.buffer,c.byteOffset,c.byteLength)}Ca(o,"glTF image has no data");let s=await HO(o,[WY,Eee],{...n,mimeType:e.mimeType,basis:n.basis||{format:a6()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),r.images=r.images||[],r.images[t]=s}const F2={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:uee,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:vre,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function vre(r,e={},t){e={...F2.options,...e},e.gltf={...F2.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await Are({},r,n,e,t)}const bre=({error:r,deltaType:e})=>r instanceof xre?Es(gv,{name:"No Mapbox token provided",message:Vc(AT,{children:[Vc("p",{children:["To use ",Vc(pv,{children:["st.",e]})," or"," ",Es(pv,{children:"st.map"})," you need to set up a Mapbox access token."]}),Vc("p",{children:["To get a token, create an account at"," ",Es("a",{href:"https://mapbox.com",children:"https://mapbox.com"}),". It's free for moderate usage levels!"]}),Vc("p",{children:["Once you have a token, just set it using the Streamlit config option ",Es(pv,{children:"mapbox.token"})," and don't forget to restart your Streamlit server at this point if it's still running, then reload this tab."]}),Vc("p",{children:["See"," ",Es("a",{href:"https://docs.streamlit.io/develop/api-reference/configuration/config.toml",children:"our documentation"})," ","for more info on how to set config options."]})]})}):r instanceof A6?Es(gv,{name:"Error fetching Streamlit Mapbox token",message:Vc(AT,{children:[Es("p",{children:"This app requires an internet connection."}),Es("p",{children:"Please check your connection and try again."}),Vc("p",{children:["If you think this is a bug, please file bug report"," ",Es("a",{href:"https://github.com/streamlit/streamlit/issues/new/choose",children:"here"}),"."]})]})}):Es(gv,{name:"Error fetching Streamlit Mapbox token",message:r.message});class xre extends Error{}class A6 extends Error{}const MI="https://data.streamlit.io/tokens.json",PI="mapbox",wre=r=>e=>{const n=class n extends Bt.PureComponent{constructor(o){super(o),this.initMapboxToken=async()=>{try{const s=await vk.get(MI),{[PI]:c}=s.data;if(!c)throw new Error(`Missing token ${PI}`);this.setState({mapboxToken:c,isFetching:!1})}catch(s){const c=sk(s);throw this.setState({mapboxTokenError:c,isFetching:!1}),new A6(`${c.message} (${MI})`)}},this.render=()=>{const{mapboxToken:s,mapboxTokenError:c,isFetching:f}=this.state;return c?Es(bre,{error:c,deltaType:r}):f?Es(ok,{element:pT.create({style:pT.SkeletonStyle.ELEMENT})}):Es(e,{...this.props,mapboxToken:s})},this.state={isFetching:!0,mapboxToken:void 0,mapboxTokenError:void 0}}componentDidMount(){const o=this.props.element.mapboxToken||this.context.libConfig.mapboxToken;o?this.setState({mapboxToken:o,isFetching:!1}):this.initMapboxToken()}};n.displayName=`withMapboxToken(${e.displayName||e.name})`,n.contextType=ak;let t=n;return ck(t,e)},RI=UR("div",{target:"ei0oomx0"})(({height:r})=>({position:"relative",height:r,width:"100%"})),Cre=UR("div",{target:"ei0oomx1"})(({theme:r})=>({position:"absolute",right:"2.625rem",top:r.spacing.md,zIndex:r.zIndices.priority,".mapboxgl-ctrl.mapboxgl-ctrl-group":{overflow:"hidden",background:r.colors.bgColor},"button:not(:disabled)":{background:r.colors.bgColor,width:r.iconSizes.twoXL,height:r.iconSizes.twoXL,"& + button":{borderTopColor:r.colors.borderColor},".mapboxgl-ctrl-icon":{backgroundSize:r.iconSizes.twoXL,"&:hover":{backgroundColor:r.colors.darkenedBgMix25}},"& span":{filter:zR(r)?"":"invert(100%)"}}})),Ere=({container:r,element:e,heightFallback:t="auto",isFullScreen:n,shouldUseContainerWidth:i,widthFallback:o="auto"})=>{const s=Bt.useMemo(()=>i||n?"100%":e.width||r.width||o,[r.width,e.width,n,i,o]),c=Bt.useMemo(()=>n&&r.height?r.height:e.height||r.height||t,[n,e.height,r.height,t]);return{width:s,height:c}},Tre=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec3 positions;
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = positions.x;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, positions.y);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (useShortestPath) {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Bre=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,c_=[0,0,0,255],Sre={getSourcePosition:{type:"accessor",value:r=>r.sourcePosition},getTargetPosition:{type:"accessor",value:r=>r.targetPosition},getSourceColor:{type:"accessor",value:c_},getTargetColor:{type:"accessor",value:c_},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class bg extends cs{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Tre,fs:Bre,modules:[_o,Fo]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:c_},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:c_},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){var o;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e;(i.extensionsChanged||t.numSegments!==n.numSegments)&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:n,widthMinPixels:i,widthMaxPixels:o,greatCircle:s,wrapLongitude:c}=this.props,f=this.state.model;f.setUniforms(e),f.setUniforms({greatCircle:s,widthUnits:ia[t],widthScale:n,widthMinPixels:i,widthMaxPixels:o,useShortestPath:c}),f.draw(this.context.renderPass)}_getModel(){const{numSegments:e}=this.props;let t=[];for(let i=0;i<e;i++)t=t.concat([i,1,0,i,-1,0]);const n=new mi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ts({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0});return n.setUniforms({numSegments:e}),n}}bg.layerName="ArcLayer";bg.defaultProps=Sre;const Ire=new Uint32Array([0,2,1,0,3,2]),Mre=new Float32Array([0,1,0,0,1,0,1,1]);function Pre(r,e){if(!e)return Rre(r);const t=Math.max(Math.abs(r[0][0]-r[3][0]),Math.abs(r[1][0]-r[2][0])),n=Math.max(Math.abs(r[1][1]-r[0][1]),Math.abs(r[2][1]-r[3][1])),i=Math.ceil(t/e)+1,o=Math.ceil(n/e)+1,s=(i-1)*(o-1)*6,c=new Uint32Array(s),f=new Float32Array(i*o*2),g=new Float64Array(i*o*3);let b=0,T=0;for(let S=0;S<i;S++){const F=S/(i-1);for(let k=0;k<o;k++){const U=k/(o-1),j=Fre(r,F,U);g[b*3+0]=j[0],g[b*3+1]=j[1],g[b*3+2]=j[2]||0,f[b*2+0]=F,f[b*2+1]=1-U,S>0&&k>0&&(c[T++]=b-o,c[T++]=b-o-1,c[T++]=b-1,c[T++]=b-o,c[T++]=b-1,c[T++]=b),b++}}return{vertexCount:s,positions:g,indices:c,texCoords:f}}function Rre(r){const e=new Float64Array(12);for(let t=0;t<r.length;t++)e[t*3+0]=r[t][0],e[t*3+1]=r[t][1],e[t*3+2]=r[t][2]||0;return{vertexCount:6,positions:e,indices:Ire,texCoords:Mre}}function Fre(r,e,t){return ac(ac(r[0],r[1],t),ac(r[3],r[2],t),e)}const Dre=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,Ore=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,Lre=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

${Ore}

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,Nre={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Wr.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class sy extends cs{getShaders(){return super.getShaders({vs:Dre,fs:Lre,modules:[_o,Fo]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:n}){var o;const i=this.getAttributeManager();if(n.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),i.invalidateAll()),e.bounds!==t.bounds){const s=this.state.mesh,c=this._createMesh();this.state.model.setVertexCount(c.vertexCount);for(const f in c)s&&s[f]!==c[f]&&i.invalidate(f);this.setState({mesh:c,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,n=e.info;if(!n.color||!t)return n.bitmap=null,n;const{width:i,height:o}=t;n.index=0;const s=kre(n.color);return n.bitmap={size:{width:i,height:o},uv:s,pixel:[Math.floor(s[0]*i),Math.floor(s[1]*o)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return FI(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),Pre(t,this.context.viewport.resolution)}_getModel(){return new mi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{uniforms:t,moduleParameters:n}=e,{model:i,coordinateConversion:o,bounds:s,disablePicking:c}=this.state,{image:f,desaturate:g,transparentColor:b,tintColor:T}=this.props;n.picking.isActive&&c||f&&i&&(i.setUniforms(t),i.setBindings({bitmapTexture:f}),i.setUniforms({desaturate:g,transparentColor:b.map(S=>S/255),tintColor:T.slice(0,3).map(S=>S/255),coordinateConversion:o,bounds:s}),i.draw(this.context.renderPass))}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:n}=Wr;let{_imageCoordinateSystem:i}=this.props;if(i!==n){const{bounds:o}=this.props;if(!FI(o))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const s=this.context.viewport.resolution?e:t;if(i=i===e?e:t,i===e&&s===t)return{coordinateConversion:-1,bounds:o};if(i===t&&s===e){const c=Ul([o[0],o[1]]),f=Ul([o[2],o[3]]);return{coordinateConversion:1,bounds:[c[0],c[1],f[0],f[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}sy.layerName="BitmapLayer";sy.defaultProps=Nre;function kre(r){const[e,t,n]=r,i=(n&240)/256,o=(n&15)/16;return[(e+o)/256,(t+i)/256]}function FI(r){return Number.isFinite(r[0])}const Ure=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,zre=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Gre=1024,Vre=4,DI=()=>{},OI={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Hre={x:0,y:0,width:0,height:0};function jre(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function Jre(r,e,t,n){const i=Math.min(t/e.width,n/e.height),o=Math.floor(e.width*i),s=Math.floor(e.height*i);return i===1?{data:e,width:o,height:s}:(r.canvas.height=s,r.canvas.width=o,r.clearRect(0,0,o,s),r.drawImage(e,0,0,e.width,e.height,0,0,o,s),{data:r.canvas,width:o,height:s})}function ag(r){return r&&(r.id||r.url)}function Wre(r,e,t,n){const{width:i,height:o,device:s}=r,c=s.createTexture({format:"rgba8unorm",width:e,height:t,sampler:n}),f=s.createCommandEncoder();return f.copyTextureToTexture({source:r,destination:c,width:i,height:o}),f.finish(),r.destroy(),c}function LI(r,e,t){for(let n=0;n<e.length;n++){const{icon:i,xOffset:o}=e[n],s=ag(i);r[s]={...i,x:o,y:t}}}function Xre({icons:r,buffer:e,mapping:t={},xOffset:n=0,yOffset:i=0,rowHeight:o=0,canvasWidth:s}){let c=[];for(let f=0;f<r.length;f++){const g=r[f],b=ag(g);if(!t[b]){const{height:T,width:S}=g;n+S+e>s&&(LI(t,c,i),n=0,i=o+i+e,o=0,c=[]),c.push({icon:g,xOffset:n}),n=n+S+e,o=Math.max(o,T)}}return c.length>0&&LI(t,c,i),{mapping:t,rowHeight:o,xOffset:n,yOffset:i,canvasWidth:s,canvasHeight:jre(o+i+e)}}function $re(r,e,t){if(!r||!e)return null;t=t||{};const n={},{iterable:i,objectInfo:o}=el(r);for(const s of i){o.index++;const c=e(s,o),f=ag(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!n[f]&&(!t[f]||c.url!==t[f].url)&&(n[f]={...c,source:s,sourceIndex:o.index})}return n}class Kre{constructor(e,{onUpdate:t=DI,onError:n=DI}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Vre,this._canvasWidth=Gre,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=n}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?ag(e):e;return this._mapping[t]||Hre}setProps({loadOptions:e,autoPacking:t,iconAtlas:n,iconMapping:i,textureParameters:o}){var s;e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),i&&(this._mapping=i),n&&((s=this._texture)==null||s.delete(),this._texture=null,this._externalTexture=n),o&&(this._textureParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const n=Object.values($re(e,t,this._mapping)||{});if(n.length>0){const{mapping:i,xOffset:o,yOffset:s,rowHeight:c,canvasHeight:f}=Xre({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=i,this._xOffset=o,this._yOffset=s,this._canvasHeight=f,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||OI})),this._texture.height!==this._canvasHeight&&(this._texture=Wre(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||OI)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,Nl(n.url,this._loadOptions).then(i=>{const o=ag(n),s=this._mapping[o],{x:c,y:f,width:g,height:b}=s,{data:T,width:S,height:F}=Jre(t,i,g,b);this._texture.setSubImageData({data:T,x:c+(g-S)/2,y:f+(b-F)/2,width:S,height:F}),s.width=S,s.height=F,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const p6=[0,0,0,255],qre={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:r=>r.position},getIcon:{type:"accessor",value:r=>r.icon},getColor:{type:"accessor",value:p6},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class CA extends cs{getShaders(){return super.getShaders({vs:Ure,fs:zre,modules:[_o,Fo]})}initializeState(){this.state={iconManager:new Kre(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:p6},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var F;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,o=this.getAttributeManager(),{iconAtlas:s,iconMapping:c,data:f,getIcon:g,textureParameters:b}=t,{iconManager:T}=this.state;if(typeof s=="string")return;const S=s||this.internalState.isAsyncPropLoading("iconAtlas");T.setProps({loadOptions:t.loadOptions,autoPacking:!S,iconAtlas:s,iconMapping:S?c:null,textureParameters:b}),S?n.iconMapping!==t.iconMapping&&o.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&T.packIcons(f,g),i.extensionsChanged&&((F=this.state.model)==null||F.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:o,billboard:s,alphaCutoff:c}=this.props,{iconManager:f}=this.state,g=f.getTexture();if(g){const b=this.state.model;b.setBindings({iconsTexture:g}),b.setUniforms(e),b.setUniforms({iconsTextureDim:[g.width,g.height],sizeUnits:ia[o],sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,billboard:s,alphaCutoff:c}),b.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new mi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ts({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const t=(n=this.getCurrentLayer())==null?void 0:n.props.onIconError;t?t(e):Ur.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:n,anchorX:i=t/2,anchorY:o=n/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,n/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:n,width:i,height:o}=this.state.iconManager.getIconMapping(e);return[t,n,i,o]}}CA.defaultProps=qre;CA.layerName="IconLayer";const Zre=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (useShortestPath > 0.5 || useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * useShortestPath > 180.) {
source_world.x += 360. * useShortestPath;
source_world = splitLine(source_world, target_world, 180. * useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * useShortestPath < -180.) {
target_world.x += 360. * useShortestPath;
target_world = splitLine(source_world, target_world, 180. * useShortestPath);
target_world_64low = vec3(0.0);
} else if (useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Yre=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Qre=[0,0,0,255],ene={getSourcePosition:{type:"accessor",value:r=>r.sourcePosition},getTargetPosition:{type:"accessor",value:r=>r.targetPosition},getColor:{type:"accessor",value:Qre},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class xg extends cs{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Zre,fs:Yre,modules:[_o,Fo]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:n,widthMinPixels:i,widthMaxPixels:o,wrapLongitude:s}=this.props,c=this.state.model;c.setUniforms(e),c.setUniforms({widthUnits:ia[t],widthScale:n,widthMinPixels:i,widthMaxPixels:o,useShortestPath:s?1:0}),c.draw(this.context.renderPass),s&&(c.setUniforms({useShortestPath:-1}),c.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new mi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ts({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}xg.layerName="LineLayer";xg.defaultProps=ene;const tne=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,rne=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,g6=[0,0,0,255],m6=[0,0,1],nne={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:m6},getColor:{type:"accessor",value:g6},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function ine(r){const{header:e,attributes:t}=r;if(!(!e||!t)&&(r.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0)){const{size:n,value:i}=t.COLOR_0;t.instanceColors={size:n,type:"unorm8",value:i}}}class wg extends cs{getShaders(){return super.getShaders({vs:tne,fs:rne,modules:[_o,W_,Fo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:m6},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:g6}})}updateState(e){var i;const{changeFlags:t,props:n}=e;super.updateState(e),t.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&ine(n.data)}draw({uniforms:e}){const{pointSize:t,sizeUnits:n}=this.props,i=this.state.model;i.setUniforms(e),i.setUniforms({sizeUnits:ia[n],radiusPixels:t}),i.draw(this.context.renderPass)}_getModel(){const e=[];for(let t=0;t<3;t++){const n=t/3*Math.PI*2;e.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new mi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ts({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}wg.layerName="PointCloudLayer";wg.defaultProps=nne;const sne=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,one=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,NI=[0,0,0,255],ane={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:r=>r.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:NI},getLineColor:{type:"accessor",value:NI},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Cg extends cs{getShaders(){return super.getShaders({vs:sne,fs:one,modules:[_o,Fo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,stroked:s,filled:c,billboard:f,antialiasing:g,lineWidthUnits:b,lineWidthScale:T,lineWidthMinPixels:S,lineWidthMaxPixels:F}=this.props,k=this.state.model;k.setUniforms(e),k.setUniforms({stroked:s?1:0,filled:c,billboard:f,antialiasing:g,radiusUnits:ia[t],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:ia[b],lineWidthScale:T,lineWidthMinPixels:S,lineWidthMaxPixels:F}),k.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new mi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ts({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Cg.defaultProps=ane;Cg.layerName="ScatterplotLayer";const _w={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function yw(r,e,t={}){return cne(r,t)!==e?(une(r,t),!0):!1}function cne(r,e={}){return Math.sign(lne(r,e))}const kI={x:0,y:1,z:2};function lne(r,e={}){const{start:t=0,end:n=r.length,plane:i="xy"}=e,o=e.size||2;let s=0;const c=kI[i[0]],f=kI[i[1]];for(let g=t,b=n-o;g<n;g+=o)s+=(r[g+c]-r[b+c])*(r[g+f]+r[b+f]),b=g;return s/2}function une(r,e){const{start:t=0,end:n=r.length,size:i=2}=e,o=(n-t)/i,s=Math.floor(o/2);for(let c=0;c<s;++c){const f=t+c*i,g=t+(o-1-c)*i;for(let b=0;b<i;++b){const T=r[f+b];r[f+b]=r[g+b],r[g+b]=T}}}function sc(r,e){const t=e.length,n=r.length;if(n>0){let i=!0;for(let o=0;o<t;o++)if(r[n-t+o]!==e[o]){i=!1;break}if(i)return!1}for(let i=0;i<t;i++)r[n+i]=e[i];return!0}function D2(r,e){const t=e.length;for(let n=0;n<t;n++)r[n]=e[n]}function cg(r,e,t,n,i=[]){const o=n+e*t;for(let s=0;s<t;s++)i[s]=r[o+s];return i}function O2(r,e,t,n,i=[]){let o,s;if(t&8)o=(n[3]-r[1])/(e[1]-r[1]),s=3;else if(t&4)o=(n[1]-r[1])/(e[1]-r[1]),s=1;else if(t&2)o=(n[2]-r[0])/(e[0]-r[0]),s=2;else if(t&1)o=(n[0]-r[0])/(e[0]-r[0]),s=0;else return null;for(let c=0;c<r.length;c++)i[c]=(s&1)===c?n[s]:o*(e[c]-r[c])+r[c];return i}function xm(r,e){let t=0;return r[0]<e[0]?t|=1:r[0]>e[2]&&(t|=2),r[1]<e[1]?t|=4:r[1]>e[3]&&(t|=8),t}function _6(r,e){const{size:t=2,broken:n=!1,gridResolution:i=10,gridOffset:o=[0,0],startIndex:s=0,endIndex:c=r.length}=e||{},f=(c-s)/t;let g=[];const b=[g],T=cg(r,0,t,s);let S,F;const k=v6(T,i,o,[]),U=[];sc(g,T);for(let j=1;j<f;j++){for(S=cg(r,j,t,s,S),F=xm(S,k);F;){O2(T,S,F,k,U);const z=xm(U,k);z&&(O2(T,U,z,k,U),F=z),sc(g,U),D2(T,U),hne(k,i,F),n&&g.length>t&&(g=[],b.push(g),sc(g,T)),F=xm(S,k)}sc(g,S),D2(T,S)}return n?b:b[0]}const UI=0,fne=1;function y6(r,e=null,t){if(!r.length)return[];const{size:n=2,gridResolution:i=10,gridOffset:o=[0,0],edgeTypes:s=!1}=t||{},c=[],f=[{pos:r,types:s?new Array(r.length/n).fill(fne):null,holes:e||[]}],g=[[],[]];let b=[];for(;f.length;){const{pos:T,types:S,holes:F}=f.shift();dne(T,n,F[0]||T.length,g),b=v6(g[0],i,o,b);const k=xm(g[1],b);if(k){let U=zI(T,S,n,0,F[0]||T.length,b,k);const j={pos:U[0].pos,types:U[0].types,holes:[]},z={pos:U[1].pos,types:U[1].types,holes:[]};f.push(j,z);for(let V=0;V<F.length;V++)U=zI(T,S,n,F[V],F[V+1]||T.length,b,k),U[0]&&(j.holes.push(j.pos.length),j.pos=L0(j.pos,U[0].pos),s&&(j.types=L0(j.types,U[0].types))),U[1]&&(z.holes.push(z.pos.length),z.pos=L0(z.pos,U[1].pos),s&&(z.types=L0(z.types,U[1].types)))}else{const U={positions:T};s&&(U.edgeTypes=S),F.length&&(U.holeIndices=F),c.push(U)}}return c}function zI(r,e,t,n,i,o,s){const c=(i-n)/t,f=[],g=[],b=[],T=[],S=[];let F,k,U;const j=cg(r,c-1,t,n);let z=Math.sign(s&8?j[1]-o[3]:j[0]-o[2]),V=e&&e[c-1],K=0,fe=0;for(let Q=0;Q<c;Q++)F=cg(r,Q,t,n,F),k=Math.sign(s&8?F[1]-o[3]:F[0]-o[2]),U=e&&e[n/t+Q],k&&z&&z!==k&&(O2(j,F,s,o,S),sc(f,S)&&b.push(V),sc(g,S)&&T.push(V)),k<=0?(sc(f,F)&&b.push(U),K-=k):b.length&&(b[b.length-1]=UI),k>=0?(sc(g,F)&&T.push(U),fe+=k):T.length&&(T[T.length-1]=UI),D2(j,F),z=k,V=U;return[K?{pos:f,types:e&&b}:null,fe?{pos:g,types:e&&T}:null]}function v6(r,e,t,n){const i=Math.floor((r[0]-t[0])/e)*e+t[0],o=Math.floor((r[1]-t[1])/e)*e+t[1];return n[0]=i,n[1]=o,n[2]=i+e,n[3]=o+e,n}function hne(r,e,t){t&8?(r[1]+=e,r[3]+=e):t&4?(r[1]-=e,r[3]-=e):t&2?(r[0]+=e,r[2]+=e):t&1&&(r[0]-=e,r[2]-=e)}function dne(r,e,t,n){let i=1/0,o=-1/0,s=1/0,c=-1/0;for(let f=0;f<t;f+=e){const g=r[f],b=r[f+1];i=g<i?g:i,o=g>o?g:o,s=b<s?b:s,c=b>c?b:c}return n[0][0]=i,n[0][1]=s,n[1][0]=o,n[1][1]=c,n}function L0(r,e){for(let t=0;t<e.length;t++)r.push(e[t]);return r}const Ane=85.051129;function pne(r,e){const{size:t=2,startIndex:n=0,endIndex:i=r.length,normalize:o=!0}=e||{},s=r.slice(n,i);b6(s,t,0,i-n);const c=_6(s,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const f of c)x6(f,t);return c}function gne(r,e=null,t){const{size:n=2,normalize:i=!0,edgeTypes:o=!1}=t||{};e=e||[];const s=[],c=[];let f=0,g=0;for(let T=0;T<=e.length;T++){const S=e[T]||r.length,F=g,k=mne(r,n,f,S);for(let U=k;U<S;U++)s[g++]=r[U];for(let U=f;U<k;U++)s[g++]=r[U];b6(s,n,F,g),_ne(s,n,F,g,t==null?void 0:t.maxLatitude),f=S,c[T]=g}c.pop();const b=y6(s,c,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(i)for(const T of b)x6(T.positions,n);return b}function mne(r,e,t,n){let i=-1,o=-1;for(let s=t+1;s<n;s+=e){const c=Math.abs(r[s]);c>i&&(i=c,o=s-1)}return o}function _ne(r,e,t,n,i=Ane){const o=r[t],s=r[n-e];if(Math.abs(o-s)>180){const c=cg(r,0,e,t);c[0]+=Math.round((s-o)/360)*360,sc(r,c),c[1]=Math.sign(c[1])*i,sc(r,c),c[0]=o,sc(r,c)}}function b6(r,e,t,n){let i=r[0],o;for(let s=t;s<n;s+=e){o=r[s];const c=o-i;(c>180||c<-180)&&(o-=Math.round(c/360)*360),r[s]=i=o}}function x6(r,e){let t;const n=r.length/e;for(let o=0;o<n&&(t=r[o*e],(t+180)%360===0);o++);const i=-Math.round(t/360)*360;if(i!==0)for(let o=0;o<n;o++)r[o*e]+=i}class yne extends Ts{constructor(e){const{indices:t,attributes:n}=vne(e);super({...e,indices:t,attributes:n})}}function vne(r){const{radius:e,height:t=1,nradial:n=10}=r;let{vertices:i}=r;i&&(Ur.assert(i.length>=n),i=i.flatMap(F=>[F[0],F[1]]),yw(i,_w.COUNTER_CLOCKWISE));const o=t>0,s=n+1,c=o?s*3+1:n,f=Math.PI*2/n,g=new Uint16Array(o?n*3*2:0),b=new Float32Array(c*3),T=new Float32Array(c*3);let S=0;if(o){for(let F=0;F<s;F++){const k=F*f,U=F%n,j=Math.sin(k),z=Math.cos(k);for(let V=0;V<2;V++)b[S+0]=i?i[U*2]:z*e,b[S+1]=i?i[U*2+1]:j*e,b[S+2]=(1/2-V)*t,T[S+0]=i?i[U*2]:z,T[S+1]=i?i[U*2+1]:j,S+=3}b[S+0]=b[S-3],b[S+1]=b[S-2],b[S+2]=b[S-1],S+=3}for(let F=o?0:1;F<s;F++){const k=Math.floor(F/2)*Math.sign(.5-F%2),U=k*f,j=(k+n)%n,z=Math.sin(U),V=Math.cos(U);b[S+0]=i?i[j*2]:V*e,b[S+1]=i?i[j*2+1]:z*e,b[S+2]=t/2,T[S+2]=1,S+=3}if(o){let F=0;for(let k=0;k<n;k++)g[F++]=k*2+0,g[F++]=k*2+2,g[F++]=k*2+0,g[F++]=k*2+1,g[F++]=k*2+1,g[F++]=k*2+3}return{indices:g,attributes:{POSITION:{size:3,value:b},NORMAL:{size:3,value:T}}}}const bne=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
} else if (stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
if (isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = radius * coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
if (radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded && !isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,xne=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (extruded && !isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,l_=[0,0,0,255],wne={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:r=>r.position},getFillColor:{type:"accessor",value:l_},getLineColor:{type:"accessor",value:l_},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Jl extends cs{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:bne,fs:xne,defines:e,modules:[_o,t?hD:W_,Fo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:l_},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:l_},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var c;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,o=i.extensionsChanged||t.flatShading!==n.flatShading;o&&((c=this.state.models)==null||c.forEach(f=>f.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const s=this.getNumInstances();this.state.fillModel.setInstanceCount(s),this.state.wireframeModel.setInstanceCount(s),(o||t.diskResolution!==n.diskResolution||t.vertices!==n.vertices||(t.extruded||t.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(t)}getGeometry(e,t,n){const i=new yne({radius:1,height:n?2:0,vertices:t,nradial:e});let o=0;if(t)for(let s=0;s<e;s++){const c=t[s],f=Math.sqrt(c[0]*c[0]+c[1]*c[1]);o+=f/e}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*o}),i}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),n=new mi(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),i=new mi(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:n,wireframeModel:i,models:[i,n]}}_updateGeometry({diskResolution:e,vertices:t,extruded:n,stroked:i}){const o=this.getGeometry(e,t,n||i);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});const s=this.state.fillModel,c=this.state.wireframeModel;s.setGeometry(o),s.setTopology("triangle-strip"),s.setIndexBuffer(null),c.setGeometry(o),c.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:t,lineWidthScale:n,lineWidthMinPixels:i,lineWidthMaxPixels:o,radiusUnits:s,elevationScale:c,extruded:f,filled:g,stroked:b,wireframe:T,offset:S,coverage:F,radius:k,angle:U}=this.props,j=this.state.fillModel,z=this.state.wireframeModel,{fillVertexCount:V,edgeDistance:K}=this.state,fe={...e,radius:k,angle:U/180*Math.PI,offset:S,extruded:f,stroked:b,coverage:F,elevationScale:c,edgeDistance:K,radiusUnits:ia[s],widthUnits:ia[t],widthScale:n,widthMinPixels:i,widthMaxPixels:o};f&&T&&(z.setUniforms(fe),z.setUniforms({isStroke:!0}),z.draw(this.context.renderPass)),j.setUniforms(fe),g&&(j.setVertexCount(V),j.setUniforms({isStroke:!1}),j.draw(this.context.renderPass)),!f&&b&&(j.setVertexCount(V*2/3),j.setUniforms({isStroke:!0}),j.draw(this.context.renderPass))}}Jl.layerName="ColumnLayer";Jl.defaultProps=wne;const Cne={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class oy extends Jl{_updateGeometry(){const e=new BD;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{elevationScale:t,extruded:n,offset:i,coverage:o,cellSize:s,angle:c,radiusUnits:f}=this.props,g=this.state.fillModel;g.setUniforms(e),g.setUniforms({radius:s/2,radiusUnits:ia[f],angle:c,offset:i,extruded:n,coverage:o,elevationScale:t,edgeDistance:1,isStroke:!1}),g.draw(this.context.renderPass)}}oy.layerName="GridCellLayer";oy.defaultProps=Cne;function Ene(r,e,t,n){let i;if(Array.isArray(r[0])){const o=r.length*e;i=new Array(o);for(let s=0;s<r.length;s++)for(let c=0;c<e;c++)i[s*e+c]=r[s][c]||0}else i=r;return t?_6(i,{size:e,gridResolution:t}):n?pne(i,{size:e}):i}const Tne=1,Bne=2,d1=4;class Sne extends uO{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Ene(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(GI(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&GI(e))for(const n of e){const i=this.getGeometrySize(n);t.geometrySize=i,this.updateGeometryAttributes(n,t),t.vertexStart+=i}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const n=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:s}=t;n.fill(0,o,o+s),i?(n[o]=d1,n[o+s-2]=d1):(n[o]+=Tne,n[o+s-2]+=Bne),n[o+s-1]=d1}_updatePositions(e,t){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:i,geometrySize:o}=t,s=new Array(3);for(let c=i,f=0;f<o;c++,f++)this.getPointOnPath(e,f,s),n[c*3]=s[0],n[c*3+1]=s[1],n[c*3+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,n=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const o=t*i;return n[0]=e[o],n[1]=e[o+1],n[2]=i===3&&e[o+2]||0,n}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(t===2||e[2]===e[n+2])}}function GI(r){return Array.isArray(r[0])}const Ine=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Mne=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,w6=[0,0,0,255],Pne={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:r=>r.path},getColor:{type:"accessor",value:w6},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},A1={enter:(r,e)=>e.length?e.subarray(e.length-r.length):r};class ch extends cs{getShaders(){return super.getShaders({vs:Ine,fs:Mne,modules:[_o,Fo]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:A1,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:A1,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:A1,defaultValue:w6},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:i,target:o})=>this.encodePickingColor(n&&n.__source?n.__source.index:i,o)}}),this.setState({pathTesselator:new Sne({fp64:this.use64bitPositions()})})}updateState(e){var s;super.updateState(e);const{props:t,changeFlags:n}=e,i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:c}=this.state,f=t.data.attributes||{};c.updateGeometry({data:t.data,geometryBuffer:f.getPath,buffers:f,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),n.dataChanged||i.invalidateAll()}n.extensionsChanged&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(o=>o.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:n,billboard:i,miterLimit:o,widthUnits:s,widthScale:c,widthMinPixels:f,widthMaxPixels:g}=this.props,b=this.state.model;b.setUniforms(e),b.setUniforms({jointType:Number(t),capType:Number(n),billboard:i,widthUnits:ia[s],widthScale:c,miterLimit:o,widthMinPixels:f,widthMaxPixels:g}),b.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new mi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ts({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}ch.defaultProps=Pne;ch.layerName="PathLayer";var N0={exports:{}},VI;function Rne(){if(VI)return N0.exports;VI=1,N0.exports=r,N0.exports.default=r;function r(Ce,Ne,Ge){Ge=Ge||2;var Qe=Ne&&Ne.length,rt=Qe?Ne[0]*Ge:Ce.length,tt=e(Ce,0,rt,Ge,!0),lt=[];if(!tt||tt.next===tt.prev)return lt;var mt,Tt,nt,cr,$t,Jt,Lt;if(Qe&&(tt=f(Ce,Ne,tt,Ge)),Ce.length>80*Ge){mt=nt=Ce[0],Tt=cr=Ce[1];for(var lr=Ge;lr<rt;lr+=Ge)$t=Ce[lr],Jt=Ce[lr+1],$t<mt&&(mt=$t),Jt<Tt&&(Tt=Jt),$t>nt&&(nt=$t),Jt>cr&&(cr=Jt);Lt=Math.max(nt-mt,cr-Tt),Lt=Lt!==0?32767/Lt:0}return n(tt,lt,Ge,mt,Tt,Lt,0),lt}function e(Ce,Ne,Ge,Qe,rt){var tt,lt;if(rt===Ze(Ce,Ne,Ge,Qe)>0)for(tt=Ne;tt<Ge;tt+=Qe)lt=X(tt,Ce[tt],Ce[tt+1],lt);else for(tt=Ge-Qe;tt>=Ne;tt-=Qe)lt=X(tt,Ce[tt],Ce[tt+1],lt);return lt&&fe(lt,lt.next)&&(ne(lt),lt=lt.next),lt}function t(Ce,Ne){if(!Ce)return Ce;Ne||(Ne=Ce);var Ge=Ce,Qe;do if(Qe=!1,!Ge.steiner&&(fe(Ge,Ge.next)||K(Ge.prev,Ge,Ge.next)===0)){if(ne(Ge),Ge=Ne=Ge.prev,Ge===Ge.next)break;Qe=!0}else Ge=Ge.next;while(Qe||Ge!==Ne);return Ne}function n(Ce,Ne,Ge,Qe,rt,tt,lt){if(Ce){!lt&&tt&&F(Ce,Qe,rt,tt);for(var mt=Ce,Tt,nt;Ce.prev!==Ce.next;){if(Tt=Ce.prev,nt=Ce.next,tt?o(Ce,Qe,rt,tt):i(Ce)){Ne.push(Tt.i/Ge|0),Ne.push(Ce.i/Ge|0),Ne.push(nt.i/Ge|0),ne(Ce),Ce=nt.next,mt=nt.next;continue}if(Ce=nt,Ce===mt){lt?lt===1?(Ce=s(t(Ce),Ne,Ge),n(Ce,Ne,Ge,Qe,rt,tt,2)):lt===2&&c(Ce,Ne,Ge,Qe,rt,tt):n(t(Ce),Ne,Ge,Qe,rt,tt,1);break}}}}function i(Ce){var Ne=Ce.prev,Ge=Ce,Qe=Ce.next;if(K(Ne,Ge,Qe)>=0)return!1;for(var rt=Ne.x,tt=Ge.x,lt=Qe.x,mt=Ne.y,Tt=Ge.y,nt=Qe.y,cr=rt<tt?rt<lt?rt:lt:tt<lt?tt:lt,$t=mt<Tt?mt<nt?mt:nt:Tt<nt?Tt:nt,Jt=rt>tt?rt>lt?rt:lt:tt>lt?tt:lt,Lt=mt>Tt?mt>nt?mt:nt:Tt>nt?Tt:nt,lr=Qe.next;lr!==Ne;){if(lr.x>=cr&&lr.x<=Jt&&lr.y>=$t&&lr.y<=Lt&&z(rt,mt,tt,Tt,lt,nt,lr.x,lr.y)&&K(lr.prev,lr,lr.next)>=0)return!1;lr=lr.next}return!0}function o(Ce,Ne,Ge,Qe){var rt=Ce.prev,tt=Ce,lt=Ce.next;if(K(rt,tt,lt)>=0)return!1;for(var mt=rt.x,Tt=tt.x,nt=lt.x,cr=rt.y,$t=tt.y,Jt=lt.y,Lt=mt<Tt?mt<nt?mt:nt:Tt<nt?Tt:nt,lr=cr<$t?cr<Jt?cr:Jt:$t<Jt?$t:Jt,tn=mt>Tt?mt>nt?mt:nt:Tt>nt?Tt:nt,Er=cr>$t?cr>Jt?cr:Jt:$t>Jt?$t:Jt,Ar=U(Lt,lr,Ne,Ge,Qe),In=U(tn,Er,Ne,Ge,Qe),hr=Ce.prevZ,pr=Ce.nextZ;hr&&hr.z>=Ar&&pr&&pr.z<=In;){if(hr.x>=Lt&&hr.x<=tn&&hr.y>=lr&&hr.y<=Er&&hr!==rt&&hr!==lt&&z(mt,cr,Tt,$t,nt,Jt,hr.x,hr.y)&&K(hr.prev,hr,hr.next)>=0||(hr=hr.prevZ,pr.x>=Lt&&pr.x<=tn&&pr.y>=lr&&pr.y<=Er&&pr!==rt&&pr!==lt&&z(mt,cr,Tt,$t,nt,Jt,pr.x,pr.y)&&K(pr.prev,pr,pr.next)>=0))return!1;pr=pr.nextZ}for(;hr&&hr.z>=Ar;){if(hr.x>=Lt&&hr.x<=tn&&hr.y>=lr&&hr.y<=Er&&hr!==rt&&hr!==lt&&z(mt,cr,Tt,$t,nt,Jt,hr.x,hr.y)&&K(hr.prev,hr,hr.next)>=0)return!1;hr=hr.prevZ}for(;pr&&pr.z<=In;){if(pr.x>=Lt&&pr.x<=tn&&pr.y>=lr&&pr.y<=Er&&pr!==rt&&pr!==lt&&z(mt,cr,Tt,$t,nt,Jt,pr.x,pr.y)&&K(pr.prev,pr,pr.next)>=0)return!1;pr=pr.nextZ}return!0}function s(Ce,Ne,Ge){var Qe=Ce;do{var rt=Qe.prev,tt=Qe.next.next;!fe(rt,tt)&&Q(rt,Qe,Qe.next,tt)&&Ae(rt,tt)&&Ae(tt,rt)&&(Ne.push(rt.i/Ge|0),Ne.push(Qe.i/Ge|0),Ne.push(tt.i/Ge|0),ne(Qe),ne(Qe.next),Qe=Ce=tt),Qe=Qe.next}while(Qe!==Ce);return t(Qe)}function c(Ce,Ne,Ge,Qe,rt,tt){var lt=Ce;do{for(var mt=lt.next.next;mt!==lt.prev;){if(lt.i!==mt.i&&V(lt,mt)){var Tt=pe(lt,mt);lt=t(lt,lt.next),Tt=t(Tt,Tt.next),n(lt,Ne,Ge,Qe,rt,tt,0),n(Tt,Ne,Ge,Qe,rt,tt,0);return}mt=mt.next}lt=lt.next}while(lt!==Ce)}function f(Ce,Ne,Ge,Qe){var rt=[],tt,lt,mt,Tt,nt;for(tt=0,lt=Ne.length;tt<lt;tt++)mt=Ne[tt]*Qe,Tt=tt<lt-1?Ne[tt+1]*Qe:Ce.length,nt=e(Ce,mt,Tt,Qe,!1),nt===nt.next&&(nt.steiner=!0),rt.push(j(nt));for(rt.sort(g),tt=0;tt<rt.length;tt++)Ge=b(rt[tt],Ge);return Ge}function g(Ce,Ne){return Ce.x-Ne.x}function b(Ce,Ne){var Ge=T(Ce,Ne);if(!Ge)return Ne;var Qe=pe(Ge,Ce);return t(Qe,Qe.next),t(Ge,Ge.next)}function T(Ce,Ne){var Ge=Ne,Qe=Ce.x,rt=Ce.y,tt=-1/0,lt;do{if(rt<=Ge.y&&rt>=Ge.next.y&&Ge.next.y!==Ge.y){var mt=Ge.x+(rt-Ge.y)*(Ge.next.x-Ge.x)/(Ge.next.y-Ge.y);if(mt<=Qe&&mt>tt&&(tt=mt,lt=Ge.x<Ge.next.x?Ge:Ge.next,mt===Qe))return lt}Ge=Ge.next}while(Ge!==Ne);if(!lt)return null;var Tt=lt,nt=lt.x,cr=lt.y,$t=1/0,Jt;Ge=lt;do Qe>=Ge.x&&Ge.x>=nt&&Qe!==Ge.x&&z(rt<cr?Qe:tt,rt,nt,cr,rt<cr?tt:Qe,rt,Ge.x,Ge.y)&&(Jt=Math.abs(rt-Ge.y)/(Qe-Ge.x),Ae(Ge,Ce)&&(Jt<$t||Jt===$t&&(Ge.x>lt.x||Ge.x===lt.x&&S(lt,Ge)))&&(lt=Ge,$t=Jt)),Ge=Ge.next;while(Ge!==Tt);return lt}function S(Ce,Ne){return K(Ce.prev,Ce,Ne.prev)<0&&K(Ne.next,Ce,Ce.next)<0}function F(Ce,Ne,Ge,Qe){var rt=Ce;do rt.z===0&&(rt.z=U(rt.x,rt.y,Ne,Ge,Qe)),rt.prevZ=rt.prev,rt.nextZ=rt.next,rt=rt.next;while(rt!==Ce);rt.prevZ.nextZ=null,rt.prevZ=null,k(rt)}function k(Ce){var Ne,Ge,Qe,rt,tt,lt,mt,Tt,nt=1;do{for(Ge=Ce,Ce=null,tt=null,lt=0;Ge;){for(lt++,Qe=Ge,mt=0,Ne=0;Ne<nt&&(mt++,Qe=Qe.nextZ,!!Qe);Ne++);for(Tt=nt;mt>0||Tt>0&&Qe;)mt!==0&&(Tt===0||!Qe||Ge.z<=Qe.z)?(rt=Ge,Ge=Ge.nextZ,mt--):(rt=Qe,Qe=Qe.nextZ,Tt--),tt?tt.nextZ=rt:Ce=rt,rt.prevZ=tt,tt=rt;Ge=Qe}tt.nextZ=null,nt*=2}while(lt>1);return Ce}function U(Ce,Ne,Ge,Qe,rt){return Ce=(Ce-Ge)*rt|0,Ne=(Ne-Qe)*rt|0,Ce=(Ce|Ce<<8)&16711935,Ce=(Ce|Ce<<4)&252645135,Ce=(Ce|Ce<<2)&858993459,Ce=(Ce|Ce<<1)&1431655765,Ne=(Ne|Ne<<8)&16711935,Ne=(Ne|Ne<<4)&252645135,Ne=(Ne|Ne<<2)&858993459,Ne=(Ne|Ne<<1)&1431655765,Ce|Ne<<1}function j(Ce){var Ne=Ce,Ge=Ce;do(Ne.x<Ge.x||Ne.x===Ge.x&&Ne.y<Ge.y)&&(Ge=Ne),Ne=Ne.next;while(Ne!==Ce);return Ge}function z(Ce,Ne,Ge,Qe,rt,tt,lt,mt){return(rt-lt)*(Ne-mt)>=(Ce-lt)*(tt-mt)&&(Ce-lt)*(Qe-mt)>=(Ge-lt)*(Ne-mt)&&(Ge-lt)*(tt-mt)>=(rt-lt)*(Qe-mt)}function V(Ce,Ne){return Ce.next.i!==Ne.i&&Ce.prev.i!==Ne.i&&!ze(Ce,Ne)&&(Ae(Ce,Ne)&&Ae(Ne,Ce)&&_e(Ce,Ne)&&(K(Ce.prev,Ce,Ne.prev)||K(Ce,Ne.prev,Ne))||fe(Ce,Ne)&&K(Ce.prev,Ce,Ce.next)>0&&K(Ne.prev,Ne,Ne.next)>0)}function K(Ce,Ne,Ge){return(Ne.y-Ce.y)*(Ge.x-Ne.x)-(Ne.x-Ce.x)*(Ge.y-Ne.y)}function fe(Ce,Ne){return Ce.x===Ne.x&&Ce.y===Ne.y}function Q(Ce,Ne,Ge,Qe){var rt=Te(K(Ce,Ne,Ge)),tt=Te(K(Ce,Ne,Qe)),lt=Te(K(Ge,Qe,Ce)),mt=Te(K(Ge,Qe,Ne));return!!(rt!==tt&&lt!==mt||rt===0&&oe(Ce,Ge,Ne)||tt===0&&oe(Ce,Qe,Ne)||lt===0&&oe(Ge,Ce,Qe)||mt===0&&oe(Ge,Ne,Qe))}function oe(Ce,Ne,Ge){return Ne.x<=Math.max(Ce.x,Ge.x)&&Ne.x>=Math.min(Ce.x,Ge.x)&&Ne.y<=Math.max(Ce.y,Ge.y)&&Ne.y>=Math.min(Ce.y,Ge.y)}function Te(Ce){return Ce>0?1:Ce<0?-1:0}function ze(Ce,Ne){var Ge=Ce;do{if(Ge.i!==Ce.i&&Ge.next.i!==Ce.i&&Ge.i!==Ne.i&&Ge.next.i!==Ne.i&&Q(Ge,Ge.next,Ce,Ne))return!0;Ge=Ge.next}while(Ge!==Ce);return!1}function Ae(Ce,Ne){return K(Ce.prev,Ce,Ce.next)<0?K(Ce,Ne,Ce.next)>=0&&K(Ce,Ce.prev,Ne)>=0:K(Ce,Ne,Ce.prev)<0||K(Ce,Ce.next,Ne)<0}function _e(Ce,Ne){var Ge=Ce,Qe=!1,rt=(Ce.x+Ne.x)/2,tt=(Ce.y+Ne.y)/2;do Ge.y>tt!=Ge.next.y>tt&&Ge.next.y!==Ge.y&&rt<(Ge.next.x-Ge.x)*(tt-Ge.y)/(Ge.next.y-Ge.y)+Ge.x&&(Qe=!Qe),Ge=Ge.next;while(Ge!==Ce);return Qe}function pe(Ce,Ne){var Ge=new Be(Ce.i,Ce.x,Ce.y),Qe=new Be(Ne.i,Ne.x,Ne.y),rt=Ce.next,tt=Ne.prev;return Ce.next=Ne,Ne.prev=Ce,Ge.next=rt,rt.prev=Ge,Qe.next=Ge,Ge.prev=Qe,tt.next=Qe,Qe.prev=tt,Qe}function X(Ce,Ne,Ge,Qe){var rt=new Be(Ce,Ne,Ge);return Qe?(rt.next=Qe.next,rt.prev=Qe,Qe.next.prev=rt,Qe.next=rt):(rt.prev=rt,rt.next=rt),rt}function ne(Ce){Ce.next.prev=Ce.prev,Ce.prev.next=Ce.next,Ce.prevZ&&(Ce.prevZ.nextZ=Ce.nextZ),Ce.nextZ&&(Ce.nextZ.prevZ=Ce.prevZ)}function Be(Ce,Ne,Ge){this.i=Ce,this.x=Ne,this.y=Ge,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}r.deviation=function(Ce,Ne,Ge,Qe){var rt=Ne&&Ne.length,tt=rt?Ne[0]*Ge:Ce.length,lt=Math.abs(Ze(Ce,0,tt,Ge));if(rt)for(var mt=0,Tt=Ne.length;mt<Tt;mt++){var nt=Ne[mt]*Ge,cr=mt<Tt-1?Ne[mt+1]*Ge:Ce.length;lt-=Math.abs(Ze(Ce,nt,cr,Ge))}var $t=0;for(mt=0;mt<Qe.length;mt+=3){var Jt=Qe[mt]*Ge,Lt=Qe[mt+1]*Ge,lr=Qe[mt+2]*Ge;$t+=Math.abs((Ce[Jt]-Ce[lr])*(Ce[Lt+1]-Ce[Jt+1])-(Ce[Jt]-Ce[Lt])*(Ce[lr+1]-Ce[Jt+1]))}return lt===0&&$t===0?0:Math.abs(($t-lt)/lt)};function Ze(Ce,Ne,Ge,Qe){for(var rt=0,tt=Ne,lt=Ge-Qe;tt<Ge;tt+=Qe)rt+=(Ce[lt]-Ce[tt])*(Ce[tt+1]+Ce[lt+1]),lt=tt;return rt}return r.flatten=function(Ce){for(var Ne=Ce[0][0].length,Ge={vertices:[],holes:[],dimensions:Ne},Qe=0,rt=0;rt<Ce.length;rt++){for(var tt=0;tt<Ce[rt].length;tt++)for(var lt=0;lt<Ne;lt++)Ge.vertices.push(Ce[rt][tt][lt]);rt>0&&(Qe+=Ce[rt-1].length,Ge.holes.push(Qe))}return Ge},N0.exports}var Fne=Rne();const C6=th(Fne),k0=_w.CLOCKWISE,HI=_w.COUNTER_CLOCKWISE,Ou={};function Dne(r){if(r=r&&r.positions||r,!Array.isArray(r)&&!ArrayBuffer.isView(r))throw new Error("invalid polygon")}function Ip(r){return"positions"in r?r.positions:r}function wm(r){return"holeIndices"in r?r.holeIndices:null}function One(r){return Array.isArray(r[0])}function Lne(r){return r.length>=1&&r[0].length>=2&&Number.isFinite(r[0][0])}function Nne(r){const e=r[0],t=r[r.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function kne(r,e,t,n){for(let i=0;i<e;i++)if(r[t+i]!==r[n-e+i])return!1;return!0}function jI(r,e,t,n,i){let o=e;const s=t.length;for(let c=0;c<s;c++)for(let f=0;f<n;f++)r[o++]=t[c][f]||0;if(!Nne(t))for(let c=0;c<n;c++)r[o++]=t[0][c]||0;return Ou.start=e,Ou.end=o,Ou.size=n,yw(r,i,Ou),o}function JI(r,e,t,n,i=0,o,s){o=o||t.length;const c=o-i;if(c<=0)return e;let f=e;for(let g=0;g<c;g++)r[f++]=t[i+g];if(!kne(t,n,i,o))for(let g=0;g<n;g++)r[f++]=t[i+g];return Ou.start=e,Ou.end=f,Ou.size=n,yw(r,s,Ou),f}function E6(r,e){Dne(r);const t=[],n=[];if("positions"in r){const{positions:i,holeIndices:o}=r;if(o){let s=0;for(let c=0;c<=o.length;c++)s=JI(t,s,i,e,o[c-1],o[c],c===0?k0:HI),n.push(s);return n.pop(),{positions:t,holeIndices:n}}r=i}if(!One(r))return JI(t,0,r,e,0,t.length,k0),t;if(!Lne(r)){let i=0;for(const[o,s]of r.entries())i=jI(t,i,s,e,o===0?k0:HI),n.push(i);return n.pop(),{positions:t,holeIndices:n}}return jI(t,0,r,e,k0),t}function p1(r,e,t){const n=r.length/3;let i=0;for(let o=0;o<n;o++){const s=(o+1)%n;i+=r[o*3+e]*r[s*3+t],i-=r[s*3+e]*r[o*3+t]}return Math.abs(i/2)}function WI(r,e,t,n){const i=r.length/3;for(let o=0;o<i;o++){const s=o*3,c=r[s+0],f=r[s+1],g=r[s+2];r[s+e]=c,r[s+t]=f,r[s+n]=g}}function Une(r,e,t,n){let i=wm(r);i&&(i=i.map(c=>c/e));let o=Ip(r);const s=n&&e===3;if(t){const c=o.length;o=o.slice();const f=[];for(let g=0;g<c;g+=e){f[0]=o[g],f[1]=o[g+1],s&&(f[2]=o[g+2]);const b=t(f);o[g]=b[0],o[g+1]=b[1],s&&(o[g+2]=b[2])}}if(s){const c=p1(o,0,1),f=p1(o,0,2),g=p1(o,1,2);if(!c&&!f&&!g)return[];c>f&&c>g||(f>g?(t||(o=o.slice()),WI(o,0,2,1)):(t||(o=o.slice()),WI(o,2,0,1)))}return C6(o,i,e)}class zne extends uO{constructor(e){const{fp64:t,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=E6(e,this.positionSize);return this.opts.resolution?y6(Ip(t),wm(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?gne(Ip(t),wm(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(XI(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}return Ip(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&XI(e))for(const n of e){const i=this.getGeometrySize(n);t.geometrySize=i,this.updateGeometryAttributes(n,t),t.vertexStart+=i,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const n=e;this._updateIndices(n,t),this._updatePositions(n,t),this._updateVertexValid(n,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:n,indexStart:i}){const{attributes:o,indexStarts:s,typedArrayManager:c}=this;let f=o.indices;if(!f||!e)return;let g=i;const b=Une(e,this.positionSize,this.opts.preproject,this.opts.full3d);f=c.allocate(f,i+b.length,{copy:!0});for(let T=0;T<b.length;T++)f[g++]=b[T]+n;s[t+1]=i+b.length,o.indices=f}_updatePositions(e,{vertexStart:t,geometrySize:n}){const{attributes:{positions:i},positionSize:o}=this;if(!i||!e)return;const s=Ip(e);for(let c=t,f=0;f<n;c++,f++){const g=s[f*o],b=s[f*o+1],T=o>2?s[f*o+2]:0;i[c*3]=g,i[c*3+1]=b,i[c*3+2]=T}}_updateVertexValid(e,{vertexStart:t,geometrySize:n}){const{positionSize:i}=this,o=this.attributes.vertexValid,s=e&&wm(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,t):o.fill(1,t,t+n),s)for(let c=0;c<s.length;c++)o[t+s[c]/i-1]=0;o[t+n-1]=0}}function XI(r){return Array.isArray(r)&&r.length>0&&!Number.isFinite(r[0])}const T6=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Gne=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${T6}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Vne=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${T6}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Hne=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,u_=[0,0,0,255],jne={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:r=>r.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:u_},getLineColor:{type:"accessor",value:u_},material:!0},U0={enter:(r,e)=>e.length?e.subarray(e.length-r.length):r};class Zu extends cs{getShaders(e){return super.getShaders({vs:e==="top"?Gne:Vne,fs:Hne,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[_o,W_,Fo]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:n}=this.props;e.isGeospatial&&t===Wr.DEFAULT&&(t=Wr.LNGLAT);let i;t===Wr.LNGLAT&&(n?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new zne({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const o=this.getAttributeManager(),s=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:U0,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:U0,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:U0,accessor:"getFillColor",defaultValue:u_},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:U0,accessor:"getLineColor",defaultValue:u_},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(c,{index:f,target:g})=>this.encodePickingColor(c&&c.__source?c.__source.index:f,g)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(o=>o.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:n,wireframe:i,elevationScale:o}=this.props,{topModel:s,sideModel:c,wireframeModel:f,polygonTesselator:g}=this.state,b={...e,extruded:!!t,elevationScale:o};f&&i&&(f.setInstanceCount(g.instanceCount-1),f.setUniforms(b),f.draw(this.context.renderPass)),c&&n&&(c.setInstanceCount(g.instanceCount-1),c.setUniforms(b),c.draw(this.context.renderPass)),s&&n&&(s.setVertexCount(g.vertexCount),s.setUniforms(b),s.draw(this.context.renderPass))}updateState(e){var c;super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:n,changeFlags:i}=e,o=this.getAttributeManager();(i.extensionsChanged||t.filled!==n.filled||t.extruded!==n.extruded)&&((c=this.state.models)==null||c.forEach(f=>f.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:o}=this.state,s=e.data.attributes||{};o.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:s.getPolygon,buffers:s,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:n}=this.props;let i,o,s;if(t){const c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1;const f=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new mi(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:f,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const c=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new mi(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:c,uniforms:{isWireframe:!1},geometry:new Ts({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new mi(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:c,uniforms:{isWireframe:!0},geometry:new Ts({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,s,i].filter(Boolean),topModel:i,sideModel:o,wireframeModel:s}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Zu.defaultProps=jne;Zu.layerName="SolidPolygonLayer";function B6({data:r,getIndex:e,dataRange:t,replace:n}){const{startRow:i=0,endRow:o=1/0}=t,s=r.length;let c=s,f=s;for(let S=0;S<s;S++){const F=e(r[S]);if(c>S&&F>=i&&(c=S),F>=o){f=S;break}}let g=c;const T=f-c!==n.length?r.slice(f):void 0;for(let S=0;S<n.length;S++)r[g++]=n[S];if(T){for(let S=0;S<T.length;S++)r[g++]=T[S];r.length=g}return{startRow:c,endRow:c+n.length}}const S6=[0,0,0,255],Jne=[0,0,0,255],Wne={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:r=>r.polygon},getFillColor:{type:"accessor",value:Jne},getLineColor:{type:"accessor",value:S6},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Yu extends gs{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&Ur.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const n=this.state.paths.slice(),i=e.dataChanged.map(o=>B6({data:n,getIndex:s=>s.__source.index,dataRange:o,replace:this._getPaths(o)}));this.setState({paths:n,pathsDiff:i})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:n,positionFormat:i,_normalize:o}=this.props,s=[],c=i==="XY"?2:3,{startRow:f,endRow:g}=e,{iterable:b,objectInfo:T}=el(t,f,g);for(const S of b){T.index++;let F=n(S,T);o&&(F=E6(F,c));const{holeIndices:k}=F,U=F.positions||F;if(k)for(let j=0;j<=k.length;j++){const z=U.slice(k[j-1]||0,k[j]||U.length);s.push(this.getSubLayerRow({path:z},S,T.index))}else s.push(this.getSubLayerRow({path:U},S,T.index))}return s}renderLayers(){const{data:e,_dataDiff:t,stroked:n,filled:i,extruded:o,wireframe:s,_normalize:c,_windingOrder:f,elevationScale:g,transitions:b,positionFormat:T}=this.props,{lineWidthUnits:S,lineWidthScale:F,lineWidthMinPixels:k,lineWidthMaxPixels:U,lineJointRounded:j,lineMiterLimit:z,lineDashJustified:V}=this.props,{getFillColor:K,getLineColor:fe,getLineWidth:Q,getLineDashArray:oe,getElevation:Te,getPolygon:ze,updateTriggers:Ae,material:_e}=this.props,{paths:pe,pathsDiff:X}=this.state,ne=this.getSubLayerClass("fill",Zu),Be=this.getSubLayerClass("stroke",ch),Ze=this.shouldRenderSubLayer("fill",pe)&&new ne({_dataDiff:t,extruded:o,elevationScale:g,filled:i,wireframe:s,_normalize:c,_windingOrder:f,getElevation:Te,getFillColor:K,getLineColor:o&&s?fe:S6,material:_e,transitions:b},this.getSubLayerProps({id:"fill",updateTriggers:Ae&&{getPolygon:Ae.getPolygon,getElevation:Ae.getElevation,getFillColor:Ae.getFillColor,lineColors:o&&s,getLineColor:Ae.getLineColor}}),{data:e,positionFormat:T,getPolygon:ze}),Ce=!o&&n&&this.shouldRenderSubLayer("stroke",pe)&&new Be({_dataDiff:X&&(()=>X),widthUnits:S,widthScale:F,widthMinPixels:k,widthMaxPixels:U,jointRounded:j,miterLimit:z,dashJustified:V,_pathType:"loop",transitions:b&&{getWidth:b.getLineWidth,getColor:b.getLineColor,getPath:b.getPolygon},getColor:this.getSubLayerAccessor(fe),getWidth:this.getSubLayerAccessor(Q),getDashArray:this.getSubLayerAccessor(oe)},this.getSubLayerProps({id:"stroke",updateTriggers:Ae&&{getWidth:Ae.getLineWidth,getColor:Ae.getLineColor,getDashArray:Ae.getLineDashArray}}),{data:pe,positionFormat:T,getPath:Ne=>Ne.path});return[!o&&Ze,Ce,o&&Ze]}}Yu.layerName="PolygonLayer";Yu.defaultProps=Wne;function Xne(r,e){if(!r)return null;const t="startIndices"in r?r.startIndices[e]:e,n=r.featureIds.value[t];return t!==-1?$ne(r,n,t):null}function $ne(r,e,t){const n={properties:{...r.properties[e]}};for(const i in r.numericProps)n.properties[i]=r.numericProps[i].value[t];return n}function Kne(r,e){const t={points:null,lines:null,polygons:null};for(const n in t){const i=r[n].globalFeatureIds.value;t[n]=new Uint8ClampedArray(i.length*4);const o=[];for(let s=0;s<i.length;s++)e(i[s],o),t[n][s*4+0]=o[0],t[n][s*4+1]=o[1],t[n][s*4+2]=o[2],t[n][s*4+3]=255}return t}const qne=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,g1=192/256,$I=[],Zne={getIconOffsets:{type:"accessor",value:r=>r.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class ay extends CA{getShaders(){return{...super.getShaders(),fs:qne}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:n,target:i})=>this.encodePickingColor(n,i)}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;let{outlineColor:i}=t;i!==n.outlineColor&&(i=i.map(o=>o/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&Ur.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:n,outlineWidth:i}=this.props,{outlineColor:o}=this.state,s=i?Math.max(n,g1*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:g1,outlineBuffer:s,gamma:n,sdf:!!t,outlineColor:o},super.draw(e),t&&i){const{iconManager:c}=this.state,f=c.getTexture(),g=this.state.model;f&&(g.setUniforms({outlineBuffer:g1}),g.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):$I}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):$I}}ay.defaultProps=Zne;ay.layerName="MultiIconLayer";const f_=1e20;class Yne{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:o="sans-serif",fontWeight:s="normal",fontStyle:c="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=n;const f=this.size=e+t*4,g=this._createCanvas(f),b=this.ctx=g.getContext("2d",{willReadFrequently:!0});b.font=`${c} ${s} ${e}px ${o}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:o,actualBoundingBoxRight:s}=this.ctx.measureText(e),c=Math.ceil(n),f=0,g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-o))),b=Math.min(this.size-this.buffer,c+Math.ceil(i)),T=g+2*this.buffer,S=b+2*this.buffer,F=Math.max(T*S,0),k=new Uint8ClampedArray(F),U={data:k,width:T,height:S,glyphWidth:g,glyphHeight:b,glyphTop:c,glyphLeft:f,glyphAdvance:t};if(g===0||b===0)return U;const{ctx:j,buffer:z,gridInner:V,gridOuter:K}=this;j.clearRect(z,z,g,b),j.fillText(e,z,z+c);const fe=j.getImageData(z,z,g,b);K.fill(f_,0,F),V.fill(0,0,F);for(let Q=0;Q<b;Q++)for(let oe=0;oe<g;oe++){const Te=fe.data[4*(Q*g+oe)+3]/255;if(Te===0)continue;const ze=(Q+z)*T+oe+z;if(Te===1)K[ze]=0,V[ze]=f_;else{const Ae=.5-Te;K[ze]=Ae>0?Ae*Ae:0,V[ze]=Ae<0?Ae*Ae:0}}KI(K,0,0,T,S,T,this.f,this.v,this.z),KI(V,z,z,g,b,T,this.f,this.v,this.z);for(let Q=0;Q<F;Q++){const oe=Math.sqrt(K[Q])-Math.sqrt(V[Q]);k[Q]=Math.round(255-255*(oe/this.radius+this.cutoff))}return U}}function KI(r,e,t,n,i,o,s,c,f){for(let g=e;g<e+n;g++)qI(r,t*o+g,o,i,s,c,f);for(let g=t;g<t+i;g++)qI(r,g*o+e,1,n,s,c,f)}function qI(r,e,t,n,i,o,s){o[0]=0,s[0]=-1e20,s[1]=f_,i[0]=r[e];for(let c=1,f=0,g=0;c<n;c++){i[c]=r[e+c*t];const b=c*c;do{const T=o[f];g=(i[c]-i[T]+b-T*T)/(c-T)/2}while(g<=s[f]&&--f>-1);f++,o[f]=c,s[f]=g,s[f+1]=f_}for(let c=0,f=0;c<n;c++){for(;s[f+1]<c;)f++;const g=o[f],b=c-g;r[e+c*t]=i[g]+b*b}}const Qne=32,eie=[];function tie(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function rie({characterSet:r,getFontWidth:e,fontHeight:t,buffer:n,maxCanvasWidth:i,mapping:o={},xOffset:s=0,yOffset:c=0}){let f=0,g=s;const b=t+n*2;for(const T of r)if(!o[T]){const S=e(T);g+S+n*2>i&&(g=0,f++),o[T]={x:g+n,y:c+f*b+n,width:S,height:b,layoutWidth:S,layoutHeight:t},g+=S+n*2}return{mapping:o,xOffset:g,yOffset:c+f*b,canvasHeight:tie(c+(f+1)*b)}}function I6(r,e,t,n){var o;let i=0;for(let s=e;s<t;s++){const c=r[s];i+=((o=n[c])==null?void 0:o.layoutWidth)||0}return i}function M6(r,e,t,n,i,o){let s=e,c=0;for(let f=e;f<t;f++){const g=I6(r,f,f+1,i);c+g>n&&(s<f&&o.push(f),s=f,c=0),c+=g}return c}function nie(r,e,t,n,i,o){let s=e,c=e,f=e,g=0;for(let b=e;b<t;b++)if((r[b]===" "||r[b+1]===" "||b+1===t)&&(f=b+1),f>c){let T=I6(r,c,f,i);g+T>n&&(s<c&&(o.push(c),s=c,g=0),T>n&&(T=M6(r,c,f,n,i,o),s=o[o.length-1])),c=f,g+=T}return g}function iie(r,e,t,n,i=0,o){o===void 0&&(o=r.length);const s=[];return e==="break-all"?M6(r,i,o,t,n,s):nie(r,i,o,t,n,s),s}function sie(r,e,t,n,i,o){let s=0,c=0;for(let f=e;f<t;f++){const g=r[f],b=n[g];b?(c||(c=b.layoutHeight),i[f]=s+b.layoutWidth/2,s+=b.layoutWidth):(Ur.warn(`Missing character: ${g} (${g.codePointAt(0)})`)(),i[f]=s,s+=Qne)}o[0]=s,o[1]=c}function oie(r,e,t,n,i){var j;const o=Array.from(r),s=o.length,c=new Array(s),f=new Array(s),g=new Array(s),b=(t==="break-word"||t==="break-all")&&isFinite(n)&&n>0,T=[0,0],S=[0,0];let F=0,k=0,U=0;for(let z=0;z<=s;z++){const V=o[z];if((V===`
`||z===s)&&(U=z),U>k){const K=b?iie(o,t,n,i,k,U):eie;for(let fe=0;fe<=K.length;fe++){const Q=fe===0?k:K[fe-1],oe=fe<K.length?K[fe]:U;sie(o,Q,oe,i,c,S);for(let Te=Q;Te<oe;Te++){const ze=o[Te],Ae=((j=i[ze])==null?void 0:j.layoutOffsetY)||0;f[Te]=F+S[1]/2+Ae,g[Te]=S[0]}F=F+S[1]*e,T[0]=Math.max(T[0],S[0])}k=U}V===`
`&&(c[k]=0,f[k]=0,g[k]=0,k++)}return T[1]=F,{x:c,y:f,rowWidth:g,size:T}}function aie({value:r,length:e,stride:t,offset:n,startIndices:i,characterSet:o}){const s=r.BYTES_PER_ELEMENT,c=t?t/s:1,f=n?n/s:0,g=i[e]||Math.ceil((r.length-f)/c),b=o&&new Set,T=new Array(e);let S=r;if(c>1||f>0){const F=r.constructor;S=new F(g);for(let k=0;k<g;k++)S[k]=r[k*c+f]}for(let F=0;F<e;F++){const k=i[F],U=i[F+1]||g,j=S.subarray(k,U);T[F]=String.fromCodePoint.apply(null,j),b&&j.forEach(b.add,b)}if(b)for(const F of b)o.add(String.fromCodePoint(F));return{texts:T,characterCount:g}}class P6{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function cie(){const r=[];for(let e=32;e<128;e++)r.push(String.fromCharCode(e));return r}const Zd={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:cie(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},ZI=1024,YI=.9,QI=1.2,R6=3;let h_=new P6(R6);function lie(r,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const n=h_.get(r);if(!n)return t;for(const i in n.mapping)t.has(i)&&t.delete(i);return t}function uie(r,e){for(let t=0;t<r.length;t++)e.data[4*t+3]=r[t]}function eM(r,e,t,n){r.font=`${n} ${t}px ${e}`,r.fillStyle="#000",r.textBaseline="alphabetic",r.textAlign="left"}function fie(r){Ur.assert(Number.isFinite(r)&&r>=R6,"Invalid cache limit"),h_=new P6(r)}class hie{constructor(){this.props={...Zd}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*QI+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=lie(this._key,this.props.characterSet),n=h_.get(this._key);if(n&&t.size===0){this._atlas!==n&&(this._atlas=n);return}const i=this._generateFontAtlas(t,n);this._atlas=i,h_.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:n,fontWeight:i,fontSize:o,buffer:s,sdf:c,radius:f,cutoff:g}=this.props;let b=t&&t.data;b||(b=document.createElement("canvas"),b.width=ZI);const T=b.getContext("2d",{willReadFrequently:!0});eM(T,n,o,i);const{mapping:S,canvasHeight:F,xOffset:k,yOffset:U}=rie({getFontWidth:j=>T.measureText(j).width,fontHeight:o*QI,buffer:s,characterSet:e,maxCanvasWidth:ZI,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(b.height!==F){const j=T.getImageData(0,0,b.width,b.height);b.height=F,T.putImageData(j,0,0)}if(eM(T,n,o,i),c){const j=new Yne({fontSize:o,buffer:s,radius:f,cutoff:g,fontFamily:n,fontWeight:`${i}`});for(const z of e){const{data:V,width:K,height:fe,glyphTop:Q}=j.draw(z);S[z].width=K,S[z].layoutOffsetY=o*YI-Q;const oe=T.createImageData(K,fe);uie(V,oe),T.putImageData(oe,S[z].x,S[z].y)}}else for(const j of e)T.fillText(j,S[j].x,S[j].y+s+o*YI);return{xOffset:k,yOffset:U,mapping:S,data:b,width:b.width,height:b.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:n,buffer:i,sdf:o,radius:s,cutoff:c}=this.props;return o?`${e} ${t} ${n} ${i} ${s} ${c}`:`${e} ${t} ${n} ${i}`}}const die=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Aie=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,pie={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:r=>r.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Eg extends cs{getShaders(){return super.getShaders({vs:die,fs:Aie,modules:[_o,Fo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:n,sizeUnits:i,sizeMinPixels:o,sizeMaxPixels:s,getLineWidth:c}=this.props;let{padding:f}=this.props;f.length<4&&(f=[f[0],f[1],f[0],f[1]]);const g=this.state.model;g.setUniforms(e),g.setUniforms({billboard:t,stroked:!!c,padding:f,sizeUnits:ia[i],sizeScale:n,sizeMinPixels:o,sizeMaxPixels:s}),g.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new mi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ts({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}Eg.defaultProps=pie;Eg.layerName="TextBackgroundLayer";const tM={start:1,middle:0,end:-1},rM={top:1,center:0,bottom:-1},m1=[0,0,0,255],gie=1,mie={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:m1},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Zd.characterSet},fontFamily:Zd.fontFamily,fontWeight:Zd.fontWeight,lineHeight:gie,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:m1},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:r=>r.text},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:m1},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class lh extends gs{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[n,i]}=this.transformParagraph(e,t);const{fontSize:o}=this.state.fontAtlasManager.props;n/=o,i/=o;const{getTextAnchor:s,getAlignmentBaseline:c}=this.props,f=tM[typeof s=="function"?s(e,t):s],g=rM[typeof c=="function"?c(e,t):c];return[(f-1)*n/2,(g-1)*i/2,n,i]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:o,y:s,rowWidth:c,size:[f,g]}=this.transformParagraph(e,t),b=tM[typeof n=="function"?n(e,t):n],T=rM[typeof i=="function"?i(e,t):i],S=o.length,F=new Array(S*2);let k=0;for(let U=0;U<S;U++){const j=(1-b)*(f-c[U])/2;F[k++]=(b-1)*f/2+j+o[U],F[k++]=(T-1)*g/2+s[U]}return F}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new hie},this.props.maxWidth>0&&Ur.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:n,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==n.lineHeight||t.wordBreak!==n.wordBreak||t.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:o}=this.state,s={...e,characterSet:o,fontFamily:t,fontWeight:n};if(!i.mapping)return i.setProps(s),!0;for(const c in s)if(s[c]!==i.props[c])return i.setProps(s),!0;return!1}_updateText(){var f;const{data:e,characterSet:t}=this.props,n=(f=e.attributes)==null?void 0:f.getText;let{getText:i}=this.props,o=e.startIndices,s;const c=t==="auto"&&new Set;if(n&&o){const{texts:g,characterCount:b}=aie({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:o,characterSet:c});s=b,i=(T,{index:S})=>g[S]}else{const{iterable:g,objectInfo:b}=el(e);o=[0],s=0;for(const T of g){b.index++;const S=Array.from(i(T,b)||"");c&&S.forEach(c.add,c),s+=S.length,o.push(s)}}this.setState({getText:i,startIndices:o,numInstances:s,characterSet:c||t})}transformParagraph(e,t){const{fontAtlasManager:n}=this.state,i=n.mapping,o=this.state.getText,{wordBreak:s,lineHeight:c,maxWidth:f}=this.props,g=o(e,t)||"";return oie(g,c,s,f*n.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:n,fontAtlasManager:{scale:i,atlas:o,mapping:s},styleVersion:c}=this.state,{data:f,_dataDiff:g,getPosition:b,getColor:T,getSize:S,getAngle:F,getPixelOffset:k,getBackgroundColor:U,getBorderColor:j,getBorderWidth:z,backgroundPadding:V,background:K,billboard:fe,fontSettings:Q,outlineWidth:oe,outlineColor:Te,sizeScale:ze,sizeUnits:Ae,sizeMinPixels:_e,sizeMaxPixels:pe,transitions:X,updateTriggers:ne}=this.props,Be=this.getSubLayerClass("characters",ay),Ze=this.getSubLayerClass("background",Eg);return[K&&new Ze({getFillColor:U,getLineColor:j,getLineWidth:z,padding:V,getPosition:b,getSize:S,getAngle:F,getPixelOffset:k,billboard:fe,sizeScale:ze,sizeUnits:Ae,sizeMinPixels:_e,sizeMaxPixels:pe,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getSize:X.getSize,getFillColor:X.getBackgroundColor,getLineColor:X.getBorderColor,getLineWidth:X.getBorderWidth,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ne.getPosition,getAngle:ne.getAngle,getSize:ne.getSize,getFillColor:ne.getBackgroundColor,getLineColor:ne.getBorderColor,getLineWidth:ne.getBorderWidth,getPixelOffset:ne.getPixelOffset,getBoundingRect:{getText:ne.getText,getTextAnchor:ne.getTextAnchor,getAlignmentBaseline:ne.getAlignmentBaseline,styleVersion:c}}}),{data:f.attributes&&f.attributes.background?{length:f.length,attributes:f.attributes.background}:f,_dataDiff:g,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Be({sdf:Q.sdf,smoothing:Number.isFinite(Q.smoothing)?Q.smoothing:Zd.smoothing,outlineWidth:oe/(Q.radius||Zd.radius),outlineColor:Te,iconAtlas:o,iconMapping:s,getPosition:b,getColor:T,getSize:S,getAngle:F,getPixelOffset:k,billboard:fe,sizeScale:ze*i,sizeUnits:Ae,sizeMinPixels:_e*i,sizeMaxPixels:pe*i,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getColor:X.getColor,getSize:X.getSize,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ne.getText,getPosition:ne.getPosition,getAngle:ne.getAngle,getColor:ne.getColor,getSize:ne.getSize,getPixelOffset:ne.getPixelOffset,getIconOffsets:{getTextAnchor:ne.getTextAnchor,getAlignmentBaseline:ne.getAlignmentBaseline,styleVersion:c}}}),{data:f,_dataDiff:g,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){fie(e)}}lh.defaultProps=mie;lh.layerName="TextLayer";const Cm={circle:{type:Cg,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:CA,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:lh,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Em={type:ch,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},L2={type:Zu,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Ap({type:r,props:e}){const t={};for(const n in e)t[n]=r.defaultProps[e[n]];return t}function _1(r,e){const{transitions:t,updateTriggers:n}=r.props,i={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const o in e){const s=e[o];let c=r.props[o];o.startsWith("get")&&(c=r.getSubLayerAccessor(c),i.updateTriggers[s]=n[o],t&&(i.transitions[s]=t[o])),i[s]=c}return i}function _ie(r){if(Array.isArray(r))return r;switch(Ur.assert(r.type,"GeoJSON does not have type"),r.type){case"Feature":return[r];case"FeatureCollection":return Ur.assert(Array.isArray(r.features),"GeoJSON does not have features array"),r.features;default:return[{geometry:r}]}}function nM(r,e,t={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:o=r.length}=t;for(let s=i;s<o;s++){const c=r[s],{geometry:f}=c;if(f)if(f.type==="GeometryCollection"){Ur.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");const{geometries:g}=f;for(let b=0;b<g.length;b++){const T=g[b];iM(T,n,e,c,s)}}else iM(f,n,e,c,s)}return n}function iM(r,e,t,n,i){const{type:o,coordinates:s}=r,{pointFeatures:c,lineFeatures:f,polygonFeatures:g,polygonOutlineFeatures:b}=e;if(!vie(o,s)){Ur.warn(`${o} coordinates are malformed`)();return}switch(o){case"Point":c.push(t({geometry:r},n,i));break;case"MultiPoint":s.forEach(T=>{c.push(t({geometry:{type:"Point",coordinates:T}},n,i))});break;case"LineString":f.push(t({geometry:r},n,i));break;case"MultiLineString":s.forEach(T=>{f.push(t({geometry:{type:"LineString",coordinates:T}},n,i))});break;case"Polygon":g.push(t({geometry:r},n,i)),s.forEach(T=>{b.push(t({geometry:{type:"LineString",coordinates:T}},n,i))});break;case"MultiPolygon":s.forEach(T=>{g.push(t({geometry:{type:"Polygon",coordinates:T}},n,i)),T.forEach(S=>{b.push(t({geometry:{type:"LineString",coordinates:S}},n,i))})});break}}const yie={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function vie(r,e){let t=yie[r];for(Ur.assert(t,`Unknown GeoJSON type ${r}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function F6(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function z0(r){return r.geometry.coordinates}function bie(r,e){const t=F6(),{pointFeatures:n,lineFeatures:i,polygonFeatures:o,polygonOutlineFeatures:s}=r;return t.points.data=n,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=z0,t.lines.data=i,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=z0,t.polygons.data=o,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=z0,t.polygonsOutline.data=s,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=z0,t}function xie(r,e){const t=F6(),{points:n,lines:i,polygons:o}=r,s=Kne(r,e);return t.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:s.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},t.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:s.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines._pathType="open",t.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygons._normalize=!1,o.triangles&&(t.polygons.data.attributes.indices=o.triangles.value),t.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygonsOutline._pathType="open",t}const wie=["points","linestrings","polygons"],Cie={...Ap(Cm.circle),...Ap(Cm.icon),...Ap(Cm.text),...Ap(Em),...Ap(L2),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:r=>r.properties.icon},getText:{type:"accessor",value:r=>r.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Wl extends gs{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const n=xie(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:t}){const n=_ie(e.data),i=this.getSubLayerRow.bind(this);let o={};const s={};if(Array.isArray(t.dataChanged)){const f=this.state.features;for(const g in f)o[g]=f[g].slice(),s[g]=[];for(const g of t.dataChanged){const b=nM(n,i,g);for(const T in f)s[T].push(B6({data:o[T],getIndex:S=>S.__source.index,dataRange:g,replace:b[T]}))}}else o=nM(n,i);const c=bie(o,s);this.setState({features:o,featuresDiff:s,layerProps:c})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n,sourceLayer:i}=t;return t.featureType=wie.find(o=>i.id.startsWith(`${this.id}-${o}-`)),n>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[n]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,n=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(t)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){var s;const{extruded:e,wireframe:t}=this.props,{layerProps:n}=this.state,i="polygons-fill",o=this.shouldRenderSubLayer(i,(s=n.polygons)==null?void 0:s.data)&&this.getSubLayerClass(i,L2.type);if(o){const c=_1(this,L2.props),f=e&&t;return f||delete c.getLineColor,c.updateTriggers.lineColors=f,new o(c,this.getSubLayerProps({id:i,updateTriggers:c.updateTriggers}),n.polygons)}return null}_renderLineLayers(){var f,g;const{extruded:e,stroked:t}=this.props,{layerProps:n}=this.state,i="polygons-stroke",o="linestrings",s=!e&&t&&this.shouldRenderSubLayer(i,(f=n.polygonsOutline)==null?void 0:f.data)&&this.getSubLayerClass(i,Em.type),c=this.shouldRenderSubLayer(o,(g=n.lines)==null?void 0:g.data)&&this.getSubLayerClass(o,Em.type);if(s||c){const b=_1(this,Em.props);return[s&&new s(b,this.getSubLayerProps({id:i,updateTriggers:b.updateTriggers}),n.polygonsOutline),c&&new c(b,this.getSubLayerProps({id:o,updateTriggers:b.updateTriggers}),n.lines)]}return null}_renderPointLayers(){var c;const{pointType:e}=this.props,{layerProps:t,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=t.points.data.findIndex(f=>f.__source.index===i));const o=new Set(e.split("+")),s=[];for(const f of o){const g=`points-${f}`,b=Cm[f],T=b&&this.shouldRenderSubLayer(g,(c=t.points)==null?void 0:c.data)&&this.getSubLayerClass(g,b.type);if(T){const S=_1(this,b.props);let F=t.points;if(f==="text"&&n){const{instancePickingColors:k,...U}=F.data.attributes;F={...F,data:{...F.data,attributes:U}}}s.push(new T(S,this.getSubLayerProps({id:g,updateTriggers:S.updateTriggers,highlightedObjectIndex:i}),F))}}return s}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),n=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&t,n,i,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(n,i)=>{const{data:o,index:s}=i,c=Xne(o,s);return e(c,i)}}}Wl.layerName="GeoJsonLayer";Wl.defaultProps=Cie;const Eie=Object.freeze(Object.defineProperty({__proto__:null,ArcLayer:bg,BitmapLayer:sy,ColumnLayer:Jl,GeoJsonLayer:Wl,GridCellLayer:oy,IconLayer:CA,LineLayer:xg,PathLayer:ch,PointCloudLayer:wg,PolygonLayer:Yu,ScatterplotLayer:Cg,SolidPolygonLayer:Zu,TextLayer:lh,_MultiIconLayer:ay,_TextBackgroundLayer:Eg},Symbol.toStringTag,{value:"Module"}));function Tie(r){return typeof r=="string"?r.charAt(0).toLowerCase()+r.slice(1):r}function N2(r){if(Array.isArray(r))return r.map(e=>N2(e));if(r&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[Tie(t)]=N2(n);return e}return r}var y1={},v1={},sM;function vw(){return sM||(sM=1,function(r){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+e+"]["+t+"]*",i=new RegExp("^"+n+"$"),o=function(c,f){const g=[];let b=f.exec(c);for(;b;){const T=[];T.startIndex=f.lastIndex-b[0].length;const S=b.length;for(let F=0;F<S;F++)T.push(b[F]);g.push(T),b=f.exec(c)}return g},s=function(c){const f=i.exec(c);return!(f===null||typeof f>"u")};r.isExist=function(c){return typeof c<"u"},r.isEmptyObject=function(c){return Object.keys(c).length===0},r.merge=function(c,f,g){if(f){const b=Object.keys(f),T=b.length;for(let S=0;S<T;S++)g==="strict"?c[b[S]]=[f[b[S]]]:c[b[S]]=f[b[S]]}},r.getValue=function(c){return r.isExist(c)?c:""},r.isName=s,r.getAllMatches=o,r.nameRegexp=n}(v1)),v1}var oM;function D6(){if(oM)return y1;oM=1;const r=vw(),e={allowBooleanAttributes:!1,unpairedTags:[]};y1.validate=function(z,V){V=Object.assign({},e,V);const K=[];let fe=!1,Q=!1;z[0]==="\uFEFF"&&(z=z.substr(1));for(let oe=0;oe<z.length;oe++)if(z[oe]==="<"&&z[oe+1]==="?"){if(oe+=2,oe=n(z,oe),oe.err)return oe}else if(z[oe]==="<"){let Te=oe;if(oe++,z[oe]==="!"){oe=i(z,oe);continue}else{let ze=!1;z[oe]==="/"&&(ze=!0,oe++);let Ae="";for(;oe<z.length&&z[oe]!==">"&&z[oe]!==" "&&z[oe]!=="	"&&z[oe]!==`
`&&z[oe]!=="\r";oe++)Ae+=z[oe];if(Ae=Ae.trim(),Ae[Ae.length-1]==="/"&&(Ae=Ae.substring(0,Ae.length-1),oe--),!k(Ae)){let X;return Ae.trim().length===0?X="Invalid space after '<'.":X="Tag '"+Ae+"' is an invalid name.",S("InvalidTag",X,U(z,oe))}const _e=c(z,oe);if(_e===!1)return S("InvalidAttr","Attributes for '"+Ae+"' have open quote.",U(z,oe));let pe=_e.value;if(oe=_e.index,pe[pe.length-1]==="/"){const X=oe-pe.length;pe=pe.substring(0,pe.length-1);const ne=g(pe,V);if(ne===!0)fe=!0;else return S(ne.err.code,ne.err.msg,U(z,X+ne.err.line))}else if(ze)if(_e.tagClosed){if(pe.trim().length>0)return S("InvalidTag","Closing tag '"+Ae+"' can't have attributes or invalid starting.",U(z,Te));if(K.length===0)return S("InvalidTag","Closing tag '"+Ae+"' has not been opened.",U(z,Te));{const X=K.pop();if(Ae!==X.tagName){let ne=U(z,X.tagStartPos);return S("InvalidTag","Expected closing tag '"+X.tagName+"' (opened in line "+ne.line+", col "+ne.col+") instead of closing tag '"+Ae+"'.",U(z,Te))}K.length==0&&(Q=!0)}}else return S("InvalidTag","Closing tag '"+Ae+"' doesn't have proper closing.",U(z,oe));else{const X=g(pe,V);if(X!==!0)return S(X.err.code,X.err.msg,U(z,oe-pe.length+X.err.line));if(Q===!0)return S("InvalidXml","Multiple possible root nodes found.",U(z,oe));V.unpairedTags.indexOf(Ae)!==-1||K.push({tagName:Ae,tagStartPos:Te}),fe=!0}for(oe++;oe<z.length;oe++)if(z[oe]==="<")if(z[oe+1]==="!"){oe++,oe=i(z,oe);continue}else if(z[oe+1]==="?"){if(oe=n(z,++oe),oe.err)return oe}else break;else if(z[oe]==="&"){const X=T(z,oe);if(X==-1)return S("InvalidChar","char '&' is not expected.",U(z,oe));oe=X}else if(Q===!0&&!t(z[oe]))return S("InvalidXml","Extra text at the end",U(z,oe));z[oe]==="<"&&oe--}}else{if(t(z[oe]))continue;return S("InvalidChar","char '"+z[oe]+"' is not expected.",U(z,oe))}if(fe){if(K.length==1)return S("InvalidTag","Unclosed tag '"+K[0].tagName+"'.",U(z,K[0].tagStartPos));if(K.length>0)return S("InvalidXml","Invalid '"+JSON.stringify(K.map(oe=>oe.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return S("InvalidXml","Start tag expected.",1);return!0};function t(z){return z===" "||z==="	"||z===`
`||z==="\r"}function n(z,V){const K=V;for(;V<z.length;V++)if(z[V]=="?"||z[V]==" "){const fe=z.substr(K,V-K);if(V>5&&fe==="xml")return S("InvalidXml","XML declaration allowed only at the start of the document.",U(z,V));if(z[V]=="?"&&z[V+1]==">"){V++;break}else continue}return V}function i(z,V){if(z.length>V+5&&z[V+1]==="-"&&z[V+2]==="-"){for(V+=3;V<z.length;V++)if(z[V]==="-"&&z[V+1]==="-"&&z[V+2]===">"){V+=2;break}}else if(z.length>V+8&&z[V+1]==="D"&&z[V+2]==="O"&&z[V+3]==="C"&&z[V+4]==="T"&&z[V+5]==="Y"&&z[V+6]==="P"&&z[V+7]==="E"){let K=1;for(V+=8;V<z.length;V++)if(z[V]==="<")K++;else if(z[V]===">"&&(K--,K===0))break}else if(z.length>V+9&&z[V+1]==="["&&z[V+2]==="C"&&z[V+3]==="D"&&z[V+4]==="A"&&z[V+5]==="T"&&z[V+6]==="A"&&z[V+7]==="["){for(V+=8;V<z.length;V++)if(z[V]==="]"&&z[V+1]==="]"&&z[V+2]===">"){V+=2;break}}return V}const o='"',s="'";function c(z,V){let K="",fe="",Q=!1;for(;V<z.length;V++){if(z[V]===o||z[V]===s)fe===""?fe=z[V]:fe!==z[V]||(fe="");else if(z[V]===">"&&fe===""){Q=!0;break}K+=z[V]}return fe!==""?!1:{value:K,index:V,tagClosed:Q}}const f=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function g(z,V){const K=r.getAllMatches(z,f),fe={};for(let Q=0;Q<K.length;Q++){if(K[Q][1].length===0)return S("InvalidAttr","Attribute '"+K[Q][2]+"' has no space in starting.",j(K[Q]));if(K[Q][3]!==void 0&&K[Q][4]===void 0)return S("InvalidAttr","Attribute '"+K[Q][2]+"' is without value.",j(K[Q]));if(K[Q][3]===void 0&&!V.allowBooleanAttributes)return S("InvalidAttr","boolean attribute '"+K[Q][2]+"' is not allowed.",j(K[Q]));const oe=K[Q][2];if(!F(oe))return S("InvalidAttr","Attribute '"+oe+"' is an invalid name.",j(K[Q]));if(!fe.hasOwnProperty(oe))fe[oe]=1;else return S("InvalidAttr","Attribute '"+oe+"' is repeated.",j(K[Q]))}return!0}function b(z,V){let K=/\d/;for(z[V]==="x"&&(V++,K=/[\da-fA-F]/);V<z.length;V++){if(z[V]===";")return V;if(!z[V].match(K))break}return-1}function T(z,V){if(V++,z[V]===";")return-1;if(z[V]==="#")return V++,b(z,V);let K=0;for(;V<z.length;V++,K++)if(!(z[V].match(/\w/)&&K<20)){if(z[V]===";")break;return-1}return V}function S(z,V,K){return{err:{code:z,msg:V,line:K.line||K,col:K.col}}}function F(z){return r.isName(z)}function k(z){return r.isName(z)}function U(z,V){const K=z.substring(0,V).split(/\r?\n/);return{line:K.length,col:K[K.length-1].length+1}}function j(z){return z.startIndex+z[1].length}return y1}var G0={},aM;function Bie(){if(aM)return G0;aM=1;const r={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,n){return n},attributeValueProcessor:function(t,n){return n},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,n,i){return t}},e=function(t){return Object.assign({},r,t)};return G0.buildOptions=e,G0.defaultOptions=r,G0}var b1,cM;function Sie(){if(cM)return b1;cM=1;class r{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,n){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:n})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}return b1=r,b1}var x1,lM;function Iie(){if(lM)return x1;lM=1;const r=vw();function e(g,b){const T={};if(g[b+3]==="O"&&g[b+4]==="C"&&g[b+5]==="T"&&g[b+6]==="Y"&&g[b+7]==="P"&&g[b+8]==="E"){b=b+9;let S=1,F=!1,k=!1,U="";for(;b<g.length;b++)if(g[b]==="<"&&!k){if(F&&i(g,b))b+=7,[entityName,val,b]=t(g,b+1),val.indexOf("&")===-1&&(T[f(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(F&&o(g,b))b+=8;else if(F&&s(g,b))b+=8;else if(F&&c(g,b))b+=9;else if(n)k=!0;else throw new Error("Invalid DOCTYPE");S++,U=""}else if(g[b]===">"){if(k?g[b-1]==="-"&&g[b-2]==="-"&&(k=!1,S--):S--,S===0)break}else g[b]==="["?F=!0:U+=g[b];if(S!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:T,i:b}}function t(g,b){let T="";for(;b<g.length&&g[b]!=="'"&&g[b]!=='"';b++)T+=g[b];if(T=T.trim(),T.indexOf(" ")!==-1)throw new Error("External entites are not supported");const S=g[b++];let F="";for(;b<g.length&&g[b]!==S;b++)F+=g[b];return[T,F,b]}function n(g,b){return g[b+1]==="!"&&g[b+2]==="-"&&g[b+3]==="-"}function i(g,b){return g[b+1]==="!"&&g[b+2]==="E"&&g[b+3]==="N"&&g[b+4]==="T"&&g[b+5]==="I"&&g[b+6]==="T"&&g[b+7]==="Y"}function o(g,b){return g[b+1]==="!"&&g[b+2]==="E"&&g[b+3]==="L"&&g[b+4]==="E"&&g[b+5]==="M"&&g[b+6]==="E"&&g[b+7]==="N"&&g[b+8]==="T"}function s(g,b){return g[b+1]==="!"&&g[b+2]==="A"&&g[b+3]==="T"&&g[b+4]==="T"&&g[b+5]==="L"&&g[b+6]==="I"&&g[b+7]==="S"&&g[b+8]==="T"}function c(g,b){return g[b+1]==="!"&&g[b+2]==="N"&&g[b+3]==="O"&&g[b+4]==="T"&&g[b+5]==="A"&&g[b+6]==="T"&&g[b+7]==="I"&&g[b+8]==="O"&&g[b+9]==="N"}function f(g){if(r.isName(g))return g;throw new Error(`Invalid entity name ${g}`)}return x1=e,x1}var w1,uM;function Mie(){if(uM)return w1;uM=1;const r=/^[-+]?0x[a-fA-F0-9]+$/,e=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const t={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function n(o,s={}){if(s=Object.assign({},t,s),!o||typeof o!="string")return o;let c=o.trim();if(s.skipLike!==void 0&&s.skipLike.test(c))return o;if(s.hex&&r.test(c))return Number.parseInt(c,16);{const f=e.exec(c);if(f){const g=f[1],b=f[2];let T=i(f[3]);const S=f[4]||f[6];if(!s.leadingZeros&&b.length>0&&g&&c[2]!==".")return o;if(!s.leadingZeros&&b.length>0&&!g&&c[1]!==".")return o;{const F=Number(c),k=""+F;return k.search(/[eE]/)!==-1||S?s.eNotation?F:o:c.indexOf(".")!==-1?k==="0"&&T===""||k===T||g&&k==="-"+T?F:o:b?T===k||g+T===k?F:o:c===k||c===g+k?F:o}}else return o}}function i(o){return o&&o.indexOf(".")!==-1&&(o=o.replace(/0+$/,""),o==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substr(0,o.length-1))),o}return w1=n,w1}var C1,fM;function O6(){if(fM)return C1;fM=1;function r(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const n of e)if(typeof n=="string"&&t===n||n instanceof RegExp&&n.test(t))return!0}:()=>!1}return C1=r,C1}var E1,hM;function Pie(){if(hM)return E1;hM=1;const r=vw(),e=Sie(),t=Iie(),n=Mie(),i=O6();class o{constructor(oe){this.options=oe,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(Te,ze)=>String.fromCharCode(Number.parseInt(ze,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(Te,ze)=>String.fromCharCode(Number.parseInt(ze,16))}},this.addExternalEntities=s,this.parseXml=T,this.parseTextData=c,this.resolveNameSpace=f,this.buildAttributesMap=b,this.isItStopNode=U,this.replaceEntitiesValue=F,this.readStopNodeData=K,this.saveTextToParentTag=k,this.addChild=S,this.ignoreAttributesFn=i(this.options.ignoreAttributes)}}function s(Q){const oe=Object.keys(Q);for(let Te=0;Te<oe.length;Te++){const ze=oe[Te];this.lastEntities[ze]={regex:new RegExp("&"+ze+";","g"),val:Q[ze]}}}function c(Q,oe,Te,ze,Ae,_e,pe){if(Q!==void 0&&(this.options.trimValues&&!ze&&(Q=Q.trim()),Q.length>0)){pe||(Q=this.replaceEntitiesValue(Q));const X=this.options.tagValueProcessor(oe,Q,Te,Ae,_e);return X==null?Q:typeof X!=typeof Q||X!==Q?X:this.options.trimValues?fe(Q,this.options.parseTagValue,this.options.numberParseOptions):Q.trim()===Q?fe(Q,this.options.parseTagValue,this.options.numberParseOptions):Q}}function f(Q){if(this.options.removeNSPrefix){const oe=Q.split(":"),Te=Q.charAt(0)==="/"?"/":"";if(oe[0]==="xmlns")return"";oe.length===2&&(Q=Te+oe[1])}return Q}const g=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function b(Q,oe,Te){if(this.options.ignoreAttributes!==!0&&typeof Q=="string"){const ze=r.getAllMatches(Q,g),Ae=ze.length,_e={};for(let pe=0;pe<Ae;pe++){const X=this.resolveNameSpace(ze[pe][1]);if(this.ignoreAttributesFn(X,oe))continue;let ne=ze[pe][4],Be=this.options.attributeNamePrefix+X;if(X.length)if(this.options.transformAttributeName&&(Be=this.options.transformAttributeName(Be)),Be==="__proto__"&&(Be="#__proto__"),ne!==void 0){this.options.trimValues&&(ne=ne.trim()),ne=this.replaceEntitiesValue(ne);const Ze=this.options.attributeValueProcessor(X,ne,oe);Ze==null?_e[Be]=ne:typeof Ze!=typeof ne||Ze!==ne?_e[Be]=Ze:_e[Be]=fe(ne,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(_e[Be]=!0)}if(!Object.keys(_e).length)return;if(this.options.attributesGroupName){const pe={};return pe[this.options.attributesGroupName]=_e,pe}return _e}}const T=function(Q){Q=Q.replace(/\r\n?/g,`
`);const oe=new e("!xml");let Te=oe,ze="",Ae="";for(let _e=0;_e<Q.length;_e++)if(Q[_e]==="<")if(Q[_e+1]==="/"){const X=z(Q,">",_e,"Closing Tag is not closed.");let ne=Q.substring(_e+2,X).trim();if(this.options.removeNSPrefix){const Ce=ne.indexOf(":");Ce!==-1&&(ne=ne.substr(Ce+1))}this.options.transformTagName&&(ne=this.options.transformTagName(ne)),Te&&(ze=this.saveTextToParentTag(ze,Te,Ae));const Be=Ae.substring(Ae.lastIndexOf(".")+1);if(ne&&this.options.unpairedTags.indexOf(ne)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${ne}>`);let Ze=0;Be&&this.options.unpairedTags.indexOf(Be)!==-1?(Ze=Ae.lastIndexOf(".",Ae.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Ze=Ae.lastIndexOf("."),Ae=Ae.substring(0,Ze),Te=this.tagsNodeStack.pop(),ze="",_e=X}else if(Q[_e+1]==="?"){let X=V(Q,_e,!1,"?>");if(!X)throw new Error("Pi Tag is not closed.");if(ze=this.saveTextToParentTag(ze,Te,Ae),!(this.options.ignoreDeclaration&&X.tagName==="?xml"||this.options.ignorePiTags)){const ne=new e(X.tagName);ne.add(this.options.textNodeName,""),X.tagName!==X.tagExp&&X.attrExpPresent&&(ne[":@"]=this.buildAttributesMap(X.tagExp,Ae,X.tagName)),this.addChild(Te,ne,Ae)}_e=X.closeIndex+1}else if(Q.substr(_e+1,3)==="!--"){const X=z(Q,"-->",_e+4,"Comment is not closed.");if(this.options.commentPropName){const ne=Q.substring(_e+4,X-2);ze=this.saveTextToParentTag(ze,Te,Ae),Te.add(this.options.commentPropName,[{[this.options.textNodeName]:ne}])}_e=X}else if(Q.substr(_e+1,2)==="!D"){const X=t(Q,_e);this.docTypeEntities=X.entities,_e=X.i}else if(Q.substr(_e+1,2)==="!["){const X=z(Q,"]]>",_e,"CDATA is not closed.")-2,ne=Q.substring(_e+9,X);ze=this.saveTextToParentTag(ze,Te,Ae);let Be=this.parseTextData(ne,Te.tagname,Ae,!0,!1,!0,!0);Be==null&&(Be=""),this.options.cdataPropName?Te.add(this.options.cdataPropName,[{[this.options.textNodeName]:ne}]):Te.add(this.options.textNodeName,Be),_e=X+2}else{let X=V(Q,_e,this.options.removeNSPrefix),ne=X.tagName;const Be=X.rawTagName;let Ze=X.tagExp,Ce=X.attrExpPresent,Ne=X.closeIndex;this.options.transformTagName&&(ne=this.options.transformTagName(ne)),Te&&ze&&Te.tagname!=="!xml"&&(ze=this.saveTextToParentTag(ze,Te,Ae,!1));const Ge=Te;if(Ge&&this.options.unpairedTags.indexOf(Ge.tagname)!==-1&&(Te=this.tagsNodeStack.pop(),Ae=Ae.substring(0,Ae.lastIndexOf("."))),ne!==oe.tagname&&(Ae+=Ae?"."+ne:ne),this.isItStopNode(this.options.stopNodes,Ae,ne)){let Qe="";if(Ze.length>0&&Ze.lastIndexOf("/")===Ze.length-1)ne[ne.length-1]==="/"?(ne=ne.substr(0,ne.length-1),Ae=Ae.substr(0,Ae.length-1),Ze=ne):Ze=Ze.substr(0,Ze.length-1),_e=X.closeIndex;else if(this.options.unpairedTags.indexOf(ne)!==-1)_e=X.closeIndex;else{const tt=this.readStopNodeData(Q,Be,Ne+1);if(!tt)throw new Error(`Unexpected end of ${Be}`);_e=tt.i,Qe=tt.tagContent}const rt=new e(ne);ne!==Ze&&Ce&&(rt[":@"]=this.buildAttributesMap(Ze,Ae,ne)),Qe&&(Qe=this.parseTextData(Qe,ne,Ae,!0,Ce,!0,!0)),Ae=Ae.substr(0,Ae.lastIndexOf(".")),rt.add(this.options.textNodeName,Qe),this.addChild(Te,rt,Ae)}else{if(Ze.length>0&&Ze.lastIndexOf("/")===Ze.length-1){ne[ne.length-1]==="/"?(ne=ne.substr(0,ne.length-1),Ae=Ae.substr(0,Ae.length-1),Ze=ne):Ze=Ze.substr(0,Ze.length-1),this.options.transformTagName&&(ne=this.options.transformTagName(ne));const Qe=new e(ne);ne!==Ze&&Ce&&(Qe[":@"]=this.buildAttributesMap(Ze,Ae,ne)),this.addChild(Te,Qe,Ae),Ae=Ae.substr(0,Ae.lastIndexOf("."))}else{const Qe=new e(ne);this.tagsNodeStack.push(Te),ne!==Ze&&Ce&&(Qe[":@"]=this.buildAttributesMap(Ze,Ae,ne)),this.addChild(Te,Qe,Ae),Te=Qe}ze="",_e=Ne}}else ze+=Q[_e];return oe.child};function S(Q,oe,Te){const ze=this.options.updateTag(oe.tagname,Te,oe[":@"]);ze===!1||(typeof ze=="string"&&(oe.tagname=ze),Q.addChild(oe))}const F=function(Q){if(this.options.processEntities){for(let oe in this.docTypeEntities){const Te=this.docTypeEntities[oe];Q=Q.replace(Te.regx,Te.val)}for(let oe in this.lastEntities){const Te=this.lastEntities[oe];Q=Q.replace(Te.regex,Te.val)}if(this.options.htmlEntities)for(let oe in this.htmlEntities){const Te=this.htmlEntities[oe];Q=Q.replace(Te.regex,Te.val)}Q=Q.replace(this.ampEntity.regex,this.ampEntity.val)}return Q};function k(Q,oe,Te,ze){return Q&&(ze===void 0&&(ze=Object.keys(oe.child).length===0),Q=this.parseTextData(Q,oe.tagname,Te,!1,oe[":@"]?Object.keys(oe[":@"]).length!==0:!1,ze),Q!==void 0&&Q!==""&&oe.add(this.options.textNodeName,Q),Q=""),Q}function U(Q,oe,Te){const ze="*."+Te;for(const Ae in Q){const _e=Q[Ae];if(ze===_e||oe===_e)return!0}return!1}function j(Q,oe,Te=">"){let ze,Ae="";for(let _e=oe;_e<Q.length;_e++){let pe=Q[_e];if(ze)pe===ze&&(ze="");else if(pe==='"'||pe==="'")ze=pe;else if(pe===Te[0])if(Te[1]){if(Q[_e+1]===Te[1])return{data:Ae,index:_e}}else return{data:Ae,index:_e};else pe==="	"&&(pe=" ");Ae+=pe}}function z(Q,oe,Te,ze){const Ae=Q.indexOf(oe,Te);if(Ae===-1)throw new Error(ze);return Ae+oe.length-1}function V(Q,oe,Te,ze=">"){const Ae=j(Q,oe+1,ze);if(!Ae)return;let _e=Ae.data;const pe=Ae.index,X=_e.search(/\s/);let ne=_e,Be=!0;X!==-1&&(ne=_e.substring(0,X),_e=_e.substring(X+1).trimStart());const Ze=ne;if(Te){const Ce=ne.indexOf(":");Ce!==-1&&(ne=ne.substr(Ce+1),Be=ne!==Ae.data.substr(Ce+1))}return{tagName:ne,tagExp:_e,closeIndex:pe,attrExpPresent:Be,rawTagName:Ze}}function K(Q,oe,Te){const ze=Te;let Ae=1;for(;Te<Q.length;Te++)if(Q[Te]==="<")if(Q[Te+1]==="/"){const _e=z(Q,">",Te,`${oe} is not closed`);if(Q.substring(Te+2,_e).trim()===oe&&(Ae--,Ae===0))return{tagContent:Q.substring(ze,Te),i:_e};Te=_e}else if(Q[Te+1]==="?")Te=z(Q,"?>",Te+1,"StopNode is not closed.");else if(Q.substr(Te+1,3)==="!--")Te=z(Q,"-->",Te+3,"StopNode is not closed.");else if(Q.substr(Te+1,2)==="![")Te=z(Q,"]]>",Te,"StopNode is not closed.")-2;else{const _e=V(Q,Te,">");_e&&((_e&&_e.tagName)===oe&&_e.tagExp[_e.tagExp.length-1]!=="/"&&Ae++,Te=_e.closeIndex)}}function fe(Q,oe,Te){if(oe&&typeof Q=="string"){const ze=Q.trim();return ze==="true"?!0:ze==="false"?!1:n(Q,Te)}else return r.isExist(Q)?Q:""}return E1=o,E1}var T1={},dM;function Rie(){if(dM)return T1;dM=1;function r(o,s){return e(o,s)}function e(o,s,c){let f;const g={};for(let b=0;b<o.length;b++){const T=o[b],S=t(T);let F="";if(c===void 0?F=S:F=c+"."+S,S===s.textNodeName)f===void 0?f=T[S]:f+=""+T[S];else{if(S===void 0)continue;if(T[S]){let k=e(T[S],s,F);const U=i(k,s);T[":@"]?n(k,T[":@"],F,s):Object.keys(k).length===1&&k[s.textNodeName]!==void 0&&!s.alwaysCreateTextNode?k=k[s.textNodeName]:Object.keys(k).length===0&&(s.alwaysCreateTextNode?k[s.textNodeName]="":k=""),g[S]!==void 0&&g.hasOwnProperty(S)?(Array.isArray(g[S])||(g[S]=[g[S]]),g[S].push(k)):s.isArray(S,F,U)?g[S]=[k]:g[S]=k}}}return typeof f=="string"?f.length>0&&(g[s.textNodeName]=f):f!==void 0&&(g[s.textNodeName]=f),g}function t(o){const s=Object.keys(o);for(let c=0;c<s.length;c++){const f=s[c];if(f!==":@")return f}}function n(o,s,c,f){if(s){const g=Object.keys(s),b=g.length;for(let T=0;T<b;T++){const S=g[T];f.isArray(S,c+"."+S,!0,!0)?o[S]=[s[S]]:o[S]=s[S]}}}function i(o,s){const{textNodeName:c}=s,f=Object.keys(o).length;return!!(f===0||f===1&&(o[c]||typeof o[c]=="boolean"||o[c]===0))}return T1.prettify=r,T1}var B1,AM;function Fie(){if(AM)return B1;AM=1;const{buildOptions:r}=Bie(),e=Pie(),{prettify:t}=Rie(),n=D6();class i{constructor(s){this.externalEntities={},this.options=r(s)}parse(s,c){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(c){c===!0&&(c={});const b=n.validate(s,c);if(b!==!0)throw Error(`${b.err.msg}:${b.err.line}:${b.err.col}`)}const f=new e(this.options);f.addExternalEntities(this.externalEntities);const g=f.parseXml(s);return this.options.preserveOrder||g===void 0?g:t(g,this.options)}addEntity(s,c){if(c.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(c==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=c}}return B1=i,B1}var S1,pM;function Die(){if(pM)return S1;pM=1;const r=`
`;function e(c,f){let g="";return f.format&&f.indentBy.length>0&&(g=r),t(c,f,"",g)}function t(c,f,g,b){let T="",S=!1;for(let F=0;F<c.length;F++){const k=c[F],U=n(k);if(U===void 0)continue;let j="";if(g.length===0?j=U:j=`${g}.${U}`,U===f.textNodeName){let Q=k[U];o(j,f)||(Q=f.tagValueProcessor(U,Q),Q=s(Q,f)),S&&(T+=b),T+=Q,S=!1;continue}else if(U===f.cdataPropName){S&&(T+=b),T+=`<![CDATA[${k[U][0][f.textNodeName]}]]>`,S=!1;continue}else if(U===f.commentPropName){T+=b+`<!--${k[U][0][f.textNodeName]}-->`,S=!0;continue}else if(U[0]==="?"){const Q=i(k[":@"],f),oe=U==="?xml"?"":b;let Te=k[U][0][f.textNodeName];Te=Te.length!==0?" "+Te:"",T+=oe+`<${U}${Te}${Q}?>`,S=!0;continue}let z=b;z!==""&&(z+=f.indentBy);const V=i(k[":@"],f),K=b+`<${U}${V}`,fe=t(k[U],f,j,z);f.unpairedTags.indexOf(U)!==-1?f.suppressUnpairedNode?T+=K+">":T+=K+"/>":(!fe||fe.length===0)&&f.suppressEmptyNode?T+=K+"/>":fe&&fe.endsWith(">")?T+=K+`>${fe}${b}</${U}>`:(T+=K+">",fe&&b!==""&&(fe.includes("/>")||fe.includes("</"))?T+=b+f.indentBy+fe+b:T+=fe,T+=`</${U}>`),S=!0}return T}function n(c){const f=Object.keys(c);for(let g=0;g<f.length;g++){const b=f[g];if(c.hasOwnProperty(b)&&b!==":@")return b}}function i(c,f){let g="";if(c&&!f.ignoreAttributes)for(let b in c){if(!c.hasOwnProperty(b))continue;let T=f.attributeValueProcessor(b,c[b]);T=s(T,f),T===!0&&f.suppressBooleanAttributes?g+=` ${b.substr(f.attributeNamePrefix.length)}`:g+=` ${b.substr(f.attributeNamePrefix.length)}="${T}"`}return g}function o(c,f){c=c.substr(0,c.length-f.textNodeName.length-1);let g=c.substr(c.lastIndexOf(".")+1);for(let b in f.stopNodes)if(f.stopNodes[b]===c||f.stopNodes[b]==="*."+g)return!0;return!1}function s(c,f){if(c&&c.length>0&&f.processEntities)for(let g=0;g<f.entities.length;g++){const b=f.entities[g];c=c.replace(b.regex,b.val)}return c}return S1=e,S1}var I1,gM;function Oie(){if(gM)return I1;gM=1;const r=Die(),e=O6(),t={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(c,f){return f},attributeValueProcessor:function(c,f){return f},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function n(c){this.options=Object.assign({},t,c),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=e(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=s),this.processTextOrObjNode=i,this.options.format?(this.indentate=o,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}n.prototype.build=function(c){return this.options.preserveOrder?r(c,this.options):(Array.isArray(c)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(c={[this.options.arrayNodeName]:c}),this.j2x(c,0,[]).val)},n.prototype.j2x=function(c,f,g){let b="",T="";const S=g.join(".");for(let F in c)if(Object.prototype.hasOwnProperty.call(c,F))if(typeof c[F]>"u")this.isAttribute(F)&&(T+="");else if(c[F]===null)this.isAttribute(F)?T+="":F[0]==="?"?T+=this.indentate(f)+"<"+F+"?"+this.tagEndChar:T+=this.indentate(f)+"<"+F+"/"+this.tagEndChar;else if(c[F]instanceof Date)T+=this.buildTextValNode(c[F],F,"",f);else if(typeof c[F]!="object"){const k=this.isAttribute(F);if(k&&!this.ignoreAttributesFn(k,S))b+=this.buildAttrPairStr(k,""+c[F]);else if(!k)if(F===this.options.textNodeName){let U=this.options.tagValueProcessor(F,""+c[F]);T+=this.replaceEntitiesValue(U)}else T+=this.buildTextValNode(c[F],F,"",f)}else if(Array.isArray(c[F])){const k=c[F].length;let U="",j="";for(let z=0;z<k;z++){const V=c[F][z];if(!(typeof V>"u"))if(V===null)F[0]==="?"?T+=this.indentate(f)+"<"+F+"?"+this.tagEndChar:T+=this.indentate(f)+"<"+F+"/"+this.tagEndChar;else if(typeof V=="object")if(this.options.oneListGroup){const K=this.j2x(V,f+1,g.concat(F));U+=K.val,this.options.attributesGroupName&&V.hasOwnProperty(this.options.attributesGroupName)&&(j+=K.attrStr)}else U+=this.processTextOrObjNode(V,F,f,g);else if(this.options.oneListGroup){let K=this.options.tagValueProcessor(F,V);K=this.replaceEntitiesValue(K),U+=K}else U+=this.buildTextValNode(V,F,"",f)}this.options.oneListGroup&&(U=this.buildObjectNode(U,F,j,f)),T+=U}else if(this.options.attributesGroupName&&F===this.options.attributesGroupName){const k=Object.keys(c[F]),U=k.length;for(let j=0;j<U;j++)b+=this.buildAttrPairStr(k[j],""+c[F][k[j]])}else T+=this.processTextOrObjNode(c[F],F,f,g);return{attrStr:b,val:T}},n.prototype.buildAttrPairStr=function(c,f){return f=this.options.attributeValueProcessor(c,""+f),f=this.replaceEntitiesValue(f),this.options.suppressBooleanAttributes&&f==="true"?" "+c:" "+c+'="'+f+'"'};function i(c,f,g,b){const T=this.j2x(c,g+1,b.concat(f));return c[this.options.textNodeName]!==void 0&&Object.keys(c).length===1?this.buildTextValNode(c[this.options.textNodeName],f,T.attrStr,g):this.buildObjectNode(T.val,f,T.attrStr,g)}n.prototype.buildObjectNode=function(c,f,g,b){if(c==="")return f[0]==="?"?this.indentate(b)+"<"+f+g+"?"+this.tagEndChar:this.indentate(b)+"<"+f+g+this.closeTag(f)+this.tagEndChar;{let T="</"+f+this.tagEndChar,S="";return f[0]==="?"&&(S="?",T=""),(g||g==="")&&c.indexOf("<")===-1?this.indentate(b)+"<"+f+g+S+">"+c+T:this.options.commentPropName!==!1&&f===this.options.commentPropName&&S.length===0?this.indentate(b)+`<!--${c}-->`+this.newLine:this.indentate(b)+"<"+f+g+S+this.tagEndChar+c+this.indentate(b)+T}},n.prototype.closeTag=function(c){let f="";return this.options.unpairedTags.indexOf(c)!==-1?this.options.suppressUnpairedNode||(f="/"):this.options.suppressEmptyNode?f="/":f=`></${c}`,f},n.prototype.buildTextValNode=function(c,f,g,b){if(this.options.cdataPropName!==!1&&f===this.options.cdataPropName)return this.indentate(b)+`<![CDATA[${c}]]>`+this.newLine;if(this.options.commentPropName!==!1&&f===this.options.commentPropName)return this.indentate(b)+`<!--${c}-->`+this.newLine;if(f[0]==="?")return this.indentate(b)+"<"+f+g+"?"+this.tagEndChar;{let T=this.options.tagValueProcessor(f,c);return T=this.replaceEntitiesValue(T),T===""?this.indentate(b)+"<"+f+g+this.closeTag(f)+this.tagEndChar:this.indentate(b)+"<"+f+g+">"+T+"</"+f+this.tagEndChar}},n.prototype.replaceEntitiesValue=function(c){if(c&&c.length>0&&this.options.processEntities)for(let f=0;f<this.options.entities.length;f++){const g=this.options.entities[f];c=c.replace(g.regex,g.val)}return c};function o(c){return this.options.indentBy.repeat(c)}function s(c){return c.startsWith(this.options.attributeNamePrefix)&&c!==this.options.textNodeName?c.substr(this.attrPrefixLen):!1}return I1=n,I1}var M1,mM;function Lie(){if(mM)return M1;mM=1;const r=D6(),e=Fie(),t=Oie();return M1={XMLParser:e,XMLValidator:r,XMLBuilder:t},M1}var Nie=Lie();function _M(r,e){if(e!=null&&e._parser&&e._parser!=="fast-xml-parser")throw new Error(e==null?void 0:e._parser);const t={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:e==null?void 0:e.removeNSPrefix,textNodeName:e==null?void 0:e.textNodeName,isArray:(i,o,s,c)=>{var g;return!!((g=e==null?void 0:e.arrayPaths)!=null&&g.some(b=>o===b))},...e==null?void 0:e._fastXML},n=kie(r,t);return e!=null&&e.uncapitalizeKeys?N2(n):n}function kie(r,e){return new Nie.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(r)}const Uie="4.2.4",Ro={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:Uie,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:zie,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(r,e)=>_M(new TextDecoder().decode(r),{...Ro.options.xml,...e==null?void 0:e.xml}),parseTextSync:(r,e)=>_M(r,{...Ro.options.xml,...e==null?void 0:e.xml})};function zie(r){return r.startsWith("<?xml")}function Gie(r,e){var o,s,c;const t=(o=Ro.parseTextSync)==null?void 0:o.call(Ro,r,e),n=((s=t==null?void 0:t.ServiceExceptionReport)==null?void 0:s.ServiceException)||((c=t==null?void 0:t["ogc:ServiceExceptionReport"])==null?void 0:c["ogc:ServiceException"]);return typeof n=="string"?n:n.value||n.code||"Unknown error"}const Vie="4.2.4",Su={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:Vie,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:Hie,options:{wms:{throwOnError:!1}},parse:async(r,e)=>P1(new TextDecoder().decode(r),e),parseSync:(r,e)=>P1(new TextDecoder().decode(r),e),parseTextSync:(r,e)=>P1(r,e)};function Hie(r){return r.startsWith("<?xml")}function P1(r,e){const t={...Su.options.wms,...e==null?void 0:e.wms},n=Gie(r,t),i=t.minimalErrors?n:`WMS Service error: ${n}`;if(t.throwOnError)throw new Error(i);return i}function dA(r){return Array.isArray(r)?r:r?[r]:[]}function cy(r){const e=dA(r);return e.length>0&&e.every(t=>typeof t=="string")?e:[]}function V0(r,e=void 0){switch(typeof r){case"number":return r;case"string":return parseFloat(r);default:return}}function R1(r,e=void 0){switch(typeof r){case"number":return r;case"string":return parseInt(r,10);default:return}}function Yd(r){switch(r){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function yM(r,e){var o;const t=(o=Ro.parseTextSync)==null?void 0:o.call(Ro,r,e),n=t.WMT_MS_Capabilities||t.WMS_Capabilities||t,i=jie(n);if(e!=null&&e.inheritedLayerProps)for(const s of i.layers)N6(s,null);return e!=null&&e.includeRawJSON&&(i.json=n),e!=null&&e.includeXMLText&&(i.xml=r),i}function jie(r){var n,i,o,s,c,f,g,b,T,S,F,k,U,j,z,V;const e={version:String(r.version||""),name:String(((n=r.Service)==null?void 0:n.Name)||"unnamed"),title:(i=r.Service)!=null&&i.Title?String((o=r.Service)==null?void 0:o.Title):void 0,abstract:(s=r.Service)!=null&&s.Abstract?String((c=r.Service)==null?void 0:c.Abstract):void 0,keywords:cy((g=(f=r.Service)==null?void 0:f.KeywordList)==null?void 0:g.Keyword),fees:(b=r.Service)!=null&&b.Fees?JSON.stringify((T=r.Service)==null?void 0:T.Fees):void 0,accessConstraints:(S=r.Service)!=null&&S.AccessConstraints?JSON.stringify((F=r.Service)==null?void 0:F.AccessConstraints):void 0,layerLimit:R1((k=r.Service)==null?void 0:k.LayerLimit),maxWidth:R1((U=r.Service)==null?void 0:U.maxWidth),maxHeight:R1((j=r.Service)==null?void 0:j.maxHeight),layers:[],requests:Jie((z=r.Capability)==null?void 0:z.Request),exceptions:Wie(r.Exception)},t=dA((V=r.Capability)==null?void 0:V.Layer);for(const K of t)e.layers.push(L6(K));for(const[K,fe]of Object.entries(e))fe===void 0&&delete e[K];return e}function Jie(r){const e={};for(const[t,n]of Object.entries(r||{})){const i=cy(n==null?void 0:n.Format);e[t]={mimeTypes:i}}return e}function Wie(r){if(dA(r==null?void 0:r.Format).length>0)return{mimeTypes:cy(r)}}function L6(r){var g;const e={title:String((r==null?void 0:r.Title)||""),name:(r==null?void 0:r.Name)&&String(r==null?void 0:r.Name),abstract:(r==null?void 0:r.Name)&&String(r==null?void 0:r.Abstract),keywords:cy((g=r.KeywordList)==null?void 0:g.Keyword)},t=(r==null?void 0:r.CRS)||(r==null?void 0:r.SRS);t&&Array.isArray(t)&&t.every(b=>typeof b=="string")&&(e.crs=t);let n=(r==null?void 0:r.EX_GeographicBoundingBox)&&Xie(r==null?void 0:r.EX_GeographicBoundingBox);n&&(e.geographicBoundingBox=n),n=(r==null?void 0:r.LatLonBoundingBox)&&$ie(r==null?void 0:r.LatLonBoundingBox),n&&(e.geographicBoundingBox=n);const i=(r==null?void 0:r.BoundingBox)&&Kie(r==null?void 0:r.BoundingBox);i&&i.length>0&&(e.boundingBoxes=i);const s=dA(r==null?void 0:r.Dimension).map(b=>Zie(b));s.length&&(e.dimensions=s),r!=null&&r.opaque&&(e.opaque=Yd(r==null?void 0:r.opaque)),r!=null&&r.cascaded&&(e.cascaded=Yd(r==null?void 0:r.cascaded)),r!=null&&r.queryable&&(e.queryable=Yd(r==null?void 0:r.queryable));const c=dA(r==null?void 0:r.Layer),f=[];for(const b of c)f.push(L6(b));f.length>0&&(e.layers=f);for(const[b,T]of Object.entries(e))T===void 0&&delete e[b];return e}function Xie(r){const{westBoundLongitude:e,northBoundLatitude:t,eastBoundLongitude:n,southBoundLatitude:i}=r;return[[e,i],[n,t]]}function $ie(r){const{minx:e,miny:t,maxx:n,maxy:i}=r;return[[e,t],[n,i]]}function Kie(r){return dA(r).map(t=>qie(t))}function qie(r){const{CRS:e,SRS:t,minx:n,miny:i,maxx:o,maxy:s,resx:c,resy:f}=r,g={crs:e||t,boundingBox:[[V0(n),V0(i)],[V0(o),V0(s)]]};return c&&(g.xResolution=c),f&&(g.yResolution=f),g}function Zie(r){const{name:e,units:t,value:n}=r,i={name:e,units:t,extent:n};return r.unitSymbol&&(i.unitSymbol=r.unitSymbol),r.default&&(i.defaultValue=r.default),r.multipleValues&&(i.multipleValues=Yd(r.multipleValues)),r.nearestValue&&(i.nearestValue=Yd(r.nearestValue)),r.current&&(i.current=Yd(r.current)),i}function N6(r,e){e!=null&&e.geographicBoundingBox&&!r.geographicBoundingBox&&(r.geographicBoundingBox=[...e.geographicBoundingBox]),e!=null&&e.crs&&!r.crs&&(r.crs=[...e.crs]),e!=null&&e.boundingBoxes&&!r.boundingBoxes&&(r.boundingBoxes=[...e.boundingBoxes]),e!=null&&e.dimensions&&!r.dimensions&&(r.dimensions=[...e.dimensions]);for(const t of r.layers||[])N6(t,r)}const Yie="4.2.4",bw={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:Yie,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:Qie,options:{wms:{}},parse:async(r,e)=>yM(new TextDecoder().decode(r),e==null?void 0:e.wms),parseTextSync:(r,e)=>yM(r,e==null?void 0:e.wms)};function Qie(r){return r.startsWith("<?xml")}function vM(r,e){var o,s;const n=((s=((o=Ro.parseTextSync)==null?void 0:o.call(Ro,r,e)).FeatureInfoResponse)==null?void 0:s.FIELDS)||[];return{features:(Array.isArray(n)?n:[n]).map(c=>ese(c))}}function ese(r){return{attributes:r||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const tse={...bw,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(r,e)=>vM(new TextDecoder().decode(r),e),parseTextSync:(r,e)=>vM(r,e)};function bM(r,e){var n;return(n=Ro.parseTextSync)==null?void 0:n.call(Ro,r,e)}const rse={...bw,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(r,e)=>bM(new TextDecoder().decode(r),e),parseTextSync:(r,e)=>bM(r,e)};function nse(r,e){const{type:t="auto"}=r,n=t==="auto"?sse(r.url,e):ise(t,e);if(!n)throw new Error("Not a valid image source type");return n.create(r)}function ise(r,e){for(const t of e)if(t.type===r)return t;return null}function sse(r,e){for(const t of e)if(t.testURL&&t.testURL(r))return t;return null}const ose={type:"wms",testURL:r=>r.toLowerCase().includes("wms"),create:r=>new ase(r)};class ase extends Kp{constructor(t){super(t);J(this,"url");J(this,"data");J(this,"substituteCRS84");J(this,"flipCRS");J(this,"wmsParameters");J(this,"vendorParameters");J(this,"capabilities",null);this.url=t.url,this.data=t.url,this.substituteCRS84=t.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...t.wmsParameters},this.vendorParameters=t.vendorParameters||{}}async getMetadata(){const t=await this.getCapabilities();return this.normalizeMetadata(t)}async getImage(t){const{boundingBox:n,bbox:i,...o}=t,s={bbox:n?[...n[0],...n[1]]:i,...o};return await this.getMap(s)}normalizeMetadata(t){return t}async getCapabilities(t,n){const i=this.getCapabilitiesURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();this._checkResponse(o,s);const c=await bw.parse(s,this.loadOptions);return this.capabilities=c,c}async getMap(t,n){const i=this.getMapURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();this._checkResponse(o,s);try{return await rA.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}async getFeatureInfo(t,n){const i=this.getFeatureInfoURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();return this._checkResponse(o,s),await tse.parse(s,this.loadOptions)}async getFeatureInfoText(t,n){const i=this.getFeatureInfoURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();return this._checkResponse(o,s),new TextDecoder().decode(s)}async describeLayer(t,n){const i=this.describeLayerURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();return this._checkResponse(o,s),await rse.parse(s,this.loadOptions)}async getLegendGraphic(t,n){const i=this.getLegendGraphicURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();this._checkResponse(o,s);try{return await rA.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}getCapabilitiesURL(t,n){const i={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetCapabilities",i,n)}getMapURL(t,n){t=this._getWMS130Parameters(t);const i={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetMap",i,n)}getFeatureInfoURL(t,n){t=this._getWMS130Parameters(t);const{boundingBox:i,bbox:o}=t;t.bbox=i?[...i[0],...i[1]]:o;const s={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetFeatureInfo",s,n)}describeLayerURL(t,n){const i={version:this.wmsParameters.version,...t};return this._getWMSUrl("DescribeLayer",i,n)}getLegendGraphicURL(t,n){const i={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetLegendGraphic",i,n)}_parseWMSUrl(t){const[n,i]=t.split("?"),o=i.split("&"),s={};for(const c of o){const[f,g]=c.split("=");s[f]=g}return{url:n,parameters:s}}_getWMSUrl(t,n,i){let o=this.url,s=!0;const c={service:"WMS",version:n.version,request:t,...n,...this.vendorParameters,...i},f=["transparent","time","elevation"];for(const[g,b]of Object.entries(c))(!f.includes(g)||b)&&(o+=s?"?":"&",s=!1,o+=this._getURLParameter(g,b,n));return encodeURI(o)}_getWMS130Parameters(t){const n={...t};return n.srs&&(n.crs=n.crs||n.srs,delete n.srs),n}_getURLParameter(t,n,i){switch(t){case"crs":i.version!=="1.3.0"?t="srs":this.substituteCRS84&&n==="EPSG:4326"&&(n="CRS:84");break;case"srs":i.version==="1.3.0"&&(t="crs");break;case"bbox":const o=this._flipBoundingBox(n,i);o&&(n=o);break;case"x":i.version==="1.3.0"&&(t="i");break;case"y":i.version==="1.3.0"&&(t="j");break}return t=t.toUpperCase(),Array.isArray(n)?`${t}=${n.join(",")}`:`${t}=${n?String(n):""}`}_flipBoundingBox(t,n){if(!Array.isArray(t)||t.length!==4)return null;const i=n.version==="1.3.0"&&this.flipCRS.includes(n.crs||"")&&!(this.substituteCRS84&&n.crs==="EPSG:4326"),o=t;return i?[o[1],o[0],o[3],o[2]]:o}async _fetchArrayBuffer(t){const n=await this.fetch(t),i=await n.arrayBuffer();return this._checkResponse(n,i),i}_checkResponse(t,n){var o;const i=t.headers["content-type"];if(!t.ok||Su.mimeTypes.includes(i)){const s=XR(this.loadOptions,{wms:{throwOnError:!0}}),c=(o=Su.parseSync)==null?void 0:o.call(Su,n,s);throw new Error(c)}}_parseError(t){var i;const n=(i=Su.parseSync)==null?void 0:i.call(Su,t,this.loadOptions);return new Error(n)}}class k2 extends Kp{constructor(e){super(e)}async getMetadata(){throw new Error("ImageSource.getMetadata not implemented")}async getImage(e){const t=this.getGranularParameters(e),n=this.getURLFromTemplate(t),o=await(await this.fetch(n)).arrayBuffer();return await rA.parse(o)}getGranularParameters(e){const[[t,n],[i,o]]=e.boundingBox;return{...e,east:t,north:n,south:o,west:i}}getURLFromTemplate(e){let t=this.props.url;for(const[n,i]of Object.entries(e))t=t.replace(`\${${n}}`,String(i)),t=t.replace(`{${n}}`,String(i));return t}}J(k2,"type","template"),J(k2,"testURL",e=>e.toLowerCase().includes("{"));class cse extends k2{constructor(t){super(t);J(this,"data");this.data=t.url}async getMetadata(){return await this.metadata()}async getImage(t){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(t){throw new Error("not implemented")}metadataURL(t){return`${this.props.url}?f=pjson`}exportImageURL(t){const n=`bbox=${t.bbox[0]},${t.bbox[1]},${t.bbox[2]},${t.bbox[3]}`,i=`size=${t.width},${t.height}`,o={...t,bbox:n,size:i};return delete o.width,delete o.height,this.getUrl("exportImage",o)}getUrl(t,n,i){let o=`${this.props.url}/${t}`,s=!0;for(const[c,f]of Object.entries(n))o+=s?"?":"&",s=!1,Array.isArray(f)?o+=`${c.toUpperCase()}=${f.join(",")}`:o+=`${c.toUpperCase()}=${f?String(f):""}`;return o}async checkResponse(t){if(!t.ok)throw new Error("error")}}const lse={type:"arcgis-image-server",testURL:r=>r.toLowerCase().includes("ImageServer"),create:r=>new cse(r)},use=[ose,lse];function fse(r){return nse(r,use)}const xM=6378137*Math.PI;function wM(r){const e=Ul(r);return e[0]=(e[0]/256-1)*xM,e[1]=(e[1]/256-1)*xM,e}const hse={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(r,e)=>console.error(e,r)}};class xw extends gs{get isLoaded(){var e;return((e=this.state)==null?void 0:e.loadCounter)===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:t,oldProps:n}){const{viewport:i}=this.context;e.dataChanged||t.serviceType!==n.serviceType?(this.state.imageSource=this._createImageSource(t),this._loadMetadata(),this.debounce(()=>this.loadImage(i,"image source changed"),0)):io(t.layers,n.layers,1)?e.viewportChanged&&this.debounce(()=>this.loadImage(i,"viewport changed")):this.debounce(()=>this.loadImage(i,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:e,image:t,lastRequestParameters:n}=this.state;return t&&new sy({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:n.srs==="EPSG:4326"?Wr.LNGLAT:Wr.CARTESIAN,bounds:e,image:t})}async getFeatureInfoText(e,t){var i,o;const{lastRequestParameters:n}=this.state;return n?await((o=(i=this.state.imageSource).getFeatureInfoText)==null?void 0:o.call(i,{...n,query_layers:n.layers,x:e,y:t,info_format:"application/vnd.ogc.gml"})):""}_createImageSource(e){if(e.data instanceof Kp)return e.data;if(typeof e.data=="string")return fse({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){var t,n;const{imageSource:e}=this.state;try{this.state.loadCounter++;const i=await e.getMetadata();this.state.imageSource===e&&((t=this.getCurrentLayer())==null||t.props.onMetadataLoad(i))}catch(i){(n=this.getCurrentLayer())==null||n.props.onMetadataLoadError(i)}finally{this.state.loadCounter--}}async loadImage(e,t){var T,S;const{layers:n,serviceType:i}=this.props;if(i==="wms"&&n.length===0)return;const o=e.getBounds(),{width:s,height:c}=e,f=this.getRequestId();let{srs:g}=this.props;g==="auto"&&(g=e.resolution?"EPSG:4326":"EPSG:3857");const b={width:s,height:c,boundingBox:[[o[0],o[1]],[o[2],o[3]]],layers:n,crs:g};if(g==="EPSG:3857"){const F=wM([o[0],o[1]]),k=wM([o[2],o[3]]);b.boundingBox=[F,k]}try{this.state.loadCounter++,this.props.onImageLoadStart(f);const F=await this.state.imageSource.getImage(b);this.state.lastRequestId<f&&((T=this.getCurrentLayer())==null||T.props.onImageLoad(f),this.setState({image:F,bounds:o,lastRequestParameters:b,lastRequestId:f}))}catch(F){this.raiseError(F,"Load image"),(S=this.getCurrentLayer())==null||S.props.onImageLoadError(f,F)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,t=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>e(),t)}}xw.layerName="WMSLayer";xw.defaultProps=hse;const dse={getHeight:{type:"accessor",value:0},greatCircle:!0};class ww extends bg{}ww.layerName="GreatCircleLayer";ww.defaultProps=dse;const Ase={...Yu.defaultProps};class Qu extends gs{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:t,wireframe:n,filled:i,stroked:o,lineWidthUnits:s,lineWidthScale:c,lineWidthMinPixels:f,lineWidthMaxPixels:g,lineJointRounded:b,lineMiterLimit:T,lineDashJustified:S,getElevation:F,getFillColor:k,getLineColor:U,getLineWidth:j}=this.props,{updateTriggers:z,material:V,transitions:K}=this.props,fe=this.getSubLayerClass("cell",Yu),{updateTriggers:Q,...oe}=this.indexToBounds()||{};return new fe({filled:i,wireframe:n,extruded:t,elevationScale:e,stroked:o,lineWidthUnits:s,lineWidthScale:c,lineWidthMinPixels:f,lineWidthMaxPixels:g,lineJointRounded:b,lineMiterLimit:T,lineDashJustified:S,material:V,transitions:K,getElevation:F,getFillColor:k,getLineColor:U,getLineWidth:j},this.getSubLayerProps({id:"cell",updateTriggers:z&&{...Q,getElevation:z.getElevation,getFillColor:z.getFillColor,getLineColor:z.getLineColor,getLineWidth:z.getLineWidth}}),oe)}}Qu.layerName="GeoCellLayer";Qu.defaultProps=Ase;function pse(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Tm={exports:{}},gse=Tm.exports,CM;function mse(){return CM||(CM=1,function(r){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(e,t){typeof pse=="function"&&r&&r.exports?r.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()})(gse,function(){function e(_e,pe,X){this.low=_e|0,this.high=pe|0,this.unsigned=!!X}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function t(_e){return(_e&&_e.__isLong__)===!0}e.isLong=t;var n={},i={};function o(_e,pe){var X,ne,Be;return pe?(_e>>>=0,(Be=0<=_e&&_e<256)&&(ne=i[_e],ne)?ne:(X=c(_e,(_e|0)<0?-1:0,!0),Be&&(i[_e]=X),X)):(_e|=0,(Be=-128<=_e&&_e<128)&&(ne=n[_e],ne)?ne:(X=c(_e,_e<0?-1:0,!1),Be&&(n[_e]=X),X))}e.fromInt=o;function s(_e,pe){if(isNaN(_e)||!isFinite(_e))return pe?V:z;if(pe){if(_e<0)return V;if(_e>=k)return Te}else{if(_e<=-9223372036854776e3)return ze;if(_e+1>=U)return oe}return _e<0?s(-_e,pe).neg():c(_e%F|0,_e/F|0,pe)}e.fromNumber=s;function c(_e,pe,X){return new e(_e,pe,X)}e.fromBits=c;var f=Math.pow;function g(_e,pe,X){if(_e.length===0)throw Error("empty string");if(_e==="NaN"||_e==="Infinity"||_e==="+Infinity"||_e==="-Infinity")return z;if(typeof pe=="number"?(X=pe,pe=!1):pe=!!pe,X=X||10,X<2||36<X)throw RangeError("radix");var ne;if((ne=_e.indexOf("-"))>0)throw Error("interior hyphen");if(ne===0)return g(_e.substring(1),pe,X).neg();for(var Be=s(f(X,8)),Ze=z,Ce=0;Ce<_e.length;Ce+=8){var Ne=Math.min(8,_e.length-Ce),Ge=parseInt(_e.substring(Ce,Ce+Ne),X);if(Ne<8){var Qe=s(f(X,Ne));Ze=Ze.mul(Qe).add(s(Ge))}else Ze=Ze.mul(Be),Ze=Ze.add(s(Ge))}return Ze.unsigned=pe,Ze}e.fromString=g;function b(_e){return _e instanceof e?_e:typeof _e=="number"?s(_e):typeof _e=="string"?g(_e):c(_e.low,_e.high,_e.unsigned)}e.fromValue=b;var T=65536,S=1<<24,F=T*T,k=F*F,U=k/2,j=o(S),z=o(0);e.ZERO=z;var V=o(0,!0);e.UZERO=V;var K=o(1);e.ONE=K;var fe=o(1,!0);e.UONE=fe;var Q=o(-1);e.NEG_ONE=Q;var oe=c(-1,2147483647,!1);e.MAX_VALUE=oe;var Te=c(-1,-1,!0);e.MAX_UNSIGNED_VALUE=Te;var ze=c(0,-2147483648,!1);e.MIN_VALUE=ze;var Ae=e.prototype;return Ae.toInt=function(){return this.unsigned?this.low>>>0:this.low},Ae.toNumber=function(){return this.unsigned?(this.high>>>0)*F+(this.low>>>0):this.high*F+(this.low>>>0)},Ae.toString=function(pe){if(pe=pe||10,pe<2||36<pe)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ze)){var X=s(pe),ne=this.div(X),Be=ne.mul(X).sub(this);return ne.toString(pe)+Be.toInt().toString(pe)}else return"-"+this.neg().toString(pe);for(var Ze=s(f(pe,6),this.unsigned),Ce=this,Ne="";;){var Ge=Ce.div(Ze),Qe=Ce.sub(Ge.mul(Ze)).toInt()>>>0,rt=Qe.toString(pe);if(Ce=Ge,Ce.isZero())return rt+Ne;for(;rt.length<6;)rt="0"+rt;Ne=""+rt+Ne}},Ae.getHighBits=function(){return this.high},Ae.getHighBitsUnsigned=function(){return this.high>>>0},Ae.getLowBits=function(){return this.low},Ae.getLowBitsUnsigned=function(){return this.low>>>0},Ae.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ze)?64:this.neg().getNumBitsAbs();for(var pe=this.high!=0?this.high:this.low,X=31;X>0&&!(pe&1<<X);X--);return this.high!=0?X+33:X+1},Ae.isZero=function(){return this.high===0&&this.low===0},Ae.isNegative=function(){return!this.unsigned&&this.high<0},Ae.isPositive=function(){return this.unsigned||this.high>=0},Ae.isOdd=function(){return(this.low&1)===1},Ae.isEven=function(){return(this.low&1)===0},Ae.equals=function(pe){return t(pe)||(pe=b(pe)),this.unsigned!==pe.unsigned&&this.high>>>31===1&&pe.high>>>31===1?!1:this.high===pe.high&&this.low===pe.low},Ae.eq=Ae.equals,Ae.notEquals=function(pe){return!this.eq(pe)},Ae.neq=Ae.notEquals,Ae.lessThan=function(pe){return this.comp(pe)<0},Ae.lt=Ae.lessThan,Ae.lessThanOrEqual=function(pe){return this.comp(pe)<=0},Ae.lte=Ae.lessThanOrEqual,Ae.greaterThan=function(pe){return this.comp(pe)>0},Ae.gt=Ae.greaterThan,Ae.greaterThanOrEqual=function(pe){return this.comp(pe)>=0},Ae.gte=Ae.greaterThanOrEqual,Ae.compare=function(pe){if(t(pe)||(pe=b(pe)),this.eq(pe))return 0;var X=this.isNegative(),ne=pe.isNegative();return X&&!ne?-1:!X&&ne?1:this.unsigned?pe.high>>>0>this.high>>>0||pe.high===this.high&&pe.low>>>0>this.low>>>0?-1:1:this.sub(pe).isNegative()?-1:1},Ae.comp=Ae.compare,Ae.negate=function(){return!this.unsigned&&this.eq(ze)?ze:this.not().add(K)},Ae.neg=Ae.negate,Ae.add=function(pe){t(pe)||(pe=b(pe));var X=this.high>>>16,ne=this.high&65535,Be=this.low>>>16,Ze=this.low&65535,Ce=pe.high>>>16,Ne=pe.high&65535,Ge=pe.low>>>16,Qe=pe.low&65535,rt=0,tt=0,lt=0,mt=0;return mt+=Ze+Qe,lt+=mt>>>16,mt&=65535,lt+=Be+Ge,tt+=lt>>>16,lt&=65535,tt+=ne+Ne,rt+=tt>>>16,tt&=65535,rt+=X+Ce,rt&=65535,c(lt<<16|mt,rt<<16|tt,this.unsigned)},Ae.subtract=function(pe){return t(pe)||(pe=b(pe)),this.add(pe.neg())},Ae.sub=Ae.subtract,Ae.multiply=function(pe){if(this.isZero()||(t(pe)||(pe=b(pe)),pe.isZero()))return z;if(this.eq(ze))return pe.isOdd()?ze:z;if(pe.eq(ze))return this.isOdd()?ze:z;if(this.isNegative())return pe.isNegative()?this.neg().mul(pe.neg()):this.neg().mul(pe).neg();if(pe.isNegative())return this.mul(pe.neg()).neg();if(this.lt(j)&&pe.lt(j))return s(this.toNumber()*pe.toNumber(),this.unsigned);var X=this.high>>>16,ne=this.high&65535,Be=this.low>>>16,Ze=this.low&65535,Ce=pe.high>>>16,Ne=pe.high&65535,Ge=pe.low>>>16,Qe=pe.low&65535,rt=0,tt=0,lt=0,mt=0;return mt+=Ze*Qe,lt+=mt>>>16,mt&=65535,lt+=Be*Qe,tt+=lt>>>16,lt&=65535,lt+=Ze*Ge,tt+=lt>>>16,lt&=65535,tt+=ne*Qe,rt+=tt>>>16,tt&=65535,tt+=Be*Ge,rt+=tt>>>16,tt&=65535,tt+=Ze*Ne,rt+=tt>>>16,tt&=65535,rt+=X*Qe+ne*Ge+Be*Ne+Ze*Ce,rt&=65535,c(lt<<16|mt,rt<<16|tt,this.unsigned)},Ae.mul=Ae.multiply,Ae.divide=function(pe){if(t(pe)||(pe=b(pe)),pe.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?V:z;var X,ne,Be;if(this.unsigned){if(pe.unsigned||(pe=pe.toUnsigned()),pe.gt(this))return V;if(pe.gt(this.shru(1)))return fe;Be=V}else{if(this.eq(ze)){if(pe.eq(K)||pe.eq(Q))return ze;if(pe.eq(ze))return K;var Ze=this.shr(1);return X=Ze.div(pe).shl(1),X.eq(z)?pe.isNegative()?K:Q:(ne=this.sub(pe.mul(X)),Be=X.add(ne.div(pe)),Be)}else if(pe.eq(ze))return this.unsigned?V:z;if(this.isNegative())return pe.isNegative()?this.neg().div(pe.neg()):this.neg().div(pe).neg();if(pe.isNegative())return this.div(pe.neg()).neg();Be=z}for(ne=this;ne.gte(pe);){X=Math.max(1,Math.floor(ne.toNumber()/pe.toNumber()));for(var Ce=Math.ceil(Math.log(X)/Math.LN2),Ne=Ce<=48?1:f(2,Ce-48),Ge=s(X),Qe=Ge.mul(pe);Qe.isNegative()||Qe.gt(ne);)X-=Ne,Ge=s(X,this.unsigned),Qe=Ge.mul(pe);Ge.isZero()&&(Ge=K),Be=Be.add(Ge),ne=ne.sub(Qe)}return Be},Ae.div=Ae.divide,Ae.modulo=function(pe){return t(pe)||(pe=b(pe)),this.sub(this.div(pe).mul(pe))},Ae.mod=Ae.modulo,Ae.not=function(){return c(~this.low,~this.high,this.unsigned)},Ae.and=function(pe){return t(pe)||(pe=b(pe)),c(this.low&pe.low,this.high&pe.high,this.unsigned)},Ae.or=function(pe){return t(pe)||(pe=b(pe)),c(this.low|pe.low,this.high|pe.high,this.unsigned)},Ae.xor=function(pe){return t(pe)||(pe=b(pe)),c(this.low^pe.low,this.high^pe.high,this.unsigned)},Ae.shiftLeft=function(pe){return t(pe)&&(pe=pe.toInt()),(pe&=63)===0?this:pe<32?c(this.low<<pe,this.high<<pe|this.low>>>32-pe,this.unsigned):c(0,this.low<<pe-32,this.unsigned)},Ae.shl=Ae.shiftLeft,Ae.shiftRight=function(pe){return t(pe)&&(pe=pe.toInt()),(pe&=63)===0?this:pe<32?c(this.low>>>pe|this.high<<32-pe,this.high>>pe,this.unsigned):c(this.high>>pe-32,this.high>=0?0:-1,this.unsigned)},Ae.shr=Ae.shiftRight,Ae.shiftRightUnsigned=function(pe){if(t(pe)&&(pe=pe.toInt()),pe&=63,pe===0)return this;var X=this.high;if(pe<32){var ne=this.low;return c(ne>>>pe|X<<32-pe,X>>>pe,this.unsigned)}else return pe===32?c(X,0,this.unsigned):c(X>>>pe-32,0,this.unsigned)},Ae.shru=Ae.shiftRightUnsigned,Ae.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},Ae.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},Ae.toBytes=function(_e){return _e?this.toBytesLE():this.toBytesBE()},Ae.toBytesLE=function(){var _e=this.high,pe=this.low;return[pe&255,pe>>>8&255,pe>>>16&255,pe>>>24&255,_e&255,_e>>>8&255,_e>>>16&255,_e>>>24&255]},Ae.toBytesBE=function(){var _e=this.high,pe=this.low;return[_e>>>24&255,_e>>>16&255,_e>>>8&255,_e&255,pe>>>24&255,pe>>>16&255,pe>>>8&255,pe&255]},e})}(Tm)),Tm.exports}var _se=mse();const Bm=th(_se),yse=3,vse=30,bse=2*vse+1,EM=180/Math.PI;function xse(r,e,t){const n=1<<e;return[(r[0]+t[0])/n,(r[1]+t[1])/n]}function TM(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function wse(r){return[TM(r[0]),TM(r[1])]}function Cse(r,[e,t]){switch(r){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function Ese([r,e,t]){const n=Math.atan2(t,Math.sqrt(r*r+e*e));return[Math.atan2(e,r)*EM,n*EM]}function Tse(r){let e=Bm.fromString(r,!0,10).toString(2);for(;e.length<yse+bse;)e="0"+e;const t=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,t),o=i.length/2,s=Bm.fromString(n,!0,2).toString(10);let c=Bm.fromString(i,!0,2).toString(4);for(;c.length<o;)c="0"+c;return`${s}/${c}`}function Bse(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function Sse(r){const e=r.split("/"),t=parseInt(e[0],10),n=e[1],i=n.length,o=[0,0];let s;for(let c=i-1;c>=0;c--){s=i-c;const f=n[c];let g=0,b=0;f==="1"?b=1:f==="2"?(g=1,b=1):f==="3"&&(g=1);const T=Math.pow(2,s-1);Bse(T,o,g,b),o[0]+=T*g,o[1]+=T*b}if(t%2===1){const c=o[0];o[0]=o[1],o[1]=c}return{face:t,ij:o,level:s}}function Ise(r){const e=r.padEnd(16,"0");return Bm.fromString(e,16)}const Mse=100;function Pse({face:r,ij:e,level:t}){const n=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(Mse*Math.pow(2,-t))),o=new Float64Array(4*i*2+2);let s=0,c=0;for(let f=0;f<4;f++){const g=n[f].slice(0),b=n[f+1],T=(b[0]-g[0])/i,S=(b[1]-g[1])/i;for(let F=0;F<i;F++){g[0]+=T,g[1]+=S;const k=xse(e,t,g),U=wse(k),j=Cse(r,U),z=Ese(j);Math.abs(z[1])>89.999&&(z[0]=c);const V=z[0]-c;z[0]+=V>180?-360:V<-180?360:0,o[s++]=z[0],o[s++]=z[1],c=z[0]}}return o[s++]=o[0],o[s++]=o[1],o}function Rse(r){if(typeof r=="string"){if(r.indexOf("/")>0)return r;r=Ise(r)}return Tse(r.toString())}function Fse(r){const e=Rse(r),t=Sse(e);return Pse(t)}const Dse={getS2Token:{type:"accessor",value:r=>r.token}};class ly extends Qu{indexToBounds(){const{data:e,getS2Token:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(n,i)=>Fse(t(n,i))}}}ly.layerName="S2Layer";ly.defaultProps=Dse;const F1=512;function Ose(r,e){let t=0,n=0,i=1<<r.length;const o=i/F1;for(let s=0;s<r.length;s++){i>>=1;const c=parseInt(r[s]);c%2&&(t|=i),c>1&&(n|=i)}return[[t/o,F1-n/o],[(t+e)/o,F1-(n+e)/o]]}function Lse(r,e=1){const[t,n]=Ose(r,e),[i,o]=Zc(t),[s,c]=Zc(n);return[s,o,s,c,i,c,i,o,s,o]}const Nse={getQuadkey:{type:"accessor",value:r=>r.quadkey}};class uy extends Qu{indexToBounds(){const{data:e,extruded:t,getQuadkey:n}=this.props,i=t?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>Lse(n(o,s),i),updateTriggers:{getPolygon:i}}}}uy.layerName="QuadkeyLayer";uy.defaultProps=Nse;class k6{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:n,onError:i}){const{index:o,id:s,bbox:c,userData:f,zoom:g}=this,b=this._loaderId;this._abortController=new AbortController;const{signal:T}=this._abortController,S=await t.scheduleRequest(this,U=>U.isSelected?1:-1);if(!S){this._isCancelled=!0;return}if(this._isCancelled){S.done();return}let F=null,k;try{F=await e({index:o,id:s,bbox:c,userData:f,zoom:g,signal:T})}catch(U){k=U||!0}finally{S.done()}if(b===this._loaderId){if(this._loader=void 0,this.content=F,this._isCancelled&&!F){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,k?i(k,this):n(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const ro={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},BM=new ft,kse=new ft;class Cw{constructor(e=[0,0,0],t=[0,0,0],n){n=n||BM.copy(e).add(t).scale(.5),this.center=new ft(n),this.halfDiagonal=new ft(t).subtract(this.center),this.minimum=new ft(e),this.maximum=new ft(t)}clone(){return new Cw(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,n=kse.from(e.normal),i=t.x*Math.abs(n.x)+t.y*Math.abs(n.y)+t.z*Math.abs(n.z),o=this.center.dot(n)+e.distance;return o-i>0?ro.INSIDE:o+i<0?ro.OUTSIDE:ro.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=BM.from(e).subtract(this.center),{halfDiagonal:n}=this;let i=0,o;return o=Math.abs(t.x)-n.x,o>0&&(i+=o*o),o=Math.abs(t.y)-n.y,o>0&&(i+=o*o),o=Math.abs(t.z)-n.z,o>0&&(i+=o*o),i}}const pp=new ft,SM=new ft;class Tg{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new ft,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=pp.from(t),this.center=new ft().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Tg(this.center,this.radius)}union(e){const t=this.center,n=this.radius,i=e.center,o=e.radius,s=pp.copy(i).subtract(t),c=s.magnitude();if(n>=c+o)return this.clone();if(o>=c+n)return e.clone();const f=(n+c+o)*.5;return SM.copy(s).scale((-n+f)/c).add(t),this.center.copy(SM),this.radius=f,this}expand(e){const n=pp.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const t=vG(pp,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const n=pp.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,o=e.normal.dot(t)+e.distance;return o<-n?ro.OUTSIDE:o<n?ro.INTERSECTING:ro.INSIDE}}const Use=new ft,zse=new ft,H0=new ft,j0=new ft,J0=new ft,Gse=new ft,Vse=new ft,Tl={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Bg{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new ft().from(e),this.halfAxes=new li(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new ft(e).len(),new ft(t).len(),new ft(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new ft(e).normalize(),o=new ft(t).normalize(),s=new ft(n).normalize();return new Yp().fromMatrix3(new li([...i,...o,...s]))}fromCenterHalfSizeQuaternion(e,t,n){const i=new Yp(n),o=new li().fromQuaternion(i);return o[0]=o[0]*t[0],o[1]=o[1]*t[0],o[2]=o[2]*t[0],o[3]=o[3]*t[1],o[4]=o[4]*t[1],o[5]=o[5]*t[1],o[6]=o[6]*t[2],o[7]=o[7]*t[2],o[8]=o[8]*t[2],this.center=new ft().from(e),this.halfAxes=o,this}clone(){return new Bg(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Tg){const t=this.halfAxes,n=t.getColumn(0,H0),i=t.getColumn(1,j0),o=t.getColumn(2,J0),s=Use.copy(n).add(i).add(o);return e.center.copy(this.center),e.radius=s.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,i=this.halfAxes,o=n.x,s=n.y,c=n.z,f=Math.abs(o*i[Tl.COLUMN0ROW0]+s*i[Tl.COLUMN0ROW1]+c*i[Tl.COLUMN0ROW2])+Math.abs(o*i[Tl.COLUMN1ROW0]+s*i[Tl.COLUMN1ROW1]+c*i[Tl.COLUMN1ROW2])+Math.abs(o*i[Tl.COLUMN2ROW0]+s*i[Tl.COLUMN2ROW1]+c*i[Tl.COLUMN2ROW2]),g=n.dot(t)+e.distance;return g<=-f?ro.OUTSIDE:g>=f?ro.INSIDE:ro.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=zse.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,H0),o=n.getColumn(1,j0),s=n.getColumn(2,J0),c=i.magnitude(),f=o.magnitude(),g=s.magnitude();i.normalize(),o.normalize(),s.normalize();let b=0,T;return T=Math.abs(t.dot(i))-c,T>0&&(b+=T*T),T=Math.abs(t.dot(o))-f,T>0&&(b+=T*T),T=Math.abs(t.dot(s))-g,T>0&&(b+=T*T),b}computePlaneDistances(e,t,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const s=this.center,c=this.halfAxes,f=c.getColumn(0,H0),g=c.getColumn(1,j0),b=c.getColumn(2,J0),T=Gse.copy(f).add(g).add(b).add(s),S=Vse.copy(T).subtract(e);let F=t.dot(S);return i=Math.min(F,i),o=Math.max(F,o),T.copy(s).add(f).add(g).subtract(b),S.copy(T).subtract(e),F=t.dot(S),i=Math.min(F,i),o=Math.max(F,o),T.copy(s).add(f).subtract(g).add(b),S.copy(T).subtract(e),F=t.dot(S),i=Math.min(F,i),o=Math.max(F,o),T.copy(s).add(f).subtract(g).subtract(b),S.copy(T).subtract(e),F=t.dot(S),i=Math.min(F,i),o=Math.max(F,o),s.copy(T).subtract(f).add(g).add(b),S.copy(T).subtract(e),F=t.dot(S),i=Math.min(F,i),o=Math.max(F,o),s.copy(T).subtract(f).add(g).subtract(b),S.copy(T).subtract(e),F=t.dot(S),i=Math.min(F,i),o=Math.max(F,o),s.copy(T).subtract(f).subtract(g).add(b),S.copy(T).subtract(e),F=t.dot(S),i=Math.min(F,i),o=Math.max(F,o),s.copy(T).subtract(f).subtract(g).subtract(b),S.copy(T).subtract(e),F=t.dot(S),i=Math.min(F,i),o=Math.max(F,o),n[0]=i,n[1]=o,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,H0);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,j0);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,J0);return i.transformAsPoint(e),this.halfAxes=new li([...t,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const IM=new ft,MM=new ft;class Ya{constructor(e=[0,0,1],t=0){this.normal=new ft,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Qa(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=IM.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,i){return this.normal.set(e,t,n),Qa(Sa(this.normal.len(),1)),this.distance=i,this}clone(){return new Ya(this.normal,this.distance)}equals(e){return Sa(this.distance,e.distance)&&Sa(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=MM.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e,t=[0,0,0]){const n=IM.from(e),i=this.getPointDistance(n),o=MM.copy(this.normal).scale(i);return n.subtract(o).to(t)}}const PM=[new ft([1,0,0]),new ft([0,1,0]),new ft([0,0,1])],RM=new ft,Hse=new ft;class ta{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*PM.length;const t=e.center,n=e.radius;let i=0;for(const o of PM){let s=this.planes[i],c=this.planes[i+1];s||(s=this.planes[i]=new Ya),c||(c=this.planes[i+1]=new Ya);const f=RM.copy(o).scale(-n).add(t);s.fromPointNormal(f,o);const g=RM.copy(o).scale(n).add(t),b=Hse.copy(o).negate();c.fromPointNormal(g,b),i+=2}return this}computeVisibility(e){let t=ro.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case ro.OUTSIDE:return ro.OUTSIDE;case ro.INTERSECTING:t=ro.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(Qa(Number.isFinite(t),"parentPlaneMask is required."),t===ta.MASK_OUTSIDE||t===ta.MASK_INSIDE)return t;let n=ta.MASK_INSIDE;const i=this.planes;for(let o=0;o<this.planes.length;++o){const s=o<31?1<<o:0;if(o<31&&!(t&s))continue;const c=i[o],f=e.intersectPlane(c);if(f===ro.OUTSIDE)return ta.MASK_OUTSIDE;f===ro.INTERSECTING&&(n|=s)}return n}}ta.MASK_OUTSIDE=4294967295;ta.MASK_INSIDE=0;ta.MASK_INDETERMINATE=2147483647;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;const Gc=new li,jse=new li,Jse=new li,W0=new li,FM=new li;function Wse(r,e={}){const t=sV,n=10;let i=0,o=0;const s=jse,c=Jse;s.identity(),c.copy(r);const f=t*Xse(c);for(;o<n&&$se(c)>f;)Kse(c,W0),FM.copy(W0).transpose(),c.multiplyRight(W0),c.multiplyLeft(FM),s.multiplyRight(W0),++i>2&&(++o,i=0);return e.unitary=s.toTarget(e.unitary),e.diagonal=c.toTarget(e.diagonal),e}function Xse(r){let e=0;for(let t=0;t<9;++t){const n=r[t];e+=n*n}return Math.sqrt(e)}const U2=[1,0,0],z2=[2,2,1];function $se(r){let e=0;for(let t=0;t<3;++t){const n=r[Gc.getElementIndex(z2[t],U2[t])];e+=2*n*n}return Math.sqrt(e)}function Kse(r,e){const t=cD;let n=0,i=1;for(let g=0;g<3;++g){const b=Math.abs(r[Gc.getElementIndex(z2[g],U2[g])]);b>n&&(i=g,n=b)}const o=U2[i],s=z2[i];let c=1,f=0;if(Math.abs(r[Gc.getElementIndex(s,o)])>t){const g=r[Gc.getElementIndex(s,s)],b=r[Gc.getElementIndex(o,o)],T=r[Gc.getElementIndex(s,o)],S=(g-b)/2/T;let F;S<0?F=-1/(-S+Math.sqrt(1+S*S)):F=1/(S+Math.sqrt(1+S*S)),c=1/Math.sqrt(1+F*F),f=F*c}return li.IDENTITY.to(e),e[Gc.getElementIndex(o,o)]=e[Gc.getElementIndex(s,s)]=c,e[Gc.getElementIndex(s,o)]=f,e[Gc.getElementIndex(o,s)]=-f,e}const Eu=new ft,qse=new ft,Zse=new ft,Yse=new ft,Qse=new ft,eoe=new li,toe={diagonal:new li,unitary:new li};function U6(r,e=new Bg){if(!r||r.length===0)return e.halfAxes=new li([0,0,0,0,0,0,0,0,0]),e.center=new ft,e;const t=r.length,n=new ft(0,0,0);for(const Ae of r)n.add(Ae);const i=1/t;n.multiplyByScalar(i);let o=0,s=0,c=0,f=0,g=0,b=0;for(const Ae of r){const _e=Eu.copy(Ae).subtract(n);o+=_e.x*_e.x,s+=_e.x*_e.y,c+=_e.x*_e.z,f+=_e.y*_e.y,g+=_e.y*_e.z,b+=_e.z*_e.z}o*=i,s*=i,c*=i,f*=i,g*=i,b*=i;const T=eoe;T[0]=o,T[1]=s,T[2]=c,T[3]=s,T[4]=f,T[5]=g,T[6]=c,T[7]=g,T[8]=b;const{unitary:S}=Wse(T,toe),F=e.halfAxes.copy(S);let k=F.getColumn(0,Zse),U=F.getColumn(1,Yse),j=F.getColumn(2,Qse),z=-Number.MAX_VALUE,V=-Number.MAX_VALUE,K=-Number.MAX_VALUE,fe=Number.MAX_VALUE,Q=Number.MAX_VALUE,oe=Number.MAX_VALUE;for(const Ae of r)Eu.copy(Ae),z=Math.max(Eu.dot(k),z),V=Math.max(Eu.dot(U),V),K=Math.max(Eu.dot(j),K),fe=Math.min(Eu.dot(k),fe),Q=Math.min(Eu.dot(U),Q),oe=Math.min(Eu.dot(j),oe);k=k.multiplyByScalar(.5*(fe+z)),U=U.multiplyByScalar(.5*(Q+V)),j=j.multiplyByScalar(.5*(oe+K)),e.center.copy(k).add(U).add(j);const Te=qse.set(z-fe,V-Q,K-oe).multiplyByScalar(.5),ze=new li([Te[0],0,0,0,Te[1],0,0,0,Te[2]]);return e.halfAxes.multiplyRight(ze),e}const Nd=512,roe=3,z6=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],G6=z6.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),noe=G6.concat([[.25,.5],[.75,.5]]);class kd{constructor(e,t,n){this.x=e,this.y=t,this.z=n}get children(){if(!this._children){const e=this.x*2,t=this.y*2,n=this.z+1;this._children=[new kd(e,t,n),new kd(e,t+1,n),new kd(e+1,t,n),new kd(e+1,t+1,n)]}return this._children}update(e){const{viewport:t,cullingVolume:n,elevationBounds:i,minZ:o,maxZ:s,bounds:c,offset:f,project:g}=e,b=this.getBoundingVolume(i,f,g);if(c&&!this.insideBounds(c)||n.computeVisibility(b)<0)return!1;if(!this.childVisible){let{z:S}=this;if(S<s&&S>=o){const F=b.distanceTo(t.cameraPosition)*t.scale/t.height;S+=Math.floor(Math.log2(F))}if(S>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const S of this.children)S.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,n,i]){const o=Math.pow(2,this.z),s=Nd/o;return this.x*s<n&&this.y*s<i&&(this.x+1)*s>e&&(this.y+1)*s>t}getBoundingVolume(e,t,n){if(n){const f=this.z<1?noe:this.z<2?G6:z6,g=[];for(const b of f){const T=V2(this.x+b[0],this.y+b[1],this.z);T[2]=e[0],g.push(n(T)),e[0]!==e[1]&&(T[2]=e[1],g.push(n(T)))}return U6(g)}const i=Math.pow(2,this.z),o=Nd/i,s=this.x*o+t*Nd,c=Nd-(this.y+1)*o;return new Cw([s,c,e[0]],[s+o,c+o,e[1]])}}function ioe(r,e,t,n){const i=r instanceof L$&&r.resolution?r.projectPosition:null,o=Object.values(r.getFrustumPlanes()).map(({normal:F,distance:k})=>new Ya(F.clone().negate(),k)),s=new ta(o),c=r.distanceScales.unitsPerMeter[2],f=t&&t[0]*c||0,g=t&&t[1]*c||0,b=r instanceof Qp&&r.pitch<=60?e:0;if(n){const[F,k,U,j]=n,z=Ul([F,j]),V=Ul([U,k]);n=[z[0],Nd-z[1],V[0],Nd-V[1]]}const T=new kd(0,0,0),S={viewport:r,project:i,cullingVolume:s,elevationBounds:[f,g],minZ:b,maxZ:e,bounds:n,offset:0};if(T.update(S),r instanceof Qp&&r.subViewports&&r.subViewports.length>1){for(S.offset=-1;T.update(S)&&!(--S.offset<-3););for(S.offset=1;T.update(S)&&!(++S.offset>roe););}return T.getSelected()}const zl=512,soe=[-1/0,-1/0,1/0,1/0],d_={type:"object",value:null,validate:(r,e)=>e.optional&&r===null||typeof r=="string"||Array.isArray(r)&&r.every(t=>typeof t=="string"),equal:(r,e)=>{if(r===e)return!0;if(!Array.isArray(r)||!Array.isArray(e))return!1;const t=r.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}};function V6(r,e){const t=[e.transformAsPoint([r[0],r[1]]),e.transformAsPoint([r[2],r[1]]),e.transformAsPoint([r[0],r[3]]),e.transformAsPoint([r[2],r[3]])];return[Math.min(...t.map(i=>i[0])),Math.min(...t.map(i=>i[1])),Math.max(...t.map(i=>i[0])),Math.max(...t.map(i=>i[1]))]}function ooe(r){return Math.abs(r.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function Zf(r,e){if(!r||!r.length)return null;const{index:t,id:n}=e;if(Array.isArray(r)){const o=ooe(n)%r.length;r=r[o]}let i=r;for(const o of Object.keys(t)){const s=new RegExp(`{${o}}`,"g");i=i.replace(s,String(t[o]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),i}function aoe(r,e,t){let n;return n=r.getBounds(),r.isGeospatial?[Math.max(n[0],t[0]),Math.max(n[1],t[1]),Math.min(n[2],t[2]),Math.min(n[3],t[3])]:[Math.max(Math.min(n[0],t[2]),t[0]),Math.max(Math.min(n[1],t[3]),t[1]),Math.min(Math.max(n[2],t[0]),t[2]),Math.min(Math.max(n[3],t[1]),t[3])]}function coe({viewport:r,z:e,cullRect:t}){return(r.subViewports||[r]).map(i=>G2(i,e||0,t))}function G2(r,e,t){if(!Array.isArray(e)){const o=t.x-r.x,s=t.y-r.y,{width:c,height:f}=t,g={targetZ:e},b=r.unproject([o,s],g),T=r.unproject([o+c,s],g),S=r.unproject([o,s+f],g),F=r.unproject([o+c,s+f],g);return[Math.min(b[0],T[0],S[0],F[0]),Math.min(b[1],T[1],S[1],F[1]),Math.max(b[0],T[0],S[0],F[0]),Math.max(b[1],T[1],S[1],F[1])]}const n=G2(r,e[0],t),i=G2(r,e[1],t);return[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[2],i[2]),Math.max(n[3],i[3])]}function loe(r,e,t){return t?V6(r,t).map(i=>i*e/zl):r.map(n=>n*e/zl)}function Ew(r,e){return Math.pow(2,r)*zl/e}function V2(r,e,t){const n=Ew(t,zl),i=r/n*360-180,o=Math.PI-2*Math.PI*e/n,s=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[i,s]}function DM(r,e,t,n){const i=Ew(t,n);return[r/i*zl,e/i*zl]}function uoe(r,e,t,n,i=zl){if(r.isGeospatial){const[g,b]=V2(e,t,n),[T,S]=V2(e+1,t+1,n);return{west:g,north:b,east:T,south:S}}const[o,s]=DM(e,t,n,i),[c,f]=DM(e+1,t+1,n,i);return{left:o,top:s,right:c,bottom:f}}function foe(r,e,t,n,i){const o=aoe(r,null,n),s=Ew(e,t),[c,f,g,b]=loe(o,s,i),T=[];for(let S=Math.floor(c);S<g;S++)for(let F=Math.floor(f);F<b;F++)T.push({x:S,y:F,z:e});return T}function hoe({viewport:r,maxZoom:e,minZoom:t,zRange:n,extent:i,tileSize:o=zl,modelMatrix:s,modelMatrixInverse:c,zoomOffset:f=0}){let g=r.isGeospatial?Math.round(r.zoom+Math.log2(zl/o))+f:Math.ceil(r.zoom)+f;if(typeof t=="number"&&Number.isFinite(t)&&g<t){if(!i)return[];g=t}typeof e=="number"&&Number.isFinite(e)&&g>e&&(g=e);let b=i;return s&&c&&i&&!r.isGeospatial&&(b=V6(i,s)),r.isGeospatial?ioe(r,g,n,i):foe(r,g,o,b||soe,c)}function doe(r){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(r)}function Aoe(r){return Number.isFinite(r.west)&&Number.isFinite(r.north)&&Number.isFinite(r.east)&&Number.isFinite(r.south)}function poe(r){let e={},t;return n=>{for(const i in n)if(!goe(n[i],e[i])){t=r(n),e=n;break}return t}}function goe(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}return!1}const OM=1,fy=2,moe="never",_oe="no-overlap",Tw="best-available",yoe=5,voe={[Tw]:xoe,[_oe]:woe,[moe]:()=>{}},boe={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class hy{constructor(e){this._getCullBounds=poe(coe),this.opts={...boe,...e},this.setOptions(this.opts),this.onTileLoad=t=>{var n,i;(i=(n=this.opts).onTileLoad)==null||i.call(n,t),this.opts.maxCacheByteSize!=null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new eF({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new dn,this._modelMatrixInverse=new dn}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:n}={zRange:null,modelMatrix:null}){const i=n?new dn(n):new dn,o=!i.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Sa(this._zRange,t)||o){o&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=t;const c=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=c.map(f=>this._getTile(f,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(c=>this._getTile(c.index,!0)));const s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:i}=e;for(const[o,s,c,f]of n){let g;if("west"in i)g=i.west<c&&i.east>o&&i.south<f&&i.north>s;else{const b=Math.min(i.top,i.bottom),T=Math.max(i.top,i.bottom);g=i.left<c&&i.right>o&&b<f&&T>s}if(g)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:n,zRange:i,modelMatrix:o,modelMatrixInverse:s}){const{tileSize:c,extent:f,zoomOffset:g}=this.opts;return hoe({viewport:e,maxZoom:t,minZoom:n,zRange:i,tileSize:c,extent:f,modelMatrix:o,modelMatrixInverse:s,zoomOffset:g})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:uoe(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),n=Math.floor(e.y/2),i=e.z-1;return{x:t,y:n,z:i}}updateTileStates(){const e=this.opts.refinementStrategy||Tw,t=new Array(this._cache.size);let n=0;for(const i of this._cache.values())t[n++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof e=="function"?e:voe[e])(Array.from(this._cache.values())),n=0;for(const i of this._cache.values())if(t[n++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let n=0;for(const i of this._cache.values())i.isLoading&&(n++,!i.isSelected&&!i.isVisible&&t.push(i));for(;e>0&&n>e&&t.length>0;)t.shift().abort(),n--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const n=this._getNearestAncestor(t);t.parent=n,n!=null&&n.children&&n.children.push(t)}}_resizeCache(){var s,c;const{_cache:e,opts:t}=this,n=t.maxCacheSize??(t.maxCacheByteSize!=null?1/0:yoe*this.selectedTiles.length),i=t.maxCacheByteSize??1/0;if(e.size>n||this._cacheByteSize>i){for(const[f,g]of e)if(!g.isVisible&&!g.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!=null?g.byteLength:0,e.delete(f),(c=(s=this.opts).onTileUnload)==null||c.call(s,g)),e.size<=n&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((f,g)=>f.zoom-g.zoom),this._dirty=!1)}_getTile(e,t){const n=this.getTileId(e);let i=this._cache.get(n),o=!1;return!i&&t?(i=new k6(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:n,zoom:this.getTileZoom(i.index)}),o=!0,this._cache.set(n,i),this._dirty=!0):i&&i.needsReload&&(o=!0),i&&o&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:t=0}=this;let n=e.index;for(;this.getTileZoom(n)>t;){n=this.getParentIndex(n);const i=this._getTile(n);if(i)return i}return null}}function xoe(r){for(const e of r)e.state=0;for(const e of r)e.isSelected&&!H6(e)&&Bw(e);for(const e of r)e.isVisible=!!(e.state&fy)}function woe(r){for(const t of r)t.state=0;for(const t of r)t.isSelected&&H6(t);const e=Array.from(r).sort((t,n)=>t.zoom-n.zoom);for(const t of e)if(t.isVisible=!!(t.state&fy),t.children&&(t.isVisible||t.state&OM))for(const n of t.children)n.state=OM;else t.isSelected&&Bw(t)}function H6(r){let e=r;for(;e;){if(e.isLoaded||e.content)return e.state|=fy,!0;e=e.parent}return!1}function Bw(r){for(const e of r.children)e.isLoaded||e.content?e.state|=fy:Bw(e)}const Coe={TilesetClass:hy,data:{type:"data",value:[]},dataComparator:d_.equal,renderSubLayers:{type:"function",value:r=>new Wl(r)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:r=>console.error(r)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Tw,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class Xl extends gs{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;(t=(e=this.state)==null?void 0:e.tileset)==null||t.finalize()}get isLoaded(){var e,t,n;return!!((n=(t=(e=this.state)==null?void 0:e.tileset)==null?void 0:t.selectedTiles)!=null&&n.every(i=>i.isLoaded&&i.layers&&i.layers.every(o=>o.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const n=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?n&&(t.setOptions(this._getTilesetOptions()),i?t.reloadAll():t.tiles.forEach(o=>{o.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:n,refinementStrategy:i,extent:o,maxZoom:s,minZoom:c,maxRequests:f,debounceTime:g,zoomOffset:b}=this.props;return{maxCacheSize:t,maxCacheByteSize:n,maxZoom:s,minZoom:c,tileSize:e,refinementStrategy:i,extent:o,maxRequests:f,debounceTime:g,zoomOffset:b,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:n}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:n}),{isLoaded:o}=e,s=this.state.isLoaded!==o,c=this.state.frameNumber!==i;o&&(s||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:i}),this.state.isLoaded=o}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:n,fetch:i}=this.props,{signal:o}=e;return e.url=typeof t=="string"||Array.isArray(t)?Zf(t,e):null,n?n(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,n=t.props.tile,i=e.info;return i.picked&&(i.tile=n),i.sourceTile=n,i.sourceTileSubLayer=t,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(n=>e.layers[0].props[n]!==t[n])&&(e.layers=e.layers.map(n=>n.clone(t)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=X_(n,Boolean).map(i=>i.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:n}=e.props;return this.state.tileset.isTileVisible(n,t)}}Xl.defaultProps=Coe;Xl.layerName="TileLayer";const Eoe={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:r=>r.timestamps}};class dy extends ch{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
in float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:t,trailLength:n,currentTime:i}=this.props;e.uniforms={...e.uniforms,fadeTrail:t,trailLength:n,currentTime:i},super.draw(e)}}dy.layerName="TripsLayer";dy.defaultProps=Eoe;var Rr=function(r){r=r||{};var e=typeof r<"u"?r:{},t={},n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);var i="";function o(de){return e.locateFile?e.locateFile(de,i):i+de}var s;typeof document<"u"&&document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",s=function(be,ce,Se){var p=new XMLHttpRequest;p.open("GET",be,!0),p.responseType="arraybuffer",p.onload=function(){if(p.status==200||p.status==0&&p.response){ce(p.response);return}var vt=Mt(be);if(vt){ce(vt.buffer);return}Se()},p.onerror=Se,p.send(null)};var c=e.print||console.log.bind(console),f=e.printErr||console.warn.bind(console);for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);t=null,e.arguments&&e.arguments;var g=0,b=function(de){g=de},T=function(){return g},S=8;function F(de,be,ce,Se){switch(ce=ce||"i8",ce.charAt(ce.length-1)==="*"&&(ce="i32"),ce){case"i1":X[de>>0]=be;break;case"i8":X[de>>0]=be;break;case"i16":Be[de>>1]=be;break;case"i32":Ze[de>>2]=be;break;case"i64":Wn=[be>>>0,(vn=be,+Ar(vn)>=1?vn>0?(pr(+hr(vn/4294967296),4294967295)|0)>>>0:~~+In((vn-+(~~vn>>>0))/4294967296)>>>0:0)],Ze[de>>2]=Wn[0],Ze[de+4>>2]=Wn[1];break;case"float":Ce[de>>2]=be;break;case"double":Ne[de>>3]=be;break;default:Oe("invalid type for setValue: "+ce)}}function k(de,be,ce){switch(be=be||"i8",be.charAt(be.length-1)==="*"&&(be="i32"),be){case"i1":return X[de>>0];case"i8":return X[de>>0];case"i16":return Be[de>>1];case"i32":return Ze[de>>2];case"i64":return Ze[de>>2];case"float":return Ce[de>>2];case"double":return Ne[de>>3];default:Oe("invalid type for getValue: "+be)}return null}var U=!1;function j(de,be){de||Oe("Assertion failed: "+be)}function z(de){var be=e["_"+de];return j(be,"Cannot call unknown function "+de+", make sure it is exported"),be}function V(de,be,ce,Se,p){var le={string:function(St){var zt=0;if(St!=null&&St!==0){var Fr=(St.length<<2)+1;zt=yt(Fr),ze(St,zt,Fr)}return zt},array:function(St){var zt=yt(St.length);return Ae(St,zt),zt}};function vt(St){return be==="string"?oe(St):be==="boolean"?!!St:St}var Ke=z(de),Ct=[],It=0;if(Se)for(var Ft=0;Ft<Se.length;Ft++){var ut=le[ce[Ft]];ut?(It===0&&(It=Ee()),Ct[Ft]=ut(Se[Ft])):Ct[Ft]=Se[Ft]}var Dt=Ke.apply(null,Ct);return Dt=vt(Dt),It!==0&&Et(It),Dt}function K(de,be,ce,Se){ce=ce||[];var p=ce.every(function(vt){return vt==="number"}),le=be!=="string";return le&&p&&!Se?z(de):function(){return V(de,be,ce,arguments)}}var fe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Q(de,be,ce){for(var Se=be+ce,p=be;de[p]&&!(p>=Se);)++p;if(p-be>16&&de.subarray&&fe)return fe.decode(de.subarray(be,p));for(var le="";be<p;){var vt=de[be++];if(!(vt&128)){le+=String.fromCharCode(vt);continue}var Ke=de[be++]&63;if((vt&224)==192){le+=String.fromCharCode((vt&31)<<6|Ke);continue}var Ct=de[be++]&63;if((vt&240)==224?vt=(vt&15)<<12|Ke<<6|Ct:vt=(vt&7)<<18|Ke<<12|Ct<<6|de[be++]&63,vt<65536)le+=String.fromCharCode(vt);else{var It=vt-65536;le+=String.fromCharCode(55296|It>>10,56320|It&1023)}}return le}function oe(de,be){return de?Q(ne,de,be):""}function Te(de,be,ce,Se){if(!(Se>0))return 0;for(var p=ce,le=ce+Se-1,vt=0;vt<de.length;++vt){var Ke=de.charCodeAt(vt);if(Ke>=55296&&Ke<=57343){var Ct=de.charCodeAt(++vt);Ke=65536+((Ke&1023)<<10)|Ct&1023}if(Ke<=127){if(ce>=le)break;be[ce++]=Ke}else if(Ke<=2047){if(ce+1>=le)break;be[ce++]=192|Ke>>6,be[ce++]=128|Ke&63}else if(Ke<=65535){if(ce+2>=le)break;be[ce++]=224|Ke>>12,be[ce++]=128|Ke>>6&63,be[ce++]=128|Ke&63}else{if(ce+3>=le)break;be[ce++]=240|Ke>>18,be[ce++]=128|Ke>>12&63,be[ce++]=128|Ke>>6&63,be[ce++]=128|Ke&63}}return be[ce]=0,ce-p}function ze(de,be,ce){return Te(de,ne,be,ce)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function Ae(de,be){X.set(de,be)}function _e(de,be){return de%be>0&&(de+=be-de%be),de}var pe,X,ne,Be,Ze,Ce,Ne;function Ge(de){pe=de,e.HEAP8=X=new Int8Array(de),e.HEAP16=Be=new Int16Array(de),e.HEAP32=Ze=new Int32Array(de),e.HEAPU8=ne=new Uint8Array(de),e.HEAPU16=new Uint16Array(de),e.HEAPU32=new Uint32Array(de),e.HEAPF32=Ce=new Float32Array(de),e.HEAPF64=Ne=new Float64Array(de)}var Qe=5267040,rt=24128,tt=e.TOTAL_MEMORY||33554432;e.buffer?pe=e.buffer:pe=new ArrayBuffer(tt),tt=pe.byteLength,Ge(pe),Ze[rt>>2]=Qe;function lt(de){for(;de.length>0;){var be=de.shift();if(typeof be=="function"){be();continue}var ce=be.func;typeof ce=="number"?be.arg===void 0?e.dynCall_v(ce):e.dynCall_vi(ce,be.arg):ce(be.arg===void 0?null:be.arg)}}var mt=[],Tt=[],nt=[],cr=[];function $t(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)tn(e.preRun.shift());lt(mt)}function Jt(){lt(Tt)}function Lt(){lt(nt)}function lr(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Er(e.postRun.shift());lt(cr)}function tn(de){mt.unshift(de)}function Er(de){cr.unshift(de)}var Ar=Math.abs,In=Math.ceil,hr=Math.floor,pr=Math.min,rn=0,Sr=null;function ti(de){rn++,e.monitorRunDependencies&&e.monitorRunDependencies(rn)}function Jn(de){if(rn--,e.monitorRunDependencies&&e.monitorRunDependencies(rn),rn==0&&Sr){var be=Sr;Sr=null,be()}}e.preloadedImages={},e.preloadedAudios={};var un=null,Kn="data:application/octet-stream;base64,";function Nn(de){return String.prototype.startsWith?de.startsWith(Kn):de.indexOf(Kn)===0}var vn,Wn;un="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Ut=24144;function dr(de,be,ce,Se){Oe("Assertion failed: "+oe(de)+", at: "+[be?oe(be):"unknown filename",ce,Se?oe(Se):"unknown function"])}function Tr(){return X.length}function Zr(de,be,ce){ne.set(ne.subarray(be,be+ce),de)}function fi(de){return e.___errno_location&&(Ze[e.___errno_location()>>2]=de),de}function Pe(de){Oe("OOM")}function Ot(de){try{var be=new ArrayBuffer(de);return be.byteLength!=de?void 0:(new Int8Array(be).set(X),W(be),Ge(be),1)}catch{}}function Vt(de){var be=Tr(),ce=16777216,Se=2147483648-ce;if(de>Se)return!1;for(var p=16777216,le=Math.max(be,p);le<de;)le<=536870912?le=_e(2*le,ce):le=Math.min(_e((3*le+2147483648)/4,ce),Se);var vt=Ot(le);return!!vt}var sr=typeof atob=="function"?atob:function(de){var be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ce="",Se,p,le,vt,Ke,Ct,It,Ft=0;de=de.replace(/[^A-Za-z0-9\+\/\=]/g,"");do vt=be.indexOf(de.charAt(Ft++)),Ke=be.indexOf(de.charAt(Ft++)),Ct=be.indexOf(de.charAt(Ft++)),It=be.indexOf(de.charAt(Ft++)),Se=vt<<2|Ke>>4,p=(Ke&15)<<4|Ct>>2,le=(Ct&3)<<6|It,ce=ce+String.fromCharCode(Se),Ct!==64&&(ce=ce+String.fromCharCode(p)),It!==64&&(ce=ce+String.fromCharCode(le));while(Ft<de.length);return ce};function Ye(de){try{for(var be=sr(de),ce=new Uint8Array(be.length),Se=0;Se<be.length;++Se)ce[Se]=be.charCodeAt(Se);return ce}catch{throw new Error("Converting base64 string to bytes failed.")}}function Mt(de){if(Nn(de))return Ye(de.slice(Kn.length))}var ge={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},kt={b,c:T,d:dr,e:fi,f:Tr,g:Zr,h:Vt,i:Pe,o:Ut,p:rt},wt=function(de,be,ce){"almost asm";var Se=new de.Int8Array(ce),p=new de.Int32Array(ce);new de.Uint8Array(ce),new de.Float32Array(ce);var le=new de.Float64Array(ce),vt=be.o|0,Ke=be.p|0,Ct=de.Math.floor,It=de.Math.abs,Ft=de.Math.sqrt,ut=de.Math.pow,Dt=de.Math.cos,St=de.Math.sin,zt=de.Math.tan,Fr=de.Math.acos,qt=de.Math.asin,$r=de.Math.atan,en=de.Math.atan2,Gr=de.Math.ceil,Vr=de.Math.imul,Lr=de.Math.min,hi=de.Math.max,Hr=de.Math.clz32,fr=be.b,Me=be.c,Wt=be.d,Kr=be.e,Ni=be.f,sa=be.g,ri=be.h,kn=be.i,Ie=24160;function Do(y){return Se=new Int8Array(y),p=new Int32Array(y),le=new Float64Array(y),ce=y,!0}function Un(y){y=y|0;var _=0;return _=Ie,Ie=Ie+y|0,Ie=Ie+15&-16,_|0}function Oo(){return Ie|0}function Si(y){y=y|0,Ie=y}function ni(y,_){y=y|0,Ie=y}function wi(y,_){y=y|0,_=_|0;var v=0,w=0,B=0;return(y|0)<0?(_=2,_|0):(y|0)>13780509?(_=Vo(15,_)|0,_|0):(v=((y|0)<0)<<31>>31,B=oi(y|0,v|0,3,0)|0,w=Me()|0,v=cn(y|0,v|0,1,0)|0,v=oi(B|0,w|0,v|0,Me()|0)|0,v=cn(v|0,Me()|0,1,0)|0,y=Me()|0,p[_>>2]=v,p[_+4>>2]=y,_=0,_|0)}function Tn(y,_,v,w){return y=y|0,_=_|0,v=v|0,w=w|0,ls(y,_,v,w,0)|0}function ls(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0;if(d=Ie,Ie=Ie+16|0,O=d,!(ki(y,_,v,w,B)|0))return w=0,Ie=d,w|0;do if((v|0)>=0){if((v|0)>13780509){if(M=Vo(15,O)|0,M|0)break;l=O,O=p[l>>2]|0,l=p[l+4>>2]|0}else M=((v|0)<0)<<31>>31,h=oi(v|0,M|0,3,0)|0,l=Me()|0,M=cn(v|0,M|0,1,0)|0,M=oi(h|0,l|0,M|0,Me()|0)|0,M=cn(M|0,Me()|0,1,0)|0,l=Me()|0,p[O>>2]=M,p[O+4>>2]=l,O=M;if(Xo(w|0,0,O<<3|0)|0,B|0){Xo(B|0,0,O<<2|0)|0,M=Ss(y,_,v,w,B,O,l,0)|0;break}M=Ks(O,4)|0,M?(h=Ss(y,_,v,w,M,O,l,0)|0,Dr(M),M=h):M=13}else M=2;while(!1);return h=M,Ie=d,h|0}function ki(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0;if(G=Ie,Ie=Ie+16|0,R=G,L=G+8|0,P=R,p[P>>2]=y,p[P+4>>2]=_,(v|0)<0)return L=2,Ie=G,L|0;if(M=w,p[M>>2]=y,p[M+4>>2]=_,M=(B|0)!=0,M&&(p[B>>2]=0),Bn(y,_)|0)return L=9,Ie=G,L|0;p[L>>2]=0;e:do if((v|0)>=1)if(M)for(m=1,h=0,C=0,P=1,M=y;;){if(!(h|C)){if(M=xn(M,_,4,L,R)|0,M|0)break e;if(_=R,M=p[_>>2]|0,_=p[_+4>>2]|0,Bn(M,_)|0){M=9;break e}}if(M=xn(M,_,p[22384+(C<<2)>>2]|0,L,R)|0,M|0)break e;if(_=R,M=p[_>>2]|0,_=p[_+4>>2]|0,y=w+(m<<3)|0,p[y>>2]=M,p[y+4>>2]=_,p[B+(m<<2)>>2]=P,y=h+1|0,O=(y|0)==(P|0),l=C+1|0,d=(l|0)==6,Bn(M,_)|0){M=9;break e}if(P=P+(d&O&1)|0,(P|0)>(v|0)){M=0;break}else m=m+1|0,h=O?0:y,C=O?d?0:l:C}else for(m=1,h=0,C=0,P=1,M=y;;){if(!(h|C)){if(M=xn(M,_,4,L,R)|0,M|0)break e;if(_=R,M=p[_>>2]|0,_=p[_+4>>2]|0,Bn(M,_)|0){M=9;break e}}if(M=xn(M,_,p[22384+(C<<2)>>2]|0,L,R)|0,M|0)break e;if(_=R,M=p[_>>2]|0,_=p[_+4>>2]|0,y=w+(m<<3)|0,p[y>>2]=M,p[y+4>>2]=_,y=h+1|0,O=(y|0)==(P|0),l=C+1|0,d=(l|0)==6,Bn(M,_)|0){M=9;break e}if(P=P+(d&O&1)|0,(P|0)>(v|0)){M=0;break}else m=m+1|0,h=O?0:y,C=O?d?0:l:C}else M=0;while(!1);return L=M,Ie=G,L|0}function Ss(y,_,v,w,B,M,O,l){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0,M=M|0,O=O|0,l=l|0;var d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0;if(G=Ie,Ie=Ie+16|0,R=G+8|0,L=G,d=ho(y|0,_|0,M|0,O|0)|0,m=Me()|0,C=w+(d<<3)|0,$=C,te=p[$>>2]|0,$=p[$+4>>2]|0,h=(te|0)==(y|0)&($|0)==(_|0),!((te|0)==0&($|0)==0|h))do d=cn(d|0,m|0,1,0)|0,d=Yi(d|0,Me()|0,M|0,O|0)|0,m=Me()|0,C=w+(d<<3)|0,te=C,$=p[te>>2]|0,te=p[te+4>>2]|0,h=($|0)==(y|0)&(te|0)==(_|0);while(!(($|0)==0&(te|0)==0|h));if(d=B+(d<<2)|0,h&&(p[d>>2]|0)<=(l|0)||(te=C,p[te>>2]=y,p[te+4>>2]=_,p[d>>2]=l,(l|0)>=(v|0)))return te=0,Ie=G,te|0;switch(h=l+1|0,p[R>>2]=0,d=xn(y,_,2,R,L)|0,d|0){case 9:{P=9;break}case 0:{d=L,d=Ss(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d||(P=9);break}}e:do if((P|0)==9){switch(p[R>>2]=0,d=xn(y,_,3,R,L)|0,d|0){case 9:break;case 0:{if(d=L,d=Ss(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d|0)break e;break}default:break e}switch(p[R>>2]=0,d=xn(y,_,1,R,L)|0,d|0){case 9:break;case 0:{if(d=L,d=Ss(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d|0)break e;break}default:break e}switch(p[R>>2]=0,d=xn(y,_,5,R,L)|0,d|0){case 9:break;case 0:{if(d=L,d=Ss(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d|0)break e;break}default:break e}switch(p[R>>2]=0,d=xn(y,_,4,R,L)|0,d|0){case 9:break;case 0:{if(d=L,d=Ss(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d|0)break e;break}default:break e}switch(p[R>>2]=0,d=xn(y,_,6,R,L)|0,d|0){case 9:break;case 0:{if(d=L,d=Ss(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d|0)break e;break}default:break e}return te=0,Ie=G,te|0}while(!1);return te=d,Ie=G,te|0}function xn(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0;if(v>>>0>6)return B=1,B|0;if(C=(p[w>>2]|0)%6|0,p[w>>2]=C,(C|0)>0){M=0;do v=lo(v)|0,M=M+1|0;while((M|0)<(p[w>>2]|0))}if(C=jt(y|0,_|0,45)|0,Me()|0,m=C&127,m>>>0>121)return B=5,B|0;d=Ki(y,_)|0,M=jt(y|0,_|0,52)|0,Me()|0,M=M&15;e:do if(!M)h=8;else{for(;;){if(O=(15-M|0)*3|0,l=jt(y|0,_|0,O|0)|0,Me()|0,l=l&7,(l|0)==7){_=5;break}if(L=(Ms(M)|0)==0,M=M+-1|0,P=Yt(7,0,O|0)|0,_=_&~(Me()|0),R=Yt(p[(L?432:16)+(l*28|0)+(v<<2)>>2]|0,0,O|0)|0,O=Me()|0,v=p[(L?640:224)+(l*28|0)+(v<<2)>>2]|0,y=R|y&~P,_=O|_,!v){v=0;break e}if(!M){h=8;break e}}return _|0}while(!1);(h|0)==8&&(L=p[848+(m*28|0)+(v<<2)>>2]|0,R=Yt(L|0,0,45)|0,y=R|y,_=Me()|0|_&-1040385,v=p[4272+(m*28|0)+(v<<2)>>2]|0,(L&127|0)==127&&(L=Yt(p[848+(m*28|0)+20>>2]|0,0,45)|0,_=Me()|0|_&-1040385,v=p[4272+(m*28|0)+20>>2]|0,y=uo(L|y,_)|0,_=Me()|0,p[w>>2]=(p[w>>2]|0)+1)),l=jt(y|0,_|0,45)|0,Me()|0,l=l&127;e:do if(wr(l)|0){t:do if((Ki(y,_)|0)==1){if((m|0)!=(l|0))if(tf(l,p[7696+(m*28|0)>>2]|0)|0){y=La(y,_)|0,O=1,_=Me()|0;break}else Wt(23313,22416,436,22424);switch(d|0){case 3:{y=uo(y,_)|0,_=Me()|0,p[w>>2]=(p[w>>2]|0)+1,O=0;break t}case 5:{y=La(y,_)|0,_=Me()|0,p[w>>2]=(p[w>>2]|0)+5,O=0;break t}case 0:return L=9,L|0;default:return L=1,L|0}}else O=0;while(!1);if((v|0)>0){M=0;do y=Aa(y,_)|0,_=Me()|0,M=M+1|0;while((M|0)!=(v|0))}if((m|0)!=(l|0)){if(!(ii(l)|0)){if((O|0)!=0|(Ki(y,_)|0)!=5)break;p[w>>2]=(p[w>>2]|0)+1;break}switch(C&127){case 8:case 118:break e}(Ki(y,_)|0)!=3&&(p[w>>2]=(p[w>>2]|0)+1)}}else if((v|0)>0){M=0;do y=uo(y,_)|0,_=Me()|0,M=M+1|0;while((M|0)!=(v|0))}while(!1);return p[w>>2]=((p[w>>2]|0)+v|0)%6|0,L=B,p[L>>2]=y,p[L+4>>2]=_,L=0,L|0}function rl(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0;for(l=Ie,Ie=Ie+16|0,M=l,O=l+8|0,B=(Bn(y,_)|0)==0,B=B?1:2;;){if(p[O>>2]=0,h=(xn(y,_,B,O,M)|0)==0,d=M,h&((p[d>>2]|0)==(v|0)?(p[d+4>>2]|0)==(w|0):0)){y=4;break}if(B=B+1|0,B>>>0>=7){B=7,y=4;break}}return(y|0)==4?(Ie=l,B|0):0}function xe(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0;if(L=Ie,Ie=Ie+16|0,P=L,R=L+8|0,C=P,p[C>>2]=y,p[C+4>>2]=_,!v)return R=w,p[R>>2]=y,p[R+4>>2]=_,R=0,Ie=L,R|0;p[R>>2]=0;e:do if(Bn(y,_)|0)y=9;else{if(M=(v|0)>0,M){B=0,C=y;do{if(y=xn(C,_,4,R,P)|0,y|0)break e;if(_=P,C=p[_>>2]|0,_=p[_+4>>2]|0,B=B+1|0,Bn(C,_)|0){y=9;break e}}while((B|0)<(v|0));if(m=w,p[m>>2]=C,p[m+4>>2]=_,m=v+-1|0,M){h=0,y=1;do{if(B=22384+(h<<2)|0,(h|0)==5)for(O=p[B>>2]|0,M=0,B=y;;){if(y=P,y=xn(p[y>>2]|0,p[y+4>>2]|0,O,R,P)|0,y|0)break e;if((M|0)!=(m|0))if(d=P,l=p[d>>2]|0,d=p[d+4>>2]|0,y=w+(B<<3)|0,p[y>>2]=l,p[y+4>>2]=d,!(Bn(l,d)|0))y=B+1|0;else{y=9;break e}else y=B;if(M=M+1|0,(M|0)>=(v|0))break;B=y}else for(O=P,d=p[B>>2]|0,l=0,B=y,M=p[O>>2]|0,O=p[O+4>>2]|0;;){if(y=xn(M,O,d,R,P)|0,y|0)break e;if(O=P,M=p[O>>2]|0,O=p[O+4>>2]|0,y=w+(B<<3)|0,p[y>>2]=M,p[y+4>>2]=O,y=B+1|0,Bn(M,O)|0){y=9;break e}if(l=l+1|0,(l|0)>=(v|0))break;B=y}h=h+1|0}while(h>>>0<6);y=P,O=C,B=p[y>>2]|0,M=_,y=p[y+4>>2]|0}else O=C,B=C,M=_,y=_}else O=w,p[O>>2]=y,p[O+4>>2]=_,O=y,B=y,M=_,y=_;y=(O|0)==(B|0)&(M|0)==(y|0)?0:9}while(!1);return R=y,Ie=L,R|0}function Re(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0;if(l=Ie,Ie=Ie+48|0,B=l+16|0,M=l+8|0,O=l,v|0)return O=15,Ie=l,O|0;if(h=y,d=p[h+4>>2]|0,v=M,p[v>>2]=p[h>>2],p[v+4>>2]=d,us(M,B),_=Lo(B,_,O)|0,!_){if(v=p[M>>2]|0,M=p[y+8>>2]|0,(M|0)>0){B=p[y+12>>2]|0,_=0;do v=(p[B+(_<<3)>>2]|0)+v|0,_=_+1|0;while((_|0)<(M|0))}_=O,B=p[_>>2]|0,_=p[_+4>>2]|0,M=((v|0)<0)<<31>>31,(_|0)<(M|0)|(_|0)==(M|0)&B>>>0<v>>>0?(_=O,p[_>>2]=v,p[_+4>>2]=M,_=M):v=B,d=cn(v|0,_|0,12,0)|0,h=Me()|0,_=O,p[_>>2]=d,p[_+4>>2]=h,_=w,p[_>>2]=d,p[_+4>>2]=h,_=0}return h=_,Ie=l,h|0}function Je(y,_,v,w,B,M,O){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0,M=M|0,O=O|0;var l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0,ae=0,we=0,De=0,me=0,Fe=0,He=0,We=0,it=0,$e=0,et=0,ht=0,Rt=0,xt=0,Nt=0,rr=0,vr=0;if(Rt=Ie,Ie=Ie+64|0,it=Rt+48|0,$e=Rt+32|0,et=Rt+24|0,we=Rt+8|0,De=Rt,d=p[y>>2]|0,(d|0)<=0)return ht=0,Ie=Rt,ht|0;for(me=y+4|0,Fe=it+8|0,He=$e+8|0,We=we+8|0,l=0,re=0;;){h=p[me>>2]|0,Y=h+(re<<4)|0,p[it>>2]=p[Y>>2],p[it+4>>2]=p[Y+4>>2],p[it+8>>2]=p[Y+8>>2],p[it+12>>2]=p[Y+12>>2],(re|0)==(d+-1|0)?(p[$e>>2]=p[h>>2],p[$e+4>>2]=p[h+4>>2],p[$e+8>>2]=p[h+8>>2],p[$e+12>>2]=p[h+12>>2]):(Y=h+(re+1<<4)|0,p[$e>>2]=p[Y>>2],p[$e+4>>2]=p[Y+4>>2],p[$e+8>>2]=p[Y+8>>2],p[$e+12>>2]=p[Y+12>>2]),d=aa(it,$e,w,et)|0;e:do if(d)h=0,l=d;else if(h=et,d=p[h>>2]|0,h=p[h+4>>2]|0,(h|0)>0|(h|0)==0&d>>>0>0){te=0,Y=0;t:for(;;){if(vr=+le[it>>3],$=jr(d|0,h|0,te|0,Y|0)|0,rr=+($>>>0)+4294967296*+(Me()|0),xt=+(d>>>0)+4294967296*+(h|0),Nt=+(te>>>0)+4294967296*+(Y|0),le[we>>3]=vr*rr/xt+ +le[$e>>3]*Nt/xt,le[We>>3]=+le[Fe>>3]*rr/xt+ +le[He>>3]*Nt/xt,d=Na(we,w,De)|0,d|0){l=d;break}$=De,G=p[$>>2]|0,$=p[$+4>>2]|0,P=ho(G|0,$|0,_|0,v|0)|0,m=Me()|0,d=O+(P<<3)|0,C=d,h=p[C>>2]|0,C=p[C+4>>2]|0;r:do if((h|0)==0&(C|0)==0)ae=d,ht=16;else for(R=0,L=0;;){if((R|0)>(v|0)|(R|0)==(v|0)&L>>>0>_>>>0){l=1;break t}if((h|0)==(G|0)&(C|0)==($|0))break r;if(d=cn(P|0,m|0,1,0)|0,P=Yi(d|0,Me()|0,_|0,v|0)|0,m=Me()|0,L=cn(L|0,R|0,1,0)|0,R=Me()|0,d=O+(P<<3)|0,C=d,h=p[C>>2]|0,C=p[C+4>>2]|0,(h|0)==0&(C|0)==0){ae=d,ht=16;break}}while(!1);if((ht|0)==16&&(ht=0,!((G|0)==0&($|0)==0))&&(L=ae,p[L>>2]=G,p[L+4>>2]=$,L=M+(p[B>>2]<<3)|0,p[L>>2]=G,p[L+4>>2]=$,L=B,L=cn(p[L>>2]|0,p[L+4>>2]|0,1,0)|0,G=Me()|0,$=B,p[$>>2]=L,p[$+4>>2]=G),te=cn(te|0,Y|0,1,0)|0,Y=Me()|0,h=et,d=p[h>>2]|0,h=p[h+4>>2]|0,!((h|0)>(Y|0)|(h|0)==(Y|0)&d>>>0>te>>>0)){h=1;break e}}h=0}else h=1;while(!1);if(re=re+1|0,!h){ht=21;break}if(d=p[y>>2]|0,(re|0)>=(d|0)){l=0,ht=21;break}}return(ht|0)==21?(Ie=Rt,l|0):0}function At(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0,ae=0,we=0,De=0,me=0,Fe=0,He=0,We=0,it=0,$e=0,et=0,ht=0,Rt=0,xt=0,Nt=0,rr=0;if(rr=Ie,Ie=Ie+112|0,ht=rr+80|0,d=rr+72|0,Rt=rr,xt=rr+56|0,v|0)return Nt=15,Ie=rr,Nt|0;if(h=y+8|0,Nt=Gn((p[h>>2]<<5)+32|0)|0,!Nt)return Nt=13,Ie=rr,Nt|0;if(uf(y,Nt),$e=y,et=p[$e+4>>2]|0,v=d,p[v>>2]=p[$e>>2],p[v+4>>2]=et,us(d,ht),v=Lo(ht,_,Rt)|0,v)$e=0,et=0;else{if(v=p[d>>2]|0,M=p[h>>2]|0,(M|0)>0){O=p[y+12>>2]|0,B=0;do v=(p[O+(B<<3)>>2]|0)+v|0,B=B+1|0;while((B|0)!=(M|0));B=v}else B=v;v=Rt,M=p[v>>2]|0,v=p[v+4>>2]|0,O=((B|0)<0)<<31>>31,(v|0)<(O|0)|(v|0)==(O|0)&M>>>0<B>>>0?(v=Rt,p[v>>2]=B,p[v+4>>2]=O,v=O):B=M,$e=cn(B|0,v|0,12,0)|0,et=Me()|0,v=Rt,p[v>>2]=$e,p[v+4>>2]=et,v=0}if(v|0)return Dr(Nt),Nt=v,Ie=rr,Nt|0;if(B=Ks($e,8)|0,!B)return Dr(Nt),Nt=13,Ie=rr,Nt|0;if(l=Ks($e,8)|0,!l)return Dr(Nt),Dr(B),Nt=13,Ie=rr,Nt|0;We=ht,p[We>>2]=0,p[We+4>>2]=0,We=y,it=p[We+4>>2]|0,v=d,p[v>>2]=p[We>>2],p[v+4>>2]=it,v=Je(d,$e,et,_,ht,B,l)|0;e:do if(v)Dr(B),Dr(l),Dr(Nt);else{t:do if((p[h>>2]|0)>0){for(O=y+12|0,M=0;v=Je((p[O>>2]|0)+(M<<3)|0,$e,et,_,ht,B,l)|0,M=M+1|0,!(v|0);)if((M|0)>=(p[h>>2]|0))break t;Dr(B),Dr(l),Dr(Nt);break e}while(!1);(et|0)>0|(et|0)==0&$e>>>0>0&&Xo(l|0,0,$e<<3|0)|0,it=ht,We=p[it+4>>2]|0;t:do if((We|0)>0|(We|0)==0&(p[it>>2]|0)>>>0>0){me=B,Fe=l,He=B,We=l,it=B,v=B,ae=B,we=l,De=l,B=l;r:for(;;){for($=0,te=0,Y=0,re=0,M=0,O=0;;){l=Rt,d=l+56|0;do p[l>>2]=0,l=l+4|0;while((l|0)<(d|0));if(_=me+($<<3)|0,h=p[_>>2]|0,_=p[_+4>>2]|0,ki(h,_,1,Rt,0)|0){l=Rt,d=l+56|0;do p[l>>2]=0,l=l+4|0;while((l|0)<(d|0));l=Ks(7,4)|0,l|0&&(Ss(h,_,1,Rt,l,7,0,0)|0,Dr(l))}for(G=0;;){L=Rt+(G<<3)|0,R=p[L>>2]|0,L=p[L+4>>2]|0;n:do if((R|0)==0&(L|0)==0)l=M,d=O;else{if(m=ho(R|0,L|0,$e|0,et|0)|0,h=Me()|0,l=w+(m<<3)|0,_=l,d=p[_>>2]|0,_=p[_+4>>2]|0,!((d|0)==0&(_|0)==0)){C=0,P=0;do{if((C|0)>(et|0)|(C|0)==(et|0)&P>>>0>$e>>>0)break r;if((d|0)==(R|0)&(_|0)==(L|0)){l=M,d=O;break n}l=cn(m|0,h|0,1,0)|0,m=Yi(l|0,Me()|0,$e|0,et|0)|0,h=Me()|0,P=cn(P|0,C|0,1,0)|0,C=Me()|0,l=w+(m<<3)|0,_=l,d=p[_>>2]|0,_=p[_+4>>2]|0}while(!((d|0)==0&(_|0)==0))}(R|0)==0&(L|0)==0?(l=M,d=O):(_c(R,L,xt)|0,Kt(y,Nt,xt)|0&&(P=cn(M|0,O|0,1,0)|0,O=Me()|0,C=l,p[C>>2]=R,p[C+4>>2]=L,M=Fe+(M<<3)|0,p[M>>2]=R,p[M+4>>2]=L,M=P),l=M,d=O)}while(!1);if(G=G+1|0,G>>>0>=7)break;M=l,O=d}if($=cn($|0,te|0,1,0)|0,te=Me()|0,Y=cn(Y|0,re|0,1,0)|0,re=Me()|0,O=ht,M=p[O>>2]|0,O=p[O+4>>2]|0,(re|0)<(O|0)|(re|0)==(O|0)&Y>>>0<M>>>0)M=l,O=d;else break}if((O|0)>0|(O|0)==0&M>>>0>0){M=0,O=0;do re=me+(M<<3)|0,p[re>>2]=0,p[re+4>>2]=0,M=cn(M|0,O|0,1,0)|0,O=Me()|0,re=ht,Y=p[re+4>>2]|0;while((O|0)<(Y|0)|((O|0)==(Y|0)?M>>>0<(p[re>>2]|0)>>>0:0))}if(re=ht,p[re>>2]=l,p[re+4>>2]=d,(d|0)>0|(d|0)==0&l>>>0>0)G=B,$=De,te=it,Y=we,re=Fe,B=ae,De=v,we=He,ae=G,v=$,it=We,We=te,He=Y,Fe=me,me=re;else break t}Dr(He),Dr(We),Dr(Nt),v=1;break e}else v=l;while(!1);Dr(Nt),Dr(B),Dr(v),v=0}while(!1);return Nt=v,Ie=rr,Nt|0}function Ht(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0;if(m=Ie,Ie=Ie+176|0,d=m,(_|0)<1)return pa(v,0,0),h=0,Ie=m,h|0;for(l=y,l=jt(p[l>>2]|0,p[l+4>>2]|0,52)|0,Me()|0,pa(v,(_|0)>6?_:6,l&15),l=0;w=y+(l<<3)|0,w=yc(p[w>>2]|0,p[w+4>>2]|0,d)|0,!(w|0);){if(w=p[d>>2]|0,(w|0)>0){O=0;do M=d+8+(O<<4)|0,O=O+1|0,w=d+8+(((O|0)%(w|0)|0)<<4)|0,B=_r(v,w,M)|0,B?Zi(v,B)|0:pl(v,M,w)|0,w=p[d>>2]|0;while((O|0)<(w|0))}if(l=l+1|0,(l|0)>=(_|0)){w=0,h=13;break}}return(h|0)==13?(Ie=m,w|0):(Jo(v),h=w,Ie=m,h|0)}function gr(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0;if(M=Ie,Ie=Ie+32|0,w=M,B=M+16|0,y=Ht(y,_,B)|0,y|0)return v=y,Ie=M,v|0;if(p[v>>2]=0,p[v+4>>2]=0,p[v+8>>2]=0,y=$s(B)|0,y|0)do{_=DA(v)|0;do OA(_,y)|0,O=y+16|0,p[w>>2]=p[O>>2],p[w+4>>2]=p[O+4>>2],p[w+8>>2]=p[O+8>>2],p[w+12>>2]=p[O+12>>2],Zi(B,y)|0,y=or(B,w)|0;while(y|0);y=$s(B)|0}while(y|0);return Jo(B),y=Al(v)|0,y?(wc(v),O=y,Ie=M,O|0):(O=0,Ie=M,O|0)}function wr(y){return y=y|0,y>>>0>121?(y=0,y|0):(y=p[7696+(y*28|0)+16>>2]|0,y|0)}function ii(y){return y=y|0,(y|0)==4|(y|0)==117|0}function Ii(y){return y=y|0,p[11120+((p[y>>2]|0)*216|0)+((p[y+4>>2]|0)*72|0)+((p[y+8>>2]|0)*24|0)+(p[y+12>>2]<<3)>>2]|0}function Ui(y){return y=y|0,p[11120+((p[y>>2]|0)*216|0)+((p[y+4>>2]|0)*72|0)+((p[y+8>>2]|0)*24|0)+(p[y+12>>2]<<3)+4>>2]|0}function Vs(y,_){y=y|0,_=_|0,y=7696+(y*28|0)|0,p[_>>2]=p[y>>2],p[_+4>>2]=p[y+4>>2],p[_+8>>2]=p[y+8>>2],p[_+12>>2]=p[y+12>>2]}function dh(y,_){y=y|0,_=_|0;var v=0,w=0;if(_>>>0>20)return _=-1,_|0;do if((p[11120+(_*216|0)>>2]|0)!=(y|0))if((p[11120+(_*216|0)+8>>2]|0)!=(y|0))if((p[11120+(_*216|0)+16>>2]|0)!=(y|0))if((p[11120+(_*216|0)+24>>2]|0)!=(y|0))if((p[11120+(_*216|0)+32>>2]|0)!=(y|0))if((p[11120+(_*216|0)+40>>2]|0)!=(y|0))if((p[11120+(_*216|0)+48>>2]|0)!=(y|0))if((p[11120+(_*216|0)+56>>2]|0)!=(y|0))if((p[11120+(_*216|0)+64>>2]|0)!=(y|0))if((p[11120+(_*216|0)+72>>2]|0)!=(y|0))if((p[11120+(_*216|0)+80>>2]|0)!=(y|0))if((p[11120+(_*216|0)+88>>2]|0)!=(y|0))if((p[11120+(_*216|0)+96>>2]|0)!=(y|0))if((p[11120+(_*216|0)+104>>2]|0)!=(y|0))if((p[11120+(_*216|0)+112>>2]|0)!=(y|0))if((p[11120+(_*216|0)+120>>2]|0)!=(y|0))if((p[11120+(_*216|0)+128>>2]|0)!=(y|0))if((p[11120+(_*216|0)+136>>2]|0)==(y|0))y=2,v=1,w=2;else{if((p[11120+(_*216|0)+144>>2]|0)==(y|0)){y=0,v=2,w=0;break}if((p[11120+(_*216|0)+152>>2]|0)==(y|0)){y=0,v=2,w=1;break}if((p[11120+(_*216|0)+160>>2]|0)==(y|0)){y=0,v=2,w=2;break}if((p[11120+(_*216|0)+168>>2]|0)==(y|0)){y=1,v=2,w=0;break}if((p[11120+(_*216|0)+176>>2]|0)==(y|0)){y=1,v=2,w=1;break}if((p[11120+(_*216|0)+184>>2]|0)==(y|0)){y=1,v=2,w=2;break}if((p[11120+(_*216|0)+192>>2]|0)==(y|0)){y=2,v=2,w=0;break}if((p[11120+(_*216|0)+200>>2]|0)==(y|0)){y=2,v=2,w=1;break}if((p[11120+(_*216|0)+208>>2]|0)==(y|0)){y=2,v=2,w=2;break}else y=-1;return y|0}else y=2,v=1,w=1;else y=2,v=1,w=0;else y=1,v=1,w=2;else y=1,v=1,w=1;else y=1,v=1,w=0;else y=0,v=1,w=2;else y=0,v=1,w=1;else y=0,v=1,w=0;else y=2,v=0,w=2;else y=2,v=0,w=1;else y=2,v=0,w=0;else y=1,v=0,w=2;else y=1,v=0,w=1;else y=1,v=0,w=0;else y=0,v=0,w=2;else y=0,v=0,w=1;else y=0,v=0,w=0;while(!1);return _=p[11120+(_*216|0)+(v*72|0)+(y*24|0)+(w<<3)+4>>2]|0,_|0}function tf(y,_){return y=y|0,_=_|0,(p[7696+(y*28|0)+20>>2]|0)==(_|0)?(_=1,_|0):(_=(p[7696+(y*28|0)+24>>2]|0)==(_|0),_|0)}function oa(y,_){return y=y|0,_=_|0,p[848+(y*28|0)+(_<<2)>>2]|0}function nl(y,_){return y=y|0,_=_|0,(p[848+(y*28|0)>>2]|0)==(_|0)?(_=0,_|0):(p[848+(y*28|0)+4>>2]|0)==(_|0)?(_=1,_|0):(p[848+(y*28|0)+8>>2]|0)==(_|0)?(_=2,_|0):(p[848+(y*28|0)+12>>2]|0)==(_|0)?(_=3,_|0):(p[848+(y*28|0)+16>>2]|0)==(_|0)?(_=4,_|0):(p[848+(y*28|0)+20>>2]|0)==(_|0)?(_=5,_|0):((p[848+(y*28|0)+24>>2]|0)==(_|0)?6:7)|0}function il(){return 122}function Ah(y){y=y|0;var _=0,v=0,w=0;_=0;do Yt(_|0,0,45)|0,w=Me()|0|134225919,v=y+(_<<3)|0,p[v>>2]=-1,p[v+4>>2]=w,_=_+1|0;while((_|0)!=122);return 0}function sl(y){return y=y|0,+le[y+16>>3]<+le[y+24>>3]|0}function Is(y,_){y=y|0,_=_|0;var v=0,w=0,B=0;return v=+le[_>>3],!(v>=+le[y+8>>3])||!(v<=+le[y>>3])?(_=0,_|0):(w=+le[y+16>>3],v=+le[y+24>>3],B=+le[_+8>>3],_=B>=v,y=B<=w&1,w<v?_&&(y=1):_||(y=0),_=(y|0)!=0,_|0)}function Lo(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0;L=Ie,Ie=Ie+288|0,m=L+264|0,C=L+96|0,h=L,l=h,d=l+96|0;do p[l>>2]=0,l=l+4|0;while((l|0)<(d|0));return _=ll(_,h)|0,_|0?(R=_,Ie=L,R|0):(d=h,h=p[d>>2]|0,d=p[d+4>>2]|0,_c(h,d,m)|0,yc(h,d,C)|0,O=+Ga(m,C+8|0),le[m>>3]=+le[y>>3],d=m+8|0,le[d>>3]=+le[y+16>>3],le[C>>3]=+le[y+8>>3],h=C+8|0,le[h>>3]=+le[y+24>>3],B=+Ga(m,C),$=+le[d>>3]-+le[h>>3],M=+It(+$),G=+le[m>>3]-+le[C>>3],w=+It(+G),!($==0|G==0)&&($=+Tc(+M,+w),$=+Gr(+(B*B/+gl(+($/+gl(+M,+w)),3)/(O*(O*2.59807621135)*.8))),le[vt>>3]=$,P=~~$>>>0,R=+It($)>=1?$>0?~~+Lr(+Ct($/4294967296),4294967295)>>>0:~~+Gr(($-+(~~$>>>0))/4294967296)>>>0:0,(p[vt+4>>2]&2146435072|0)!=2146435072)?(C=(P|0)==0&(R|0)==0,_=v,p[_>>2]=C?1:P,p[_+4>>2]=C?0:R,_=0):_=1,R=_,Ie=L,R|0)}function aa(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,m=0;h=Ie,Ie=Ie+288|0,O=h+264|0,l=h+96|0,d=h,B=d,M=B+96|0;do p[B>>2]=0,B=B+4|0;while((B|0)<(M|0));return v=ll(v,d)|0,v|0?(w=v,Ie=h,w|0):(v=d,B=p[v>>2]|0,v=p[v+4>>2]|0,_c(B,v,O)|0,yc(B,v,l)|0,m=+Ga(O,l+8|0),m=+Gr(+(+Ga(y,_)/(m*2))),le[vt>>3]=m,v=~~m>>>0,B=+It(m)>=1?m>0?~~+Lr(+Ct(m/4294967296),4294967295)>>>0:~~+Gr((m-+(~~m>>>0))/4294967296)>>>0:0,(p[vt+4>>2]&2146435072|0)==2146435072?(w=1,Ie=h,w|0):(d=(v|0)==0&(B|0)==0,p[w>>2]=d?1:v,p[w+4>>2]=d?0:B,w=0,Ie=h,w|0))}function Ma(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0,p[y>>2]=_,p[y+4>>2]=v,p[y+8>>2]=w}function ca(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0;C=_+8|0,p[C>>2]=0,d=+le[y>>3],O=+It(+d),h=+le[y+8>>3],l=+It(+h)/.8660254037844386,O=O+l*.5,v=~~O,y=~~l,O=O-+(v|0),l=l-+(y|0);do if(O<.5)if(O<.3333333333333333)if(p[_>>2]=v,l<(O+1)*.5){p[_+4>>2]=y;break}else{y=y+1|0,p[_+4>>2]=y;break}else if(P=1-O,y=(!(l<P)&1)+y|0,p[_+4>>2]=y,P<=l&l<O*2){v=v+1|0,p[_>>2]=v;break}else{p[_>>2]=v;break}else{if(!(O<.6666666666666666))if(v=v+1|0,p[_>>2]=v,l<O*.5){p[_+4>>2]=y;break}else{y=y+1|0,p[_+4>>2]=y;break}if(l<1-O){if(p[_+4>>2]=y,O*2+-1<l){p[_>>2]=v;break}}else y=y+1|0,p[_+4>>2]=y;v=v+1|0,p[_>>2]=v}while(!1);do if(d<0)if(y&1){m=(y+1|0)/2|0,m=jr(v|0,((v|0)<0)<<31>>31|0,m|0,((m|0)<0)<<31>>31|0)|0,v=~~(+(v|0)-((+(m>>>0)+4294967296*+(Me()|0))*2+1)),p[_>>2]=v;break}else{m=(y|0)/2|0,m=jr(v|0,((v|0)<0)<<31>>31|0,m|0,((m|0)<0)<<31>>31|0)|0,v=~~(+(v|0)-(+(m>>>0)+4294967296*+(Me()|0))*2),p[_>>2]=v;break}while(!1);m=_+4|0,h<0&&(v=v-((y<<1|1|0)/2|0)|0,p[_>>2]=v,y=0-y|0,p[m>>2]=y),w=y-v|0,(v|0)<0?(B=0-v|0,p[m>>2]=w,p[C>>2]=B,p[_>>2]=0,y=w,v=0):B=0,(y|0)<0&&(v=v-y|0,p[_>>2]=v,B=B-y|0,p[C>>2]=B,p[m>>2]=0,y=0),M=v-B|0,w=y-B|0,(B|0)<0&&(p[_>>2]=M,p[m>>2]=w,p[C>>2]=0,y=w,v=M,B=0),w=(y|0)<(v|0)?y:v,w=(B|0)<(w|0)?B:w,!((w|0)<=0)&&(p[_>>2]=v-w,p[m>>2]=y-w,p[C>>2]=B-w)}function di(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0;_=p[y>>2]|0,O=y+4|0,v=p[O>>2]|0,(_|0)<0&&(v=v-_|0,p[O>>2]=v,M=y+8|0,p[M>>2]=(p[M>>2]|0)-_,p[y>>2]=0,_=0),(v|0)<0?(_=_-v|0,p[y>>2]=_,M=y+8|0,B=(p[M>>2]|0)-v|0,p[M>>2]=B,p[O>>2]=0,v=0):(B=y+8|0,M=B,B=p[B>>2]|0),(B|0)<0&&(_=_-B|0,p[y>>2]=_,v=v-B|0,p[O>>2]=v,p[M>>2]=0,B=0),w=(v|0)<(_|0)?v:_,w=(B|0)<(w|0)?B:w,!((w|0)<=0)&&(p[y>>2]=_-w,p[O>>2]=v-w,p[M>>2]=B-w)}function yo(y,_){y=y|0,_=_|0;var v=0,w=0;w=p[y+8>>2]|0,v=+((p[y+4>>2]|0)-w|0),le[_>>3]=+((p[y>>2]|0)-w|0)-v*.5,le[_+8>>3]=v*.8660254037844386}function On(y,_,v){y=y|0,_=_|0,v=v|0,p[v>>2]=(p[_>>2]|0)+(p[y>>2]|0),p[v+4>>2]=(p[_+4>>2]|0)+(p[y+4>>2]|0),p[v+8>>2]=(p[_+8>>2]|0)+(p[y+8>>2]|0)}function si(y,_,v){y=y|0,_=_|0,v=v|0,p[v>>2]=(p[y>>2]|0)-(p[_>>2]|0),p[v+4>>2]=(p[y+4>>2]|0)-(p[_+4>>2]|0),p[v+8>>2]=(p[y+8>>2]|0)-(p[_+8>>2]|0)}function Pa(y,_){y=y|0,_=_|0;var v=0,w=0;v=Vr(p[y>>2]|0,_)|0,p[y>>2]=v,v=y+4|0,w=Vr(p[v>>2]|0,_)|0,p[v>>2]=w,y=y+8|0,_=Vr(p[y>>2]|0,_)|0,p[y>>2]=_}function ol(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;O=p[y>>2]|0,l=(O|0)<0,w=(p[y+4>>2]|0)-(l?O:0)|0,M=(w|0)<0,B=(M?0-w|0:0)+((p[y+8>>2]|0)-(l?O:0))|0,v=(B|0)<0,y=v?0:B,_=(M?0:w)-(v?B:0)|0,B=(l?0:O)-(M?w:0)-(v?B:0)|0,v=(_|0)<(B|0)?_:B,v=(y|0)<(v|0)?y:v,w=(v|0)>0,y=y-(w?v:0)|0,_=_-(w?v:0)|0;e:do switch(B-(w?v:0)|0){case 0:switch(_|0){case 0:return l=y|0?(y|0)==1?1:7:0,l|0;case 1:return l=y|0?(y|0)==1?3:7:2,l|0;default:break e}case 1:switch(_|0){case 0:return l=y|0?(y|0)==1?5:7:4,l|0;case 1:{if(!y)y=6;else break e;return y|0}default:break e}}while(!1);return l=7,l|0}function IA(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;O=y+8|0,B=p[O>>2]|0,M=(p[y>>2]|0)-B|0,l=y+4|0,B=(p[l>>2]|0)-B|0;do if(M>>>0>715827881|B>>>0>715827881){if(v=(M|0)>0,v){if((2147483647-M|0)<(M|0)||(2147483647-(M<<1)|0)<(M|0))return l=1,l|0}else if((-2147483648-M|0)>(M|0)||(-2147483648-(M<<1)|0)>(M|0))return l=1,l|0;if(_=M*3|0,(B|0)>0){if((2147483647-B|0)<(B|0))return l=1,l|0}else if((-2147483648-B|0)>(B|0))return l=1,l|0;if(w=B<<1,(M|0)>-1){if((_|-2147483648|0)>=(B|0))return l=1,l|0}else if((_^-2147483648|0)<(B|0))return l=1,l|0;if(v){if((2147483647-M|0)<(w|0))_=1;else{v=w;break}return _|0}else{if((-2147483648-M|0)>(w|0))_=1;else{v=w;break}return _|0}}else v=B<<1,_=M*3|0;while(!1);w=Gi(+(_-B|0)/7)|0,p[y>>2]=w,B=Gi(+(v+M|0)/7)|0,p[l>>2]=B,p[O>>2]=0,v=(B|0)<(w|0),_=v?w:B,v=v?B:w;do if((v|0)<0){if((_|0)>0){if((_|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-_|0)>=(v|0)))break;Wt(23313,22444,355,22455)}if((v|0)==-2147483648|(-2147483648-_|0)>(v|0)&&Wt(23313,22444,355,22455),(_|0)>-1){if((_|-2147483648|0)<(v|0))break;Wt(23313,22444,355,22455)}else{if((_^-2147483648|0)>=(v|0))break;Wt(23313,22444,355,22455)}}while(!1);return _=B-w|0,(w|0)<0?(v=0-w|0,p[l>>2]=_,p[O>>2]=v,p[y>>2]=0,w=0):(_=B,v=0),(_|0)<0&&(w=w-_|0,p[y>>2]=w,v=v-_|0,p[O>>2]=v,p[l>>2]=0,_=0),M=w-v|0,B=_-v|0,(v|0)<0?(p[y>>2]=M,p[l>>2]=B,p[O>>2]=0,_=B,B=M,v=0):B=w,w=(_|0)<(B|0)?_:B,w=(v|0)<(w|0)?v:w,(w|0)<=0?(l=0,l|0):(p[y>>2]=B-w,p[l>>2]=_-w,p[O>>2]=v-w,l=0,l|0)}function MA(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;O=y+8|0,B=p[O>>2]|0,M=(p[y>>2]|0)-B|0,l=y+4|0,B=(p[l>>2]|0)-B|0;do if(M>>>0>715827881|B>>>0>715827881){if(v=(M|0)>0,v){if((2147483647-M|0)<(M|0))return l=1,l|0}else if((-2147483648-M|0)>(M|0))return l=1,l|0;if(_=M<<1,(B|0)>0){if((2147483647-B|0)<(B|0)||(2147483647-(B<<1)|0)<(B|0))return l=1,l|0}else if((-2147483648-B|0)>(B|0)||(-2147483648-(B<<1)|0)>(B|0))return l=1,l|0;if(w=B*3|0,v){if((2147483647-_|0)<(B|0))return l=1,l|0}else if((-2147483648-_|0)>(B|0))return l=1,l|0;if((B|0)>-1){if((w|-2147483648|0)<(M|0)){v=w;break}else _=1;return _|0}else{if((w^-2147483648|0)<(M|0))_=1;else{v=w;break}return _|0}}else v=B*3|0,_=M<<1;while(!1);w=Gi(+(_+B|0)/7)|0,p[y>>2]=w,B=Gi(+(v-M|0)/7)|0,p[l>>2]=B,p[O>>2]=0,v=(B|0)<(w|0),_=v?w:B,v=v?B:w;do if((v|0)<0){if((_|0)>0){if((_|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-_|0)>=(v|0)))break;Wt(23313,22444,404,22469)}if((v|0)==-2147483648|(-2147483648-_|0)>(v|0)&&Wt(23313,22444,404,22469),(_|0)>-1){if((_|-2147483648|0)<(v|0))break;Wt(23313,22444,404,22469)}else{if((_^-2147483648|0)>=(v|0))break;Wt(23313,22444,404,22469)}}while(!1);return _=B-w|0,(w|0)<0?(v=0-w|0,p[l>>2]=_,p[O>>2]=v,p[y>>2]=0,w=0):(_=B,v=0),(_|0)<0&&(w=w-_|0,p[y>>2]=w,v=v-_|0,p[O>>2]=v,p[l>>2]=0,_=0),M=w-v|0,B=_-v|0,(v|0)<0?(p[y>>2]=M,p[l>>2]=B,p[O>>2]=0,_=B,B=M,v=0):B=w,w=(_|0)<(B|0)?_:B,w=(v|0)<(w|0)?v:w,(w|0)<=0?(l=0,l|0):(p[y>>2]=B-w,p[l>>2]=_-w,p[O>>2]=v-w,l=0,l|0)}function rf(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;O=y+8|0,v=p[O>>2]|0,_=(p[y>>2]|0)-v|0,l=y+4|0,v=(p[l>>2]|0)-v|0,w=Gi(+((_*3|0)-v|0)/7)|0,p[y>>2]=w,_=Gi(+((v<<1)+_|0)/7)|0,p[l>>2]=_,p[O>>2]=0,v=_-w|0,(w|0)<0?(M=0-w|0,p[l>>2]=v,p[O>>2]=M,p[y>>2]=0,_=v,w=0,v=M):v=0,(_|0)<0&&(w=w-_|0,p[y>>2]=w,v=v-_|0,p[O>>2]=v,p[l>>2]=0,_=0),M=w-v|0,B=_-v|0,(v|0)<0?(p[y>>2]=M,p[l>>2]=B,p[O>>2]=0,_=B,B=M,v=0):B=w,w=(_|0)<(B|0)?_:B,w=(v|0)<(w|0)?v:w,!((w|0)<=0)&&(p[y>>2]=B-w,p[l>>2]=_-w,p[O>>2]=v-w)}function $l(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;O=y+8|0,v=p[O>>2]|0,_=(p[y>>2]|0)-v|0,l=y+4|0,v=(p[l>>2]|0)-v|0,w=Gi(+((_<<1)+v|0)/7)|0,p[y>>2]=w,_=Gi(+((v*3|0)-_|0)/7)|0,p[l>>2]=_,p[O>>2]=0,v=_-w|0,(w|0)<0?(M=0-w|0,p[l>>2]=v,p[O>>2]=M,p[y>>2]=0,_=v,w=0,v=M):v=0,(_|0)<0&&(w=w-_|0,p[y>>2]=w,v=v-_|0,p[O>>2]=v,p[l>>2]=0,_=0),M=w-v|0,B=_-v|0,(v|0)<0?(p[y>>2]=M,p[l>>2]=B,p[O>>2]=0,_=B,B=M,v=0):B=w,w=(_|0)<(B|0)?_:B,w=(v|0)<(w|0)?v:w,!((w|0)<=0)&&(p[y>>2]=B-w,p[l>>2]=_-w,p[O>>2]=v-w)}function Ac(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;_=p[y>>2]|0,O=y+4|0,v=p[O>>2]|0,l=y+8|0,w=p[l>>2]|0,B=v+(_*3|0)|0,p[y>>2]=B,v=w+(v*3|0)|0,p[O>>2]=v,_=(w*3|0)+_|0,p[l>>2]=_,w=v-B|0,(B|0)<0?(_=_-B|0,p[O>>2]=w,p[l>>2]=_,p[y>>2]=0,v=w,w=0):w=B,(v|0)<0&&(w=w-v|0,p[y>>2]=w,_=_-v|0,p[l>>2]=_,p[O>>2]=0,v=0),M=w-_|0,B=v-_|0,(_|0)<0?(p[y>>2]=M,p[O>>2]=B,p[l>>2]=0,w=M,_=0):B=v,v=(B|0)<(w|0)?B:w,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(p[y>>2]=w-v,p[O>>2]=B-v,p[l>>2]=_-v)}function No(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;B=p[y>>2]|0,O=y+4|0,_=p[O>>2]|0,l=y+8|0,v=p[l>>2]|0,w=(_*3|0)+B|0,B=v+(B*3|0)|0,p[y>>2]=B,p[O>>2]=w,_=(v*3|0)+_|0,p[l>>2]=_,v=w-B|0,(B|0)<0?(_=_-B|0,p[O>>2]=v,p[l>>2]=_,p[y>>2]=0,B=0):v=w,(v|0)<0&&(B=B-v|0,p[y>>2]=B,_=_-v|0,p[l>>2]=_,p[O>>2]=0,v=0),M=B-_|0,w=v-_|0,(_|0)<0?(p[y>>2]=M,p[O>>2]=w,p[l>>2]=0,B=M,_=0):w=v,v=(w|0)<(B|0)?w:B,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(p[y>>2]=B-v,p[O>>2]=w-v,p[l>>2]=_-v)}function nf(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0;(_+-1|0)>>>0>=6||(B=(p[15440+(_*12|0)>>2]|0)+(p[y>>2]|0)|0,p[y>>2]=B,l=y+4|0,w=(p[15440+(_*12|0)+4>>2]|0)+(p[l>>2]|0)|0,p[l>>2]=w,O=y+8|0,_=(p[15440+(_*12|0)+8>>2]|0)+(p[O>>2]|0)|0,p[O>>2]=_,v=w-B|0,(B|0)<0?(_=_-B|0,p[l>>2]=v,p[O>>2]=_,p[y>>2]=0,w=0):(v=w,w=B),(v|0)<0&&(w=w-v|0,p[y>>2]=w,_=_-v|0,p[O>>2]=_,p[l>>2]=0,v=0),M=w-_|0,B=v-_|0,(_|0)<0?(p[y>>2]=M,p[l>>2]=B,p[O>>2]=0,w=M,_=0):B=v,v=(B|0)<(w|0)?B:w,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(p[y>>2]=w-v,p[l>>2]=B-v,p[O>>2]=_-v))}function sf(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;B=p[y>>2]|0,O=y+4|0,_=p[O>>2]|0,l=y+8|0,v=p[l>>2]|0,w=_+B|0,B=v+B|0,p[y>>2]=B,p[O>>2]=w,_=v+_|0,p[l>>2]=_,v=w-B|0,(B|0)<0?(_=_-B|0,p[O>>2]=v,p[l>>2]=_,p[y>>2]=0,w=0):(v=w,w=B),(v|0)<0&&(w=w-v|0,p[y>>2]=w,_=_-v|0,p[l>>2]=_,p[O>>2]=0,v=0),M=w-_|0,B=v-_|0,(_|0)<0?(p[y>>2]=M,p[O>>2]=B,p[l>>2]=0,w=M,_=0):B=v,v=(B|0)<(w|0)?B:w,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(p[y>>2]=w-v,p[O>>2]=B-v,p[l>>2]=_-v)}function Kl(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;_=p[y>>2]|0,O=y+4|0,w=p[O>>2]|0,l=y+8|0,v=p[l>>2]|0,B=w+_|0,p[y>>2]=B,w=v+w|0,p[O>>2]=w,_=v+_|0,p[l>>2]=_,v=w-B|0,(B|0)<0?(_=_-B|0,p[O>>2]=v,p[l>>2]=_,p[y>>2]=0,w=0):(v=w,w=B),(v|0)<0&&(w=w-v|0,p[y>>2]=w,_=_-v|0,p[l>>2]=_,p[O>>2]=0,v=0),M=w-_|0,B=v-_|0,(_|0)<0?(p[y>>2]=M,p[O>>2]=B,p[l>>2]=0,w=M,_=0):B=v,v=(B|0)<(w|0)?B:w,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(p[y>>2]=w-v,p[O>>2]=B-v,p[l>>2]=_-v)}function lo(y){switch(y=y|0,y|0){case 1:{y=5;break}case 5:{y=4;break}case 4:{y=6;break}case 6:{y=2;break}case 2:{y=3;break}case 3:{y=1;break}}return y|0}function Hs(y){switch(y=y|0,y|0){case 1:{y=3;break}case 3:{y=2;break}case 2:{y=6;break}case 6:{y=4;break}case 4:{y=5;break}case 5:{y=1;break}}return y|0}function of(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;_=p[y>>2]|0,O=y+4|0,v=p[O>>2]|0,l=y+8|0,w=p[l>>2]|0,B=v+(_<<1)|0,p[y>>2]=B,v=w+(v<<1)|0,p[O>>2]=v,_=(w<<1)+_|0,p[l>>2]=_,w=v-B|0,(B|0)<0?(_=_-B|0,p[O>>2]=w,p[l>>2]=_,p[y>>2]=0,v=w,w=0):w=B,(v|0)<0&&(w=w-v|0,p[y>>2]=w,_=_-v|0,p[l>>2]=_,p[O>>2]=0,v=0),M=w-_|0,B=v-_|0,(_|0)<0?(p[y>>2]=M,p[O>>2]=B,p[l>>2]=0,w=M,_=0):B=v,v=(B|0)<(w|0)?B:w,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(p[y>>2]=w-v,p[O>>2]=B-v,p[l>>2]=_-v)}function Fi(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;B=p[y>>2]|0,O=y+4|0,_=p[O>>2]|0,l=y+8|0,v=p[l>>2]|0,w=(_<<1)+B|0,B=v+(B<<1)|0,p[y>>2]=B,p[O>>2]=w,_=(v<<1)+_|0,p[l>>2]=_,v=w-B|0,(B|0)<0?(_=_-B|0,p[O>>2]=v,p[l>>2]=_,p[y>>2]=0,B=0):v=w,(v|0)<0&&(B=B-v|0,p[y>>2]=B,_=_-v|0,p[l>>2]=_,p[O>>2]=0,v=0),M=B-_|0,w=v-_|0,(_|0)<0?(p[y>>2]=M,p[O>>2]=w,p[l>>2]=0,B=M,_=0):w=v,v=(w|0)<(B|0)?w:B,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(p[y>>2]=B-v,p[O>>2]=w-v,p[l>>2]=_-v)}function al(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0;return O=(p[y>>2]|0)-(p[_>>2]|0)|0,l=(O|0)<0,w=(p[y+4>>2]|0)-(p[_+4>>2]|0)-(l?O:0)|0,M=(w|0)<0,B=(l?0-O|0:0)+(p[y+8>>2]|0)-(p[_+8>>2]|0)+(M?0-w|0:0)|0,y=(B|0)<0,_=y?0:B,v=(M?0:w)-(y?B:0)|0,B=(l?0:O)-(M?w:0)-(y?B:0)|0,y=(v|0)<(B|0)?v:B,y=(_|0)<(y|0)?_:y,w=(y|0)>0,_=_-(w?y:0)|0,v=v-(w?y:0)|0,y=B-(w?y:0)|0,y=(y|0)>-1?y:0-y|0,v=(v|0)>-1?v:0-v|0,_=(_|0)>-1?_:0-_|0,_=(v|0)>(_|0)?v:_,((y|0)>(_|0)?y:_)|0}function la(y,_){y=y|0,_=_|0;var v=0;v=p[y+8>>2]|0,p[_>>2]=(p[y>>2]|0)-v,p[_+4>>2]=(p[y+4>>2]|0)-v}function ua(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0;w=p[y>>2]|0,p[_>>2]=w,B=p[y+4>>2]|0,O=_+4|0,p[O>>2]=B,l=_+8|0,p[l>>2]=0,v=(B|0)<(w|0),y=v?w:B,v=v?B:w;do if((v|0)<0){if((y|0)>0){if((y|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-y|0)>=(v|0)))break;return y=1,y|0}if((v|0)==-2147483648|(-2147483648-y|0)>(v|0))return _=1,_|0;if((y|0)>-1){if((y|-2147483648|0)<(v|0))break;return y=1,y|0}else{if((y^-2147483648|0)<(v|0))y=1;else break;return y|0}}while(!1);return y=B-w|0,(w|0)<0?(v=0-w|0,p[O>>2]=y,p[l>>2]=v,p[_>>2]=0,w=0):(y=B,v=0),(y|0)<0&&(w=w-y|0,p[_>>2]=w,v=v-y|0,p[l>>2]=v,p[O>>2]=0,y=0),M=w-v|0,B=y-v|0,(v|0)<0?(p[_>>2]=M,p[O>>2]=B,p[l>>2]=0,y=B,B=M,v=0):B=w,w=(y|0)<(B|0)?y:B,w=(v|0)<(w|0)?v:w,(w|0)<=0?(_=0,_|0):(p[_>>2]=B-w,p[O>>2]=y-w,p[l>>2]=v-w,_=0,_|0)}function fa(y){y=y|0;var _=0,v=0,w=0,B=0;_=y+8|0,B=p[_>>2]|0,v=B-(p[y>>2]|0)|0,p[y>>2]=v,w=y+4|0,y=(p[w>>2]|0)-B|0,p[w>>2]=y,p[_>>2]=0-(y+v)}function Ra(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;v=p[y>>2]|0,_=0-v|0,p[y>>2]=_,O=y+8|0,p[O>>2]=0,l=y+4|0,w=p[l>>2]|0,B=w+v|0,(v|0)>0?(p[l>>2]=B,p[O>>2]=v,p[y>>2]=0,_=0,w=B):v=0,(w|0)<0?(M=_-w|0,p[y>>2]=M,v=v-w|0,p[O>>2]=v,p[l>>2]=0,B=M-v|0,_=0-v|0,(v|0)<0?(p[y>>2]=B,p[l>>2]=_,p[O>>2]=0,w=_,v=0):(w=0,B=M)):B=_,_=(w|0)<(B|0)?w:B,_=(v|0)<(_|0)?v:_,!((_|0)<=0)&&(p[y>>2]=B-_,p[l>>2]=w-_,p[O>>2]=v-_)}function ha(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,m=0,C=0;if(C=Ie,Ie=Ie+64|0,m=C,l=C+56|0,!(!0&(_&2013265920|0)==134217728&(!0&(w&2013265920|0)==134217728)))return B=5,Ie=C,B|0;if((y|0)==(v|0)&(_|0)==(w|0))return p[B>>2]=0,B=0,Ie=C,B|0;if(O=jt(y|0,_|0,52)|0,Me()|0,O=O&15,h=jt(v|0,w|0,52)|0,Me()|0,(O|0)!=(h&15|0))return B=12,Ie=C,B|0;if(M=O+-1|0,O>>>0>1){Go(y,_,M,m)|0,Go(v,w,M,l)|0,h=m,d=p[h>>2]|0,h=p[h+4>>2]|0;e:do if((d|0)==(p[l>>2]|0)&&(h|0)==(p[l+4>>2]|0)){O=(O^15)*3|0,M=jt(y|0,_|0,O|0)|0,Me()|0,M=M&7,O=jt(v|0,w|0,O|0)|0,Me()|0,O=O&7;do if((M|0)==0|(O|0)==0)p[B>>2]=1,M=0;else if((M|0)==7)M=5;else{if((M|0)==1|(O|0)==1&&Bn(d,h)|0){M=5;break}if((p[15536+(M<<2)>>2]|0)!=(O|0)&&(p[15568+(M<<2)>>2]|0)!=(O|0))break e;p[B>>2]=1,M=0}while(!1);return B=M,Ie=C,B|0}while(!1)}M=m,O=M+56|0;do p[M>>2]=0,M=M+4|0;while((M|0)<(O|0));return Tn(y,_,1,m)|0,_=m,!((p[_>>2]|0)==(v|0)&&(p[_+4>>2]|0)==(w|0))&&(_=m+8|0,!((p[_>>2]|0)==(v|0)&&(p[_+4>>2]|0)==(w|0)))&&(_=m+16|0,!((p[_>>2]|0)==(v|0)&&(p[_+4>>2]|0)==(w|0)))&&(_=m+24|0,!((p[_>>2]|0)==(v|0)&&(p[_+4>>2]|0)==(w|0)))&&(_=m+32|0,!((p[_>>2]|0)==(v|0)&&(p[_+4>>2]|0)==(w|0)))&&(_=m+40|0,!((p[_>>2]|0)==(v|0)&&(p[_+4>>2]|0)==(w|0)))?(M=m+48|0,M=((p[M>>2]|0)==(v|0)?(p[M+4>>2]|0)==(w|0):0)&1):M=1,p[B>>2]=M,B=0,Ie=C,B|0}function Fa(y,_,v,w,B){return y=y|0,_=_|0,v=v|0,w=w|0,B=B|0,v=rl(y,_,v,w)|0,(v|0)==7?(B=11,B|0):(w=Yt(v|0,0,56)|0,_=_&-2130706433|(Me()|0)|268435456,p[B>>2]=y|w,p[B+4>>2]=_,B=0,B|0)}function Da(y,_,v){return y=y|0,_=_|0,v=v|0,!0&(_&2013265920|0)==268435456?(p[v>>2]=y,p[v+4>>2]=_&-2130706433|134217728,v=0,v|0):(v=6,v|0)}function da(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0;return B=Ie,Ie=Ie+16|0,w=B,p[w>>2]=0,!0&(_&2013265920|0)==268435456?(M=jt(y|0,_|0,56)|0,Me()|0,w=xn(y,_&-2130706433|134217728,M&7,w,v)|0,Ie=B,w|0):(w=6,Ie=B,w|0)}function ph(y,_){y=y|0,_=_|0;var v=0;switch(v=jt(y|0,_|0,56)|0,Me()|0,v&7){case 0:case 7:return v=0,v|0}return v=_&-2130706433|134217728,!(!0&(_&2013265920|0)==268435456)||!0&(_&117440512|0)==16777216&(Bn(y,v)|0)!=0?(v=0,v|0):(v=zo(y,v)|0,v|0)}function gh(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0;return B=Ie,Ie=Ie+16|0,w=B,!0&(_&2013265920|0)==268435456?(M=_&-2130706433|134217728,O=v,p[O>>2]=y,p[O+4>>2]=M,p[w>>2]=0,_=jt(y|0,_|0,56)|0,Me()|0,w=xn(y,M,_&7,w,v+8|0)|0,Ie=B,w|0):(w=6,Ie=B,w|0)}function wn(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0;return B=(Bn(y,_)|0)==0,_=_&-2130706433,w=v,p[w>>2]=B?y:0,p[w+4>>2]=B?_|285212672:0,w=v+8|0,p[w>>2]=y,p[w+4>>2]=_|301989888,w=v+16|0,p[w>>2]=y,p[w+4>>2]=_|318767104,w=v+24|0,p[w>>2]=y,p[w+4>>2]=_|335544320,w=v+32|0,p[w>>2]=y,p[w+4>>2]=_|352321536,v=v+40|0,p[v>>2]=y,p[v+4>>2]=_|369098752,0}function ql(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0;return O=Ie,Ie=Ie+16|0,B=O,M=_&-2130706433|134217728,!0&(_&2013265920|0)==268435456?(w=jt(y|0,_|0,56)|0,Me()|0,w=fo(y,M,w&7)|0,(w|0)==-1?(p[v>>2]=0,M=6,Ie=O,M|0):(ka(y,M,B)|0&&Wt(23313,22484,282,22499),_=jt(y|0,_|0,52)|0,Me()|0,_=_&15,Bn(y,M)|0?ko(B,_,w,2,v):Yl(B,_,w,2,v),M=0,Ie=O,M|0)):(M=6,Ie=O,M|0)}function Zl(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0;w=Ie,Ie=Ie+16|0,B=w,mh(y,_,v,B),ca(B,v+4|0),Ie=w}function mh(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0;if(l=Ie,Ie=Ie+16|0,d=l,_h(y,v,d),M=+Fr(+(1-+le[d>>3]*.5)),M<1e-16){p[w>>2]=0,p[w+4>>2]=0,p[w+8>>2]=0,p[w+12>>2]=0,Ie=l;return}if(d=p[v>>2]|0,B=+le[15920+(d*24|0)>>3],B=+bc(B-+bc(+lf(15600+(d<<4)|0,y))),Ms(_)|0?O=+bc(B+-.3334731722518321):O=B,B=+zt(+M)/.381966011250105,(_|0)>0){y=0;do B=B*2.6457513110645907,y=y+1|0;while((y|0)!=(_|0))}M=+Dt(+O)*B,le[w>>3]=M,O=+St(+O)*B,le[w+8>>3]=O,Ie=l}function _h(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0;if(M=Ie,Ie=Ie+32|0,B=M,Af(y,B),p[_>>2]=0,le[v>>3]=5,w=+yi(16400,B),w<+le[v>>3]&&(p[_>>2]=0,le[v>>3]=w),w=+yi(16424,B),w<+le[v>>3]&&(p[_>>2]=1,le[v>>3]=w),w=+yi(16448,B),w<+le[v>>3]&&(p[_>>2]=2,le[v>>3]=w),w=+yi(16472,B),w<+le[v>>3]&&(p[_>>2]=3,le[v>>3]=w),w=+yi(16496,B),w<+le[v>>3]&&(p[_>>2]=4,le[v>>3]=w),w=+yi(16520,B),w<+le[v>>3]&&(p[_>>2]=5,le[v>>3]=w),w=+yi(16544,B),w<+le[v>>3]&&(p[_>>2]=6,le[v>>3]=w),w=+yi(16568,B),w<+le[v>>3]&&(p[_>>2]=7,le[v>>3]=w),w=+yi(16592,B),w<+le[v>>3]&&(p[_>>2]=8,le[v>>3]=w),w=+yi(16616,B),w<+le[v>>3]&&(p[_>>2]=9,le[v>>3]=w),w=+yi(16640,B),w<+le[v>>3]&&(p[_>>2]=10,le[v>>3]=w),w=+yi(16664,B),w<+le[v>>3]&&(p[_>>2]=11,le[v>>3]=w),w=+yi(16688,B),w<+le[v>>3]&&(p[_>>2]=12,le[v>>3]=w),w=+yi(16712,B),w<+le[v>>3]&&(p[_>>2]=13,le[v>>3]=w),w=+yi(16736,B),w<+le[v>>3]&&(p[_>>2]=14,le[v>>3]=w),w=+yi(16760,B),w<+le[v>>3]&&(p[_>>2]=15,le[v>>3]=w),w=+yi(16784,B),w<+le[v>>3]&&(p[_>>2]=16,le[v>>3]=w),w=+yi(16808,B),w<+le[v>>3]&&(p[_>>2]=17,le[v>>3]=w),w=+yi(16832,B),w<+le[v>>3]&&(p[_>>2]=18,le[v>>3]=w),w=+yi(16856,B),!(w<+le[v>>3])){Ie=M;return}p[_>>2]=19,le[v>>3]=w,Ie=M}function pc(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0;if(M=+jo(y),M<1e-16){_=15600+(_<<4)|0,p[B>>2]=p[_>>2],p[B+4>>2]=p[_+4>>2],p[B+8>>2]=p[_+8>>2],p[B+12>>2]=p[_+12>>2];return}if(O=+en(+ +le[y+8>>3],+ +le[y>>3]),(v|0)>0){y=0;do M=M/2.6457513110645907,y=y+1|0;while((y|0)!=(v|0))}w?(M=M/3,v=(Ms(v)|0)==0,M=+$r(+((v?M:M/2.6457513110645907)*.381966011250105))):(M=+$r(+(M*.381966011250105)),Ms(v)|0&&(O=+bc(O+.3334731722518321))),fl(15600+(_<<4)|0,+bc(+le[15920+(_*24|0)>>3]-O),M,B)}function yh(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0;w=Ie,Ie=Ie+16|0,B=w,yo(y+4|0,B),pc(B,p[y>>2]|0,_,0,v),Ie=w}function ko(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0,ae=0,we=0,De=0,me=0,Fe=0,He=0,We=0,it=0,$e=0,et=0,ht=0,Rt=0,xt=0;if(ht=Ie,Ie=Ie+272|0,M=ht+256|0,Y=ht+240|0,it=ht,$e=ht+224|0,et=ht+208|0,re=ht+176|0,ae=ht+160|0,we=ht+192|0,De=ht+144|0,me=ht+128|0,Fe=ht+112|0,He=ht+96|0,We=ht+80|0,p[M>>2]=_,p[Y>>2]=p[y>>2],p[Y+4>>2]=p[y+4>>2],p[Y+8>>2]=p[y+8>>2],p[Y+12>>2]=p[y+12>>2],Uo(Y,M,it),p[B>>2]=0,Y=w+v+((w|0)==5&1)|0,(Y|0)<=(v|0)){Ie=ht;return}d=p[M>>2]|0,h=$e+4|0,m=re+4|0,C=v+5|0,P=16880+(d<<2)|0,R=16960+(d<<2)|0,L=me+8|0,G=Fe+8|0,$=He+8|0,te=et+4|0,l=v;e:for(;;){O=it+(((l|0)%5|0)<<4)|0,p[et>>2]=p[O>>2],p[et+4>>2]=p[O+4>>2],p[et+8>>2]=p[O+8>>2],p[et+12>>2]=p[O+12>>2];do;while((js(et,d,0,1)|0)==2);if((l|0)>(v|0)&(Ms(_)|0)!=0){if(p[re>>2]=p[et>>2],p[re+4>>2]=p[et+4>>2],p[re+8>>2]=p[et+8>>2],p[re+12>>2]=p[et+12>>2],yo(h,ae),w=p[re>>2]|0,M=p[17040+(w*80|0)+(p[$e>>2]<<2)>>2]|0,p[re>>2]=p[18640+(w*80|0)+(M*20|0)>>2],O=p[18640+(w*80|0)+(M*20|0)+16>>2]|0,(O|0)>0){y=0;do sf(m),y=y+1|0;while((y|0)<(O|0))}switch(O=18640+(w*80|0)+(M*20|0)+4|0,p[we>>2]=p[O>>2],p[we+4>>2]=p[O+4>>2],p[we+8>>2]=p[O+8>>2],Pa(we,(p[P>>2]|0)*3|0),On(m,we,m),di(m),yo(m,De),Rt=+(p[R>>2]|0),le[me>>3]=Rt*3,le[L>>3]=0,xt=Rt*-1.5,le[Fe>>3]=xt,le[G>>3]=Rt*2.598076211353316,le[He>>3]=xt,le[$>>3]=Rt*-2.598076211353316,p[17040+((p[re>>2]|0)*80|0)+(p[et>>2]<<2)>>2]|0){case 1:{y=Fe,w=me;break}case 3:{y=He,w=Fe;break}case 2:{y=me,w=He;break}default:{y=12;break e}}df(ae,De,w,y,We),pc(We,p[re>>2]|0,d,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1}if((l|0)<(C|0)&&(yo(te,re),pc(re,p[et>>2]|0,d,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1),p[$e>>2]=p[et>>2],p[$e+4>>2]=p[et+4>>2],p[$e+8>>2]=p[et+8>>2],p[$e+12>>2]=p[et+12>>2],l=l+1|0,(l|0)>=(Y|0)){y=3;break}}if((y|0)==3){Ie=ht;return}else(y|0)==12&&Wt(22522,22569,571,22579)}function Uo(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0;d=Ie,Ie=Ie+128|0,w=d+64|0,B=d,M=w,O=20240,l=M+60|0;do p[M>>2]=p[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));M=B,O=20304,l=M+60|0;do p[M>>2]=p[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));l=(Ms(p[_>>2]|0)|0)==0,w=l?w:B,B=y+4|0,of(B),Fi(B),Ms(p[_>>2]|0)|0&&(No(B),p[_>>2]=(p[_>>2]|0)+1),p[v>>2]=p[y>>2],_=v+4|0,On(B,w,_),di(_),p[v+16>>2]=p[y>>2],_=v+20|0,On(B,w+12|0,_),di(_),p[v+32>>2]=p[y>>2],_=v+36|0,On(B,w+24|0,_),di(_),p[v+48>>2]=p[y>>2],_=v+52|0,On(B,w+36|0,_),di(_),p[v+64>>2]=p[y>>2],v=v+68|0,On(B,w+48|0,v),di(v),Ie=d}function js(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0;if(L=Ie,Ie=Ie+32|0,P=L+12|0,l=L,R=y+4|0,C=p[16960+(_<<2)>>2]|0,m=(w|0)!=0,C=m?C*3|0:C,B=p[R>>2]|0,h=y+8|0,O=p[h>>2]|0,m){if(M=y+12|0,w=p[M>>2]|0,B=O+B+w|0,(B|0)==(C|0))return R=1,Ie=L,R|0;d=M}else d=y+12|0,w=p[d>>2]|0,B=O+B+w|0;if((B|0)<=(C|0))return R=0,Ie=L,R|0;do if((w|0)>0){if(w=p[y>>2]|0,(O|0)>0){M=18640+(w*80|0)+60|0,w=y;break}w=18640+(w*80|0)+40|0,v?(Ma(P,C,0,0),si(R,P,l),Kl(l),On(l,P,R),M=w,w=y):(M=w,w=y)}else M=18640+((p[y>>2]|0)*80|0)+20|0,w=y;while(!1);if(p[w>>2]=p[M>>2],B=M+16|0,(p[B>>2]|0)>0){w=0;do sf(R),w=w+1|0;while((w|0)<(p[B>>2]|0))}return y=M+4|0,p[P>>2]=p[y>>2],p[P+4>>2]=p[y+4>>2],p[P+8>>2]=p[y+8>>2],_=p[16880+(_<<2)>>2]|0,Pa(P,m?_*3|0:_),On(R,P,R),di(R),m?w=((p[h>>2]|0)+(p[R>>2]|0)+(p[d>>2]|0)|0)==(C|0)?1:2:w=2,R=w,Ie=L,R|0}function vh(y,_){y=y|0,_=_|0;var v=0;do v=js(y,_,0,1)|0;while((v|0)==2);return v|0}function Yl(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0,ae=0,we=0,De=0,me=0,Fe=0,He=0,We=0,it=0;if(He=Ie,Ie=Ie+240|0,M=He+224|0,we=He+208|0,De=He,me=He+192|0,Fe=He+176|0,$=He+160|0,te=He+144|0,Y=He+128|0,re=He+112|0,ae=He+96|0,p[M>>2]=_,p[we>>2]=p[y>>2],p[we+4>>2]=p[y+4>>2],p[we+8>>2]=p[y+8>>2],p[we+12>>2]=p[y+12>>2],Ql(we,M,De),p[B>>2]=0,G=w+v+((w|0)==6&1)|0,(G|0)<=(v|0)){Ie=He;return}d=p[M>>2]|0,h=v+6|0,m=16960+(d<<2)|0,C=te+8|0,P=Y+8|0,R=re+8|0,L=me+4|0,O=0,l=v,w=-1;e:for(;;){if(M=(l|0)%6|0,y=De+(M<<4)|0,p[me>>2]=p[y>>2],p[me+4>>2]=p[y+4>>2],p[me+8>>2]=p[y+8>>2],p[me+12>>2]=p[y+12>>2],y=O,O=js(me,d,0,1)|0,(l|0)>(v|0)&(Ms(_)|0)!=0&&(y|0)!=1&&(p[me>>2]|0)!=(w|0)){switch(yo(De+(((M+5|0)%6|0)<<4)+4|0,Fe),yo(De+(M<<4)+4|0,$),We=+(p[m>>2]|0),le[te>>3]=We*3,le[C>>3]=0,it=We*-1.5,le[Y>>3]=it,le[P>>3]=We*2.598076211353316,le[re>>3]=it,le[R>>3]=We*-2.598076211353316,M=p[we>>2]|0,p[17040+(M*80|0)+(((w|0)==(M|0)?p[me>>2]|0:w)<<2)>>2]|0){case 1:{y=Y,w=te;break}case 3:{y=re,w=Y;break}case 2:{y=te,w=re;break}default:{y=8;break e}}df(Fe,$,w,y,ae),!(Ec(Fe,ae)|0)&&!(Ec($,ae)|0)&&(pc(ae,p[we>>2]|0,d,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1)}if((l|0)<(h|0)&&(yo(L,Fe),pc(Fe,p[me>>2]|0,d,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1),l=l+1|0,(l|0)>=(G|0)){y=3;break}else w=p[me>>2]|0}if((y|0)==3){Ie=He;return}else(y|0)==8&&Wt(22606,22569,736,22651)}function Ql(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0;d=Ie,Ie=Ie+160|0,w=d+80|0,B=d,M=w,O=20368,l=M+72|0;do p[M>>2]=p[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));M=B,O=20448,l=M+72|0;do p[M>>2]=p[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));l=(Ms(p[_>>2]|0)|0)==0,w=l?w:B,B=y+4|0,of(B),Fi(B),Ms(p[_>>2]|0)|0&&(No(B),p[_>>2]=(p[_>>2]|0)+1),p[v>>2]=p[y>>2],_=v+4|0,On(B,w,_),di(_),p[v+16>>2]=p[y>>2],_=v+20|0,On(B,w+12|0,_),di(_),p[v+32>>2]=p[y>>2],_=v+36|0,On(B,w+24|0,_),di(_),p[v+48>>2]=p[y>>2],_=v+52|0,On(B,w+36|0,_),di(_),p[v+64>>2]=p[y>>2],_=v+68|0,On(B,w+48|0,_),di(_),p[v+80>>2]=p[y>>2],v=v+84|0,On(B,w+60|0,v),di(v),Ie=d}function Oa(y,_){return y=y|0,_=_|0,_=jt(y|0,_|0,52)|0,Me()|0,_&15|0}function af(y,_){return y=y|0,_=_|0,_=jt(y|0,_|0,45)|0,Me()|0,_&127|0}function zo(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0;if(!(!0&(_&-16777216|0)==134217728)||(O=jt(y|0,_|0,45)|0,Me()|0,O=O&127,O>>>0>121))return _=0,_|0;v=jt(y|0,_|0,52)|0,Me()|0,v=v&15;do if(v|0){for(B=1,w=0;;){if(M=jt(y|0,_|0,(15-B|0)*3|0)|0,Me()|0,M=M&7,(M|0)!=0&(w^1))if((M|0)==1&(wr(O)|0)!=0){l=0,w=13;break}else w=1;if((M|0)==7){l=0,w=13;break}if(B>>>0<v>>>0)B=B+1|0;else{w=9;break}}if((w|0)==9){if((v|0)==15)l=1;else break;return l|0}else if((w|0)==13)return l|0}while(!1);for(;;){if(l=jt(y|0,_|0,(14-v|0)*3|0)|0,Me()|0,!((l&7|0)==7&!0)){l=0,w=13;break}if(v>>>0<14)v=v+1|0;else{l=1,w=13;break}}return(w|0)==13?l|0:0}function Go(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0;if(M=jt(y|0,_|0,52)|0,Me()|0,M=M&15,v>>>0>15)return w=4,w|0;if((M|0)<(v|0))return w=12,w|0;if((M|0)==(v|0))return p[w>>2]=y,p[w+4>>2]=_,w=0,w|0;if(B=Yt(v|0,0,52)|0,B=B|y,y=Me()|0|_&-15728641,(M|0)>(v|0))do _=Yt(7,0,(14-v|0)*3|0)|0,v=v+1|0,B=_|B,y=Me()|0|y;while((v|0)<(M|0));return p[w>>2]=B,p[w+4>>2]=y,w=0,w|0}function cl(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0;if(M=jt(y|0,_|0,52)|0,Me()|0,M=M&15,!((v|0)<16&(M|0)<=(v|0)))return w=4,w|0;B=v-M|0,v=jt(y|0,_|0,45)|0,Me()|0;e:do if(!(wr(v&127)|0))v=Fs(7,0,B,((B|0)<0)<<31>>31)|0,B=Me()|0;else{t:do if(M|0){for(v=1;O=Yt(7,0,(15-v|0)*3|0)|0,!!((O&y|0)==0&((Me()|0)&_|0)==0);)if(v>>>0<M>>>0)v=v+1|0;else break t;v=Fs(7,0,B,((B|0)<0)<<31>>31)|0,B=Me()|0;break e}while(!1);v=Fs(7,0,B,((B|0)<0)<<31>>31)|0,v=oi(v|0,Me()|0,5,0)|0,v=cn(v|0,Me()|0,-5,-1)|0,v=Ds(v|0,Me()|0,6,0)|0,v=cn(v|0,Me()|0,1,0)|0,B=Me()|0}while(!1);return O=w,p[O>>2]=v,p[O+4>>2]=B,O=0,O|0}function Bn(y,_){y=y|0,_=_|0;var v=0,w=0,B=0;if(B=jt(y|0,_|0,45)|0,Me()|0,!(wr(B&127)|0))return B=0,B|0;B=jt(y|0,_|0,52)|0,Me()|0,B=B&15;e:do if(!B)v=0;else for(w=1;;){if(v=jt(y|0,_|0,(15-w|0)*3|0)|0,Me()|0,v=v&7,v|0)break e;if(w>>>0<B>>>0)w=w+1|0;else{v=0;break}}while(!1);return B=(v|0)==0&1,B|0}function Mn(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0;if(O=Ie,Ie=Ie+16|0,M=O,ul(M,y,_,v),_=M,y=p[_>>2]|0,_=p[_+4>>2]|0,(y|0)==0&(_|0)==0)return Ie=O,0;B=0,v=0;do l=w+(B<<3)|0,p[l>>2]=y,p[l+4>>2]=_,B=cn(B|0,v|0,1,0)|0,v=Me()|0,iu(M),l=M,y=p[l>>2]|0,_=p[l+4>>2]|0;while(!((y|0)==0&(_|0)==0));return Ie=O,0}function eu(y,_,v,w){return y=y|0,_=_|0,v=v|0,w=w|0,(w|0)<(v|0)?(v=_,w=y,fr(v|0),w|0):(v=Yt(-1,-1,((w-v|0)*3|0)+3|0)|0,w=Yt(~v|0,~(Me()|0)|0,(15-w|0)*3|0)|0,v=~(Me()|0)&_,w=~w&y,fr(v|0),w|0)}function PA(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0;return B=jt(y|0,_|0,52)|0,Me()|0,B=B&15,(v|0)<16&(B|0)<=(v|0)?((B|0)<(v|0)&&(B=Yt(-1,-1,((v+-1-B|0)*3|0)+3|0)|0,B=Yt(~B|0,~(Me()|0)|0,(15-v|0)*3|0)|0,_=~(Me()|0)&_,y=~B&y),B=Yt(v|0,0,52)|0,v=_&-15728641|(Me()|0),p[w>>2]=y|B,p[w+4>>2]=v,w=0,w|0):(w=4,w|0)}function gc(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0,ae=0,we=0,De=0,me=0,Fe=0;if((v|0)==0&(w|0)==0)return me=0,me|0;if(B=y,M=p[B>>2]|0,B=p[B+4>>2]|0,!0&(B&15728640|0)==0){if(!((w|0)>0|(w|0)==0&v>>>0>0)||(me=_,p[me>>2]=M,p[me+4>>2]=B,(v|0)==1&(w|0)==0))return me=0,me|0;B=1;do we=y+(B<<3)|0,De=p[we+4>>2]|0,me=_+(B<<3)|0,p[me>>2]=p[we>>2],p[me+4>>2]=De,B=B+1|0;while(0<(w|0)|(w|0)==0&B>>>0<v>>>0);return B=0,B|0}if(ae=v<<3,De=Gn(ae)|0,!De)return me=13,me|0;if(xo(De|0,y|0,ae|0)|0,we=Ks(v,8)|0,!we)return Dr(De),me=13,me|0;e:do if(v|0){t:for(;;){B=De,te=p[B>>2]|0,B=p[B+4>>2]|0,Y=jt(te|0,B|0,52)|0,Me()|0,Y=Y&15,re=Y+-1|0,$=(v|0)>0;r:do if((Y|0)!=0&$){if(R=((v|0)<0)<<31>>31,L=Yt(re|0,0,52)|0,G=Me()|0,re>>>0>15){if(!((te|0)==0&(B|0)==0)){me=17;break t}for(M=0;;){if(M=M+1|0,(M|0)>=(v|0))break r;if(w=De+(M<<3)|0,G=p[w>>2]|0,w=p[w+4>>2]|0,!((G|0)==0&(w|0)==0)){B=w,me=17;break t}}}for(M=0,y=te,w=B;;){if(!((y|0)==0&(w|0)==0)){if(!(!0&(w&117440512|0)==0)){me=22;break t}if(l=jt(y|0,w|0,52)|0,Me()|0,l=l&15,(l|0)<(re|0)){B=12,me=28;break t}if((l|0)!=(re|0)&&(y=y|L,w=w&-15728641|G,l>>>0>=Y>>>0)){O=re;do P=Yt(7,0,(14-O|0)*3|0)|0,O=O+1|0,y=P|y,w=Me()|0|w;while(O>>>0<l>>>0)}if(O=ho(y|0,w|0,v|0,R|0)|0,Me()|0,h=we+(O<<3)|0,l=h,d=p[l>>2]|0,l=p[l+4>>2]|0,(d|0)==0&(l|0)==0)O=h;else for(P=0;;){if((P|0)>(v|0)){me=32;break t}if((d|0)==(y|0)&(l&-117440513|0)==(w|0)){m=jt(d|0,l|0,56)|0,Me()|0,m=m&7,C=m+1|0,Fe=jt(d|0,l|0,45)|0,Me()|0;n:do if(!(wr(Fe&127)|0))l=7;else{if(d=jt(d|0,l|0,52)|0,Me()|0,d=d&15,!d){l=6;break}for(l=1;;){if(Fe=Yt(7,0,(15-l|0)*3|0)|0,!((Fe&y|0)==0&((Me()|0)&w|0)==0)){l=7;break n}if(l>>>0<d>>>0)l=l+1|0;else{l=6;break}}}while(!1);if((m+2|0)>>>0>l>>>0){me=42;break t}Fe=Yt(C|0,0,56)|0,w=Me()|0|w&-117440513,C=h,p[C>>2]=0,p[C+4>>2]=0,y=Fe|y}else O=(O+1|0)%(v|0)|0;if(h=we+(O<<3)|0,l=h,d=p[l>>2]|0,l=p[l+4>>2]|0,(d|0)==0&(l|0)==0){O=h;break}else P=P+1|0}Fe=O,p[Fe>>2]=y,p[Fe+4>>2]=w}if(M=M+1|0,(M|0)>=(v|0))break r;w=De+(M<<3)|0,y=p[w>>2]|0,w=p[w+4>>2]|0}}while(!1);if((v+5|0)>>>0<11){me=85;break}if(G=Ks((v|0)/6|0,8)|0,!G){me=49;break}r:do if($){P=0,C=0;do{if(l=we+(P<<3)|0,w=l,M=p[w>>2]|0,w=p[w+4>>2]|0,!((M|0)==0&(w|0)==0)){d=jt(M|0,w|0,56)|0,Me()|0,d=d&7,y=d+1|0,h=w&-117440513,Fe=jt(M|0,w|0,45)|0,Me()|0;n:do if(wr(Fe&127)|0){if(m=jt(M|0,w|0,52)|0,Me()|0,m=m&15,m|0)for(O=1;;){if(Fe=Yt(7,0,(15-O|0)*3|0)|0,!((M&Fe|0)==0&(h&(Me()|0)|0)==0))break n;if(O>>>0<m>>>0)O=O+1|0;else break}w=Yt(y|0,0,56)|0,M=w|M,w=Me()|0|h,y=l,p[y>>2]=M,p[y+4>>2]=w,y=d+2|0}while(!1);(y|0)==7&&(Fe=G+(C<<3)|0,p[Fe>>2]=M,p[Fe+4>>2]=w&-117440513,C=C+1|0)}P=P+1|0}while((P|0)!=(v|0));if($){if(P=((v|0)<0)<<31>>31,R=Yt(re|0,0,52)|0,L=Me()|0,re>>>0>15){if(!((te|0)==0&(B|0)==0)){B=4,me=84;break t}for(B=0;;){if(B=B+1|0,(B|0)>=(v|0)){M=0,B=C;break r}if(Fe=De+(B<<3)|0,!((p[Fe>>2]|0)==0&(p[Fe+4>>2]|0)==0)){B=4,me=84;break t}}}for(m=0,M=0,h=te;;){do if(!((h|0)==0&(B|0)==0)){if(l=jt(h|0,B|0,52)|0,Me()|0,l=l&15,(l|0)<(re|0)){B=12,me=84;break t}do if((l|0)==(re|0))w=h,l=B;else{if(w=h|R,y=B&-15728641|L,l>>>0<Y>>>0){l=y;break}O=re;do Fe=Yt(7,0,(14-O|0)*3|0)|0,O=O+1|0,w=Fe|w,y=Me()|0|y;while(O>>>0<l>>>0);l=y}while(!1);for(O=ho(w|0,l|0,v|0,P|0)|0,Me()|0,y=0;;){if((y|0)>(v|0)){me=77;break t}if(Fe=we+(O<<3)|0,d=p[Fe+4>>2]|0,(d&-117440513|0)==(l|0)&&(p[Fe>>2]|0)==(w|0)){me=79;break}if(O=(O+1|0)%(v|0)|0,Fe=we+(O<<3)|0,(p[Fe>>2]|0)==(w|0)&&(p[Fe+4>>2]|0)==(l|0))break;y=y+1|0}if((me|0)==79&&(me=0,!0&(d&117440512|0)==100663296))break;Fe=_+(M<<3)|0,p[Fe>>2]=h,p[Fe+4>>2]=B,M=M+1|0}while(!1);if(B=m+1|0,(B|0)>=(v|0)){B=C;break r}Fe=De+(B<<3)|0,m=B,h=p[Fe>>2]|0,B=p[Fe+4>>2]|0}}else M=0,B=C}else M=0,B=0;while(!1);if(Xo(we|0,0,ae|0)|0,xo(De|0,G|0,B<<3|0)|0,Dr(G),B)_=_+(M<<3)|0,v=B;else break e}if((me|0)==17)!0&(B&117440512|0)==0?(B=4,me=28):me=22;else if((me|0)==32)Wt(23313,22674,362,22684);else{if((me|0)==42)return Dr(De),Dr(we),Fe=10,Fe|0;if((me|0)==49)return Dr(De),Dr(we),Fe=13,Fe|0;if((me|0)==77)Wt(23313,22674,462,22684);else{if((me|0)==84)return Dr(G),Dr(De),Dr(we),Fe=B,Fe|0;if((me|0)==85){xo(_|0,De|0,v<<3|0)|0;break}}}if((me|0)==22)return Dr(De),Dr(we),Fe=5,Fe|0;if((me|0)==28)return Dr(De),Dr(we),Fe=B,Fe|0}while(!1);return Dr(De),Dr(we),Fe=0,Fe|0}function bh(y,_,v,w,B,M,O){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0,M=M|0,O=O|0;var l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0;if(G=Ie,Ie=Ie+16|0,L=G,!((v|0)>0|(v|0)==0&_>>>0>0))return L=0,Ie=G,L|0;if((O|0)>=16)return L=12,Ie=G,L|0;P=0,R=0,C=0,l=0;e:for(;;){if(h=y+(P<<3)|0,d=p[h>>2]|0,h=p[h+4>>2]|0,m=jt(d|0,h|0,52)|0,Me()|0,(m&15|0)>(O|0)){l=12,d=11;break}if(ul(L,d,h,O),m=L,h=p[m>>2]|0,m=p[m+4>>2]|0,(h|0)==0&(m|0)==0)d=C;else{d=C;do{if(!((l|0)<(M|0)|(l|0)==(M|0)&d>>>0<B>>>0)){d=10;break e}C=w+(d<<3)|0,p[C>>2]=h,p[C+4>>2]=m,d=cn(d|0,l|0,1,0)|0,l=Me()|0,iu(L),C=L,h=p[C>>2]|0,m=p[C+4>>2]|0}while(!((h|0)==0&(m|0)==0))}if(P=cn(P|0,R|0,1,0)|0,R=Me()|0,(R|0)<(v|0)|(R|0)==(v|0)&P>>>0<_>>>0)C=d;else{l=0,d=11;break}}return(d|0)==10?(L=14,Ie=G,L|0):(d|0)==11?(Ie=G,l|0):0}function RA(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0;P=Ie,Ie=Ie+16|0,C=P;e:do if((v|0)>0|(v|0)==0&_>>>0>0){for(h=0,O=0,M=0,m=0;;){if(d=y+(h<<3)|0,l=p[d>>2]|0,d=p[d+4>>2]|0,!((l|0)==0&(d|0)==0)&&(d=(cl(l,d,w,C)|0)==0,l=C,O=cn(p[l>>2]|0,p[l+4>>2]|0,O|0,M|0)|0,M=Me()|0,!d)){M=12;break}if(h=cn(h|0,m|0,1,0)|0,m=Me()|0,!((m|0)<(v|0)|(m|0)==(v|0)&h>>>0<_>>>0))break e}return Ie=P,M|0}else O=0,M=0;while(!1);return p[B>>2]=O,p[B+4>>2]=M,B=0,Ie=P,B|0}function xh(y,_){return y=y|0,_=_|0,_=jt(y|0,_|0,52)|0,Me()|0,_&1|0}function Ki(y,_){y=y|0,_=_|0;var v=0,w=0,B=0;if(B=jt(y|0,_|0,52)|0,Me()|0,B=B&15,!B)return B=0,B|0;for(w=1;;){if(v=jt(y|0,_|0,(15-w|0)*3|0)|0,Me()|0,v=v&7,v|0){w=5;break}if(w>>>0<B>>>0)w=w+1|0;else{v=0,w=5;break}}return(w|0)==5?v|0:0}function Aa(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0;if(d=jt(y|0,_|0,52)|0,Me()|0,d=d&15,!d)return l=_,d=y,fr(l|0),d|0;for(l=1,v=0;;){M=(15-l|0)*3|0,w=Yt(7,0,M|0)|0,B=Me()|0,O=jt(y|0,_|0,M|0)|0,Me()|0,M=Yt(lo(O&7)|0,0,M|0)|0,O=Me()|0,y=M|y&~w,_=O|_&~B;e:do if(!v)if((M&w|0)==0&(O&B|0)==0)v=0;else if(w=jt(y|0,_|0,52)|0,Me()|0,w=w&15,!w)v=1;else{v=1;t:for(;;){switch(O=jt(y|0,_|0,(15-v|0)*3|0)|0,Me()|0,O&7){case 1:break t;case 0:break;default:{v=1;break e}}if(v>>>0<w>>>0)v=v+1|0;else{v=1;break e}}for(v=1;;)if(O=(15-v|0)*3|0,B=jt(y|0,_|0,O|0)|0,Me()|0,M=Yt(7,0,O|0)|0,_=_&~(Me()|0),O=Yt(lo(B&7)|0,0,O|0)|0,y=y&~M|O,_=_|(Me()|0),v>>>0<w>>>0)v=v+1|0;else{v=1;break}}while(!1);if(l>>>0<d>>>0)l=l+1|0;else break}return fr(_|0),y|0}function uo(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0;if(w=jt(y|0,_|0,52)|0,Me()|0,w=w&15,!w)return v=_,w=y,fr(v|0),w|0;for(v=1;M=(15-v|0)*3|0,O=jt(y|0,_|0,M|0)|0,Me()|0,B=Yt(7,0,M|0)|0,_=_&~(Me()|0),M=Yt(lo(O&7)|0,0,M|0)|0,y=M|y&~B,_=Me()|0|_,v>>>0<w>>>0;)v=v+1|0;return fr(_|0),y|0}function tu(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0;if(d=jt(y|0,_|0,52)|0,Me()|0,d=d&15,!d)return l=_,d=y,fr(l|0),d|0;for(l=1,v=0;;){M=(15-l|0)*3|0,w=Yt(7,0,M|0)|0,B=Me()|0,O=jt(y|0,_|0,M|0)|0,Me()|0,M=Yt(Hs(O&7)|0,0,M|0)|0,O=Me()|0,y=M|y&~w,_=O|_&~B;e:do if(!v)if((M&w|0)==0&(O&B|0)==0)v=0;else if(w=jt(y|0,_|0,52)|0,Me()|0,w=w&15,!w)v=1;else{v=1;t:for(;;){switch(O=jt(y|0,_|0,(15-v|0)*3|0)|0,Me()|0,O&7){case 1:break t;case 0:break;default:{v=1;break e}}if(v>>>0<w>>>0)v=v+1|0;else{v=1;break e}}for(v=1;;)if(B=(15-v|0)*3|0,M=Yt(7,0,B|0)|0,O=_&~(Me()|0),_=jt(y|0,_|0,B|0)|0,Me()|0,_=Yt(Hs(_&7)|0,0,B|0)|0,y=y&~M|_,_=O|(Me()|0),v>>>0<w>>>0)v=v+1|0;else{v=1;break}}while(!1);if(l>>>0<d>>>0)l=l+1|0;else break}return fr(_|0),y|0}function La(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0;if(w=jt(y|0,_|0,52)|0,Me()|0,w=w&15,!w)return v=_,w=y,fr(v|0),w|0;for(v=1;O=(15-v|0)*3|0,M=Yt(7,0,O|0)|0,B=_&~(Me()|0),_=jt(y|0,_|0,O|0)|0,Me()|0,_=Yt(Hs(_&7)|0,0,O|0)|0,y=_|y&~M,_=Me()|0|B,v>>>0<w>>>0;)v=v+1|0;return fr(_|0),y|0}function mc(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0;if(d=Ie,Ie=Ie+64|0,l=d+40|0,w=d+24|0,B=d+12|0,M=d,Yt(_|0,0,52)|0,v=Me()|0|134225919,!_)return(p[y+4>>2]|0)>2||(p[y+8>>2]|0)>2||(p[y+12>>2]|0)>2?(O=0,l=0,fr(O|0),Ie=d,l|0):(Yt(Ii(y)|0,0,45)|0,O=Me()|0|v,l=-1,fr(O|0),Ie=d,l|0);if(p[l>>2]=p[y>>2],p[l+4>>2]=p[y+4>>2],p[l+8>>2]=p[y+8>>2],p[l+12>>2]=p[y+12>>2],O=l+4|0,(_|0)>0)for(y=-1;p[w>>2]=p[O>>2],p[w+4>>2]=p[O+4>>2],p[w+8>>2]=p[O+8>>2],_&1?(rf(O),p[B>>2]=p[O>>2],p[B+4>>2]=p[O+4>>2],p[B+8>>2]=p[O+8>>2],Ac(B)):($l(O),p[B>>2]=p[O>>2],p[B+4>>2]=p[O+4>>2],p[B+8>>2]=p[O+8>>2],No(B)),si(w,B,M),di(M),m=(15-_|0)*3|0,h=Yt(7,0,m|0)|0,v=v&~(Me()|0),m=Yt(ol(M)|0,0,m|0)|0,y=m|y&~h,v=Me()|0|v,(_|0)>1;)_=_+-1|0;else y=-1;e:do if((p[O>>2]|0)<=2&&(p[l+8>>2]|0)<=2&&(p[l+12>>2]|0)<=2){if(w=Ii(l)|0,_=Yt(w|0,0,45)|0,_=_|y,y=Me()|0|v&-1040385,M=Ui(l)|0,!(wr(w)|0)){if((M|0)<=0)break;for(B=0;;){if(w=jt(_|0,y|0,52)|0,Me()|0,w=w&15,w)for(v=1;m=(15-v|0)*3|0,l=jt(_|0,y|0,m|0)|0,Me()|0,h=Yt(7,0,m|0)|0,y=y&~(Me()|0),m=Yt(lo(l&7)|0,0,m|0)|0,_=_&~h|m,y=y|(Me()|0),v>>>0<w>>>0;)v=v+1|0;if(B=B+1|0,(B|0)==(M|0))break e}}B=jt(_|0,y|0,52)|0,Me()|0,B=B&15;t:do if(B){v=1;r:for(;;){switch(m=jt(_|0,y|0,(15-v|0)*3|0)|0,Me()|0,m&7){case 1:break r;case 0:break;default:break t}if(v>>>0<B>>>0)v=v+1|0;else break t}if(tf(w,p[l>>2]|0)|0)for(v=1;l=(15-v|0)*3|0,h=Yt(7,0,l|0)|0,m=y&~(Me()|0),y=jt(_|0,y|0,l|0)|0,Me()|0,y=Yt(Hs(y&7)|0,0,l|0)|0,_=_&~h|y,y=m|(Me()|0),v>>>0<B>>>0;)v=v+1|0;else for(v=1;m=(15-v|0)*3|0,l=jt(_|0,y|0,m|0)|0,Me()|0,h=Yt(7,0,m|0)|0,y=y&~(Me()|0),m=Yt(lo(l&7)|0,0,m|0)|0,_=_&~h|m,y=y|(Me()|0),v>>>0<B>>>0;)v=v+1|0}while(!1);if((M|0)>0){v=0;do _=Aa(_,y)|0,y=Me()|0,v=v+1|0;while((v|0)!=(M|0))}}else _=0,y=0;while(!1);return h=y,m=_,fr(h|0),Ie=d,m|0}function Ms(y){return y=y|0,(y|0)%2|0|0}function Na(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0;return B=Ie,Ie=Ie+16|0,w=B,_>>>0>15?(w=4,Ie=B,w|0):(p[y+4>>2]&2146435072|0)==2146435072||(p[y+8+4>>2]&2146435072|0)==2146435072?(w=3,Ie=B,w|0):(Zl(y,_,w),_=mc(w,_)|0,w=Me()|0,p[v>>2]=_,p[v+4>>2]=w,(_|0)==0&(w|0)==0&&Wt(23313,22674,786,22697),w=0,Ie=B,w|0)}function Ps(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0;if(B=v+4|0,M=jt(y|0,_|0,52)|0,Me()|0,M=M&15,O=jt(y|0,_|0,45)|0,Me()|0,w=(M|0)==0,wr(O&127)|0){if(w)return O=1,O|0;w=1}else{if(w)return O=0,O|0;!(p[B>>2]|0)&&!(p[v+8>>2]|0)?w=(p[v+12>>2]|0)!=0&1:w=1}for(v=1;v&1?Ac(B):No(B),O=jt(y|0,_|0,(15-v|0)*3|0)|0,Me()|0,nf(B,O&7),v>>>0<M>>>0;)v=v+1|0;return w|0}function ka(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0;if(m=Ie,Ie=Ie+16|0,d=m,h=jt(y|0,_|0,45)|0,Me()|0,h=h&127,h>>>0>121)return p[v>>2]=0,p[v+4>>2]=0,p[v+8>>2]=0,p[v+12>>2]=0,h=5,Ie=m,h|0;e:do if(wr(h)|0&&(M=jt(y|0,_|0,52)|0,Me()|0,M=M&15,(M|0)!=0)){w=1;t:for(;;){switch(l=jt(y|0,_|0,(15-w|0)*3|0)|0,Me()|0,l&7){case 5:break t;case 0:break;default:{w=_;break e}}if(w>>>0<M>>>0)w=w+1|0;else{w=_;break e}}for(B=1,w=_;_=(15-B|0)*3|0,O=Yt(7,0,_|0)|0,l=w&~(Me()|0),w=jt(y|0,w|0,_|0)|0,Me()|0,w=Yt(Hs(w&7)|0,0,_|0)|0,y=y&~O|w,w=l|(Me()|0),B>>>0<M>>>0;)B=B+1|0}else w=_;while(!1);if(l=7696+(h*28|0)|0,p[v>>2]=p[l>>2],p[v+4>>2]=p[l+4>>2],p[v+8>>2]=p[l+8>>2],p[v+12>>2]=p[l+12>>2],!(Ps(y,w,v)|0))return h=0,Ie=m,h|0;if(O=v+4|0,p[d>>2]=p[O>>2],p[d+4>>2]=p[O+4>>2],p[d+8>>2]=p[O+8>>2],M=jt(y|0,w|0,52)|0,Me()|0,l=M&15,M&1?(No(O),M=l+1|0):M=l,!(wr(h)|0))w=0;else{e:do if(!l)w=0;else for(_=1;;){if(B=jt(y|0,w|0,(15-_|0)*3|0)|0,Me()|0,B=B&7,B|0){w=B;break e}if(_>>>0<l>>>0)_=_+1|0;else{w=0;break}}while(!1);w=(w|0)==4&1}if(!(js(v,M,w,0)|0))(M|0)!=(l|0)&&(p[O>>2]=p[d>>2],p[O+4>>2]=p[d+4>>2],p[O+8>>2]=p[d+8>>2]);else{if(wr(h)|0)do;while(js(v,M,0,0)|0);(M|0)!=(l|0)&&$l(O)}return h=0,Ie=m,h|0}function _c(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0;return M=Ie,Ie=Ie+16|0,w=M,B=ka(y,_,w)|0,B|0?(Ie=M,B|0):(B=jt(y|0,_|0,52)|0,Me()|0,yh(w,B&15,v),B=0,Ie=M,B|0)}function yc(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0;if(O=Ie,Ie=Ie+16|0,M=O,w=ka(y,_,M)|0,w|0)return M=w,Ie=O,M|0;w=jt(y|0,_|0,45)|0,Me()|0,w=(wr(w&127)|0)==0,B=jt(y|0,_|0,52)|0,Me()|0,B=B&15;e:do if(!w){if(B|0)for(w=1;;){if(l=Yt(7,0,(15-w|0)*3|0)|0,!((l&y|0)==0&((Me()|0)&_|0)==0))break e;if(w>>>0<B>>>0)w=w+1|0;else break}return ko(M,B,0,5,v),l=0,Ie=O,l|0}while(!1);return Yl(M,B,0,6,v),l=0,Ie=O,l|0}function Ua(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0;if(B=jt(y|0,_|0,45)|0,Me()|0,!(wr(B&127)|0))return B=2,p[v>>2]=B,0;if(B=jt(y|0,_|0,52)|0,Me()|0,B=B&15,!B)return B=5,p[v>>2]=B,0;for(w=1;;){if(M=Yt(7,0,(15-w|0)*3|0)|0,!((M&y|0)==0&((Me()|0)&_|0)==0)){w=2,y=6;break}if(w>>>0<B>>>0)w=w+1|0;else{w=5,y=6;break}}return(y|0)==6&&(p[v>>2]=w),0}function vc(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0;C=Ie,Ie=Ie+128|0,h=C+112|0,M=C+96|0,m=C,B=jt(y|0,_|0,52)|0,Me()|0,l=B&15,p[h>>2]=l,O=jt(y|0,_|0,45)|0,Me()|0,O=O&127;e:do if(wr(O)|0){if(l|0)for(w=1;;){if(d=Yt(7,0,(15-w|0)*3|0)|0,!((d&y|0)==0&((Me()|0)&_|0)==0)){B=0;break e}if(w>>>0<l>>>0)w=w+1|0;else break}if(B&1)B=1;else return d=Yt(l+1|0,0,52)|0,m=Me()|0|_&-15728641,h=Yt(7,0,(14-l|0)*3|0)|0,m=vc((d|y)&~h,m&~(Me()|0),v)|0,Ie=C,m|0}else B=0;while(!1);if(w=ka(y,_,M)|0,!w){B?(Uo(M,h,m),d=5):(Ql(M,h,m),d=6);e:do if(wr(O)|0)if(!l)y=5;else for(w=1;;){if(O=Yt(7,0,(15-w|0)*3|0)|0,!((O&y|0)==0&((Me()|0)&_|0)==0)){y=2;break e}if(w>>>0<l>>>0)w=w+1|0;else{y=5;break}}else y=2;while(!1);Xo(v|0,-1,y<<2|0)|0;e:do if(B)for(M=0;;){if(O=m+(M<<4)|0,vh(O,p[h>>2]|0)|0,O=p[O>>2]|0,l=p[v>>2]|0,(l|0)==-1|(l|0)==(O|0))w=v;else{B=0;do{if(B=B+1|0,B>>>0>=y>>>0){w=1;break e}w=v+(B<<2)|0,l=p[w>>2]|0}while(!((l|0)==-1|(l|0)==(O|0)))}if(p[w>>2]=O,M=M+1|0,M>>>0>=d>>>0){w=0;break}}else for(M=0;;){if(O=m+(M<<4)|0,js(O,p[h>>2]|0,0,1)|0,O=p[O>>2]|0,l=p[v>>2]|0,(l|0)==-1|(l|0)==(O|0))w=v;else{B=0;do{if(B=B+1|0,B>>>0>=y>>>0){w=1;break e}w=v+(B<<2)|0,l=p[w>>2]|0}while(!((l|0)==-1|(l|0)==(O|0)))}if(p[w>>2]=O,M=M+1|0,M>>>0>=d>>>0){w=0;break}}while(!1)}return m=w,Ie=C,m|0}function ru(){return 12}function ll(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0;if(y>>>0>15)return l=4,l|0;if(Yt(y|0,0,52)|0,l=Me()|0|134225919,!y){v=0,w=0;do wr(w)|0&&(Yt(w|0,0,45)|0,O=l|(Me()|0),y=_+(v<<3)|0,p[y>>2]=-1,p[y+4>>2]=O,v=v+1|0),w=w+1|0;while((w|0)!=122);return v=0,v|0}v=0,O=0;do{if(wr(O)|0){for(Yt(O|0,0,45)|0,w=1,B=-1,M=l|(Me()|0);d=Yt(7,0,(15-w|0)*3|0)|0,B=B&~d,M=M&~(Me()|0),(w|0)!=(y|0);)w=w+1|0;d=_+(v<<3)|0,p[d>>2]=B,p[d+4>>2]=M,v=v+1|0}O=O+1|0}while((O|0)!=122);return v=0,v|0}function nu(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0;if(Y=Ie,Ie=Ie+16|0,$=Y,te=jt(y|0,_|0,52)|0,Me()|0,te=te&15,v>>>0>15)return te=4,Ie=Y,te|0;if((te|0)<(v|0))return te=12,Ie=Y,te|0;if((te|0)!=(v|0))if(M=Yt(v|0,0,52)|0,M=M|y,l=Me()|0|_&-15728641,(te|0)>(v|0)){d=v;do G=Yt(7,0,(14-d|0)*3|0)|0,d=d+1|0,M=G|M,l=Me()|0|l;while((d|0)<(te|0));G=M}else G=M;else G=y,l=_;L=jt(G|0,l|0,45)|0,Me()|0;e:do if(wr(L&127)|0){if(d=jt(G|0,l|0,52)|0,Me()|0,d=d&15,d|0)for(M=1;;){if(L=Yt(7,0,(15-M|0)*3|0)|0,!((L&G|0)==0&((Me()|0)&l|0)==0)){h=33;break e}if(M>>>0<d>>>0)M=M+1|0;else break}if(L=w,p[L>>2]=0,p[L+4>>2]=0,(te|0)>(v|0)){for(L=_&-15728641,R=te;;){if(P=R,R=R+-1|0,R>>>0>15|(te|0)<(R|0)){h=19;break}if((te|0)!=(R|0))if(M=Yt(R|0,0,52)|0,M=M|y,d=Me()|0|L,(te|0)<(P|0))C=M;else{h=R;do C=Yt(7,0,(14-h|0)*3|0)|0,h=h+1|0,M=C|M,d=Me()|0|d;while((h|0)<(te|0));C=M}else C=y,d=_;if(m=jt(C|0,d|0,45)|0,Me()|0,!(wr(m&127)|0))M=0;else{m=jt(C|0,d|0,52)|0,Me()|0,m=m&15;t:do if(!m)M=0;else for(h=1;;){if(M=jt(C|0,d|0,(15-h|0)*3|0)|0,Me()|0,M=M&7,M|0)break t;if(h>>>0<m>>>0)h=h+1|0;else{M=0;break}}while(!1);M=(M|0)==0&1}if(d=jt(y|0,_|0,(15-P|0)*3|0)|0,Me()|0,d=d&7,(d|0)==7){B=5,h=42;break}if(M=(M|0)!=0,(d|0)==1&M){B=5,h=42;break}if(C=d+(((d|0)!=0&M)<<31>>31)|0,C|0&&(h=te-P|0,h=Fs(7,0,h,((h|0)<0)<<31>>31)|0,m=Me()|0,M?(M=oi(h|0,m|0,5,0)|0,M=cn(M|0,Me()|0,-5,-1)|0,M=Ds(M|0,Me()|0,6,0)|0,M=cn(M|0,Me()|0,1,0)|0,d=Me()|0):(M=h,d=m),P=C+-1|0,P=oi(h|0,m|0,P|0,((P|0)<0)<<31>>31|0)|0,P=cn(M|0,d|0,P|0,Me()|0)|0,C=Me()|0,m=w,m=cn(P|0,C|0,p[m>>2]|0,p[m+4>>2]|0)|0,C=Me()|0,P=w,p[P>>2]=m,p[P+4>>2]=C),(R|0)<=(v|0)){h=37;break}}if((h|0)==19)Wt(23313,22674,1099,22710);else if((h|0)==37){O=w,B=p[O+4>>2]|0,O=p[O>>2]|0;break}else if((h|0)==42)return Ie=Y,B|0}else B=0,O=0}else h=33;while(!1);e:do if((h|0)==33)if(L=w,p[L>>2]=0,p[L+4>>2]=0,(te|0)>(v|0)){for(M=te;;){if(B=jt(y|0,_|0,(15-M|0)*3|0)|0,Me()|0,B=B&7,(B|0)==7){B=5;break}if(O=te-M|0,O=Fs(7,0,O,((O|0)<0)<<31>>31)|0,B=oi(O|0,Me()|0,B|0,0)|0,O=Me()|0,L=w,O=cn(p[L>>2]|0,p[L+4>>2]|0,B|0,O|0)|0,B=Me()|0,L=w,p[L>>2]=O,p[L+4>>2]=B,M=M+-1|0,(M|0)<=(v|0))break e}return Ie=Y,B|0}else B=0,O=0;while(!1);return cl(G,l,te,$)|0&&Wt(23313,22674,1063,22725),te=$,$=p[te+4>>2]|0,((B|0)>-1|(B|0)==-1&O>>>0>4294967295)&(($|0)>(B|0)|(($|0)==(B|0)?(p[te>>2]|0)>>>0>O>>>0:0))?(te=0,Ie=Y,te|0):(Wt(23313,22674,1139,22710),0)}function FA(y,_,v,w,B,M){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0,M=M|0;var O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0;if(C=Ie,Ie=Ie+16|0,O=C,B>>>0>15)return M=4,Ie=C,M|0;if(l=jt(v|0,w|0,52)|0,Me()|0,l=l&15,(l|0)>(B|0))return M=12,Ie=C,M|0;if(cl(v,w,B,O)|0&&Wt(23313,22674,1063,22725),m=O,h=p[m+4>>2]|0,!(((_|0)>-1|(_|0)==-1&y>>>0>4294967295)&((h|0)>(_|0)|((h|0)==(_|0)?(p[m>>2]|0)>>>0>y>>>0:0))))return M=2,Ie=C,M|0;m=B-l|0,B=Yt(B|0,0,52)|0,d=Me()|0|w&-15728641,h=M,p[h>>2]=B|v,p[h+4>>2]=d,h=jt(v|0,w|0,45)|0,Me()|0;e:do if(wr(h&127)|0){if(l|0)for(O=1;;){if(h=Yt(7,0,(15-O|0)*3|0)|0,!((h&v|0)==0&((Me()|0)&w|0)==0))break e;if(O>>>0<l>>>0)O=O+1|0;else break}if((m|0)<1)return M=0,Ie=C,M|0;for(h=l^15,w=-1,d=1,O=1;;){l=m-d|0,l=Fs(7,0,l,((l|0)<0)<<31>>31)|0,v=Me()|0;do if(O)if(O=oi(l|0,v|0,5,0)|0,O=cn(O|0,Me()|0,-5,-1)|0,O=Ds(O|0,Me()|0,6,0)|0,B=Me()|0,(_|0)>(B|0)|(_|0)==(B|0)&y>>>0>O>>>0){_=cn(y|0,_|0,-1,-1)|0,_=jr(_|0,Me()|0,O|0,B|0)|0,O=Me()|0,P=M,L=p[P>>2]|0,P=p[P+4>>2]|0,G=(h+w|0)*3|0,R=Yt(7,0,G|0)|0,P=P&~(Me()|0),w=Ds(_|0,O|0,l|0,v|0)|0,y=Me()|0,B=cn(w|0,y|0,2,0)|0,G=Yt(B|0,Me()|0,G|0)|0,P=Me()|0|P,B=M,p[B>>2]=G|L&~R,p[B+4>>2]=P,y=oi(w|0,y|0,l|0,v|0)|0,y=jr(_|0,O|0,y|0,Me()|0)|0,O=0,_=Me()|0;break}else{G=M,R=p[G>>2]|0,G=p[G+4>>2]|0,L=Yt(7,0,(h+w|0)*3|0)|0,G=G&~(Me()|0),O=M,p[O>>2]=R&~L,p[O+4>>2]=G,O=1;break}else R=M,B=p[R>>2]|0,R=p[R+4>>2]|0,w=(h+w|0)*3|0,P=Yt(7,0,w|0)|0,R=R&~(Me()|0),G=Ds(y|0,_|0,l|0,v|0)|0,O=Me()|0,w=Yt(G|0,O|0,w|0)|0,R=Me()|0|R,L=M,p[L>>2]=w|B&~P,p[L+4>>2]=R,O=oi(G|0,O|0,l|0,v|0)|0,y=jr(y|0,_|0,O|0,Me()|0)|0,O=0,_=Me()|0;while(!1);if((m|0)>(d|0))w=~d,d=d+1|0;else{_=0;break}}return Ie=C,_|0}while(!1);if((m|0)<1)return G=0,Ie=C,G|0;for(B=l^15,O=1;;)if(L=m-O|0,L=Fs(7,0,L,((L|0)<0)<<31>>31)|0,G=Me()|0,d=M,v=p[d>>2]|0,d=p[d+4>>2]|0,l=(B-O|0)*3|0,w=Yt(7,0,l|0)|0,d=d&~(Me()|0),P=Ds(y|0,_|0,L|0,G|0)|0,R=Me()|0,l=Yt(P|0,R|0,l|0)|0,d=Me()|0|d,h=M,p[h>>2]=l|v&~w,p[h+4>>2]=d,G=oi(P|0,R|0,L|0,G|0)|0,y=jr(y|0,_|0,G|0,Me()|0)|0,_=Me()|0,(m|0)<=(O|0)){_=0;break}else O=O+1|0;return Ie=C,_|0}function ul(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0;B=jt(_|0,v|0,52)|0,Me()|0,B=B&15,(_|0)==0&(v|0)==0|((w|0)>15|(B|0)>(w|0))?(w=-1,B=-1,_=0,v=0):(M=eu(_,v,B+1|0,w)|0,v=(Me()|0)&-15728641,_=Yt(w|0,0,52)|0,_=M|_,v=v|(Me()|0),M=(Bn(_,v)|0)==0,w=M?-1:w),M=y,p[M>>2]=_,p[M+4>>2]=v,p[y+8>>2]=B,p[y+12>>2]=w}function iu(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0;if(v=y,_=p[v>>2]|0,v=p[v+4>>2]|0,!((_|0)==0&(v|0)==0)&&(w=jt(_|0,v|0,52)|0,Me()|0,w=w&15,l=Yt(1,0,(w^15)*3|0)|0,_=cn(l|0,Me()|0,_|0,v|0)|0,v=Me()|0,l=y,p[l>>2]=_,p[l+4>>2]=v,l=y+8|0,O=p[l>>2]|0,!((w|0)<(O|0)))){for(d=y+12|0,M=w;;){if((M|0)==(O|0)){w=5;break}if(h=(M|0)==(p[d>>2]|0),B=(15-M|0)*3|0,w=jt(_|0,v|0,B|0)|0,Me()|0,w=w&7,h&((w|0)==1&!0)){w=7;break}if(!((w|0)==7&!0)){w=10;break}if(h=Yt(1,0,B|0)|0,_=cn(_|0,v|0,h|0,Me()|0)|0,v=Me()|0,h=y,p[h>>2]=_,p[h+4>>2]=v,(M|0)>(O|0))M=M+-1|0;else{w=10;break}}if((w|0)==5){h=y,p[h>>2]=0,p[h+4>>2]=0,p[l>>2]=-1,p[d>>2]=-1;return}else if((w|0)==7){O=Yt(1,0,B|0)|0,O=cn(_|0,v|0,O|0,Me()|0)|0,l=Me()|0,h=y,p[h>>2]=O,p[h+4>>2]=l,p[d>>2]=M+-1;return}else if((w|0)==10)return}}function bc(y){y=+y;var _=0;return _=y<0?y+6.283185307179586:y,+(y>=6.283185307179586?_+-6.283185307179586:_)}function za(y,_){return y=y|0,_=_|0,+It(+(+le[y>>3]-+le[_>>3]))<17453292519943298e-27?(_=+It(+(+le[y+8>>3]-+le[_+8>>3]))<17453292519943298e-27,_|0):(_=0,_|0)}function su(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0;return B=+le[_>>3],w=+le[y>>3],M=+St(+((B-w)*.5)),v=+St(+((+le[_+8>>3]-+le[y+8>>3])*.5)),v=M*M+v*(+Dt(+B)*+Dt(+w)*v),+(+en(+ +Ft(+v),+ +Ft(+(1-v)))*2)}function Ga(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0;return B=+le[_>>3],w=+le[y>>3],M=+St(+((B-w)*.5)),v=+St(+((+le[_+8>>3]-+le[y+8>>3])*.5)),v=M*M+v*(+Dt(+B)*+Dt(+w)*v),+(+en(+ +Ft(+v),+ +Ft(+(1-v)))*2*6371.007180918475)}function cf(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0;return B=+le[_>>3],w=+le[y>>3],M=+St(+((B-w)*.5)),v=+St(+((+le[_+8>>3]-+le[y+8>>3])*.5)),v=M*M+v*(+Dt(+B)*+Dt(+w)*v),+(+en(+ +Ft(+v),+ +Ft(+(1-v)))*2*6371.007180918475*1e3)}function lf(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0;return M=+le[_>>3],w=+Dt(+M),B=+le[_+8>>3]-+le[y+8>>3],O=w*+St(+B),v=+le[y>>3],+ +en(+O,+(+St(+M)*+Dt(+v)-+Dt(+B)*(w*+St(+v))))}function fl(y,_,v,w){y=y|0,_=+_,v=+v,w=w|0;var B=0,M=0,O=0,l=0;if(v<1e-16){p[w>>2]=p[y>>2],p[w+4>>2]=p[y+4>>2],p[w+8>>2]=p[y+8>>2],p[w+12>>2]=p[y+12>>2];return}M=_<0?_+6.283185307179586:_,M=_>=6.283185307179586?M+-6.283185307179586:M;do if(M<1e-16)_=+le[y>>3]+v,le[w>>3]=_,B=w;else{if(B=+It(+(M+-3.141592653589793))<1e-16,_=+le[y>>3],B){_=_-v,le[w>>3]=_,B=w;break}if(O=+Dt(+v),v=+St(+v),_=O*+St(+_)+ +Dt(+M)*(v*+Dt(+_)),_=_>1?1:_,_=+qt(+(_<-1?-1:_)),le[w>>3]=_,+It(+(_+-1.5707963267948966))<1e-16){le[w>>3]=1.5707963267948966,le[w+8>>3]=0;return}if(+It(+(_+1.5707963267948966))<1e-16){le[w>>3]=-1.5707963267948966,le[w+8>>3]=0;return}if(l=+Dt(+_),M=v*+St(+M)/l,v=+le[y>>3],_=(O-+St(+_)*+St(+v))/+Dt(+v)/l,O=M>1?1:M,_=_>1?1:_,_=+le[y+8>>3]+ +en(+(O<-1?-1:O),+(_<-1?-1:_)),_>3.141592653589793)do _=_+-6.283185307179586;while(_>3.141592653589793);if(_<-3.141592653589793)do _=_+6.283185307179586;while(_<-3.141592653589793);le[w+8>>3]=_;return}while(!1);if(+It(+(_+-1.5707963267948966))<1e-16){le[B>>3]=1.5707963267948966,le[w+8>>3]=0;return}if(+It(+(_+1.5707963267948966))<1e-16){le[B>>3]=-1.5707963267948966,le[w+8>>3]=0;return}if(_=+le[y+8>>3],_>3.141592653589793)do _=_+-6.283185307179586;while(_>3.141592653589793);if(_<-3.141592653589793)do _=_+6.283185307179586;while(_<-3.141592653589793);le[w+8>>3]=_}function wh(y,_){return y=y|0,_=_|0,y>>>0>15?(_=4,_|0):(le[_>>3]=+le[20528+(y<<3)>>3],_=0,_|0)}function Va(y,_){return y=y|0,_=_|0,y>>>0>15?(_=4,_|0):(le[_>>3]=+le[20656+(y<<3)>>3],_=0,_|0)}function zn(y,_){return y=y|0,_=_|0,y>>>0>15?(_=4,_|0):(le[_>>3]=+le[20784+(y<<3)>>3],_=0,_|0)}function ou(y,_){return y=y|0,_=_|0,y>>>0>15?(_=4,_|0):(le[_>>3]=+le[20912+(y<<3)>>3],_=0,_|0)}function Vo(y,_){y=y|0,_=_|0;var v=0;return y>>>0>15?(_=4,_|0):(v=Fs(7,0,y,((y|0)<0)<<31>>31)|0,v=oi(v|0,Me()|0,120,0)|0,y=Me()|0,p[_>>2]=v|2,p[_+4>>2]=y,_=0,_|0)}function Ho(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0;return P=+le[_>>3],m=+le[y>>3],d=+St(+((P-m)*.5)),M=+le[_+8>>3],h=+le[y+8>>3],O=+St(+((M-h)*.5)),l=+Dt(+m),C=+Dt(+P),O=d*d+O*(C*l*O),O=+en(+ +Ft(+O),+ +Ft(+(1-O)))*2,d=+le[v>>3],P=+St(+((d-P)*.5)),w=+le[v+8>>3],M=+St(+((w-M)*.5)),B=+Dt(+d),M=P*P+M*(C*B*M),M=+en(+ +Ft(+M),+ +Ft(+(1-M)))*2,d=+St(+((m-d)*.5)),w=+St(+((h-w)*.5)),w=d*d+w*(l*B*w),w=+en(+ +Ft(+w),+ +Ft(+(1-w)))*2,B=(O+M+w)*.5,+(+$r(+ +Ft(+(+zt(+(B*.5))*+zt(+((B-O)*.5))*+zt(+((B-M)*.5))*+zt(+((B-w)*.5)))))*4)}function nn(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0;if(l=Ie,Ie=Ie+192|0,M=l+168|0,O=l,B=_c(y,_,M)|0,B|0)return v=B,Ie=l,v|0;if(yc(y,_,O)|0&&Wt(23313,22742,386,22751),_=p[O>>2]|0,(_|0)>0){if(w=+Ho(O+8|0,O+8+(((_|0)!=1&1)<<4)|0,M)+0,(_|0)!=1){y=1;do B=y,y=y+1|0,w=w+ +Ho(O+8+(B<<4)|0,O+8+(((y|0)%(_|0)|0)<<4)|0,M);while((y|0)<(_|0))}}else w=0;return le[v>>3]=w,v=0,Ie=l,v|0}function Pn(y,_,v){return y=y|0,_=_|0,v=v|0,y=nn(y,_,v)|0,y|0||(le[v>>3]=+le[v>>3]*6371.007180918475*6371.007180918475),y|0}function Rs(y,_,v){return y=y|0,_=_|0,v=v|0,y=nn(y,_,v)|0,y|0||(le[v>>3]=+le[v>>3]*6371.007180918475*6371.007180918475*1e3*1e3),y|0}function hl(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0;if(l=Ie,Ie=Ie+176|0,O=l,y=ql(y,_,O)|0,y|0)return O=y,Ie=l,O|0;if(le[v>>3]=0,y=p[O>>2]|0,(y|0)<=1)return O=0,Ie=l,O|0;_=y+-1|0,y=0,w=+le[O+8>>3],B=+le[O+16>>3],M=0;do y=y+1|0,h=w,w=+le[O+8+(y<<4)>>3],m=+St(+((w-h)*.5)),d=B,B=+le[O+8+(y<<4)+8>>3],d=+St(+((B-d)*.5)),d=m*m+d*(+Dt(+w)*+Dt(+h)*d),M=M+ +en(+ +Ft(+d),+ +Ft(+(1-d)))*2;while((y|0)<(_|0));return le[v>>3]=M,O=0,Ie=l,O|0}function xc(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0;if(l=Ie,Ie=Ie+176|0,O=l,y=ql(y,_,O)|0,y|0)return O=y,M=+le[v>>3],M=M*6371.007180918475,le[v>>3]=M,Ie=l,O|0;if(le[v>>3]=0,y=p[O>>2]|0,(y|0)<=1)return O=0,M=0,M=M*6371.007180918475,le[v>>3]=M,Ie=l,O|0;_=y+-1|0,y=0,w=+le[O+8>>3],B=+le[O+16>>3],M=0;do y=y+1|0,h=w,w=+le[O+8+(y<<4)>>3],m=+St(+((w-h)*.5)),d=B,B=+le[O+8+(y<<4)+8>>3],d=+St(+((B-d)*.5)),d=m*m+d*(+Dt(+h)*+Dt(+w)*d),M=M+ +en(+ +Ft(+d),+ +Ft(+(1-d)))*2;while((y|0)!=(_|0));return le[v>>3]=M,O=0,m=M,m=m*6371.007180918475,le[v>>3]=m,Ie=l,O|0}function dl(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0;if(l=Ie,Ie=Ie+176|0,O=l,y=ql(y,_,O)|0,y|0)return O=y,M=+le[v>>3],M=M*6371.007180918475,M=M*1e3,le[v>>3]=M,Ie=l,O|0;if(le[v>>3]=0,y=p[O>>2]|0,(y|0)<=1)return O=0,M=0,M=M*6371.007180918475,M=M*1e3,le[v>>3]=M,Ie=l,O|0;_=y+-1|0,y=0,w=+le[O+8>>3],B=+le[O+16>>3],M=0;do y=y+1|0,h=w,w=+le[O+8+(y<<4)>>3],m=+St(+((w-h)*.5)),d=B,B=+le[O+8+(y<<4)+8>>3],d=+St(+((B-d)*.5)),d=m*m+d*(+Dt(+h)*+Dt(+w)*d),M=M+ +en(+ +Ft(+d),+ +Ft(+(1-d)))*2;while((y|0)!=(_|0));return le[v>>3]=M,O=0,m=M,m=m*6371.007180918475,m=m*1e3,le[v>>3]=m,Ie=l,O|0}function DA(y){y=y|0;var _=0,v=0,w=0;return _=Ks(1,12)|0,_||Wt(22832,22787,49,22845),v=y+4|0,w=p[v>>2]|0,w|0?(w=w+8|0,p[w>>2]=_,p[v>>2]=_,_|0):(p[y>>2]|0&&Wt(22862,22787,61,22885),w=y,p[w>>2]=_,p[v>>2]=_,_|0)}function OA(y,_){y=y|0,_=_|0;var v=0,w=0;return w=Gn(24)|0,w||Wt(22899,22787,78,22913),p[w>>2]=p[_>>2],p[w+4>>2]=p[_+4>>2],p[w+8>>2]=p[_+8>>2],p[w+12>>2]=p[_+12>>2],p[w+16>>2]=0,_=y+4|0,v=p[_>>2]|0,v|0?(p[v+16>>2]=w,p[_>>2]=w,w|0):(p[y>>2]|0&&Wt(22928,22787,82,22913),p[y>>2]=w,p[_>>2]=w,w|0)}function wc(y){y=y|0;var _=0,v=0,w=0,B=0;if(y)for(w=1;;){if(_=p[y>>2]|0,_|0)do{if(v=p[_>>2]|0,v|0)do B=v,v=p[v+16>>2]|0,Dr(B);while(v|0);B=_,_=p[_+8>>2]|0,Dr(B)}while(_|0);if(_=y,y=p[y+8>>2]|0,w||Dr(_),y)w=0;else break}}function Al(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0,ae=0,we=0,De=0,me=0,Fe=0,He=0,We=0,it=0,$e=0,et=0,ht=0,Rt=0,xt=0;if(B=y+8|0,p[B>>2]|0)return xt=1,xt|0;if(w=p[y>>2]|0,!w)return xt=0,xt|0;_=w,v=0;do v=v+1|0,_=p[_+8>>2]|0;while(_|0);if(v>>>0<2)return xt=0,xt|0;ht=Gn(v<<2)|0,ht||Wt(22948,22787,317,22967),et=Gn(v<<5)|0,et||Wt(22989,22787,321,22967),p[y>>2]=0,De=y+4|0,p[De>>2]=0,p[B>>2]=0,v=0,$e=0,we=0,C=0;e:for(;;){if(m=p[w>>2]|0,m){M=0,O=m;do{if(d=+le[O+8>>3],_=O,O=p[O+16>>2]|0,h=(O|0)==0,B=h?m:O,l=+le[B+8>>3],+It(+(d-l))>3.141592653589793){xt=14;break}M=M+(l-d)*(+le[_>>3]+ +le[B>>3])}while(!h);if((xt|0)==14){xt=0,M=0,_=m;do ae=+le[_+8>>3],it=_+16|0,We=p[it>>2]|0,We=We|0?We:m,re=+le[We+8>>3],M=M+(+le[_>>3]+ +le[We>>3])*((re<0?re+6.283185307179586:re)-(ae<0?ae+6.283185307179586:ae)),_=p[(_|0?it:w)>>2]|0;while(_|0)}M>0?(p[ht+($e<<2)>>2]=w,$e=$e+1|0,B=we,_=C):xt=19}else xt=19;if((xt|0)==19){xt=0;do if(v){if(_=v+8|0,p[_>>2]|0){xt=21;break e}if(v=Ks(1,12)|0,!v){xt=23;break e}p[_>>2]=v,B=v+4|0,O=v,_=C}else if(C){B=De,O=C+8|0,_=w,v=y;break}else if(p[y>>2]|0){xt=27;break e}else{B=De,O=y,_=w,v=y;break}while(!1);if(p[O>>2]=w,p[B>>2]=w,O=et+(we<<5)|0,h=p[w>>2]|0,h){for(m=et+(we<<5)+8|0,le[m>>3]=17976931348623157e292,C=et+(we<<5)+24|0,le[C>>3]=17976931348623157e292,le[O>>3]=-17976931348623157e292,P=et+(we<<5)+16|0,le[P>>3]=-17976931348623157e292,te=17976931348623157e292,Y=-17976931348623157e292,B=0,R=h,d=17976931348623157e292,G=17976931348623157e292,$=-17976931348623157e292,l=-17976931348623157e292;M=+le[R>>3],ae=+le[R+8>>3],R=p[R+16>>2]|0,L=(R|0)==0,re=+le[(L?h:R)+8>>3],M<d&&(le[m>>3]=M,d=M),ae<G&&(le[C>>3]=ae,G=ae),M>$?le[O>>3]=M:M=$,ae>l&&(le[P>>3]=ae,l=ae),te=ae>0&ae<te?ae:te,Y=ae<0&ae>Y?ae:Y,B=B|+It(+(ae-re))>3.141592653589793,!L;)$=M;B&&(le[P>>3]=Y,le[C>>3]=te)}else p[O>>2]=0,p[O+4>>2]=0,p[O+8>>2]=0,p[O+12>>2]=0,p[O+16>>2]=0,p[O+20>>2]=0,p[O+24>>2]=0,p[O+28>>2]=0;B=we+1|0}if(it=w+8|0,w=p[it>>2]|0,p[it>>2]=0,w)we=B,C=_;else{xt=45;break}}if((xt|0)==21)Wt(22765,22787,35,22799);else if((xt|0)==23)Wt(22819,22787,37,22799);else if((xt|0)==27)Wt(22862,22787,61,22885);else if((xt|0)==45){e:do if(($e|0)>0){for(it=(B|0)==0,He=B<<2,We=(y|0)==0,Fe=0,_=0;;){if(me=p[ht+(Fe<<2)>>2]|0,it)xt=73;else{if(we=Gn(He)|0,!we){xt=50;break}if(De=Gn(He)|0,!De){xt=52;break}t:do if(We)v=0;else{for(B=0,v=0,O=y;w=et+(B<<5)|0,vo(p[O>>2]|0,w,p[me>>2]|0)|0?(p[we+(v<<2)>>2]=O,p[De+(v<<2)>>2]=w,L=v+1|0):L=v,O=p[O+8>>2]|0,O;)B=B+1|0,v=L;if((L|0)>0)if(w=p[we>>2]|0,(L|0)==1)v=w;else for(P=0,R=-1,v=w,C=w;;){for(h=p[C>>2]|0,w=0,O=0;B=p[p[we+(O<<2)>>2]>>2]|0,(B|0)==(h|0)?m=w:m=w+((vo(B,p[De+(O<<2)>>2]|0,p[h>>2]|0)|0)&1)|0,O=O+1|0,(O|0)!=(L|0);)w=m;if(B=(m|0)>(R|0),v=B?C:v,w=P+1|0,(w|0)==(L|0))break t;P=w,R=B?m:R,C=p[we+(w<<2)>>2]|0}else v=0}while(!1);if(Dr(we),Dr(De),v){if(B=v+4|0,w=p[B>>2]|0,w)v=w+8|0;else if(p[v>>2]|0){xt=70;break}p[v>>2]=me,p[B>>2]=me}else xt=73}if((xt|0)==73){if(xt=0,_=p[me>>2]|0,_|0)do De=_,_=p[_+16>>2]|0,Dr(De);while(_|0);Dr(me),_=1}if(Fe=Fe+1|0,(Fe|0)>=($e|0)){Rt=_;break e}}(xt|0)==50?Wt(23004,22787,249,23023):(xt|0)==52?Wt(23042,22787,252,23023):(xt|0)==70&&Wt(22862,22787,61,22885)}else Rt=0;while(!1);return Dr(ht),Dr(et),xt=Rt,xt|0}return 0}function vo(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0;if(!(Is(_,v)|0)||(_=sl(_)|0,w=+le[v>>3],B=+le[v+8>>3],B=_&B<0?B+6.283185307179586:B,y=p[y>>2]|0,!y))return y=0,y|0;if(_){_=0,h=B,v=y;e:for(;;){for(;O=+le[v>>3],B=+le[v+8>>3],v=v+16|0,m=p[v>>2]|0,m=m|0?m:y,M=+le[m>>3],l=+le[m+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=B,B=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=p[v>>2]|0,!v){v=22;break e}if(l=O<0?O+6.283185307179586:O,O=B<0?B+6.283185307179586:B,h=l==h|O==h?h+-2220446049250313e-31:h,d=l+(O-l)*((w-M)/(d-M)),(d<0?d+6.283185307179586:d)>h&&(_=_^1),v=p[v>>2]|0,!v){v=22;break}}if((v|0)==22)return _|0}else{_=0,h=B,v=y;e:for(;;){for(;O=+le[v>>3],B=+le[v+8>>3],v=v+16|0,m=p[v>>2]|0,m=m|0?m:y,M=+le[m>>3],l=+le[m+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=B,B=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=p[v>>2]|0,!v){v=22;break e}if(h=O==h|B==h?h+-2220446049250313e-31:h,O+(B-O)*((w-M)/(d-M))>h&&(_=_^1),v=p[v>>2]|0,!v){v=22;break}}if((v|0)==22)return _|0}return 0}function Rn(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0;if(Y=Ie,Ie=Ie+32|0,te=Y+16|0,$=Y,M=jt(y|0,_|0,52)|0,Me()|0,M=M&15,R=jt(v|0,w|0,52)|0,Me()|0,(M|0)!=(R&15|0))return te=12,Ie=Y,te|0;if(h=jt(y|0,_|0,45)|0,Me()|0,h=h&127,m=jt(v|0,w|0,45)|0,Me()|0,m=m&127,h>>>0>121|m>>>0>121)return te=5,Ie=Y,te|0;if(R=(h|0)!=(m|0),R){if(l=nl(h,m)|0,(l|0)==7)return te=1,Ie=Y,te|0;d=nl(m,h)|0,(d|0)==7?Wt(23066,23090,161,23100):(L=l,O=d)}else L=0,O=0;C=wr(h)|0,P=wr(m)|0,p[te>>2]=0,p[te+4>>2]=0,p[te+8>>2]=0,p[te+12>>2]=0;do if(L){if(m=p[4272+(h*28|0)+(L<<2)>>2]|0,l=(m|0)>0,P)if(l){h=0,d=v,l=w;do d=tu(d,l)|0,l=Me()|0,O=Hs(O)|0,(O|0)==1&&(O=Hs(1)|0),h=h+1|0;while((h|0)!=(m|0));m=O,h=d,d=l}else m=O,h=v,d=w;else if(l){h=0,d=v,l=w;do d=La(d,l)|0,l=Me()|0,O=Hs(O)|0,h=h+1|0;while((h|0)!=(m|0));m=O,h=d,d=l}else m=O,h=v,d=w;if(Ps(h,d,te)|0,R||Wt(23115,23090,191,23100),l=(C|0)!=0,O=(P|0)!=0,l&O&&Wt(23142,23090,192,23100),l){if(O=Ki(y,_)|0,(O|0)==7){M=5;break}if(Se[21872+(O*7|0)+L>>0]|0){M=1;break}d=p[21040+(O*28|0)+(L<<2)>>2]|0,h=d}else if(O){if(O=Ki(h,d)|0,(O|0)==7){M=5;break}if(Se[21872+(O*7|0)+m>>0]|0){M=1;break}h=0,d=p[21040+(m*28|0)+(O<<2)>>2]|0}else h=0,d=0;if((h|d|0)<0)M=5;else{if((d|0)>0){l=te+4|0,O=0;do Kl(l),O=O+1|0;while((O|0)!=(d|0))}if(p[$>>2]=0,p[$+4>>2]=0,p[$+8>>2]=0,nf($,L),M|0)for(;Ms(M)|0?Ac($):No($),(M|0)>1;)M=M+-1|0;if((h|0)>0){M=0;do Kl($),M=M+1|0;while((M|0)!=(h|0))}G=te+4|0,On(G,$,G),di(G),G=51}}else if(Ps(v,w,te)|0,(C|0)!=0&(P|0)!=0)if((m|0)!=(h|0)&&Wt(23173,23090,261,23100),O=Ki(y,_)|0,M=Ki(v,w)|0,(O|0)==7|(M|0)==7)M=5;else if(Se[21872+(O*7|0)+M>>0]|0)M=1;else if(O=p[21040+(O*28|0)+(M<<2)>>2]|0,(O|0)>0){l=te+4|0,M=0;do Kl(l),M=M+1|0;while((M|0)!=(O|0));G=51}else G=51;else G=51;while(!1);return(G|0)==51&&(M=te+4|0,p[B>>2]=p[M>>2],p[B+4>>2]=p[M+4>>2],p[B+8>>2]=p[M+8>>2],M=0),te=M,Ie=Y,te|0}function Cc(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0;if(G=Ie,Ie=Ie+48|0,h=G+36|0,O=G+24|0,l=G+12|0,d=G,B=jt(y|0,_|0,52)|0,Me()|0,B=B&15,P=jt(y|0,_|0,45)|0,Me()|0,P=P&127,P>>>0>121)return w=5,Ie=G,w|0;if(m=wr(P)|0,Yt(B|0,0,52)|0,$=Me()|0|134225919,M=w,p[M>>2]=-1,p[M+4>>2]=$,!B)return B=ol(v)|0,(B|0)==7||(B=oa(P,B)|0,(B|0)==127)?($=1,Ie=G,$|0):(R=Yt(B|0,0,45)|0,L=Me()|0,P=w,L=p[P+4>>2]&-1040385|L,$=w,p[$>>2]=p[P>>2]|R,p[$+4>>2]=L,$=0,Ie=G,$|0);for(p[h>>2]=p[v>>2],p[h+4>>2]=p[v+4>>2],p[h+8>>2]=p[v+8>>2],v=B;;){if(M=v,v=v+-1|0,p[O>>2]=p[h>>2],p[O+4>>2]=p[h+4>>2],p[O+8>>2]=p[h+8>>2],Ms(M)|0){if(B=IA(h)|0,B|0){v=13;break}p[l>>2]=p[h>>2],p[l+4>>2]=p[h+4>>2],p[l+8>>2]=p[h+8>>2],Ac(l)}else{if(B=MA(h)|0,B|0){v=13;break}p[l>>2]=p[h>>2],p[l+4>>2]=p[h+4>>2],p[l+8>>2]=p[h+8>>2],No(l)}if(si(O,l,d),di(d),B=w,Y=p[B>>2]|0,B=p[B+4>>2]|0,re=(15-M|0)*3|0,te=Yt(7,0,re|0)|0,B=B&~(Me()|0),re=Yt(ol(d)|0,0,re|0)|0,B=Me()|0|B,$=w,p[$>>2]=re|Y&~te,p[$+4>>2]=B,(M|0)<=1){v=14;break}}e:do if((v|0)!=13&&(v|0)==14)if((p[h>>2]|0)<=1&&(p[h+4>>2]|0)<=1&&(p[h+8>>2]|0)<=1){v=ol(h)|0,B=oa(P,v)|0,(B|0)==127?d=0:d=wr(B)|0;t:do if(v){if(m){if(B=Ki(y,_)|0,(B|0)==7){B=5;break e}if(M=p[21248+(B*28|0)+(v<<2)>>2]|0,(M|0)>0){B=v,v=0;do B=lo(B)|0,v=v+1|0;while((v|0)!=(M|0))}else B=v;if((B|0)==1){B=9;break e}v=oa(P,B)|0,(v|0)==127&&Wt(23200,23090,411,23230),wr(v)|0?Wt(23245,23090,412,23230):(L=v,R=M,C=B)}else L=B,R=0,C=v;if(l=p[4272+(P*28|0)+(C<<2)>>2]|0,(l|0)<=-1&&Wt(23276,23090,419,23230),!d){if((R|0)<0){B=5;break e}if(R|0){M=w,B=0,v=p[M>>2]|0,M=p[M+4>>2]|0;do v=uo(v,M)|0,M=Me()|0,re=w,p[re>>2]=v,p[re+4>>2]=M,B=B+1|0;while((B|0)<(R|0))}if((l|0)<=0){B=L,v=58;break}for(M=w,B=0,v=p[M>>2]|0,M=p[M+4>>2]|0;;)if(v=uo(v,M)|0,M=Me()|0,re=w,p[re>>2]=v,p[re+4>>2]=M,B=B+1|0,(B|0)==(l|0)){B=L,v=58;break t}}if(O=nl(L,P)|0,(O|0)==7&&Wt(23066,23090,428,23230),B=w,v=p[B>>2]|0,B=p[B+4>>2]|0,(l|0)>0){M=0;do v=uo(v,B)|0,B=Me()|0,re=w,p[re>>2]=v,p[re+4>>2]=B,M=M+1|0;while((M|0)!=(l|0))}if(B=Ki(v,B)|0,(B|0)==7&&Wt(23313,23090,440,23230),v=ii(L)|0,v=p[(v?21664:21456)+(O*28|0)+(B<<2)>>2]|0,(v|0)<0&&Wt(23313,23090,454,23230),!v)B=L,v=58;else{O=w,B=0,M=p[O>>2]|0,O=p[O+4>>2]|0;do M=Aa(M,O)|0,O=Me()|0,re=w,p[re>>2]=M,p[re+4>>2]=O,B=B+1|0;while((B|0)<(v|0));B=L,v=58}}else if((m|0)!=0&(d|0)!=0){if(v=Ki(y,_)|0,M=w,M=Ki(p[M>>2]|0,p[M+4>>2]|0)|0,(v|0)==7|(M|0)==7){B=5;break e}if(M=p[21248+(v*28|0)+(M<<2)>>2]|0,(M|0)<0){B=5;break e}if(!M)v=59;else{l=w,v=0,O=p[l>>2]|0,l=p[l+4>>2]|0;do O=uo(O,l)|0,l=Me()|0,re=w,p[re>>2]=O,p[re+4>>2]=l,v=v+1|0;while((v|0)<(M|0));v=58}}else v=58;while(!1);if((v|0)==58&&d&&(v=59),(v|0)==59&&(re=w,(Ki(p[re>>2]|0,p[re+4>>2]|0)|0)==1)){B=9;break}re=w,te=p[re>>2]|0,re=p[re+4>>2]&-1040385,Y=Yt(B|0,0,45)|0,re=re|(Me()|0),B=w,p[B>>2]=te|Y,p[B+4>>2]=re,B=0}else B=1;while(!1);return re=B,Ie=G,re|0}function Ch(y,_,v,w,B,M){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0,M=M|0;var O=0,l=0;return l=Ie,Ie=Ie+16|0,O=l,B?y=15:(y=Rn(y,_,v,w,O)|0,y||(la(O,M),y=0)),Ie=l,y|0}function _i(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0;return O=Ie,Ie=Ie+16|0,M=O,w?v=15:(v=ua(v,M)|0,v||(v=Cc(y,_,M,B)|0)),Ie=O,v|0}function nr(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0;return d=Ie,Ie=Ie+32|0,O=d+12|0,l=d,M=Rn(y,_,y,_,O)|0,M|0?(l=M,Ie=d,l|0):(y=Rn(y,_,v,w,l)|0,y|0?(l=y,Ie=d,l|0):(O=al(O,l)|0,l=B,p[l>>2]=O,p[l+4>>2]=((O|0)<0)<<31>>31,l=0,Ie=d,l|0))}function ms(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0;return d=Ie,Ie=Ie+32|0,O=d+12|0,l=d,M=Rn(y,_,y,_,O)|0,!M&&(M=Rn(y,_,v,w,l)|0,!M)?(w=al(O,l)|0,w=cn(w|0,((w|0)<0)<<31>>31|0,1,0)|0,O=Me()|0,l=B,p[l>>2]=w,p[l+4>>2]=O,l=0,Ie=d,l|0):(l=M,Ie=d,l|0)}function au(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0,ae=0,we=0,De=0,me=0,Fe=0;if(me=Ie,Ie=Ie+48|0,O=me+24|0,l=me+12|0,De=me,M=Rn(y,_,y,_,O)|0,!M&&(M=Rn(y,_,v,w,l)|0,!M)){ae=al(O,l)|0,we=((ae|0)<0)<<31>>31,p[O>>2]=0,p[O+4>>2]=0,p[O+8>>2]=0,p[l>>2]=0,p[l+4>>2]=0,p[l+8>>2]=0,Rn(y,_,y,_,O)|0&&Wt(23313,23090,691,23299),Rn(y,_,v,w,l)|0&&Wt(23313,23090,696,23299),fa(O),fa(l),ae?(C=p[O>>2]|0,L=+(ae|0),te=O+4|0,P=p[te>>2]|0,Y=O+8|0,R=p[Y>>2]|0,re=O,w=C,M=P,v=R,G=+((p[l>>2]|0)-C|0)/L,$=+((p[l+4>>2]|0)-P|0)/L,L=+((p[l+8>>2]|0)-R|0)/L):(M=O+4|0,v=O+8|0,te=M,Y=v,re=O,w=p[O>>2]|0,M=p[M>>2]|0,v=p[v>>2]|0,G=0,$=0,L=0),p[De>>2]=w,R=De+4|0,p[R>>2]=M,P=De+8|0,p[P>>2]=v;e:do if((ae|0)<0)M=0;else for(m=0,C=0,M=w;;){h=+(C>>>0)+4294967296*+(m|0),Fe=G*h+ +(M|0),d=$*h+ +(p[te>>2]|0),h=L*h+ +(p[Y>>2]|0),v=~~+Wo(+Fe),O=~~+Wo(+d),M=~~+Wo(+h),Fe=+It(+(+(v|0)-Fe)),d=+It(+(+(O|0)-d)),h=+It(+(+(M|0)-h));do if(Fe>d&Fe>h)v=0-(O+M)|0,w=O;else if(l=0-v|0,d>h){w=l-M|0;break}else{w=O,M=l-O|0;break}while(!1);if(p[De>>2]=v,p[R>>2]=w,p[P>>2]=M,Ra(De),M=Cc(y,_,De,B+(C<<3)|0)|0,M|0)break e;if(!((m|0)<(we|0)|(m|0)==(we|0)&C>>>0<ae>>>0)){M=0;break e}M=cn(C|0,m|0,1,0)|0,l=Me()|0,m=l,C=M,M=p[re>>2]|0}while(!1);return De=M,Ie=me,De|0}return De=M,Ie=me,De|0}function Fs(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0;if((v|0)==0&(w|0)==0)return B=0,M=1,fr(B|0),M|0;M=y,B=_,y=1,_=0;do O=(v&1|0)==0&!0,y=oi((O?1:M)|0,(O?0:B)|0,y|0,_|0)|0,_=Me()|0,v=Ao(v|0,w|0,1)|0,w=Me()|0,M=oi(M|0,B|0,M|0,B|0)|0,B=Me()|0;while(!((v|0)==0&(w|0)==0));return fr(_|0),y|0}function Js(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0;if(!(Is(_,v)|0)||(_=sl(_)|0,w=+le[v>>3],B=+le[v+8>>3],B=_&B<0?B+6.283185307179586:B,P=p[y>>2]|0,(P|0)<=0))return P=0,P|0;if(C=p[y+4>>2]|0,_){_=0,m=B,v=-1,y=0;e:for(;;){for(h=y;O=+le[C+(h<<4)>>3],B=+le[C+(h<<4)+8>>3],y=(v+2|0)%(P|0)|0,M=+le[C+(y<<4)>>3],l=+le[C+(y<<4)+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=B,B=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=h+1|0,(v|0)>=(P|0)){v=22;break e}else y=h,h=v,v=y;if(l=O<0?O+6.283185307179586:O,O=B<0?B+6.283185307179586:B,m=l==m|O==m?m+-2220446049250313e-31:m,d=l+(O-l)*((w-M)/(d-M)),(d<0?d+6.283185307179586:d)>m&&(_=_^1),y=h+1|0,(y|0)>=(P|0)){v=22;break}else v=h}if((v|0)==22)return _|0}else{_=0,m=B,v=-1,y=0;e:for(;;){for(h=y;O=+le[C+(h<<4)>>3],B=+le[C+(h<<4)+8>>3],y=(v+2|0)%(P|0)|0,M=+le[C+(y<<4)>>3],l=+le[C+(y<<4)+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=B,B=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=h+1|0,(v|0)>=(P|0)){v=22;break e}else y=h,h=v,v=y;if(m=O==m|B==m?m+-2220446049250313e-31:m,O+(B-O)*((w-M)/(d-M))>m&&(_=_^1),y=h+1|0,(y|0)>=(P|0)){v=22;break}else v=h}if((v|0)==22)return _|0}return 0}function us(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0;if(L=p[y>>2]|0,!L){p[_>>2]=0,p[_+4>>2]=0,p[_+8>>2]=0,p[_+12>>2]=0,p[_+16>>2]=0,p[_+20>>2]=0,p[_+24>>2]=0,p[_+28>>2]=0;return}if(G=_+8|0,le[G>>3]=17976931348623157e292,$=_+24|0,le[$>>3]=17976931348623157e292,le[_>>3]=-17976931348623157e292,te=_+16|0,le[te>>3]=-17976931348623157e292,!((L|0)<=0)){for(P=p[y+4>>2]|0,h=17976931348623157e292,m=-17976931348623157e292,C=0,y=-1,M=17976931348623157e292,O=17976931348623157e292,d=-17976931348623157e292,w=-17976931348623157e292,R=0;v=+le[P+(R<<4)>>3],l=+le[P+(R<<4)+8>>3],y=y+2|0,B=+le[P+(((y|0)==(L|0)?0:y)<<4)+8>>3],v<M&&(le[G>>3]=v,M=v),l<O&&(le[$>>3]=l,O=l),v>d?le[_>>3]=v:v=d,l>w&&(le[te>>3]=l,w=l),h=l>0&l<h?l:h,m=l<0&l>m?l:m,C=C|+It(+(l-B))>3.141592653589793,y=R+1|0,(y|0)!=(L|0);)Y=R,d=v,R=y,y=Y;C&&(le[te>>3]=m,le[$>>3]=h)}}function uf(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0,ae=0,we=0,De=0,me=0;if(L=p[y>>2]|0,L){if(G=_+8|0,le[G>>3]=17976931348623157e292,$=_+24|0,le[$>>3]=17976931348623157e292,le[_>>3]=-17976931348623157e292,te=_+16|0,le[te>>3]=-17976931348623157e292,(L|0)>0){for(B=p[y+4>>2]|0,P=17976931348623157e292,R=-17976931348623157e292,w=0,v=-1,d=17976931348623157e292,h=17976931348623157e292,C=-17976931348623157e292,O=-17976931348623157e292,Y=0;M=+le[B+(Y<<4)>>3],m=+le[B+(Y<<4)+8>>3],De=v+2|0,l=+le[B+(((De|0)==(L|0)?0:De)<<4)+8>>3],M<d&&(le[G>>3]=M,d=M),m<h&&(le[$>>3]=m,h=m),M>C?le[_>>3]=M:M=C,m>O&&(le[te>>3]=m,O=m),P=m>0&m<P?m:P,R=m<0&m>R?m:R,w=w|+It(+(m-l))>3.141592653589793,v=Y+1|0,(v|0)!=(L|0);)De=Y,C=M,Y=v,v=De;w&&(le[te>>3]=R,le[$>>3]=P)}}else p[_>>2]=0,p[_+4>>2]=0,p[_+8>>2]=0,p[_+12>>2]=0,p[_+16>>2]=0,p[_+20>>2]=0,p[_+24>>2]=0,p[_+28>>2]=0;if(De=y+8|0,v=p[De>>2]|0,!((v|0)<=0)){we=y+12|0,ae=0;do if(B=p[we>>2]|0,w=ae,ae=ae+1|0,$=_+(ae<<5)|0,te=p[B+(w<<3)>>2]|0,te){if(Y=_+(ae<<5)+8|0,le[Y>>3]=17976931348623157e292,y=_+(ae<<5)+24|0,le[y>>3]=17976931348623157e292,le[$>>3]=-17976931348623157e292,re=_+(ae<<5)+16|0,le[re>>3]=-17976931348623157e292,(te|0)>0){for(L=p[B+(w<<3)+4>>2]|0,P=17976931348623157e292,R=-17976931348623157e292,B=0,w=-1,G=0,d=17976931348623157e292,h=17976931348623157e292,m=-17976931348623157e292,O=-17976931348623157e292;M=+le[L+(G<<4)>>3],C=+le[L+(G<<4)+8>>3],w=w+2|0,l=+le[L+(((w|0)==(te|0)?0:w)<<4)+8>>3],M<d&&(le[Y>>3]=M,d=M),C<h&&(le[y>>3]=C,h=C),M>m?le[$>>3]=M:M=m,C>O&&(le[re>>3]=C,O=C),P=C>0&C<P?C:P,R=C<0&C>R?C:R,B=B|+It(+(C-l))>3.141592653589793,w=G+1|0,(w|0)!=(te|0);)me=G,G=w,m=M,w=me;B&&(le[re>>3]=R,le[y>>3]=P)}}else p[$>>2]=0,p[$+4>>2]=0,p[$+8>>2]=0,p[$+12>>2]=0,p[$+16>>2]=0,p[$+20>>2]=0,p[$+24>>2]=0,p[$+28>>2]=0,v=p[De>>2]|0;while((ae|0)<(v|0))}}function Kt(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0;if(!(Js(y,_,v)|0))return B=0,B|0;if(B=y+8|0,(p[B>>2]|0)<=0)return B=1,B|0;for(w=y+12|0,y=0;;){if(M=y,y=y+1|0,Js((p[w>>2]|0)+(M<<3)|0,_+(y<<5)|0,v)|0){y=0,w=6;break}if((y|0)>=(p[B>>2]|0)){y=1,w=6;break}}return(w|0)==6?y|0:0}function ff(){return 8}function cu(){return 16}function hf(){return 168}function Ws(){return 8}function _s(){return 16}function lu(){return 12}function uu(){return 8}function ys(y){return y=y|0,+(+((p[y>>2]|0)>>>0)+4294967296*+(p[y+4>>2]|0))}function jo(y){y=y|0;var _=0,v=0;return v=+le[y>>3],_=+le[y+8>>3],+ +Ft(+(v*v+_*_))}function df(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0;h=+le[y>>3],d=+le[_>>3]-h,l=+le[y+8>>3],O=+le[_+8>>3]-l,C=+le[v>>3],M=+le[w>>3]-C,P=+le[v+8>>3],m=+le[w+8>>3]-P,M=(M*(l-P)-(h-C)*m)/(d*m-O*M),le[B>>3]=h+d*M,le[B+8>>3]=l+O*M}function Ec(y,_){return y=y|0,_=_|0,+It(+(+le[y>>3]-+le[_>>3]))<11920928955078125e-23?(_=+It(+(+le[y+8>>3]-+le[_+8>>3]))<11920928955078125e-23,_|0):(_=0,_|0)}function yi(y,_){y=y|0,_=_|0;var v=0,w=0,B=0;return B=+le[y>>3]-+le[_>>3],w=+le[y+8>>3]-+le[_+8>>3],v=+le[y+16>>3]-+le[_+16>>3],+(B*B+w*w+v*v)}function Af(y,_){y=y|0,_=_|0;var v=0,w=0,B=0;v=+le[y>>3],w=+Dt(+v),v=+St(+v),le[_+16>>3]=v,v=+le[y+8>>3],B=w*+Dt(+v),le[_>>3]=B,v=w*+St(+v),le[_+8>>3]=v}function fo(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0;if(M=Ie,Ie=Ie+16|0,B=M,w=Bn(y,_)|0,(v+-1|0)>>>0>5||(w=(w|0)!=0,(v|0)==1&w))return B=-1,Ie=M,B|0;do if(qi(y,_,B)|0)w=-1;else if(w){w=((p[21936+(v<<2)>>2]|0)+5-(p[B>>2]|0)|0)%5|0;break}else{w=((p[21968+(v<<2)>>2]|0)+6-(p[B>>2]|0)|0)%6|0;break}while(!1);return B=w,Ie=M,B|0}function qi(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0;if(h=Ie,Ie=Ie+32|0,O=h+16|0,l=h,w=ka(y,_,O)|0,w|0)return v=w,Ie=h,v|0;M=af(y,_)|0,d=Ki(y,_)|0,Vs(M,l),w=dh(M,p[O>>2]|0)|0;e:do if(wr(M)|0){do switch(M|0){case 4:{y=0;break}case 14:{y=1;break}case 24:{y=2;break}case 38:{y=3;break}case 49:{y=4;break}case 58:{y=5;break}case 63:{y=6;break}case 72:{y=7;break}case 83:{y=8;break}case 97:{y=9;break}case 107:{y=10;break}case 117:{y=11;break}default:{w=1;break e}}while(!1);if(B=p[22e3+(y*24|0)+8>>2]|0,_=p[22e3+(y*24|0)+16>>2]|0,y=p[O>>2]|0,(y|0)!=(p[l>>2]|0)&&(l=ii(M)|0,y=p[O>>2]|0,l|(y|0)==(_|0)&&(w=(w+1|0)%6|0)),(d|0)==3&(y|0)==(_|0)){w=(w+5|0)%6|0,B=22;break}(d|0)==5&(y|0)==(B|0)&&(w=(w+1|0)%6|0),B=22}else B=22;while(!1);return(B|0)==22&&(p[v>>2]=w,w=0),v=w,Ie=h,v|0}function Nr(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0;if(re=Ie,Ie=Ie+32|0,Y=re+24|0,$=re+20|0,L=re+8|0,R=re+16|0,P=re,d=(Bn(y,_)|0)==0,d=d?6:5,m=jt(y|0,_|0,52)|0,Me()|0,m=m&15,d>>>0<=v>>>0)return w=2,Ie=re,w|0;C=(m|0)==0,!C&&(G=Yt(7,0,(m^15)*3|0)|0,(G&y|0)==0&((Me()|0)&_|0)==0)?B=v:M=4;e:do if((M|0)==4){if(B=(Bn(y,_)|0)!=0,((B?4:5)|0)<(v|0)||qi(y,_,Y)|0||(M=(p[Y>>2]|0)+v|0,B?B=22288+(((M|0)%5|0)<<2)|0:B=22320+(((M|0)%6|0)<<2)|0,G=p[B>>2]|0,(G|0)==7))return w=1,Ie=re,w|0;p[$>>2]=0,B=xn(y,_,G,$,L)|0;do if(!B){if(l=L,h=p[l>>2]|0,l=p[l+4>>2]|0,O=l>>>0<_>>>0|(l|0)==(_|0)&h>>>0<y>>>0,M=O?h:y,O=O?l:_,!C&&(C=Yt(7,0,(m^15)*3|0)|0,(h&C|0)==0&(l&(Me()|0)|0)==0))B=v;else{if(l=(v+-1+d|0)%(d|0)|0,B=Bn(y,_)|0,(l|0)<0&&Wt(23313,23315,245,23324),d=(B|0)!=0,((d?4:5)|0)<(l|0)&&Wt(23313,23315,245,23324),qi(y,_,Y)|0&&Wt(23313,23315,245,23324),B=(p[Y>>2]|0)+l|0,d?B=22288+(((B|0)%5|0)<<2)|0:B=22320+(((B|0)%6|0)<<2)|0,l=p[B>>2]|0,(l|0)==7&&Wt(23313,23315,245,23324),p[R>>2]=0,B=xn(y,_,l,R,P)|0,B|0)break;h=P,d=p[h>>2]|0,h=p[h+4>>2]|0;do if(h>>>0<O>>>0|(h|0)==(O|0)&d>>>0<M>>>0){if(Bn(d,h)|0?M=rl(d,h,y,_)|0:M=p[22384+((((p[R>>2]|0)+(p[22352+(l<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,B=Bn(d,h)|0,(M+-1|0)>>>0>5){B=-1,M=d,O=h;break}if(B=(B|0)!=0,(M|0)==1&B){B=-1,M=d,O=h;break}do if(qi(d,h,Y)|0)B=-1;else if(B){B=((p[21936+(M<<2)>>2]|0)+5-(p[Y>>2]|0)|0)%5|0;break}else{B=((p[21968+(M<<2)>>2]|0)+6-(p[Y>>2]|0)|0)%6|0;break}while(!1);M=d,O=h}else B=v;while(!1);l=L,h=p[l>>2]|0,l=p[l+4>>2]|0}if((M|0)==(h|0)&(O|0)==(l|0)){if(d=(Bn(h,l)|0)!=0,d?y=rl(h,l,y,_)|0:y=p[22384+((((p[$>>2]|0)+(p[22352+(G<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,B=Bn(h,l)|0,(y+-1|0)>>>0<=5&&(te=(B|0)!=0,!((y|0)==1&te)))do if(qi(h,l,Y)|0)B=-1;else if(te){B=((p[21936+(y<<2)>>2]|0)+5-(p[Y>>2]|0)|0)%5|0;break}else{B=((p[21968+(y<<2)>>2]|0)+6-(p[Y>>2]|0)|0)%6|0;break}while(!1);else B=-1;B=B+1|0,B=(B|0)==6|d&(B|0)==5?0:B}_=O,y=M;break e}while(!1);return w=B,Ie=re,w|0}while(!1);return te=Yt(B|0,0,56)|0,Y=Me()|0|_&-2130706433|536870912,p[w>>2]=te|y,p[w+4>>2]=Y,w=0,Ie=re,w|0}function bo(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0;return M=(Bn(y,_)|0)==0,w=Nr(y,_,0,v)|0,B=(w|0)==0,M?!B||(w=Nr(y,_,1,v+8|0)|0,w|0)||(w=Nr(y,_,2,v+16|0)|0,w|0)||(w=Nr(y,_,3,v+24|0)|0,w|0)||(w=Nr(y,_,4,v+32|0)|0,w)?(M=w,M|0):Nr(y,_,5,v+40|0)|0:!B||(w=Nr(y,_,1,v+8|0)|0,w|0)||(w=Nr(y,_,2,v+16|0)|0,w|0)||(w=Nr(y,_,3,v+24|0)|0,w|0)||(w=Nr(y,_,4,v+32|0)|0,w|0)?(M=w,M|0):(M=v+40|0,p[M>>2]=0,p[M+4>>2]=0,M=0,M|0)}function Xs(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0;return d=Ie,Ie=Ie+192|0,B=d,M=d+168|0,O=jt(y|0,_|0,56)|0,Me()|0,O=O&7,l=_&-2130706433|134217728,w=ka(y,l,M)|0,w|0?(l=w,Ie=d,l|0):(_=jt(y|0,_|0,52)|0,Me()|0,_=_&15,Bn(y,l)|0?ko(M,_,O,1,B):Yl(M,_,O,1,B),l=B+8|0,p[v>>2]=p[l>>2],p[v+4>>2]=p[l+4>>2],p[v+8>>2]=p[l+8>>2],p[v+12>>2]=p[l+12>>2],l=0,Ie=d,l|0)}function zi(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0;return B=Ie,Ie=Ie+16|0,v=B,!(!0&(_&2013265920|0)==536870912)||(w=_&-2130706433|134217728,!(zo(y,w)|0))?(w=0,Ie=B,w|0):(M=jt(y|0,_|0,56)|0,Me()|0,M=(Nr(y,w,M&7,v)|0)==0,w=v,w=M&((p[w>>2]|0)==(y|0)?(p[w+4>>2]|0)==(_|0):0)&1,Ie=B,w|0)}function pa(y,_,v){y=y|0,_=_|0,v=v|0;var w=0;(_|0)>0?(w=Ks(_,4)|0,p[y>>2]=w,w||Wt(23337,23360,40,23374)):p[y>>2]=0,p[y+4>>2]=_,p[y+8>>2]=0,p[y+12>>2]=v}function Jo(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0;B=y+4|0,M=y+12|0,O=y+8|0;e:for(;;){for(v=p[B>>2]|0,_=0;;){if((_|0)>=(v|0))break e;if(w=p[y>>2]|0,l=p[w+(_<<2)>>2]|0,!l)_=_+1|0;else break}_=w+(~~(+It(+(+ut(10,+ +(15-(p[M>>2]|0)|0))*(+le[l>>3]+ +le[l+8>>3])))%+(v|0))>>>0<<2)|0,v=p[_>>2]|0;t:do if(v|0){if(w=l+32|0,(v|0)==(l|0))p[_>>2]=p[w>>2];else{if(v=v+32|0,_=p[v>>2]|0,!_)break;for(;(_|0)!=(l|0);)if(v=_+32|0,_=p[v>>2]|0,!_)break t;p[v>>2]=p[w>>2]}Dr(l),p[O>>2]=(p[O>>2]|0)+-1}while(!1)}Dr(p[y>>2]|0)}function $s(y){y=y|0;var _=0,v=0,w=0;for(w=p[y+4>>2]|0,v=0;;){if((v|0)>=(w|0)){_=0,v=4;break}if(_=p[(p[y>>2]|0)+(v<<2)>>2]|0,!_)v=v+1|0;else{v=4;break}}return(v|0)==4?_|0:0}function Zi(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0;if(v=~~(+It(+(+ut(10,+ +(15-(p[y+12>>2]|0)|0))*(+le[_>>3]+ +le[_+8>>3])))%+(p[y+4>>2]|0))>>>0,v=(p[y>>2]|0)+(v<<2)|0,w=p[v>>2]|0,!w)return M=1,M|0;M=_+32|0;do if((w|0)!=(_|0)){if(v=p[w+32>>2]|0,!v)return M=1,M|0;for(B=v;;){if((B|0)==(_|0)){B=8;break}if(v=p[B+32>>2]|0,v)w=B,B=v;else{v=1,B=10;break}}if((B|0)==8){p[w+32>>2]=p[M>>2];break}else if((B|0)==10)return v|0}else p[v>>2]=p[M>>2];while(!1);return Dr(_),M=y+8|0,p[M>>2]=(p[M>>2]|0)+-1,M=0,M|0}function pl(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0;M=Gn(40)|0,M||Wt(23390,23360,98,23403),p[M>>2]=p[_>>2],p[M+4>>2]=p[_+4>>2],p[M+8>>2]=p[_+8>>2],p[M+12>>2]=p[_+12>>2],B=M+16|0,p[B>>2]=p[v>>2],p[B+4>>2]=p[v+4>>2],p[B+8>>2]=p[v+8>>2],p[B+12>>2]=p[v+12>>2],p[M+32>>2]=0,B=~~(+It(+(+ut(10,+ +(15-(p[y+12>>2]|0)|0))*(+le[_>>3]+ +le[_+8>>3])))%+(p[y+4>>2]|0))>>>0,B=(p[y>>2]|0)+(B<<2)|0,w=p[B>>2]|0;do if(!w)p[B>>2]=M;else{for(;!(za(w,_)|0&&za(w+16|0,v)|0);)if(B=p[w+32>>2]|0,w=B|0?B:w,!(p[w+32>>2]|0)){O=10;break}if((O|0)==10){p[w+32>>2]=M;break}return Dr(M),O=w,O|0}while(!1);return O=y+8|0,p[O>>2]=(p[O>>2]|0)+1,O=M,O|0}function _r(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0;if(B=~~(+It(+(+ut(10,+ +(15-(p[y+12>>2]|0)|0))*(+le[_>>3]+ +le[_+8>>3])))%+(p[y+4>>2]|0))>>>0,B=p[(p[y>>2]|0)+(B<<2)>>2]|0,!B)return v=0,v|0;if(!v){for(y=B;;){if(za(y,_)|0){w=10;break}if(y=p[y+32>>2]|0,!y){y=0,w=10;break}}if((w|0)==10)return y|0}for(y=B;;){if(za(y,_)|0&&za(y+16|0,v)|0){w=10;break}if(y=p[y+32>>2]|0,!y){y=0,w=10;break}}return(w|0)==10?y|0:0}function or(y,_){y=y|0,_=_|0;var v=0;if(v=~~(+It(+(+ut(10,+ +(15-(p[y+12>>2]|0)|0))*(+le[_>>3]+ +le[_+8>>3])))%+(p[y+4>>2]|0))>>>0,y=p[(p[y>>2]|0)+(v<<2)>>2]|0,!y)return v=0,v|0;for(;;){if(za(y,_)|0){_=5;break}if(y=p[y+32>>2]|0,!y){y=0,_=5;break}}return(_|0)==5?y|0:0}function fu(){return 23424}function ns(y){return y=+y,+ +$o(+y)}function Gi(y){return y=+y,~~+ns(y)|0}function Gn(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0,G=0,$=0,te=0,Y=0,re=0,ae=0,we=0;we=Ie,Ie=Ie+16|0,P=we;do if(y>>>0<245){if(h=y>>>0<11?16:y+11&-8,y=h>>>3,C=p[5857]|0,v=C>>>y,v&3|0)return _=(v&1^1)+y|0,y=23468+(_<<1<<2)|0,v=y+8|0,w=p[v>>2]|0,B=w+8|0,M=p[B>>2]|0,(M|0)==(y|0)?p[5857]=C&~(1<<_):(p[M+12>>2]=y,p[v>>2]=M),ae=_<<3,p[w+4>>2]=ae|3,ae=w+ae+4|0,p[ae>>2]=p[ae>>2]|1,ae=B,Ie=we,ae|0;if(m=p[5859]|0,h>>>0>m>>>0){if(v|0)return _=2<<y,_=v<<y&(_|0-_),_=(_&0-_)+-1|0,l=_>>>12&16,_=_>>>l,v=_>>>5&8,_=_>>>v,M=_>>>2&4,_=_>>>M,y=_>>>1&2,_=_>>>y,w=_>>>1&1,w=(v|l|M|y|w)+(_>>>w)|0,_=23468+(w<<1<<2)|0,y=_+8|0,M=p[y>>2]|0,l=M+8|0,v=p[l>>2]|0,(v|0)==(_|0)?(y=C&~(1<<w),p[5857]=y):(p[v+12>>2]=_,p[y>>2]=v,y=C),ae=w<<3,O=ae-h|0,p[M+4>>2]=h|3,B=M+h|0,p[B+4>>2]=O|1,p[M+ae>>2]=O,m|0&&(w=p[5862]|0,_=m>>>3,v=23468+(_<<1<<2)|0,_=1<<_,y&_?(y=v+8|0,_=p[y>>2]|0):(p[5857]=y|_,_=v,y=v+8|0),p[y>>2]=w,p[_+12>>2]=w,p[w+8>>2]=_,p[w+12>>2]=v),p[5859]=O,p[5862]=B,ae=l,Ie=we,ae|0;if(M=p[5858]|0,M){for(v=(M&0-M)+-1|0,B=v>>>12&16,v=v>>>B,w=v>>>5&8,v=v>>>w,O=v>>>2&4,v=v>>>O,l=v>>>1&2,v=v>>>l,d=v>>>1&1,d=p[23732+((w|B|O|l|d)+(v>>>d)<<2)>>2]|0,v=d,l=d,d=(p[d+4>>2]&-8)-h|0;y=p[v+16>>2]|0,!(!y&&(y=p[v+20>>2]|0,!y));)O=(p[y+4>>2]&-8)-h|0,B=O>>>0<d>>>0,v=y,l=B?y:l,d=B?O:d;if(O=l+h|0,O>>>0>l>>>0){B=p[l+24>>2]|0,_=p[l+12>>2]|0;do if((_|0)==(l|0)){if(y=l+20|0,_=p[y>>2]|0,!_&&(y=l+16|0,_=p[y>>2]|0,!_)){v=0;break}for(;;)if(w=_+20|0,v=p[w>>2]|0,v)_=v,y=w;else if(w=_+16|0,v=p[w>>2]|0,v)_=v,y=w;else break;p[y>>2]=0,v=_}else v=p[l+8>>2]|0,p[v+12>>2]=_,p[_+8>>2]=v,v=_;while(!1);do if(B|0){if(_=p[l+28>>2]|0,y=23732+(_<<2)|0,(l|0)==(p[y>>2]|0)){if(p[y>>2]=v,!v){p[5858]=M&~(1<<_);break}}else if(ae=B+16|0,p[((p[ae>>2]|0)==(l|0)?ae:B+20|0)>>2]=v,!v)break;p[v+24>>2]=B,_=p[l+16>>2]|0,_|0&&(p[v+16>>2]=_,p[_+24>>2]=v),_=p[l+20>>2]|0,_|0&&(p[v+20>>2]=_,p[_+24>>2]=v)}while(!1);return d>>>0<16?(ae=d+h|0,p[l+4>>2]=ae|3,ae=l+ae+4|0,p[ae>>2]=p[ae>>2]|1):(p[l+4>>2]=h|3,p[O+4>>2]=d|1,p[O+d>>2]=d,m|0&&(w=p[5862]|0,_=m>>>3,v=23468+(_<<1<<2)|0,_=1<<_,_&C?(y=v+8|0,_=p[y>>2]|0):(p[5857]=_|C,_=v,y=v+8|0),p[y>>2]=w,p[_+12>>2]=w,p[w+8>>2]=_,p[w+12>>2]=v),p[5859]=d,p[5862]=O),ae=l+8|0,Ie=we,ae|0}else C=h}else C=h}else C=h}else if(y>>>0<=4294967231)if(y=y+11|0,h=y&-8,w=p[5858]|0,w){B=0-h|0,y=y>>>8,y?h>>>0>16777215?d=31:(C=(y+1048320|0)>>>16&8,G=y<<C,l=(G+520192|0)>>>16&4,G=G<<l,d=(G+245760|0)>>>16&2,d=14-(l|C|d)+(G<<d>>>15)|0,d=h>>>(d+7|0)&1|d<<1):d=0,v=p[23732+(d<<2)>>2]|0;e:do if(!v)v=0,y=0,G=61;else for(y=0,l=h<<((d|0)==31?0:25-(d>>>1)|0),M=0;;){if(O=(p[v+4>>2]&-8)-h|0,O>>>0<B>>>0)if(O)y=v,B=O;else{y=v,B=0,G=65;break e}if(G=p[v+20>>2]|0,v=p[v+16+(l>>>31<<2)>>2]|0,M=(G|0)==0|(G|0)==(v|0)?M:G,v)l=l<<1;else{v=M,G=61;break}}while(!1);if((G|0)==61){if((v|0)==0&(y|0)==0){if(y=2<<d,y=(y|0-y)&w,!y){C=h;break}C=(y&0-y)+-1|0,O=C>>>12&16,C=C>>>O,M=C>>>5&8,C=C>>>M,l=C>>>2&4,C=C>>>l,d=C>>>1&2,C=C>>>d,v=C>>>1&1,y=0,v=p[23732+((M|O|l|d|v)+(C>>>v)<<2)>>2]|0}v?G=65:(l=y,O=B)}if((G|0)==65)for(M=v;;)if(C=(p[M+4>>2]&-8)-h|0,v=C>>>0<B>>>0,B=v?C:B,y=v?M:y,v=p[M+16>>2]|0,v||(v=p[M+20>>2]|0),v)M=v;else{l=y,O=B;break}if(l|0&&O>>>0<((p[5859]|0)-h|0)>>>0&&(m=l+h|0,m>>>0>l>>>0)){M=p[l+24>>2]|0,_=p[l+12>>2]|0;do if((_|0)==(l|0)){if(y=l+20|0,_=p[y>>2]|0,!_&&(y=l+16|0,_=p[y>>2]|0,!_)){_=0;break}for(;;)if(B=_+20|0,v=p[B>>2]|0,v)_=v,y=B;else if(B=_+16|0,v=p[B>>2]|0,v)_=v,y=B;else break;p[y>>2]=0}else ae=p[l+8>>2]|0,p[ae+12>>2]=_,p[_+8>>2]=ae;while(!1);do if(M){if(y=p[l+28>>2]|0,v=23732+(y<<2)|0,(l|0)==(p[v>>2]|0)){if(p[v>>2]=_,!_){w=w&~(1<<y),p[5858]=w;break}}else if(ae=M+16|0,p[((p[ae>>2]|0)==(l|0)?ae:M+20|0)>>2]=_,!_)break;p[_+24>>2]=M,y=p[l+16>>2]|0,y|0&&(p[_+16>>2]=y,p[y+24>>2]=_),y=p[l+20>>2]|0,y&&(p[_+20>>2]=y,p[y+24>>2]=_)}while(!1);e:do if(O>>>0<16)ae=O+h|0,p[l+4>>2]=ae|3,ae=l+ae+4|0,p[ae>>2]=p[ae>>2]|1;else{if(p[l+4>>2]=h|3,p[m+4>>2]=O|1,p[m+O>>2]=O,_=O>>>3,O>>>0<256){v=23468+(_<<1<<2)|0,y=p[5857]|0,_=1<<_,y&_?(y=v+8|0,_=p[y>>2]|0):(p[5857]=y|_,_=v,y=v+8|0),p[y>>2]=m,p[_+12>>2]=m,p[m+8>>2]=_,p[m+12>>2]=v;break}if(_=O>>>8,_?O>>>0>16777215?v=31:(re=(_+1048320|0)>>>16&8,ae=_<<re,Y=(ae+520192|0)>>>16&4,ae=ae<<Y,v=(ae+245760|0)>>>16&2,v=14-(Y|re|v)+(ae<<v>>>15)|0,v=O>>>(v+7|0)&1|v<<1):v=0,_=23732+(v<<2)|0,p[m+28>>2]=v,y=m+16|0,p[y+4>>2]=0,p[y>>2]=0,y=1<<v,!(w&y)){p[5858]=w|y,p[_>>2]=m,p[m+24>>2]=_,p[m+12>>2]=m,p[m+8>>2]=m;break}_=p[_>>2]|0;t:do if((p[_+4>>2]&-8|0)!=(O|0)){for(w=O<<((v|0)==31?0:25-(v>>>1)|0);v=_+16+(w>>>31<<2)|0,y=p[v>>2]|0,!!y;)if((p[y+4>>2]&-8|0)==(O|0)){_=y;break t}else w=w<<1,_=y;p[v>>2]=m,p[m+24>>2]=_,p[m+12>>2]=m,p[m+8>>2]=m;break e}while(!1);re=_+8|0,ae=p[re>>2]|0,p[ae+12>>2]=m,p[re>>2]=m,p[m+8>>2]=ae,p[m+12>>2]=_,p[m+24>>2]=0}while(!1);return ae=l+8|0,Ie=we,ae|0}else C=h}else C=h;else C=-1;while(!1);if(v=p[5859]|0,v>>>0>=C>>>0)return _=v-C|0,y=p[5862]|0,_>>>0>15?(ae=y+C|0,p[5862]=ae,p[5859]=_,p[ae+4>>2]=_|1,p[y+v>>2]=_,p[y+4>>2]=C|3):(p[5859]=0,p[5862]=0,p[y+4>>2]=v|3,ae=y+v+4|0,p[ae>>2]=p[ae>>2]|1),ae=y+8|0,Ie=we,ae|0;if(O=p[5860]|0,O>>>0>C>>>0)return Y=O-C|0,p[5860]=Y,ae=p[5863]|0,re=ae+C|0,p[5863]=re,p[re+4>>2]=Y|1,p[ae+4>>2]=C|3,ae=ae+8|0,Ie=we,ae|0;if(p[5975]|0?y=p[5977]|0:(p[5977]=4096,p[5976]=4096,p[5978]=-1,p[5979]=-1,p[5980]=0,p[5968]=0,p[5975]=P&-16^1431655768,y=4096),l=C+48|0,d=C+47|0,M=y+d|0,B=0-y|0,h=M&B,h>>>0<=C>>>0||(y=p[5967]|0,y|0&&(m=p[5965]|0,P=m+h|0,P>>>0<=m>>>0|P>>>0>y>>>0)))return ae=0,Ie=we,ae|0;e:do if(p[5968]&4)_=0,G=143;else{v=p[5863]|0;t:do if(v){for(w=23876;P=p[w>>2]|0,!(P>>>0<=v>>>0&&(P+(p[w+4>>2]|0)|0)>>>0>v>>>0);)if(y=p[w+8>>2]|0,y)w=y;else{G=128;break t}if(_=M-O&B,_>>>0<2147483647)if(y=fs(_|0)|0,(y|0)==((p[w>>2]|0)+(p[w+4>>2]|0)|0)){if((y|0)!=-1){O=_,M=y,G=145;break e}}else w=y,G=136;else _=0}else G=128;while(!1);do if((G|0)==128)if(v=fs(0)|0,(v|0)!=-1&&(_=v,R=p[5976]|0,L=R+-1|0,_=(L&_|0?(L+_&0-R)-_|0:0)+h|0,R=p[5965]|0,L=_+R|0,_>>>0>C>>>0&_>>>0<2147483647)){if(P=p[5967]|0,P|0&&L>>>0<=R>>>0|L>>>0>P>>>0){_=0;break}if(y=fs(_|0)|0,(y|0)==(v|0)){O=_,M=v,G=145;break e}else w=y,G=136}else _=0;while(!1);do if((G|0)==136){if(v=0-_|0,!(l>>>0>_>>>0&(_>>>0<2147483647&(w|0)!=-1)))if((w|0)==-1){_=0;break}else{O=_,M=w,G=145;break e}if(y=p[5977]|0,y=d-_+y&0-y,y>>>0>=2147483647){O=_,M=w,G=145;break e}if((fs(y|0)|0)==-1){fs(v|0)|0,_=0;break}else{O=y+_|0,M=w,G=145;break e}}while(!1);p[5968]=p[5968]|4,G=143}while(!1);if((G|0)==143&&h>>>0<2147483647&&(Y=fs(h|0)|0,L=fs(0)|0,$=L-Y|0,te=$>>>0>(C+40|0)>>>0,!((Y|0)==-1|te^1|Y>>>0<L>>>0&((Y|0)!=-1&(L|0)!=-1)^1))&&(O=te?$:_,M=Y,G=145),(G|0)==145){_=(p[5965]|0)+O|0,p[5965]=_,_>>>0>(p[5966]|0)>>>0&&(p[5966]=_),d=p[5863]|0;e:do if(d){for(_=23876;;){if(y=p[_>>2]|0,v=p[_+4>>2]|0,(M|0)==(y+v|0)){G=154;break}if(w=p[_+8>>2]|0,w)_=w;else break}if((G|0)==154&&(re=_+4|0,(p[_+12>>2]&8|0)==0)&&M>>>0>d>>>0&y>>>0<=d>>>0){p[re>>2]=v+O,ae=(p[5860]|0)+O|0,Y=d+8|0,Y=Y&7|0?0-Y&7:0,re=d+Y|0,Y=ae-Y|0,p[5863]=re,p[5860]=Y,p[re+4>>2]=Y|1,p[d+ae+4>>2]=40,p[5864]=p[5979];break}for(M>>>0<(p[5861]|0)>>>0&&(p[5861]=M),v=M+O|0,_=23876;;){if((p[_>>2]|0)==(v|0)){G=162;break}if(y=p[_+8>>2]|0,y)_=y;else break}if((G|0)==162&&!(p[_+12>>2]&8|0)){p[_>>2]=M,m=_+4|0,p[m>>2]=(p[m>>2]|0)+O,m=M+8|0,m=M+(m&7|0?0-m&7:0)|0,_=v+8|0,_=v+(_&7|0?0-_&7:0)|0,h=m+C|0,l=_-m-C|0,p[m+4>>2]=C|3;t:do if((d|0)==(_|0))ae=(p[5860]|0)+l|0,p[5860]=ae,p[5863]=h,p[h+4>>2]=ae|1;else{if((p[5862]|0)==(_|0)){ae=(p[5859]|0)+l|0,p[5859]=ae,p[5862]=h,p[h+4>>2]=ae|1,p[h+ae>>2]=ae;break}if(y=p[_+4>>2]|0,(y&3|0)==1){O=y&-8,w=y>>>3;r:do if(y>>>0<256)if(y=p[_+8>>2]|0,v=p[_+12>>2]|0,(v|0)==(y|0)){p[5857]=p[5857]&~(1<<w);break}else{p[y+12>>2]=v,p[v+8>>2]=y;break}else{M=p[_+24>>2]|0,y=p[_+12>>2]|0;do if((y|0)==(_|0)){if(v=_+16|0,w=v+4|0,y=p[w>>2]|0,y)v=w;else if(y=p[v>>2]|0,!y){y=0;break}for(;;)if(B=y+20|0,w=p[B>>2]|0,w)y=w,v=B;else if(B=y+16|0,w=p[B>>2]|0,w)y=w,v=B;else break;p[v>>2]=0}else ae=p[_+8>>2]|0,p[ae+12>>2]=y,p[y+8>>2]=ae;while(!1);if(!M)break;v=p[_+28>>2]|0,w=23732+(v<<2)|0;do if((p[w>>2]|0)!=(_|0)){if(ae=M+16|0,p[((p[ae>>2]|0)==(_|0)?ae:M+20|0)>>2]=y,!y)break r}else{if(p[w>>2]=y,y|0)break;p[5858]=p[5858]&~(1<<v);break r}while(!1);if(p[y+24>>2]=M,v=_+16|0,w=p[v>>2]|0,w|0&&(p[y+16>>2]=w,p[w+24>>2]=y),v=p[v+4>>2]|0,!v)break;p[y+20>>2]=v,p[v+24>>2]=y}while(!1);_=_+O|0,B=O+l|0}else B=l;if(_=_+4|0,p[_>>2]=p[_>>2]&-2,p[h+4>>2]=B|1,p[h+B>>2]=B,_=B>>>3,B>>>0<256){v=23468+(_<<1<<2)|0,y=p[5857]|0,_=1<<_,y&_?(y=v+8|0,_=p[y>>2]|0):(p[5857]=y|_,_=v,y=v+8|0),p[y>>2]=h,p[_+12>>2]=h,p[h+8>>2]=_,p[h+12>>2]=v;break}_=B>>>8;do if(!_)w=0;else{if(B>>>0>16777215){w=31;break}re=(_+1048320|0)>>>16&8,ae=_<<re,Y=(ae+520192|0)>>>16&4,ae=ae<<Y,w=(ae+245760|0)>>>16&2,w=14-(Y|re|w)+(ae<<w>>>15)|0,w=B>>>(w+7|0)&1|w<<1}while(!1);if(_=23732+(w<<2)|0,p[h+28>>2]=w,y=h+16|0,p[y+4>>2]=0,p[y>>2]=0,y=p[5858]|0,v=1<<w,!(y&v)){p[5858]=y|v,p[_>>2]=h,p[h+24>>2]=_,p[h+12>>2]=h,p[h+8>>2]=h;break}_=p[_>>2]|0;r:do if((p[_+4>>2]&-8|0)!=(B|0)){for(w=B<<((w|0)==31?0:25-(w>>>1)|0);v=_+16+(w>>>31<<2)|0,y=p[v>>2]|0,!!y;)if((p[y+4>>2]&-8|0)==(B|0)){_=y;break r}else w=w<<1,_=y;p[v>>2]=h,p[h+24>>2]=_,p[h+12>>2]=h,p[h+8>>2]=h;break t}while(!1);re=_+8|0,ae=p[re>>2]|0,p[ae+12>>2]=h,p[re>>2]=h,p[h+8>>2]=ae,p[h+12>>2]=_,p[h+24>>2]=0}while(!1);return ae=m+8|0,Ie=we,ae|0}for(_=23876;y=p[_>>2]|0,!(y>>>0<=d>>>0&&(ae=y+(p[_+4>>2]|0)|0,ae>>>0>d>>>0));)_=p[_+8>>2]|0;B=ae+-47|0,y=B+8|0,y=B+(y&7|0?0-y&7:0)|0,B=d+16|0,y=y>>>0<B>>>0?d:y,_=y+8|0,v=O+-40|0,Y=M+8|0,Y=Y&7|0?0-Y&7:0,re=M+Y|0,Y=v-Y|0,p[5863]=re,p[5860]=Y,p[re+4>>2]=Y|1,p[M+v+4>>2]=40,p[5864]=p[5979],v=y+4|0,p[v>>2]=27,p[_>>2]=p[5969],p[_+4>>2]=p[5970],p[_+8>>2]=p[5971],p[_+12>>2]=p[5972],p[5969]=M,p[5970]=O,p[5972]=0,p[5971]=_,_=y+24|0;do re=_,_=_+4|0,p[_>>2]=7;while((re+8|0)>>>0<ae>>>0);if((y|0)!=(d|0)){if(M=y-d|0,p[v>>2]=p[v>>2]&-2,p[d+4>>2]=M|1,p[y>>2]=M,_=M>>>3,M>>>0<256){v=23468+(_<<1<<2)|0,y=p[5857]|0,_=1<<_,y&_?(y=v+8|0,_=p[y>>2]|0):(p[5857]=y|_,_=v,y=v+8|0),p[y>>2]=d,p[_+12>>2]=d,p[d+8>>2]=_,p[d+12>>2]=v;break}if(_=M>>>8,_?M>>>0>16777215?w=31:(re=(_+1048320|0)>>>16&8,ae=_<<re,Y=(ae+520192|0)>>>16&4,ae=ae<<Y,w=(ae+245760|0)>>>16&2,w=14-(Y|re|w)+(ae<<w>>>15)|0,w=M>>>(w+7|0)&1|w<<1):w=0,v=23732+(w<<2)|0,p[d+28>>2]=w,p[d+20>>2]=0,p[B>>2]=0,_=p[5858]|0,y=1<<w,!(_&y)){p[5858]=_|y,p[v>>2]=d,p[d+24>>2]=v,p[d+12>>2]=d,p[d+8>>2]=d;break}_=p[v>>2]|0;t:do if((p[_+4>>2]&-8|0)!=(M|0)){for(w=M<<((w|0)==31?0:25-(w>>>1)|0);v=_+16+(w>>>31<<2)|0,y=p[v>>2]|0,!!y;)if((p[y+4>>2]&-8|0)==(M|0)){_=y;break t}else w=w<<1,_=y;p[v>>2]=d,p[d+24>>2]=_,p[d+12>>2]=d,p[d+8>>2]=d;break e}while(!1);re=_+8|0,ae=p[re>>2]|0,p[ae+12>>2]=d,p[re>>2]=d,p[d+8>>2]=ae,p[d+12>>2]=_,p[d+24>>2]=0}}else ae=p[5861]|0,(ae|0)==0|M>>>0<ae>>>0&&(p[5861]=M),p[5969]=M,p[5970]=O,p[5972]=0,p[5866]=p[5975],p[5865]=-1,p[5870]=23468,p[5869]=23468,p[5872]=23476,p[5871]=23476,p[5874]=23484,p[5873]=23484,p[5876]=23492,p[5875]=23492,p[5878]=23500,p[5877]=23500,p[5880]=23508,p[5879]=23508,p[5882]=23516,p[5881]=23516,p[5884]=23524,p[5883]=23524,p[5886]=23532,p[5885]=23532,p[5888]=23540,p[5887]=23540,p[5890]=23548,p[5889]=23548,p[5892]=23556,p[5891]=23556,p[5894]=23564,p[5893]=23564,p[5896]=23572,p[5895]=23572,p[5898]=23580,p[5897]=23580,p[5900]=23588,p[5899]=23588,p[5902]=23596,p[5901]=23596,p[5904]=23604,p[5903]=23604,p[5906]=23612,p[5905]=23612,p[5908]=23620,p[5907]=23620,p[5910]=23628,p[5909]=23628,p[5912]=23636,p[5911]=23636,p[5914]=23644,p[5913]=23644,p[5916]=23652,p[5915]=23652,p[5918]=23660,p[5917]=23660,p[5920]=23668,p[5919]=23668,p[5922]=23676,p[5921]=23676,p[5924]=23684,p[5923]=23684,p[5926]=23692,p[5925]=23692,p[5928]=23700,p[5927]=23700,p[5930]=23708,p[5929]=23708,p[5932]=23716,p[5931]=23716,ae=O+-40|0,Y=M+8|0,Y=Y&7|0?0-Y&7:0,re=M+Y|0,Y=ae-Y|0,p[5863]=re,p[5860]=Y,p[re+4>>2]=Y|1,p[M+ae+4>>2]=40,p[5864]=p[5979];while(!1);if(_=p[5860]|0,_>>>0>C>>>0)return Y=_-C|0,p[5860]=Y,ae=p[5863]|0,re=ae+C|0,p[5863]=re,p[re+4>>2]=Y|1,p[ae+4>>2]=C|3,ae=ae+8|0,Ie=we,ae|0}return ae=fu()|0,p[ae>>2]=12,ae=0,Ie=we,ae|0}function Dr(y){y=y|0;var _=0,v=0,w=0,B=0,M=0,O=0,l=0,d=0;if(y){v=y+-8|0,B=p[5861]|0,y=p[y+-4>>2]|0,_=y&-8,d=v+_|0;do if(y&1)l=v,O=v;else{if(w=p[v>>2]|0,!(y&3)||(O=v+(0-w)|0,M=w+_|0,O>>>0<B>>>0))return;if((p[5862]|0)==(O|0)){if(y=d+4|0,_=p[y>>2]|0,(_&3|0)!=3){l=O,_=M;break}p[5859]=M,p[y>>2]=_&-2,p[O+4>>2]=M|1,p[O+M>>2]=M;return}if(v=w>>>3,w>>>0<256)if(y=p[O+8>>2]|0,_=p[O+12>>2]|0,(_|0)==(y|0)){p[5857]=p[5857]&~(1<<v),l=O,_=M;break}else{p[y+12>>2]=_,p[_+8>>2]=y,l=O,_=M;break}B=p[O+24>>2]|0,y=p[O+12>>2]|0;do if((y|0)==(O|0)){if(_=O+16|0,v=_+4|0,y=p[v>>2]|0,y)_=v;else if(y=p[_>>2]|0,!y){y=0;break}for(;;)if(w=y+20|0,v=p[w>>2]|0,v)y=v,_=w;else if(w=y+16|0,v=p[w>>2]|0,v)y=v,_=w;else break;p[_>>2]=0}else l=p[O+8>>2]|0,p[l+12>>2]=y,p[y+8>>2]=l;while(!1);if(B){if(_=p[O+28>>2]|0,v=23732+(_<<2)|0,(p[v>>2]|0)==(O|0)){if(p[v>>2]=y,!y){p[5858]=p[5858]&~(1<<_),l=O,_=M;break}}else if(l=B+16|0,p[((p[l>>2]|0)==(O|0)?l:B+20|0)>>2]=y,!y){l=O,_=M;break}p[y+24>>2]=B,_=O+16|0,v=p[_>>2]|0,v|0&&(p[y+16>>2]=v,p[v+24>>2]=y),_=p[_+4>>2]|0,_?(p[y+20>>2]=_,p[_+24>>2]=y,l=O,_=M):(l=O,_=M)}else l=O,_=M}while(!1);if(!(O>>>0>=d>>>0)&&(y=d+4|0,w=p[y>>2]|0,!!(w&1))){if(w&2)p[y>>2]=w&-2,p[l+4>>2]=_|1,p[O+_>>2]=_,B=_;else{if((p[5863]|0)==(d|0)){if(d=(p[5860]|0)+_|0,p[5860]=d,p[5863]=l,p[l+4>>2]=d|1,(l|0)!=(p[5862]|0))return;p[5862]=0,p[5859]=0;return}if((p[5862]|0)==(d|0)){d=(p[5859]|0)+_|0,p[5859]=d,p[5862]=O,p[l+4>>2]=d|1,p[O+d>>2]=d;return}B=(w&-8)+_|0,v=w>>>3;do if(w>>>0<256)if(_=p[d+8>>2]|0,y=p[d+12>>2]|0,(y|0)==(_|0)){p[5857]=p[5857]&~(1<<v);break}else{p[_+12>>2]=y,p[y+8>>2]=_;break}else{M=p[d+24>>2]|0,y=p[d+12>>2]|0;do if((y|0)==(d|0)){if(_=d+16|0,v=_+4|0,y=p[v>>2]|0,y)_=v;else if(y=p[_>>2]|0,!y){v=0;break}for(;;)if(w=y+20|0,v=p[w>>2]|0,v)y=v,_=w;else if(w=y+16|0,v=p[w>>2]|0,v)y=v,_=w;else break;p[_>>2]=0,v=y}else v=p[d+8>>2]|0,p[v+12>>2]=y,p[y+8>>2]=v,v=y;while(!1);if(M|0){if(y=p[d+28>>2]|0,_=23732+(y<<2)|0,(p[_>>2]|0)==(d|0)){if(p[_>>2]=v,!v){p[5858]=p[5858]&~(1<<y);break}}else if(w=M+16|0,p[((p[w>>2]|0)==(d|0)?w:M+20|0)>>2]=v,!v)break;p[v+24>>2]=M,y=d+16|0,_=p[y>>2]|0,_|0&&(p[v+16>>2]=_,p[_+24>>2]=v),y=p[y+4>>2]|0,y|0&&(p[v+20>>2]=y,p[y+24>>2]=v)}}while(!1);if(p[l+4>>2]=B|1,p[O+B>>2]=B,(l|0)==(p[5862]|0)){p[5859]=B;return}}if(y=B>>>3,B>>>0<256){v=23468+(y<<1<<2)|0,_=p[5857]|0,y=1<<y,_&y?(_=v+8|0,y=p[_>>2]|0):(p[5857]=_|y,y=v,_=v+8|0),p[_>>2]=l,p[y+12>>2]=l,p[l+8>>2]=y,p[l+12>>2]=v;return}y=B>>>8,y?B>>>0>16777215?w=31:(O=(y+1048320|0)>>>16&8,d=y<<O,M=(d+520192|0)>>>16&4,d=d<<M,w=(d+245760|0)>>>16&2,w=14-(M|O|w)+(d<<w>>>15)|0,w=B>>>(w+7|0)&1|w<<1):w=0,y=23732+(w<<2)|0,p[l+28>>2]=w,p[l+20>>2]=0,p[l+16>>2]=0,_=p[5858]|0,v=1<<w;e:do if(!(_&v))p[5858]=_|v,p[y>>2]=l,p[l+24>>2]=y,p[l+12>>2]=l,p[l+8>>2]=l;else{y=p[y>>2]|0;t:do if((p[y+4>>2]&-8|0)!=(B|0)){for(w=B<<((w|0)==31?0:25-(w>>>1)|0);v=y+16+(w>>>31<<2)|0,_=p[v>>2]|0,!!_;)if((p[_+4>>2]&-8|0)==(B|0)){y=_;break t}else w=w<<1,y=_;p[v>>2]=l,p[l+24>>2]=y,p[l+12>>2]=l,p[l+8>>2]=l;break e}while(!1);O=y+8|0,d=p[O>>2]|0,p[d+12>>2]=l,p[O>>2]=l,p[l+8>>2]=d,p[l+12>>2]=y,p[l+24>>2]=0}while(!1);if(d=(p[5865]|0)+-1|0,p[5865]=d,!(d|0)){for(y=23884;y=p[y>>2]|0,y;)y=y+8|0;p[5865]=-1}}}}function Ks(y,_){y=y|0,_=_|0;var v=0;return y?(v=Vr(_,y)|0,(_|y)>>>0>65535&&(v=((v>>>0)/(y>>>0)|0|0)==(_|0)?v:-1)):v=0,y=Gn(v)|0,!y||!(p[y+-4>>2]&3)||Xo(y|0,0,v|0)|0,y|0}function cn(y,_,v,w){return y=y|0,_=_|0,v=v|0,w=w|0,v=y+v>>>0,fr(_+w+(v>>>0<y>>>0|0)>>>0|0),v|0|0}function jr(y,_,v,w){return y=y|0,_=_|0,v=v|0,w=w|0,w=_-w-(v>>>0>y>>>0|0)>>>0,fr(w|0),y-v>>>0|0|0}function Mi(y){return y=y|0,(y?31-(Hr(y^y-1)|0)|0:32)|0}function hu(y,_,v,w,B){y=y|0,_=_|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,m=0,C=0,P=0,R=0,L=0;if(m=y,d=_,h=d,O=v,P=w,l=P,!h)return M=(B|0)!=0,l?M?(p[B>>2]=y|0,p[B+4>>2]=_&0,P=0,B=0,fr(P|0),B|0):(P=0,B=0,fr(P|0),B|0):(M&&(p[B>>2]=(m>>>0)%(O>>>0),p[B+4>>2]=0),P=0,B=(m>>>0)/(O>>>0)>>>0,fr(P|0),B|0);M=(l|0)==0;do if(O){if(!M){if(M=(Hr(l|0)|0)-(Hr(h|0)|0)|0,M>>>0<=31){C=M+1|0,l=31-M|0,_=M-31>>31,O=C,y=m>>>(C>>>0)&_|h<<l,_=h>>>(C>>>0)&_,M=0,l=m<<l;break}return B?(p[B>>2]=y|0,p[B+4>>2]=d|_&0,P=0,B=0,fr(P|0),B|0):(P=0,B=0,fr(P|0),B|0)}if(M=O-1|0,M&O|0){l=(Hr(O|0)|0)+33-(Hr(h|0)|0)|0,L=64-l|0,C=32-l|0,d=C>>31,R=l-32|0,_=R>>31,O=l,y=C-1>>31&h>>>(R>>>0)|(h<<C|m>>>(l>>>0))&_,_=_&h>>>(l>>>0),M=m<<L&d,l=(h<<L|m>>>(R>>>0))&d|m<<C&l-33>>31;break}return B|0&&(p[B>>2]=M&m,p[B+4>>2]=0),(O|0)==1?(R=d|_&0,L=y|0|0,fr(R|0),L|0):(L=Mi(O|0)|0,R=h>>>(L>>>0)|0,L=h<<32-L|m>>>(L>>>0)|0,fr(R|0),L|0)}else{if(M)return B|0&&(p[B>>2]=(h>>>0)%(O>>>0),p[B+4>>2]=0),R=0,L=(h>>>0)/(O>>>0)>>>0,fr(R|0),L|0;if(!m)return B|0&&(p[B>>2]=0,p[B+4>>2]=(h>>>0)%(l>>>0)),R=0,L=(h>>>0)/(l>>>0)>>>0,fr(R|0),L|0;if(M=l-1|0,!(M&l))return B|0&&(p[B>>2]=y|0,p[B+4>>2]=M&h|_&0),R=0,L=h>>>((Mi(l|0)|0)>>>0),fr(R|0),L|0;if(M=(Hr(l|0)|0)-(Hr(h|0)|0)|0,M>>>0<=30){_=M+1|0,l=31-M|0,O=_,y=h<<l|m>>>(_>>>0),_=h>>>(_>>>0),M=0,l=m<<l;break}return B?(p[B>>2]=y|0,p[B+4>>2]=d|_&0,R=0,L=0,fr(R|0),L|0):(R=0,L=0,fr(R|0),L|0)}while(!1);if(!O)h=l,d=0,l=0;else{C=v|0|0,m=P|w&0,h=cn(C|0,m|0,-1,-1)|0,v=Me()|0,d=l,l=0;do w=d,d=M>>>31|d<<1,M=l|M<<1,w=y<<1|w>>>31|0,P=y>>>31|_<<1|0,jr(h|0,v|0,w|0,P|0)|0,L=Me()|0,R=L>>31|((L|0)<0?-1:0)<<1,l=R&1,y=jr(w|0,P|0,R&C|0,(((L|0)<0?-1:0)>>31|((L|0)<0?-1:0)<<1)&m|0)|0,_=Me()|0,O=O-1|0;while(O|0);h=d,d=0}return O=0,B|0&&(p[B>>2]=y,p[B+4>>2]=_),R=(M|0)>>>31|(h|O)<<1|(O<<1|M>>>31)&0|d,L=(M<<1|0)&-2|l,fr(R|0),L|0}function Ds(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0;return h=_>>31|((_|0)<0?-1:0)<<1,d=((_|0)<0?-1:0)>>31|((_|0)<0?-1:0)<<1,M=w>>31|((w|0)<0?-1:0)<<1,B=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,l=jr(h^y|0,d^_|0,h|0,d|0)|0,O=Me()|0,y=M^h,_=B^d,jr((hu(l,O,jr(M^v|0,B^w|0,M|0,B|0)|0,Me()|0,0)|0)^y|0,(Me()|0)^_|0,y|0,_|0)|0}function pf(y,_){y=y|0,_=_|0;var v=0,w=0,B=0,M=0;return M=y&65535,B=_&65535,v=Vr(B,M)|0,w=y>>>16,y=(v>>>16)+(Vr(B,w)|0)|0,B=_>>>16,_=Vr(B,M)|0,fr((y>>>16)+(Vr(B,w)|0)+(((y&65535)+_|0)>>>16)|0),y+_<<16|v&65535|0|0}function oi(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0;return B=y,M=v,v=pf(B,M)|0,y=Me()|0,fr((Vr(_,M)|0)+(Vr(w,B)|0)+y|y&0|0),v|0|0|0}function Yi(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0;return B=Ie,Ie=Ie+16|0,l=B|0,O=_>>31|((_|0)<0?-1:0)<<1,M=((_|0)<0?-1:0)>>31|((_|0)<0?-1:0)<<1,h=w>>31|((w|0)<0?-1:0)<<1,d=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,y=jr(O^y|0,M^_|0,O|0,M|0)|0,_=Me()|0,hu(y,_,jr(h^v|0,d^w|0,h|0,d|0)|0,Me()|0,l)|0,w=jr(p[l>>2]^O|0,p[l+4>>2]^M|0,O|0,M|0)|0,v=Me()|0,Ie=B,fr(v|0),w|0}function ho(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var B=0,M=0;return M=Ie,Ie=Ie+16|0,B=M|0,hu(y,_,v,w,B)|0,Ie=M,fr(p[B+4>>2]|0),p[B>>2]|0|0}function Ao(y,_,v){return y=y|0,_=_|0,v=v|0,(v|0)<32?(fr(_>>v|0),y>>>v|(_&(1<<v)-1)<<32-v):(fr(((_|0)<0?-1:0)|0),_>>v-32|0)}function jt(y,_,v){return y=y|0,_=_|0,v=v|0,(v|0)<32?(fr(_>>>v|0),y>>>v|(_&(1<<v)-1)<<32-v):(fr(0),_>>>v-32|0)}function Yt(y,_,v){return y=y|0,_=_|0,v=v|0,(v|0)<32?(fr(_<<v|(y&(1<<v)-1<<32-v)>>>32-v|0),y<<v):(fr(y<<v-32|0),0)}function Tc(y,_){return y=+y,_=+_,y!=y?+_:_!=_?+y:+hi(+y,+_)}function gl(y,_){return y=+y,_=+_,y!=y?+_:_!=_?+y:+Lr(+y,+_)}function Wo(y){return y=+y,y>=0?+Ct(y+.5):+Gr(y-.5)}function xo(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0;if((v|0)>=8192)return sa(y|0,_|0,v|0)|0,y|0;if(M=y|0,B=y+v|0,(y&3)==(_&3)){for(;y&3;){if(!v)return M|0;Se[y>>0]=Se[_>>0]|0,y=y+1|0,_=_+1|0,v=v-1|0}for(v=B&-4|0,w=v-64|0;(y|0)<=(w|0);)p[y>>2]=p[_>>2],p[y+4>>2]=p[_+4>>2],p[y+8>>2]=p[_+8>>2],p[y+12>>2]=p[_+12>>2],p[y+16>>2]=p[_+16>>2],p[y+20>>2]=p[_+20>>2],p[y+24>>2]=p[_+24>>2],p[y+28>>2]=p[_+28>>2],p[y+32>>2]=p[_+32>>2],p[y+36>>2]=p[_+36>>2],p[y+40>>2]=p[_+40>>2],p[y+44>>2]=p[_+44>>2],p[y+48>>2]=p[_+48>>2],p[y+52>>2]=p[_+52>>2],p[y+56>>2]=p[_+56>>2],p[y+60>>2]=p[_+60>>2],y=y+64|0,_=_+64|0;for(;(y|0)<(v|0);)p[y>>2]=p[_>>2],y=y+4|0,_=_+4|0}else for(v=B-4|0;(y|0)<(v|0);)Se[y>>0]=Se[_>>0]|0,Se[y+1>>0]=Se[_+1>>0]|0,Se[y+2>>0]=Se[_+2>>0]|0,Se[y+3>>0]=Se[_+3>>0]|0,y=y+4|0,_=_+4|0;for(;(y|0)<(B|0);)Se[y>>0]=Se[_>>0]|0,y=y+1|0,_=_+1|0;return M|0}function Xo(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,B=0,M=0,O=0;if(M=y+v|0,_=_&255,(v|0)>=67){for(;y&3;)Se[y>>0]=_,y=y+1|0;for(w=M&-4|0,O=_|_<<8|_<<16|_<<24,B=w-64|0;(y|0)<=(B|0);)p[y>>2]=O,p[y+4>>2]=O,p[y+8>>2]=O,p[y+12>>2]=O,p[y+16>>2]=O,p[y+20>>2]=O,p[y+24>>2]=O,p[y+28>>2]=O,p[y+32>>2]=O,p[y+36>>2]=O,p[y+40>>2]=O,p[y+44>>2]=O,p[y+48>>2]=O,p[y+52>>2]=O,p[y+56>>2]=O,p[y+60>>2]=O,y=y+64|0;for(;(y|0)<(w|0);)p[y>>2]=O,y=y+4|0}for(;(y|0)<(M|0);)Se[y>>0]=_,y=y+1|0;return M-v|0}function $o(y){return y=+y,y>=0?+Ct(y+.5):+Gr(y-.5)}function fs(y){y=y|0;var _=0,v=0,w=0;return w=Ni()|0,v=p[Ke>>2]|0,_=v+y|0,(y|0)>0&(_|0)<(v|0)|(_|0)<0?(kn(_|0)|0,Kr(12),-1):(_|0)>(w|0)&&!(ri(_|0)|0)?(Kr(12),-1):(p[Ke>>2]=_,v|0)}return{___divdi3:Ds,___muldi3:oi,___remdi3:Yi,___uremdi3:ho,_areNeighborCells:ha,_bitshift64Ashr:Ao,_bitshift64Lshr:jt,_bitshift64Shl:Yt,_calloc:Ks,_cellAreaKm2:Pn,_cellAreaM2:Rs,_cellAreaRads2:nn,_cellToBoundary:yc,_cellToCenterChild:PA,_cellToChildPos:nu,_cellToChildren:Mn,_cellToChildrenSize:cl,_cellToLatLng:_c,_cellToLocalIj:Ch,_cellToParent:Go,_cellToVertex:Nr,_cellToVertexes:bo,_cellsToDirectedEdge:Fa,_cellsToLinkedMultiPolygon:gr,_childPosToCell:FA,_compactCells:gc,_destroyLinkedMultiPolygon:wc,_directedEdgeToBoundary:ql,_directedEdgeToCells:gh,_edgeLengthKm:xc,_edgeLengthM:dl,_edgeLengthRads:hl,_emscripten_replace_memory:Do,_free:Dr,_getBaseCellNumber:af,_getDirectedEdgeDestination:da,_getDirectedEdgeOrigin:Da,_getHexagonAreaAvgKm2:wh,_getHexagonAreaAvgM2:Va,_getHexagonEdgeLengthAvgKm:zn,_getHexagonEdgeLengthAvgM:ou,_getIcosahedronFaces:vc,_getNumCells:Vo,_getPentagons:ll,_getRes0Cells:Ah,_getResolution:Oa,_greatCircleDistanceKm:Ga,_greatCircleDistanceM:cf,_greatCircleDistanceRads:su,_gridDisk:Tn,_gridDiskDistances:ls,_gridDistance:nr,_gridPathCells:au,_gridPathCellsSize:ms,_gridRingUnsafe:xe,_i64Add:cn,_i64Subtract:jr,_isPentagon:Bn,_isResClassIII:xh,_isValidCell:zo,_isValidDirectedEdge:ph,_isValidVertex:zi,_latLngToCell:Na,_llvm_maxnum_f64:Tc,_llvm_minnum_f64:gl,_llvm_round_f64:Wo,_localIjToCell:_i,_malloc:Gn,_maxFaceCount:Ua,_maxGridDiskSize:wi,_maxPolygonToCellsSize:Re,_memcpy:xo,_memset:Xo,_originToDirectedEdges:wn,_pentagonCount:ru,_polygonToCells:At,_readInt64AsDoubleFromPointer:ys,_res0CellCount:il,_round:$o,_sbrk:fs,_sizeOfCellBoundary:hf,_sizeOfCoordIJ:uu,_sizeOfGeoLoop:Ws,_sizeOfGeoPolygon:_s,_sizeOfH3Index:ff,_sizeOfLatLng:cu,_sizeOfLinkedGeoPolygon:lu,_uncompactCells:bh,_uncompactCellsSize:RA,_vertexToLatLng:Xs,establishStackSpace:ni,stackAlloc:Un,stackRestore:Si,stackSave:Oo}}(ge,kt,pe);e.___divdi3=wt.___divdi3,e.___muldi3=wt.___muldi3,e.___remdi3=wt.___remdi3,e.___uremdi3=wt.___uremdi3,e._areNeighborCells=wt._areNeighborCells,e._bitshift64Ashr=wt._bitshift64Ashr,e._bitshift64Lshr=wt._bitshift64Lshr,e._bitshift64Shl=wt._bitshift64Shl,e._calloc=wt._calloc,e._cellAreaKm2=wt._cellAreaKm2,e._cellAreaM2=wt._cellAreaM2,e._cellAreaRads2=wt._cellAreaRads2,e._cellToBoundary=wt._cellToBoundary,e._cellToCenterChild=wt._cellToCenterChild,e._cellToChildPos=wt._cellToChildPos,e._cellToChildren=wt._cellToChildren,e._cellToChildrenSize=wt._cellToChildrenSize,e._cellToLatLng=wt._cellToLatLng,e._cellToLocalIj=wt._cellToLocalIj,e._cellToParent=wt._cellToParent,e._cellToVertex=wt._cellToVertex,e._cellToVertexes=wt._cellToVertexes,e._cellsToDirectedEdge=wt._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=wt._cellsToLinkedMultiPolygon,e._childPosToCell=wt._childPosToCell,e._compactCells=wt._compactCells,e._destroyLinkedMultiPolygon=wt._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=wt._directedEdgeToBoundary,e._directedEdgeToCells=wt._directedEdgeToCells,e._edgeLengthKm=wt._edgeLengthKm,e._edgeLengthM=wt._edgeLengthM,e._edgeLengthRads=wt._edgeLengthRads;var W=e._emscripten_replace_memory=wt._emscripten_replace_memory;e._free=wt._free,e._getBaseCellNumber=wt._getBaseCellNumber,e._getDirectedEdgeDestination=wt._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=wt._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=wt._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=wt._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=wt._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=wt._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=wt._getIcosahedronFaces,e._getNumCells=wt._getNumCells,e._getPentagons=wt._getPentagons,e._getRes0Cells=wt._getRes0Cells,e._getResolution=wt._getResolution,e._greatCircleDistanceKm=wt._greatCircleDistanceKm,e._greatCircleDistanceM=wt._greatCircleDistanceM,e._greatCircleDistanceRads=wt._greatCircleDistanceRads,e._gridDisk=wt._gridDisk,e._gridDiskDistances=wt._gridDiskDistances,e._gridDistance=wt._gridDistance,e._gridPathCells=wt._gridPathCells,e._gridPathCellsSize=wt._gridPathCellsSize,e._gridRingUnsafe=wt._gridRingUnsafe,e._i64Add=wt._i64Add,e._i64Subtract=wt._i64Subtract,e._isPentagon=wt._isPentagon,e._isResClassIII=wt._isResClassIII,e._isValidCell=wt._isValidCell,e._isValidDirectedEdge=wt._isValidDirectedEdge,e._isValidVertex=wt._isValidVertex,e._latLngToCell=wt._latLngToCell,e._llvm_maxnum_f64=wt._llvm_maxnum_f64,e._llvm_minnum_f64=wt._llvm_minnum_f64,e._llvm_round_f64=wt._llvm_round_f64,e._localIjToCell=wt._localIjToCell,e._malloc=wt._malloc,e._maxFaceCount=wt._maxFaceCount,e._maxGridDiskSize=wt._maxGridDiskSize,e._maxPolygonToCellsSize=wt._maxPolygonToCellsSize,e._memcpy=wt._memcpy,e._memset=wt._memset,e._originToDirectedEdges=wt._originToDirectedEdges,e._pentagonCount=wt._pentagonCount,e._polygonToCells=wt._polygonToCells,e._readInt64AsDoubleFromPointer=wt._readInt64AsDoubleFromPointer,e._res0CellCount=wt._res0CellCount,e._round=wt._round,e._sbrk=wt._sbrk,e._sizeOfCellBoundary=wt._sizeOfCellBoundary,e._sizeOfCoordIJ=wt._sizeOfCoordIJ,e._sizeOfGeoLoop=wt._sizeOfGeoLoop,e._sizeOfGeoPolygon=wt._sizeOfGeoPolygon,e._sizeOfH3Index=wt._sizeOfH3Index,e._sizeOfLatLng=wt._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=wt._sizeOfLinkedGeoPolygon,e._uncompactCells=wt._uncompactCells,e._uncompactCellsSize=wt._uncompactCellsSize,e._vertexToLatLng=wt._vertexToLatLng,e.establishStackSpace=wt.establishStackSpace;var yt=e.stackAlloc=wt.stackAlloc,Et=e.stackRestore=wt.stackRestore,Ee=e.stackSave=wt.stackSave;if(e.asm=wt,e.cwrap=K,e.setValue=F,e.getValue=k,un){Nn(un)||(un=o(un));{ti();var Xe=function(de){de.byteLength&&(de=new Uint8Array(de)),ne.set(de,S),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,Jn()},ct=function(){s(un,Xe,function(){throw"could not load memory initializer "+un})},Z=Mt(un);if(Z)Xe(Z.buffer);else if(e.memoryInitializerRequest){var ie=function(){var de=e.memoryInitializerRequest,be=de.response;if(de.status!==200&&de.status!==0){var ce=Mt(e.memoryInitializerRequestURL);if(ce)be=ce.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+de.status+", retrying "+un),ct();return}}Xe(be)};e.memoryInitializerRequest.response?setTimeout(ie,0):e.memoryInitializerRequest.addEventListener("load",ie)}else ct()}}var ue;Sr=function de(){ue||ve(),ue||(Sr=de)};function ve(de){if(rn>0||($t(),rn>0))return;function be(){ue||(ue=!0,!U&&(Jt(),Lt(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),lr()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),be()},1)):be()}e.run=ve;function Oe(de){throw e.onAbort&&e.onAbort(de),de+="",c(de),f(de),U=!0,"abort("+de+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Oe,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return ve(),r}(typeof Rr=="object"?Rr:{}),fn="number",Qr=fn,gp=fn,on=fn,an=fn,eo=fn,Br=fn,Toe=[["sizeOfH3Index",fn],["sizeOfLatLng",fn],["sizeOfCellBoundary",fn],["sizeOfGeoLoop",fn],["sizeOfGeoPolygon",fn],["sizeOfLinkedGeoPolygon",fn],["sizeOfCoordIJ",fn],["readInt64AsDoubleFromPointer",fn],["isValidCell",gp,[on,an]],["latLngToCell",Qr,[fn,fn,eo,Br]],["cellToLatLng",Qr,[on,an,Br]],["cellToBoundary",Qr,[on,an,Br]],["maxGridDiskSize",Qr,[fn,Br]],["gridDisk",Qr,[on,an,fn,Br]],["gridDiskDistances",Qr,[on,an,fn,Br,Br]],["gridRingUnsafe",Qr,[on,an,fn,Br]],["maxPolygonToCellsSize",Qr,[Br,eo,fn,Br]],["polygonToCells",Qr,[Br,eo,fn,Br]],["cellsToLinkedMultiPolygon",Qr,[Br,fn,Br]],["destroyLinkedMultiPolygon",null,[Br]],["compactCells",Qr,[Br,Br,fn,fn]],["uncompactCells",Qr,[Br,fn,fn,Br,fn,eo]],["uncompactCellsSize",Qr,[Br,fn,fn,eo,Br]],["isPentagon",gp,[on,an]],["isResClassIII",gp,[on,an]],["getBaseCellNumber",fn,[on,an]],["getResolution",fn,[on,an]],["maxFaceCount",Qr,[on,an,Br]],["getIcosahedronFaces",Qr,[on,an,Br]],["cellToParent",Qr,[on,an,eo,Br]],["cellToChildren",Qr,[on,an,eo,Br]],["cellToCenterChild",Qr,[on,an,eo,Br]],["cellToChildrenSize",Qr,[on,an,eo,Br]],["cellToChildPos",Qr,[on,an,eo,Br]],["childPosToCell",Qr,[fn,fn,on,an,eo,Br]],["areNeighborCells",Qr,[on,an,on,an,Br]],["cellsToDirectedEdge",Qr,[on,an,on,an,Br]],["getDirectedEdgeOrigin",Qr,[on,an,Br]],["getDirectedEdgeDestination",Qr,[on,an,Br]],["isValidDirectedEdge",gp,[on,an]],["directedEdgeToCells",Qr,[on,an,Br]],["originToDirectedEdges",Qr,[on,an,Br]],["directedEdgeToBoundary",Qr,[on,an,Br]],["gridDistance",Qr,[on,an,on,an,Br]],["gridPathCells",Qr,[on,an,on,an,Br]],["gridPathCellsSize",Qr,[on,an,on,an,Br]],["cellToLocalIj",Qr,[on,an,on,an,fn,Br]],["localIjToCell",Qr,[on,an,Br,fn,Br]],["getHexagonAreaAvgM2",Qr,[eo,Br]],["getHexagonAreaAvgKm2",Qr,[eo,Br]],["getHexagonEdgeLengthAvgM",Qr,[eo,Br]],["getHexagonEdgeLengthAvgKm",Qr,[eo,Br]],["greatCircleDistanceM",fn,[Br,Br]],["greatCircleDistanceKm",fn,[Br,Br]],["greatCircleDistanceRads",fn,[Br,Br]],["cellAreaM2",Qr,[on,an,Br]],["cellAreaKm2",Qr,[on,an,Br]],["cellAreaRads2",Qr,[on,an,Br]],["edgeLengthM",Qr,[on,an,Br]],["edgeLengthKm",Qr,[on,an,Br]],["edgeLengthRads",Qr,[on,an,Br]],["getNumCells",Qr,[eo,Br]],["getRes0Cells",Qr,[Br]],["res0CellCount",fn],["getPentagons",Qr,[fn,Br]],["pentagonCount",fn],["cellToVertex",Qr,[on,an,fn,Br]],["cellToVertexes",Qr,[on,an,Br]],["vertexToLatLng",Qr,[on,an,Br]],["isValidVertex",gp,[on,an]]],Boe=0,Soe=1,Ioe=2,Moe=3,j6=4,Poe=5,Roe=6,Foe=7,Doe=8,Ooe=9,Loe=10,Noe=11,koe=12,Uoe=13,zoe=14,Goe=15,Gs={};Gs[Boe]="Success";Gs[Soe]="The operation failed but a more specific error is not available";Gs[Ioe]="Argument was outside of acceptable range";Gs[Moe]="Latitude or longitude arguments were outside of acceptable range";Gs[j6]="Resolution argument was outside of acceptable range";Gs[Poe]="Cell argument was not valid";Gs[Roe]="Directed edge argument was not valid";Gs[Foe]="Undirected edge argument was not valid";Gs[Doe]="Vertex argument was not valid";Gs[Ooe]="Pentagon distortion was encountered";Gs[Loe]="Duplicate input";Gs[Noe]="Cell arguments were not neighbors";Gs[koe]="Cell arguments had incompatible resolutions";Gs[Uoe]="Memory allocation failed";Gs[zoe]="Bounds of provided memory were insufficient";Gs[Goe]="Mode or flags argument was not valid";var Sw=1e3,J6=1001,W6=1002,Ay={};Ay[Sw]="Unknown unit";Ay[J6]="Array length out of bounds";Ay[W6]="Got unexpected null value for H3 index";var Voe="Unknown error";function X6(r,e,t){var n=t&&"value"in t,i=new Error((r[e]||Voe)+" (code: "+e+(n?", value: "+t.value:"")+")");return i.code=e,i}function $6(r,e){var t=arguments.length===2?{value:e}:{};return X6(Gs,r,t)}function py(r,e){var t=arguments.length===2?{value:e}:{};return X6(Ay,r,t)}function so(r){if(r!==0)throw $6(r)}var Qn={};Toe.forEach(function(e){Qn[e[0]]=Rr.cwrap.apply(Rr,e)});var Ud=16,AA=4,LM=4,Qc=8,Iw=8,Hu=Qn.sizeOfH3Index(),Mw=Qn.sizeOfLatLng(),Hoe=Qn.sizeOfCellBoundary(),joe=Qn.sizeOfGeoPolygon(),Hp=Qn.sizeOfGeoLoop(),Joe=Qn.sizeOfLinkedGeoPolygon();Qn.sizeOfCoordIJ();var Qd={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function K6(r){if(typeof r!="number"||r<0||r>15||Math.floor(r)!==r)throw $6(j6,r);return r}function q6(r){if(!r)throw py(W6);return r}var Woe=Math.pow(2,32)-1;function Z6(r){if(r>Woe)throw py(J6,r);return r}var Xoe=/[^0-9a-fA-F]/;function uc(r){if(Array.isArray(r)&&r.length===2&&Number.isInteger(r[0])&&Number.isInteger(r[1]))return r;if(typeof r!="string"||Xoe.test(r))return[0,0];var e=parseInt(r.substring(0,r.length-8),Ud),t=parseInt(r.substring(r.length-8),Ud);return[t,e]}function NM(r){if(r>=0)return r.toString(Ud);r=r&2147483647;var e=Y6(8,r.toString(Ud)),t=(parseInt(e[0],Ud)+8).toString(Ud);return e=t+e.substring(1),e}function $oe(r,e){return NM(e)+Y6(8,NM(r))}function Y6(r,e){for(var t=r-e.length,n="",i=0;i<t;i++)n+="0";return n=n+e,n}function kM(r,e,t){for(var n=r.length,i=Rr._calloc(n,Mw),o=t?1:0,s=t?0:1,c=0;c<n*2;c+=2)Rr.HEAPF64.set([r[c/2][o],r[c/2][s]].map(n4),i/Qc+c);return Rr.HEAPU32.set([n,i],e/AA),e}function Koe(r,e){var t=r.length-1,n=Rr._calloc(joe),i=0,o=i+Hp,s=o+AA;kM(r[0],n+i,e);var c;if(t>0){c=Rr._calloc(t,Hp);for(var f=0;f<t;f++)kM(r[f+1],c+Hp*f,e)}return Rr.setValue(n+o,t,"i32"),Rr.setValue(n+s,c,"i32"),n}function qoe(r){var e=0,t=e+Hp,n=t+AA,i=AA;Rr._free(Rr.getValue(r+e+i,"i8*"));var o=Rr.getValue(r+t,"i32");if(o>0){for(var s=Rr.getValue(r+n,"i32"),c=0;c<o;c++)Rr._free(Rr.getValue(s+Hp*c+i,"i8*"));Rr._free(s)}Rr._free(r)}function Pw(r,e){e===void 0&&(e=0);var t=Rr.getValue(r+Hu*e,"i32"),n=Rr.getValue(r+Hu*e+AA,"i32");return n?$oe(t,n):null}function Q6(r,e){return e===void 0&&(e=0),Rr.getValue(r+Qc*e,"double")}function Rw(r){return Qn.readInt64AsDoubleFromPointer(r)}function Zoe(r,e,t){Rr.HEAPU32.set(uc(r),e/AA+2*t)}function Fw(r,e){for(var t=[],n=0;n<e;n++){var i=Pw(r,n);i!==null&&t.push(i)}return t}function Yoe(r,e){for(var t=e.length,n=0;n<t;n++)Zoe(e[n],r,n)}function A_(r){return uae(Rr.getValue(r,"double"))}function e4(r){return[A_(r),A_(r+Qc)]}function t4(r){return[A_(r+Qc),A_(r)]}function Qoe(r,e,t){for(var n=Rr.getValue(r,"i32"),i=r+Qc,o=[],s=e?t4:e4,c=0;c<n*2;c+=2)o.push(s(i+Qc*c));return t&&o.push(o[0]),o}function eae(r,e){for(var t=[],n=t4,i,o,s,c;r;){for(t.push(i=[]),o=Rr.getValue(r,"i8*");o;){for(i.push(s=[]),c=Rr.getValue(o,"i8*");c;)s.push(n(c)),c=Rr.getValue(c+Qc*2,"i8*");s.push(s[0]),o=Rr.getValue(o+LM*2,"i8*")}r=Rr.getValue(r+LM*2,"i8*")}return t}function tae(r){var e=uc(r),t=e[0],n=e[1];return!!Qn.isPentagon(t,n)}function H2(r){var e=uc(r),t=e[0],n=e[1];return Qn.isValidCell(t,n)?Qn.getResolution(t,n):-1}function Dw(r,e,t){var n=Rr._malloc(Mw);Rr.HEAPF64.set([r,e].map(n4),n/Qc);var i=Rr._malloc(Hu);try{return so(Qn.latLngToCell(n,t,i)),q6(Pw(i))}finally{Rr._free(i),Rr._free(n)}}function Ow(r){var e=Rr._malloc(Mw),t=uc(r),n=t[0],i=t[1];try{return so(Qn.cellToLatLng(n,i,e)),e4(e)}finally{Rr._free(e)}}function r4(r,e){var t=Rr._malloc(Hoe),n=uc(r),i=n[0],o=n[1];try{return so(Qn.cellToBoundary(i,o,t)),Qoe(t,e,e)}finally{Rr._free(t)}}function rae(r,e){var t=uc(r),n=t[0],i=t[1],o=Rr._malloc(Hu);try{return so(Qn.cellToParent(n,i,e,o)),q6(Pw(o))}finally{Rr._free(o)}}function nae(r,e){var t=uc(r),n=t[0],i=t[1],o=Rr._malloc(Iw);try{so(Qn.maxGridDiskSize(e,o));var s=Z6(Rw(o)),c=Rr._calloc(s,Hu);try{return so(Qn.gridDisk(n,i,e,c)),Fw(c,s)}finally{Rr._free(c)}}finally{Rr._free(o)}}function iae(r,e,t){if(K6(e),t=!!t,r.length===0||r[0].length===0)return[];var n=typeof r[0][0]=="number"?[r]:r,i=Koe(n,t),o=Rr._malloc(Iw);try{so(Qn.maxPolygonToCellsSize(i,e,0,o));var s=Z6(Rw(o)),c=Rr._calloc(s,Hu);try{return so(Qn.polygonToCells(i,e,0,c)),Fw(c,s)}finally{Rr._free(c)}}finally{Rr._free(o),qoe(i)}}function sae(r,e){if(!r||!r.length)return[];var t=r.length,n=Rr._calloc(t,Hu);Yoe(n,r);var i=Rr._calloc(Joe);try{return so(Qn.cellsToLinkedMultiPolygon(n,t,i)),eae(i,e)}finally{Qn.destroyLinkedMultiPolygon(i),Rr._free(i),Rr._free(n)}}function oae(r){var e=uc(r),t=e[0],n=e[1],i=6,o=Rr._calloc(i,Hu);try{return so(Qn.originToDirectedEdges(t,n,o)),Fw(o,i)}finally{Rr._free(o)}}function aae(r,e){var t=uc(r),n=t[0],i=t[1],o=uc(e),s=o[0],c=o[1],f=Rr._malloc(Iw);try{return so(Qn.gridDistance(n,i,s,c,f)),Rw(f)}finally{Rr._free(f)}}function cae(r,e){var t=uc(r),n=t[0],i=t[1],o=Rr._malloc(Qc);try{switch(e){case Qd.m:so(Qn.edgeLengthM(n,i,o));break;case Qd.km:so(Qn.edgeLengthKm(n,i,o));break;case Qd.rads:so(Qn.edgeLengthRads(n,i,o));break;default:throw py(Sw,e)}return Q6(o)}finally{Rr._free(o)}}function lae(r,e){K6(r);var t=Rr._malloc(Qc);try{switch(e){case Qd.m:so(Qn.getHexagonEdgeLengthAvgM(r,t));break;case Qd.km:so(Qn.getHexagonEdgeLengthAvgKm(r,t));break;default:throw py(Sw,e)}return Q6(t)}finally{Rr._free(t)}}function n4(r){return r*Math.PI/180}function uae(r){return r*180/Math.PI}function Lw(r,e){e=e===void 0?r[0][0]:e;for(const t of r){const n=t[0]-e;n>180?t[0]-=360:n<-180&&(t[0]+=360)}}function fae(r,e,t){const[n,i]=Ow(r),o=e.length;Lw(e,i);const s=e[0]===e[o-1]?o-1:o;for(let c=0;c<s;c++)e[c][0]=ac(i,e[c][0],t),e[c][1]=ac(n,e[c][1],t)}function hae(r,e,t){const n=r(e,t),[i,o]=Ow(n);return[o,i]}function UM(r,e=1){const t=r4(r,!0);return e!==1?fae(r,t,e):Lw(t),t}function dae(r){const e=new Float64Array(r.length*2);let t=0;for(const n of r)e[t++]=n[0],e[t++]=n[1];return e}const Aae=10;function pae(r,e){let t;return r==null?t=e:typeof r=="object"?t={...r,coverage:e}:t={getHexagon:r,coverage:e},t}const gae={...Yu.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:r=>r.hexagon},extruded:!0};class tl extends gs{initializeState(){tl._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:t}){if(e.highPrecision!==!0&&(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagon)){const n=this._calculateH3DataProps();this.setState(n)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,t=!1,n=!1;const{iterable:i,objectInfo:o}=el(this.props.data);for(const s of i){o.index++;const c=this.props.getHexagon(s,o),f=H2(c);if(e<0){if(e=f,!this.props.highPrecision)break}else if(e!==f){n=!0;break}if(tae(c)){t=!0;break}}return{resolution:e,edgeLengthKM:e>=0?lae(e,"km"):0,hasMultipleRes:n,hasPentagon:t}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:t,hasMultipleRes:n}=this.state,{viewport:i}=this.context;return!!(i!=null&&i.resolution)||n||t||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:t,edgeLengthKM:n,centerHex:i}=this.state;if(t<0)return;const o=this.props.centerHexagon||Dw(e.latitude,e.longitude,t);if(i===o)return;if(i)try{if(aae(i,o)*n<Aae)return}catch{}const{unitsPerMeter:s}=e.distanceScales;let c=UM(o);const[f,g]=Ow(o),[b,T]=e.projectFlat([g,f]);c=c.map(S=>{const F=e.projectFlat(S);return[(F[0]-b)/s[0],(F[1]-T)/s[1]]}),this.setState({centerHex:o,vertices:c})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:t,coverage:n,extruded:i,wireframe:o,stroked:s,filled:c,lineWidthUnits:f,lineWidthScale:g,lineWidthMinPixels:b,lineWidthMaxPixels:T,getFillColor:S,getElevation:F,getLineColor:k,getLineWidth:U,transitions:j,updateTriggers:z}=this.props;return{elevationScale:e,extruded:i,coverage:n,wireframe:o,stroked:s,filled:c,lineWidthUnits:f,lineWidthScale:g,lineWidthMinPixels:b,lineWidthMaxPixels:T,material:t,getElevation:F,getFillColor:S,getLineColor:k,getLineWidth:U,transitions:j,updateTriggers:{getFillColor:z.getFillColor,getElevation:z.getElevation,getLineColor:z.getLineColor,getLineWidth:z.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:t,updateTriggers:n,coverage:i}=this.props,o=this.getSubLayerClass("hexagon-cell-hifi",Yu),s=this._getForwardProps();return s.updateTriggers.getPolygon=pae(n.getHexagon,i),new o(s,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:s.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(c,f)=>{const g=t(c,f);return dae(UM(g,i))}})}_renderColumnLayer(){const{data:e,getHexagon:t,updateTriggers:n}=this.props,i=this.getSubLayerClass("hexagon-cell",Jl),o=this._getForwardProps();return o.updateTriggers.getPosition=n.getHexagon,new i(o,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:o.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:hae.bind(null,t)})}}tl.defaultProps=gae;tl.layerName="H3HexagonLayer";tl._checkH3Lib=()=>{};const mae={getHexagons:{type:"accessor",value:r=>r.hexagons}};class gy extends Qu{initializeState(){tl._checkH3Lib()}updateState({props:e,changeFlags:t}){if(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagons){const{data:n,getHexagons:i}=e,o=[],{iterable:s,objectInfo:c}=el(n);for(const f of s){c.index++;const g=i(f,c),b=sae(g,!0);for(const T of b){for(const S of T)Lw(S);o.push(this.getSubLayerRow({polygon:T},f,c.index))}}this.setState({polygons:o})}}indexToBounds(){const{getElevation:e,getFillColor:t,getLineColor:n,getLineWidth:i}=this.props;return{data:this.state.polygons,getPolygon:o=>o.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(t),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(i)}}}gy.layerName="H3ClusterLayer";gy.defaultProps=mae;const D1=Math.PI/180,X0=new Float32Array(16),zM=new Float32Array(12);function GM(r,e,t){const n=e[0]*D1,i=e[1]*D1,o=e[2]*D1,s=Math.sin(o),c=Math.sin(n),f=Math.sin(i),g=Math.cos(o),b=Math.cos(n),T=Math.cos(i),S=t[0],F=t[1],k=t[2];r[0]=S*T*b,r[1]=S*f*b,r[2]=S*-c,r[3]=F*(-f*g+T*c*s),r[4]=F*(T*g+f*c*s),r[5]=F*b*s,r[6]=k*(f*s+T*c*g),r[7]=k*(-T*s+f*c*g),r[8]=k*b*g}function VM(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}const i4={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,{startRow:e,endRow:t}){const{data:n,getOrientation:i,getScale:o,getTranslation:s,getTransformMatrix:c}=this.props,f=Array.isArray(c),g=f&&c.length===16,b=Array.isArray(o),T=Array.isArray(i),S=Array.isArray(s),F=g||!f&&!!c(n[0]);F?r.constant=g:r.constant=T&&b&&S;const k=r.value;if(r.constant){let U;F?(X0.set(c),U=VM(X0)):(U=zM,GM(U,i,o),U.set(s,9)),r.value=new Float32Array(U)}else{let U=e*r.size;const{iterable:j,objectInfo:z}=el(n,e,t);for(const V of j){z.index++;let K;if(F)X0.set(g?c:c(V,z)),K=VM(X0);else{K=zM;const fe=T?i:i(V,z),Q=b?o:o(V,z);GM(K,fe,Q),K.set(S?s:s(V,z),9)}k[U++]=K[0],k[U++]=K[1],k[U++]=K[2],k[U++]=K[3],k[U++]=K[4],k[U++]=K[5],k[U++]=K[6],k[U++]=K[7],k[U++]=K[8],k[U++]=K[9],k[U++]=K[10],k[U++]=K[11]}}}};function s4(r,e){return e===Wr.CARTESIAN||e===Wr.METER_OFFSETS||e===Wr.DEFAULT&&!r.isGeospatial}const _ae=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,yae=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function O1(r){const e=r.positions||r.POSITION;Ur.assert(e,'no "postions" or "POSITION" attribute in mesh');const t=e.value.length/e.size;let n=r.COLOR_0||r.colors;n||(n={size:3,value:new Float32Array(t*3).fill(1)});let i=r.NORMAL||r.normals;i||(i={size:3,value:new Float32Array(t*3).fill(0)});let o=r.TEXCOORD_0||r.texCoords;return o||(o={size:2,value:new Float32Array(t*2).fill(0)}),{positions:e,colors:n,normals:i,texCoords:o}}function HM(r){return r instanceof Ts?(r.attributes=O1(r.attributes),r):r.attributes?new Ts({...r,topology:"triangle-list",attributes:O1(r.attributes)}):new Ts({topology:"triangle-list",attributes:O1(r)})}const vae=[0,0,0,255],bae={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:vae},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class Yf extends cs{getShaders(){return super.getShaders({vs:_ae,fs:yae,modules:[_o,hD,Fo]})}getBounds(){var n;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:t}=this.props;if(!t)return null;if(e=(n=t.header)==null?void 0:n.boundingBox,!e){const{attributes:i}=HM(t);i.POSITION=i.POSITION||i.positions,e=pF(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:i4}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var o;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e;if(t.mesh!==n.mesh||i.extensionsChanged){if(this.state.positionBounds=null,(o=this.state.model)==null||o.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const s=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(s.NORMAL||s.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==n.texture&&t.texture instanceof ea&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:t}=this.state;if(!t)return;const{viewport:n,renderPass:i}=this.context,{sizeScale:o,coordinateSystem:s,_instanced:c}=this.props;t.setUniforms(e),t.setUniforms({sizeScale:o,composeModelMatrix:!c||s4(n,s),flatShading:!this.state.hasNormals}),t.draw(i)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const t=new mi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:HM(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state;return t.setBindings({sampler:n||i}),t.setUniforms({hasTexture:!!n}),t}setTexture(e){const{emptyTexture:t,model:n}=this.state;n&&(n.setBindings({sampler:e||t}),n.setUniforms({hasTexture:!!e}))}}Yf.defaultProps=bae;Yf.layerName="SimpleMeshLayer";var ec;(function(r){r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.ONE=1]="ONE",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.LINEAR=9729]="LINEAR",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(ec||(ec={}));function o4(r,e,t,n){const i={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};i.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:o}=n;return o&&(i.bindings.u_DiffuseEnvSampler=o.diffuseEnvSampler,i.bindings.u_SpecularEnvSampler=o.specularEnvSampler,i.bindings.u_brdfLUT=o.brdfLutTexture,i.uniforms.u_ScaleIBLAmbient=[1,1]),n!=null&&n.pbrDebug&&(i.defines.PBR_DEBUG=1,i.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],i.uniforms.u_ScaleFGDSpec=[0,0,0,0]),t.NORMAL&&(i.defines.HAS_NORMALS=1),t.TANGENT&&(n!=null&&n.useTangents)&&(i.defines.HAS_TANGENTS=1),t.TEXCOORD_0&&(i.defines.HAS_UV=1),n!=null&&n.imageBasedLightingEnvironment&&(i.defines.USE_IBL=1),n!=null&&n.lights&&(i.defines.USE_LIGHTS=1),e&&xae(r,e,i),i}function xae(r,e,t){if(t.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&wae(r,e.pbrMetallicRoughness,t),e.normalTexture){jp(r,e.normalTexture,"u_NormalSampler","HAS_NORMALMAP",t);const{scale:n=1}=e.normalTexture;t.uniforms.u_NormalScale=n}if(e.occlusionTexture){jp(r,e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",t);const{strength:n=1}=e.occlusionTexture;t.uniforms.u_OcclusionStrength=n}switch(e.emissiveTexture&&(jp(r,e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",t),t.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:n=.5}=e;t.defines.ALPHA_CUTOFF=1,t.uniforms.u_AlphaCutoff=n;break;case"BLEND":Zt.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),t.parameters.blendColorOperation="add",t.parameters.blendColorSrcFactor="src-alpha",t.parameters.blendColorDstFactor="one-minus-src-alpha",t.parameters.blendAlphaOperation="add",t.parameters.blendAlphaSrcFactor="one",t.parameters.blendAlphaDstFactor="one-minus-src-alpha",t.glParameters.blend=!0,t.glParameters.blendEquation=ec.FUNC_ADD,t.glParameters.blendFunc=[ec.SRC_ALPHA,ec.ONE_MINUS_SRC_ALPHA,ec.ONE,ec.ONE_MINUS_SRC_ALPHA];break}}function wae(r,e,t){e.baseColorTexture&&jp(r,e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",t),t.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&jp(r,e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",t);const{metallicFactor:n=1,roughnessFactor:i=1}=e;t.uniforms.u_MetallicRoughnessValues=[n,i]}function jp(r,e,t,n=null,i){var b,T;const o=((T=(b=e==null?void 0:e.texture)==null?void 0:b.sampler)==null?void 0:T.parameters)||{},s=e.texture.source.image;let c,f={};s.compressed?(c=s,f={[ec.TEXTURE_MIN_FILTER]:s.data.length>1?ec.LINEAR_MIPMAP_NEAREST:ec.LINEAR}):c={data:s};const g=r.createTexture({id:e.uniformName||e.id,parameters:{...o,...f},pixelStore:{[ec.UNPACK_FLIP_Y_WEBGL]:!1},...c});i.bindings[t]=g,n&&(i.defines[n]=1),i.generatedTextures.push(g)}const Cae="4.2.4",p_={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let jM;async function JM(r){Dk(r.modules);const e=Ok("basis");return e||(jM||(jM=Eae(r)),await jM)}async function Eae(r){let e=null,t=null;return[e,t]=await Promise.all([await jf(p_.TRANSCODER,"textures",r),await jf(p_.TRANSCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await Tae(e,t)}function Tae(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:o,initializeBasis:s}=i;s(),n({BasisFile:o})})})}let L1;async function WM(r){const e=r.modules||{};return e.basisEncoder?e.basisEncoder:(L1=L1||Bae(r),await L1)}async function Bae(r){let e=null,t=null;return[e,t]=await Promise.all([await jf(p_.ENCODER,"textures",r),await jf(p_.ENCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await Sae(e,t)}function Sae(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:o,KTX2File:s,initializeBasis:c,BasisEncoder:f}=i;c(),n({BasisFile:o,KTX2File:s,BasisEncoder:f})})})}const ld={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},Iae=["","WEBKIT_","MOZ_"],XM={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let $0=null;function Mae(r){if(!$0){r=r||Pae()||void 0,$0=new Set;for(const e of Iae)for(const t in XM)if(r&&r.getExtension(`${e}${t}`)){const n=XM[t];$0.add(n)}}return $0}function Pae(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var $M,KM,qM,ZM,YM,QM,e3,t3;(function(r){r[r.NONE=0]="NONE",r[r.BASISLZ=1]="BASISLZ",r[r.ZSTD=2]="ZSTD",r[r.ZLIB=3]="ZLIB"})($M||($M={})),function(r){r[r.BASICFORMAT=0]="BASICFORMAT"}(KM||(KM={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC"}(qM||(qM={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.SRGB=1]="SRGB"}(ZM||(ZM={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.LINEAR=1]="LINEAR",r[r.SRGB=2]="SRGB",r[r.ITU=3]="ITU",r[r.NTSC=4]="NTSC",r[r.SLOG=5]="SLOG",r[r.SLOG2=6]="SLOG2"}(YM||(YM={})),function(r){r[r.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",r[r.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(QM||(QM={})),function(r){r[r.RGB=0]="RGB",r[r.RRR=3]="RRR",r[r.GGG=4]="GGG",r[r.AAA=15]="AAA"}(e3||(e3={})),function(r){r[r.RGB=0]="RGB",r[r.RGBA=3]="RGBA",r[r.RRR=4]="RRR",r[r.RRRG=5]="RRRG"}(t3||(t3={}));const Yo=[171,75,84,88,32,50,48,187,13,10,26,10];function Rae(r){const e=new Uint8Array(r);return!(e.byteLength<Yo.length||e[0]!==Yo[0]||e[1]!==Yo[1]||e[2]!==Yo[2]||e[3]!==Yo[3]||e[4]!==Yo[4]||e[5]!==Yo[5]||e[6]!==Yo[6]||e[7]!==Yo[7]||e[8]!==Yo[8]||e[9]!==Yo[9]||e[10]!==Yo[10]||e[11]!==Yo[11])}const Fae={etc1:{basisFormat:0,compressed:!0,format:ld.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:ld.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:ld.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:ld.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:ld.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:ld.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Dae(r,e){if(e.basis.containerFormat==="auto"){if(Rae(r)){const n=await WM(e);return r3(n.KTX2File,r,e)}const{BasisFile:t}=await JM(e);return N1(t,r,e)}switch(e.basis.module){case"encoder":const t=await WM(e);switch(e.basis.containerFormat){case"ktx2":return r3(t.KTX2File,r,e);case"basis":default:return N1(t.BasisFile,r,e)}case"transcoder":default:const{BasisFile:n}=await JM(e);return N1(n,r,e)}}function N1(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),o=[];for(let s=0;s<i;s++){const c=n.getNumLevels(s),f=[];for(let g=0;g<c;g++)f.push(Oae(n,s,g,t));o.push(f)}return o}finally{n.close(),n.delete()}}function Oae(r,e,t,n){const i=r.getImageWidth(e,t),o=r.getImageHeight(e,t),s=r.getHasAlpha(),{compressed:c,format:f,basisFormat:g}=a4(n,s),b=r.getImageTranscodedSizeInBytes(e,t,g),T=new Uint8Array(b);if(!r.transcodeImage(T,e,t,g,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:o,data:T,compressed:c,format:f,hasAlpha:s}}function r3(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),o=[];for(let s=0;s<i;s++){o.push(Lae(n,s,t));break}return[o]}finally{n.close(),n.delete()}}function Lae(r,e,t){const{alphaFlag:n,height:i,width:o}=r.getImageLevelInfo(e,0,0),{compressed:s,format:c,basisFormat:f}=a4(t,n),g=r.getImageTranscodedSizeInBytes(e,0,0,f),b=new Uint8Array(g);if(!r.transcodeImage(b,e,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:i,data:b,compressed:s,levelSize:g,hasAlpha:n,format:c}}function a4(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=Nw()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),Fae[t]}function Nw(){const r=Mae();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const Nae={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Cae,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},c4={...Nae,parse:Dae},kae={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Uae={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class zae{constructor(e){J(this,"name");J(this,"startTime",0);J(this,"playing",!0);J(this,"speed",1);J(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const n=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:i,target:o,path:s})=>{Xae(n,i,o,s),Hae(o,o._node)})}}class Gae{constructor(e){J(this,"animations");this.animations=e.animations.map((t,n)=>{const i=t.name||`Animation-${n}`,o=t.samplers.map(({input:c,interpolation:f="LINEAR",output:g})=>({input:n3(e.accessors[c]),interpolation:f,output:n3(e.accessors[g])})),s=t.channels.map(({sampler:c,target:f})=>({sampler:o[c],target:e.nodes[f.node],path:f.path}));return new zae({name:i,channels:s})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}function n3(r){if(!r._animation){const e=Uae[r.componentType],t=kae[r.type],n=t*r.count,{buffer:i,byteOffset:o}=r.bufferView.data,s=new e(i,o+(r.byteOffset||0),n);if(t===1)r._animation=Array.from(s);else{const c=[];for(let f=0;f<s.length;f+=t)c.push(Array.from(s.slice(f,f+t)));r._animation=c}}return r._animation}const Vae=new dn;function Hae(r,e){if(e.matrix.identity(),r.translation&&e.matrix.translate(r.translation),r.rotation){const t=Vae.fromQuaternion(r.rotation);e.matrix.multiplyRight(t)}r.scale&&e.matrix.scale(r.scale)}const k1=new Yp;function jae(r,e,t,n,i){if(e==="rotation"){k1.slerp({start:t,target:n,ratio:i});for(let o=0;o<k1.length;o++)r[e][o]=k1[o]}else for(let o=0;o<t.length;o++)r[e][o]=i*n[o]+(1-i)*t[o]}function Jae(r,e,{p0:t,outTangent0:n,inTangent1:i,p1:o,tDiff:s,ratio:c}){for(let f=0;f<r[e].length;f++){const g=n[f]*s,b=i[f]*s;r[e][f]=(2*Math.pow(c,3)-3*Math.pow(c,2)+1)*t[f]+(Math.pow(c,3)-2*Math.pow(c,2)+c)*g+(-2*Math.pow(c,3)+3*Math.pow(c,2))*o[f]+(Math.pow(c,3)-Math.pow(c,2))*b}}function Wae(r,e,t){for(let n=0;n<t.length;n++)r[e][n]=t[n]}function Xae(r,{input:e,interpolation:t,output:n},i,o){const s=e[e.length-1],c=r%s,f=e.findIndex(S=>S>=c),g=Math.max(0,f-1);if(!Array.isArray(i[o]))switch(o){case"translation":i[o]=[0,0,0];break;case"rotation":i[o]=[0,0,0,1];break;case"scale":i[o]=[1,1,1];break;default:Zt.warn(`Bad animation path ${o}`)()}jn(i[o].length===n[g].length);const b=e[g],T=e[f];switch(t){case"STEP":Wae(i,o,n[g]);break;case"LINEAR":if(T>b){const S=(c-b)/(T-b);jae(i,o,n[g],n[f],S)}break;case"CUBICSPLINE":if(T>b){const S=(c-b)/(T-b),F=T-b,k=n[3*g+1],U=n[3*g+2],j=n[3*f+0],z=n[3*f+1];Jae(i,o,{p0:k,outTangent0:U,inTangent1:j,p1:z,tDiff:F,ratio:S})}break;default:Zt.warn(`Interpolation ${t} not supported`)();break}}const $ae=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,Kae=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function qae(r,e){const{id:t,geometry:n,material:i,vertexCount:o,materialOptions:s,modelOptions:c}=e,f=o4(r,i,n.attributes,s);Zt.info(4,"createGLTFModel defines: ",f.defines)();const g=[],b={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},T={id:t,geometry:n,topology:n.topology,vertexCount:o,modules:[Ox],vs:i3(r,$ae),fs:i3(r,Kae),...c,bindings:{...f.bindings,...c.bindings},defines:{...f.defines,...c.defines},parameters:{...b,...f.parameters,...c.parameters},uniforms:{...f.uniforms,...c.uniforms}},S=new mi(r,T);return new t2({managedResources:g,model:S})}function i3(r,e){return`#version 300 es
${e}`}const Zae={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Yae{constructor(e,t={}){J(this,"device");J(this,"options");J(this,"gltf");this.device=e,this.options={...Zae,...t}}instantiate(e){return this.gltf=e,(e.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new Gae(this.gltf):null}createScene(e){const n=(e.nodes||[]).map(o=>this.createNode(o));return new Wd({id:e.name||e.id,children:n})}createNode(e){if(!e._node){const n=(e.children||[]).map(o=>this.createNode(o));e.mesh&&n.push(this.createMesh(e.mesh));const i=new Wd({id:e.name||e.id,children:n});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){const o=new dn().fromQuaternion(e.rotation);i.matrix.multiplyRight(o)}e.scale&&i.matrix.scale(e.scale)}e._node=i}return e._node}createMesh(e){if(!e._mesh){const n=(e.primitives||[]).map((o,s)=>this.createPrimitive(o,s,e)),i=new Wd({id:e.name||e.id,children:n});e._mesh=i}return e._mesh}createPrimitive(e,t,n){const i=e.name||`${n.name||n.id}-primitive-${t}`,o=Qae(e.mode||4),s=e.indices?e.indices.count:this.getVertexCount(e.attributes),c=qae(this.device,{id:i,geometry:this.createGeometry(i,e,o),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:s});return c.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],c}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,t,n){const i={};for(const[o,s]of Object.entries(t.attributes)){const{components:c,size:f,value:g}=s;i[o]={size:f??c,value:g}}return new Ts({id:e,topology:n,indices:t.indices.value,attributes:i})}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:n}=e;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[t]||(n.lumaBuffers[t]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||e.value})),n.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}}var Sl;(function(r){r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Sl||(Sl={}));function Qae(r){switch(r){case Sl.POINTS:return"point-list";case Sl.LINES:return"line-list";case Sl.LINE_STRIP:return"line-strip";case Sl.LINE_LOOP:return"line-loop-webgl";case Sl.TRIANGLES:return"triangle-list";case Sl.TRIANGLE_STRIP:return"triangle-strip";case Sl.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(r)}}function ece(r,e,t){const n=new Yae(r,t),i=n.instantiate(e),o=n.createAnimator();return{scenes:i,animator:o}}function ra(r,e){if(!r)throw new Error(e||"assert failed: gltf")}const l4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},u4={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},s3=["SCALAR","VEC2","VEC3","VEC4"],tce=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],rce=new Map(tce),nce={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ice={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},sce={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function f4(r){return s3[r-1]||s3[0]}function kw(r){const e=rce.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function Uw(r,e){const t=sce[r.componentType],n=nce[r.type],i=ice[r.componentType],o=r.count*n,s=r.count*n*i;ra(s>=0&&s<=e.byteLength);const c=u4[r.componentType],f=l4[r.type];return{ArrayType:t,length:o,byteLength:s,componentByteSize:c,numberOfComponentsInElement:f}}function oce(r,e,t){const n=r.bufferViews[t];ra(n);const i=n.buffer,o=e[i];ra(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function ace(r,e,t){var U,j;const n=typeof t=="number"?(U=r.accessors)==null?void 0:U[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(j=r.bufferViews)==null?void 0:j[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],c=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:f,length:g,componentByteSize:b,numberOfComponentsInElement:T}=Uw(n,i),S=b*T,F=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new f(o,c,g);const k=new f(g);for(let z=0;z<n.count;z++){const V=new f(o,c+z*F,T);k.set(V,z*T)}return k}function cce(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let oo=class{constructor(e){J(this,"gltf");J(this,"sourceBuffers");J(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||cce(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];ra(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return ace(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(i,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e,t={}){return ra(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return ra(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:o=4}=e,c={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(n){const f=this._addIndices(n);c.primitives[0].indices=f}return Number.isFinite(i)&&(c.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=V_(e),i=t||(n==null?void 0:n.mimeType),s={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const i=e.byteLength;ra(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=Gl(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:f4(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:kw(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var o,s;this.gltf.buffers=[];const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const c of this.sourceBuffers||[])i=QR(c,n,i);(s=(o=this.json)==null?void 0:o.buffers)!=null&&s[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const i=e[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);t[o]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const o of i)n.min.push(o),n.max.push(o);for(let o=t;o<e.length;o+=t)for(let s=0;s<t;s++)n.min[0+s]=Math.min(n.min[0+s],e[o+s]),n.max[0+s]=Math.max(n.max[0+s],e[o+s]);return n}};function o3(r){return(r%1+1)%1}const h4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},lce={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},d4={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function zw(r,e){return d4[e]*h4[r]}function my(r,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=r.getTypedArrayForBufferView(e),o=_y(i,"SCALAR",t,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function _y(r,e,t,n=1){const i=h4[e],o=lce[t],s=d4[t],c=n*i,f=c*s;let g=r.buffer,b=r.byteOffset;return b%s!==0&&(g=new Uint8Array(g).slice(b,b+f).buffer,b=0),new o(g,b,c)}function Gw(r,e,t){var g,b,T,S,F;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],o=r.getTypedArrayForAccessor(i),s=r.gltf.json,c=e.index,f=(b=(g=s.textures)==null?void 0:g[c])==null?void 0:b.source;if(typeof f<"u"){const k=(S=(T=s.images)==null?void 0:T[f])==null?void 0:S.mimeType,U=(F=r.gltf.images)==null?void 0:F[f];if(U&&typeof U.width<"u"){const j=[];for(let z=0;z<o.length;z+=2){const V=uce(U,k,o,z,e.channels);j.push(V)}return j}}return[]}function A4(r,e,t,n,i){if(!(t!=null&&t.length))return;const o=[];for(const b of t){let T=n.findIndex(S=>S===b);T===-1&&(T=n.push(b)-1),o.push(T)}const s=new Uint32Array(o),c=r.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,f=r.addBufferView(s,c,0),g=r.addAccessor(f,{size:1,componentType:kw(s),count:s.length});i.attributes[e]=g}function uce(r,e,t,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=t[n],c=t[n+1];let f=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(f=4);const g=fce(s,c,r,f);let b=0;for(const T of i){const S=typeof T=="number"?Object.values(o)[T]:o[T],F=g+S.offset,k=yx(r);if(k.data.length<=F)throw new Error(`${k.data.length} <= ${F}`);const U=k.data[F];b|=U<<S.shift}return b}function fce(r,e,t,n=1){const i=t.width,o=o3(r)*(i-1),s=Math.round(o),c=t.height,f=o3(e)*(c-1),g=Math.round(f),b=t.components?t.components:n;return(g*i+s)*b}function p4(r,e,t,n,i){const o=[];for(let s=0;s<e;s++){const c=t[s],f=t[s+1]-t[s];if(f+c>n)break;const g=c/i,b=f/i;o.push(r.slice(g,g+b))}return o}function g4(r,e,t){const n=[];for(let i=0;i<e;i++){const o=i*t;n.push(r.slice(o,o+t))}return n}function m4(r,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let c=0;c<r;c++){const f=n[c+1]-n[c];if(f+s<=e.length){const g=e.subarray(s,f+s),b=o.decode(g);i.push(b),s+=f}}return i}return[]}const _4="EXT_mesh_features",hce=_4;async function dce(r,e){const t=new oo(r);Ace(t,e)}function Ace(r,e){const t=r.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)pce(r,i,e)}function pce(r,e,t){var o,s,c;if(!((o=t==null?void 0:t.gltf)!=null&&o.loadBuffers))return;const n=(s=e.extensions)==null?void 0:s[_4],i=n==null?void 0:n.featureIds;if(i)for(const f of i){let g;if(typeof f.attribute<"u"){const b=`_FEATURE_ID_${f.attribute}`,T=e.attributes[b];g=r.getTypedArrayForAccessor(T)}else typeof f.texture<"u"&&((c=t==null?void 0:t.gltf)!=null&&c.loadImages)?g=Gw(r,f.texture,e):g=[];f.data=g}}const gce=Object.freeze(Object.defineProperty({__proto__:null,decode:dce,name:hce},Symbol.toStringTag,{value:"Module"})),Vw="EXT_structural_metadata",mce=Vw;async function _ce(r,e){const t=new oo(r);yce(t,e)}function yce(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(Vw);t&&((i=e.gltf)!=null&&i.loadImages&&vce(r,t),bce(r,t))}function vce(r,e){const t=e.propertyTextures,n=r.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)wce(r,t,o,e)}function bce(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=xce(i,o);s&&Ece(r,t,s)}}function xce(r,e){for(const t of r)if(t.class===e)return t;return null}function wce(r,e,t,n){var s;if(!e)return;const i=(s=t.extensions)==null?void 0:s[Vw],o=i==null?void 0:i.propertyTextures;if(o)for(const c of o){const f=e[c];Cce(r,f,t,n)}}function Cce(r,e,t,n){var o;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const s in e.properties){const c=`${i}_${s}`,f=(o=e.properties)==null?void 0:o[s];if(!f)continue;f.data||(f.data=[]);const g=f.data,b=Gw(r,f,t);b!==null&&(A4(r,c,b,g,t),f.data=g,n.dataAttributeNames.push(c))}}function Ece(r,e,t){var o,s;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],g=(s=t.properties)==null?void 0:s[c];if(g){const b=Tce(r,e,f,i,g);g.data=b}}}function Tce(r,e,t,n,i){let o=[];const s=i.values,c=r.getTypedArrayForBufferView(s),f=Bce(r,t,i,n),g=Sce(r,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=Ice(t,n,c,f);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{o=m4(n,c,f,g);break}case"ENUM":{o=Mce(e,t,n,c,f);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return o}function Bce(r,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?my(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function Sce(r,e,t){return typeof e.stringOffsets<"u"?my(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function Ice(r,e,t,n){const i=r.array,o=r.count,s=zw(r.type,r.componentType),c=t.byteLength/s;let f;return r.componentType?f=_y(t,r.type,r.componentType,c):f=t,i?n?p4(f,e,n,t.length,s):o?g4(f,e,o):[]:f}function Mce(r,e,t,n,i){var T;const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=(T=r.enums)==null?void 0:T[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const c=s.valueType||"UINT16",f=zw(e.type,c),g=n.byteLength/f;let b=_y(n,e.type,c,g);if(b||(b=n),e.array){if(i)return Pce({valuesData:b,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:f,enumEntry:s});const S=e.count;return S?Rce(b,t,S,s):[]}return Hw(b,0,t,s)}function Pce(r){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=r,c=[];for(let f=0;f<t;f++){const g=n[f],b=n[f+1]-n[f];if(b+g>i)break;const T=g/o,S=b/o,F=Hw(e,T,S,s);c.push(F)}return c}function Rce(r,e,t,n){const i=[];for(let o=0;o<e;o++){const s=t*o,c=Hw(r,s,t,n);i.push(c)}return i}function Hw(r,e,t,n){const i=[];for(let o=0;o<t;o++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)i.push("");else{const s=r[e+o],c=Fce(n,s);c?i.push(c.name):i.push("")}return i}function Fce(r,e){for(const t of r.values)if(t.value===e)return t;return null}const Dce=Object.freeze(Object.defineProperty({__proto__:null,decode:_ce,name:mce},Symbol.toStringTag,{value:"Module"})),y4="EXT_feature_metadata",Oce=y4;async function Lce(r,e){const t=new oo(r);Nce(t,e)}function Nce(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(y4);t&&((i=e.gltf)!=null&&i.loadImages&&kce(r,t),Uce(r,t))}function kce(r,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],c=Gce(i,o);c&&Hce(r,c,s)}}function Uce(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=zce(i,o);s&&Vce(r,t,s)}}function zce(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function Gce(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function Vce(r,e,t){var o,s;if(!t.class)return;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],g=(s=t.properties)==null?void 0:s[c];if(g){const b=jce(r,e,f,i,g);g.data=b}}}function Hce(r,e,t){var i;const n=e.class;for(const o in t.properties){const s=(i=e==null?void 0:e.properties)==null?void 0:i[o];if(s){const c=Kce(r,s,n);s.data=c}}}function jce(r,e,t,n,i){let o=[];const s=i.bufferView,c=r.getTypedArrayForBufferView(s),f=Jce(r,t,i,n),g=Wce(r,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?o=m4(n,c,f,g):Xce(t)&&(o=$ce(t,n,c,f)),o}function Jce(r,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?my(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function Wce(r,e,t,n){return typeof t.stringOffsetBufferView<"u"?my(r,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function Xce(r){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function $ce(r,e,t,n){const i=r.type==="ARRAY",o=r.componentCount,s="SCALAR",c=r.componentType||r.type,f=zw(s,c),g=t.byteLength/f,b=_y(t,s,c,g);return i?n?p4(b,e,n,t.length,f):o?g4(b,e,o):[]:b}function Kce(r,e,t){const n=r.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)qce(r,t,e,i,s);return i}function qce(r,e,t,n,i){const o={channels:t.channels,...t.texture},s=Gw(r,o,i);s&&A4(r,e,s,n,i)}const Zce=Object.freeze(Object.defineProperty({__proto__:null,decode:Lce,name:Oce},Symbol.toStringTag,{value:"Module"})),Yce="4.2.4",pA=!0,a3=1735152710,jw=12,g_=8,Qce=1313821514,ele=5130562,tle=0,rle=0,nle=1;function ile(r,e=0){return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function sle(r,e=0,t={}){const n=new DataView(r),{magic:i=a3}=t,o=n.getUint32(e,!1);return o===i||o===a3}function ole(r,e,t=0,n={}){const i=new DataView(e),o=ile(i,t+0),s=i.getUint32(t+4,pA),c=i.getUint32(t+8,pA);switch(Object.assign(r,{header:{byteOffset:t,byteLength:c,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),t+=jw,r.version){case 1:return ale(r,i,t);case 2:return cle(r,i,t,n={});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function ale(r,e,t){$n(r.header.byteLength>jw+g_);const n=e.getUint32(t+0,pA),i=e.getUint32(t+4,pA);return t+=g_,$n(i===tle),j2(r,e,t,n),t+=n,t+=J2(r,e,t,r.header.byteLength),t}function cle(r,e,t,n){return $n(r.header.byteLength>jw+g_),lle(r,e,t,n),t+r.header.byteLength}function lle(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,pA),o=e.getUint32(t+4,pA);switch(t+=g_,o){case Qce:j2(r,e,t,i);break;case ele:J2(r,e,t,i);break;case rle:n.strict||j2(r,e,t,i);break;case nle:n.strict||J2(r,e,t,i);break}t+=Gl(i,4)}return t}function j2(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),s=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(s),Gl(n,4)}function J2(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),Gl(n,4)}function v4(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return n.substr(0,n.lastIndexOf("/")+1)+r}const ule="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",fle="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",hle=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),dle=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Ale={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ple={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function gle(r,e,t,n,i,o="NONE"){const s=await mle();vle(s,s.exports[ple[i]],r,e,t,n,s.exports[Ale[o||"NONE"]])}let U1;async function mle(){return U1||(U1=_le()),U1}async function _le(){let r=ule;WebAssembly.validate(hle)&&(r=fle,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(yle(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function yle(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?dle[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function vle(r,e,t,n,i,o,s){const c=r.exports.sbrk,f=n+3&-4,g=c(f*i),b=c(o.length),T=new Uint8Array(r.exports.memory.buffer);T.set(o,b);const S=e(g,n,i,b,o.length);if(S===0&&s&&s(g,f,i),t.set(T.subarray(g,g+n*i)),c(g-c(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const m_="EXT_meshopt_compression",ble=m_;async function xle(r,e){var i,o;const t=new oo(r);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((o=e.gltf)!=null&&o.loadBuffers))return;const n=[];for(const s of r.json.bufferViews||[])n.push(wle(t,s));await Promise.all(n),t.removeExtension(m_)}async function wle(r,e){const t=r.getObjectExtension(e,m_);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:c,filter:f="NONE",buffer:g}=t,b=r.gltf.buffers[g],T=new Uint8Array(b.arrayBuffer,b.byteOffset+n,i),S=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await gle(S,s,o,T,c,f),r.removeObjectExtension(e,m_)}}const Cle=Object.freeze(Object.defineProperty({__proto__:null,decode:xle,name:ble},Symbol.toStringTag,{value:"Module"})),Bd="EXT_texture_webp",Ele=Bd;function Tle(r,e){const t=new oo(r);if(!_F("image/webp")){if(t.getRequiredExtensions().includes(Bd))throw new Error(`gltf: Required extension ${Bd} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Bd);o&&(i.source=o.source),t.removeObjectExtension(i,Bd)}t.removeExtension(Bd)}const Ble=Object.freeze(Object.defineProperty({__proto__:null,name:Ele,preprocess:Tle},Symbol.toStringTag,{value:"Module"})),Sm="KHR_texture_basisu",Sle=Sm;function Ile(r,e){const t=new oo(r),{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Sm);o&&(i.source=o.source,t.removeObjectExtension(i,Sm))}t.removeExtension(Sm)}const Mle=Object.freeze(Object.defineProperty({__proto__:null,name:Sle,preprocess:Ile},Symbol.toStringTag,{value:"Module"})),Ple="4.2.4",Rle={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Ple,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Fle(r,e,t){const n=b4(e.metadata),i=[],o=Dle(e.attributes);for(const s in r){const c=r[s],f=c3(s,c,o[s]);i.push(f)}if(t){const s=c3("indices",t);i.push(s)}return{fields:i,metadata:n}}function Dle(r){const e={};for(const t in r){const n=r[t];e[n.name||"undefined"]=n}return e}function c3(r,e,t){const n=t?b4(t.metadata):void 0;return v5(r,e,n)}function b4(r){Object.entries(r);const e={};for(const t in r)e[`${t}.string`]=JSON.stringify(r[t]);return e}const l3={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Ole={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Lle=4;class Nle{constructor(e){J(this,"draco");J(this,"decoder");J(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),o=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(i){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(n,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(n,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){const S=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(S)}const c=this._getDracoLoaderData(o,i,t),f=this._getMeshData(o,c,t),g=pF(f.attributes),b=Fle(f.attributes,c,f.indices);return{loader:"draco",loaderData:c,header:{vertexCount:o.num_points(),boundingBox:g},...f,schema:b}}finally{this.draco.destroy(n),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:o}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const o=this.decoder.GetAttribute(e,i),s=this._getAttributeMetadata(e,i);n[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:i,metadata:s};const c=this._getQuantizationTransform(o,t);c&&(n[o.unique_id()].quantization_transform=c);const f=this._getOctahedronTransform(o,t);f&&(n[o.unique_id()].octahedron_transform=f)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const o of Object.values(e.attributes)){const s=this._deduceAttributeName(o,n);o.name=s;const c=this._getAttributeValues(t,o);if(c){const{value:f,size:g}=c;i[s]={value:f,size:g,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*Lle,o=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,o),new Uint32Array(this.draco.HEAPF32.buffer,o,n).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),zle(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=Ole[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,s=e.num_points()*i,c=s*n.BYTES_PER_ELEMENT,f=kle(this.draco,n);let g;const b=this.draco._malloc(c);try{const T=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,T,f,c,b),g=new n(this.draco.HEAPF32.buffer,b,s).slice()}finally{this.draco._free(b)}return{value:g,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[s,c]of Object.entries(t.extraAttributes||{}))if(c===n)return s;const i=e.attribute_type;for(const s in l3)if(this.draco[s]===i)return l3[s];const o=t.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const o=this.metadataQuerier.GetEntryName(e,i);t[o]=this._getDracoMetadataField(e,o)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=Ule(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const o of i)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(c=>s.min_value(c))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}function kle(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function Ule(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function zle(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}const Gle="1.5.6",Vle="1.4.1",z1=`https://www.gstatic.com/draco/versioned/decoders/${Gle}`,Mo={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},G1={[Mo.DECODER]:`${z1}/${Mo.DECODER}`,[Mo.DECODER_WASM]:`${z1}/${Mo.DECODER_WASM}`,[Mo.FALLBACK_DECODER]:`${z1}/${Mo.FALLBACK_DECODER}`,[Mo.ENCODER]:`https://raw.githubusercontent.com/google/draco/${Vle}/javascript/${Mo.ENCODER}`};let V1;async function Hle(r){const e=r.modules||{};return e.draco3d?V1||(V1=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):V1||(V1=jle(r)),await V1}async function jle(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await jf(G1[Mo.FALLBACK_DECODER],"draco",r,Mo.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await jf(G1[Mo.DECODER],"draco",r,Mo.DECODER),await jf(G1[Mo.DECODER_WASM],"draco",r,Mo.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await Jle(e,t)}function Jle(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r({...t,onModuleLoaded:i=>n({draco:i})})})}const Jw={...Rle,parse:Wle};async function Wle(r,e){const{draco:t}=await Hle(e),n=new Nle(t);try{return n.parseSync(r,e==null?void 0:e.draco)}finally{n.destroy()}}function Xle(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=x4(n);e[t]=i}}return e}function x4(r){const{buffer:e,size:t,count:n}=$le(r);return{value:e,size:t,byteOffset:0,count:n,type:f4(t),componentType:kw(e)}}function $le(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=Kle(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function Kle(r,e,t=!1){return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const ju="KHR_draco_mesh_compression",qle=ju;function Zle(r,e,t){const n=new oo(r);for(const i of w4(n))n.getObjectExtension(i,ju)}async function Yle(r,e,t){var o;if(!((o=e==null?void 0:e.gltf)!=null&&o.decompressMeshes))return;const n=new oo(r),i=[];for(const s of w4(n))n.getObjectExtension(s,ju)&&i.push(eue(n,s,e,t));await Promise.all(i),n.removeExtension(ju)}function Qle(r,e={}){const t=new oo(r);for(const n of t.json.meshes||[])tue(n),t.addRequiredExtension(ju)}async function eue(r,e,t,n){const i=r.getObjectExtension(e,ju);if(!i)return;const o=r.getTypedArrayForBufferView(i.bufferView),s=hg(o.buffer,o.byteOffset),c={...t};delete c["3d-tiles"];const f=await rh(s,Jw,c,n),g=Xle(f.attributes);for(const[b,T]of Object.entries(g))if(b in e.attributes){const S=e.attributes[b],F=r.getAccessor(S);F!=null&&F.min&&(F!=null&&F.max)&&(T.min=F.min,T.max=F.max)}e.attributes=g,f.indices&&(e.indices=x4(f.indices)),r.removeObjectExtension(e,ju),rue(e)}function tue(r,e,t=4,n,i){var b;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:r}),s=(b=i==null?void 0:i.parseSync)==null?void 0:b.call(i,{attributes:r}),c=n._addFauxAttributes(s.attributes),f=n.addBufferView(o);return{primitives:[{attributes:c,mode:t,extensions:{[ju]:{bufferView:f,attributes:c}}}]}}function rue(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*w4(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const nue=Object.freeze(Object.defineProperty({__proto__:null,decode:Yle,encode:Qle,name:qle,preprocess:Zle},Symbol.toStringTag,{value:"Module"})),yy="KHR_texture_transform",iue=yy,K0=new ft,sue=new li,oue=new li;async function aue(r,e){var o;if(!new oo(r).hasExtension(yy)||!((o=e.gltf)!=null&&o.loadBuffers))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)cue(s,r)}function cue(r,e){var o,s,c,f;const t=(o=e.json.materials)==null?void 0:o[r],n=[(s=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:s.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(c=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:c.metallicRoughnessTexture],i=[];for(const g of n)g&&((f=g==null?void 0:g.extensions)!=null&&f[yy])&&lue(e,r,g,i)}function lue(r,e,t,n){const i=uue(t,n);if(!i)return;const o=r.json.meshes||[];for(const s of o)for(const c of s.primitives){const f=c.material;Number.isFinite(f)&&e===f&&fue(r,c,i)}}function uue(r,e){var s;const t=(s=r.extensions)==null?void 0:s[yy],{texCoord:n=0}=r,{texCoord:i=n}=t;if(!(e.findIndex(([c,f])=>c===n&&f===i)!==-1)){const c=Aue(t);return n!==i&&(r.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:c}}return null}function fue(r,e,t){var c,f;const{originalTexCoord:n,texCoord:i,matrix:o}=t,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const g=(c=r.json.accessors)==null?void 0:c[s];if(g&&g.bufferView){const b=(f=r.json.bufferViews)==null?void 0:f[g.bufferView];if(b){const{arrayBuffer:T,byteOffset:S}=r.buffers[b.buffer],F=(S||0)+(g.byteOffset||0)+(b.byteOffset||0),{ArrayType:k,length:U}=Uw(g,b),j=u4[g.componentType],z=l4[g.type],V=b.byteStride||j*z,K=new Float32Array(U);for(let fe=0;fe<g.count;fe++){const Q=new k(T,F+fe*V,2);K0.set(Q[0],Q[1],1),K0.transformByMatrix3(o),K.set([K0[0],K0[1]],fe*z)}n===i?hue(g,b,r.buffers,K):due(i,g,e,r,K)}}}}function hue(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function due(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=s.length-1)}function Aue(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new li().set(1,0,0,0,1,0,e[0],e[1],1),o=sue.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),s=oue.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const pue=Object.freeze(Object.defineProperty({__proto__:null,decode:aue,name:iue},Symbol.toStringTag,{value:"Module"})),Vf="KHR_lights_punctual",gue=Vf;async function mue(r){const e=new oo(r),{json:t}=e,n=e.getExtension(Vf);n&&(e.json.lights=n.lights,e.removeExtension(Vf));for(const i of t.nodes||[]){const o=e.getObjectExtension(i,Vf);o&&(i.light=o.light),e.removeObjectExtension(i,Vf)}}async function _ue(r){const e=new oo(r),{json:t}=e;if(t.lights){const n=e.addExtension(Vf);ra(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,Vf,n)}delete e.json.lights}}const yue=Object.freeze(Object.defineProperty({__proto__:null,decode:mue,encode:_ue,name:gue},Symbol.toStringTag,{value:"Module"})),lg="KHR_materials_unlit",vue=lg;async function bue(r){const e=new oo(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,lg);e.removeExtension(lg)}function xue(r){const e=new oo(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,lg,{}),e.addExtension(lg))}const wue=Object.freeze(Object.defineProperty({__proto__:null,decode:bue,encode:xue,name:vue},Symbol.toStringTag,{value:"Module"})),Mp="KHR_techniques_webgl",Cue=Mp;async function Eue(r){const e=new oo(r),{json:t}=e,n=e.getExtension(Mp);if(n){const i=Bue(n,e);for(const o of t.materials||[]){const s=e.getObjectExtension(o,Mp);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=Sue(o.technique,e)),e.removeObjectExtension(o,Mp)}e.removeExtension(Mp)}}async function Tue(r,e){}function Bue(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=t[s.program]}),i}function Sue(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const Iue=Object.freeze(Object.defineProperty({__proto__:null,decode:Eue,encode:Tue,name:Cue},Symbol.toStringTag,{value:"Module"})),C4=[Dce,gce,Cle,Ble,Mle,nue,yue,wue,Iue,pue,Zce];function Mue(r,e={},t){var i;const n=C4.filter(o=>E4(o.name,e));for(const o of n)(i=o.preprocess)==null||i.call(o,r,e,t)}async function Pue(r,e={},t){var i;const n=C4.filter(o=>E4(o.name,e));for(const o of n)await((i=o.decode)==null?void 0:i.call(o,r,e,t))}function E4(r,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(r in t&&!t[r])}const H1="KHR_binary_glTF";function Rue(r){const e=new oo(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,H1);i&&Object.assign(n,i),e.removeObjectExtension(n,H1)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(H1)}const u3={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Fue={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let Due=class{constructor(){J(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});J(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),Rue(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in u3)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const o=n[i];o.id=o.id||i;const s=e[t].length;e[t].push(o),this.idToIndexMap[t][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in u3)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:o}=t;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const o=n[i],s=this._convertIdToIndex(o,i);n[i]=s}}_convertIdToIndex(e,t){const n=Fue[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const o of e.materials){o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=((t=o.values)==null?void 0:t.tex)||((n=o.values)==null?void 0:n.texture2d_0)||((i=o.values)==null?void 0:i.diffuseTex),c=e.textures.findIndex(f=>f.id===s);c!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:c})}}};function Oue(r,e={}){return new Due().normalize(r,e)}async function Lue(r,e,t=0,n,i){var o,s,c;return Nue(r,e,t,n),Oue(r,{normalize:(o=n==null?void 0:n.gltf)==null?void 0:o.normalize}),Mue(r,n,i),(s=n==null?void 0:n.gltf)!=null&&s.loadBuffers&&r.json.buffers&&await kue(r,n,i),(c=n==null?void 0:n.gltf)!=null&&c.loadImages&&await Uue(r,n,i),await Pue(r,n,i),r}function Nue(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!sle(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=YR(e);else if(e instanceof ArrayBuffer){const s={};t=ole(s,e,t,n.glb),ra(s.type==="glTF",`Invalid GLB magic string ${s.type}`),r._glb=s,r.json=s.json}else ra(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:s}=r._glb;r.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=r.json.images||[];r.images=new Array(o.length).fill({})}async function kue(r,e,t){var i,o;const n=r.json.buffers||[];for(let s=0;s<n.length;++s){const c=n[s];if(c.uri){const{fetch:f}=t;ra(f);const g=v4(c.uri,e),b=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,g)),T=await((o=b==null?void 0:b.arrayBuffer)==null?void 0:o.call(b));r.buffers[s]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete c.uri}else r.buffers[s]===null&&(r.buffers[s]={arrayBuffer:new ArrayBuffer(c.byteLength),byteOffset:0,byteLength:c.byteLength})}}async function Uue(r,e,t){const n=zue(r),i=r.json.images||[],o=[];for(const s of n)o.push(Gue(r,i[s],s,e,t));return await Promise.all(o)}function zue(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function Gue(r,e,t,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const c=v4(e.uri,n),{fetch:f}=i;o=await(await f(c)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const c=oce(r.json,r.buffers,e.bufferView);o=hg(c.buffer,c.byteOffset,c.byteLength)}ra(o,"glTF image has no data");let s=await rh(o,[rA,c4],{...n,mimeType:e.mimeType,basis:n.basis||{format:Nw()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),r.images=r.images||[],r.images[t]=s}const W2={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Yce,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Vue,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Vue(r,e={},t){e={...W2.options,...e},e.gltf={...W2.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await Lue({},r,n,e,t)}const Hue={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},jue={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},va={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Jue={magFilter:va.TEXTURE_MAG_FILTER,minFilter:va.TEXTURE_MIN_FILTER,wrapS:va.TEXTURE_WRAP_S,wrapT:va.TEXTURE_WRAP_T},Wue={[va.TEXTURE_MAG_FILTER]:va.LINEAR,[va.TEXTURE_MIN_FILTER]:va.NEAREST_MIPMAP_LINEAR,[va.TEXTURE_WRAP_S]:va.REPEAT,[va.TEXTURE_WRAP_T]:va.REPEAT};function Xue(){return{id:"default-sampler",parameters:Wue}}function $ue(r){return jue[r]}function Kue(r){return Hue[r]}let que=class{constructor(){J(this,"baseUri","");J(this,"jsonUnprocessed");J(this,"json");J(this,"buffers",[]);J(this,"images",[])}postProcess(e,t={}){const{json:n,buffers:i=[],images:o=[]}=e,{baseUri:s=""}=e;return ra(n),this.baseUri=s,this.buffers=i,this.images=o,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((i,o)=>this._resolveBufferView(i,o))),e.images&&(n.images=e.images.map((i,o)=>this._resolveImage(i,o))),e.samplers&&(n.samplers=e.samplers.map((i,o)=>this._resolveSampler(i,o))),e.textures&&(n.textures=e.textures.map((i,o)=>this._resolveTexture(i,o))),e.accessors&&(n.accessors=e.accessors.map((i,o)=>this._resolveAccessor(i,o))),e.materials&&(n.materials=e.materials.map((i,o)=>this._resolveMaterial(i,o))),e.meshes&&(n.meshes=e.meshes.map((i,o)=>this._resolveMesh(i,o))),e.nodes&&(n.nodes=e.nodes.map((i,o)=>this._resolveNode(i,o)),n.nodes=n.nodes.map((i,o)=>this._resolveNodeChildren(i))),e.skins&&(n.skins=e.skins.map((i,o)=>this._resolveSkin(i,o))),e.scenes&&(n.scenes=e.scenes.map((i,o)=>this._resolveScene(i,o))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,o)=>{const s=this.getMesh(o);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const o={...i,attributes:{},indices:void 0,material:void 0},s=i.attributes;for(const c in s)o.attributes[c]=this.getAccessor(s[c]);return i.indices!==void 0&&(o.indices=this.getAccessor(i.indices)),i.material!==void 0&&(o.material=this.getMaterial(i.material)),o})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=$ue(e.componentType),i=Kue(e.type),o=n*i,s={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:i,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){const c=s.bufferView.buffer,{ArrayType:f,byteLength:g}=Uw(s,s.bufferView),b=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+c.byteOffset;let T=c.arrayBuffer.slice(b,b+g);s.bufferView.byteStride&&(T=this._getValueFromInterleavedBuffer(c,b,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new f(T)}return s}_getValueFromInterleavedBuffer(e,t,n,i,o){const s=new Uint8Array(o*i);for(let c=0;c<o;c++){const f=t+c*n;s.set(new Uint8Array(e.arrayBuffer.slice(f,f+i)),c*i)}return s.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Xue(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const o=this._enumSamplerParameter(i);o!==void 0&&(n.parameters[o]=n[i])}return n}_enumSamplerParameter(e){return Jue[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let o=this.buffers[n].byteOffset||0;return e.byteOffset&&(o+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,o,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}};function Zue(r,e){return new que().postProcess(r,e)}async function Yue(r){const e=[];return r.scenes.forEach(t=>{t.traverse(n=>{Object.values(n.model.uniforms).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await Que(()=>e.some(t=>!t.loaded))}async function Que(r){for(;r();)await new Promise(e=>requestAnimationFrame(e))}const efe=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,tfe=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,T4=[255,255,255,255],rfe={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:T4},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[W2]};class Sg extends cs{getShaders(){const e=[_o,Fo];return this.props._lighting==="pbr"&&e.push(Ox),super.getShaders({vs:efe,fs:tfe,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:T4,transition:!0},instanceModelMatrix:i4})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.scenegraph!==n.scenegraph?this._updateScenegraph():t._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.scenegraph)==null||t.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var c;const e=this.props,{device:t}=this.context;let n=null;if(e.scenegraph instanceof Km)n={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const f=e.scenegraph,g=f.json?Zue(f):f,b=ece(t,g,this._getModelOptions());n={gltf:g,...b},Yue(b).then(()=>{this.setNeedsRedraw()}).catch(T=>{this.raiseError(T,"loading glTF")})}const i={layer:this,device:this.context.device},o=e.getScene(n,i),s=e.getAnimator(n,i);if(o instanceof Wd){(c=this.state.scenegraph)==null||c.destroy(),this._applyAnimationsProp(s,e._animations);const f=[];o.traverse(g=>{g instanceof t2&&f.push(g.model)}),this.setState({scenegraph:o,animator:s,models:f}),this.getAttributeManager().invalidateAll()}else o!==null&&Ur.warn("invalid scenegraph:",o)()}_applyAnimationsProp(e,t){if(!e||!t)return;const n=e.getAnimations();Object.keys(t).sort().forEach(i=>{const o=t[i];if(i==="*")n.forEach(s=>{Object.assign(s,o)});else if(Number.isFinite(Number(i))){const s=Number(i);s>=0&&s<n.length?Object.assign(n[s],o):Ur.warn(`animation ${i} not found`)()}else{const s=n.find(({name:c})=>c===i);s?Object.assign(s,o):Ur.warn(`animation ${i} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:t,renderPass:n}=this.context,{sizeScale:i,sizeMinPixels:o,sizeMaxPixels:s,opacity:c,coordinateSystem:f}=this.props,g=this.getNumInstances();this.state.scenegraph.traverse((b,{worldMatrix:T})=>{if(b instanceof t2){const{model:S}=b;S.setInstanceCount(g),S.setUniforms({sizeScale:i,opacity:c,sizeMinPixels:o,sizeMaxPixels:s,composeModelMatrix:s4(t,f),sceneModelMatrix:T,u_Camera:S.uniforms.project_uCameraPosition}),S.draw(n)}})}}Sg.defaultProps=rfe;Sg.layerName="ScenegraphLayer";const nfe=Object.freeze(Object.defineProperty({__proto__:null,ScenegraphLayer:Sg,SimpleMeshLayer:Yf},Symbol.toStringTag,{value:"Module"})),ife=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,sfe=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function ofe(r){const e=r.positions||r.POSITION,t=e.value.length/e.size;r.COLOR_0||r.colors||(r.colors={size:4,value:new Uint8Array(t*4).fill(255),normalized:!0})}const afe={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Ww extends Yf{getShaders(){const e=super.getShaders();return e.modules.push(Ox),{...e,vs:ife,fs:sfe}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!t}),super.draw(e))}getModel(e){const{id:t,pbrMaterial:n}=this.props,i=this.parseMaterial(n,e);this.setState({parsedPBRMaterial:i});const o=this.getShaders();return ofe(e.attributes),new mi(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...o.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:n}=this.props,i=this.parseMaterial(e,n);this.setState({parsedPBRMaterial:i}),t.setBindings(i.bindings),t.setUniforms(i.uniforms)}}parseMaterial(e,t){const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return o4(this.context.device,{unlit:n,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,n=new Uint8ClampedArray(t.length*e.size),i=[];for(let o=0;o<t.length;o++)this.encodePickingColor(t[o],i),n[o*3]=i[0],n[o*3+1]=i[1],n[o*3+2]=i[2];e.value=n}finalizeState(e){var t;super.finalizeState(e),(t=this.state.parsedPBRMaterial)==null||t.generatedTextures.forEach(n=>n.destroy()),this.setState({parsedPBRMaterial:null})}}Ww.layerName="MeshLayer";Ww.defaultProps=afe;const cfe=6378137,lfe=6378137,ufe=6356752314245179e-9;function vy(r){return r}new ft;function ffe(r,e=[],t=vy){return"longitude"in r?(e[0]=t(r.longitude),e[1]=t(r.latitude),e[2]=r.height):"x"in r?(e[0]=t(r.x),e[1]=t(r.y),e[2]=r.z):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function hfe(r,e=[]){return ffe(r,e,ps._cartographicRadians?vy:k7)}function dfe(r,e,t=vy){return"longitude"in e?(e.longitude=t(r[0]),e.latitude=t(r[1]),e.height=r[2]):"x"in e?(e.x=t(r[0]),e.y=t(r[1]),e.z=r[2]):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function Afe(r,e){return dfe(r,e,ps._cartographicRadians?vy:U7)}const f3=1e-14,pfe=new ft,h3={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},j1={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},mp={east:new ft,north:new ft,up:new ft,west:new ft,south:new ft,down:new ft},gfe=new ft,mfe=new ft,_fe=new ft;function d3(r,e,t,n,i,o){const s=h3[e]&&h3[e][t];Qa(s&&(!n||n===s));let c,f,g;const b=pfe.copy(i);if(Sa(b.x,0,f3)&&Sa(b.y,0,f3)){const S=Math.sign(b.z);c=gfe.fromArray(j1[e]),e!=="east"&&e!=="west"&&c.scale(S),f=mfe.fromArray(j1[t]),t!=="east"&&t!=="west"&&f.scale(S),g=_fe.fromArray(j1[n]),n!=="east"&&n!=="west"&&g.scale(S)}else{const{up:S,east:F,north:k}=mp;F.set(-b.y,b.x,0).normalize(),r.geodeticSurfaceNormal(b,S),k.copy(S).cross(F);const{down:U,west:j,south:z}=mp;U.copy(S).scale(-1),j.copy(F).scale(-1),z.copy(k).scale(-1),c=mp[e],f=mp[t],g=mp[n]}return o[0]=c.x,o[1]=c.y,o[2]=c.z,o[3]=0,o[4]=f.x,o[5]=f.y,o[6]=f.z,o[7]=0,o[8]=g.x,o[9]=g.y,o[10]=g.z,o[11]=0,o[12]=b.x,o[13]=b.y,o[14]=b.z,o[15]=1,o}const ud=new ft,yfe=new ft,vfe=new ft;function bfe(r,e,t=[]){const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:o}=e;ud.from(r);const s=ud.x,c=ud.y,f=ud.z,g=n.x,b=n.y,T=n.z,S=s*s*g*g,F=c*c*b*b,k=f*f*T*T,U=S+F+k,j=Math.sqrt(1/U);if(!Number.isFinite(j))return;const z=yfe;if(z.copy(r).scale(j),U<o)return z.to(t);const V=i.x,K=i.y,fe=i.z,Q=vfe;Q.set(z.x*V*2,z.y*K*2,z.z*fe*2);let oe=(1-j)*ud.len()/(.5*Q.len()),Te=0,ze,Ae,_e,pe;do{oe-=Te,ze=1/(1+oe*V),Ae=1/(1+oe*K),_e=1/(1+oe*fe);const X=ze*ze,ne=Ae*Ae,Be=_e*_e,Ze=X*ze,Ce=ne*Ae,Ne=Be*_e;pe=S*X+F*ne+k*Be-1;const Qe=-2*(S*Ze*V+F*Ce*K+k*Ne*fe);Te=pe/Qe}while(Math.abs(pe)>iV);return ud.scale([ze,Ae,_e]).to(t)}const q0=new ft,A3=new ft,xfe=new ft,Xa=new ft,wfe=new ft,Z0=new ft;class gi{constructor(e=0,t=0,n=0){this.centerToleranceSquared=nV,Qa(e>=0),Qa(t>=0),Qa(n>=0),this.radii=new ft(e,t,n),this.radiiSquared=new ft(e*e,t*t,n*n),this.radiiToTheFourth=new ft(e*e*e*e,t*t*t*t,n*n*n*n),this.oneOverRadii=new ft(e===0?0:1/e,t===0?0:1/t,n===0?0:1/n),this.oneOverRadiiSquared=new ft(e===0?0:1/(e*e),t===0?0:1/(t*t),n===0?0:1/(n*n)),this.minimumRadius=Math.min(e,t,n),this.maximumRadius=Math.max(e,t,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){const n=A3,i=xfe,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);const s=Math.sqrt(n.dot(i));return i.scale(1/s),n.scale(o),i.add(n),i.to(t)}cartesianToCartographic(e,t=[0,0,0]){Z0.from(e);const n=this.scaleToGeodeticSurface(Z0,Xa);if(!n)return;const i=this.geodeticSurfaceNormal(n,A3),o=wfe;o.copy(Z0).subtract(n);const s=Math.atan2(i.y,i.x),c=Math.asin(i.z),f=Math.sign(Ix(o,Z0))*ZF(o);return Afe([s,c,f],t)}eastNorthUpToFixedFrame(e,t=new dn){return d3(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,n,i,o=new dn){return d3(this,e,t,n,i,o)}geocentricSurfaceNormal(e,t=[0,0,0]){return q0.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){const n=hfe(e),i=n[0],o=n[1],s=Math.cos(o);return q0.set(s*Math.cos(i),s*Math.sin(i),Math.sin(o)).normalize(),q0.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return q0.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return bfe(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){Xa.from(e);const n=Xa.x,i=Xa.y,o=Xa.z,s=this.oneOverRadiiSquared,c=1/Math.sqrt(n*n*s.x+i*i*s.y+o*o*s.z);return Xa.multiplyScalar(c).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return Xa.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return Xa.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,n=[0,0,0]){Qa(Sa(this.radii.x,this.radii.y,cD)),Qa(this.radii.z>0),Xa.from(e);const i=Xa.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return Xa.set(0,0,i).to(n)}}gi.WGS84=new gi(cfe,lfe,ufe);class Cfe{constructor(e,t,n){J(this,"item");J(this,"previous");J(this,"next");this.item=e,this.previous=t,this.next=n}}class Efe{constructor(){J(this,"head",null);J(this,"tail",null);J(this,"_length",0)}get length(){return this._length}add(e){const t=new Cfe(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e,++this._length}}class Tfe{constructor(){J(this,"_list");J(this,"_sentinel");J(this,"_trimTiles");this._list=new Efe,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,n){t._cacheNode||(t._cacheNode=this._list.add(t),n&&n(e,t))}unloadTile(e,t,n){const i=t._cacheNode;i&&(this._list.remove(i),t._cacheNode=null,n&&n(e,t))}unloadTiles(e,t){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,o=e.maximumMemoryUsage*1024*1024,s=this._sentinel;let c=i.head;for(;c!==s&&(e.gpuMemoryUsageInBytes>o||n);){const f=c.item;c=c.next,this.unloadTile(e,f,t)}}trim(){this._trimTiles=!0}}function Bfe(r,e){$n(r),$n(e);const{rtcCenter:t,gltfUpAxis:n}=e,{computedTransform:i,boundingVolume:{center:o}}=r;let s=new dn(i);switch(t&&s.translate(t),n){case"Z":break;case"Y":const T=new dn().rotateX(Math.PI/2);s=s.multiplyRight(T);break;case"X":const S=new dn().rotateY(-Math.PI/2);s=s.multiplyRight(S);break}e.isQuantized&&s.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const c=new ft(o);e.cartesianModelMatrix=s,e.cartesianOrigin=c;const f=gi.WGS84.cartesianToCartographic(c,new ft),b=gi.WGS84.eastNorthUpToFixedFrame(c).invert();e.cartographicModelMatrix=b.multiplyRight(s),e.cartographicOrigin=f,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const p3=new ft,J1=new ft,X2=new ta([new Ya,new Ya,new Ya,new Ya,new Ya,new Ya]);function Sfe(r,e){const{cameraDirection:t,cameraUp:n,height:i}=r,{metersPerUnit:o}=r.distanceScales,s=Im(r,r.center),c=gi.WGS84.eastNorthUpToFixedFrame(s),f=r.unprojectPosition(r.cameraPosition),g=gi.WGS84.cartographicToCartesian(f,new ft),b=new ft(c.transformAsVector(new ft(t).scale(o))).normalize(),T=new ft(c.transformAsVector(new ft(n).scale(o))).normalize();Mfe(r);const S=r.constructor,{longitude:F,latitude:k,width:U,bearing:j,zoom:z}=r,V=new S({longitude:F,latitude:k,height:i,width:U,bearing:j,zoom:z,pitch:0});return{camera:{position:g,direction:b,up:T},viewport:r,topDownViewport:V,height:i,cullingVolume:X2,frameNumber:e,sseDenominator:1.15}}function Ife(r,e,t){if(t===0||r.length<=t)return[r,[]];const n=[],{longitude:i,latitude:o}=e.viewport;for(const[g,b]of r.entries()){const[T,S]=b.header.mbs,F=Math.abs(i-T),k=Math.abs(o-S),U=Math.sqrt(k*k+F*F);n.push([g,U])}const s=n.sort((g,b)=>g[1]-b[1]),c=[];for(let g=0;g<t;g++)c.push(r[s[g][0]]);const f=[];for(let g=t;g<s.length;g++)f.push(r[s[g][0]]);return[c,f]}function Mfe(r){const e=r.getFrustumPlanes(),t=g3(e.near,r.cameraPosition),n=Im(r,t),i=Im(r,r.cameraPosition,J1);let o=0;X2.planes[o++].fromPointNormal(n,p3.copy(n).subtract(i));for(const s in e){if(s==="near")continue;const c=e[s],f=g3(c,t,J1),g=Im(r,f,J1);X2.planes[o++].fromPointNormal(g,p3.copy(n).subtract(g))}}function g3(r,e,t=new ft){const n=r.normal.dot(e);return t.copy(r.normal).scale(r.distance-n).add(e),t}function Im(r,e,t=new ft){const n=r.unprojectPosition(e);return gi.WGS84.cartographicToCartesian(n,t)}const Pfe=6378137,Rfe=6378137,$2=6356752314245179e-9,zd=new ft;function Ffe(r,e){if(r instanceof Bg){const{halfAxes:t}=r,n=Ofe(t);return Math.log2($2/(n+e[2]))}else if(r instanceof Tg){const{radius:t}=r;return Math.log2($2/(t+e[2]))}else if(r.width&&r.height){const{width:t,height:n}=r,i=Math.log2(Pfe/t),o=Math.log2(Rfe/n);return(i+o)/2}return 1}function B4(r,e,t){gi.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],zd);const n=Math.sqrt(Math.pow(zd[0]-t[0],2)+Math.pow(zd[1]-t[1],2)+Math.pow(zd[2]-t[2],2));return Math.log2($2/(n+e[2]))}function Dfe(r,e,t){const[n,i,o,s]=r;return B4({xmax:o,ymax:s,zmax:0},e,t)}function Ofe(r){r.getColumn(0,zd);const e=r.getColumn(1),t=r.getColumn(2);return zd.add(e).add(t).len()}const Qo={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var cc;(function(r){r[r.ADD=1]="ADD",r[r.REPLACE=2]="REPLACE"})(cc||(cc={}));var Dl;(function(r){r.EMPTY="empty",r.SCENEGRAPH="scenegraph",r.POINTCLOUD="pointcloud",r.MESH="mesh"})(Dl||(Dl={}));var So;(function(r){r.I3S="I3S",r.TILES3D="TILES3D"})(So||(So={}));var gA;(function(r){r.GEOMETRIC_ERROR="geometricError",r.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(gA||(gA={}));const Lfe={USE_OPTIMIZATION:1};function S4(r){return r!=null}const no=new ft,Mm=new ft,Nfe=new ft,kfe=new ft,If=new ft,m3=new ft,_3=new ft,y3=new ft;function W1(r,e,t){if($n(r,"3D Tile: boundingVolume must be defined"),r.box)return I4(r.box,e,t);if(r.region)return Gfe(r.region);if(r.sphere)return zfe(r.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Ufe(r,e){if(r.box)return Vfe(e);if(r.region){const[t,n,i,o,s,c]=r.region;return[[Za(t),Za(n),s],[Za(i),Za(o),c]]}if(r.sphere)return Hfe(e);throw new Error("Unkown boundingVolume type")}function I4(r,e,t){const n=new ft(r[0],r[1],r[2]);e.transform(n,n);let i=[];if(r.length===10){const g=r.slice(3,6),b=new Yp;b.fromArray(r,6);const T=new ft([1,0,0]),S=new ft([0,1,0]),F=new ft([0,0,1]);T.transformByQuaternion(b),T.scale(g[0]),S.transformByQuaternion(b),S.scale(g[1]),F.transformByQuaternion(b),F.scale(g[2]),i=[...T.toArray(),...S.toArray(),...F.toArray()]}else i=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];const o=e.transformAsVector(i.slice(0,3)),s=e.transformAsVector(i.slice(3,6)),c=e.transformAsVector(i.slice(6,9)),f=new li([o[0],o[1],o[2],s[0],s[1],s[2],c[0],c[1],c[2]]);return S4(t)?(t.center=n,t.halfAxes=f,t):new Bg(n,f)}function zfe(r,e,t){const n=new ft(r[0],r[1],r[2]);e.transform(n,n);const i=e.getScale(Mm),o=Math.max(Math.max(i[0],i[1]),i[2]),s=r[3]*o;return S4(t)?(t.center=n,t.radius=s,t):new Tg(n,s)}function Gfe(r){const[e,t,n,i,o,s]=r,c=gi.WGS84.cartographicToCartesian([Za(e),Za(i),o],Nfe),f=gi.WGS84.cartographicToCartesian([Za(n),Za(t),s],kfe),g=new ft().addVectors(c,f).multiplyByScalar(.5);return gi.WGS84.cartesianToCartographic(g,If),gi.WGS84.cartographicToCartesian([Za(n),If[1],If[2]],m3),gi.WGS84.cartographicToCartesian([If[0],Za(i),If[2]],_3),gi.WGS84.cartographicToCartesian([If[0],If[1],s],y3),I4([...g,...m3.subtract(g),..._3.subtract(g),...y3.subtract(g)],new dn)}function Vfe(r){const e=M4(),{halfAxes:t}=r,n=new ft(t.getColumn(0)),i=new ft(t.getColumn(1)),o=new ft(t.getColumn(2));for(let s=0;s<2;s++){for(let c=0;c<2;c++){for(let f=0;f<2;f++)no.copy(r.center),no.add(n),no.add(i),no.add(o),P4(e,no),o.negate();i.negate()}n.negate()}return e}function Hfe(r){const e=M4(),{center:t,radius:n}=r,i=gi.WGS84.scaleToGeodeticSurface(t,no);let o;i?o=gi.WGS84.geodeticSurfaceNormal(i):o=new ft(0,0,1);let s=new ft(o[2],-o[1],0);s.len()>0?s.normalize():s=new ft(0,1,0);const c=s.clone().cross(o);for(const f of[s,c,o]){Mm.copy(f).scale(n);for(let g=0;g<2;g++)no.copy(t),no.add(Mm),P4(e,no),Mm.negate()}return e}function M4(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function P4(r,e){gi.WGS84.cartesianToCartographic(e,no),r[0][0]=Math.min(r[0][0],no[0]),r[0][1]=Math.min(r[0][1],no[1]),r[0][2]=Math.min(r[0][2],no[2]),r[1][0]=Math.max(r[1][0],no[0]),r[1][1]=Math.max(r[1][1],no[1]),r[1][2]=Math.max(r[1][2],no[2])}new ft;new ft;new dn;new ft;new ft;new ft;function jfe(r,e){const t=r*e;return 1-Math.exp(-(t*t))}function Jfe(r,e){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){const t=r.dynamicScreenSpaceErrorComputedDensity,n=r.dynamicScreenSpaceErrorFactor;return jfe(e,t)*n}return 0}function Wfe(r,e,t){const n=r.tileset,i=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,o=t?i:r.lodMetricValue;if(o===0)return 0;const s=Math.max(r._distanceToCamera,1e-7),{height:c,sseDenominator:f}=e,{viewDistanceScale:g}=n.options;let b=o*c*(g||1)/(s*f);return b-=Jfe(n,s),b}const X1=new ft,v3=new ft,Tu=new ft,b3=new ft,Xfe=new ft,$1=new dn,x3=new dn;function $fe(r,e){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";const t=2*R4(r,e);return t<2?"OUT":!r.header.children||t<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function R4(r,e){const{topDownViewport:t}=e,n=r.header.mbs[1],i=r.header.mbs[0],o=r.header.mbs[2],s=r.header.mbs[3],c=[...r.boundingVolume.center],f=t.unprojectPosition(t.cameraPosition);gi.WGS84.cartographicToCartesian(f,X1),v3.copy(X1).subtract(c).normalize(),gi.WGS84.eastNorthUpToFixedFrame(c,$1),x3.copy($1).invert(),Tu.copy(X1).transform(x3);const g=Math.sqrt(Tu[0]*Tu[0]+Tu[1]*Tu[1]),b=g*g/Tu[2];b3.copy([Tu[0],Tu[1],b]);const S=b3.transform($1).subtract(c).normalize(),k=v3.cross(S).normalize().scale(s).add(c),U=gi.WGS84.cartesianToCartographic(k),j=t.project([i,n,o]),z=t.project(U);return Xfe.copy(j).subtract(z).magnitude()}function Kfe(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}class w3{constructor(e=0){J(this,"_map",new Map);J(this,"_array");J(this,"_length");this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return $n(e<this._array.length),this._array[e]}set(e,t){$n(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){$n(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){$n(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const qfe={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class by{constructor(e){J(this,"options");J(this,"root",null);J(this,"selectedTiles",{});J(this,"requestedTiles",{});J(this,"emptyTiles",{});J(this,"lastUpdate",new Date().getTime());J(this,"updateDebounceTime",1e3);J(this,"_traversalStack",new w3);J(this,"_emptyTraversalStack",new w3);J(this,"_frameNumber",null);this.options={...qfe,...e}}traversalFinished(e){return!0}traverse(e,t,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const o=n.pop();let s=!1;this.canTraverse(o,t)&&(this.updateChildTiles(o,t),s=this.updateAndPushChildren(o,t,n,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const c=o.parent,f=!!(!c||c._shouldRefine),g=!s;o.hasRenderContent?o.refine===cc.ADD?(this.loadTile(o,t),this.selectTile(o,t)):o.refine===cc.REPLACE&&(this.loadTile(o,t),g&&this.selectTile(o,t)):(this.emptyTiles[o.id]=o,this.loadTile(o,t),g&&this.selectTile(o,t)),this.touchTile(o,t),o._shouldRefine=s&&f}const i=new Date().getTime();(this.traversalFinished(t)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const n=e.children;for(const i of n)this.updateTile(i,t)}updateAndPushChildren(e,t,n,i){const{loadSiblings:o,skipLevelOfDetail:s}=this.options,c=e.children;c.sort(this.compareDistanceToCamera.bind(this));const f=e.refine===cc.REPLACE&&e.hasRenderContent&&!s;let g=!1,b=!0;for(const T of c)if(T._selectionDepth=i,T.isVisibleAndInRequestVolume?(n.find(T)&&n.delete(T),n.push(T),g=!0):(f||o)&&(this.loadTile(T,t),this.touchTile(T,t)),f){let S;if(T._inRequestVolume?T.hasRenderContent?S=T.contentAvailable:S=this.executeEmptyTraversal(T,t):S=!1,b=b&&S,!b)return!1}return g||(b=!1),b}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t,n=!1,i=!1){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!i&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,t,n):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,n=!1){let i=e._screenSpaceError;return n&&(i=e.getScreenSpaceError(t,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===t.viewport.id&&n.push(i);else n.push(t.viewport.id);e.updateVisibility(t,n)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let n=!1;for(const i of e.children)i.updateVisibility(t),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,t){let n=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0;){const o=i.pop(),s=!o.hasRenderContent&&this.canTraverse(o,t,!1,!1),c=!o.hasRenderContent&&o.children.length===0;if(!s&&!o.contentAvailable&&!c&&(n=!1),this.updateTile(o,t),o.isVisibleAndInRequestVolume||(this.loadTile(o,t),this.touchTile(o,t)),s){const f=o.children;for(const g of f)i.push(g)}}return n}}const C3=new ft;function Zfe(r){return r!=null}class K2{constructor(e,t,n,i=""){J(this,"tileset");J(this,"header");J(this,"id");J(this,"url");J(this,"parent");J(this,"refine");J(this,"type");J(this,"contentUrl");J(this,"lodMetricType","geometricError");J(this,"lodMetricValue",0);J(this,"boundingVolume",null);J(this,"content",null);J(this,"contentState",Qo.UNLOADED);J(this,"gpuMemoryUsageInBytes",0);J(this,"children",[]);J(this,"depth",0);J(this,"viewportIds",[]);J(this,"transform",new dn);J(this,"extensions",null);J(this,"implicitTiling",null);J(this,"userData",{});J(this,"computedTransform");J(this,"hasEmptyContent",!1);J(this,"hasTilesetContent",!1);J(this,"traverser",new by({}));J(this,"_cacheNode",null);J(this,"_frameNumber",null);J(this,"_expireDate",null);J(this,"_expiredContent",null);J(this,"_boundingBox");J(this,"_distanceToCamera",0);J(this,"_screenSpaceError",0);J(this,"_visibilityPlaneMask");J(this,"_visible");J(this,"_contentBoundingVolume");J(this,"_viewerRequestVolume");J(this,"_initialTransform",new dn);J(this,"_priority",0);J(this,"_selectedFrame",0);J(this,"_requestedFrame",0);J(this,"_selectionDepth",0);J(this,"_touchedFrame",0);J(this,"_centerZDepth",0);J(this,"_shouldRefine",!1);J(this,"_stackLength",0);J(this,"_visitedFrame",0);J(this,"_inRequestVolume",!1);J(this,"_lodJudge",null);this.header=t,this.tileset=e,this.id=i||t.id,this.url=t.url,this.parent=n,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Qo.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Qo.UNLOADED}get contentExpired(){return this.contentState===Qo.EXPIRED}get contentFailed(){return this.contentState===Qo.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Ufe(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case So.I3S:return R4(this,e);case So.TILES3D:return Wfe(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,n=this.refine===cc.ADD||t;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Qo.UNLOADED)return-1;const i=this.parent,s=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,c=e.root?e.root._screenSpaceError:0;return Math.max(c-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Qo.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=Qo.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,o={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await Nl(n,i,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Qo.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=Qo.FAILED,n}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Qo.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:ta.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==ta.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:n}=e,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const t=this.boundingVolume;return C3.subVectors(t.center,e.position),e.direction.dot(C3)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(Zfe(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Qo.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new dn(e.transform):new dn;const t=this.parent,n=this.tileset,i=t&&t.computedTransform?t.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new dn(i).multiplyRight(this.transform);const o=t&&t._initialTransform?t._initialTransform.clone():new dn;this._initialTransform=new dn(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Qo.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ta.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||cc.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=W1(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=W1(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=W1(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new dn){const t=e.clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Kfe(this.tileset.tileset)}}}class Yfe extends by{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const s=e.children[0];this.updateTileVisibility(s,t),e._visible=s._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const i=e.refine===cc.REPLACE,o=e._optimChildrenWithinParent===Lfe.USE_OPTIMIZATION;if(i&&o&&n&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:n}=e;return!n||n.hasTilesetContent||n.refine!==cc.ADD?!1:!this.shouldRefine(e,t,!0)}}class Qfe{constructor(){J(this,"frameNumberMap",new Map)}register(e,t){const n=this.frameNumberMap.get(e)||new Map,i=n.get(t)||0;n.set(t,i+1),this.frameNumberMap.set(e,n)}deregister(e,t){const n=this.frameNumberMap.get(e);if(!n)return;const i=n.get(t)||1;n.set(t,i-1)}isZero(e,t){var i;return(((i=this.frameNumberMap.get(e))==null?void 0:i.get(t))||0)===0}}const K1={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class ehe{constructor(){J(this,"_statusMap");J(this,"pendingTilesRegister",new Qfe);this._statusMap={}}add(e,t,n,i){if(!this._statusMap[t]){const{frameNumber:o,viewport:{id:s}}=i;this._statusMap[t]={request:e,callback:n,key:t,frameState:i,status:K1.REQUESTED},this.pendingTilesRegister.register(s,o),e().then(c=>{this._statusMap[t].status=K1.COMPLETED;const{frameNumber:f,viewport:{id:g}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(g,f),this._statusMap[t].callback(c,i)}).catch(c=>{this._statusMap[t].status=K1.ERROR;const{frameNumber:f,viewport:{id:g}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(g,f),n(c)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:o,viewport:{id:s}}=t;this.pendingTilesRegister.register(s,o),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class the extends by{constructor(t){super(t);J(this,"_tileManager");this._tileManager=new ehe}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,n){return t._lodJudge=$fe(t,n),t._lodJudge==="DIG"}updateChildTiles(t,n){const i=t.header.children||[],o=t.children,s=t.tileset;for(const c of i){const f=`${c.id}-${n.viewport.id}`,g=o&&o.find(b=>b.id===f);if(g)g&&this.updateTile(g,n);else{let b=()=>this._loadTile(c.id,s);this._tileManager.find(f)?this._tileManager.update(f,n):(s.tileset.nodePages&&(b=()=>s.tileset.nodePagesTile.formTileFromNodePages(c.id)),this._tileManager.add(b,f,S=>this._onTileLoad(S,t,f),n))}}return!1}async _loadTile(t,n){const{loader:i}=n,o=n.getTileUrl(`${n.url}/nodes/${t}`),s={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await Nl(o,i,s)}_onTileLoad(t,n,i){const o=new K2(n.tileset,t,n,i);n.children.push(o);const s=this._tileManager.find(o.id).frameState;this.updateTile(o,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(o,s)}}const rhe={description:"",ellipsoid:gi.WGS84,modelMatrix:new dn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Y0="Tiles In Tileset(s)",q1="Tiles In Memory",E3="Tiles In View",T3="Tiles To Render",B3="Tiles Loaded",Z1="Tiles Loading",S3="Tiles Unloaded",I3="Failed Tile Loads",M3="Points/Vertices",Y1="Tile Memory Use",P3="Maximum Screen Space Error";class nhe{constructor(e,t){J(this,"options");J(this,"loadOptions");J(this,"type");J(this,"tileset");J(this,"loader");J(this,"url");J(this,"basePath");J(this,"modelMatrix");J(this,"ellipsoid");J(this,"lodMetricType");J(this,"lodMetricValue");J(this,"refine");J(this,"root",null);J(this,"roots",{});J(this,"asset",{});J(this,"description","");J(this,"properties");J(this,"extras",null);J(this,"attributions",{});J(this,"credits",{});J(this,"stats");J(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});J(this,"cartographicCenter",null);J(this,"cartesianCenter",null);J(this,"zoom",1);J(this,"boundingVolume",null);J(this,"dynamicScreenSpaceErrorComputedDensity",0);J(this,"maximumMemoryUsage",32);J(this,"gpuMemoryUsageInBytes",0);J(this,"memoryAdjustedScreenSpaceError",0);J(this,"_cacheBytes",0);J(this,"_cacheOverflowBytes",0);J(this,"_frameNumber",0);J(this,"_queryParams",{});J(this,"_extensionsUsed",[]);J(this,"_tiles",{});J(this,"_pendingCount",0);J(this,"selectedTiles",[]);J(this,"traverseCounter",0);J(this,"geometricError",0);J(this,"lastUpdatedVieports",null);J(this,"_requestedTiles",[]);J(this,"_emptyTiles",[]);J(this,"frameStateData",{});J(this,"_traverser");J(this,"_cache",new Tfe);J(this,"_requestScheduler");J(this,"updatePromise",null);J(this,"tilesetInitializationPromise");this.options={...rhe,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Ax(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new eF({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new vA({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let n=e;return this.queryParams.length&&(n=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),n}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const n=[];for(const i of t){const o=i.id;this._needTraverse(o)?n.push(o):this.traverseCounter--}for(const i of t){const o=i.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!n.includes(o))continue;const s=Sfe(i,this._frameNumber);this._traverser.traverse(this.roots[o],s,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[t],i=Object.values(this._traverser.selectedTiles),[o,s]=Ife(i,e,this.options.maximumTilesSelected);n.selectedTiles=o;for(const c of s)c.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const n=new Set(e.map(s=>s.id)),i=new Set(t.map(s=>s.id));let o=e.filter(s=>!i.has(s.id)).length>0;return o=o||t.filter(s=>!n.has(s.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?t+=n.content.pointCount:t+=n.content.vertexCount);this.stats.get(E3).count=this.selectedTiles.length,this.stats.get(T3).count=e,this.stats.get(M3).count=t,this.stats.get(P3).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===So.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===So.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===So.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var n;const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:o,ymin:s,ymax:c,zmin:f,zmax:g}=e;this.cartographicCenter=new ft(i+(o-i)/2,s+(c-s)/2,f+(g-f)/2),this.cartesianCenter=new ft,gi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=B4(e,this.cartographicCenter,this.cartesianCenter);return}const t=(n=this.tileset.store)==null?void 0:n.extent;if(t){const[i,o,s,c]=t;this.cartographicCenter=new ft(i+(s-i)/2,o+(c-o)/2,0),this.cartesianCenter=new ft,gi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Dfe(t,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new ft,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new ft,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?(this.cartographicCenter=new ft,gi.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new ft(0,0,-gi.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=Ffe(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Y0),this.stats.get(Z1),this.stats.get(q1),this.stats.get(E3),this.stats.get(T3),this.stats.get(B3),this.stats.get(S3),this.stats.get(I3),this.stats.get(M3),this.stats.get(Y1,"memory"),this.stats.get(P3)}_initializeTileHeaders(e,t){var i;const n=new K2(this,e.root,t);if(t&&(t.children.push(n),n.depth=t.depth+1),this.type===So.TILES3D){const o=[];for(o.push(n);o.length>0;){const s=o.pop();this.stats.get(Y0).incrementCount();const c=s.header.children||[];for(const f of c){const g=new K2(this,f,s);if((i=g.contentUrl)!=null&&i.includes("?session=")){const T=new URL(g.contentUrl).searchParams.get("session");T&&(this._queryParams.session=T)}s.children.push(g),g.depth=s.depth+1,o.push(g)}}}return n}_initializeTraverser(){let e;switch(this.type){case So.TILES3D:e=Yfe;break;case So.I3S:e=the;break;default:e=by}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(n){this._onTileLoadError(e,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(I3).incrementCount();const n=t.message||t.toString(),i=e.url;console.error(`A 3D tile failed to load: ${e.url} ${n}`),this.options.onTileError(e,n,i)}_onTileLoad(e,t){var n,i;if(t){if(this.type===So.I3S){const o=((i=(n=this.tileset)==null?void 0:n.nodePagesTile)==null?void 0:i.nodesInNodePages)||0;this.stats.get(Y0).reset(),this.stats.get(Y0).addCount(o)}e&&e.content&&Bfe(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var t;if(this.type===So.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===So.TILES3D){const{extensionsRemoved:n=[]}=((t=e.content)==null?void 0:t.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Z1).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Z1).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(B3).incrementCount(),this.stats.get(q1).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Y1).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(q1).decrementCount(),this.stats.get(S3).incrementCount(),this.stats.get(Y1).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const n of t.children)e.push(n);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,n=[];for(n.push(t);n.length>0;){e=n.pop();for(const i of e.children)n.push(i);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),n=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const F4="4.2.4",_p={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function D4(r,e,t){$n(r instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(r,e,t);return n.decode(i)}function ihe(r,e=0){const t=new DataView(r);return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}const she={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},os={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Dn={...she,...os},Q1={[os.DOUBLE]:Float64Array,[os.FLOAT]:Float32Array,[os.UNSIGNED_SHORT]:Uint16Array,[os.UNSIGNED_INT]:Uint32Array,[os.UNSIGNED_BYTE]:Uint8Array,[os.BYTE]:Int8Array,[os.SHORT]:Int16Array,[os.INT]:Int32Array},ohe={DOUBLE:os.DOUBLE,FLOAT:os.FLOAT,UNSIGNED_SHORT:os.UNSIGNED_SHORT,UNSIGNED_INT:os.UNSIGNED_INT,UNSIGNED_BYTE:os.UNSIGNED_BYTE,BYTE:os.BYTE,SHORT:os.SHORT,INT:os.INT},eb="Failed to convert GL type";class Xc{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in Q1)if(Q1[t]===e)return t;throw new Error(eb)}static fromName(e){const t=ohe[e];if(!t)throw new Error(eb);return t}static getArrayType(e){switch(e){case os.UNSIGNED_SHORT_5_6_5:case os.UNSIGNED_SHORT_4_4_4_4:case os.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=Q1[e];if(!t)throw new Error(eb);return t}}static getByteSize(e){return Xc.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Xc.getArrayType(e)}static createTypedArray(e,t,n=0,i){i===void 0&&(i=(t.byteLength-n)/Xc.getByteSize(e));const o=Xc.getArrayType(e);return new o(t,n,i)}}function ahe(r,e){if(!r)throw new Error(`math.gl assertion failed. ${e}`)}function che(r,e=[0,0,0]){const t=r>>11&31,n=r>>5&63,i=r&31;return e[0]=t<<3,e[1]=n<<2,e[2]=i<<3,e}new Sx;new ft;new Sx;new Sx;function R3(r,e=255){return Rl(r,0,e)/e*2-1}function F3(r){return r<0?-1:1}function lhe(r,e,t,n){if(ahe(n),r<0||r>t||e<0||e>t)throw new Error(`x and y must be unsigned normalized integers between 0 and ${t}`);if(n.x=R3(r,t),n.y=R3(e,t),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*F3(i),n.y=(1-Math.abs(i))*F3(n.y)}return n.normalize()}function uhe(r,e,t){return lhe(r,e,255,t)}class Xw{constructor(e,t){J(this,"json");J(this,"buffer");J(this,"featuresLength",0);J(this,"_cachedTypedArrays",{});this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,t=Dn.UNSIGNED_INT,n=1){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,i.byteOffset):i}getPropertyArray(e,t,n){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=Xc.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,n,i,o){const s=this.json[e];if(!s)return s;const c=this.getPropertyArray(e,t,n);if(n===1)return c[i];for(let f=0;f<n;++f)o[f]=c[n*i+f];return o}_getTypedArrayFromBinary(e,t,n,i,o){const s=this._cachedTypedArrays;let c=s[e];return c||(c=Xc.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+o,i*n),s[e]=c),c}_getTypedArrayFromArray(e,t,n){const i=this._cachedTypedArrays;let o=i[e];return o||(o=Xc.createTypedArray(t,n),i[e]=o),o}}const fhe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hhe={SCALAR:(r,e)=>r[e],VEC2:(r,e)=>[r[2*e+0],r[2*e+1]],VEC3:(r,e)=>[r[3*e+0],r[3*e+1],r[3*e+2]],VEC4:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT2:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT3:(r,e)=>[r[9*e+0],r[9*e+1],r[9*e+2],r[9*e+3],r[9*e+4],r[9*e+5],r[9*e+6],r[9*e+7],r[9*e+8]],MAT4:(r,e)=>[r[16*e+0],r[16*e+1],r[16*e+2],r[16*e+3],r[16*e+4],r[16*e+5],r[16*e+6],r[16*e+7],r[16*e+8],r[16*e+9],r[16*e+10],r[16*e+11],r[16*e+12],r[16*e+13],r[16*e+14],r[16*e+15]]},dhe={SCALAR:(r,e,t)=>{e[t]=r},VEC2:(r,e,t)=>{e[2*t+0]=r[0],e[2*t+1]=r[1]},VEC3:(r,e,t)=>{e[3*t+0]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2]},VEC4:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT2:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT3:(r,e,t)=>{e[9*t+0]=r[0],e[9*t+1]=r[1],e[9*t+2]=r[2],e[9*t+3]=r[3],e[9*t+4]=r[4],e[9*t+5]=r[5],e[9*t+6]=r[6],e[9*t+7]=r[7],e[9*t+8]=r[8],e[9*t+9]=r[9]},MAT4:(r,e,t)=>{e[16*t+0]=r[0],e[16*t+1]=r[1],e[16*t+2]=r[2],e[16*t+3]=r[3],e[16*t+4]=r[4],e[16*t+5]=r[5],e[16*t+6]=r[6],e[16*t+7]=r[7],e[16*t+8]=r[8],e[16*t+9]=r[9],e[16*t+10]=r[10],e[16*t+11]=r[11],e[16*t+12]=r[12],e[16*t+13]=r[13],e[16*t+14]=r[14],e[16*t+15]=r[15]}};function Ahe(r,e,t,n){const{componentType:i}=r;$n(r.componentType);const o=typeof i=="string"?Xc.fromName(i):i,s=fhe[r.type],c=hhe[r.type],f=dhe[r.type];return t+=r.byteOffset,{values:Xc.createTypedArray(o,e,t,s*n),type:o,size:s,unpacker:c,packer:f}}const Jc=r=>r!==void 0;function phe(r,e,t){if(!e)return null;let n=r.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?ghe(n,t):null}function ghe(r,e){let t,n,i;const o=r.instancesLength,s=r.classes;let c=r.classIds,f=r.parentCounts,g=r.parentIds,b=o;Jc(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,o));let T;if(Jc(f))for(Jc(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,i=getBinaryAccessor(f),f=i.createArrayBufferView(e.buffer,e.byteOffset+f.byteOffset,o)),T=new Uint16Array(o),b=0,t=0;t<o;++t)T[t]=b,b+=f[t];Jc(g)&&Jc(g.byteOffset)&&(g.componentType=defaultValue(g.componentType,GL.UNSIGNED_SHORT),g.type=AttributeType.SCALAR,i=getBinaryAccessor(g),g=i.createArrayBufferView(e.buffer,e.byteOffset+g.byteOffset,b));const S=s.length;for(t=0;t<S;++t){const j=s[t].length,z=s[t].instances,V=getBinaryProperties(j,z,e);s[t].instances=combine(V,z)}const F=new Array(S).fill(0),k=new Uint16Array(o);for(t=0;t<o;++t)n=c[t],k[t]=F[n],++F[n];const U={classes:s,classIds:c,classIndexes:k,parentCounts:f,parentIndexes:T,parentIds:g};return yhe(U),U}function yp(r,e,t){if(!r)return;const n=r.parentCounts;return r.parentIds?t(r,e):n>0?mhe(r,e,t):_he(r,e,t)}function mhe(r,e,t){const n=r.classIds,i=r.parentCounts,o=r.parentIds,s=r.parentIndexes,c=n.length,f=scratchVisited;f.length=Math.max(f.length,c);const g=++marker,b=scratchStack;for(b.length=0,b.push(e);b.length>0;){if(e=b.pop(),f[e]===g)continue;f[e]=g;const T=t(r,e);if(Jc(T))return T;const S=i[e],F=s[e];for(let k=0;k<S;++k){const U=o[F+k];U!==e&&b.push(U)}}return null}function _he(r,e,t){let n=!0;for(;n;){const i=t(r,e);if(Jc(i))return i;const o=r.parentIds[e];n=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function yhe(r){const t=r.classIds.length;for(let n=0;n<t;++n)O4(r,n,stack)}function O4(r,e,t){const n=r.parentCounts,i=r.parentIds,o=r.parentIndexes,c=r.classIds.length;if(!Jc(i))return;assert(e<c,`Parent index ${e} exceeds the total number of instances: ${c}`),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const f=Jc(n)?n[e]:1,g=Jc(n)?o[e]:e;for(let b=0;b<f;++b){const T=i[g+b];T!==e&&O4(r,T,t)}t.pop(e)}function Bo(r){return r!=null}const Q0=(r,e)=>r,vhe={HIERARCHY:!0,extensions:!0,extras:!0};class L4{constructor(e,t,n,i={}){J(this,"json");J(this,"binary");J(this,"featureCount");J(this,"_extensions");J(this,"_properties");J(this,"_binaryProperties");J(this,"_hierarchy");var o;$n(n>=0),this.json=e||{},this.binary=t,this.featureCount=n,this._extensions=((o=this.json)==null?void 0:o.extensions)||{},this._properties={};for(const s in this.json)vhe[s]||(this._properties[s]=this.json[s]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=phe(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),$n(typeof t=="string",t),this._hierarchy){const n=yp(this._hierarchy,e,(i,o)=>{const s=i.classIds[o];return i.classes[s].name===t});return Bo(n)}return!1}isExactClass(e,t){return $n(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),$n(typeof t=="string",t),Bo(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=Bo(t)?t:[],t.length=0;const n=Object.keys(this._properties);return t.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),$n(typeof t=="string",t),this._binaryProperties){const i=this._binaryProperties[t];if(Bo(i))return this._getBinaryProperty(i,e)}const n=this._properties[t];if(Bo(n))return Q0(n[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(Bo(i))return i}}setProperty(e,t,n){const i=this.featureCount;if(this._checkBatchId(e),$n(typeof t=="string",t),this._binaryProperties){const s=this._binaryProperties[t];if(s){this._setBinaryProperty(s,e,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,n))return;let o=this._properties[t];Bo(o)||(this._properties[t]=new Array(i),o=this._properties[t]),o[e]=Q0(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,n){e.pack(n,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const n=this._properties[t],i=this._initializeBinaryProperty(t,n);i&&(e=e||{},e[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const n=t;$n(this.binary,`Property ${e} requires a batch table binary.`),$n(n.type,`Property ${e} requires a type.`);const i=Ahe(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const n=yp(this._hierarchy,e,(i,o)=>{const s=i.classIds[o],c=i.classes[s].instances;return Bo(c[t])});return Bo(n)}_getPropertyNamesInHierarchy(e,t){yp(this._hierarchy,e,(n,i)=>{const o=n.classIds[i],s=n.classes[o].instances;for(const c in s)s.hasOwnProperty(c)&&t.indexOf(c)===-1&&t.push(c)})}_getHierarchyProperty(e,t){return yp(this._hierarchy,e,(n,i)=>{const o=n.classIds[i],s=n.classes[o],c=n.classIndexes[i],f=s.instances[t];return Bo(f)?Bo(f.typedArray)?this._getBinaryProperty(f,c):Q0(f[c]):null})}_setHierarchyProperty(e,t,n,i){const o=yp(this._hierarchy,t,(s,c)=>{const f=s.classIds[c],g=s.classes[f],b=s.classIndexes[c],T=g.instances[n];return Bo(T)?($n(c===t,`Inherited property "${n}" is read-only.`),Bo(T.typedArray)?this._setBinaryProperty(T,b,i):T[b]=Q0(i),!0):!1});return Bo(o)}}const tb=4;function xy(r,e,t=0){const n=new DataView(e);if(r.magic=n.getUint32(t,!0),t+=tb,r.version=n.getUint32(t,!0),t+=tb,r.byteLength=n.getUint32(t,!0),t+=tb,r.version!==1)throw new Error(`3D Tile Version ${r.version} not supported`);return t}const fd=4,D3="b3dm tile in legacy format.";function $w(r,e,t){const n=new DataView(e);let i;r.header=r.header||{};let o=n.getUint32(t,!0);t+=fd;let s=n.getUint32(t,!0);t+=fd;let c=n.getUint32(t,!0);t+=fd;let f=n.getUint32(t,!0);return t+=fd,c>=570425344?(t-=fd*2,i=o,c=s,f=0,o=0,s=0,console.warn(D3)):f>=570425344&&(t-=fd,i=c,c=o,f=s,o=0,s=0,console.warn(D3)),r.header.featureTableJsonByteLength=o,r.header.featureTableBinaryByteLength=s,r.header.batchTableJsonByteLength=c,r.header.batchTableBinaryByteLength=f,r.header.batchLength=i,t}function Kw(r,e,t,n){return t=bhe(r,e,t),t=xhe(r,e,t),t}function bhe(r,e,t,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:o,batchLength:s}=r.header||{};if(r.featureTableJson={BATCH_LENGTH:s||0},i&&i>0){const c=D4(e,t,i);r.featureTableJson=JSON.parse(c)}return t+=i||0,r.featureTableBinary=new Uint8Array(e,t,o),t+=o||0,t}function xhe(r,e,t,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:o}=r.header||{};if(i&&i>0){const s=D4(e,t,i);r.batchTableJson=JSON.parse(s),t+=i,o&&o>0&&(r.batchTableBinary=new Uint8Array(e,t,o),r.batchTableBinary=new Uint8Array(r.batchTableBinary),t+=o)}return t}function N4(r,e,t){if(!e&&(!r||!r.batchIds||!t))return null;const{batchIds:n,isRGB565:i,pointCount:o=0}=r;if(n&&t){const s=new Uint8ClampedArray(o*3);for(let c=0;c<o;c++){const f=n[c],b=t.getProperty(f,"dimensions").map(T=>T*255);s[c*3]=b[0],s[c*3+1]=b[1],s[c*3+2]=b[2]}return{type:Dn.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}if(e&&i){const s=new Uint8ClampedArray(o*3);for(let c=0;c<o;c++){const f=che(e[c]);s[c*3]=f[0],s[c*3+1]=f[1],s[c*3+2]=f[2]}return{type:Dn.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}return e&&e.length===o*3?{type:Dn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Dn.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const O3=new ft;function whe(r,e){if(!e)return null;if(r.isOctEncoded16P){const t=new Float32Array((r.pointsLength||0)*3);for(let n=0;n<(r.pointsLength||0);n++)uhe(e[n*2],e[n*2+1],O3),O3.toArray(t,n*3);return{type:Dn.FLOAT,size:2,value:t}}return{type:Dn.FLOAT,size:2,value:e}}function Che(r,e,t){return r.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,Ehe(r,e)):{type:Dn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Ehe(r,e){const t=new ft,n=new Float32Array(r.pointCount*3);for(let i=0;i<r.pointCount;i++)t.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(n,i*3);return n}async function The(r,e,t,n,i){t=xy(r,e,t),t=$w(r,e,t),t=Kw(r,e,t),Bhe(r);const{featureTable:o,batchTable:s}=She(r);return await Fhe(r,o,s,n,i),Ihe(r,o,n),Mhe(r,o,s),Phe(r,o),t}function Bhe(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function She(r){const e=new Xw(r.featureTableJson,r.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,r.featuresLength=t,r.pointsLength=t,r.pointCount=t,r.rtcCenter=e.getGlobalProperty("RTC_CENTER",Dn.FLOAT,3);const n=Rhe(r,e);return{featureTable:e,batchTable:n}}function Ihe(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.positions){if(e.hasProperty("POSITION"))r.attributes.positions=e.getPropertyArray("POSITION",Dn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",Dn.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Dn.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Dn.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=Che(r,n,t)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Mhe(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",Dn.UNSIGNED_BYTE,4),r.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",Dn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",Dn.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=N4(r,n,t)}e.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Dn.UNSIGNED_BYTE,4))}function Phe(r,e){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Dn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Dn.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=whe(r,t)}}function Rhe(r,e){let t=null;if(!r.batchIds&&e.hasProperty("BATCH_ID")&&(r.batchIds=e.getPropertyArray("BATCH_ID",Dn.UNSIGNED_SHORT,1),r.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:o}=r;t=new L4(i,o,n)}return t}async function Fhe(r,e,t,n,i){let o,s,c;const f=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];f&&(c=f.properties);const g=e.getExtension("3DTILES_draco_point_compression");if(g){s=g.properties;const T=g.byteOffset,S=g.byteLength;if(!s||!Number.isFinite(T)||!S)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=(r.featureTableBinary||[]).slice(T,T+S),r.hasPositions=Number.isFinite(s.POSITION),r.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),r.hasNormals=Number.isFinite(s.NORMAL),r.hasBatchIds=Number.isFinite(s.BATCH_ID),r.isTranslucent=Number.isFinite(s.RGBA)}if(!o)return!0;const b={buffer:o,properties:{...s,...c},batchTableProperties:c};return await Dhe(r,b,n,i)}async function Dhe(r,e,t,n){if(!n)return;const i={...t,draco:{...t==null?void 0:t.draco,extraAttributes:e.batchTableProperties||{}}};delete i["3d-tiles"];const o=await rh(e.buffer,Jw,i,n),s=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,f=o.attributes.NORMAL&&o.attributes.NORMAL.value,g=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,b=s&&o.attributes.POSITION.value.quantization,T=f&&o.attributes.NORMAL.value.quantization;if(b){const F=o.POSITION.data.quantization,k=F.range;r.quantizedVolumeScale=new ft(k,k,k),r.quantizedVolumeOffset=new ft(F.minValues),r.quantizedRange=(1<<F.quantizationBits)-1,r.isQuantizedDraco=!0}T&&(r.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const S={};if(e.batchTableProperties)for(const F of Object.keys(e.batchTableProperties))o.attributes[F]&&o.attributes[F].value&&(S[F.toLowerCase()]=o.attributes[F].value);r.attributes={positions:s,colors:N4(r,c,void 0),normals:f,batchIds:g,...S}}function na(r,e){if(!r)throw new Error(e||"assert failed: gltf")}const k4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},U4={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ohe=1.33,L3=["SCALAR","VEC2","VEC3","VEC4"],Lhe=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Nhe=new Map(Lhe),khe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Uhe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},zhe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function z4(r){return L3[r-1]||L3[0]}function qw(r){const e=Nhe.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function Zw(r,e){const t=zhe[r.componentType],n=khe[r.type],i=Uhe[r.componentType],o=r.count*n,s=r.count*n*i;na(s>=0&&s<=e.byteLength);const c=U4[r.componentType],f=k4[r.type];return{ArrayType:t,length:o,byteLength:s,componentByteSize:c,numberOfComponentsInElement:f}}function G4(r){let{images:e,bufferViews:t}=r;e=e||[],t=t||[];const n=e.map(s=>s.bufferView);t=t.filter(s=>!n.includes(s));const i=t.reduce((s,c)=>s+c.byteLength,0),o=e.reduce((s,c)=>{const{width:f,height:g}=c.image;return s+f*g},0);return i+Math.ceil(4*o*Ohe)}function Ghe(r,e,t){const n=r.bufferViews[t];na(n);const i=n.buffer,o=e[i];na(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function Vhe(r,e,t){var U,j;const n=typeof t=="number"?(U=r.accessors)==null?void 0:U[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(j=r.bufferViews)==null?void 0:j[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],c=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:f,length:g,componentByteSize:b,numberOfComponentsInElement:T}=Zw(n,i),S=b*T,F=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new f(o,c,g);const k=new f(g);for(let z=0;z<n.count;z++){const V=new f(o,c+z*F,T);k.set(V,z*T)}return k}function Hhe(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class ao{constructor(e){J(this,"gltf");J(this,"sourceBuffers");J(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||Hhe(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];na(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return Vhe(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(i,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e,t={}){return na(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return na(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:o=4}=e,c={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(n){const f=this._addIndices(n);c.primitives[0].indices=f}return Number.isFinite(i)&&(c.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=V_(e),i=t||(n==null?void 0:n.mimeType),s={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const i=e.byteLength;na(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=Gl(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:z4(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:qw(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var o,s;this.gltf.buffers=[];const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const c of this.sourceBuffers||[])i=QR(c,n,i);(s=(o=this.json)==null?void 0:o.buffers)!=null&&s[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const i=e[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);t[o]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const o of i)n.min.push(o),n.max.push(o);for(let o=t;o<e.length;o+=t)for(let s=0;s<t;s++)n.min[0+s]=Math.min(n.min[0+s],e[o+s]),n.max[0+s]=Math.max(n.max[0+s],e[o+s]);return n}}function N3(r){return(r%1+1)%1}const V4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},jhe={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},H4={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Yw(r,e){return H4[e]*V4[r]}function wy(r,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=r.getTypedArrayForBufferView(e),o=Cy(i,"SCALAR",t,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function Cy(r,e,t,n=1){const i=V4[e],o=jhe[t],s=H4[t],c=n*i,f=c*s;let g=r.buffer,b=r.byteOffset;return b%s!==0&&(g=new Uint8Array(g).slice(b,b+f).buffer,b=0),new o(g,b,c)}function Qw(r,e,t){var g,b,T,S,F;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],o=r.getTypedArrayForAccessor(i),s=r.gltf.json,c=e.index,f=(b=(g=s.textures)==null?void 0:g[c])==null?void 0:b.source;if(typeof f<"u"){const k=(S=(T=s.images)==null?void 0:T[f])==null?void 0:S.mimeType,U=(F=r.gltf.images)==null?void 0:F[f];if(U&&typeof U.width<"u"){const j=[];for(let z=0;z<o.length;z+=2){const V=Jhe(U,k,o,z,e.channels);j.push(V)}return j}}return[]}function j4(r,e,t,n,i){if(!(t!=null&&t.length))return;const o=[];for(const b of t){let T=n.findIndex(S=>S===b);T===-1&&(T=n.push(b)-1),o.push(T)}const s=new Uint32Array(o),c=r.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,f=r.addBufferView(s,c,0),g=r.addAccessor(f,{size:1,componentType:qw(s),count:s.length});i.attributes[e]=g}function Jhe(r,e,t,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=t[n],c=t[n+1];let f=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(f=4);const g=Whe(s,c,r,f);let b=0;for(const T of i){const S=typeof T=="number"?Object.values(o)[T]:o[T],F=g+S.offset,k=yx(r);if(k.data.length<=F)throw new Error(`${k.data.length} <= ${F}`);const U=k.data[F];b|=U<<S.shift}return b}function Whe(r,e,t,n=1){const i=t.width,o=N3(r)*(i-1),s=Math.round(o),c=t.height,f=N3(e)*(c-1),g=Math.round(f),b=t.components?t.components:n;return(g*i+s)*b}function J4(r,e,t,n,i){const o=[];for(let s=0;s<e;s++){const c=t[s],f=t[s+1]-t[s];if(f+c>n)break;const g=c/i,b=f/i;o.push(r.slice(g,g+b))}return o}function W4(r,e,t){const n=[];for(let i=0;i<e;i++){const o=i*t;n.push(r.slice(o,o+t))}return n}function X4(r,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let c=0;c<r;c++){const f=n[c+1]-n[c];if(f+s<=e.length){const g=e.subarray(s,f+s),b=o.decode(g);i.push(b),s+=f}}return i}return[]}const $4="EXT_mesh_features",Xhe=$4;async function $he(r,e){const t=new ao(r);Khe(t,e)}function Khe(r,e){const t=r.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)qhe(r,i,e)}function qhe(r,e,t){var o,s,c;if(!((o=t==null?void 0:t.gltf)!=null&&o.loadBuffers))return;const n=(s=e.extensions)==null?void 0:s[$4],i=n==null?void 0:n.featureIds;if(i)for(const f of i){let g;if(typeof f.attribute<"u"){const b=`_FEATURE_ID_${f.attribute}`,T=e.attributes[b];g=r.getTypedArrayForAccessor(T)}else typeof f.texture<"u"&&((c=t==null?void 0:t.gltf)!=null&&c.loadImages)?g=Qw(r,f.texture,e):g=[];f.data=g}}const Zhe=Object.freeze(Object.defineProperty({__proto__:null,decode:$he,name:Xhe},Symbol.toStringTag,{value:"Module"})),eC="EXT_structural_metadata",Yhe=eC;async function Qhe(r,e){const t=new ao(r);ede(t,e)}function ede(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(eC);t&&((i=e.gltf)!=null&&i.loadImages&&tde(r,t),rde(r,t))}function tde(r,e){const t=e.propertyTextures,n=r.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)ide(r,t,o,e)}function rde(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=nde(i,o);s&&ode(r,t,s)}}function nde(r,e){for(const t of r)if(t.class===e)return t;return null}function ide(r,e,t,n){var s;if(!e)return;const i=(s=t.extensions)==null?void 0:s[eC],o=i==null?void 0:i.propertyTextures;if(o)for(const c of o){const f=e[c];sde(r,f,t,n)}}function sde(r,e,t,n){var o;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const s in e.properties){const c=`${i}_${s}`,f=(o=e.properties)==null?void 0:o[s];if(!f)continue;f.data||(f.data=[]);const g=f.data,b=Qw(r,f,t);b!==null&&(j4(r,c,b,g,t),f.data=g,n.dataAttributeNames.push(c))}}function ode(r,e,t){var o,s;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],g=(s=t.properties)==null?void 0:s[c];if(g){const b=ade(r,e,f,i,g);g.data=b}}}function ade(r,e,t,n,i){let o=[];const s=i.values,c=r.getTypedArrayForBufferView(s),f=cde(r,t,i,n),g=lde(r,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=ude(t,n,c,f);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{o=X4(n,c,f,g);break}case"ENUM":{o=fde(e,t,n,c,f);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return o}function cde(r,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?wy(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function lde(r,e,t){return typeof e.stringOffsets<"u"?wy(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function ude(r,e,t,n){const i=r.array,o=r.count,s=Yw(r.type,r.componentType),c=t.byteLength/s;let f;return r.componentType?f=Cy(t,r.type,r.componentType,c):f=t,i?n?J4(f,e,n,t.length,s):o?W4(f,e,o):[]:f}function fde(r,e,t,n,i){var T;const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=(T=r.enums)==null?void 0:T[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const c=s.valueType||"UINT16",f=Yw(e.type,c),g=n.byteLength/f;let b=Cy(n,e.type,c,g);if(b||(b=n),e.array){if(i)return hde({valuesData:b,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:f,enumEntry:s});const S=e.count;return S?dde(b,t,S,s):[]}return tC(b,0,t,s)}function hde(r){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=r,c=[];for(let f=0;f<t;f++){const g=n[f],b=n[f+1]-n[f];if(b+g>i)break;const T=g/o,S=b/o,F=tC(e,T,S,s);c.push(F)}return c}function dde(r,e,t,n){const i=[];for(let o=0;o<e;o++){const s=t*o,c=tC(r,s,t,n);i.push(c)}return i}function tC(r,e,t,n){const i=[];for(let o=0;o<t;o++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)i.push("");else{const s=r[e+o],c=Ade(n,s);c?i.push(c.name):i.push("")}return i}function Ade(r,e){for(const t of r.values)if(t.value===e)return t;return null}const pde=Object.freeze(Object.defineProperty({__proto__:null,decode:Qhe,name:Yhe},Symbol.toStringTag,{value:"Module"})),K4="EXT_feature_metadata",gde=K4;async function mde(r,e){const t=new ao(r);_de(t,e)}function _de(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(K4);t&&((i=e.gltf)!=null&&i.loadImages&&yde(r,t),vde(r,t))}function yde(r,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],c=xde(i,o);c&&Cde(r,c,s)}}function vde(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=bde(i,o);s&&wde(r,t,s)}}function bde(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function xde(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function wde(r,e,t){var o,s;if(!t.class)return;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],g=(s=t.properties)==null?void 0:s[c];if(g){const b=Ede(r,e,f,i,g);g.data=b}}}function Cde(r,e,t){var i;const n=e.class;for(const o in t.properties){const s=(i=e==null?void 0:e.properties)==null?void 0:i[o];if(s){const c=Mde(r,s,n);s.data=c}}}function Ede(r,e,t,n,i){let o=[];const s=i.bufferView,c=r.getTypedArrayForBufferView(s),f=Tde(r,t,i,n),g=Bde(r,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?o=X4(n,c,f,g):Sde(t)&&(o=Ide(t,n,c,f)),o}function Tde(r,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?wy(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function Bde(r,e,t,n){return typeof t.stringOffsetBufferView<"u"?wy(r,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function Sde(r){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function Ide(r,e,t,n){const i=r.type==="ARRAY",o=r.componentCount,s="SCALAR",c=r.componentType||r.type,f=Yw(s,c),g=t.byteLength/f,b=Cy(t,s,c,g);return i?n?J4(b,e,n,t.length,f):o?W4(b,e,o):[]:b}function Mde(r,e,t){const n=r.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)Pde(r,t,e,i,s);return i}function Pde(r,e,t,n,i){const o={channels:t.channels,...t.texture},s=Qw(r,o,i);s&&j4(r,e,s,n,i)}const Rde=Object.freeze(Object.defineProperty({__proto__:null,decode:mde,name:gde},Symbol.toStringTag,{value:"Module"})),Fde="4.2.4",mA=!0,k3=1735152710,rC=12,__=8,Dde=1313821514,Ode=5130562,Lde=0,Nde=0,kde=1;function Ude(r,e=0){return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function zde(r,e=0,t={}){const n=new DataView(r),{magic:i=k3}=t,o=n.getUint32(e,!1);return o===i||o===k3}function Gde(r,e,t=0,n={}){const i=new DataView(e),o=Ude(i,t+0),s=i.getUint32(t+4,mA),c=i.getUint32(t+8,mA);switch(Object.assign(r,{header:{byteOffset:t,byteLength:c,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),t+=rC,r.version){case 1:return Vde(r,i,t);case 2:return Hde(r,i,t,n={});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function Vde(r,e,t){$n(r.header.byteLength>rC+__);const n=e.getUint32(t+0,mA),i=e.getUint32(t+4,mA);return t+=__,$n(i===Lde),q2(r,e,t,n),t+=n,t+=Z2(r,e,t,r.header.byteLength),t}function Hde(r,e,t,n){return $n(r.header.byteLength>rC+__),jde(r,e,t,n),t+r.header.byteLength}function jde(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,mA),o=e.getUint32(t+4,mA);switch(t+=__,o){case Dde:q2(r,e,t,i);break;case Ode:Z2(r,e,t,i);break;case Nde:n.strict||q2(r,e,t,i);break;case kde:n.strict||Z2(r,e,t,i);break}t+=Gl(i,4)}return t}function q2(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),s=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(s),Gl(n,4)}function Z2(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),Gl(n,4)}function q4(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return n.substr(0,n.lastIndexOf("/")+1)+r}const Jde="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Wde="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Xde=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),$de=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Kde={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},qde={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Zde(r,e,t,n,i,o="NONE"){const s=await Yde();tAe(s,s.exports[qde[i]],r,e,t,n,s.exports[Kde[o||"NONE"]])}let rb;async function Yde(){return rb||(rb=Qde()),rb}async function Qde(){let r=Jde;WebAssembly.validate(Xde)&&(r=Wde,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(eAe(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function eAe(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?$de[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function tAe(r,e,t,n,i,o,s){const c=r.exports.sbrk,f=n+3&-4,g=c(f*i),b=c(o.length),T=new Uint8Array(r.exports.memory.buffer);T.set(o,b);const S=e(g,n,i,b,o.length);if(S===0&&s&&s(g,f,i),t.set(T.subarray(g,g+n*i)),c(g-c(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const y_="EXT_meshopt_compression",rAe=y_;async function nAe(r,e){var i,o;const t=new ao(r);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((o=e.gltf)!=null&&o.loadBuffers))return;const n=[];for(const s of r.json.bufferViews||[])n.push(iAe(t,s));await Promise.all(n),t.removeExtension(y_)}async function iAe(r,e){const t=r.getObjectExtension(e,y_);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:c,filter:f="NONE",buffer:g}=t,b=r.gltf.buffers[g],T=new Uint8Array(b.arrayBuffer,b.byteOffset+n,i),S=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Zde(S,s,o,T,c,f),r.removeObjectExtension(e,y_)}}const sAe=Object.freeze(Object.defineProperty({__proto__:null,decode:nAe,name:rAe},Symbol.toStringTag,{value:"Module"})),Sd="EXT_texture_webp",oAe=Sd;function aAe(r,e){const t=new ao(r);if(!_F("image/webp")){if(t.getRequiredExtensions().includes(Sd))throw new Error(`gltf: Required extension ${Sd} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Sd);o&&(i.source=o.source),t.removeObjectExtension(i,Sd)}t.removeExtension(Sd)}const cAe=Object.freeze(Object.defineProperty({__proto__:null,name:oAe,preprocess:aAe},Symbol.toStringTag,{value:"Module"})),Pm="KHR_texture_basisu",lAe=Pm;function uAe(r,e){const t=new ao(r),{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Pm);o&&(i.source=o.source,t.removeObjectExtension(i,Pm))}t.removeExtension(Pm)}const fAe=Object.freeze(Object.defineProperty({__proto__:null,name:lAe,preprocess:uAe},Symbol.toStringTag,{value:"Module"}));function hAe(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=Z4(n);e[t]=i}}return e}function Z4(r){const{buffer:e,size:t,count:n}=dAe(r);return{value:e,size:t,byteOffset:0,count:n,type:z4(t),componentType:qw(e)}}function dAe(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=AAe(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function AAe(r,e,t=!1){return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const Ju="KHR_draco_mesh_compression",pAe=Ju;function gAe(r,e,t){const n=new ao(r);for(const i of Y4(n))n.getObjectExtension(i,Ju)}async function mAe(r,e,t){var o;if(!((o=e==null?void 0:e.gltf)!=null&&o.decompressMeshes))return;const n=new ao(r),i=[];for(const s of Y4(n))n.getObjectExtension(s,Ju)&&i.push(yAe(n,s,e,t));await Promise.all(i),n.removeExtension(Ju)}function _Ae(r,e={}){const t=new ao(r);for(const n of t.json.meshes||[])vAe(n),t.addRequiredExtension(Ju)}async function yAe(r,e,t,n){const i=r.getObjectExtension(e,Ju);if(!i)return;const o=r.getTypedArrayForBufferView(i.bufferView),s=hg(o.buffer,o.byteOffset),c={...t};delete c["3d-tiles"];const f=await rh(s,Jw,c,n),g=hAe(f.attributes);for(const[b,T]of Object.entries(g))if(b in e.attributes){const S=e.attributes[b],F=r.getAccessor(S);F!=null&&F.min&&(F!=null&&F.max)&&(T.min=F.min,T.max=F.max)}e.attributes=g,f.indices&&(e.indices=Z4(f.indices)),r.removeObjectExtension(e,Ju),bAe(e)}function vAe(r,e,t=4,n,i){var b;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:r}),s=(b=i==null?void 0:i.parseSync)==null?void 0:b.call(i,{attributes:r}),c=n._addFauxAttributes(s.attributes),f=n.addBufferView(o);return{primitives:[{attributes:c,mode:t,extensions:{[Ju]:{bufferView:f,attributes:c}}}]}}function bAe(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Y4(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const xAe=Object.freeze(Object.defineProperty({__proto__:null,decode:mAe,encode:_Ae,name:pAe,preprocess:gAe},Symbol.toStringTag,{value:"Module"})),Ey="KHR_texture_transform",wAe=Ey,em=new ft,CAe=new li,EAe=new li;async function TAe(r,e){var o;if(!new ao(r).hasExtension(Ey)||!((o=e.gltf)!=null&&o.loadBuffers))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)BAe(s,r)}function BAe(r,e){var o,s,c,f;const t=(o=e.json.materials)==null?void 0:o[r],n=[(s=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:s.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(c=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:c.metallicRoughnessTexture],i=[];for(const g of n)g&&((f=g==null?void 0:g.extensions)!=null&&f[Ey])&&SAe(e,r,g,i)}function SAe(r,e,t,n){const i=IAe(t,n);if(!i)return;const o=r.json.meshes||[];for(const s of o)for(const c of s.primitives){const f=c.material;Number.isFinite(f)&&e===f&&MAe(r,c,i)}}function IAe(r,e){var s;const t=(s=r.extensions)==null?void 0:s[Ey],{texCoord:n=0}=r,{texCoord:i=n}=t;if(!(e.findIndex(([c,f])=>c===n&&f===i)!==-1)){const c=FAe(t);return n!==i&&(r.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:c}}return null}function MAe(r,e,t){var c,f;const{originalTexCoord:n,texCoord:i,matrix:o}=t,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const g=(c=r.json.accessors)==null?void 0:c[s];if(g&&g.bufferView){const b=(f=r.json.bufferViews)==null?void 0:f[g.bufferView];if(b){const{arrayBuffer:T,byteOffset:S}=r.buffers[b.buffer],F=(S||0)+(g.byteOffset||0)+(b.byteOffset||0),{ArrayType:k,length:U}=Zw(g,b),j=U4[g.componentType],z=k4[g.type],V=b.byteStride||j*z,K=new Float32Array(U);for(let fe=0;fe<g.count;fe++){const Q=new k(T,F+fe*V,2);em.set(Q[0],Q[1],1),em.transformByMatrix3(o),K.set([em[0],em[1]],fe*z)}n===i?PAe(g,b,r.buffers,K):RAe(i,g,e,r,K)}}}}function PAe(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function RAe(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=s.length-1)}function FAe(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new li().set(1,0,0,0,1,0,e[0],e[1],1),o=CAe.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),s=EAe.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const DAe=Object.freeze(Object.defineProperty({__proto__:null,decode:TAe,name:wAe},Symbol.toStringTag,{value:"Module"})),Hf="KHR_lights_punctual",OAe=Hf;async function LAe(r){const e=new ao(r),{json:t}=e,n=e.getExtension(Hf);n&&(e.json.lights=n.lights,e.removeExtension(Hf));for(const i of t.nodes||[]){const o=e.getObjectExtension(i,Hf);o&&(i.light=o.light),e.removeObjectExtension(i,Hf)}}async function NAe(r){const e=new ao(r),{json:t}=e;if(t.lights){const n=e.addExtension(Hf);na(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,Hf,n)}delete e.json.lights}}const kAe=Object.freeze(Object.defineProperty({__proto__:null,decode:LAe,encode:NAe,name:OAe},Symbol.toStringTag,{value:"Module"})),ug="KHR_materials_unlit",UAe=ug;async function zAe(r){const e=new ao(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,ug);e.removeExtension(ug)}function GAe(r){const e=new ao(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,ug,{}),e.addExtension(ug))}const VAe=Object.freeze(Object.defineProperty({__proto__:null,decode:zAe,encode:GAe,name:UAe},Symbol.toStringTag,{value:"Module"})),Pp="KHR_techniques_webgl",HAe=Pp;async function jAe(r){const e=new ao(r),{json:t}=e,n=e.getExtension(Pp);if(n){const i=WAe(n,e);for(const o of t.materials||[]){const s=e.getObjectExtension(o,Pp);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=XAe(o.technique,e)),e.removeObjectExtension(o,Pp)}e.removeExtension(Pp)}}async function JAe(r,e){}function WAe(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=t[s.program]}),i}function XAe(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const $Ae=Object.freeze(Object.defineProperty({__proto__:null,decode:jAe,encode:JAe,name:HAe},Symbol.toStringTag,{value:"Module"})),Q4=[pde,Zhe,sAe,cAe,fAe,xAe,kAe,VAe,$Ae,DAe,Rde];function KAe(r,e={},t){var i;const n=Q4.filter(o=>eL(o.name,e));for(const o of n)(i=o.preprocess)==null||i.call(o,r,e,t)}async function qAe(r,e={},t){var i;const n=Q4.filter(o=>eL(o.name,e));for(const o of n)await((i=o.decode)==null?void 0:i.call(o,r,e,t))}function eL(r,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(r in t&&!t[r])}const nb="KHR_binary_glTF";function ZAe(r){const e=new ao(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,nb);i&&Object.assign(n,i),e.removeObjectExtension(n,nb)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(nb)}const U3={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},YAe={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class QAe{constructor(){J(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});J(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),ZAe(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in U3)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const o=n[i];o.id=o.id||i;const s=e[t].length;e[t].push(o),this.idToIndexMap[t][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in U3)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:o}=t;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const o=n[i],s=this._convertIdToIndex(o,i);n[i]=s}}_convertIdToIndex(e,t){const n=YAe[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const o of e.materials){o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=((t=o.values)==null?void 0:t.tex)||((n=o.values)==null?void 0:n.texture2d_0)||((i=o.values)==null?void 0:i.diffuseTex),c=e.textures.findIndex(f=>f.id===s);c!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:c})}}}function epe(r,e={}){return new QAe().normalize(r,e)}async function tpe(r,e,t=0,n,i){var o,s,c;return rpe(r,e,t,n),epe(r,{normalize:(o=n==null?void 0:n.gltf)==null?void 0:o.normalize}),KAe(r,n,i),(s=n==null?void 0:n.gltf)!=null&&s.loadBuffers&&r.json.buffers&&await npe(r,n,i),(c=n==null?void 0:n.gltf)!=null&&c.loadImages&&await ipe(r,n,i),await qAe(r,n,i),r}function rpe(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!zde(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=YR(e);else if(e instanceof ArrayBuffer){const s={};t=Gde(s,e,t,n.glb),na(s.type==="glTF",`Invalid GLB magic string ${s.type}`),r._glb=s,r.json=s.json}else na(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:s}=r._glb;r.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=r.json.images||[];r.images=new Array(o.length).fill({})}async function npe(r,e,t){var i,o;const n=r.json.buffers||[];for(let s=0;s<n.length;++s){const c=n[s];if(c.uri){const{fetch:f}=t;na(f);const g=q4(c.uri,e),b=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,g)),T=await((o=b==null?void 0:b.arrayBuffer)==null?void 0:o.call(b));r.buffers[s]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete c.uri}else r.buffers[s]===null&&(r.buffers[s]={arrayBuffer:new ArrayBuffer(c.byteLength),byteOffset:0,byteLength:c.byteLength})}}async function ipe(r,e,t){const n=spe(r),i=r.json.images||[],o=[];for(const s of n)o.push(ope(r,i[s],s,e,t));return await Promise.all(o)}function spe(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function ope(r,e,t,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const c=q4(e.uri,n),{fetch:f}=i;o=await(await f(c)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const c=Ghe(r.json,r.buffers,e.bufferView);o=hg(c.buffer,c.byteOffset,c.byteLength)}na(o,"glTF image has no data");let s=await rh(o,[rA,c4],{...n,mimeType:e.mimeType,basis:n.basis||{format:Nw()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),r.images=r.images||[],r.images[t]=s}const v_={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Fde,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:ape,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function ape(r,e={},t){e={...v_.options,...e},e.gltf={...v_.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await tpe({},r,n,e,t)}const cpe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lpe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ba={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},upe={magFilter:ba.TEXTURE_MAG_FILTER,minFilter:ba.TEXTURE_MIN_FILTER,wrapS:ba.TEXTURE_WRAP_S,wrapT:ba.TEXTURE_WRAP_T},fpe={[ba.TEXTURE_MAG_FILTER]:ba.LINEAR,[ba.TEXTURE_MIN_FILTER]:ba.NEAREST_MIPMAP_LINEAR,[ba.TEXTURE_WRAP_S]:ba.REPEAT,[ba.TEXTURE_WRAP_T]:ba.REPEAT};function hpe(){return{id:"default-sampler",parameters:fpe}}function dpe(r){return lpe[r]}function Ape(r){return cpe[r]}class ppe{constructor(){J(this,"baseUri","");J(this,"jsonUnprocessed");J(this,"json");J(this,"buffers",[]);J(this,"images",[])}postProcess(e,t={}){const{json:n,buffers:i=[],images:o=[]}=e,{baseUri:s=""}=e;return na(n),this.baseUri=s,this.buffers=i,this.images=o,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((i,o)=>this._resolveBufferView(i,o))),e.images&&(n.images=e.images.map((i,o)=>this._resolveImage(i,o))),e.samplers&&(n.samplers=e.samplers.map((i,o)=>this._resolveSampler(i,o))),e.textures&&(n.textures=e.textures.map((i,o)=>this._resolveTexture(i,o))),e.accessors&&(n.accessors=e.accessors.map((i,o)=>this._resolveAccessor(i,o))),e.materials&&(n.materials=e.materials.map((i,o)=>this._resolveMaterial(i,o))),e.meshes&&(n.meshes=e.meshes.map((i,o)=>this._resolveMesh(i,o))),e.nodes&&(n.nodes=e.nodes.map((i,o)=>this._resolveNode(i,o)),n.nodes=n.nodes.map((i,o)=>this._resolveNodeChildren(i))),e.skins&&(n.skins=e.skins.map((i,o)=>this._resolveSkin(i,o))),e.scenes&&(n.scenes=e.scenes.map((i,o)=>this._resolveScene(i,o))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,o)=>{const s=this.getMesh(o);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const o={...i,attributes:{},indices:void 0,material:void 0},s=i.attributes;for(const c in s)o.attributes[c]=this.getAccessor(s[c]);return i.indices!==void 0&&(o.indices=this.getAccessor(i.indices)),i.material!==void 0&&(o.material=this.getMaterial(i.material)),o})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=dpe(e.componentType),i=Ape(e.type),o=n*i,s={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:i,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){const c=s.bufferView.buffer,{ArrayType:f,byteLength:g}=Zw(s,s.bufferView),b=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+c.byteOffset;let T=c.arrayBuffer.slice(b,b+g);s.bufferView.byteStride&&(T=this._getValueFromInterleavedBuffer(c,b,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new f(T)}return s}_getValueFromInterleavedBuffer(e,t,n,i,o){const s=new Uint8Array(o*i);for(let c=0;c<o;c++){const f=t+c*n;s.set(new Uint8Array(e.arrayBuffer.slice(f,f+i)),c*i)}return s.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):hpe(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const o=this._enumSamplerParameter(i);o!==void 0&&(n.parameters[o]=n[i])}return n}_enumSamplerParameter(e){return upe[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let o=this.buffers[n].byteOffset||0;return e.byteOffset&&(o+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,o,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}}function tL(r,e){return new ppe().postProcess(r,e)}const Y2={URI:0,EMBEDDED:1};function rL(r,e,t,n){r.rotateYtoZ=!0;const i=(r.byteOffset||0)+(r.byteLength||0)-t;if(i===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=n!=null&&n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=hg(e,t,i),r.gltfByteOffset=0,r.gltfByteLength=i,t%4===0||console.warn(`${r.type}: embedded glb is not aligned to a 4-byte boundary.`),(r.byteOffset||0)+(r.byteLength||0)}async function nL(r,e,t,n){const i=(t==null?void 0:t["3d-tiles"])||{};if(gpe(r,e),i.loadGLTF){if(!n)return;if(r.gltfUrl){const{fetch:o}=n,s=await o(r.gltfUrl,t);r.gltfArrayBuffer=await s.arrayBuffer(),r.gltfByteOffset=0}if(r.gltfArrayBuffer){const o=await rh(r.gltfArrayBuffer,v_,t,n);r.gltf=tL(o),r.gpuMemoryUsageInBytes=G4(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength}}}function gpe(r,e,t){switch(e){case Y2.URI:if(r.gltfArrayBuffer){const n=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),o=new TextDecoder().decode(n);r.gltfUrl=o.replace(/[\s\0]+$/,"")}delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case Y2.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function mpe(r,e,t,n,i){var s;t=_pe(r,e,t,n),await nL(r,Y2.EMBEDDED,n,i);const o=(s=r==null?void 0:r.gltf)==null?void 0:s.extensions;return o&&o.CESIUM_RTC&&(r.rtcCenter=o.CESIUM_RTC.center),t}function _pe(r,e,t,n,i){t=xy(r,e,t),t=$w(r,e,t),t=Kw(r,e,t),t=rL(r,e,t,n);const o=new Xw(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=o.getGlobalProperty("RTC_CENTER",Dn.FLOAT,3),t}async function ype(r,e,t,n,i){return t=vpe(r,e,t,n),await nL(r,r.gltfFormat||0,n,i),t}function vpe(r,e,t,n,i){var g;if(t=xy(r,e,t),r.version!==1)throw new Error(`Instanced 3D Model version ${r.version} is not supported`);t=$w(r,e,t);const o=new DataView(e);if(r.gltfFormat=o.getUint32(t,!0),t+=4,t=Kw(r,e,t),t=rL(r,e,t,n),!((g=r==null?void 0:r.header)!=null&&g.featureTableJsonByteLength)||r.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const s=new Xw(r.featureTableJson,r.featureTableBinary),c=s.getGlobalProperty("INSTANCES_LENGTH");if(s.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=s.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=s.getGlobalProperty("RTC_CENTER",Dn.FLOAT,3);const f=new L4(r.batchTableJson,r.batchTableBinary,c);return bpe(r,s,f,c),t}function bpe(r,e,t,n){const i=new Array(n),o=new ft;new ft,new ft,new ft;const s=new li,c=new Yp,f=new ft,g={},b=new dn,T=[],S=[],F=[],k=[];for(let U=0;U<n;U++){let j;if(e.hasProperty("POSITION"))j=e.getProperty("POSITION",Dn.FLOAT,3,U,o);else if(e.hasProperty("POSITION_QUANTIZED")){j=e.getProperty("POSITION_QUANTIZED",Dn.UNSIGNED_SHORT,3,U,o);const oe=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Dn.FLOAT,3);if(!oe)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Te=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Dn.FLOAT,3);if(!Te)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const ze=65535;for(let Ae=0;Ae<3;Ae++)j[Ae]=j[Ae]/ze*Te[Ae]+oe[Ae]}if(!j)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(j),g.translation=o,r.normalUp=e.getProperty("NORMAL_UP",Dn.FLOAT,3,U,T),r.normalRight=e.getProperty("NORMAL_RIGHT",Dn.FLOAT,3,U,S),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Dn.UNSIGNED_SHORT,2,U,T),r.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Dn.UNSIGNED_SHORT,2,U,S),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(gi.WGS84.eastNorthUpToFixedFrame(o,b),b.getRotationMatrix3(s)):s.identity()}c.fromMatrix3(s),g.rotation=c,f.set(1,1,1);const z=e.getProperty("SCALE",Dn.FLOAT,1,U,F);Number.isFinite(z)&&f.multiplyByScalar(z);const V=e.getProperty("SCALE_NON_UNIFORM",Dn.FLOAT,3,U,T);V&&f.scale(V),g.scale=f;let K=e.getProperty("BATCH_ID",Dn.UNSIGNED_SHORT,1,U,k);K===void 0&&(K=U);const fe=new dn().fromQuaternion(g.rotation);b.identity(),b.translate(g.translation),b.multiplyRight(fe),b.scale(g.scale);const Q=b.clone();i[U]={modelMatrix:Q,batchId:K}}r.instances=i}async function xpe(r,e,t,n,i,o){t=xy(r,e,t);const s=new DataView(e);for(r.tilesLength=s.getUint32(t,!0),t+=4,r.tiles=[];r.tiles.length<r.tilesLength&&(r.byteLength||0)-t>12;){const c={shape:"tile3d"};r.tiles.push(c),t=await o(e,t,n,i,c)}return t}async function wpe(r,e,t,n){var i,o;if(r.rotateYtoZ=!0,r.gltfUpAxis=(i=t==null?void 0:t["3d-tiles"])!=null&&i.assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y",(o=t==null?void 0:t["3d-tiles"])!=null&&o.loadGLTF){if(!n)return e.byteLength;const s=await rh(e,v_,t,n);r.gltf=tL(s),r.gpuMemoryUsageInBytes=G4(r.gltf)}else r.gltfArrayBuffer=e;return e.byteLength}async function iL(r,e=0,t,n,i={shape:"tile3d"}){switch(i.byteOffset=e,i.type=ihe(r,e),i.type){case _p.COMPOSITE:return await xpe(i,r,e,t,n,iL);case _p.BATCHED_3D_MODEL:return await mpe(i,r,e,t,n);case _p.GLTF:return await wpe(i,r,t,n);case _p.INSTANCED_3D_MODEL:return await ype(i,r,e,t,n);case _p.POINT_CLOUD:return await The(i,r,e,t,n);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}const Cpe=1952609651,Epe=1;async function Tpe(r,e,t){if(new Uint32Array(r.slice(0,4))[0]!==Cpe)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==Epe)throw new Error("Wrong subtree file verson, must be 1");const o=z3(r.slice(8,16)),s=new Uint8Array(r,24,o),f=new TextDecoder("utf8").decode(s),g=JSON.parse(f),b=z3(r.slice(16,24));let T=new ArrayBuffer(0);if(b&&(T=r.slice(24+o)),await tm(g,g.tileAvailability,T,t),Array.isArray(g.contentAvailability))for(const S of g.contentAvailability)await tm(g,S,T,t);else await tm(g,g.contentAvailability,T,t);return await tm(g,g.childSubtreeAvailability,T,t),g}async function tm(r,e,t,n){const i=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof i!="number")return;const o=r.bufferViews[i],s=r.buffers[o.buffer];if(!(n!=null&&n.baseUrl))throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(s.uri){const f=`${(n==null?void 0:n.baseUrl)||""}/${s.uri}`,b=await(await n.fetch(f)).arrayBuffer();e.explicitBitstream=new Uint8Array(b,o.byteOffset,o.byteLength);return}const c=r.buffers.slice(0,o.buffer).reduce((f,g)=>f+g.byteLength,0);e.explicitBitstream=new Uint8Array(t.slice(c,c+s.byteLength),o.byteOffset,o.byteLength)}function z3(r){const e=new DataView(r),t=e.getUint32(0,!0),n=e.getUint32(4,!0);return t+2**32*n}const sL={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:F4,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Tpe,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ea=null;try{Ea=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ei(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}ei.prototype.__isLong__;Object.defineProperty(ei.prototype,"__isLong__",{value:!0});function co(r){return(r&&r.__isLong__)===!0}function G3(r){var e=Math.clz32(r&-r);return r?31-e:e}ei.isLong=co;var V3={},H3={};function uh(r,e){var t,n,i;return e?(r>>>=0,(i=0<=r&&r<256)&&(n=H3[r],n)?n:(t=Ln(r,0,!0),i&&(H3[r]=t),t)):(r|=0,(i=-128<=r&&r<128)&&(n=V3[r],n)?n:(t=Ln(r,r<0?-1:0,!1),i&&(V3[r]=t),t))}ei.fromInt=uh;function Ta(r,e){if(isNaN(r))return e?Ol:oc;if(e){if(r<0)return Ol;if(r>=oL)return lL}else{if(r<=-9223372036854776e3)return Po;if(r+1>=Spe)return cL}return r<0?Ta(-r,e).neg():Ln(r%_A|0,r/_A|0,e)}ei.fromNumber=Ta;function Ln(r,e,t){return new ei(r,e,t)}ei.fromBits=Ln;var b_=Math.pow;function nC(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?Ol:oc;if(t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return nC(r.substring(1),e,t).neg();for(var i=Ta(b_(t,8)),o=oc,s=0;s<r.length;s+=8){var c=Math.min(8,r.length-s),f=parseInt(r.substring(s,s+c),t);if(c<8){var g=Ta(b_(t,c));o=o.mul(g).add(Ta(f))}else o=o.mul(i),o=o.add(Ta(f))}return o.unsigned=e,o}ei.fromString=nC;function dc(r,e){return typeof r=="number"?Ta(r,e):typeof r=="string"?nC(r,e):Ln(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}ei.fromValue=dc;var j3=65536,Bpe=1<<24,_A=j3*j3,oL=_A*_A,Spe=oL/2,J3=uh(Bpe),oc=uh(0);ei.ZERO=oc;var Ol=uh(0,!0);ei.UZERO=Ol;var Gd=uh(1);ei.ONE=Gd;var aL=uh(1,!0);ei.UONE=aL;var Q2=uh(-1);ei.NEG_ONE=Q2;var cL=Ln(-1,2147483647,!1);ei.MAX_VALUE=cL;var lL=Ln(-1,-1,!0);ei.MAX_UNSIGNED_VALUE=lL;var Po=Ln(0,-2147483648,!1);ei.MIN_VALUE=Po;var Qt=ei.prototype;Qt.toInt=function(){return this.unsigned?this.low>>>0:this.low};Qt.toNumber=function(){return this.unsigned?(this.high>>>0)*_A+(this.low>>>0):this.high*_A+(this.low>>>0)};Qt.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Po)){var t=Ta(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Ta(b_(e,6),this.unsigned),s=this,c="";;){var f=s.div(o),g=s.sub(f.mul(o)).toInt()>>>0,b=g.toString(e);if(s=f,s.isZero())return b+c;for(;b.length<6;)b="0"+b;c=""+b+c}};Qt.getHighBits=function(){return this.high};Qt.getHighBitsUnsigned=function(){return this.high>>>0};Qt.getLowBits=function(){return this.low};Qt.getLowBitsUnsigned=function(){return this.low>>>0};Qt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Po)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};Qt.isZero=function(){return this.high===0&&this.low===0};Qt.eqz=Qt.isZero;Qt.isNegative=function(){return!this.unsigned&&this.high<0};Qt.isPositive=function(){return this.unsigned||this.high>=0};Qt.isOdd=function(){return(this.low&1)===1};Qt.isEven=function(){return(this.low&1)===0};Qt.equals=function(e){return co(e)||(e=dc(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Qt.eq=Qt.equals;Qt.notEquals=function(e){return!this.eq(e)};Qt.neq=Qt.notEquals;Qt.ne=Qt.notEquals;Qt.lessThan=function(e){return this.comp(e)<0};Qt.lt=Qt.lessThan;Qt.lessThanOrEqual=function(e){return this.comp(e)<=0};Qt.lte=Qt.lessThanOrEqual;Qt.le=Qt.lessThanOrEqual;Qt.greaterThan=function(e){return this.comp(e)>0};Qt.gt=Qt.greaterThan;Qt.greaterThanOrEqual=function(e){return this.comp(e)>=0};Qt.gte=Qt.greaterThanOrEqual;Qt.ge=Qt.greaterThanOrEqual;Qt.compare=function(e){if(co(e)||(e=dc(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Qt.comp=Qt.compare;Qt.negate=function(){return!this.unsigned&&this.eq(Po)?Po:this.not().add(Gd)};Qt.neg=Qt.negate;Qt.add=function(e){co(e)||(e=dc(e));var t=this.high>>>16,n=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,c=e.high&65535,f=e.low>>>16,g=e.low&65535,b=0,T=0,S=0,F=0;return F+=o+g,S+=F>>>16,F&=65535,S+=i+f,T+=S>>>16,S&=65535,T+=n+c,b+=T>>>16,T&=65535,b+=t+s,b&=65535,Ln(S<<16|F,b<<16|T,this.unsigned)};Qt.subtract=function(e){return co(e)||(e=dc(e)),this.add(e.neg())};Qt.sub=Qt.subtract;Qt.multiply=function(e){if(this.isZero())return this;if(co(e)||(e=dc(e)),Ea){var t=Ea.mul(this.low,this.high,e.low,e.high);return Ln(t,Ea.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Ol:oc;if(this.eq(Po))return e.isOdd()?Po:oc;if(e.eq(Po))return this.isOdd()?Po:oc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(J3)&&e.lt(J3))return Ta(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,o=this.low>>>16,s=this.low&65535,c=e.high>>>16,f=e.high&65535,g=e.low>>>16,b=e.low&65535,T=0,S=0,F=0,k=0;return k+=s*b,F+=k>>>16,k&=65535,F+=o*b,S+=F>>>16,F&=65535,F+=s*g,S+=F>>>16,F&=65535,S+=i*b,T+=S>>>16,S&=65535,S+=o*g,T+=S>>>16,S&=65535,S+=s*f,T+=S>>>16,S&=65535,T+=n*b+i*g+o*f+s*c,T&=65535,Ln(F<<16|k,T<<16|S,this.unsigned)};Qt.mul=Qt.multiply;Qt.divide=function(e){if(co(e)||(e=dc(e)),e.isZero())throw Error("division by zero");if(Ea){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ea.div_u:Ea.div_s)(this.low,this.high,e.low,e.high);return Ln(t,Ea.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ol:oc;var n,i,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ol;if(e.gt(this.shru(1)))return aL;o=Ol}else{if(this.eq(Po)){if(e.eq(Gd)||e.eq(Q2))return Po;if(e.eq(Po))return Gd;var s=this.shr(1);return n=s.div(e).shl(1),n.eq(oc)?e.isNegative()?Gd:Q2:(i=this.sub(e.mul(n)),o=n.add(i.div(e)),o)}else if(e.eq(Po))return this.unsigned?Ol:oc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=oc}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var c=Math.ceil(Math.log(n)/Math.LN2),f=c<=48?1:b_(2,c-48),g=Ta(n),b=g.mul(e);b.isNegative()||b.gt(i);)n-=f,g=Ta(n,this.unsigned),b=g.mul(e);g.isZero()&&(g=Gd),o=o.add(g),i=i.sub(b)}return o};Qt.div=Qt.divide;Qt.modulo=function(e){if(co(e)||(e=dc(e)),Ea){var t=(this.unsigned?Ea.rem_u:Ea.rem_s)(this.low,this.high,e.low,e.high);return Ln(t,Ea.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Qt.mod=Qt.modulo;Qt.rem=Qt.modulo;Qt.not=function(){return Ln(~this.low,~this.high,this.unsigned)};Qt.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Qt.clz=Qt.countLeadingZeros;Qt.countTrailingZeros=function(){return this.low?G3(this.low):G3(this.high)+32};Qt.ctz=Qt.countTrailingZeros;Qt.and=function(e){return co(e)||(e=dc(e)),Ln(this.low&e.low,this.high&e.high,this.unsigned)};Qt.or=function(e){return co(e)||(e=dc(e)),Ln(this.low|e.low,this.high|e.high,this.unsigned)};Qt.xor=function(e){return co(e)||(e=dc(e)),Ln(this.low^e.low,this.high^e.high,this.unsigned)};Qt.shiftLeft=function(e){return co(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ln(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Ln(0,this.low<<e-32,this.unsigned)};Qt.shl=Qt.shiftLeft;Qt.shiftRight=function(e){return co(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ln(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Ln(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Qt.shr=Qt.shiftRight;Qt.shiftRightUnsigned=function(e){return co(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ln(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Ln(this.high,0,this.unsigned):Ln(this.high>>>e-32,0,this.unsigned)};Qt.shru=Qt.shiftRightUnsigned;Qt.shr_u=Qt.shiftRightUnsigned;Qt.rotateLeft=function(e){var t;return co(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ln(this.high,this.low,this.unsigned):e<32?(t=32-e,Ln(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Ln(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};Qt.rotl=Qt.rotateLeft;Qt.rotateRight=function(e){var t;return co(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ln(this.high,this.low,this.unsigned):e<32?(t=32-e,Ln(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Ln(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};Qt.rotr=Qt.rotateRight;Qt.toSigned=function(){return this.unsigned?Ln(this.low,this.high,!1):this};Qt.toUnsigned=function(){return this.unsigned?this:Ln(this.low,this.high,!0)};Qt.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Qt.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Qt.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};ei.fromBytes=function(e,t,n){return n?ei.fromBytesLE(e,t):ei.fromBytesBE(e,t)};ei.fromBytesLE=function(e,t){return new ei(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};ei.fromBytesBE=function(e,t){return new ei(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Ipe=16;function uL(r){r==="X"&&(r="");const e=r.padEnd(Ipe,"0");return ei.fromString(e,!0,16)}function Mpe(r){if(r.isZero())return"X";let e=r.countTrailingZeros();const t=e%4;e=(e-t)/4;const n=e;e*=4;const o=r.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-o.length).join("0")+o}function Ppe(r,e){const t=Rpe(r).shiftRightUnsigned(2);return r.add(ei.fromNumber(2*e+1-4).multiply(t))}function Rpe(r){return r.and(r.not().add(1))}const Fpe=3,Dpe=30,Ope=2*Dpe+1,W3=180/Math.PI;function Lpe(r){if(r.length===0)throw new Error(`Invalid Hilbert quad key ${r}`);const e=r.split("/"),t=parseInt(e[0],10),n=e[1],i=n.length;let o=0;const s=[0,0];for(let c=i-1;c>=0;c--){o=i-c;const f=n[c];let g=0,b=0;f==="1"?b=1:f==="2"?(g=1,b=1):f==="3"&&(g=1);const T=Math.pow(2,o-1);kpe(T,s,g,b),s[0]+=T*g,s[1]+=T*b}if(t%2===1){const c=s[0];s[0]=s[1],s[1]=c}return{face:t,ij:s,level:o}}function Npe(r){if(r.isZero())return"";let e=r.toString(2);for(;e.length<Fpe+Ope;)e="0"+e;const t=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,t),o=i.length/2,s=ei.fromString(n,!0,2).toString(10);let c="";if(o!==0)for(c=ei.fromString(i,!0,2).toString(4);c.length<o;)c="0"+c;return`${s}/${c}`}function fL(r,e,t){const n=1<<e;return[(r[0]+t[0])/n,(r[1]+t[1])/n]}function X3(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function hL(r){return[X3(r[0]),X3(r[1])]}function dL(r,[e,t]){switch(r){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function AL([r,e,t]){const n=Math.atan2(t,Math.sqrt(r*r+e*e));return[Math.atan2(e,r)*W3,n*W3]}function kpe(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function Upe(r){const e=fL(r.ij,r.level,[.5,.5]),t=hL(e),n=dL(r.face,t);return AL(n)}const zpe=100;function $3(r){const{face:e,ij:t,level:n}=r,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(zpe*Math.pow(2,-n))),s=new Float64Array(4*o*2+2);let c=0,f=0;for(let g=0;g<4;g++){const b=i[g].slice(0),T=i[g+1],S=(T[0]-b[0])/o,F=(T[1]-b[1])/o;for(let k=0;k<o;k++){b[0]+=S,b[1]+=F;const U=fL(t,n,b),j=hL(U),z=dL(e,j),V=AL(z);Math.abs(V[1])>89.999&&(V[0]=f);const K=V[0]-f;V[0]+=K>180?-360:K<-180?360:0,s[c++]=V[0],s[c++]=V[1],f=V[0]}}return s[c++]=s[0],s[c++]=s[1],s}function iC(r){const e=Gpe(r);return Lpe(e)}function Gpe(r){if(r.indexOf("/")>0)return r;const e=uL(r);return Npe(e)}function Vpe(r){const e=iC(r);return Upe(e)}function Hpe(r){let e;if(r.face===2||r.face===5){let t=null,n=0;for(let i=0;i<4;i++){const o=`${r.face}/${i}`,s=iC(o),c=$3(s);(typeof t>"u"||t===null)&&(t=new Float64Array(4*c.length)),t.set(c,n),n+=c.length}e=K3(t)}else{const t=$3(r);e=K3(t)}return e}function K3(r){if(r.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let n=0;n<r.length;n+=2)e.push(r[n]),t.push(r[n+1]);return e.sort((n,i)=>n-i),t.sort((n,i)=>n-i),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function jpe(r,e){const t=(e==null?void 0:e.minimumHeight)||0,n=(e==null?void 0:e.maximumHeight)||0,i=iC(r),o=Hpe(i),s=o.west,c=o.south,f=o.east,g=o.north,b=[];return b.push(new ft(s,g,t)),b.push(new ft(f,g,t)),b.push(new ft(f,c,t)),b.push(new ft(s,c,t)),b.push(new ft(s,g,n)),b.push(new ft(f,g,n)),b.push(new ft(f,c,n)),b.push(new ft(s,c,n)),b}function pL(r){const e=r.token,t={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},n=jpe(e,t),i=Vpe(e),o=i[0],s=i[1],c=gi.WGS84.cartographicToCartesian([o,s,t.maximumHeight]),f=new ft(c[0],c[1],c[2]);n.push(f);const g=U6(n);return[...g.center,...g.halfAxes]}const Jpe=4,Wpe=8,Xpe={QUADTREE:Jpe,OCTREE:Wpe};function $pe(r,e,t){if(r!=null&&r.box){const n=uL(r.s2VolumeInfo.token),i=Ppe(n,e),o=Mpe(i),s={...r.s2VolumeInfo};switch(s.token=o,t){case"OCTREE":const g=r.s2VolumeInfo,b=g.maximumHeight-g.minimumHeight,T=b/2,S=g.minimumHeight+b/2;g.minimumHeight=S-T,g.maximumHeight=S+T;break}return{box:pL(s),s2VolumeInfo:s}}}async function gL(r){const{implicitOptions:e,parentData:t={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,s2VolumeBox:i,loaderOptions:o}=r;let{subtree:s,level:c=0,globalData:f={level:0,mortonIndex:0,x:0,y:0,z:0}}=r;const{subdivisionScheme:g,subtreeLevels:b,maximumLevel:T,contentUrlTemplate:S,subtreesUriTemplate:F,basePath:k}=e,U={children:[],lodMetricValue:0,contentUrl:""};if(!T)return WR.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${S} won't be loaded...`),U;const j=c+f.level;if(j>T)return U;const z=Xpe[g],V=Math.log2(z),K=n&1,fe=n>>1&1,Q=n>>2&1,oe=(z**c-1)/(z-1);let Te=Mf(t.mortonIndex,n,V),ze=oe+Te,Ae=Mf(t.x,K,1),_e=Mf(t.y,fe,1),pe=Mf(t.z,Q,1),X=!1;c>=b&&(X=ib(s.childSubtreeAvailability,Te));const ne=Mf(f.x,Ae,c),Be=Mf(f.y,_e,c),Ze=Mf(f.z,pe,c);if(X){const rt=`${k}/${F}`,tt=ex(rt,j,ne,Be,Ze);s=await Nl(tt,sL,o),f={mortonIndex:Te,x:Ae,y:_e,z:pe,level:c},Te=0,ze=0,Ae=0,_e=0,pe=0,c=0}if(!ib(s.tileAvailability,ze))return U;ib(s.contentAvailability,ze)&&(U.contentUrl=ex(S,j,ne,Be,Ze));const Ge=c+1,Qe={mortonIndex:Te,x:Ae,y:_e,z:pe};for(let rt=0;rt<z;rt++){const tt=$pe(i,rt,g),lt=await gL({subtree:s,implicitOptions:e,loaderOptions:o,parentData:Qe,childIndex:rt,level:Ge,globalData:{...f},s2VolumeBox:tt});if(lt.contentUrl||lt.children.length){const mt=j+1,nt=Kpe(lt,mt,{childTileX:Ae,childTileY:_e,childTileZ:pe},e,i);U.children.push(nt)}}return U}function ib(r,e){let t;return Array.isArray(r)?(t=r[0],r.length>1&&WR.once('Not supported extension "3DTILES_multiple_contents" has been detected')):t=r,"constant"in t?!!t.constant:t.explicitBitstream?Ype(e,t.explicitBitstream):!1}function Kpe(r,e,t,n,i){const{basePath:o,refine:s,getRefine:c,lodMetricType:f,getTileType:g,rootLodMetricValue:b,rootBoundingVolume:T}=n,S=r.contentUrl&&r.contentUrl.replace(`${o}/`,""),F=b/2**e,k=i!=null&&i.box?{box:i.box}:T,U=qpe(e,k,t);return{children:r.children,contentUrl:r.contentUrl,content:{uri:S},id:r.contentUrl,refine:c(s),type:g(r),lodMetricType:f,lodMetricValue:F,geometricError:F,transform:r.transform,boundingVolume:U}}function qpe(r,e,t){if(e.region){const{childTileX:n,childTileY:i,childTileZ:o}=t,[s,c,f,g,b,T]=e.region,S=2**r,F=(f-s)/S,k=(g-c)/S,U=(T-b)/S,[j,z]=[s+F*n,s+F*(n+1)],[V,K]=[c+k*i,c+k*(i+1)],[fe,Q]=[b+U*o,b+U*(o+1)];return{region:[j,V,z,K,fe,Q]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function Mf(r,e,t){return(r<<t)+e}function ex(r,e,t,n,i){const o=Zpe({level:e,x:t,y:n,z:i});return r.replace(/{level}|{x}|{y}|{z}/gi,s=>o[s])}function Zpe(r){const e={};for(const t in r)e[`{${t}}`]=r[t];return e}function Ype(r,e){const t=Math.floor(r/8),n=r%8;return(e[t]>>n&1)===1}function sC(r,e=""){if(!e)return Dl.EMPTY;const n=e.split("?")[0].split(".").pop();switch(n){case"pnts":return Dl.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Dl.SCENEGRAPH;default:return n||Dl.EMPTY}}function oC(r){switch(r){case"REPLACE":case"replace":return cc.REPLACE;case"ADD":case"add":return cc.ADD;default:return r}}function tx(r,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(r,`${e}/`);return decodeURI(n.toString())}else if(r.startsWith("/"))return r;return g9(e,r)}function q3(r,e){var i;if(!r)return null;let t;if(r.content){const o=r.content.uri||((i=r.content)==null?void 0:i.url);typeof o<"u"&&(t=tx(o,e))}return{...r,id:t,contentUrl:t,lodMetricType:gA.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:sC(r,t),refine:oC(r.refine)}}async function Qpe(r,e,t){let n=null;const i=Y3(r.root);i&&r.root?n=await Z3(r.root,r,e,i,t):n=q3(r.root,e);const o=[];for(o.push(n);o.length>0;){const s=o.pop()||{},c=s.children||[],f=[];for(const g of c){const b=Y3(g);let T;b?T=await Z3(g,r,e,b,t):T=q3(g,e),T&&(f.push(T),o.push(T))}s.children=f}return n}async function Z3(r,e,t,n,i){var fe,Q,oe;const{subdivisionScheme:o,maximumLevel:s,availableLevels:c,subtreeLevels:f,subtrees:{uri:g}}=n,b=ex(g,0,0,0,0),T=tx(b,t),S=await Nl(T,sL,i),F=(fe=r.content)==null?void 0:fe.uri,k=F?tx(F,t):"",U=(Q=e==null?void 0:e.root)==null?void 0:Q.refine,j=r.geometricError,z=(oe=r.boundingVolume.extensions)==null?void 0:oe["3DTILES_bounding_volume_S2"];if(z){const ze={box:pL(z),s2VolumeInfo:z};r.boundingVolume=ze}const V=r.boundingVolume,K={contentUrlTemplate:k,subtreesUriTemplate:g,subdivisionScheme:o,subtreeLevels:f,maximumLevel:Number.isFinite(c)?c-1:s,refine:U,basePath:t,lodMetricType:gA.GEOMETRIC_ERROR,rootLodMetricValue:j,rootBoundingVolume:V,getTileType:sC,getRefine:oC};return await ege(r,t,S,K,i)}async function ege(r,e,t,n,i){if(!r)return null;const{children:o,contentUrl:s}=await gL({subtree:t,implicitOptions:n,loaderOptions:i});let c,f=null;return s&&(c=s,f={uri:s.replace(`${e}/`,"")}),{...r,id:c,contentUrl:c,lodMetricType:gA.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:sC(r,c),refine:oC(r.refine),content:f||r.content,children:o}}function Y3(r){var e;return((e=r==null?void 0:r.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(r==null?void 0:r.implicitTiling)}const mL={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:F4,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:tge,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function tge(r,e={},t){const n=e["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=(t==null?void 0:t.url)&&t.url.indexOf(".json")!==-1:i=n.isTileset,i?rge(r,e,t):nge(r,e,t)}async function rge(r,e,t){var f;const n=JSON.parse(new TextDecoder().decode(r)),i=(t==null?void 0:t.url)||"",o=ige(i),s=await Qpe(n,o,e||{});return{...n,shape:"tileset3d",loader:mL,url:i,queryString:(t==null?void 0:t.queryString)||"",basePath:o,root:s||n.root,type:So.TILES3D,lodMetricType:gA.GEOMETRIC_ERROR,lodMetricValue:((f=n.root)==null?void 0:f.geometricError)||0}}async function nge(r,e,t){const n={content:{shape:"tile3d",featureIds:null}};return await iL(r,0,e,t,n.content),n.content}function ige(r){return Ax(r)}var sb={},Q3;function ef(){return Q3||(Q3=1,function(r){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function t(o,s){return Object.prototype.hasOwnProperty.call(o,s)}r.assign=function(o){for(var s=Array.prototype.slice.call(arguments,1);s.length;){var c=s.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var f in c)t(c,f)&&(o[f]=c[f])}}return o},r.shrinkBuf=function(o,s){return o.length===s?o:o.subarray?o.subarray(0,s):(o.length=s,o)};var n={arraySet:function(o,s,c,f,g){if(s.subarray&&o.subarray){o.set(s.subarray(c,c+f),g);return}for(var b=0;b<f;b++)o[g+b]=s[c+b]},flattenChunks:function(o){var s,c,f,g,b,T;for(f=0,s=0,c=o.length;s<c;s++)f+=o[s].length;for(T=new Uint8Array(f),g=0,s=0,c=o.length;s<c;s++)b=o[s],T.set(b,g),g+=b.length;return T}},i={arraySet:function(o,s,c,f,g){for(var b=0;b<f;b++)o[g+b]=s[c+b]},flattenChunks:function(o){return[].concat.apply([],o)}};r.setTyped=function(o){o?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,n)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,i))},r.setTyped(e)}(sb)),sb}var hd={},$a={},Pf={},eP;function sge(){if(eP)return Pf;eP=1;var r=ef(),e=4,t=0,n=1,i=2;function o(Pe){for(var Ot=Pe.length;--Ot>=0;)Pe[Ot]=0}var s=0,c=1,f=2,g=3,b=258,T=29,S=256,F=S+1+T,k=30,U=19,j=2*F+1,z=15,V=16,K=7,fe=256,Q=16,oe=17,Te=18,ze=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ae=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=512,ne=new Array((F+2)*2);o(ne);var Be=new Array(k*2);o(Be);var Ze=new Array(X);o(Ze);var Ce=new Array(b-g+1);o(Ce);var Ne=new Array(T);o(Ne);var Ge=new Array(k);o(Ge);function Qe(Pe,Ot,Vt,sr,Ye){this.static_tree=Pe,this.extra_bits=Ot,this.extra_base=Vt,this.elems=sr,this.max_length=Ye,this.has_stree=Pe&&Pe.length}var rt,tt,lt;function mt(Pe,Ot){this.dyn_tree=Pe,this.max_code=0,this.stat_desc=Ot}function Tt(Pe){return Pe<256?Ze[Pe]:Ze[256+(Pe>>>7)]}function nt(Pe,Ot){Pe.pending_buf[Pe.pending++]=Ot&255,Pe.pending_buf[Pe.pending++]=Ot>>>8&255}function cr(Pe,Ot,Vt){Pe.bi_valid>V-Vt?(Pe.bi_buf|=Ot<<Pe.bi_valid&65535,nt(Pe,Pe.bi_buf),Pe.bi_buf=Ot>>V-Pe.bi_valid,Pe.bi_valid+=Vt-V):(Pe.bi_buf|=Ot<<Pe.bi_valid&65535,Pe.bi_valid+=Vt)}function $t(Pe,Ot,Vt){cr(Pe,Vt[Ot*2],Vt[Ot*2+1])}function Jt(Pe,Ot){var Vt=0;do Vt|=Pe&1,Pe>>>=1,Vt<<=1;while(--Ot>0);return Vt>>>1}function Lt(Pe){Pe.bi_valid===16?(nt(Pe,Pe.bi_buf),Pe.bi_buf=0,Pe.bi_valid=0):Pe.bi_valid>=8&&(Pe.pending_buf[Pe.pending++]=Pe.bi_buf&255,Pe.bi_buf>>=8,Pe.bi_valid-=8)}function lr(Pe,Ot){var Vt=Ot.dyn_tree,sr=Ot.max_code,Ye=Ot.stat_desc.static_tree,Mt=Ot.stat_desc.has_stree,ge=Ot.stat_desc.extra_bits,kt=Ot.stat_desc.extra_base,wt=Ot.stat_desc.max_length,W,yt,Et,Ee,Xe,ct,Z=0;for(Ee=0;Ee<=z;Ee++)Pe.bl_count[Ee]=0;for(Vt[Pe.heap[Pe.heap_max]*2+1]=0,W=Pe.heap_max+1;W<j;W++)yt=Pe.heap[W],Ee=Vt[Vt[yt*2+1]*2+1]+1,Ee>wt&&(Ee=wt,Z++),Vt[yt*2+1]=Ee,!(yt>sr)&&(Pe.bl_count[Ee]++,Xe=0,yt>=kt&&(Xe=ge[yt-kt]),ct=Vt[yt*2],Pe.opt_len+=ct*(Ee+Xe),Mt&&(Pe.static_len+=ct*(Ye[yt*2+1]+Xe)));if(Z!==0){do{for(Ee=wt-1;Pe.bl_count[Ee]===0;)Ee--;Pe.bl_count[Ee]--,Pe.bl_count[Ee+1]+=2,Pe.bl_count[wt]--,Z-=2}while(Z>0);for(Ee=wt;Ee!==0;Ee--)for(yt=Pe.bl_count[Ee];yt!==0;)Et=Pe.heap[--W],!(Et>sr)&&(Vt[Et*2+1]!==Ee&&(Pe.opt_len+=(Ee-Vt[Et*2+1])*Vt[Et*2],Vt[Et*2+1]=Ee),yt--)}}function tn(Pe,Ot,Vt){var sr=new Array(z+1),Ye=0,Mt,ge;for(Mt=1;Mt<=z;Mt++)sr[Mt]=Ye=Ye+Vt[Mt-1]<<1;for(ge=0;ge<=Ot;ge++){var kt=Pe[ge*2+1];kt!==0&&(Pe[ge*2]=Jt(sr[kt]++,kt))}}function Er(){var Pe,Ot,Vt,sr,Ye,Mt=new Array(z+1);for(Vt=0,sr=0;sr<T-1;sr++)for(Ne[sr]=Vt,Pe=0;Pe<1<<ze[sr];Pe++)Ce[Vt++]=sr;for(Ce[Vt-1]=sr,Ye=0,sr=0;sr<16;sr++)for(Ge[sr]=Ye,Pe=0;Pe<1<<Ae[sr];Pe++)Ze[Ye++]=sr;for(Ye>>=7;sr<k;sr++)for(Ge[sr]=Ye<<7,Pe=0;Pe<1<<Ae[sr]-7;Pe++)Ze[256+Ye++]=sr;for(Ot=0;Ot<=z;Ot++)Mt[Ot]=0;for(Pe=0;Pe<=143;)ne[Pe*2+1]=8,Pe++,Mt[8]++;for(;Pe<=255;)ne[Pe*2+1]=9,Pe++,Mt[9]++;for(;Pe<=279;)ne[Pe*2+1]=7,Pe++,Mt[7]++;for(;Pe<=287;)ne[Pe*2+1]=8,Pe++,Mt[8]++;for(tn(ne,F+1,Mt),Pe=0;Pe<k;Pe++)Be[Pe*2+1]=5,Be[Pe*2]=Jt(Pe,5);rt=new Qe(ne,ze,S+1,F,z),tt=new Qe(Be,Ae,0,k,z),lt=new Qe(new Array(0),_e,0,U,K)}function Ar(Pe){var Ot;for(Ot=0;Ot<F;Ot++)Pe.dyn_ltree[Ot*2]=0;for(Ot=0;Ot<k;Ot++)Pe.dyn_dtree[Ot*2]=0;for(Ot=0;Ot<U;Ot++)Pe.bl_tree[Ot*2]=0;Pe.dyn_ltree[fe*2]=1,Pe.opt_len=Pe.static_len=0,Pe.last_lit=Pe.matches=0}function In(Pe){Pe.bi_valid>8?nt(Pe,Pe.bi_buf):Pe.bi_valid>0&&(Pe.pending_buf[Pe.pending++]=Pe.bi_buf),Pe.bi_buf=0,Pe.bi_valid=0}function hr(Pe,Ot,Vt,sr){In(Pe),nt(Pe,Vt),nt(Pe,~Vt),r.arraySet(Pe.pending_buf,Pe.window,Ot,Vt,Pe.pending),Pe.pending+=Vt}function pr(Pe,Ot,Vt,sr){var Ye=Ot*2,Mt=Vt*2;return Pe[Ye]<Pe[Mt]||Pe[Ye]===Pe[Mt]&&sr[Ot]<=sr[Vt]}function rn(Pe,Ot,Vt){for(var sr=Pe.heap[Vt],Ye=Vt<<1;Ye<=Pe.heap_len&&(Ye<Pe.heap_len&&pr(Ot,Pe.heap[Ye+1],Pe.heap[Ye],Pe.depth)&&Ye++,!pr(Ot,sr,Pe.heap[Ye],Pe.depth));)Pe.heap[Vt]=Pe.heap[Ye],Vt=Ye,Ye<<=1;Pe.heap[Vt]=sr}function Sr(Pe,Ot,Vt){var sr,Ye,Mt=0,ge,kt;if(Pe.last_lit!==0)do sr=Pe.pending_buf[Pe.d_buf+Mt*2]<<8|Pe.pending_buf[Pe.d_buf+Mt*2+1],Ye=Pe.pending_buf[Pe.l_buf+Mt],Mt++,sr===0?$t(Pe,Ye,Ot):(ge=Ce[Ye],$t(Pe,ge+S+1,Ot),kt=ze[ge],kt!==0&&(Ye-=Ne[ge],cr(Pe,Ye,kt)),sr--,ge=Tt(sr),$t(Pe,ge,Vt),kt=Ae[ge],kt!==0&&(sr-=Ge[ge],cr(Pe,sr,kt)));while(Mt<Pe.last_lit);$t(Pe,fe,Ot)}function ti(Pe,Ot){var Vt=Ot.dyn_tree,sr=Ot.stat_desc.static_tree,Ye=Ot.stat_desc.has_stree,Mt=Ot.stat_desc.elems,ge,kt,wt=-1,W;for(Pe.heap_len=0,Pe.heap_max=j,ge=0;ge<Mt;ge++)Vt[ge*2]!==0?(Pe.heap[++Pe.heap_len]=wt=ge,Pe.depth[ge]=0):Vt[ge*2+1]=0;for(;Pe.heap_len<2;)W=Pe.heap[++Pe.heap_len]=wt<2?++wt:0,Vt[W*2]=1,Pe.depth[W]=0,Pe.opt_len--,Ye&&(Pe.static_len-=sr[W*2+1]);for(Ot.max_code=wt,ge=Pe.heap_len>>1;ge>=1;ge--)rn(Pe,Vt,ge);W=Mt;do ge=Pe.heap[1],Pe.heap[1]=Pe.heap[Pe.heap_len--],rn(Pe,Vt,1),kt=Pe.heap[1],Pe.heap[--Pe.heap_max]=ge,Pe.heap[--Pe.heap_max]=kt,Vt[W*2]=Vt[ge*2]+Vt[kt*2],Pe.depth[W]=(Pe.depth[ge]>=Pe.depth[kt]?Pe.depth[ge]:Pe.depth[kt])+1,Vt[ge*2+1]=Vt[kt*2+1]=W,Pe.heap[1]=W++,rn(Pe,Vt,1);while(Pe.heap_len>=2);Pe.heap[--Pe.heap_max]=Pe.heap[1],lr(Pe,Ot),tn(Vt,wt,Pe.bl_count)}function Jn(Pe,Ot,Vt){var sr,Ye=-1,Mt,ge=Ot[0*2+1],kt=0,wt=7,W=4;for(ge===0&&(wt=138,W=3),Ot[(Vt+1)*2+1]=65535,sr=0;sr<=Vt;sr++)Mt=ge,ge=Ot[(sr+1)*2+1],!(++kt<wt&&Mt===ge)&&(kt<W?Pe.bl_tree[Mt*2]+=kt:Mt!==0?(Mt!==Ye&&Pe.bl_tree[Mt*2]++,Pe.bl_tree[Q*2]++):kt<=10?Pe.bl_tree[oe*2]++:Pe.bl_tree[Te*2]++,kt=0,Ye=Mt,ge===0?(wt=138,W=3):Mt===ge?(wt=6,W=3):(wt=7,W=4))}function un(Pe,Ot,Vt){var sr,Ye=-1,Mt,ge=Ot[0*2+1],kt=0,wt=7,W=4;for(ge===0&&(wt=138,W=3),sr=0;sr<=Vt;sr++)if(Mt=ge,ge=Ot[(sr+1)*2+1],!(++kt<wt&&Mt===ge)){if(kt<W)do $t(Pe,Mt,Pe.bl_tree);while(--kt!==0);else Mt!==0?(Mt!==Ye&&($t(Pe,Mt,Pe.bl_tree),kt--),$t(Pe,Q,Pe.bl_tree),cr(Pe,kt-3,2)):kt<=10?($t(Pe,oe,Pe.bl_tree),cr(Pe,kt-3,3)):($t(Pe,Te,Pe.bl_tree),cr(Pe,kt-11,7));kt=0,Ye=Mt,ge===0?(wt=138,W=3):Mt===ge?(wt=6,W=3):(wt=7,W=4)}}function Kn(Pe){var Ot;for(Jn(Pe,Pe.dyn_ltree,Pe.l_desc.max_code),Jn(Pe,Pe.dyn_dtree,Pe.d_desc.max_code),ti(Pe,Pe.bl_desc),Ot=U-1;Ot>=3&&Pe.bl_tree[pe[Ot]*2+1]===0;Ot--);return Pe.opt_len+=3*(Ot+1)+5+5+4,Ot}function Nn(Pe,Ot,Vt,sr){var Ye;for(cr(Pe,Ot-257,5),cr(Pe,Vt-1,5),cr(Pe,sr-4,4),Ye=0;Ye<sr;Ye++)cr(Pe,Pe.bl_tree[pe[Ye]*2+1],3);un(Pe,Pe.dyn_ltree,Ot-1),un(Pe,Pe.dyn_dtree,Vt-1)}function vn(Pe){var Ot=4093624447,Vt;for(Vt=0;Vt<=31;Vt++,Ot>>>=1)if(Ot&1&&Pe.dyn_ltree[Vt*2]!==0)return t;if(Pe.dyn_ltree[9*2]!==0||Pe.dyn_ltree[10*2]!==0||Pe.dyn_ltree[13*2]!==0)return n;for(Vt=32;Vt<S;Vt++)if(Pe.dyn_ltree[Vt*2]!==0)return n;return t}var Wn=!1;function Ut(Pe){Wn||(Er(),Wn=!0),Pe.l_desc=new mt(Pe.dyn_ltree,rt),Pe.d_desc=new mt(Pe.dyn_dtree,tt),Pe.bl_desc=new mt(Pe.bl_tree,lt),Pe.bi_buf=0,Pe.bi_valid=0,Ar(Pe)}function dr(Pe,Ot,Vt,sr){cr(Pe,(s<<1)+(sr?1:0),3),hr(Pe,Ot,Vt)}function Tr(Pe){cr(Pe,c<<1,3),$t(Pe,fe,ne),Lt(Pe)}function Zr(Pe,Ot,Vt,sr){var Ye,Mt,ge=0;Pe.level>0?(Pe.strm.data_type===i&&(Pe.strm.data_type=vn(Pe)),ti(Pe,Pe.l_desc),ti(Pe,Pe.d_desc),ge=Kn(Pe),Ye=Pe.opt_len+3+7>>>3,Mt=Pe.static_len+3+7>>>3,Mt<=Ye&&(Ye=Mt)):Ye=Mt=Vt+5,Vt+4<=Ye&&Ot!==-1?dr(Pe,Ot,Vt,sr):Pe.strategy===e||Mt===Ye?(cr(Pe,(c<<1)+(sr?1:0),3),Sr(Pe,ne,Be)):(cr(Pe,(f<<1)+(sr?1:0),3),Nn(Pe,Pe.l_desc.max_code+1,Pe.d_desc.max_code+1,ge+1),Sr(Pe,Pe.dyn_ltree,Pe.dyn_dtree)),Ar(Pe),sr&&In(Pe)}function fi(Pe,Ot,Vt){return Pe.pending_buf[Pe.d_buf+Pe.last_lit*2]=Ot>>>8&255,Pe.pending_buf[Pe.d_buf+Pe.last_lit*2+1]=Ot&255,Pe.pending_buf[Pe.l_buf+Pe.last_lit]=Vt&255,Pe.last_lit++,Ot===0?Pe.dyn_ltree[Vt*2]++:(Pe.matches++,Ot--,Pe.dyn_ltree[(Ce[Vt]+S+1)*2]++,Pe.dyn_dtree[Tt(Ot)*2]++),Pe.last_lit===Pe.lit_bufsize-1}return Pf._tr_init=Ut,Pf._tr_stored_block=dr,Pf._tr_flush_block=Zr,Pf._tr_tally=fi,Pf._tr_align=Tr,Pf}var ob,tP;function _L(){if(tP)return ob;tP=1;function r(e,t,n,i){for(var o=e&65535|0,s=e>>>16&65535|0,c=0;n!==0;){c=n>2e3?2e3:n,n-=c;do o=o+t[i++]|0,s=s+o|0;while(--c);o%=65521,s%=65521}return o|s<<16|0}return ob=r,ob}var ab,rP;function yL(){if(rP)return ab;rP=1;function r(){for(var n,i=[],o=0;o<256;o++){n=o;for(var s=0;s<8;s++)n=n&1?3988292384^n>>>1:n>>>1;i[o]=n}return i}var e=r();function t(n,i,o,s){var c=e,f=s+o;n^=-1;for(var g=s;g<f;g++)n=n>>>8^c[(n^i[g])&255];return n^-1}return ab=t,ab}var cb,nP;function aC(){return nP||(nP=1,cb={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),cb}var iP;function oge(){if(iP)return $a;iP=1;var r=ef(),e=sge(),t=_L(),n=yL(),i=aC(),o=0,s=1,c=3,f=4,g=5,b=0,T=1,S=-2,F=-3,k=-5,U=-1,j=1,z=2,V=3,K=4,fe=0,Q=2,oe=8,Te=9,ze=15,Ae=8,_e=29,pe=256,X=pe+1+_e,ne=30,Be=19,Ze=2*X+1,Ce=15,Ne=3,Ge=258,Qe=Ge+Ne+1,rt=32,tt=42,lt=69,mt=73,Tt=91,nt=103,cr=113,$t=666,Jt=1,Lt=2,lr=3,tn=4,Er=3;function Ar(W,yt){return W.msg=i[yt],yt}function In(W){return(W<<1)-(W>4?9:0)}function hr(W){for(var yt=W.length;--yt>=0;)W[yt]=0}function pr(W){var yt=W.state,Et=yt.pending;Et>W.avail_out&&(Et=W.avail_out),Et!==0&&(r.arraySet(W.output,yt.pending_buf,yt.pending_out,Et,W.next_out),W.next_out+=Et,yt.pending_out+=Et,W.total_out+=Et,W.avail_out-=Et,yt.pending-=Et,yt.pending===0&&(yt.pending_out=0))}function rn(W,yt){e._tr_flush_block(W,W.block_start>=0?W.block_start:-1,W.strstart-W.block_start,yt),W.block_start=W.strstart,pr(W.strm)}function Sr(W,yt){W.pending_buf[W.pending++]=yt}function ti(W,yt){W.pending_buf[W.pending++]=yt>>>8&255,W.pending_buf[W.pending++]=yt&255}function Jn(W,yt,Et,Ee){var Xe=W.avail_in;return Xe>Ee&&(Xe=Ee),Xe===0?0:(W.avail_in-=Xe,r.arraySet(yt,W.input,W.next_in,Xe,Et),W.state.wrap===1?W.adler=t(W.adler,yt,Xe,Et):W.state.wrap===2&&(W.adler=n(W.adler,yt,Xe,Et)),W.next_in+=Xe,W.total_in+=Xe,Xe)}function un(W,yt){var Et=W.max_chain_length,Ee=W.strstart,Xe,ct,Z=W.prev_length,ie=W.nice_match,ue=W.strstart>W.w_size-Qe?W.strstart-(W.w_size-Qe):0,ve=W.window,Oe=W.w_mask,de=W.prev,be=W.strstart+Ge,ce=ve[Ee+Z-1],Se=ve[Ee+Z];W.prev_length>=W.good_match&&(Et>>=2),ie>W.lookahead&&(ie=W.lookahead);do if(Xe=yt,!(ve[Xe+Z]!==Se||ve[Xe+Z-1]!==ce||ve[Xe]!==ve[Ee]||ve[++Xe]!==ve[Ee+1])){Ee+=2,Xe++;do;while(ve[++Ee]===ve[++Xe]&&ve[++Ee]===ve[++Xe]&&ve[++Ee]===ve[++Xe]&&ve[++Ee]===ve[++Xe]&&ve[++Ee]===ve[++Xe]&&ve[++Ee]===ve[++Xe]&&ve[++Ee]===ve[++Xe]&&ve[++Ee]===ve[++Xe]&&Ee<be);if(ct=Ge-(be-Ee),Ee=be-Ge,ct>Z){if(W.match_start=yt,Z=ct,ct>=ie)break;ce=ve[Ee+Z-1],Se=ve[Ee+Z]}}while((yt=de[yt&Oe])>ue&&--Et!==0);return Z<=W.lookahead?Z:W.lookahead}function Kn(W){var yt=W.w_size,Et,Ee,Xe,ct,Z;do{if(ct=W.window_size-W.lookahead-W.strstart,W.strstart>=yt+(yt-Qe)){r.arraySet(W.window,W.window,yt,yt,0),W.match_start-=yt,W.strstart-=yt,W.block_start-=yt,Ee=W.hash_size,Et=Ee;do Xe=W.head[--Et],W.head[Et]=Xe>=yt?Xe-yt:0;while(--Ee);Ee=yt,Et=Ee;do Xe=W.prev[--Et],W.prev[Et]=Xe>=yt?Xe-yt:0;while(--Ee);ct+=yt}if(W.strm.avail_in===0)break;if(Ee=Jn(W.strm,W.window,W.strstart+W.lookahead,ct),W.lookahead+=Ee,W.lookahead+W.insert>=Ne)for(Z=W.strstart-W.insert,W.ins_h=W.window[Z],W.ins_h=(W.ins_h<<W.hash_shift^W.window[Z+1])&W.hash_mask;W.insert&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[Z+Ne-1])&W.hash_mask,W.prev[Z&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=Z,Z++,W.insert--,!(W.lookahead+W.insert<Ne)););}while(W.lookahead<Qe&&W.strm.avail_in!==0)}function Nn(W,yt){var Et=65535;for(Et>W.pending_buf_size-5&&(Et=W.pending_buf_size-5);;){if(W.lookahead<=1){if(Kn(W),W.lookahead===0&&yt===o)return Jt;if(W.lookahead===0)break}W.strstart+=W.lookahead,W.lookahead=0;var Ee=W.block_start+Et;if((W.strstart===0||W.strstart>=Ee)&&(W.lookahead=W.strstart-Ee,W.strstart=Ee,rn(W,!1),W.strm.avail_out===0)||W.strstart-W.block_start>=W.w_size-Qe&&(rn(W,!1),W.strm.avail_out===0))return Jt}return W.insert=0,yt===f?(rn(W,!0),W.strm.avail_out===0?lr:tn):(W.strstart>W.block_start&&(rn(W,!1),W.strm.avail_out===0),Jt)}function vn(W,yt){for(var Et,Ee;;){if(W.lookahead<Qe){if(Kn(W),W.lookahead<Qe&&yt===o)return Jt;if(W.lookahead===0)break}if(Et=0,W.lookahead>=Ne&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+Ne-1])&W.hash_mask,Et=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),Et!==0&&W.strstart-Et<=W.w_size-Qe&&(W.match_length=un(W,Et)),W.match_length>=Ne)if(Ee=e._tr_tally(W,W.strstart-W.match_start,W.match_length-Ne),W.lookahead-=W.match_length,W.match_length<=W.max_lazy_match&&W.lookahead>=Ne){W.match_length--;do W.strstart++,W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+Ne-1])&W.hash_mask,Et=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart;while(--W.match_length!==0);W.strstart++}else W.strstart+=W.match_length,W.match_length=0,W.ins_h=W.window[W.strstart],W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+1])&W.hash_mask;else Ee=e._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++;if(Ee&&(rn(W,!1),W.strm.avail_out===0))return Jt}return W.insert=W.strstart<Ne-1?W.strstart:Ne-1,yt===f?(rn(W,!0),W.strm.avail_out===0?lr:tn):W.last_lit&&(rn(W,!1),W.strm.avail_out===0)?Jt:Lt}function Wn(W,yt){for(var Et,Ee,Xe;;){if(W.lookahead<Qe){if(Kn(W),W.lookahead<Qe&&yt===o)return Jt;if(W.lookahead===0)break}if(Et=0,W.lookahead>=Ne&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+Ne-1])&W.hash_mask,Et=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),W.prev_length=W.match_length,W.prev_match=W.match_start,W.match_length=Ne-1,Et!==0&&W.prev_length<W.max_lazy_match&&W.strstart-Et<=W.w_size-Qe&&(W.match_length=un(W,Et),W.match_length<=5&&(W.strategy===j||W.match_length===Ne&&W.strstart-W.match_start>4096)&&(W.match_length=Ne-1)),W.prev_length>=Ne&&W.match_length<=W.prev_length){Xe=W.strstart+W.lookahead-Ne,Ee=e._tr_tally(W,W.strstart-1-W.prev_match,W.prev_length-Ne),W.lookahead-=W.prev_length-1,W.prev_length-=2;do++W.strstart<=Xe&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+Ne-1])&W.hash_mask,Et=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart);while(--W.prev_length!==0);if(W.match_available=0,W.match_length=Ne-1,W.strstart++,Ee&&(rn(W,!1),W.strm.avail_out===0))return Jt}else if(W.match_available){if(Ee=e._tr_tally(W,0,W.window[W.strstart-1]),Ee&&rn(W,!1),W.strstart++,W.lookahead--,W.strm.avail_out===0)return Jt}else W.match_available=1,W.strstart++,W.lookahead--}return W.match_available&&(Ee=e._tr_tally(W,0,W.window[W.strstart-1]),W.match_available=0),W.insert=W.strstart<Ne-1?W.strstart:Ne-1,yt===f?(rn(W,!0),W.strm.avail_out===0?lr:tn):W.last_lit&&(rn(W,!1),W.strm.avail_out===0)?Jt:Lt}function Ut(W,yt){for(var Et,Ee,Xe,ct,Z=W.window;;){if(W.lookahead<=Ge){if(Kn(W),W.lookahead<=Ge&&yt===o)return Jt;if(W.lookahead===0)break}if(W.match_length=0,W.lookahead>=Ne&&W.strstart>0&&(Xe=W.strstart-1,Ee=Z[Xe],Ee===Z[++Xe]&&Ee===Z[++Xe]&&Ee===Z[++Xe])){ct=W.strstart+Ge;do;while(Ee===Z[++Xe]&&Ee===Z[++Xe]&&Ee===Z[++Xe]&&Ee===Z[++Xe]&&Ee===Z[++Xe]&&Ee===Z[++Xe]&&Ee===Z[++Xe]&&Ee===Z[++Xe]&&Xe<ct);W.match_length=Ge-(ct-Xe),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=Ne?(Et=e._tr_tally(W,1,W.match_length-Ne),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(Et=e._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),Et&&(rn(W,!1),W.strm.avail_out===0))return Jt}return W.insert=0,yt===f?(rn(W,!0),W.strm.avail_out===0?lr:tn):W.last_lit&&(rn(W,!1),W.strm.avail_out===0)?Jt:Lt}function dr(W,yt){for(var Et;;){if(W.lookahead===0&&(Kn(W),W.lookahead===0)){if(yt===o)return Jt;break}if(W.match_length=0,Et=e._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,Et&&(rn(W,!1),W.strm.avail_out===0))return Jt}return W.insert=0,yt===f?(rn(W,!0),W.strm.avail_out===0?lr:tn):W.last_lit&&(rn(W,!1),W.strm.avail_out===0)?Jt:Lt}function Tr(W,yt,Et,Ee,Xe){this.good_length=W,this.max_lazy=yt,this.nice_length=Et,this.max_chain=Ee,this.func=Xe}var Zr;Zr=[new Tr(0,0,0,0,Nn),new Tr(4,4,8,4,vn),new Tr(4,5,16,8,vn),new Tr(4,6,32,32,vn),new Tr(4,4,16,16,Wn),new Tr(8,16,32,32,Wn),new Tr(8,16,128,128,Wn),new Tr(8,32,128,256,Wn),new Tr(32,128,258,1024,Wn),new Tr(32,258,258,4096,Wn)];function fi(W){W.window_size=2*W.w_size,hr(W.head),W.max_lazy_match=Zr[W.level].max_lazy,W.good_match=Zr[W.level].good_length,W.nice_match=Zr[W.level].nice_length,W.max_chain_length=Zr[W.level].max_chain,W.strstart=0,W.block_start=0,W.lookahead=0,W.insert=0,W.match_length=W.prev_length=Ne-1,W.match_available=0,W.ins_h=0}function Pe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=oe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(Ze*2),this.dyn_dtree=new r.Buf16((2*ne+1)*2),this.bl_tree=new r.Buf16((2*Be+1)*2),hr(this.dyn_ltree),hr(this.dyn_dtree),hr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(Ce+1),this.heap=new r.Buf16(2*X+1),hr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*X+1),hr(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ot(W){var yt;return!W||!W.state?Ar(W,S):(W.total_in=W.total_out=0,W.data_type=Q,yt=W.state,yt.pending=0,yt.pending_out=0,yt.wrap<0&&(yt.wrap=-yt.wrap),yt.status=yt.wrap?tt:cr,W.adler=yt.wrap===2?0:1,yt.last_flush=o,e._tr_init(yt),b)}function Vt(W){var yt=Ot(W);return yt===b&&fi(W.state),yt}function sr(W,yt){return!W||!W.state||W.state.wrap!==2?S:(W.state.gzhead=yt,b)}function Ye(W,yt,Et,Ee,Xe,ct){if(!W)return S;var Z=1;if(yt===U&&(yt=6),Ee<0?(Z=0,Ee=-Ee):Ee>15&&(Z=2,Ee-=16),Xe<1||Xe>Te||Et!==oe||Ee<8||Ee>15||yt<0||yt>9||ct<0||ct>K)return Ar(W,S);Ee===8&&(Ee=9);var ie=new Pe;return W.state=ie,ie.strm=W,ie.wrap=Z,ie.gzhead=null,ie.w_bits=Ee,ie.w_size=1<<ie.w_bits,ie.w_mask=ie.w_size-1,ie.hash_bits=Xe+7,ie.hash_size=1<<ie.hash_bits,ie.hash_mask=ie.hash_size-1,ie.hash_shift=~~((ie.hash_bits+Ne-1)/Ne),ie.window=new r.Buf8(ie.w_size*2),ie.head=new r.Buf16(ie.hash_size),ie.prev=new r.Buf16(ie.w_size),ie.lit_bufsize=1<<Xe+6,ie.pending_buf_size=ie.lit_bufsize*4,ie.pending_buf=new r.Buf8(ie.pending_buf_size),ie.d_buf=1*ie.lit_bufsize,ie.l_buf=3*ie.lit_bufsize,ie.level=yt,ie.strategy=ct,ie.method=Et,Vt(W)}function Mt(W,yt){return Ye(W,yt,oe,ze,Ae,fe)}function ge(W,yt){var Et,Ee,Xe,ct;if(!W||!W.state||yt>g||yt<0)return W?Ar(W,S):S;if(Ee=W.state,!W.output||!W.input&&W.avail_in!==0||Ee.status===$t&&yt!==f)return Ar(W,W.avail_out===0?k:S);if(Ee.strm=W,Et=Ee.last_flush,Ee.last_flush=yt,Ee.status===tt)if(Ee.wrap===2)W.adler=0,Sr(Ee,31),Sr(Ee,139),Sr(Ee,8),Ee.gzhead?(Sr(Ee,(Ee.gzhead.text?1:0)+(Ee.gzhead.hcrc?2:0)+(Ee.gzhead.extra?4:0)+(Ee.gzhead.name?8:0)+(Ee.gzhead.comment?16:0)),Sr(Ee,Ee.gzhead.time&255),Sr(Ee,Ee.gzhead.time>>8&255),Sr(Ee,Ee.gzhead.time>>16&255),Sr(Ee,Ee.gzhead.time>>24&255),Sr(Ee,Ee.level===9?2:Ee.strategy>=z||Ee.level<2?4:0),Sr(Ee,Ee.gzhead.os&255),Ee.gzhead.extra&&Ee.gzhead.extra.length&&(Sr(Ee,Ee.gzhead.extra.length&255),Sr(Ee,Ee.gzhead.extra.length>>8&255)),Ee.gzhead.hcrc&&(W.adler=n(W.adler,Ee.pending_buf,Ee.pending,0)),Ee.gzindex=0,Ee.status=lt):(Sr(Ee,0),Sr(Ee,0),Sr(Ee,0),Sr(Ee,0),Sr(Ee,0),Sr(Ee,Ee.level===9?2:Ee.strategy>=z||Ee.level<2?4:0),Sr(Ee,Er),Ee.status=cr);else{var Z=oe+(Ee.w_bits-8<<4)<<8,ie=-1;Ee.strategy>=z||Ee.level<2?ie=0:Ee.level<6?ie=1:Ee.level===6?ie=2:ie=3,Z|=ie<<6,Ee.strstart!==0&&(Z|=rt),Z+=31-Z%31,Ee.status=cr,ti(Ee,Z),Ee.strstart!==0&&(ti(Ee,W.adler>>>16),ti(Ee,W.adler&65535)),W.adler=1}if(Ee.status===lt)if(Ee.gzhead.extra){for(Xe=Ee.pending;Ee.gzindex<(Ee.gzhead.extra.length&65535)&&!(Ee.pending===Ee.pending_buf_size&&(Ee.gzhead.hcrc&&Ee.pending>Xe&&(W.adler=n(W.adler,Ee.pending_buf,Ee.pending-Xe,Xe)),pr(W),Xe=Ee.pending,Ee.pending===Ee.pending_buf_size));)Sr(Ee,Ee.gzhead.extra[Ee.gzindex]&255),Ee.gzindex++;Ee.gzhead.hcrc&&Ee.pending>Xe&&(W.adler=n(W.adler,Ee.pending_buf,Ee.pending-Xe,Xe)),Ee.gzindex===Ee.gzhead.extra.length&&(Ee.gzindex=0,Ee.status=mt)}else Ee.status=mt;if(Ee.status===mt)if(Ee.gzhead.name){Xe=Ee.pending;do{if(Ee.pending===Ee.pending_buf_size&&(Ee.gzhead.hcrc&&Ee.pending>Xe&&(W.adler=n(W.adler,Ee.pending_buf,Ee.pending-Xe,Xe)),pr(W),Xe=Ee.pending,Ee.pending===Ee.pending_buf_size)){ct=1;break}Ee.gzindex<Ee.gzhead.name.length?ct=Ee.gzhead.name.charCodeAt(Ee.gzindex++)&255:ct=0,Sr(Ee,ct)}while(ct!==0);Ee.gzhead.hcrc&&Ee.pending>Xe&&(W.adler=n(W.adler,Ee.pending_buf,Ee.pending-Xe,Xe)),ct===0&&(Ee.gzindex=0,Ee.status=Tt)}else Ee.status=Tt;if(Ee.status===Tt)if(Ee.gzhead.comment){Xe=Ee.pending;do{if(Ee.pending===Ee.pending_buf_size&&(Ee.gzhead.hcrc&&Ee.pending>Xe&&(W.adler=n(W.adler,Ee.pending_buf,Ee.pending-Xe,Xe)),pr(W),Xe=Ee.pending,Ee.pending===Ee.pending_buf_size)){ct=1;break}Ee.gzindex<Ee.gzhead.comment.length?ct=Ee.gzhead.comment.charCodeAt(Ee.gzindex++)&255:ct=0,Sr(Ee,ct)}while(ct!==0);Ee.gzhead.hcrc&&Ee.pending>Xe&&(W.adler=n(W.adler,Ee.pending_buf,Ee.pending-Xe,Xe)),ct===0&&(Ee.status=nt)}else Ee.status=nt;if(Ee.status===nt&&(Ee.gzhead.hcrc?(Ee.pending+2>Ee.pending_buf_size&&pr(W),Ee.pending+2<=Ee.pending_buf_size&&(Sr(Ee,W.adler&255),Sr(Ee,W.adler>>8&255),W.adler=0,Ee.status=cr)):Ee.status=cr),Ee.pending!==0){if(pr(W),W.avail_out===0)return Ee.last_flush=-1,b}else if(W.avail_in===0&&In(yt)<=In(Et)&&yt!==f)return Ar(W,k);if(Ee.status===$t&&W.avail_in!==0)return Ar(W,k);if(W.avail_in!==0||Ee.lookahead!==0||yt!==o&&Ee.status!==$t){var ue=Ee.strategy===z?dr(Ee,yt):Ee.strategy===V?Ut(Ee,yt):Zr[Ee.level].func(Ee,yt);if((ue===lr||ue===tn)&&(Ee.status=$t),ue===Jt||ue===lr)return W.avail_out===0&&(Ee.last_flush=-1),b;if(ue===Lt&&(yt===s?e._tr_align(Ee):yt!==g&&(e._tr_stored_block(Ee,0,0,!1),yt===c&&(hr(Ee.head),Ee.lookahead===0&&(Ee.strstart=0,Ee.block_start=0,Ee.insert=0))),pr(W),W.avail_out===0))return Ee.last_flush=-1,b}return yt!==f?b:Ee.wrap<=0?T:(Ee.wrap===2?(Sr(Ee,W.adler&255),Sr(Ee,W.adler>>8&255),Sr(Ee,W.adler>>16&255),Sr(Ee,W.adler>>24&255),Sr(Ee,W.total_in&255),Sr(Ee,W.total_in>>8&255),Sr(Ee,W.total_in>>16&255),Sr(Ee,W.total_in>>24&255)):(ti(Ee,W.adler>>>16),ti(Ee,W.adler&65535)),pr(W),Ee.wrap>0&&(Ee.wrap=-Ee.wrap),Ee.pending!==0?b:T)}function kt(W){var yt;return!W||!W.state?S:(yt=W.state.status,yt!==tt&&yt!==lt&&yt!==mt&&yt!==Tt&&yt!==nt&&yt!==cr&&yt!==$t?Ar(W,S):(W.state=null,yt===cr?Ar(W,F):b))}function wt(W,yt){var Et=yt.length,Ee,Xe,ct,Z,ie,ue,ve,Oe;if(!W||!W.state||(Ee=W.state,Z=Ee.wrap,Z===2||Z===1&&Ee.status!==tt||Ee.lookahead))return S;for(Z===1&&(W.adler=t(W.adler,yt,Et,0)),Ee.wrap=0,Et>=Ee.w_size&&(Z===0&&(hr(Ee.head),Ee.strstart=0,Ee.block_start=0,Ee.insert=0),Oe=new r.Buf8(Ee.w_size),r.arraySet(Oe,yt,Et-Ee.w_size,Ee.w_size,0),yt=Oe,Et=Ee.w_size),ie=W.avail_in,ue=W.next_in,ve=W.input,W.avail_in=Et,W.next_in=0,W.input=yt,Kn(Ee);Ee.lookahead>=Ne;){Xe=Ee.strstart,ct=Ee.lookahead-(Ne-1);do Ee.ins_h=(Ee.ins_h<<Ee.hash_shift^Ee.window[Xe+Ne-1])&Ee.hash_mask,Ee.prev[Xe&Ee.w_mask]=Ee.head[Ee.ins_h],Ee.head[Ee.ins_h]=Xe,Xe++;while(--ct);Ee.strstart=Xe,Ee.lookahead=Ne-1,Kn(Ee)}return Ee.strstart+=Ee.lookahead,Ee.block_start=Ee.strstart,Ee.insert=Ee.lookahead,Ee.lookahead=0,Ee.match_length=Ee.prev_length=Ne-1,Ee.match_available=0,W.next_in=ue,W.input=ve,W.avail_in=ie,Ee.wrap=Z,b}return $a.deflateInit=Mt,$a.deflateInit2=Ye,$a.deflateReset=Vt,$a.deflateResetKeep=Ot,$a.deflateSetHeader=sr,$a.deflate=ge,$a.deflateEnd=kt,$a.deflateSetDictionary=wt,$a.deflateInfo="pako deflate (from Nodeca project)",$a}var Rf={},sP;function vL(){if(sP)return Rf;sP=1;var r=ef(),e=!0,t=!0;try{String.fromCharCode.apply(null,[0])}catch{e=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{t=!1}for(var n=new r.Buf8(256),i=0;i<256;i++)n[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;n[254]=n[254]=1,Rf.string2buf=function(s){var c,f,g,b,T,S=s.length,F=0;for(b=0;b<S;b++)f=s.charCodeAt(b),(f&64512)===55296&&b+1<S&&(g=s.charCodeAt(b+1),(g&64512)===56320&&(f=65536+(f-55296<<10)+(g-56320),b++)),F+=f<128?1:f<2048?2:f<65536?3:4;for(c=new r.Buf8(F),T=0,b=0;T<F;b++)f=s.charCodeAt(b),(f&64512)===55296&&b+1<S&&(g=s.charCodeAt(b+1),(g&64512)===56320&&(f=65536+(f-55296<<10)+(g-56320),b++)),f<128?c[T++]=f:f<2048?(c[T++]=192|f>>>6,c[T++]=128|f&63):f<65536?(c[T++]=224|f>>>12,c[T++]=128|f>>>6&63,c[T++]=128|f&63):(c[T++]=240|f>>>18,c[T++]=128|f>>>12&63,c[T++]=128|f>>>6&63,c[T++]=128|f&63);return c};function o(s,c){if(c<65534&&(s.subarray&&t||!s.subarray&&e))return String.fromCharCode.apply(null,r.shrinkBuf(s,c));for(var f="",g=0;g<c;g++)f+=String.fromCharCode(s[g]);return f}return Rf.buf2binstring=function(s){return o(s,s.length)},Rf.binstring2buf=function(s){for(var c=new r.Buf8(s.length),f=0,g=c.length;f<g;f++)c[f]=s.charCodeAt(f);return c},Rf.buf2string=function(s,c){var f,g,b,T,S=c||s.length,F=new Array(S*2);for(g=0,f=0;f<S;){if(b=s[f++],b<128){F[g++]=b;continue}if(T=n[b],T>4){F[g++]=65533,f+=T-1;continue}for(b&=T===2?31:T===3?15:7;T>1&&f<S;)b=b<<6|s[f++]&63,T--;if(T>1){F[g++]=65533;continue}b<65536?F[g++]=b:(b-=65536,F[g++]=55296|b>>10&1023,F[g++]=56320|b&1023)}return o(F,g)},Rf.utf8border=function(s,c){var f;for(c=c||s.length,c>s.length&&(c=s.length),f=c-1;f>=0&&(s[f]&192)===128;)f--;return f<0||f===0?c:f+n[s[f]]>c?f:c},Rf}var lb,oP;function bL(){if(oP)return lb;oP=1;function r(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return lb=r,lb}var aP;function age(){if(aP)return hd;aP=1;var r=oge(),e=ef(),t=vL(),n=aC(),i=bL(),o=Object.prototype.toString,s=0,c=4,f=0,g=1,b=2,T=-1,S=0,F=8;function k(V){if(!(this instanceof k))return new k(V);this.options=e.assign({level:T,method:F,chunkSize:16384,windowBits:15,memLevel:8,strategy:S,to:""},V||{});var K=this.options;K.raw&&K.windowBits>0?K.windowBits=-K.windowBits:K.gzip&&K.windowBits>0&&K.windowBits<16&&(K.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var fe=r.deflateInit2(this.strm,K.level,K.method,K.windowBits,K.memLevel,K.strategy);if(fe!==f)throw new Error(n[fe]);if(K.header&&r.deflateSetHeader(this.strm,K.header),K.dictionary){var Q;if(typeof K.dictionary=="string"?Q=t.string2buf(K.dictionary):o.call(K.dictionary)==="[object ArrayBuffer]"?Q=new Uint8Array(K.dictionary):Q=K.dictionary,fe=r.deflateSetDictionary(this.strm,Q),fe!==f)throw new Error(n[fe]);this._dict_set=!0}}k.prototype.push=function(V,K){var fe=this.strm,Q=this.options.chunkSize,oe,Te;if(this.ended)return!1;Te=K===~~K?K:K===!0?c:s,typeof V=="string"?fe.input=t.string2buf(V):o.call(V)==="[object ArrayBuffer]"?fe.input=new Uint8Array(V):fe.input=V,fe.next_in=0,fe.avail_in=fe.input.length;do{if(fe.avail_out===0&&(fe.output=new e.Buf8(Q),fe.next_out=0,fe.avail_out=Q),oe=r.deflate(fe,Te),oe!==g&&oe!==f)return this.onEnd(oe),this.ended=!0,!1;(fe.avail_out===0||fe.avail_in===0&&(Te===c||Te===b))&&(this.options.to==="string"?this.onData(t.buf2binstring(e.shrinkBuf(fe.output,fe.next_out))):this.onData(e.shrinkBuf(fe.output,fe.next_out)))}while((fe.avail_in>0||fe.avail_out===0)&&oe!==g);return Te===c?(oe=r.deflateEnd(this.strm),this.onEnd(oe),this.ended=!0,oe===f):(Te===b&&(this.onEnd(f),fe.avail_out=0),!0)},k.prototype.onData=function(V){this.chunks.push(V)},k.prototype.onEnd=function(V){V===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.msg=this.strm.msg};function U(V,K){var fe=new k(K);if(fe.push(V,!0),fe.err)throw fe.msg||n[fe.err];return fe.result}function j(V,K){return K=K||{},K.raw=!0,U(V,K)}function z(V,K){return K=K||{},K.gzip=!0,U(V,K)}return hd.Deflate=k,hd.deflate=U,hd.deflateRaw=j,hd.gzip=z,hd}var dd={},ya={},ub,cP;function cge(){if(cP)return ub;cP=1;var r=30,e=12;return ub=function(n,i){var o,s,c,f,g,b,T,S,F,k,U,j,z,V,K,fe,Q,oe,Te,ze,Ae,_e,pe,X,ne;o=n.state,s=n.next_in,X=n.input,c=s+(n.avail_in-5),f=n.next_out,ne=n.output,g=f-(i-n.avail_out),b=f+(n.avail_out-257),T=o.dmax,S=o.wsize,F=o.whave,k=o.wnext,U=o.window,j=o.hold,z=o.bits,V=o.lencode,K=o.distcode,fe=(1<<o.lenbits)-1,Q=(1<<o.distbits)-1;e:do{z<15&&(j+=X[s++]<<z,z+=8,j+=X[s++]<<z,z+=8),oe=V[j&fe];t:for(;;){if(Te=oe>>>24,j>>>=Te,z-=Te,Te=oe>>>16&255,Te===0)ne[f++]=oe&65535;else if(Te&16){ze=oe&65535,Te&=15,Te&&(z<Te&&(j+=X[s++]<<z,z+=8),ze+=j&(1<<Te)-1,j>>>=Te,z-=Te),z<15&&(j+=X[s++]<<z,z+=8,j+=X[s++]<<z,z+=8),oe=K[j&Q];r:for(;;){if(Te=oe>>>24,j>>>=Te,z-=Te,Te=oe>>>16&255,Te&16){if(Ae=oe&65535,Te&=15,z<Te&&(j+=X[s++]<<z,z+=8,z<Te&&(j+=X[s++]<<z,z+=8)),Ae+=j&(1<<Te)-1,Ae>T){n.msg="invalid distance too far back",o.mode=r;break e}if(j>>>=Te,z-=Te,Te=f-g,Ae>Te){if(Te=Ae-Te,Te>F&&o.sane){n.msg="invalid distance too far back",o.mode=r;break e}if(_e=0,pe=U,k===0){if(_e+=S-Te,Te<ze){ze-=Te;do ne[f++]=U[_e++];while(--Te);_e=f-Ae,pe=ne}}else if(k<Te){if(_e+=S+k-Te,Te-=k,Te<ze){ze-=Te;do ne[f++]=U[_e++];while(--Te);if(_e=0,k<ze){Te=k,ze-=Te;do ne[f++]=U[_e++];while(--Te);_e=f-Ae,pe=ne}}}else if(_e+=k-Te,Te<ze){ze-=Te;do ne[f++]=U[_e++];while(--Te);_e=f-Ae,pe=ne}for(;ze>2;)ne[f++]=pe[_e++],ne[f++]=pe[_e++],ne[f++]=pe[_e++],ze-=3;ze&&(ne[f++]=pe[_e++],ze>1&&(ne[f++]=pe[_e++]))}else{_e=f-Ae;do ne[f++]=ne[_e++],ne[f++]=ne[_e++],ne[f++]=ne[_e++],ze-=3;while(ze>2);ze&&(ne[f++]=ne[_e++],ze>1&&(ne[f++]=ne[_e++]))}}else if(Te&64){n.msg="invalid distance code",o.mode=r;break e}else{oe=K[(oe&65535)+(j&(1<<Te)-1)];continue r}break}}else if(Te&64)if(Te&32){o.mode=e;break e}else{n.msg="invalid literal/length code",o.mode=r;break e}else{oe=V[(oe&65535)+(j&(1<<Te)-1)];continue t}break}}while(s<c&&f<b);ze=z>>3,s-=ze,z-=ze<<3,j&=(1<<z)-1,n.next_in=s,n.next_out=f,n.avail_in=s<c?5+(c-s):5-(s-c),n.avail_out=f<b?257+(b-f):257-(f-b),o.hold=j,o.bits=z},ub}var fb,lP;function lge(){if(lP)return fb;lP=1;var r=ef(),e=15,t=852,n=592,i=0,o=1,s=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],b=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return fb=function(S,F,k,U,j,z,V,K){var fe=K.bits,Q=0,oe=0,Te=0,ze=0,Ae=0,_e=0,pe=0,X=0,ne=0,Be=0,Ze,Ce,Ne,Ge,Qe,rt=null,tt=0,lt,mt=new r.Buf16(e+1),Tt=new r.Buf16(e+1),nt=null,cr=0,$t,Jt,Lt;for(Q=0;Q<=e;Q++)mt[Q]=0;for(oe=0;oe<U;oe++)mt[F[k+oe]]++;for(Ae=fe,ze=e;ze>=1&&mt[ze]===0;ze--);if(Ae>ze&&(Ae=ze),ze===0)return j[z++]=1<<24|64<<16|0,j[z++]=1<<24|64<<16|0,K.bits=1,0;for(Te=1;Te<ze&&mt[Te]===0;Te++);for(Ae<Te&&(Ae=Te),X=1,Q=1;Q<=e;Q++)if(X<<=1,X-=mt[Q],X<0)return-1;if(X>0&&(S===i||ze!==1))return-1;for(Tt[1]=0,Q=1;Q<e;Q++)Tt[Q+1]=Tt[Q]+mt[Q];for(oe=0;oe<U;oe++)F[k+oe]!==0&&(V[Tt[F[k+oe]]++]=oe);if(S===i?(rt=nt=V,lt=19):S===o?(rt=c,tt-=257,nt=f,cr-=257,lt=256):(rt=g,nt=b,lt=-1),Be=0,oe=0,Q=Te,Qe=z,_e=Ae,pe=0,Ne=-1,ne=1<<Ae,Ge=ne-1,S===o&&ne>t||S===s&&ne>n)return 1;for(;;){$t=Q-pe,V[oe]<lt?(Jt=0,Lt=V[oe]):V[oe]>lt?(Jt=nt[cr+V[oe]],Lt=rt[tt+V[oe]]):(Jt=96,Lt=0),Ze=1<<Q-pe,Ce=1<<_e,Te=Ce;do Ce-=Ze,j[Qe+(Be>>pe)+Ce]=$t<<24|Jt<<16|Lt|0;while(Ce!==0);for(Ze=1<<Q-1;Be&Ze;)Ze>>=1;if(Ze!==0?(Be&=Ze-1,Be+=Ze):Be=0,oe++,--mt[Q]===0){if(Q===ze)break;Q=F[k+V[oe]]}if(Q>Ae&&(Be&Ge)!==Ne){for(pe===0&&(pe=Ae),Qe+=Te,_e=Q-pe,X=1<<_e;_e+pe<ze&&(X-=mt[_e+pe],!(X<=0));)_e++,X<<=1;if(ne+=1<<_e,S===o&&ne>t||S===s&&ne>n)return 1;Ne=Be&Ge,j[Ne]=Ae<<24|_e<<16|Qe-z|0}}return Be!==0&&(j[Qe+Be]=Q-pe<<24|64<<16|0),K.bits=Ae,0},fb}var uP;function uge(){if(uP)return ya;uP=1;var r=ef(),e=_L(),t=yL(),n=cge(),i=lge(),o=0,s=1,c=2,f=4,g=5,b=6,T=0,S=1,F=2,k=-2,U=-3,j=-4,z=-5,V=8,K=1,fe=2,Q=3,oe=4,Te=5,ze=6,Ae=7,_e=8,pe=9,X=10,ne=11,Be=12,Ze=13,Ce=14,Ne=15,Ge=16,Qe=17,rt=18,tt=19,lt=20,mt=21,Tt=22,nt=23,cr=24,$t=25,Jt=26,Lt=27,lr=28,tn=29,Er=30,Ar=31,In=32,hr=852,pr=592,rn=15,Sr=rn;function ti(Ye){return(Ye>>>24&255)+(Ye>>>8&65280)+((Ye&65280)<<8)+((Ye&255)<<24)}function Jn(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function un(Ye){var Mt;return!Ye||!Ye.state?k:(Mt=Ye.state,Ye.total_in=Ye.total_out=Mt.total=0,Ye.msg="",Mt.wrap&&(Ye.adler=Mt.wrap&1),Mt.mode=K,Mt.last=0,Mt.havedict=0,Mt.dmax=32768,Mt.head=null,Mt.hold=0,Mt.bits=0,Mt.lencode=Mt.lendyn=new r.Buf32(hr),Mt.distcode=Mt.distdyn=new r.Buf32(pr),Mt.sane=1,Mt.back=-1,T)}function Kn(Ye){var Mt;return!Ye||!Ye.state?k:(Mt=Ye.state,Mt.wsize=0,Mt.whave=0,Mt.wnext=0,un(Ye))}function Nn(Ye,Mt){var ge,kt;return!Ye||!Ye.state||(kt=Ye.state,Mt<0?(ge=0,Mt=-Mt):(ge=(Mt>>4)+1,Mt<48&&(Mt&=15)),Mt&&(Mt<8||Mt>15))?k:(kt.window!==null&&kt.wbits!==Mt&&(kt.window=null),kt.wrap=ge,kt.wbits=Mt,Kn(Ye))}function vn(Ye,Mt){var ge,kt;return Ye?(kt=new Jn,Ye.state=kt,kt.window=null,ge=Nn(Ye,Mt),ge!==T&&(Ye.state=null),ge):k}function Wn(Ye){return vn(Ye,Sr)}var Ut=!0,dr,Tr;function Zr(Ye){if(Ut){var Mt;for(dr=new r.Buf32(512),Tr=new r.Buf32(32),Mt=0;Mt<144;)Ye.lens[Mt++]=8;for(;Mt<256;)Ye.lens[Mt++]=9;for(;Mt<280;)Ye.lens[Mt++]=7;for(;Mt<288;)Ye.lens[Mt++]=8;for(i(s,Ye.lens,0,288,dr,0,Ye.work,{bits:9}),Mt=0;Mt<32;)Ye.lens[Mt++]=5;i(c,Ye.lens,0,32,Tr,0,Ye.work,{bits:5}),Ut=!1}Ye.lencode=dr,Ye.lenbits=9,Ye.distcode=Tr,Ye.distbits=5}function fi(Ye,Mt,ge,kt){var wt,W=Ye.state;return W.window===null&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new r.Buf8(W.wsize)),kt>=W.wsize?(r.arraySet(W.window,Mt,ge-W.wsize,W.wsize,0),W.wnext=0,W.whave=W.wsize):(wt=W.wsize-W.wnext,wt>kt&&(wt=kt),r.arraySet(W.window,Mt,ge-kt,wt,W.wnext),kt-=wt,kt?(r.arraySet(W.window,Mt,ge-kt,kt,0),W.wnext=kt,W.whave=W.wsize):(W.wnext+=wt,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=wt))),0}function Pe(Ye,Mt){var ge,kt,wt,W,yt,Et,Ee,Xe,ct,Z,ie,ue,ve,Oe,de=0,be,ce,Se,p,le,vt,Ke,Ct,It=new r.Buf8(4),Ft,ut,Dt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Ye||!Ye.state||!Ye.output||!Ye.input&&Ye.avail_in!==0)return k;ge=Ye.state,ge.mode===Be&&(ge.mode=Ze),yt=Ye.next_out,wt=Ye.output,Ee=Ye.avail_out,W=Ye.next_in,kt=Ye.input,Et=Ye.avail_in,Xe=ge.hold,ct=ge.bits,Z=Et,ie=Ee,Ct=T;e:for(;;)switch(ge.mode){case K:if(ge.wrap===0){ge.mode=Ze;break}for(;ct<16;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}if(ge.wrap&2&&Xe===35615){ge.check=0,It[0]=Xe&255,It[1]=Xe>>>8&255,ge.check=t(ge.check,It,2,0),Xe=0,ct=0,ge.mode=fe;break}if(ge.flags=0,ge.head&&(ge.head.done=!1),!(ge.wrap&1)||(((Xe&255)<<8)+(Xe>>8))%31){Ye.msg="incorrect header check",ge.mode=Er;break}if((Xe&15)!==V){Ye.msg="unknown compression method",ge.mode=Er;break}if(Xe>>>=4,ct-=4,Ke=(Xe&15)+8,ge.wbits===0)ge.wbits=Ke;else if(Ke>ge.wbits){Ye.msg="invalid window size",ge.mode=Er;break}ge.dmax=1<<Ke,Ye.adler=ge.check=1,ge.mode=Xe&512?X:Be,Xe=0,ct=0;break;case fe:for(;ct<16;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}if(ge.flags=Xe,(ge.flags&255)!==V){Ye.msg="unknown compression method",ge.mode=Er;break}if(ge.flags&57344){Ye.msg="unknown header flags set",ge.mode=Er;break}ge.head&&(ge.head.text=Xe>>8&1),ge.flags&512&&(It[0]=Xe&255,It[1]=Xe>>>8&255,ge.check=t(ge.check,It,2,0)),Xe=0,ct=0,ge.mode=Q;case Q:for(;ct<32;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}ge.head&&(ge.head.time=Xe),ge.flags&512&&(It[0]=Xe&255,It[1]=Xe>>>8&255,It[2]=Xe>>>16&255,It[3]=Xe>>>24&255,ge.check=t(ge.check,It,4,0)),Xe=0,ct=0,ge.mode=oe;case oe:for(;ct<16;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}ge.head&&(ge.head.xflags=Xe&255,ge.head.os=Xe>>8),ge.flags&512&&(It[0]=Xe&255,It[1]=Xe>>>8&255,ge.check=t(ge.check,It,2,0)),Xe=0,ct=0,ge.mode=Te;case Te:if(ge.flags&1024){for(;ct<16;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}ge.length=Xe,ge.head&&(ge.head.extra_len=Xe),ge.flags&512&&(It[0]=Xe&255,It[1]=Xe>>>8&255,ge.check=t(ge.check,It,2,0)),Xe=0,ct=0}else ge.head&&(ge.head.extra=null);ge.mode=ze;case ze:if(ge.flags&1024&&(ue=ge.length,ue>Et&&(ue=Et),ue&&(ge.head&&(Ke=ge.head.extra_len-ge.length,ge.head.extra||(ge.head.extra=new Array(ge.head.extra_len)),r.arraySet(ge.head.extra,kt,W,ue,Ke)),ge.flags&512&&(ge.check=t(ge.check,kt,ue,W)),Et-=ue,W+=ue,ge.length-=ue),ge.length))break e;ge.length=0,ge.mode=Ae;case Ae:if(ge.flags&2048){if(Et===0)break e;ue=0;do Ke=kt[W+ue++],ge.head&&Ke&&ge.length<65536&&(ge.head.name+=String.fromCharCode(Ke));while(Ke&&ue<Et);if(ge.flags&512&&(ge.check=t(ge.check,kt,ue,W)),Et-=ue,W+=ue,Ke)break e}else ge.head&&(ge.head.name=null);ge.length=0,ge.mode=_e;case _e:if(ge.flags&4096){if(Et===0)break e;ue=0;do Ke=kt[W+ue++],ge.head&&Ke&&ge.length<65536&&(ge.head.comment+=String.fromCharCode(Ke));while(Ke&&ue<Et);if(ge.flags&512&&(ge.check=t(ge.check,kt,ue,W)),Et-=ue,W+=ue,Ke)break e}else ge.head&&(ge.head.comment=null);ge.mode=pe;case pe:if(ge.flags&512){for(;ct<16;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}if(Xe!==(ge.check&65535)){Ye.msg="header crc mismatch",ge.mode=Er;break}Xe=0,ct=0}ge.head&&(ge.head.hcrc=ge.flags>>9&1,ge.head.done=!0),Ye.adler=ge.check=0,ge.mode=Be;break;case X:for(;ct<32;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}Ye.adler=ge.check=ti(Xe),Xe=0,ct=0,ge.mode=ne;case ne:if(ge.havedict===0)return Ye.next_out=yt,Ye.avail_out=Ee,Ye.next_in=W,Ye.avail_in=Et,ge.hold=Xe,ge.bits=ct,F;Ye.adler=ge.check=1,ge.mode=Be;case Be:if(Mt===g||Mt===b)break e;case Ze:if(ge.last){Xe>>>=ct&7,ct-=ct&7,ge.mode=Lt;break}for(;ct<3;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}switch(ge.last=Xe&1,Xe>>>=1,ct-=1,Xe&3){case 0:ge.mode=Ce;break;case 1:if(Zr(ge),ge.mode=lt,Mt===b){Xe>>>=2,ct-=2;break e}break;case 2:ge.mode=Qe;break;case 3:Ye.msg="invalid block type",ge.mode=Er}Xe>>>=2,ct-=2;break;case Ce:for(Xe>>>=ct&7,ct-=ct&7;ct<32;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}if((Xe&65535)!==(Xe>>>16^65535)){Ye.msg="invalid stored block lengths",ge.mode=Er;break}if(ge.length=Xe&65535,Xe=0,ct=0,ge.mode=Ne,Mt===b)break e;case Ne:ge.mode=Ge;case Ge:if(ue=ge.length,ue){if(ue>Et&&(ue=Et),ue>Ee&&(ue=Ee),ue===0)break e;r.arraySet(wt,kt,W,ue,yt),Et-=ue,W+=ue,Ee-=ue,yt+=ue,ge.length-=ue;break}ge.mode=Be;break;case Qe:for(;ct<14;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}if(ge.nlen=(Xe&31)+257,Xe>>>=5,ct-=5,ge.ndist=(Xe&31)+1,Xe>>>=5,ct-=5,ge.ncode=(Xe&15)+4,Xe>>>=4,ct-=4,ge.nlen>286||ge.ndist>30){Ye.msg="too many length or distance symbols",ge.mode=Er;break}ge.have=0,ge.mode=rt;case rt:for(;ge.have<ge.ncode;){for(;ct<3;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}ge.lens[Dt[ge.have++]]=Xe&7,Xe>>>=3,ct-=3}for(;ge.have<19;)ge.lens[Dt[ge.have++]]=0;if(ge.lencode=ge.lendyn,ge.lenbits=7,Ft={bits:ge.lenbits},Ct=i(o,ge.lens,0,19,ge.lencode,0,ge.work,Ft),ge.lenbits=Ft.bits,Ct){Ye.msg="invalid code lengths set",ge.mode=Er;break}ge.have=0,ge.mode=tt;case tt:for(;ge.have<ge.nlen+ge.ndist;){for(;de=ge.lencode[Xe&(1<<ge.lenbits)-1],be=de>>>24,ce=de>>>16&255,Se=de&65535,!(be<=ct);){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}if(Se<16)Xe>>>=be,ct-=be,ge.lens[ge.have++]=Se;else{if(Se===16){for(ut=be+2;ct<ut;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}if(Xe>>>=be,ct-=be,ge.have===0){Ye.msg="invalid bit length repeat",ge.mode=Er;break}Ke=ge.lens[ge.have-1],ue=3+(Xe&3),Xe>>>=2,ct-=2}else if(Se===17){for(ut=be+3;ct<ut;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}Xe>>>=be,ct-=be,Ke=0,ue=3+(Xe&7),Xe>>>=3,ct-=3}else{for(ut=be+7;ct<ut;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}Xe>>>=be,ct-=be,Ke=0,ue=11+(Xe&127),Xe>>>=7,ct-=7}if(ge.have+ue>ge.nlen+ge.ndist){Ye.msg="invalid bit length repeat",ge.mode=Er;break}for(;ue--;)ge.lens[ge.have++]=Ke}}if(ge.mode===Er)break;if(ge.lens[256]===0){Ye.msg="invalid code -- missing end-of-block",ge.mode=Er;break}if(ge.lenbits=9,Ft={bits:ge.lenbits},Ct=i(s,ge.lens,0,ge.nlen,ge.lencode,0,ge.work,Ft),ge.lenbits=Ft.bits,Ct){Ye.msg="invalid literal/lengths set",ge.mode=Er;break}if(ge.distbits=6,ge.distcode=ge.distdyn,Ft={bits:ge.distbits},Ct=i(c,ge.lens,ge.nlen,ge.ndist,ge.distcode,0,ge.work,Ft),ge.distbits=Ft.bits,Ct){Ye.msg="invalid distances set",ge.mode=Er;break}if(ge.mode=lt,Mt===b)break e;case lt:ge.mode=mt;case mt:if(Et>=6&&Ee>=258){Ye.next_out=yt,Ye.avail_out=Ee,Ye.next_in=W,Ye.avail_in=Et,ge.hold=Xe,ge.bits=ct,n(Ye,ie),yt=Ye.next_out,wt=Ye.output,Ee=Ye.avail_out,W=Ye.next_in,kt=Ye.input,Et=Ye.avail_in,Xe=ge.hold,ct=ge.bits,ge.mode===Be&&(ge.back=-1);break}for(ge.back=0;de=ge.lencode[Xe&(1<<ge.lenbits)-1],be=de>>>24,ce=de>>>16&255,Se=de&65535,!(be<=ct);){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}if(ce&&!(ce&240)){for(p=be,le=ce,vt=Se;de=ge.lencode[vt+((Xe&(1<<p+le)-1)>>p)],be=de>>>24,ce=de>>>16&255,Se=de&65535,!(p+be<=ct);){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}Xe>>>=p,ct-=p,ge.back+=p}if(Xe>>>=be,ct-=be,ge.back+=be,ge.length=Se,ce===0){ge.mode=Jt;break}if(ce&32){ge.back=-1,ge.mode=Be;break}if(ce&64){Ye.msg="invalid literal/length code",ge.mode=Er;break}ge.extra=ce&15,ge.mode=Tt;case Tt:if(ge.extra){for(ut=ge.extra;ct<ut;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}ge.length+=Xe&(1<<ge.extra)-1,Xe>>>=ge.extra,ct-=ge.extra,ge.back+=ge.extra}ge.was=ge.length,ge.mode=nt;case nt:for(;de=ge.distcode[Xe&(1<<ge.distbits)-1],be=de>>>24,ce=de>>>16&255,Se=de&65535,!(be<=ct);){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}if(!(ce&240)){for(p=be,le=ce,vt=Se;de=ge.distcode[vt+((Xe&(1<<p+le)-1)>>p)],be=de>>>24,ce=de>>>16&255,Se=de&65535,!(p+be<=ct);){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}Xe>>>=p,ct-=p,ge.back+=p}if(Xe>>>=be,ct-=be,ge.back+=be,ce&64){Ye.msg="invalid distance code",ge.mode=Er;break}ge.offset=Se,ge.extra=ce&15,ge.mode=cr;case cr:if(ge.extra){for(ut=ge.extra;ct<ut;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}ge.offset+=Xe&(1<<ge.extra)-1,Xe>>>=ge.extra,ct-=ge.extra,ge.back+=ge.extra}if(ge.offset>ge.dmax){Ye.msg="invalid distance too far back",ge.mode=Er;break}ge.mode=$t;case $t:if(Ee===0)break e;if(ue=ie-Ee,ge.offset>ue){if(ue=ge.offset-ue,ue>ge.whave&&ge.sane){Ye.msg="invalid distance too far back",ge.mode=Er;break}ue>ge.wnext?(ue-=ge.wnext,ve=ge.wsize-ue):ve=ge.wnext-ue,ue>ge.length&&(ue=ge.length),Oe=ge.window}else Oe=wt,ve=yt-ge.offset,ue=ge.length;ue>Ee&&(ue=Ee),Ee-=ue,ge.length-=ue;do wt[yt++]=Oe[ve++];while(--ue);ge.length===0&&(ge.mode=mt);break;case Jt:if(Ee===0)break e;wt[yt++]=ge.length,Ee--,ge.mode=mt;break;case Lt:if(ge.wrap){for(;ct<32;){if(Et===0)break e;Et--,Xe|=kt[W++]<<ct,ct+=8}if(ie-=Ee,Ye.total_out+=ie,ge.total+=ie,ie&&(Ye.adler=ge.check=ge.flags?t(ge.check,wt,ie,yt-ie):e(ge.check,wt,ie,yt-ie)),ie=Ee,(ge.flags?Xe:ti(Xe))!==ge.check){Ye.msg="incorrect data check",ge.mode=Er;break}Xe=0,ct=0}ge.mode=lr;case lr:if(ge.wrap&&ge.flags){for(;ct<32;){if(Et===0)break e;Et--,Xe+=kt[W++]<<ct,ct+=8}if(Xe!==(ge.total&4294967295)){Ye.msg="incorrect length check",ge.mode=Er;break}Xe=0,ct=0}ge.mode=tn;case tn:Ct=S;break e;case Er:Ct=U;break e;case Ar:return j;case In:default:return k}return Ye.next_out=yt,Ye.avail_out=Ee,Ye.next_in=W,Ye.avail_in=Et,ge.hold=Xe,ge.bits=ct,(ge.wsize||ie!==Ye.avail_out&&ge.mode<Er&&(ge.mode<Lt||Mt!==f))&&fi(Ye,Ye.output,Ye.next_out,ie-Ye.avail_out),Z-=Ye.avail_in,ie-=Ye.avail_out,Ye.total_in+=Z,Ye.total_out+=ie,ge.total+=ie,ge.wrap&&ie&&(Ye.adler=ge.check=ge.flags?t(ge.check,wt,ie,Ye.next_out-ie):e(ge.check,wt,ie,Ye.next_out-ie)),Ye.data_type=ge.bits+(ge.last?64:0)+(ge.mode===Be?128:0)+(ge.mode===lt||ge.mode===Ne?256:0),(Z===0&&ie===0||Mt===f)&&Ct===T&&(Ct=z),Ct}function Ot(Ye){if(!Ye||!Ye.state)return k;var Mt=Ye.state;return Mt.window&&(Mt.window=null),Ye.state=null,T}function Vt(Ye,Mt){var ge;return!Ye||!Ye.state||(ge=Ye.state,!(ge.wrap&2))?k:(ge.head=Mt,Mt.done=!1,T)}function sr(Ye,Mt){var ge=Mt.length,kt,wt,W;return!Ye||!Ye.state||(kt=Ye.state,kt.wrap!==0&&kt.mode!==ne)?k:kt.mode===ne&&(wt=1,wt=e(wt,Mt,ge,0),wt!==kt.check)?U:(W=fi(Ye,Mt,ge,ge),W?(kt.mode=Ar,j):(kt.havedict=1,T))}return ya.inflateReset=Kn,ya.inflateReset2=Nn,ya.inflateResetKeep=un,ya.inflateInit=Wn,ya.inflateInit2=vn,ya.inflate=Pe,ya.inflateEnd=Ot,ya.inflateGetHeader=Vt,ya.inflateSetDictionary=sr,ya.inflateInfo="pako inflate (from Nodeca project)",ya}var hb,fP;function xL(){return fP||(fP=1,hb={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),hb}var db,hP;function fge(){if(hP)return db;hP=1;function r(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return db=r,db}var dP;function hge(){if(dP)return dd;dP=1;var r=uge(),e=ef(),t=vL(),n=xL(),i=aC(),o=bL(),s=fge(),c=Object.prototype.toString;function f(T){if(!(this instanceof f))return new f(T);this.options=e.assign({chunkSize:16384,windowBits:0,to:""},T||{});var S=this.options;S.raw&&S.windowBits>=0&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),S.windowBits>=0&&S.windowBits<16&&!(T&&T.windowBits)&&(S.windowBits+=32),S.windowBits>15&&S.windowBits<48&&(S.windowBits&15||(S.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var F=r.inflateInit2(this.strm,S.windowBits);if(F!==n.Z_OK)throw new Error(i[F]);if(this.header=new s,r.inflateGetHeader(this.strm,this.header),S.dictionary&&(typeof S.dictionary=="string"?S.dictionary=t.string2buf(S.dictionary):c.call(S.dictionary)==="[object ArrayBuffer]"&&(S.dictionary=new Uint8Array(S.dictionary)),S.raw&&(F=r.inflateSetDictionary(this.strm,S.dictionary),F!==n.Z_OK)))throw new Error(i[F])}f.prototype.push=function(T,S){var F=this.strm,k=this.options.chunkSize,U=this.options.dictionary,j,z,V,K,fe,Q=!1;if(this.ended)return!1;z=S===~~S?S:S===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof T=="string"?F.input=t.binstring2buf(T):c.call(T)==="[object ArrayBuffer]"?F.input=new Uint8Array(T):F.input=T,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new e.Buf8(k),F.next_out=0,F.avail_out=k),j=r.inflate(F,n.Z_NO_FLUSH),j===n.Z_NEED_DICT&&U&&(j=r.inflateSetDictionary(this.strm,U)),j===n.Z_BUF_ERROR&&Q===!0&&(j=n.Z_OK,Q=!1),j!==n.Z_STREAM_END&&j!==n.Z_OK)return this.onEnd(j),this.ended=!0,!1;F.next_out&&(F.avail_out===0||j===n.Z_STREAM_END||F.avail_in===0&&(z===n.Z_FINISH||z===n.Z_SYNC_FLUSH))&&(this.options.to==="string"?(V=t.utf8border(F.output,F.next_out),K=F.next_out-V,fe=t.buf2string(F.output,V),F.next_out=K,F.avail_out=k-K,K&&e.arraySet(F.output,F.output,V,K,0),this.onData(fe)):this.onData(e.shrinkBuf(F.output,F.next_out))),F.avail_in===0&&F.avail_out===0&&(Q=!0)}while((F.avail_in>0||F.avail_out===0)&&j!==n.Z_STREAM_END);return j===n.Z_STREAM_END&&(z=n.Z_FINISH),z===n.Z_FINISH?(j=r.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===n.Z_OK):(z===n.Z_SYNC_FLUSH&&(this.onEnd(n.Z_OK),F.avail_out=0),!0)},f.prototype.onData=function(T){this.chunks.push(T)},f.prototype.onEnd=function(T){T===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=T,this.msg=this.strm.msg};function g(T,S){var F=new f(S);if(F.push(T,!0),F.err)throw F.msg||i[F.err];return F.result}function b(T,S){return S=S||{},S.raw=!0,g(T,S)}return dd.Inflate=f,dd.inflate=g,dd.inflateRaw=b,dd.ungzip=g,dd}var Ab,AP;function dge(){if(AP)return Ab;AP=1;var r=ef().assign,e=age(),t=hge(),n=xL(),i={};return r(i,e,t,n),Ab=i,Ab}var Age=dge();const Ad=th(Age),pP=[0],pge={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:mL,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,e,t)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}};class cC extends gs{initializeState(){"onTileLoadFail"in this.props&&Ur.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!((t=(e=this.state)==null?void 0:e.tileset3d)!=null&&t.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:n}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),n.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:i}=this.state;for(const o in i)i[o].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:n}=this.state;this.internalState.viewport=e,t[e.id]=e;const i=n==null?void 0:n[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){const n=t&&t.props.tile;return e.picked&&(e.object=n),e.sourceTile=n,e}filterSubLayer({layer:e,viewport:t}){const{tile:n}=e.props,{id:i}=t;return n.selected&&n.viewportIds.includes(i)}_updateAutoHighlight(e){const t=e.sourceTile,n=this.state.layerMap[t==null?void 0:t.id];n&&n.layer&&n.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props,n=this.props.loader||this.props.loaders,i=Array.isArray(n)?n[0]:n,o={loadOptions:{...t}};let s=e;if(i.preload){const g=await i.preload(e,t);g.url&&(s=g.url),g.headers&&(o.loadOptions.fetch={...o.loadOptions.fetch,headers:g.headers}),Object.assign(o,g)}const c=await Nl(s,i,o.loadOptions),f=new nhe(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...o});this.setState({tileset3d:f,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(f)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:n}=this.context,i=Object.keys(e).length;!n||!i||!t||t.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case Dl.POINTCLOUD:return this._makePointCloudLayer(e,t);case Dl.SCENEGRAPH:return this._make3DModelLayer(e);case Dl.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){const{attributes:n,pointCount:i,constantRGBA:o,cartographicOrigin:s,modelMatrix:c}=e.content,{positions:f,normals:g,colors:b}=n;if(!f)return null;const T=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:f,NORMAL:g,COLOR_0:b}},{pointSize:S,getPointColor:F}=this.props,k=this.getSubLayerClass("pointcloud",wg);return new k({pointSize:S},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:T,coordinateSystem:Wr.METER_OFFSETS,coordinateOrigin:s,modelMatrix:c,getColor:o||F,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:n,cartographicOrigin:i,modelMatrix:o}=e.content,s=this.getSubLayerClass("scenegraph",Sg);return new s({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:n||pP,scenegraph:t,coordinateSystem:Wr.METER_OFFSETS,coordinateOrigin:i,modelMatrix:o,getTransformMatrix:c=>c.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const n=e.content,{attributes:i,indices:o,modelMatrix:s,cartographicOrigin:c,coordinateSystem:f=Wr.METER_OFFSETS,material:g,featureIds:b}=n,{_getMeshColor:T}=this.props,S=t&&t.props.mesh||new Ts({topology:"triangle-list",attributes:gge(i),indices:o}),F=this.getSubLayerClass("mesh",Ww);return new F(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:S,data:pP,getColor:T(e),pbrMaterial:g,modelMatrix:s,coordinateOrigin:c,coordinateSystem:f,featureIds:b,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(n=>{const i=t[n.id]=t[n.id]||{tile:n};let{layer:o}=i;return n.selected&&(o?i.needsUpdate&&(o=this._getSubLayer(n,o),i.needsUpdate=!1):o=this._getSubLayer(n)),i.layer=o,o}).filter(Boolean):null}}cC.defaultProps=pge;cC.layerName="Tile3DLayer";function gge(r){const e={};return e.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(e.normals=r.normals),r.texCoords&&(e.texCoords=r.texCoords),r.colors&&(e.colors=r.colors),r.uvRegions&&(e.uvRegions=r.uvRegions),e}const mge="4.2.4",wL={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:mge,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};({...wL});const gP=[1],_ge={...Xl.defaultProps,elevationData:d_,texture:{...d_,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[wL]};function mP(r){return Array.isArray(r)?r.join(";"):r||""}class lC extends gs{updateState({props:e,oldProps:t}){const n=e.elevationData!==t.elevationData;if(n){const{elevationData:o}=e,s=o&&(Array.isArray(o)||o.includes("{x}")&&o.includes("{y}"));this.setState({isTiled:s})}const i=n||e.meshMaxError!==t.meshMaxError||e.elevationDecoder!==t.elevationDecoder||e.bounds!==t.bounds;if(!this.state.isTiled&&i){const o=this.loadTerrain(e);this.setState({terrain:o})}e.workerUrl&&Ur.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:t,elevationDecoder:n,meshMaxError:i,signal:o}){if(!e)return null;let s=this.getLoadOptions();s={...s,terrain:{skirtHeight:this.state.isTiled?i*2:0,...s==null?void 0:s.terrain,bounds:t,meshMaxError:i,elevationDecoder:n}};const{fetch:c}=this.props;return c(e,{propName:"elevationData",layer:this,loadOptions:s,signal:o})}getTiledTerrainData(e){const{elevationData:t,fetch:n,texture:i,elevationDecoder:o,meshMaxError:s}=this.props,{viewport:c}=this.context,f=Zf(t,e),g=i&&Zf(i,e),{signal:b}=e;let T=[0,0],S=[0,0];if(c.isGeospatial){const j=e.bbox;T=c.projectFlat([j.west,j.south]),S=c.projectFlat([j.east,j.north])}else{const j=e.bbox;T=[j.left,j.bottom],S=[j.right,j.top]}const F=[T[0],T[1],S[0],S[1]],k=this.loadTerrain({elevationData:f,bounds:F,elevationDecoder:o,meshMaxError:s,signal:b}),U=g?n(g,{propName:"texture",layer:this,loaders:[],signal:b}).catch(j=>null):Promise.resolve(null);return Promise.all([k,U])}renderSubLayers(e){const t=this.getSubLayerClass("mesh",Yf),{color:n,wireframe:i,material:o}=this.props,{data:s}=e;if(!s)return null;const[c,f]=s;return new t(e,{data:gP,mesh:c,texture:f,_instanced:!1,coordinateSystem:Wr.CARTESIAN,getPosition:g=>[0,0,0],getColor:n,wireframe:i,material:o})}onViewportLoad(e){if(!e)return;const{zRange:t}=this.state,n=e.map(s=>s.content).filter(Boolean).map(s=>s[0].header.boundingBox.map(f=>f[2]));if(n.length===0)return;const i=Math.min(...n.map(s=>s[0])),o=Math.max(...n.map(s=>s[1]));(!t||i<t[0]||o>t[1])&&this.setState({zRange:[i,o]})}renderLayers(){const{color:e,material:t,elevationData:n,texture:i,wireframe:o,meshMaxError:s,elevationDecoder:c,tileSize:f,maxZoom:g,minZoom:b,extent:T,maxRequests:S,onTileLoad:F,onTileUnload:k,onTileError:U,maxCacheSize:j,maxCacheByteSize:z,refinementStrategy:V}=this.props;if(this.state.isTiled)return new Xl(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:mP(n),texture:mP(i),meshMaxError:s,elevationDecoder:c}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:f,maxZoom:g,minZoom:b,extent:T,maxRequests:S,onTileLoad:F,onTileUnload:k,onTileError:U,maxCacheSize:j,maxCacheByteSize:z,refinementStrategy:V});if(!n)return null;const K=this.getSubLayerClass("mesh",Yf);return new K(this.getSubLayerProps({id:"mesh"}),{data:gP,mesh:this.state.terrain,texture:i,_instanced:!1,getPosition:fe=>[0,0,0],getColor:e,material:t,wireframe:o})}}lC.defaultProps=_ge;lC.layerName="TerrainLayer";const yge={clipBounds:[0,0,1,1],clipByInstance:void 0},CL=`
uniform vec4 clip_bounds;
bool clip_isInBounds(vec2 position) {
return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,vge={name:"clip-vs",vs:CL},bge={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
if (clip_isVisible < 0.5) discard;
`},xge={name:"clip-fs",fs:CL},wge={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
if (!clip_isInBounds(clip_commonPosition)) discard;
`};class Ty extends Kx{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[vge],inject:bge}:{modules:[xge],inject:wge}}draw({uniforms:e}){const{clipBounds:t}=this.props;if(this.state.clipByInstance)e.clip_bounds=t;else{const n=this.projectPosition([t[0],t[1],0]),i=this.projectPosition([t[2],t[3],0]);e.clip_bounds=[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[0],i[0]),Math.max(n[1],i[1])]}}}Ty.defaultProps=yge;Ty.extensionName="ClipExtension";function rx(r,e){const t=e==null?void 0:e.globalFeatureId;return t!==void 0?Cge(r,t):Ege(r,e==null?void 0:e.type)}function Cge(r,e){const t=EL(r);for(const n of t){let i=0,o=n.featureIds.value[0];for(let s=0;s<n.featureIds.value.length;s++){const c=n.featureIds.value[s];if(c!==o){if(e===n.globalFeatureIds.value[i])return x_(n,i,s);i=s,o=c}}if(e===n.globalFeatureIds.value[i])return x_(n,i,n.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function Ege(r,e){const t=EL(r);return Bge(t)}function Tge(r,e,t){switch(r.type){case"Point":return Pge(r,e,t);case"LineString":return Mge(r,e,t);case"Polygon":return TL(r,e,t);default:const n=r;throw new Error(`Unsupported geometry type: ${n==null?void 0:n.type}`)}}function EL(r,e){const t=[];return r.points&&(r.points.type="Point",t.push(r.points)),r.lines&&(r.lines.type="LineString",t.push(r.lines)),r.polygons&&(r.polygons.type="Polygon",t.push(r.polygons)),t}function Bge(r){const e=[];for(const t of r){if(t.featureIds.value.length===0)continue;let n=0,i=t.featureIds.value[0];for(let o=0;o<t.featureIds.value.length;o++){const s=t.featureIds.value[o];s!==i&&(e.push(x_(t,n,o)),n=o,i=s)}e.push(x_(t,n,t.featureIds.value.length))}return e}function x_(r,e,t){const n=Tge(r,e,t),i=Ige(r,e),o=Sge(r,e);return{type:"Feature",geometry:n,properties:i,...o}}function Sge(r,e=0,t){return r.fields&&r.fields[r.featureIds.value[e]]}function Ige(r,e=0,t){const n=Object.assign({},r.properties[r.featureIds.value[e]]);for(const i in r.numericProps)n[i]=r.numericProps[i].value[e];return n}function TL(r,e=-1/0,t=1/0){const{positions:n}=r,i=r.polygonIndices.value.filter(f=>f>=e&&f<=t),o=r.primitivePolygonIndices.value.filter(f=>f>=e&&f<=t);if(!(i.length>2)){const f=[];for(let g=0;g<o.length-1;g++){const b=o[g],T=o[g+1],S=w_(n,b,T);f.push(S)}return{type:"Polygon",coordinates:f}}const c=[];for(let f=0;f<i.length-1;f++){const g=i[f],b=i[f+1],T=TL(r,g,b).coordinates;c.push(T)}return{type:"MultiPolygon",coordinates:c}}function Mge(r,e=-1/0,t=1/0){const{positions:n}=r,i=r.pathIndices.value.filter(c=>c>=e&&c<=t);if(!(i.length>2))return{type:"LineString",coordinates:w_(n,i[0],i[1])};const s=[];for(let c=0;c<i.length-1;c++){const f=w_(n,i[c],i[c+1]);s.push(f)}return{type:"MultiLineString",coordinates:s}}function Pge(r,e,t){const{positions:n}=r,i=w_(n,e,t);return i.length>1?{type:"MultiPoint",coordinates:i}:{type:"Point",coordinates:i[0]}}function w_(r,e,t){e=e||0,t=t||r.value.length/r.size;const n=[];for(let i=e;i<t;i++){const o=Array();for(let s=i*r.size;s<(i+1)*r.size;s++)o.push(Number(r.value[s]));n.push(o)}return n}var rm={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var _P;function Rge(){return _P||(_P=1,rm.read=function(r,e,t,n,i){var o,s,c=i*8-n-1,f=(1<<c)-1,g=f>>1,b=-7,T=t?i-1:0,S=t?-1:1,F=r[e+T];for(T+=S,o=F&(1<<-b)-1,F>>=-b,b+=c;b>0;o=o*256+r[e+T],T+=S,b-=8);for(s=o&(1<<-b)-1,o>>=-b,b+=n;b>0;s=s*256+r[e+T],T+=S,b-=8);if(o===0)o=1-g;else{if(o===f)return s?NaN:(F?-1:1)*(1/0);s=s+Math.pow(2,n),o=o-g}return(F?-1:1)*s*Math.pow(2,o-n)},rm.write=function(r,e,t,n,i,o){var s,c,f,g=o*8-i-1,b=(1<<g)-1,T=b>>1,S=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=n?0:o-1,k=n?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,s=b):(s=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-s))<1&&(s--,f*=2),s+T>=1?e+=S/f:e+=S*Math.pow(2,1-T),e*f>=2&&(s++,f/=2),s+T>=b?(c=0,s=b):s+T>=1?(c=(e*f-1)*Math.pow(2,i),s=s+T):(c=e*Math.pow(2,T-1)*Math.pow(2,i),s=0));i>=8;r[t+F]=c&255,F+=k,c/=256,i-=8);for(s=s<<i|c,g+=i;g>0;r[t+F]=s&255,F+=k,s/=256,g-=8);r[t+F-k]|=U*128}),rm}var pb,yP;function Fge(){if(yP)return pb;yP=1,pb=e;var r=Rge();function e(X){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(X)?X:new Uint8Array(X||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var t=65536*65536,n=1/t,i=12,o=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");e.prototype={destroy:function(){this.buf=null},readFields:function(X,ne,Be){for(Be=Be||this.length;this.pos<Be;){var Ze=this.readVarint(),Ce=Ze>>3,Ne=this.pos;this.type=Ze&7,X(Ce,ne,this),this.pos===Ne&&this.skip(Ze)}return ne},readMessage:function(X,ne){return this.readFields(X,ne,this.readVarint()+this.pos)},readFixed32:function(){var X=oe(this.buf,this.pos);return this.pos+=4,X},readSFixed32:function(){var X=ze(this.buf,this.pos);return this.pos+=4,X},readFixed64:function(){var X=oe(this.buf,this.pos)+oe(this.buf,this.pos+4)*t;return this.pos+=8,X},readSFixed64:function(){var X=oe(this.buf,this.pos)+ze(this.buf,this.pos+4)*t;return this.pos+=8,X},readFloat:function(){var X=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,X},readDouble:function(){var X=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,X},readVarint:function(X){var ne=this.buf,Be,Ze;return Ze=ne[this.pos++],Be=Ze&127,Ze<128||(Ze=ne[this.pos++],Be|=(Ze&127)<<7,Ze<128)||(Ze=ne[this.pos++],Be|=(Ze&127)<<14,Ze<128)||(Ze=ne[this.pos++],Be|=(Ze&127)<<21,Ze<128)?Be:(Ze=ne[this.pos],Be|=(Ze&15)<<28,s(Be,X,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var X=this.readVarint();return X%2===1?(X+1)/-2:X/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var X=this.readVarint()+this.pos,ne=this.pos;return this.pos=X,X-ne>=i&&o?_e(this.buf,ne,X):Ae(this.buf,ne,X)},readBytes:function(){var X=this.readVarint()+this.pos,ne=this.buf.subarray(this.pos,X);return this.pos=X,ne},readPackedVarint:function(X,ne){if(this.type!==e.Bytes)return X.push(this.readVarint(ne));var Be=c(this);for(X=X||[];this.pos<Be;)X.push(this.readVarint(ne));return X},readPackedSVarint:function(X){if(this.type!==e.Bytes)return X.push(this.readSVarint());var ne=c(this);for(X=X||[];this.pos<ne;)X.push(this.readSVarint());return X},readPackedBoolean:function(X){if(this.type!==e.Bytes)return X.push(this.readBoolean());var ne=c(this);for(X=X||[];this.pos<ne;)X.push(this.readBoolean());return X},readPackedFloat:function(X){if(this.type!==e.Bytes)return X.push(this.readFloat());var ne=c(this);for(X=X||[];this.pos<ne;)X.push(this.readFloat());return X},readPackedDouble:function(X){if(this.type!==e.Bytes)return X.push(this.readDouble());var ne=c(this);for(X=X||[];this.pos<ne;)X.push(this.readDouble());return X},readPackedFixed32:function(X){if(this.type!==e.Bytes)return X.push(this.readFixed32());var ne=c(this);for(X=X||[];this.pos<ne;)X.push(this.readFixed32());return X},readPackedSFixed32:function(X){if(this.type!==e.Bytes)return X.push(this.readSFixed32());var ne=c(this);for(X=X||[];this.pos<ne;)X.push(this.readSFixed32());return X},readPackedFixed64:function(X){if(this.type!==e.Bytes)return X.push(this.readFixed64());var ne=c(this);for(X=X||[];this.pos<ne;)X.push(this.readFixed64());return X},readPackedSFixed64:function(X){if(this.type!==e.Bytes)return X.push(this.readSFixed64());var ne=c(this);for(X=X||[];this.pos<ne;)X.push(this.readSFixed64());return X},skip:function(X){var ne=X&7;if(ne===e.Varint)for(;this.buf[this.pos++]>127;);else if(ne===e.Bytes)this.pos=this.readVarint()+this.pos;else if(ne===e.Fixed32)this.pos+=4;else if(ne===e.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+ne)},writeTag:function(X,ne){this.writeVarint(X<<3|ne)},realloc:function(X){for(var ne=this.length||16;ne<this.pos+X;)ne*=2;if(ne!==this.length){var Be=new Uint8Array(ne);Be.set(this.buf),this.buf=Be,this.length=ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(X){this.realloc(4),Te(this.buf,X,this.pos),this.pos+=4},writeSFixed32:function(X){this.realloc(4),Te(this.buf,X,this.pos),this.pos+=4},writeFixed64:function(X){this.realloc(8),Te(this.buf,X&-1,this.pos),Te(this.buf,Math.floor(X*n),this.pos+4),this.pos+=8},writeSFixed64:function(X){this.realloc(8),Te(this.buf,X&-1,this.pos),Te(this.buf,Math.floor(X*n),this.pos+4),this.pos+=8},writeVarint:function(X){if(X=+X||0,X>268435455||X<0){g(X,this);return}this.realloc(4),this.buf[this.pos++]=X&127|(X>127?128:0),!(X<=127)&&(this.buf[this.pos++]=(X>>>=7)&127|(X>127?128:0),!(X<=127)&&(this.buf[this.pos++]=(X>>>=7)&127|(X>127?128:0),!(X<=127)&&(this.buf[this.pos++]=X>>>7&127)))},writeSVarint:function(X){this.writeVarint(X<0?-X*2-1:X*2)},writeBoolean:function(X){this.writeVarint(!!X)},writeString:function(X){X=String(X),this.realloc(X.length*4),this.pos++;var ne=this.pos;this.pos=pe(this.buf,X,this.pos);var Be=this.pos-ne;Be>=128&&S(ne,Be,this),this.pos=ne-1,this.writeVarint(Be),this.pos+=Be},writeFloat:function(X){this.realloc(4),r.write(this.buf,X,this.pos,!0,23,4),this.pos+=4},writeDouble:function(X){this.realloc(8),r.write(this.buf,X,this.pos,!0,52,8),this.pos+=8},writeBytes:function(X){var ne=X.length;this.writeVarint(ne),this.realloc(ne);for(var Be=0;Be<ne;Be++)this.buf[this.pos++]=X[Be]},writeRawMessage:function(X,ne){this.pos++;var Be=this.pos;X(ne,this);var Ze=this.pos-Be;Ze>=128&&S(Be,Ze,this),this.pos=Be-1,this.writeVarint(Ze),this.pos+=Ze},writeMessage:function(X,ne,Be){this.writeTag(X,e.Bytes),this.writeRawMessage(ne,Be)},writePackedVarint:function(X,ne){ne.length&&this.writeMessage(X,F,ne)},writePackedSVarint:function(X,ne){ne.length&&this.writeMessage(X,k,ne)},writePackedBoolean:function(X,ne){ne.length&&this.writeMessage(X,z,ne)},writePackedFloat:function(X,ne){ne.length&&this.writeMessage(X,U,ne)},writePackedDouble:function(X,ne){ne.length&&this.writeMessage(X,j,ne)},writePackedFixed32:function(X,ne){ne.length&&this.writeMessage(X,V,ne)},writePackedSFixed32:function(X,ne){ne.length&&this.writeMessage(X,K,ne)},writePackedFixed64:function(X,ne){ne.length&&this.writeMessage(X,fe,ne)},writePackedSFixed64:function(X,ne){ne.length&&this.writeMessage(X,Q,ne)},writeBytesField:function(X,ne){this.writeTag(X,e.Bytes),this.writeBytes(ne)},writeFixed32Field:function(X,ne){this.writeTag(X,e.Fixed32),this.writeFixed32(ne)},writeSFixed32Field:function(X,ne){this.writeTag(X,e.Fixed32),this.writeSFixed32(ne)},writeFixed64Field:function(X,ne){this.writeTag(X,e.Fixed64),this.writeFixed64(ne)},writeSFixed64Field:function(X,ne){this.writeTag(X,e.Fixed64),this.writeSFixed64(ne)},writeVarintField:function(X,ne){this.writeTag(X,e.Varint),this.writeVarint(ne)},writeSVarintField:function(X,ne){this.writeTag(X,e.Varint),this.writeSVarint(ne)},writeStringField:function(X,ne){this.writeTag(X,e.Bytes),this.writeString(ne)},writeFloatField:function(X,ne){this.writeTag(X,e.Fixed32),this.writeFloat(ne)},writeDoubleField:function(X,ne){this.writeTag(X,e.Fixed64),this.writeDouble(ne)},writeBooleanField:function(X,ne){this.writeVarintField(X,!!ne)}};function s(X,ne,Be){var Ze=Be.buf,Ce,Ne;if(Ne=Ze[Be.pos++],Ce=(Ne&112)>>4,Ne<128||(Ne=Ze[Be.pos++],Ce|=(Ne&127)<<3,Ne<128)||(Ne=Ze[Be.pos++],Ce|=(Ne&127)<<10,Ne<128)||(Ne=Ze[Be.pos++],Ce|=(Ne&127)<<17,Ne<128)||(Ne=Ze[Be.pos++],Ce|=(Ne&127)<<24,Ne<128)||(Ne=Ze[Be.pos++],Ce|=(Ne&1)<<31,Ne<128))return f(X,Ce,ne);throw new Error("Expected varint not more than 10 bytes")}function c(X){return X.type===e.Bytes?X.readVarint()+X.pos:X.pos+1}function f(X,ne,Be){return Be?ne*4294967296+(X>>>0):(ne>>>0)*4294967296+(X>>>0)}function g(X,ne){var Be,Ze;if(X>=0?(Be=X%4294967296|0,Ze=X/4294967296|0):(Be=~(-X%4294967296),Ze=~(-X/4294967296),Be^4294967295?Be=Be+1|0:(Be=0,Ze=Ze+1|0)),X>=18446744073709552e3||X<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ne.realloc(10),b(Be,Ze,ne),T(Ze,ne)}function b(X,ne,Be){Be.buf[Be.pos++]=X&127|128,X>>>=7,Be.buf[Be.pos++]=X&127|128,X>>>=7,Be.buf[Be.pos++]=X&127|128,X>>>=7,Be.buf[Be.pos++]=X&127|128,X>>>=7,Be.buf[Be.pos]=X&127}function T(X,ne){var Be=(X&7)<<4;ne.buf[ne.pos++]|=Be|((X>>>=3)?128:0),X&&(ne.buf[ne.pos++]=X&127|((X>>>=7)?128:0),X&&(ne.buf[ne.pos++]=X&127|((X>>>=7)?128:0),X&&(ne.buf[ne.pos++]=X&127|((X>>>=7)?128:0),X&&(ne.buf[ne.pos++]=X&127|((X>>>=7)?128:0),X&&(ne.buf[ne.pos++]=X&127)))))}function S(X,ne,Be){var Ze=ne<=16383?1:ne<=2097151?2:ne<=268435455?3:Math.floor(Math.log(ne)/(Math.LN2*7));Be.realloc(Ze);for(var Ce=Be.pos-1;Ce>=X;Ce--)Be.buf[Ce+Ze]=Be.buf[Ce]}function F(X,ne){for(var Be=0;Be<X.length;Be++)ne.writeVarint(X[Be])}function k(X,ne){for(var Be=0;Be<X.length;Be++)ne.writeSVarint(X[Be])}function U(X,ne){for(var Be=0;Be<X.length;Be++)ne.writeFloat(X[Be])}function j(X,ne){for(var Be=0;Be<X.length;Be++)ne.writeDouble(X[Be])}function z(X,ne){for(var Be=0;Be<X.length;Be++)ne.writeBoolean(X[Be])}function V(X,ne){for(var Be=0;Be<X.length;Be++)ne.writeFixed32(X[Be])}function K(X,ne){for(var Be=0;Be<X.length;Be++)ne.writeSFixed32(X[Be])}function fe(X,ne){for(var Be=0;Be<X.length;Be++)ne.writeFixed64(X[Be])}function Q(X,ne){for(var Be=0;Be<X.length;Be++)ne.writeSFixed64(X[Be])}function oe(X,ne){return(X[ne]|X[ne+1]<<8|X[ne+2]<<16)+X[ne+3]*16777216}function Te(X,ne,Be){X[Be]=ne,X[Be+1]=ne>>>8,X[Be+2]=ne>>>16,X[Be+3]=ne>>>24}function ze(X,ne){return(X[ne]|X[ne+1]<<8|X[ne+2]<<16)+(X[ne+3]<<24)}function Ae(X,ne,Be){for(var Ze="",Ce=ne;Ce<Be;){var Ne=X[Ce],Ge=null,Qe=Ne>239?4:Ne>223?3:Ne>191?2:1;if(Ce+Qe>Be)break;var rt,tt,lt;Qe===1?Ne<128&&(Ge=Ne):Qe===2?(rt=X[Ce+1],(rt&192)===128&&(Ge=(Ne&31)<<6|rt&63,Ge<=127&&(Ge=null))):Qe===3?(rt=X[Ce+1],tt=X[Ce+2],(rt&192)===128&&(tt&192)===128&&(Ge=(Ne&15)<<12|(rt&63)<<6|tt&63,(Ge<=2047||Ge>=55296&&Ge<=57343)&&(Ge=null))):Qe===4&&(rt=X[Ce+1],tt=X[Ce+2],lt=X[Ce+3],(rt&192)===128&&(tt&192)===128&&(lt&192)===128&&(Ge=(Ne&15)<<18|(rt&63)<<12|(tt&63)<<6|lt&63,(Ge<=65535||Ge>=1114112)&&(Ge=null))),Ge===null?(Ge=65533,Qe=1):Ge>65535&&(Ge-=65536,Ze+=String.fromCharCode(Ge>>>10&1023|55296),Ge=56320|Ge&1023),Ze+=String.fromCharCode(Ge),Ce+=Qe}return Ze}function _e(X,ne,Be){return o.decode(X.subarray(ne,Be))}function pe(X,ne,Be){for(var Ze=0,Ce,Ne;Ze<ne.length;Ze++){if(Ce=ne.charCodeAt(Ze),Ce>55295&&Ce<57344)if(Ne)if(Ce<56320){X[Be++]=239,X[Be++]=191,X[Be++]=189,Ne=Ce;continue}else Ce=Ne-55296<<10|Ce-56320|65536,Ne=null;else{Ce>56319||Ze+1===ne.length?(X[Be++]=239,X[Be++]=191,X[Be++]=189):Ne=Ce;continue}else Ne&&(X[Be++]=239,X[Be++]=191,X[Be++]=189,Ne=null);Ce<128?X[Be++]=Ce:(Ce<2048?X[Be++]=Ce>>6|192:(Ce<65536?X[Be++]=Ce>>12|224:(X[Be++]=Ce>>18|240,X[Be++]=Ce>>12&63|128),X[Be++]=Ce>>6&63|128),X[Be++]=Ce&63|128)}return Be}return pb}var Dge=Fge();const Oge=th(Dge),Lge="4.2.4",BL={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:Lge,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}}};({...BL});const Nge={Point:SL,MultiPoint:kge,LineString:IL,MultiLineString:Uge,Polygon:ML,MultiPolygon:zge};function SL([r,e],[t,n],i){const o=ac(t[0],n[0],r),s=ac(t[1],n[1],e);return i.unprojectFlat([o,s])}function uC(r,e,t){return r.map(n=>SL(n,e,t))}function kge(r,e,t){return uC(r,e,t)}function IL(r,e,t){return uC(r,e,t)}function Uge(r,e,t){return r.map(n=>IL(n,e,t))}function ML(r,e,t){return r.map(n=>uC(n,e,t))}function zge(r,e,t){return r.map(n=>ML(n,e,t))}function Gge(r,e,t){const n=t.projectFlat([e.west,e.north]),i=t.projectFlat([e.east,e.south]),o=[n,i];return{...r,coordinates:Nge[r.type](r.coordinates,o,t)}}const Vge=["points","lines","polygons"];function Hge(r,e,t,n){for(const i of Vge){const o=r[i]&&jge(r[i],e,t,n);if(o>=0)return o}return-1}function jge(r,e,t,n){const i=r.featureIds.value;if(!i.length)return-1;let o=0,s=i[i.length-1]+1;if(n){const f=Jge(r,n);if(f)o=f[0],s=f[1]+1;else return-1}let c=-1;if(e in r.numericProps){const f=r.numericProps[e].value.findIndex((g,b)=>g===t&&i[b]>=o&&i[b]<s);return f>=0?r.globalFeatureIds.value[f]:-1}else e?c=vP(r.properties,f=>f[e]===t,o,s):r.fields&&(c=vP(r.fields,f=>f.id===t,o,s));return c>=0?Wge(r,c):-1}function Jge(r,e){if(!r.__layers){const t={},{properties:n}=r;for(let i=0;i<n.length;i++){const{layerName:o}=n[i];o&&(t[o]?t[o][1]=i:t[o]=[i,i])}r.__layers=t}return r.__layers[e]}function Wge(r,e){if(!r.__ids){const t=[],n=r.featureIds.value,i=r.globalFeatureIds.value;for(let o=0;o<n.length;o++)t[n[o]]=i[o];r.__ids=t}return r.__ids[e]}function vP(r,e,t,n){for(let i=t;i<n;i++)if(e(r[i],i))return i;return-1}const gb=512,Xge={...Wl.defaultProps,data:d_,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[BL],binary:!0};class EA extends Xl{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var e;return!!((e=this.state)!=null&&e.data&&super.isLoaded)}updateState({props:e,oldProps:t,context:n,changeFlags:i}){var s;i.dataChanged&&this._updateTileData(),(s=this.state)!=null&&s.data&&(super.updateState({props:e,oldProps:t,context:n,changeFlags:i}),this._setWGS84PropertyForTiles());const{highlightColor:o}=e;o!==t.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let e=this.props.data,t=null;if(typeof e=="string"&&!doe(e)){const{onDataLoad:n,fetch:i}=this.props;this.setState({data:null,tileJSON:null});try{t=await i(e,{propName:"data",layer:this,loaders:[]})}catch(o){this.raiseError(o,"loading TileJSON"),e=null}n&&n(t,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(t=e);t&&(e=t.tiles),this.setState({data:e,tileJSON:t})}_getTilesetOptions(){const e=super._getTilesetOptions(),t=this.state.tileJSON,{minZoom:n,maxZoom:i}=this.props;return t&&(Number.isFinite(t.minzoom)&&t.minzoom>n&&(e.minZoom=t.minzoom),Number.isFinite(t.maxzoom)&&(!Number.isFinite(i)||t.maxzoom<i)&&(e.maxZoom=t.maxzoom)),e}renderLayers(){var e;return(e=this.state)!=null&&e.data?super.renderLayers():null}getTileData(e){const{data:t,binary:n}=this.state,{index:i,signal:o}=e,s=Zf(t,e);if(!s)return Promise.reject("Invalid URL");let c=this.getLoadOptions();const{fetch:f}=this.props;return c={...c,mimeType:"application/x-protobuf",mvt:{...c==null?void 0:c.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:i},gis:n?{format:"binary"}:{}},f(s,{propName:"data",layer:this,loadOptions:c,signal:o})}renderSubLayers(e){const{x:t,y:n,z:i}=e.tile.index,o=Math.pow(2,i),s=gb/o,c=-s,f=gb*t/o,g=gb*(1-n/o),b=new dn().scale([s,c,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=b,e.coordinateOrigin=[f,g,0],e.coordinateSystem=Wr.CARTESIAN,e.extensions=[...e.extensions||[],new Ty]);const T=super.renderSubLayers(e);return this.state.binary&&!(T instanceof Wl)&&Ur.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),T}_updateAutoHighlight(e){const{uniqueIdProperty:t}=this.props,{hoveredFeatureId:n,hoveredFeatureLayerName:i}=this.state,o=e.object;let s=null,c=null;o&&(s=mb(o,t),c=bP(o));let{highlightColor:f}=this.props;typeof f=="function"&&(f=f(e)),(n!==s||i!==c)&&this.setState({highlightColor:f,hoveredFeatureId:s,hoveredFeatureLayerName:c})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const t=super.getPickingInfo(e);if(this.state.binary&&t.index!==-1){const{data:n}=e.sourceLayer.props;t.object=rx(n,{globalFeatureId:t.index})}return t.object&&!this._isWGS84()&&(t.object=wP(t.object,t.tile.bbox,this.context.viewport)),t}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:t,hoveredFeatureLayerName:n,binary:i}=this.state,{uniqueIdProperty:o,highlightedFeatureId:s}=this.props,c=e.content,f=xP(s);if(!(xP(t)||f))return-1;const b=f?s:t;return Array.isArray(c)?c.findIndex(T=>{const S=mb(T,o)===b,F=f||bP(T)===n;return S&&F}):c&&i?Hge(c,o,b,f?"":n):-1}_pickObjects(e){const{deck:t,viewport:n}=this.context,i=n.width,o=n.height,s=n.x,c=n.y,f=[this.id];return t.pickObjects({x:s,y:c,width:i,height:o,layerIds:f,maxObjects:e})}getRenderedFeatures(e=null){const t=this._pickObjects(e),n=new Set,i=[];for(const o of t){const s=mb(o.object,this.props.uniqueIdProperty);s===void 0?i.push(o.object):n.has(s)||(n.add(s),i.push(o.object))}return i}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(n=>{n.hasOwnProperty(e)||Object.defineProperty(n,e,{get:()=>{if(!n.content)return null;if(this.state.binary&&Array.isArray(n.content)&&!n.content.length)return[];const{bbox:i}=n;if(n._contentWGS84===void 0&&Aoe(i)){const o=this.state.binary?rx(n.content):n.content;n._contentWGS84=o.map(s=>wP(s,i,this.context.viewport))}return n._contentWGS84}})})}}EA.layerName="MVTLayer";EA.defaultProps=Xge;function mb(r,e){if(r.properties&&e)return r.properties[e];if("id"in r)return r.id}function bP(r){var e;return((e=r.properties)==null?void 0:e.layerName)||null}function xP(r){return r!=null&&r!==""}function wP(r,e,t){const n={...r,geometry:{type:r.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>Gge(r.geometry,e,t).coordinates}),n}const CP="0123456789bcdefghjkmnpqrstuvwxyz",PL={};for(let r=0;r<CP.length;r++)PL[CP.charAt(r)]=r;const $ge=-90,Kge=90,qge=-180,Zge=180;function Yge(r){let e=!0,t=Kge,n=$ge,i=Zge,o=qge,s,c=0;for(let f=0,g=r.length;f<g;f++){const b=r[f].toLowerCase();c=PL[b];for(let T=4;T>=0;T--){const S=c>>T&1;e?(s=(i+o)/2,S===1?o=s:i=s):(s=(t+n)/2,S===1?n=s:t=s),e=!e}}return[n,o,t,i]}function Qge(r){const[e,t,n,i]=Yge(r);return[i,n,i,e,t,e,t,n,i,n]}const e0e={getGeohash:{type:"accessor",value:r=>r.geohash}};class By extends Qu{indexToBounds(){const{data:e,getGeohash:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(n,i)=>Qge(t(n,i))}}}By.layerName="GeohashLayer";By.defaultProps=e0e;const t0e=Object.freeze(Object.defineProperty({__proto__:null,GeohashLayer:By,GreatCircleLayer:ww,H3ClusterLayer:gy,H3HexagonLayer:tl,MVTLayer:EA,QuadkeyLayer:uy,S2Layer:ly,TerrainLayer:lC,Tile3DLayer:cC,TileLayer:Xl,TripsLayer:dy,_GeoCellLayer:Qu,_Tile2DHeader:k6,_Tileset2D:hy,_WMSLayer:xw,_getURLFromTemplate:Zf},Symbol.toStringTag,{value:"Module"}));var vp={},_b,EP;function r0e(){if(EP)return _b;EP=1;var r=Math.PI/180,e=180/Math.PI;function t(V){var K=i(V[0]+1,V[2]),fe=i(V[0],V[2]),Q=o(V[1]+1,V[2]),oe=o(V[1],V[2]);return[fe,Q,K,oe]}function n(V){var K=t(V),fe={type:"Polygon",coordinates:[[[K[0],K[1]],[K[0],K[3]],[K[2],K[3]],[K[2],K[1]],[K[0],K[1]]]]};return fe}function i(V,K){return V/Math.pow(2,K)*360-180}function o(V,K){var fe=Math.PI-2*Math.PI*V/Math.pow(2,K);return e*Math.atan(.5*(Math.exp(fe)-Math.exp(-fe)))}function s(V,K,fe){var Q=z(V,K,fe);return Q[0]=Math.floor(Q[0]),Q[1]=Math.floor(Q[1]),Q}function c(V){return[[V[0]*2,V[1]*2,V[2]+1],[V[0]*2+1,V[1]*2,V[2]+1],[V[0]*2+1,V[1]*2+1,V[2]+1],[V[0]*2,V[1]*2+1,V[2]+1]]}function f(V){return V[0]%2===0&&V[1]%2===0?[V[0]/2,V[1]/2,V[2]-1]:V[0]%2===0&&!V[1]%2===0?[V[0]/2,(V[1]-1)/2,V[2]-1]:!V[0]%2===0&&V[1]%2===0?[(V[0]-1)/2,V[1]/2,V[2]-1]:[(V[0]-1)/2,(V[1]-1)/2,V[2]-1]}function g(V){return c(f(V))}function b(V,K){for(var fe=g(V),Q=0;Q<fe.length;Q++)if(!T(K,fe[Q]))return!1;return!0}function T(V,K){for(var fe=0;fe<V.length;fe++)if(S(V[fe],K))return!0;return!1}function S(V,K){return V[0]===K[0]&&V[1]===K[1]&&V[2]===K[2]}function F(V){for(var K="",fe=V[2];fe>0;fe--){var Q=0,oe=1<<fe-1;V[0]&oe&&Q++,V[1]&oe&&(Q+=2),K+=Q.toString()}return K}function k(V){for(var K=0,fe=0,Q=V.length,oe=Q;oe>0;oe--){var Te=1<<oe-1;switch(V[Q-oe]){case"0":break;case"1":K|=Te;break;case"2":fe|=Te;break;case"3":K|=Te,fe|=Te;break}}return[K,fe,Q]}function U(V){var K=s(V[0],V[1],32),fe=s(V[2],V[3],32),Q=[K[0],K[1],fe[0],fe[1]],oe=j(Q);if(oe===0)return[0,0,0];var Te=Q[0]>>>32-oe,ze=Q[1]>>>32-oe;return[Te,ze,oe]}function j(V){for(var K=28,fe=0;fe<K;fe++){var Q=1<<32-(fe+1);if((V[0]&Q)!=(V[2]&Q)||(V[1]&Q)!=(V[3]&Q))return fe}return K}function z(V,K,fe){var Q=Math.sin(K*r),oe=Math.pow(2,fe),Te=oe*(V/360+.5),ze=oe*(.5-.25*Math.log((1+Q)/(1-Q))/Math.PI);return[Te,ze,fe]}return _b={tileToGeoJSON:n,tileToBBOX:t,getChildren:c,getParent:f,getSiblings:g,hasTile:T,hasSiblings:b,tilesEqual:S,tileToQuadkey:F,quadkeyToTile:k,pointToTile:s,bboxToTile:U,pointToTileFraction:z},_b}var TP;function n0e(){if(TP)return vp;TP=1;var r=r0e();vp.geojson=function(b,T){return{type:"FeatureCollection",features:t(b,T).map(e)}};function e(b){return{type:"Feature",geometry:r.tileToGeoJSON(b),properties:{}}}vp.tiles=t,vp.indexes=function(b,T){return t(b,T).map(r.tileToQuadkey)};function t(b,T){var S,F,k=b.coordinates,U=T.max_zoom,j={},z=[];if(b.type==="Point")return[r.pointToTile(k[0],k[1],U)];if(b.type==="MultiPoint")for(S=0;S<k.length;S++)F=r.pointToTile(k[S][0],k[S][1],U),j[f(F[0],F[1],F[2])]=!0;else if(b.type==="LineString")s(j,k,U);else if(b.type==="MultiLineString")for(S=0;S<k.length;S++)s(j,k[S],U);else if(b.type==="Polygon")i(j,z,k,U);else if(b.type==="MultiPolygon")for(S=0;S<k.length;S++)i(j,z,k[S],U);else throw new Error("Geometry type not implemented");if(T.min_zoom!==U){var V=z.length;for(c(j,z),S=0;S<V;S++){var K=z[S];j[f(K[0],K[1],K[2])]=!0}return n(j,z,T)}return c(j,z),z}function n(b,T,S){for(var F=[],k=S.max_zoom;k>S.min_zoom;k--){for(var U={},j=[],z=0;z<T.length;z++){var V=T[z];if(V[0]%2===0&&V[1]%2===0){var K=f(V[0]+1,V[1],k),fe=f(V[0],V[1]+1,k),Q=f(V[0]+1,V[1]+1,k);if(b[K]&&b[fe]&&b[Q]){b[f(V[0],V[1],V[2])]=!1,b[K]=!1,b[fe]=!1,b[Q]=!1;var oe=[V[0]/2,V[1]/2,k-1];k-1===S.min_zoom?F.push(oe):(U[f(V[0]/2,V[1]/2,k-1)]=!0,j.push(oe))}}}for(z=0;z<T.length;z++)V=T[z],b[f(V[0],V[1],V[2])]&&F.push(V);b=U,T=j}return F}function i(b,T,S,F){for(var k=[],U=0;U<S.length;U++){var j=[];s(b,S[U],F,j);for(var z=0,V=j.length,K=V-1;z<V;K=z++){var fe=(z+1)%V,Q=j[z][1];(Q>j[K][1]||Q>j[fe][1])&&(Q<j[K][1]||Q<j[fe][1])&&Q!==j[fe][1]&&k.push(j[z])}}for(k.sort(o),U=0;U<k.length;U+=2){Q=k[U][1];for(var oe=k[U][0]+1;oe<k[U+1][0];oe++){var Te=f(oe,Q,F);b[Te]||T.push([oe,Q,F])}}}function o(b,T){return b[1]-T[1]||b[0]-T[0]}function s(b,T,S,F){for(var k,U,j=0;j<T.length-1;j++){var z=r.pointToTileFraction(T[j][0],T[j][1],S),V=r.pointToTileFraction(T[j+1][0],T[j+1][1],S),K=z[0],fe=z[1],Q=V[0],oe=V[1],Te=Q-K,ze=oe-fe;if(!(ze===0&&Te===0)){var Ae=Te>0?1:-1,_e=ze>0?1:-1,pe=Math.floor(K),X=Math.floor(fe),ne=Te===0?1/0:Math.abs(((Te>0?1:0)+pe-K)/Te),Be=ze===0?1/0:Math.abs(((ze>0?1:0)+X-fe)/ze),Ze=Math.abs(Ae/Te),Ce=Math.abs(_e/ze);for((pe!==k||X!==U)&&(b[f(pe,X,S)]=!0,F&&X!==U&&F.push([pe,X]),k=pe,U=X);ne<1||Be<1;)ne<Be?(ne+=Ze,pe+=Ae):(Be+=Ce,X+=_e),b[f(pe,X,S)]=!0,F&&X!==U&&F.push([pe,X]),k=pe,U=X}}F&&X===F[0][1]&&F.pop()}function c(b,T){for(var S=Object.keys(b),F=0;F<S.length;F++)T.push(g(+S[F]))}function f(b,T,S){var F=2*(1<<S);return(F*T+b)*32+S}function g(b){var T=b%32,S=2*(1<<T),F=(b-T)/32,k=F%S,U=(F-k)/S%S;return[k,U,T]}return vp}n0e();const RL=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],FL=[0n,1n,2n,4n,8n,16n];function i0e(r){return BigInt(`0x${r}`)}function nx(r){return r.toString(16)}function s0e(r){if(r.z<0||r.z>26)throw new Error("Wrong zoom");const e=BigInt(r.z);let t=BigInt(r.x)<<32n-e,n=BigInt(r.y)<<32n-e;for(let o=0;o<5;o++){const s=FL[5-o],c=RL[4-o];t=(t|t<<s)&c,n=(n|n<<s)&c}return 0x4000000000000000n|1n<<59n|e<<52n|(t|n<<1n)>>12n|0xfffffffffffffn>>e*2n}function DL(r){const e=r>>59n&7n,t=r>>57n&3n,n=r>>52n&0x1fn,i=(r&0xfffffffffffffn)<<12n;if(e!==1n&&t!==0n)throw new Error("Wrong mode");let o=i,s=i>>1n;for(let c=0;c<6;c++){const f=FL[c],g=RL[c];o=(o|o>>f)&g,s=(s|s>>f)&g}return o=o>>32n-n,s=s>>32n-n,{z:Number(n),x:Number(o),y:Number(s)}}function fC(r){return r>>52n&0x1fn}function OL(r){const e=fC(r)-1n;return r&~(0x1fn<<52n)|e<<52n|0xfffffffffffffn>>e*2n}function o0e(r,e,t,n=[],i,o){var f;if(!r.content)return!1;r.userData||(r.userData={});const s=(f=e.get(t))==null?void 0:f[0];if(s){if(n.every(g=>g.name in s))return!1;e.clear()}const c={};for(const g of r.content){let b=g.id;const T=typeof i=="function"?i(g,{}):i;for(let j=0;j<t-1;j++)b=OL(b);const S=Number(b);if(!(S in c)){c[S]={id:b,count:0,position:[0,0]};for(const{name:j,aggregation:z}of n)z==="any"?c[S][j]=g.properties[j]:c[S][j]=0}const F=c[S].count;c[S].count+=typeof o=="function"?o(g,{}):o;const k=c[S].count,U=k-F;c[S].position[0]=(F*c[S].position[0]+U*T[0])/k,c[S].position[1]=(F*c[S].position[1]+U*T[1])/k;for(const{name:j,aggregation:z}of n){const V=c[S][j],K=g.properties[j];z==="average"?c[S][j]=(F*V+U*K)/k:z==="count"||z==="sum"?c[S][j]=V+K:z==="max"?c[S][j]=Math.max(V,K):z==="min"&&(c[S][j]=Math.min(V,K))}}return e.set(t,Object.values(c)),!0}function a0e(r){const e=[],t=["any","average","count","min","max","sum"];for(const n of Object.keys(r.content[0].properties)){let i=n.split("_").pop().toLowerCase();t.includes(i)||(Ur.warn(`No valid aggregation present in ${n} property`)(),i="any"),e.push({name:n,aggregation:i})}return e}function c0e(r,e){const t={};for(const{name:n,aggregation:i}of e)if(t[n]={min:1/0,max:-1/0},i!=="any")for(const o of r)t[n].min=Math.min(t[n].min,o[n]),t[n].max=Math.max(t[n].max,o[n]);return t}const Jp=new Uint16Array,BP={positions:{value:new Float32Array,size:2},properties:[],numericProps:{},featureIds:{value:Jp,size:1},globalFeatureIds:{value:Jp,size:1}};function l0e(r){const e=new Float32Array(r.length*2),t=new Uint16Array(r.length);for(let n=0;n<r.length;n++)e.set(r[n].position,2*n),t[n]=n;return{shape:"binary-feature-collection",points:{type:"Point",positions:{value:e,size:2},properties:r,numericProps:{},featureIds:{value:t,size:1},globalFeatureIds:{value:t,size:1}},lines:{type:"LineString",pathIndices:{value:Jp,size:1},...BP},polygons:{type:"Polygon",polygonIndices:{value:Jp,size:1},primitivePolygonIndices:{value:Jp,size:1},...BP}}}const TA=512;class hC extends hy{getTileIndices(e){return super.getTileIndices(e).map(s0e).map(t=>({q:t,i:nx(t)}))}getTileId({q:e,i:t}){return t||nx(e)}getTileMetadata({q:e}){return super.getTileMetadata(DL(e))}getTileZoom({q:e}){return Number(fC(e))}getParentIndex({q:e}){return{q:OL(e)}}}const SP=512;function LL(r){const{x:e,y:t,z:n}=DL(r),i=SP/(1<<n);return[e*i,SP-t*i,i]}function u0e(r,e){const[t,n,i]=LL(r);return[[t,n],[t+e*i,n-e*i]]}function NL(r,e=1){const[t,n]=u0e(r,e),[i,o]=Zc(t),[s,c]=Zc(n);return[s,o,s,c,i,c,i,o,s,o]}const nm=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),IP=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);IP&&parseFloat(IP[1]);function f0e(r){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,r)}function h0e(...r){return d0e(r)}function d0e(r){const e=r.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),t=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(t);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function A0e(r){const e=[];for await(const t of r)e.push(t);return h0e(...e)}function p0e(r){return r&&typeof r=="object"&&r.isBuffer}function im(r){if(p0e(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function sm(r){return e=>new Promise((t,n)=>r(e,(i,o)=>i?n(i):t(o)))}class g0e{constructor(e){this.compressBatches=this.compressBatches.bind(this),this.decompressBatches=this.decompressBatches.bind(this)}async preload(e={}){f0e(e)}async compress(e){return await this.preload(),this.compressSync(e)}async decompress(e,t){return await this.preload(),this.decompressSync(e,t)}compressSync(e){throw new Error(`${this.name}: sync compression not supported`)}decompressSync(e,t){throw new Error(`${this.name}: sync decompression not supported`)}async*compressBatches(e){const t=await this.concatenate(e);yield this.compress(t)}async*decompressBatches(e){const t=await this.concatenate(e);yield this.decompress(t)}concatenate(e){return A0e(e)}improveError(e){return e.message.includes(this.name)||(e.message=`${this.name} ${e.message}`),e}}class m0e extends g0e{constructor(t={}){super(t);J(this,"name","deflate");J(this,"extensions",[]);J(this,"contentEncodings",["deflate"]);J(this,"isSupported",!0);J(this,"options");J(this,"_chunks",[]);this.options=t}async compress(t){var n,i;if(!nm&&((n=this.options.deflate)!=null&&n.useZlib)){const o=(i=this.options.deflate)!=null&&i.gzip?await sm(vu.gzip)(t):await sm(vu.deflate)(t);return im(o)}return this.compressSync(t)}async decompress(t){var n,i;if(!nm&&((n=this.options.deflate)!=null&&n.useZlib)){const o=(i=this.options.deflate)!=null&&i.gzip?await sm(vu.gunzip)(t):await sm(vu.inflate)(t);return im(o)}return this.decompressSync(t)}compressSync(t){var s,c,f,g;if(!nm&&((s=this.options.deflate)!=null&&s.useZlib)){const b=(c=this.options.deflate)!=null&&c.gzip?vu.gzipSync(t):vu.deflateSync(t);return im(b)}const n=((f=this.options)==null?void 0:f.deflate)||{},i=new Uint8Array(t);return((g=this.options)!=null&&g.raw?Ad.deflateRaw:Ad.deflate)(i,n).buffer}decompressSync(t){var s,c,f,g;if(!nm&&((s=this.options.deflate)!=null&&s.useZlib)){const b=(c=this.options.deflate)!=null&&c.gzip?vu.gunzipSync(t):vu.inflateSync(t);return im(b)}const n=((f=this.options)==null?void 0:f.deflate)||{},i=new Uint8Array(t);return((g=this.options)!=null&&g.raw?Ad.inflateRaw:Ad.inflate)(i,n).buffer}async*compressBatches(t){var o;const n=((o=this.options)==null?void 0:o.deflate)||{},i=new Ad.Deflate(n);yield*this.transformBatches(i,t)}async*decompressBatches(t){var o;const n=((o=this.options)==null?void 0:o.deflate)||{},i=new Ad.Inflate(n);yield*this.transformBatches(i,t)}async*transformBatches(t,n){t.onData=this._onData.bind(this),t.onEnd=this._onEnd.bind(this);for await(const s of n){const c=new Uint8Array(s);if(!t.push(c,!1))throw new Error(`${this._getError()}write`);yield*this._getChunks()}const i=new Uint8Array(0);t.push(i,!0),yield*this._getChunks()}_onData(t){this._chunks.push(t)}_onEnd(t){if(t!==0)throw new Error(this._getError(t)+this._chunks.length)}_getChunks(){const t=this._chunks;return this._chunks=[],t}_getError(t=0){const n={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};return`${this.name}: ${n[t]}`}}class _0e extends m0e{constructor(t){super({...t,deflate:{...t==null?void 0:t.gzip,gzip:!0}});J(this,"name","gzip");J(this,"extensions",["gz","gzip"]);J(this,"contentEncodings",["gzip","x-gzip"]);J(this,"isSupported",!0)}}function Sy(r,e,t,n){const i=e.type===2?e.readVarint()+e.pos:e.pos+1,o=e.buf.buffer.slice(e.pos,i);if((n==null?void 0:n.compression)==="gzip"){const c=new _0e().decompressSync(o);t.value=new r(c)}else t.value=new r(o);return e.pos=i,t.value}class dC{static read(e,t){return e.readFields(dC._readField,{key:"",value:null},t)}static _readField(e,t,n){e===1?t.key=n.readString():e===2&&(t.value=n.readString())}}class fh{static read(e,t){return e.readFields(fh._readField,{},t)}static _readField(e,t,n){if(e===1){const{key:i,value:o}=dC.read(n,n.readVarint()+n.pos);t[i]=o}}}class Ig{static read(e,t){const{value:n,size:i}=e.readFields(Ig._readField,{value:[],size:0},t);return{value:n,size:i}}static _readField(e,t,n){e===1?Sy(Float64Array,n,t):e===2&&(t.size=n.readVarint(!0))}}class xa{static read(e,t){const{value:n,size:i}=e.readFields(xa._readField,{value:[],size:0},t);return{value:new Uint32Array(n),size:i}}static _readField(e,t,n){e===1?n.readPackedVarint(t.value):e===2&&(t.size=n.readVarint(!0))}}class Mg{static read(e,t){return e.readFields(Mg._readField,{id:0},t)}static _readField(e,t,n){e===1&&(t.id=n.readVarint())}}class AC{static read(e,t){return e.readFields(AC._readField,{value:[]},t)}static _readField(e,t,n){e===1&&Sy(Float64Array,n,t)}}class hh{static read(e,t){return e.readFields(hh._readField,{key:"",value:null},t)}static _readField(e,t,n){e===1?t.key=n.readString():e===2&&(t.value=AC.read(n,n.readVarint()+n.pos))}}class pC{static read(e,t){return e.readFields(pC._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},t)}static _readField(e,t,n){if(e===1)t.positions=Ig.read(n,n.readVarint()+n.pos);else if(e===2)t.globalFeatureIds=xa.read(n,n.readVarint()+n.pos);else if(e===3)t.featureIds=xa.read(n,n.readVarint()+n.pos);else if(e===4)t.properties.push(fh.read(n,n.readVarint()+n.pos));else if(e===5){const i=hh.read(n,n.readVarint()+n.pos);t.numericProps[i.key]=i.value}else e===6&&t.fields.push(Mg.read(n,n.readVarint()+n.pos))}}class gC{static read(e,t){return e.readFields(gC._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},t)}static _readField(e,t,n){if(e===1)t.positions=Ig.read(n,n.readVarint()+n.pos);else if(e===2)t.pathIndices=xa.read(n,n.readVarint()+n.pos);else if(e===3)t.globalFeatureIds=xa.read(n,n.readVarint()+n.pos);else if(e===4)t.featureIds=xa.read(n,n.readVarint()+n.pos);else if(e===5)t.properties.push(fh.read(n,n.readVarint()+n.pos));else if(e===6){const i=hh.read(n,n.readVarint()+n.pos);t.numericProps[i.key]=i.value}else e===7&&t.fields.push(Mg.read(n,n.readVarint()+n.pos))}}class mC{static read(e,t){return e.readFields(mC._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},t)}static _readField(e,t,n){if(e===1)t.positions=Ig.read(n,n.readVarint()+n.pos);else if(e===2)t.polygonIndices=xa.read(n,n.readVarint()+n.pos);else if(e===3)t.globalFeatureIds=xa.read(n,n.readVarint()+n.pos);else if(e===4)t.featureIds=xa.read(n,n.readVarint()+n.pos);else if(e===5)t.primitivePolygonIndices=xa.read(n,n.readVarint()+n.pos);else if(e===6)t.triangles=xa.read(n,n.readVarint()+n.pos);else if(e===7)t.properties.push(fh.read(n,n.readVarint()+n.pos));else if(e===8){const i=hh.read(n,n.readVarint()+n.pos);t.numericProps[i.key]=i.value}else e===9&&t.fields.push(Mg.read(n,n.readVarint()+n.pos))}}let y0e=class kL{static read(e,t){return e.readFields(kL._readField,{points:null,lines:null,polygons:null},t)}static _readField(e,t,n){e===1?t.points=pC.read(n,n.readVarint()+n.pos):e===2?t.lines=gC.read(n,n.readVarint()+n.pos):e===3&&(t.polygons=mC.read(n,n.readVarint()+n.pos))}};class _C{static read(e,t){return e.readFields(_C._readField,{value:[]},t)}static _readField(e,t,n){e===1&&Sy(BigUint64Array,n,t)}}class yC{static read(e,t){return e.readFields(yC._readField,{indices:null,properties:[],numericProps:{}},t)}static _readField(e,t,n){if(e===1)t.indices=_C.read(n,n.readVarint()+n.pos);else if(e===2)t.properties.push(fh.read(n,n.readVarint()+n.pos));else if(e===3){const i=hh.read(n,n.readVarint()+n.pos);t.numericProps[i.key]=i.value}}}let v0e=class UL{static read(e,t){return e.readFields(UL._readField,{scheme:0,cells:null},t)}static _readField(e,t,n){e===1?t.scheme=n.readVarint():e===2&&(t.cells=yC.read(n,n.readVarint()+n.pos))}};function Iy(r,e){const t=new Oge(r);return e.read(t)}function Qf(r,e){Ur.assert(r,e)}function b0e(r,e){const{properties:t,numericProps:n}=r;return new Proxy(t[e]||{},{get(i,o){return o in n?n[o].value[e]:i[o]},has(i,o){return o in n||o in i},ownKeys(i){return[...Object.keys(n),...Reflect.ownKeys(i)]},getOwnPropertyDescriptor(i,o){return{enumerable:!0,configurable:!0}}})}function My(r,e){return`https://unpkg.com/@deck.gl/carto@${e}/dist/${r}-worker.js`}function x0e(r){const{cells:e,scheme:t}=r,n=e.indices.value.length,i=[];for(let o=0;o<n;o++){const s=t==="h3"?nx(e.indices.value[o]):e.indices.value[o],c={...e.properties[o]};for(const f of Object.keys(e.numericProps))c[f]=e.numericProps[f].value[o];i.push({id:s,properties:c})}return i}const zL="9.1.2",VL="cartoSpatialTile",w0e={cartoSpatialTile:{scheme:"quadbin",workerUrl:My(VL,zL)}},HL={name:"CARTO Spatial Tile",version:zL,id:VL,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(r,e)=>MP(r,e),parseSync:MP,worker:!0,options:w0e};function MP(r,e){var s;if(!r)return null;const t=Iy(r,v0e),{cells:n}=t,i=(s=e==null?void 0:e.cartoSpatialTile)==null?void 0:s.scheme;return x0e({cells:n,scheme:i})}function Pg(r,e){var t,n,i;(n=(t=r==null?void 0:r.fetch)==null?void 0:t.headers)!=null&&n.Authorization||(r.fetch={...r.fetch,headers:{...(i=r.fetch)==null?void 0:i.headers,Authorization:`Bearer ${e}`}})}function C0e(r,e){const t={};for(const{geoid:n,...i}of e.properties)n in t?Ur.warn("Duplicate geoid key in boundary mapping, using first occurance")():t[n]=i;for(const n of["points","lines","polygons"]){const i=r[n];if(i.positions.value.length===0)continue;i.properties=i.properties.map(({geoid:g})=>t[g]);const{positions:o,globalFeatureIds:s}=i;let c=null;n==="lines"&&(c=i.pathIndices.value),n==="polygons"&&(c=i.polygonIndices.value);const f=o.value.length/o.size;for(const g in e.numericProps){const b=e.numericProps[g].value,T=b.constructor,S=new T(f);if(i.numericProps[g]={value:S,size:1},c)for(let F=0;F<c.length-1;F++){const k=c[F],U=c[F+1],j=s.value[k];S.fill(b[j],k,U)}else for(let F=0;F<f;F++){const k=s.value[F];S[F]=b[k]}}}return r}const eh={type:"object",value:null,validate:(r,e)=>e.optional&&r===null||typeof r=="object"&&Array.isArray(r.tiles)&&r.tiles.every(t=>typeof t=="string"),equal:(r,e)=>io(r,e,2),async:!0};Ag([HL]);const jL={data:eh,clusterLevel:{type:"number",value:5,min:1},getPosition:{type:"accessor",value:({id:r})=>NL(r,.5).slice(2,4)},getWeight:{type:"accessor",value:1},refinementStrategy:"no-overlap",tileSize:TA};class vC extends Xl{initializeState(){super.initializeState(),this.state.aggregationCache=new WeakMap}renderLayers(){var S;const e=(S=this.state.tileset)==null?void 0:S.tiles.filter(F=>F.isLoaded&&F.content&&this.state.tileset.isTileVisible(F));if(!(e!=null&&e.length))return null;e.sort((F,k)=>k.zoom-F.zoom);const{zoom:t}=this.context.viewport,{clusterLevel:n,getPosition:i,getWeight:o}=this.props,{aggregationCache:s}=this.state,c=a0e(e[0]),f=[];let g=!1;for(const F of e){const k=Math.round(t-F.zoom),U=Math.round(n)-k;let j=s.get(F.content);j||(j=new Map,s.set(F.content,j));const z=o0e(F,j,U,c,i,o);g||(g=z),f.push(...j.get(U))}f.sort((F,k)=>Number(k.count-F.count));const b=f==null?void 0:f.map(F=>F.id);if(g||(g=!io(b,this.state.clusterIds,1)),this.setState({clusterIds:b}),g){const F=c0e(f,c),k=l0e(f);k.points.attributes={stats:F},this.setState({data:k})}const T={...this.props,id:"clusters",data:this.state.data,dataComparator:(F,k)=>{var z,V,K,fe;const U=(V=(z=F==null?void 0:F.points)==null?void 0:z.properties)==null?void 0:V.map(Q=>Q.id),j=(fe=(K=k==null?void 0:k.points)==null?void 0:K.properties)==null?void 0:fe.map(Q=>Q.id);return io(U,j,1)}};return new Wl(this.getSubLayerProps(T))}getPickingInfo(e){const t=e.info;if(t.index!==-1){const{data:n}=e.sourceLayer.props;t.object=rx(n,{globalFeatureId:t.index})}return t}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}filterSubLayer(){return!0}}vC.layerName="ClusterGeoJsonLayer";vC.defaultProps=jL;class bC extends gs{getLoadOptions(){const e=super.getLoadOptions()||{},t=this.props.data;return Pg(e,t.accessToken),e.cartoSpatialTile={...e.cartoSpatialTile,scheme:"quadbin"},e}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:t,maxresolution:n}=e;return[new vC(this.props,{id:`cluster-geojson-layer-${this.props.id}`,data:t,TilesetClass:hC,maxZoom:n,loadOptions:this.getLoadOptions()})]}}bC.layerName="ClusterTileLayer";bC.defaultProps=jL;const E0e=85.051128;function T0e({west:r,north:e,east:t,south:n},i){const c=[[e,t],[n,t],[n,r],[e,r]].map(b=>Dw(b[0],b[1],i)).map(b=>Math.max(...oae(b).map(T=>cae(T,Qd.rads)))*180/Math.PI),f=Math.max(...c),g=Math.min(180,f/Math.cos((e+n)/2*Math.PI/180));return{north:Math.min(e+f,E0e),east:t+g,south:Math.max(n-f,-85.051128),west:r-g}}function JL({west:r,north:e,east:t,south:n},i){const o=Math.abs(t-r);if(o>180){const c=Math.ceil(o/180);let f=[];for(let g=0;g<c;g++){const b=r+g*180,T=Math.min(b+179.9999999,t);f=f.concat(JL({west:b,north:e,east:T,south:n},i))}return[...new Set(f)]}return iae([[e,t],[n,t],[n,r],[e,r],[e,t]],i)}function B0e(r){const e=r4(r),t=e.map(f=>f[0]),n=e.map(f=>f[1]),i=Math.min(...n),o=Math.min(...t),s=Math.max(...n),c=Math.max(...t);return{west:i,south:o,east:s,north:c}}const S0e=2;function ix(r,e){const t=Math.log2(e/512),n=2/3*(r.zoom-t),i=Math.log(1/Math.cos(Math.PI*r.latitude/180));return Math.max(0,Math.floor(n+i-S0e))}class I0e extends hy{getTileIndices({viewport:e,minZoom:t,maxZoom:n}){if(e.latitude===void 0)return[];const[i,o,s,c]=e.getBounds(),{tileSize:f}=this.opts;let g=ix(e,f),b;if(typeof t=="number"&&Number.isFinite(t)&&g<t)return[];if(typeof n=="number"&&Number.isFinite(n)&&g>n){g=n;const T=Dw(e.latitude,e.longitude,n);b=nae(T,1)}else{const T=T0e({west:i,north:c,east:s,south:o},g);b=JL(T,g)}return b.map(T=>({i:T}))}getTileId({i:e}){return e}getTileMetadata({i:e}){return{bbox:B0e(e)}}getTileZoom({i:e}){return H2(e)}getParentIndex(e){const t=H2(e.i);return{i:rae(e.i,t-1)}}}const M0e={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class xC{static read(e,t){return e.readFields(xC._readField,{name:"",type:"",data:null},t)}static _readField(e,t,n){if(e===1)t.name=n.readString();else if(e===2)t.type=n.readString();else if(e===3){const i=M0e[t.type];if(!i)throw Error(`Invalid data type: ${t.type}`);t.data={};const{compression:o}=sx;Sy(i,n,t.data,{compression:o})}}}let sx=class WL{static read(e,t){return e.readFields(WL._readField,{blockSize:0,bands:[]},t)}static _readField(e,t,n){e===1?t.blockSize=n.readVarint():e===2&&t.bands.push(xC.read(n,n.readVarint()+n.pos))}};const XL="9.1.2",$L="cartoRasterTile",P0e={cartoRasterTile:{metadata:null,workerUrl:My($L,XL)}},R0e={name:"CARTO Raster Tile",version:XL,id:$L,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(r,e)=>PP(r,e),parseSync:PP,worker:!0,options:P0e};function PP(r,e){var c;const t=(c=e==null?void 0:e.cartoRasterTile)==null?void 0:c.metadata;if(!r||!t)return null;sx.compression=t.compression;const n=Iy(r,sx),{bands:i,blockSize:o}=n,s={};for(let f=0;f<i.length;f++){const{name:g,data:b}=i[f];s[g]=b}return{blockSize:o,cells:{numericProps:s,properties:[]}}}Ag([R0e,HL]);function F0e(r){return r!=null&&r!==""}const D0e={tileSize:TA};class Py extends Xl{_updateAutoHighlight(e){const{hoveredFeatureId:t}=this.state,n=e.object;let i=null;if(n&&(i=n.id),t!==i){let{highlightColor:o}=this.props;typeof o=="function"&&(o=o(e)),this.setState({highlightColor:o,hoveredFeatureId:i})}}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:t}=this.state,n=e.content;return!F0e(t)||!Array.isArray(n)||!this._featureInTile(e,t)?-1:n.findIndex(o=>o.id===t)}_featureInTile(e,t){const n=this.state.tileset,i=n.getTileZoom(e.index),o=e.index.q?"q":"i";let s={[o]:t},c=n.getTileZoom(s);for(;!(c<=i);)s=n.getParentIndex(s),c=n.getTileZoom(s);return s[o]===e.index[o]}}Py.layerName="SpatialIndexTileLayer";Py.defaultProps=D0e;const O0e=r=>{const{data:e}=r,{index:t}=r.tile;return!e||!e.length?null:new tl(r,{getHexagon:n=>n.id,centerHexagon:t,highPrecision:!0})},L0e={data:eh,tileSize:TA};class wC extends gs{initializeState(){tl._checkH3Lib()}getLoadOptions(){const e=super.getLoadOptions()||{},t=this.props.data;return Pg(e,t.accessToken),e.cartoSpatialTile={...e.cartoSpatialTile,scheme:"h3"},e}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:t}=e;let{minresolution:n,maxresolution:i}=e;this.props.minZoom&&(n=Math.max(n,ix({zoom:this.props.minZoom,latitude:0},this.props.tileSize))),this.props.maxZoom&&(i=Math.min(i,ix({zoom:this.props.maxZoom,latitude:0},this.props.tileSize)));const o=this.getSubLayerClass("spatial-index-tile",Py);return new o(this.props,{id:`h3-tile-layer-${this.props.id}`,data:t,TilesetClass:I0e,renderSubLayers:O0e,minZoom:n,maxZoom:i,loadOptions:this.getLoadOptions()})}}wC.layerName="H3TileLayer";wC.defaultProps=L0e;const N0e=`uniform heatmapUniforms {
  vec2 colorDomain;
  vec2 delta;
  float intensity;
  float opacity;
  float radiusPixels;
} heatmap;

uniform sampler2D colorTexture;

vec3 colorGradient(float value) {
  return texture(colorTexture, vec2(value, 0.5)).rgb;
}

const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
const float MAX_VAL = SHIFT.z * 255.0;
const float SCALE = MAX_VAL / 8.0;
vec4 pack(float value) {
  return vec4(mod(vec3(value, floor(value / SHIFT.yz)), 256.0), 255.0) / 255.0;
}
float unpack(vec3 color) {
  return 255.0 * dot(color, SHIFT);
}

vec4 heatmap_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {
  bool firstPass = (heatmap.delta.y < 0.5);
  float accumulator = 0.0;

  // Controls quality of heatmap, larger values increase quality at expense of performance
  float SUPPORT = clamp(heatmap.radiusPixels / 2.0, 8.0, 32.0);

  // Gaussian normalization parameters
  float sigma = SUPPORT / 3.0;
  float a = -0.5 / (sigma * sigma);
  float w0 = 0.3989422804014327 / sigma; // 1D normalization
  for (float t = -SUPPORT; t <= SUPPORT; t++) {
    vec2 percent = (t * heatmap.delta - 0.5) / SUPPORT;
    vec2 delta = percent * heatmap.radiusPixels / texSize;
    vec4 offsetColor = texture(source, texCoord + delta);

    // Unpack float
    float value = unpack(offsetColor.rgb);

    // Gaussian
    float weight = w0 * exp(a * t * t);
    
    accumulator += value * weight;
  }

  if (firstPass) {
    return pack(accumulator);
  }

  // Undo scaling to obtain normalized density
  float density = 10.0 * heatmap.intensity * accumulator / SCALE;
 
  // Domain also in normalized density units
  vec2 domain = heatmap.colorDomain;

  // Apply domain
  float f = (density - domain[0]) / (domain[1] - domain[0]);

  // sqrt/log scaling??
  // float f = (log(density) - log(domain[0] + 1.0)) / (log(domain[1] + 1.0) - log(domain[0] + 1.0));
  // f = sqrt(f);

  // Color map
  vec4 color = vec4(0.0);
  color.rgb = colorGradient(f);

  color.a = smoothstep(0.0, 0.1, f);
  color.a = pow(color.a, 1.0 / 2.2);
  color.a *= heatmap.opacity;

  return color;
}
`,k0e={name:"heatmap",uniformPropTypes:{colorDomain:{value:[0,1]},delta:{value:[0,1]},intensity:{value:1,min:.1,max:10},opacity:{value:1,min:0,max:1},radiusPixels:{value:20,min:0,softMax:100}},uniformTypes:{colorDomain:"vec2<f32>",delta:"vec2<f32>",intensity:"f32",opacity:"f32",radiusPixels:"f32"},getUniforms:r=>{if(!r)return{};const{colorDomain:e=[0,1],colorTexture:t,delta:n=[1,0],intensity:i=1,opacity:o=1,radiusPixels:s=20}=r;return{colorDomain:e,colorTexture:t,delta:n,intensity:i,opacity:o,radiusPixels:s}},fs:N0e,passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]},U0e={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function ox(r){for(;r.parent&&!r.applyPostProcess;)r=r.parent;return r}class KL extends cs{initializeState(){this.id=`draw-callback-${ox(this).props.id}`}_drawLayer(){ox(this).applyPostProcess()}}KL.layerName="DrawCallbackLayer";function qL(r){var e;return e=class extends r{draw(n){const{shaderModuleProps:i}=n,{picking:o}=i,s=ox(this);o.isActive||s.enableRTT(n),super.draw(n),o.isActive||s.disableRTT()}},e.layerName=`RTT-${r.layerName}`,e}function ZL(r,e){var t;return t=class extends r{initializeState(i){super.initializeState(i),this._createTextures(),this.internalState.postProcess=new WH(e,this.props),this.internalState.postProcess.setup(i)}updateState(i){super.updateState(i),this.internalState.postProcess.setProps(this.props)}renderLayers(){let i=super.renderLayers();return i?(i=Array.isArray(i)?i:[i],[...i,new KL]):null}_createTextures(){const{device:i}=this.context;this.internalState.renderBuffers=[0,1].map(o=>i.createFramebuffer({id:`layer-fbo-${o}`,colorAttachments:[i.createTexture(U0e)],depthStencilAttachment:"depth16unorm"}))}_resizeBuffers(i){const{shaderModuleProps:o}=i,{viewport:s}=this.context,{devicePixelRatio:c}=o.project,f=c*s.width,g=c*s.height;this.internalState.renderBuffers.forEach(b=>b.resize({width:f,height:g}))}enableRTT(i){this._resizeBuffers(i),this.internalState.originalRenderPass=this.context.renderPass;const[o]=this.internalState.renderBuffers;this.internalState.internalRenderPass=this.context.device.beginRenderPass({framebuffer:o,parameters:{viewport:[0,0,o.width,o.height]},clearColor:this.internalState.renderInProgress?!1:[0,0,0,0]}),this.internalState.renderInProgress=!0,this.context.renderPass=this.internalState.internalRenderPass}disableRTT(){this.internalState.internalRenderPass.end(),this.context.renderPass=this.internalState.originalRenderPass}applyPostProcess(){if(!this.internalState.renderInProgress)return;const[i,o]=this.internalState.renderBuffers,{framebuffer:s}=this.context.renderPass.props;this.internalState.postProcess.postRender({inputBuffer:i,swapBuffer:o,target:s}),this.internalState.renderInProgress=!1}_finalize(){this.internalState.renderBuffers.forEach(i=>{i.destroy()}),this.internalState.renderBuffers=null,this.internalState.postProcess.cleanup()}},t.layerName=`PostProcess${r.layerName}`,t}const z0e=`vec4 copy_filterColor_ext(vec4 color, vec2 texSize, vec2 texCoord) {
  return color;
}
`,G0e={name:"copy",fs:z0e,getUniforms:()=>({}),passes:[{filter:!0}]},V0e={getQuadbin:{type:"accessor",value:r=>r.quadbin}};class CC extends Qu{indexToBounds(){const{data:e,extruded:t,getQuadbin:n}=this.props,i=t?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>NL(n(o,s),i),updateTriggers:{getPolygon:i}}}}CC.layerName="QuadbinLayer";CC.defaultProps=V0e;const H0e=r=>{const{data:e}=r;if(!e||!e.length)return null;const t=typeof e[0].id=="bigint";return new CC(r,{getQuadbin:t?n=>n.id:n=>i0e(n.id)})},j0e={data:eh,tileSize:TA};class Ry extends gs{getLoadOptions(){const e=super.getLoadOptions()||{},t=this.props.data;return Pg(e,t.accessToken),e.cartoSpatialTile={...e.cartoSpatialTile,scheme:"quadbin"},e}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:t,maxresolution:n}=e,i=this.getSubLayerClass("spatial-index-tile",Py);return new i(this.props,{id:`quadbin-tile-layer-${this.props.id}`,data:t,TilesetClass:hC,renderSubLayers:H0e,maxZoom:n,loadOptions:this.getLoadOptions()})}}Ry.layerName="QuadbinTileLayer";Ry.defaultProps=j0e;const J0e=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],W0e={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function YL(r){const e=Number(fC(r));return Math.pow(4,e)}function X0e(r){const e=new Uint8Array(r.length*4);let t=0;for(let n=0;n<r.length;n++){const i=r[n];e[t++]=i[0],e[t++]=i[1],e[t++]=i[2],e[t++]=Number.isFinite(i[3])?i[3]:255}return e}const $0e=`uniform densityUniforms {
  float factor;
} density;
`,K0e={name:"density",vs:$0e,uniformTypes:{factor:"f32"}};class QL extends qL(Zu){getShaders(e){const t=super.getShaders(e);return t.inject={"vs:#main-end":`
      // Value from getWeight accessor
  float weight = elevations;

  // Keep "power" delivered to screen constant when tiles update
  // by outputting normalized density
  weight *= density.factor;

  // Pack float into 3 channels to pass to heatmap shader
  // SCALE value important, as we don't want to saturate
  // but also want enough definition to avoid banding
  const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
  const float MAX_VAL = SHIFT.z * 255.0;
  const float SCALE = MAX_VAL / 8.0;
  weight *= SCALE;
  weight = clamp(weight, 0.0, MAX_VAL);
  vColor = vec4(mod(vec3(weight, floor(weight / SHIFT.yz)), 256.0), 255.0) / 255.0;
`},t.modules=[...t.modules,K0e],t}draw(e){const t=this.props.data[0],n=this.props.elevationScale,i={factor:YL(t.id)/n};for(const o of this.state.models)o.shaderInputs.setProps({density:i});super.draw(e)}}QL.layerName="RTTSolidPolygonLayer";const q0e=ZL(Ry,k0e),Z0e={data:eh,getWeight:{type:"accessor",value:1},onMaxDensityChange:{type:"function",optional:!0,value:null},colorDomain:{type:"array",value:[0,1]},colorRange:J0e,intensity:{type:"number",value:1},radiusPixels:{type:"number",min:0,max:100,value:20}};class EC extends gs{initializeState(){this.state={isLoaded:!1,tiles:new Set,viewportChanged:!1}}shouldUpdateState({changeFlags:e}){const{viewportChanged:t}=e;return this.setState({viewportChanged:t}),e.somethingChanged}updateState(e){const{props:t,oldProps:n}=e;super.updateState(e),t.colorRange!==n.colorRange&&this._updateColorTexture(e)}renderLayers(){var K,fe,Q;const{data:e,getWeight:t,colorDomain:n,intensity:i,radiusPixels:o,_subLayerProps:s,updateTriggers:c,onMaxDensityChange:f,onViewportLoad:g,onTileLoad:b,onTileUnload:T,...S}=this.props,F={...s,cell:{...s==null?void 0:s.cell,_subLayerProps:{...(K=s==null?void 0:s.cell)==null?void 0:K._subLayerProps,fill:{...(Q=(fe=s==null?void 0:s.cell)==null?void 0:fe._subLayerProps)==null?void 0:Q.fill,type:QL}}}};let k=0,U=0;const j=[...this.state.tiles].filter(oe=>oe.isVisible&&oe.content);for(const oe of j){const Te=oe.content[0],ze=YL(Te.id);U=Math.max(oe.userData.maxWeight*ze,U),k=Math.max(oe.zoom,k)}const z=this.context.viewport.zoom-k;return U=U*Math.pow(2,z),typeof f=="function"&&f(U),new q0e(S,this.getSubLayerProps({id:"heatmap",data:e,getFillColor:0,getElevation:t,elevationScale:U,colorDomain:n,radiusPixels:o,intensity:i,_subLayerProps:F,refinementStrategy:"no-overlap",colorTexture:this.state.colorTexture,extruded:!1,stroked:!1,updateTriggers:{getElevation:c.getWeight},onViewportLoad:oe=>{this.setState({isLoaded:!0}),typeof g=="function"&&g(oe)},onTileLoad:oe=>{let Te=-1/0;if(typeof t!="function")Te=t;else if(oe.content)for(const ze of oe.content)Te=Math.max(t(ze,{}),Te);oe.userData={maxWeight:Te},this.state.tiles.add(oe),typeof b=="function"&&b(oe)},onTileUnload:oe=>{this.state.tiles.delete(oe),typeof T=="function"&&T(oe)},transitions:{elevationScale:{type:"spring",stiffness:.3,damping:.5}}}))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:n}=this.state;const i=X0e(t);n&&(n==null?void 0:n.width)===t.length?n.setSubImageData({data:i}):(n==null||n.destroy(),n=this.context.device.createTexture({...W0e,data:i,width:t.length,height:1})),this.setState({colorTexture:n})}}EC.layerName="HeatmapTileLayer";EC.defaultProps=Z0e;const[RP,FP,DP,OP]=[0,1,2,3];class e8 extends Eg{getShaders(){const e=super.getShaders();let t=e.vs;return t=t.replaceAll("textBackground.padding.","_padding."),t=t.replace("void main(void) {",`void main(void) {
  vec4 _padding = textBackground.padding + instancePixelOffsets.xyxy * vec4(1.0, 1.0, -1.0, -1.0);`),{...e,vs:t}}}e8.layerName="EnhancedTextBackgroundLayer";class t8 extends lh{filterSubLayer({layer:e,renderPass:t}){const n=e.id.includes("primary-background");return t==="collision"?n:!n}}t8.layerName="EnhancedTextLayer";const Y0e={...lh.defaultProps,getRadius:{type:"accessor",value:1},radiusScale:{type:"number",min:0,value:1}};class TC extends gs{calculatePixelOffset(e){const{getTextAnchor:t,getAlignmentBaseline:n,getRadius:i,getSecondaryText:o,radiusScale:s,secondarySizeScale:c,sizeScale:f}=this.props,g=t==="middle"?0:t==="start"?1:-1,b=n==="center"?0:n==="bottom"?1:-1,T=f/4,S=f*(1+1/4),F=.6*(1-b)*f;let k=e?F:0;t==="middle"&&n==="top"&&o&&(k-=F,k-=c,k+=f);const U=1+1/4;return typeof i=="function"?(j,z)=>{const V=(z?i(j,z):1)*s*U;return[g*(V+T),b*(V+S)+k]}:[g*(i*s*U+T),b*(i*s*U+S)+k]}calculateBackgroundPadding(){const{getTextAnchor:e,getAlignmentBaseline:t,sizeScale:n}=this.props,i=12*n,o=3*n,s=[0,0,0,0];return t==="top"?s[FP]=o:t==="bottom"?s[OP]=o:(s[FP]=.5*o,s[OP]=.5*o),e==="start"?s[RP]=i:e==="end"?s[DP]=i:(s[RP]=.5*i,s[DP]=.5*i),s}renderTextLayer(e,{updateTriggers:t={},...n}){const{data:i,characterSet:o,fontFamily:s,fontSettings:c,fontWeight:f,outlineColor:g,outlineWidth:b,sizeScale:T,radiusScale:S,getAlignmentBaseline:F,getColor:k,getPosition:U,getTextAnchor:j,updateTriggers:z}=this.props;return new t8(this.getSubLayerProps({id:e,data:i,characterSet:o,fontFamily:s,fontSettings:c,fontWeight:f,outlineColor:g,outlineWidth:b,sizeScale:T,getAlignmentBaseline:F,getColor:k,getPosition:U,getTextAnchor:j,updateTriggers:{...z,...t,getPixelOffset:[z.getRadius,z.getTextAnchor,z.getAlignmentBaseline,S,T]}}),{getSize:1,_subLayerProps:{background:{type:e8}}},n)}renderLayers(){const{getText:e,getSecondaryColor:t,getSecondaryText:n,secondaryOutlineColor:i,secondarySizeScale:o,updateTriggers:s}=this.props,c=this.calculatePixelOffset(!1),f=this.calculateBackgroundPadding();return[this.renderTextLayer(`${s.getText}-primary`,{backgroundPadding:f,getText:e,getPixelOffset:c,background:!0}),!!n&&this.renderTextLayer(`${s.getSecondaryText}-secondary`,{getText:n,getPixelOffset:this.calculatePixelOffset(!0),getAlignmentBaseline:"top",...t&&{getColor:t},...o&&{sizeScale:o},...i&&{outlineColor:i}})]}}TC.layerName="PointLabelLayer";TC.defaultProps=Y0e;const Q0e=`#version 300 es
#define SHADER_NAME raster-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
vec2 tileOrigin = column.offset.xy;
float scale = column.widthScale;
int yIndex = - (gl_InstanceID / BLOCK_WIDTH);
int xIndex = gl_InstanceID + (yIndex * BLOCK_WIDTH);
vec2 cellCenter = scale * vec2(float(xIndex) + 0.5, float(yIndex) - 0.5);
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float cellWidth = column.coverage * scale;
geometry.position = vec4(tileOrigin + cellCenter, 0.0, 1.0);
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
geometry.position.xyz -= project.commonOrigin;
}
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float halfOffset = project_pixel_size(column.widthScale) / cellWidth;
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
geometry.pickingColor = instancePickingColors;
vec2 base = positions.xy * scale * strokeOffsetRatio * column.coverage * shouldRender;
vec3 cell = vec3(base, project_size(elevation));
DECKGL_FILTER_SIZE(cell, geometry);
geometry.position.xyz += cell;
gl_Position = project_common_position_to_clipspace(geometry.position);
geometry.normal = project_normal(normals);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,eme={...Jl.defaultProps,extruded:!1,diskResolution:4,vertices:[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]};class r8 extends qL(Jl){getShaders(){const e=super.getShaders(),t=this.props.data,n=t.data.blockSize??Math.sqrt(t.length);return{...e,defines:{...e.defines,BLOCK_WIDTH:n},vs:Q0e}}initializeState(){this.getAttributeManager().addInstanced({instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:[255,255,255,255]}})}}r8.layerName="RasterColumnLayer";function tme(r,e){return r.data===e.data&&r.length===e.length}class BC extends gs{renderLayers(){const{data:e,getElevation:t,getFillColor:n,getLineColor:i,getLineWidth:o,tileIndex:s,updateTriggers:c}=this.props;if(!e||!s)return null;const f=e.blockSize??0,[g,b,T]=LL(s),S=[g,b],F=T/f,k=this.getSubLayerClass("column",r8),{highlightedObjectIndex:U,highlightColor:j}=this.state;return new k(this.props,this.getSubLayerProps({id:"cell",updateTriggers:c,getElevation:this.getSubLayerAccessor(t),getFillColor:this.getSubLayerAccessor(n),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(o)}),{data:{data:e,length:f*f},dataComparator:tme,offset:S,lineWidthScale:F,highlightedObjectIndex:U,highlightColor:j,parameters:{blendColorSrcFactor:"one",blendAlphaSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaDstFactor:"zero",blendColorOperation:"add",blendAlphaOperation:"add"}})}getSubLayerAccessor(e){return typeof e!="function"?super.getSubLayerAccessor(e):(t,n)=>{const{data:i,index:o}=n,s=i.data,c=b0e(s.cells,o);return e({properties:c},n)}}getPickingInfo(e){const t=super.getPickingInfo(e);return t.index!==-1&&(t.object=this.getSubLayerAccessor(n=>n)(void 0,{data:this.props,index:t.index})),t}_updateAutoHighlight(e){const{highlightedObjectIndex:t}=this.state;let n=-1;if(e.index!==-1&&(n=e.index),t!==n){let{highlightColor:i}=this.props;typeof i=="function"&&(i=i(e)),this.setState({highlightColor:i,highlightedObjectIndex:n})}}}BC.layerName="RasterLayer";BC.defaultProps=eme;const rme=r=>{var t,n;const e=(n=(t=r.tile)==null?void 0:t.index)==null?void 0:n.q;return e?new BC(r,{tileIndex:e}):null},nme={data:eh,refinementStrategy:"no-overlap",tileSize:TA};class ime extends ZL(Xl,G0e){filterSubLayer(e){const{tile:t}=e.layer.props;return t?super.filterSubLayer(e):!0}}class SC extends gs{getLoadOptions(){const e=super.getLoadOptions()||{},t=this.props.data;return Pg(e,t.accessToken),e}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:t,minzoom:n,maxzoom:i,raster_metadata:o}=e,s=this.getSubLayerClass("tile",ime);return new s(this.props,{id:`raster-tile-layer-${this.props.id}`,data:t,TilesetClass:hC,renderSubLayers:rme,minZoom:n,maxZoom:i,loadOptions:{cartoRasterTile:{metadata:o},...this.getLoadOptions()}})}}SC.layerName="RasterTileLayer";SC.defaultProps=nme;class IC{static read(e,t){return e.readFields(IC._readField,{properties:[],numericProps:{}},t)}static _readField(e,t,n){if(e===1)t.properties.push(fh.read(n,n.readVarint()+n.pos));else if(e===2){const i=hh.read(n,n.readVarint()+n.pos);t.numericProps[i.key]=i.value}}}const n8="9.1.2",i8="cartoPropertiesTile",sme={cartoPropertiesTile:{workerUrl:My(i8,n8)}},ome={name:"CARTO Properties Tile",version:n8,id:i8,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!0,parse:async(r,e)=>LP(r),parseSync:LP,options:sme};function LP(r,e){return r?Iy(r,IC):null}const s8="9.1.2",o8="cartoVectorTile",ame={cartoVectorTile:{workerUrl:My(o8,s8)}},cme={name:"CARTO Vector Tile",version:s8,id:o8,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(r,e)=>NP(r),parseSync:NP,worker:!0,options:ame};function lme(r,e,{startPosition:t,endPosition:n,indices:i}){const o=r.positions.size,s=t*o,c=n*o,f=r.positions.value.subarray(s,c),g=i.slice(1).map(T=>T-t),b=C6(f,g,o);for(let T=0,S=b.length;T<S;++T)e.push(t+b[T])}function ume(r){const{polygonIndices:e,primitivePolygonIndices:t}=r,n=[];let i=0;for(let o=0;o<e.value.length-1;o++){const s=e.value[o],c=e.value[o+1],f=t.value.indexOf(c),g=t.value.subarray(i,f);i=f,lme(r,n,{startPosition:s,endPosition:c,indices:g})}r.triangles={value:new Uint32Array(n),size:1}}function NP(r,e){if(!r)return null;const t=Iy(r,y0e);return t.polygons&&!t.polygons.triangles&&ume(t.polygons),t}Ag([ome,cme]);const fme={...EA.defaultProps,data:eh,dataComparator:eh.equal,tileSize:TA};class MC extends EA{constructor(...e){super(...e)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(e){const{props:t}=e;if(t.data){super.updateState(e);const i=new URL(t.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:i})}}getLoadOptions(){const e=super.getLoadOptions()||{},t=this.props.data;return Pg(e,t.accessToken),e.gis={format:"binary"},e}async getTileData(e){const t=this.props.data,{tiles:n,properties_tiles:i}=t,o=Zf(n,e);if(!o)return Promise.reject("Invalid URL");const s=this.getLoadOptions(),{fetch:c}=this.props,{signal:f}=e,g=c(o,{propName:"data",layer:this,loadOptions:s,signal:f});if(!i)return await g;const b=Zf(i,e);if(!b)return Promise.reject("Invalid properties URL");const T=c(b,{propName:"data",layer:this,loadOptions:s,signal:f}),[S,F]=await Promise.all([g,T]);return S?F?C0e(S,F):S:null}renderSubLayers(e){if(e.data===null)return null;if(this.state.mvt)return super.renderSubLayers(e);const t=e.tile.bbox,{west:n,south:i,east:o,north:s}=t,c=[new Ty,...e.extensions||[]],f={clipBounds:[n,i,o,s]},g=S=>{var F,k,U;return{[S]:{...f,...(F=e==null?void 0:e._subLayerProps)==null?void 0:F[S],extensions:[...c,...((U=(k=e==null?void 0:e._subLayerProps)==null?void 0:k[S])==null?void 0:U.extensions)||[]]}}},b={...e,autoHighlight:!1,_subLayerProps:{...e._subLayerProps,...g("polygons-fill"),...g("polygons-stroke"),...g("linestrings")}};return new Wl(b)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}MC.layerName="VectorTileLayer";MC.defaultProps=fme;var En={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},hme={2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},dme={2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},Ame={2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},pme={2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},gme={2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},mme={2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},_me={2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},yme={2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},vme={2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},bme={2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},xme={2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},wme={2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},Cme={2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},Eme={2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},Tme={2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},Bme={2:["#f9ddda","#573b88"],3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},Sme={2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},Ime={2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},Mme={2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},Pme={2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},Rme={2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},Fme={2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},Dme={2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Ome={2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Lme={2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},Nme={2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},kme={2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},Ume={2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},zme={2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},Gme={2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},Vme={2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},Hme={2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},jme={2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},Jme={2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]},Wme={...En.BuGn,tags:["quantitative"]},Xme={...En.BuPu,tags:["quantitative"]},$me={...En.GnBu,tags:["quantitative"]},Kme={...En.OrRd,tags:["quantitative"]},qme={...En.PuBu,tags:["quantitative"]},Zme={...En.PuBuGn,tags:["quantitative"]},Yme={...En.PuRd,tags:["quantitative"]},Qme={...En.RdPu,tags:["quantitative"]},e_e={...En.YlGn,tags:["quantitative"]},t_e={...En.YlGnBu,tags:["quantitative"]},r_e={...En.YlOrBr,tags:["quantitative"]},n_e={...En.YlOrRd,tags:["quantitative"]},i_e={...En.Accent,tags:["qualitative"]},s_e={...En.Dark2,tags:["qualitative"]},o_e={...En.Paired,tags:["qualitative"]},a_e={...En.Pastel1,tags:["qualitative"]},c_e={...En.Pastel2,tags:["qualitative"]},l_e={...En.Set1,tags:["qualitative"]},u_e={...En.Set2,tags:["qualitative"]},f_e={...En.Set3,tags:["qualitative"]},h_e={...En.Blues,tags:["quantitative"]},d_e={...En.Greens,tags:["quantitative"]},A_e={...En.Greys,tags:["quantitative"]},p_e={...En.Oranges,tags:["quantitative"]},g_e={...En.Purples,tags:["quantitative"]},m_e={...En.Reds,tags:["quantitative"]},__e={...En.BrBG,tags:["diverging"]},y_e={...En.PiYG,tags:["diverging"]},v_e={...En.PRGn,tags:["diverging"]},b_e={...En.PuOr,tags:["diverging"]},x_e={...En.RdBu,tags:["diverging"]},w_e={...En.RdGy,tags:["diverging"]},C_e={...En.RdYlBu,tags:["diverging"]},E_e={...En.RdYlGn,tags:["diverging"]},T_e={...En.Spectral,tags:["diverging"]};const B_e=Object.freeze(Object.defineProperty({__proto__:null,Antique:zme,ArmyRose:Fme,BluGrn:yme,BluYl:wme,Bold:Gme,BrwnYl:Rme,Burg:hme,BurgYl:dme,DarkMint:vme,Earth:Ume,Emrld:bme,Fall:Dme,Geyser:Ome,Magenta:Ime,Mint:_me,OrYel:pme,Pastel:Vme,Peach:gme,PinkYl:mme,Prism:Hme,Purp:Tme,PurpOr:Bme,RedOr:Ame,Safe:jme,Sunset:Sme,SunsetDark:Mme,Teal:Cme,TealGrn:Eme,TealRose:Nme,Temps:Lme,Tropic:kme,Vivid:Jme,ag_GrnYl:xme,ag_Sunset:Pme,cb_Accent:i_e,cb_Blues:h_e,cb_BrBG:__e,cb_BuGn:Wme,cb_BuPu:Xme,cb_Dark2:s_e,cb_GnBu:$me,cb_Greens:d_e,cb_Greys:A_e,cb_OrRd:Kme,cb_Oranges:p_e,cb_PRGn:v_e,cb_Paired:o_e,cb_Pastel1:a_e,cb_Pastel2:c_e,cb_PiYG:y_e,cb_PuBu:qme,cb_PuBuGn:Zme,cb_PuOr:b_e,cb_PuRd:Yme,cb_Purples:g_e,cb_RdBu:x_e,cb_RdGy:w_e,cb_RdPu:Qme,cb_RdYlBu:C_e,cb_RdYlGn:E_e,cb_Reds:m_e,cb_Set1:l_e,cb_Set2:u_e,cb_Set3:f_e,cb_Spectral:T_e,cb_YlGn:e_e,cb_YlGnBu:t_e,cb_YlOrBr:r_e,cb_YlOrRd:n_e},Symbol.toStringTag,{value:"Module"})),PC="PurpOr",RC=[204,204,204],S_e=[119,119,119];function FC(r,e){const t=B_e[r];let n=e;Qf(t,`Palette "${r}" not found. Expected a CARTOColors string`);const i=Object.keys(t).filter(f=>f!=="tags").map(Number),o=Math.max(...i),s=Math.min(...i);!Number.isInteger(e)||e>o?n=o:e<s&&(n=s);let c=t[n];return t.tags&&t.tags.includes("qualitative")&&(c=c.slice(0,-1)),c.map(f=>I_e(f))}function I_e(r){let e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(r);return e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),255]:(e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(r),e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),parseInt(e[4]+e[4],16)]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r),e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r),Qf(e,`Hexadecimal color "${r}" was not parsed correctly`),[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),parseInt(e[4],16)])))}const M_e=Object.freeze(["function","string"]);function DC(r,e,t){var n;return Qf(typeof e=="object",'Expected "data" to be an object'),Qf(M_e.includes(typeof r),'Expected "attr" to be a function or string'),typeof r=="function"?r(e,t):(n=e==null?void 0:e.properties)==null?void 0:n[r]}function P_e({attr:r,domain:e,colors:t=PC,nullColor:n=RC}){Qf(Array.isArray(e),'Expected "domain" to be an array of numbers');const i=typeof t=="string"?FC(t,e.length+1):t,o=_k().domain(e).range(i);return(s,c)=>{const f=DC(r,s,c);return typeof f=="number"&&Number.isFinite(f)?o(f):n}}function R_e({attr:r,domain:e,colors:t=PC,nullColor:n=RC,othersColor:i=S_e}){Qf(Array.isArray(e),'Expected "domain" to be an array of numbers or strings');const o={},s=typeof t=="string"?FC(t,e.length):t;for(const[c,f]of e.entries())o[f]=s[c];return(c,f)=>{const g=DC(r,c,f);return typeof g=="number"&&Number.isFinite(g)||typeof g=="string"?o[g]||i:n}}function F_e({attr:r,domain:e,colors:t=PC,nullColor:n=RC}){Qf(Array.isArray(e),'Expected "domain" to be an array of numbers');const i=typeof t=="string"?FC(t,e.length):t,o=yk().domain(e).range(i);return(s,c)=>{const f=DC(r,s,c);return typeof f=="number"&&Number.isFinite(f)?o(f):n}}const Xi={SUM:1,MEAN:2,MIN:3,MAX:4};function a8(r,e){return r+e}function D_e(r,e){return e>r?e:r}function O_e(r,e){return e<r?e:r}function L_e(r,e){if(Number.isFinite(e))return r.length?e:null;const t=r.map(e).filter(Number.isFinite);return t.length?t.reduce(a8,0)/t.length:null}function N_e(r,e){if(Number.isFinite(e))return r.length?r.length*e:null;const t=r.map(e).filter(Number.isFinite);return t.length?t.reduce(a8,0):null}function k_e(r,e){if(Number.isFinite(e))return r.length?e:null;const t=r.map(e).filter(Number.isFinite);return t.length?t.reduce(D_e,-1/0):null}function U_e(r,e){if(Number.isFinite(e))return r.length?e:null;const t=r.map(e).filter(Number.isFinite);return t.length?t.reduce(O_e,1/0):null}function OC(r,e,t){const n=Xi[r]||Xi.SUM;switch(e=z_e(e,t),n){case Xi.MIN:return i=>U_e(i,e);case Xi.SUM:return i=>N_e(i,e);case Xi.MEAN:return i=>L_e(i,e);case Xi.MAX:return i=>k_e(i,e);default:return null}}function z_e(r,e={}){return Number.isFinite(r)?r:t=>(e.index=t.index,r(t.source,e))}function G_e(r,e={}){return t=>(e.indices=t.map(n=>n.index),r(t.map(n=>n.source),e))}const V_e={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},Ff=3402823466e29,c8=[32775,32774],l8=[32776,32774],H_e=[32776,32775],kP={[Xi.SUM]:32774,[Xi.MEAN]:32774,[Xi.MIN]:c8,[Xi.MAX]:l8},j_e={size:1,operation:Xi.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},J_e=4,W_e=`#version 300 es
#define SHADER_NAME gpu-aggregation-to-grid-vs
in vec3 positions;
in vec3 positions64Low;
in vec3 weights;
uniform vec2 cellSize;
uniform vec2 gridSize;
uniform bool projectPoints;
uniform vec2 translation;
uniform vec3 scaling;
out vec3 vWeights;
vec2 project_to_pixel(vec4 pos) {
vec4 result;
pos.xy = pos.xy/pos.w;
result = pos + vec4(translation, 0., 0.);
result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;
return result.xy;
}
void main(void) {
vWeights = weights;
vec4 windowPos = vec4(positions, 1.);
if (projectPoints) {
windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));
}
vec2 pos = project_to_pixel(windowPos);
vec2 pixelXY64[2];
pixelXY64[0] = vec2(pos.x, 0.);
pixelXY64[1] = vec2(pos.y, 0.);
vec2 gridXY64[2];
gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));
gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));
float x = floor(gridXY64[0].x);
float y = floor(gridXY64[1].x);
pos = vec2(x, y);
pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);
vec2 offset = 1.0 / gridSize;
pos = pos + offset;
gl_Position = vec4(pos, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,X_e=`#version 300 es
#define SHADER_NAME gpu-aggregation-to-grid-fs
precision highp float;
in vec3 vWeights;
out vec4 fragColor;
void main(void) {
fragColor = vec4(vWeights, 1.0);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,$_e=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-vs-64
in vec2 position;
uniform ivec2 gridSize;
out vec2 vTextureCoord;
void main(void) {
vec2 pos = vec2(-1.0, -1.0);
vec2 offset = 1.0 / vec2(gridSize);
pos = pos + offset;
gl_Position = vec4(pos, 0.0, 1.0);
int yIndex = gl_InstanceID / gridSize[0];
int xIndex = gl_InstanceID - (yIndex * gridSize[0]);
vec2 yIndexFP64 = vec2(float(yIndex), 0.);
vec2 xIndexFP64 = vec2(float(xIndex), 0.);
vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);
vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);
vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);
vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);
vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);
gl_PointSize = 1.0;
}
`,K_e=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-fs
precision highp float;
in vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform bool combineMaxMin;
out vec4 fragColor;
void main(void) {
vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
if (textureColor.a == 0.) {
discard;
}
fragColor.rgb = textureColor.rgb;
fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;
}
`,q_e=`#version 300 es
#define SHADER_NAME gpu-aggregation-transform-mean-vs
in vec4 aggregationValues;
out vec4 meanValues;
void main()
{
bool isCellValid = bool(aggregationValues.w > 0.);
meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);
meanValues.w = aggregationValues.w;
gl_PointSize = 1.0;
}
`,Z_e={minFilter:"nearest",magFilter:"nearest"};function Rm(r,e){const{width:t=1,height:n=1,data:i=null,parameters:o=Z_e}=e;return r.createTexture({data:i,format:"rgba32float",mipmaps:!1,sampler:o,width:t,height:n})}function om(r,e){const{id:t,width:n=1,height:i=1,texture:o}=e;return r.createFramebuffer({id:t,width:n,height:i,colorAttachments:[o]})}const Y_e=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],UP={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},Q_e=["float32-renderable-webgl","texture-blend-float-webgl"];class qc{static getAggregationData({aggregationData:e,maxData:t,minData:n,maxMinData:i,pixelIndex:o}){const s=o*J_e,c={};return e&&(c.cellCount=e[s+3],c.cellWeight=e[s]),i?(c.maxCellWieght=i[0],c.minCellWeight=i[3]):(t&&(c.maxCellWieght=t[0],c.totalCount=t[3]),n&&(c.minCellWeight=n[0],c.totalCount=n[3])),c}static getCellData({countsData:e,size:t=1}){const n=e.length/4,i=new Float32Array(n*t),o=new Uint32Array(n);for(let s=0;s<n;s++){for(let c=0;c<t;c++)i[s*t+c]=e[s*4+c];o[s]=e[s*4+3]}return{cellCounts:o,cellWeights:i}}static isSupported(e){return Q_e.every(t=>e.features.has(t))}constructor(e,t={}){this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},shaderOptions:{},modelDirty:!1,resources:{},results:{}},this.id=t.id||"gpu-grid-aggregator",this.device=e;const n=["float32-renderable-webgl"];this._hasGPUSupport=n.every(i=>e.features.has(i)),this._hasGPUSupport&&this._setupModels()}delete(){const{gridAggregationModel:e,allAggregationModel:t,meanTransform:n}=this,{textures:i,framebuffers:o,maxMinFramebuffers:s,minFramebuffers:c,maxFramebuffers:f,meanTextures:g,resources:b}=this.state;e==null||e.destroy(),t==null||t.destroy(),n==null||n.destroy(),tye([o,i,s,c,f,g,b])}run(e={}){this.setState({results:{}});const t=this._normalizeAggregationParams(e);return this._runAggregation(t)}getData(e){const t={},n=this.state.results;n[e].aggregationData||(n[e].aggregationData=n[e].aggregationBuffer.getData()),t.aggregationData=n[e].aggregationData;for(const i in UP){const o=UP[i];(n[e][i]||n[e][o])&&(n[e][i]=n[e][i]||n[e][o].getData(),t[i]=n[e][i])}return t}updateShaders(e={}){this.setState({shaderOptions:e,modelDirty:!0})}_normalizeAggregationParams(e){const t={...V_e,...e},{weights:n}=t;return n&&(t.weights=eye(n)),t}setState(e){Object.assign(this.state,e)}_getAggregateData(e){const t={},{textures:n,framebuffers:i,maxMinFramebuffers:o,minFramebuffers:s,maxFramebuffers:c,resources:f}=this.state,{weights:g}=e;for(const b in g){t[b]={};const{needMin:T,needMax:S,combineMaxMin:F}=g[b];t[b].aggregationTexture=n[b],t[b].aggregationBuffer=this.device.readPixelsToBufferWebGL(i[b],{target:g[b].aggregationBuffer,sourceType:5126}),T&&S&&F?(t[b].maxMinBuffer=this.device.readPixelsToBufferWebGL(o[b],{target:g[b].maxMinBuffer,sourceType:5126}),t[b].maxMinTexture=f[`${b}-maxMinTexture`]):(T&&(t[b].minBuffer=this.device.readPixelsToBufferWebGL(s[b],{target:g[b].minBuffer,sourceType:5126}),t[b].minTexture=f[`${b}-minTexture`]),S&&(t[b].maxBuffer=this.device.readPixelsToBufferWebGL(c[b],{target:g[b].maxBuffer,sourceType:5126}),t[b].maxTexture=f[`${b}-maxTexture`]))}return this._trackGPUResultBuffers(t,g),t}_renderAggregateData(e){const{cellSize:t,projectPoints:n,attributes:i,moduleSettings:o,numCol:s,numRow:c,weights:f,translation:g,scaling:b}=e,{maxMinFramebuffers:T,minFramebuffers:S,maxFramebuffers:F}=this.state,k=[s,c],U={blend:!0,depthTest:!1,blendFunc:[1,1]},j={cellSize:t,gridSize:k,projectPoints:n,translation:g,scaling:b};for(const z in f){const{needMin:V,needMax:K}=f[z],fe=V&&K&&f[z].combineMaxMin;this._renderToWeightsTexture({id:z,parameters:U,moduleSettings:o,uniforms:j,gridSize:k,attributes:i,weights:f}),fe?this._renderToMaxMinTexture({id:z,parameters:{...U,blendEquation:H_e},gridSize:k,minOrMaxFb:T[z],clearParams:{clearColor:[0,0,0,Ff]},combineMaxMin:fe}):(V&&this._renderToMaxMinTexture({id:z,parameters:{...U,blendEquation:c8},gridSize:k,minOrMaxFb:S[z],clearParams:{clearColor:[Ff,Ff,Ff,0]},combineMaxMin:fe}),K&&this._renderToMaxMinTexture({id:z,parameters:{...U,blendEquation:l8},gridSize:k,minOrMaxFb:F[z],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:fe}))}}_renderToMaxMinTexture(e){const{id:t,gridSize:n,minOrMaxFb:i,combineMaxMin:o,clearParams:s={}}=e,{framebuffers:c}=this.state,{allAggregationModel:f}=this;this.device.withParametersWebGL({...s,framebuffer:i,viewport:[0,0,n[0],n[1]]},()=>{this.device.clearWebGL({color:!0}),f.setUniforms({gridSize:n,combineMaxMin:o}),f.setBindings({uSampler:c[t].texture}),f.draw()})}_renderToWeightsTexture(e){const{id:t,parameters:n,moduleSettings:i,uniforms:o,gridSize:s,weights:c}=e,{framebuffers:f,equations:g,weightAttributes:b}=this.state,{gridAggregationModel:T}=this,{operation:S}=c[t],F=S===Xi.MIN?[Ff,Ff,Ff,0]:[0,0,0,0];if(this.device.withParametersWebGL({framebuffer:f[t],viewport:[0,0,s[0],s[1]],clearColor:F},()=>{this.device.clearWebGL({color:!0});const k={weights:b[t]};T.draw({parameters:{...n,blendEquation:g[t]},moduleSettings:i,uniforms:o,attributes:k})}),S===Xi.MEAN){const{meanTextures:k,textures:U}=this.state,j={_sourceTextures:{aggregationValues:k[t]},_targetTexture:U[t],elementCount:U[t].width*U[t].height};this.meanTransform?this.meanTransform.update(j):this.meanTransform=iye(this.device,j),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),f[t].attach({36064:U[t]})}}_runAggregation(e){this._updateModels(e),this._setupFramebuffers(e),this._renderAggregateData(e);const t=this._getAggregateData(e);return this.setState({results:t}),t}_setupFramebuffers(e){const{textures:t,framebuffers:n,maxMinFramebuffers:i,minFramebuffers:o,maxFramebuffers:s,meanTextures:c,equations:f}=this.state,{weights:g}=e,{numCol:b,numRow:T}=e,S={width:b,height:T};for(const F in g){const{needMin:k,needMax:U,combineMaxMin:j,operation:z}=g[F];t[F]=g[F].aggregationTexture||t[F]||Rm(this.device,{width:b,height:T}),t[F].resize(S);let V=t[F];z===Xi.MEAN&&(c[F]=c[F]||Rm(this.device,{width:b,height:T}),c[F].resize(S),V=c[F]),n[F]?n[F].attach({36064:V}):n[F]=om(this.device,{id:`${F}-fb`,width:b,height:T,texture:V}),n[F].resize(S),f[F]=kP[z]||kP[Xi.SUM],(k||U)&&(k&&U&&j?i[F]||(V=g[F].maxMinTexture||this._getMinMaxTexture(`${F}-maxMinTexture`),i[F]=om(this.device,{id:`${F}-maxMinFb`,texture:V})):(k&&(o[F]||(V=g[F].minTexture||this._getMinMaxTexture(`${F}-minTexture`),o[F]=om(this.device,{id:`${F}-minFb`,texture:V}))),U&&(s[F]||(V=g[F].maxTexture||this._getMinMaxTexture(`${F}-maxTexture`),s[F]=om(this.device,{id:`${F}-maxFb`,texture:V})))))}}_getMinMaxTexture(e){const{resources:t}=this.state;return t[e]||(t[e]=Rm(this.device,{})),t[e]}_setupModels({numCol:e=0,numRow:t=0}={}){var i;const{shaderOptions:n}=this.state;if((i=this.gridAggregationModel)==null||i.destroy(),this.gridAggregationModel=rye(this.device,n),!this.allAggregationModel){const o=e*t;this.allAggregationModel=nye(this.device,o)}}_setupWeightAttributes(e){const{weightAttributes:t}=this.state,{weights:n}=e;for(const i in n)t[i]=e.attributes[i]}_trackGPUResultBuffers(e,t){const{resources:n}=this.state;for(const i in e)if(e[i]){for(const o of Y_e)if(e[i][o]&&t[i][o]!==e[i][o]){const s=`gpu-result-${i}-${o}`;n[s]&&n[s].delete(),n[s]=e[i][o]}}}_updateModels(e){const{vertexCount:t,attributes:n,numCol:i,numRow:o}=e,{modelDirty:s}=this.state;s&&(this._setupModels(e),this.setState({modelDirty:!1})),this._setupWeightAttributes(e),this.gridAggregationModel.setVertexCount(t),this.gridAggregationModel.setAttributes(n),this.allAggregationModel.setInstanceCount(i*o)}}function eye(r){const e={};for(const t in r)e[t]={...j_e,...r[t]};return e}function tye(r){r=Array.isArray(r)?r:[r],r.forEach(e=>{for(const t in e)e[t].delete()})}function rye(r,e){const t=f2({vs:W_e,fs:X_e,modules:[J_,_o]},e);return new mi(r,{id:"Grid-Aggregation-Model",vertexCount:1,drawMode:0,shaderAssembler:bD(),...t})}function nye(r,e){return new mi(r,{id:"All-Aggregation-Model",vs:$_e,fs:K_e,modules:[J_],vertexCount:1,topology:"point-list",isInstanced:!0,instanceCount:e,attributes:{position:[0,0]}})}function iye(r,e){return new e2(r,{vs:q_e,_targetTextureVarying:"meanValues",...e})}const BA=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function Fy(r,e=!1,t=Float32Array){let n;if(Number.isFinite(r[0]))n=new t(r);else{n=new t(r.length*4);let i=0;for(let o=0;o<r.length;o++){const s=r[o];n[i++]=s[0],n[i++]=s[1],n[i++]=s[2],n[i++]=Number.isFinite(s[3])?s[3]:255}}if(e)for(let i=0;i<n.length;i++)n[i]/=255;return n}const sye=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec3 positions;
in vec3 instancePositions;
in vec4 instanceCounts;
in vec3 instancePickingColors;
uniform float opacity;
uniform vec3 cellScale;
uniform vec4 minColor;
uniform vec4 maxColor;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 colorDomain;
uniform bool shouldUseMinMax;
uniform sampler2D maxTexture;
out vec4 vColor;
out float vSampleCount;
vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
vec4 outColor = vec4(0., 0., 0., 0.);
if (value >= domain.x && value <= domain.y) {
float domainRange = domain.y - domain.x;
if (domainRange <= 0.) {
outColor = colorRange[0];
} else {
float rangeCount = float(RANGE_COUNT);
float rangeStep = domainRange / rangeCount;
float idx = floor((value - domain.x) / rangeStep);
idx = clamp(idx, 0., rangeCount - 1.);
int intIdx = int(idx);
outColor = colorRange[intIdx];
}
}
outColor = outColor / 255.;
return outColor;
}
void main(void) {
vSampleCount = instanceCounts.a;
float weight = instanceCounts.r;
float maxWeight = texture(maxTexture, vec2(0.5)).r;
float step = weight / maxWeight;
vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;
vec2 domain = colorDomain;
float domainMaxValid = float(colorDomain.y != 0.);
domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);
vec4 rangeColor = quantizeScale(domain, colorRange, weight);
float rangeMinMax = float(shouldUseMinMax);
vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);
vColor = vec4(color.rgb, color.a * opacity);
picking_setPickingColor(instancePickingColors);
gl_Position = vec4(instancePositions + positions * cellScale, 1.);
}
`,oye=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
in float vSampleCount;
out vec4 fragColor;
void main(void) {
if (vSampleCount <= 0.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,aye=[0,0,0,0],cye=[0,255,0,255],lye=["minColor","maxColor","colorRange","colorDomain"],uye={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0,max:5},colorDomain:null,colorRange:BA};class Dy extends cs{getShaders(){return{vs:sye,fs:oye,modules:[Fo]}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel()})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e);const{oldProps:t,props:n,changeFlags:i}=e,o=this.getAttributeManager();n.numInstances!==t.numInstances?o.invalidateAll():t.cellSizePixels!==n.cellSizePixels&&o.invalidate("instancePositions"),this._updateUniforms(t,n,i)}draw({uniforms:e}){const{parameters:t,maxTexture:n}=this.props,i=this.props.minColor||aye,o=this.props.maxColor||cye,s=this.props.colorDomain||[1,0],c=this.state.model;c.setUniforms(e),c.setBindings({maxTexture:n}),c.setUniforms({minColor:i,maxColor:o,colorDomain:s}),c.setParameters({depthWriteEnabled:!1,...t}),c.draw(this.context.renderPass)}calculateInstancePositions(e,{numInstances:t}){const{width:n,height:i}=this.context.viewport,{cellSizePixels:o}=this.props,s=Math.ceil(n/o),{value:c,size:f}=e;for(let g=0;g<t;g++){const b=g%s,T=Math.floor(g/s);c[g*f+0]=b*o/n*2-1,c[g*f+1]=1-T*o/i*2,c[g*f+2]=0}}_getModel(){return new mi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ts({topology:"triangle-list",attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,1,0])}}),isInstanced:!0})}_shouldUseMinMax(){const{minColor:e,maxColor:t,colorDomain:n,colorRange:i}=this.props;return e||t?(Ur.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!(n||i)}_updateUniforms(e,t,n){const i=this.state.model;if(lye.some(o=>e[o]!==t[o])&&i.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),e.colorRange!==t.colorRange&&i.setUniforms({colorRange:Fy(t.colorRange)}),e.cellMarginPixels!==t.cellMarginPixels||e.cellSizePixels!==t.cellSizePixels||n.viewportChanged){const{width:o,height:s}=this.context.viewport,{cellSizePixels:c,cellMarginPixels:f}=this.props,g=c>f?f:0,b=new Float32Array([(c-g)/o*2,-(c-g)/s*2,1]);i.setUniforms({cellScale:b})}}}Dy.layerName="ScreenGridCellLayer";Dy.defaultProps=uye;function fye(r,e){const t={};for(const n in r)e.includes(n)||(t[n]=r[n]);return t}class SA extends gs{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:fye(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:n,oldProps:i,changeFlags:o}=e,{compareAll:s=!1,dimension:c}=t,{ignoreProps:f}=this.state,{props:g,accessors:b=[]}=c,{updateTriggersChanged:T}=o;if(o.dataChanged)return!0;if(T){if(T.all)return!0;for(const S of b)if(T[S])return!0}if(s)return o.extensionsChanged?!0:Xx({oldProps:i,newProps:n,ignoreProps:f,propTypes:this.constructor._propTypes});for(const S of g)if(n[S]!==i[S])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!hye(t)}_getAttributeManager(){return new Wx(this.context.device,{id:this.props.id,stats:this.context.stats})}}SA.layerName="AggregationLayer";function hye(r){let e=!0;for(const t in r){e=!1;break}return e}function Oy(r,e,t){const n=t;return n.domain=()=>r,n.range=()=>e,n}function zP(r,e){return Oy(r,e,n=>vye(r,e,n))}function dye(r,e){return Oy(r,e,n=>bye(r,e,n))}function Aye(r,e){const t=r.sort(u8);let n=0;const i=Math.max(1,e.length),o=new Array(i-1);for(;++n<i;)o[n-1]=pye(t,n/i);const s=c=>mye(o,e,c);return s.thresholds=()=>o,Oy(r,e,s)}function u8(r,e){return r-e}function pye(r,e){const t=r.length;if(e<=0||t<2)return r[0];if(e>=1)return r[t-1];const n=(t-1)*e,i=Math.floor(n),o=r[i],s=r[i+1];return o+(s-o)*(n-i)}function gye(r,e){let t=0,n=r.length;for(;t<n;){const i=t+n>>>1;u8(r[i],e)>0?n=i:t=i+1}return t}function mye(r,e,t){return e[gye(r,t)]}function _ye(r,e,t,n){const i=`${n}`;let o=e.get(i);return o===void 0&&(o=r.push(n),e.set(i,o)),t[(o-1)%t.length]}function yye(r,e){const t=new Map,n=[];for(const o of r){const s=`${o}`;t.has(s)||t.set(s,n.push(o))}return Oy(r,e,o=>_ye(n,t,e,o))}function vye(r,e,t){const n=r[1]-r[0];if(n<=0)return Ur.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const i=n/e.length,o=Math.floor((t-r[0])/i),s=Math.max(Math.min(o,e.length-1),0);return e[s]}function bye(r,e,t){return(t-r[0])/(r[1]-r[0])*(e[1]-e[0])+e[0]}function f8(r){return r!=null}function xye(r){const e=[];return r.forEach(t=>{!e.includes(t)&&f8(t)&&e.push(t)}),e}function h8(r,e){return(typeof e=="function"?r.map(e):r).filter(f8)}function wye(r,e){return h8(r,e)}function Cye(r,e){return xye(h8(r,e))}function Eye(r,e,t){return Math.max(e,Math.min(t,r))}function Tye(r){switch(r){case"quantize":return zP;case"linear":return dye;case"quantile":return Aye;case"ordinal":return yye;default:return zP}}const d8=r=>r.length,Bye=3402823466e29,A8=r=>r.points,p8=r=>r.index,GP=(r,e)=>r<e?-1:r>e?1:r>=e?0:NaN,Sye={getValue:d8,getPoints:A8,getIndex:p8,filterData:null};class LC{constructor(e=[],t=Sye){this.aggregatedBins=this.getAggregatedBins(e,t),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(e,t){const{getValue:n=d8,getPoints:i=A8,getIndex:o=p8,filterData:s}=t,c=typeof s=="function",f=e.length,g=[];let b=0;for(let T=0;T<f;T++){const S=e[T],F=i(S),k=o(S),U=c?F.filter(s):F;S.filteredPoints=c?U:null;const j=U.length?n(U):null;j!=null&&(g[b]={i:Number.isFinite(k)?k:T,value:j,counts:U.length},b++)}return g}_percentileToIndex(e){const t=this.sortedBins.length;if(t<2)return[0,0];const[n,i]=e.map(c=>Eye(c,0,100)),o=Math.ceil(n/100*(t-1)),s=Math.floor(i/100*(t-1));return[o,s]}getBinMap(){const e={};for(const t of this.aggregatedBins)e[t.i]=t;return e}_updateMinMaxValues(){let e=0,t=0,n=Bye,i=0;for(const o of this.aggregatedBins)e=e>o.counts?e:o.counts,t=t>o.value?t:o.value,n=n<o.value?n:o.value,i+=o.counts;this.maxCount=e,this.maxValue=t,this.minValue=n,this.totalCount=i}getValueRange(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((i,o)=>GP(i.value,o.value))),!this.sortedBins.length)return[];let t=0,n=this.sortedBins.length-1;if(Array.isArray(e)){const i=this._percentileToIndex(e);t=i[0],n=i[1]}return[this.sortedBins[t].value,this.sortedBins[n].value]}getValueDomainByScale(e,[t=0,n=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((o,s)=>GP(o.value,s.value))),!this.sortedBins.length)return[];const i=this._percentileToIndex([t,n]);return this._getScaleDomain(e,i)}_getScaleDomain(e,[t,n]){const i=this.sortedBins;switch(e){case"quantize":case"linear":return[i[t].value,i[n].value];case"quantile":return wye(i.slice(t,n+1),o=>o.value);case"ordinal":return Cye(i,o=>o.value);default:return[i[t].value,i[n].value]}}}const g8=6378e3;function am(r){return Number.isFinite(r)?r:0}function m8(r,e){const t=r.positions.value;let n=1/0,i=-1/0,o=1/0,s=-1/0,c,f;for(let b=0;b<e;b++)f=t[b*3],c=t[b*3+1],n=c<n?c:n,i=c>i?c:i,o=f<o?f:o,s=f>s?f:s;return{xMin:am(o),xMax:am(s),yMin:am(n),yMax:am(i)}}function Iye(r,e,t,n){const{width:i,height:o}=n,s=t===Wr.CARTESIAN?[-i/2,-o/2]:[-180,-90];Ur.assert(t===Wr.CARTESIAN||t===Wr.LNGLAT||t===Wr.DEFAULT);const{xMin:c,yMin:f}=r;return[-1*(VP(c-s[0],e.xOffset)+s[0]),-1*(VP(f-s[1],e.yOffset)+s[1])]}function VP(r,e){const t=r<0?-1:1;let n=t<0?Math.abs(r)+e:Math.abs(r);return n=Math.floor(n/e)*e,n*t}function _8(r,e,t=!0){if(!t)return{xOffset:e,yOffset:e};const{yMin:n,yMax:i}=r,o=(n+i)/2;return Mye(e,o)}function y8(r,e,t,n){const i=_8(r,e,n!==Wr.CARTESIAN),o=Iye(r,i,n,t),{xMin:s,yMin:c,xMax:f,yMax:g}=r,b=f-s+i.xOffset,T=g-c+i.yOffset,S=Math.ceil(b/i.xOffset),F=Math.ceil(T/i.yOffset);return{gridOffset:i,translation:o,width:b,height:T,numCol:S,numRow:F}}function Mye(r,e){const t=Pye(r),n=Rye(e,r);return{yOffset:t,xOffset:n}}function Pye(r){return r/g8*(180/Math.PI)}function Rye(r,e){return e/g8*(180/Math.PI)/Math.cos(r*Math.PI/180)}function NC(r,e){const t=Fye(r,e),n=Dye(t);return{gridHash:t.gridHash,gridOffset:t.gridOffset,data:n}}function Fye(r,e){const{data:t=[],cellSize:n}=r,{attributes:i,viewport:o,projectPoints:s,numInstances:c}=e,f=i.positions.value,{size:g}=i.positions.getAccessor(),b=e.boundingBox||Oye(i.positions,c),T=e.posOffset||[180,90],S=e.gridOffset||_8(b,n);if(S.xOffset<=0||S.yOffset<=0)return{gridHash:{},gridOffset:S,offsets:[0,0]};const{width:F,height:k}=o,U=Math.ceil(F/S.xOffset),j=Math.ceil(k/S.yOffset),z={},{iterable:V,objectInfo:K}=el(t),fe=new Array(3);for(const Q of V){K.index++,fe[0]=f[K.index*g],fe[1]=f[K.index*g+1],fe[2]=g>=3?f[K.index*g+2]:0;const[oe,Te]=s?o.project(fe):fe;if(Number.isFinite(oe)&&Number.isFinite(Te)){const ze=Math.floor((Te+T[1])/S.yOffset),Ae=Math.floor((oe+T[0])/S.xOffset);if(!s||Ae>=0&&Ae<U&&ze>=0&&ze<j){const _e=`${ze}-${Ae}`;z[_e]=z[_e]||{count:0,points:[],lonIdx:Ae,latIdx:ze},z[_e].count+=1,z[_e].points.push({source:Q,index:K.index})}}}return{gridHash:z,gridOffset:S,offsets:[T[0]*-1,T[1]*-1]}}function Dye({gridHash:r,gridOffset:e,offsets:t}){const n=new Array(Object.keys(r).length);let i=0;for(const o in r){const s=o.split("-"),c=parseInt(s[0],10),f=parseInt(s[1],10),g=i++;n[g]={index:g,position:[t[0]+e.xOffset*f,t[1]+e.yOffset*c],...r[o]}}return n}function Oye(r,e){const t=r.value,{size:n}=r.getAccessor();let i=1/0,o=-1/0,s=1/0,c=-1/0,f,g;for(let b=0;b<e;b++)g=t[b*n],f=t[b*n+1],Number.isFinite(g)&&Number.isFinite(f)&&(i=f<i?f:i,o=f>o?f:o,s=g<s?g:s,c=g>c?g:c);return{xMin:s,xMax:c,yMin:i,yMax:o}}class Ly extends SA{initializeAggregationLayer({dimensions:e}){super.initializeAggregationLayer(e),this.setState({layerData:{},gpuGridAggregator:new qc(this.context.device,{id:`${this.id}-gpu-aggregator`}),cpuGridAggregator:NC})}updateState(e){super.updateState(e),this.updateAggregationState(e);const{aggregationDataDirty:t,aggregationWeightsDirty:n,gpuAggregation:i}=this.state;if(this.getNumInstances()<=0)return;let o=!1;(t||i&&n)&&(this._updateAggregation(e),o=!0),!i&&(t||n)&&(this._updateWeightBins(),this._uploadAggregationResults(),o=!0),this.setState({aggregationDirty:o})}finalizeState(e){var n;const{count:t}=this.state.weights;t&&t.aggregationBuffer&&t.aggregationBuffer.delete(),(n=this.state.gpuGridAggregator)==null||n.delete(),super.finalizeState(e)}updateShaders(e){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(e)}updateAggregationState(e){Ur.assert(!1)}allocateResources(e,t){if(this.state.numRow!==e||this.state.numCol!==t){const n=t*e*4*4,{weights:i}=this.state;for(const o in i){const s=i[o];s.aggregationBuffer&&s.aggregationBuffer.delete(),s.aggregationBuffer=this.context.device.createBuffer({byteLength:n,accessor:{size:4,type:5126,divisor:1}})}}}updateResults({aggregationData:e,maxMinData:t,maxData:n,minData:i}){const{count:o}=this.state.weights;o&&(o.aggregationData=e,o.maxMinData=t,o.maxData=n,o.minData=i)}_updateAggregation(e){const{cpuGridAggregator:t,gpuGridAggregator:n,gridOffset:i,posOffset:o,translation:s=[0,0],scaling:c=[0,0,0],boundingBox:f,projectPoints:g,gpuAggregation:b,numCol:T,numRow:S}=this.state,{props:F}=e,{viewport:k}=this.context,U=this.getAttributes(),j=this.getNumInstances();if(b){const{weights:z}=this.state;n.run({weights:z,cellSize:[i.xOffset,i.yOffset],numCol:T,numRow:S,translation:s,scaling:c,vertexCount:j,projectPoints:g,attributes:U,moduleSettings:this.getModuleSettings()})}else{const z=t(F,{gridOffset:i,projectPoints:g,attributes:U,viewport:k,posOffset:o,boundingBox:f});this.setState({layerData:z})}}_updateWeightBins(){const{getValue:e}=this.state,t=new LC(this.state.layerData.data||[],{getValue:e});this.setState({sortedBins:t})}_uploadAggregationResults(){const{numCol:e,numRow:t}=this.state,{data:n}=this.state.layerData,{aggregatedBins:i,minValue:o,maxValue:s,totalCount:c}=this.state.sortedBins,f=4,g=e*t*f,b=new Float32Array(g).fill(0);for(const k of i){const{lonIdx:U,latIdx:j}=n[k.i],{value:z,counts:V}=k,K=(U+j*e)*f;b[K]=z,b[K+f-1]=V}const T=new Float32Array([s,0,0,o]),S=new Float32Array([s,0,0,c]),F=new Float32Array([o,0,0,c]);this.updateResults({aggregationData:b,maxMinData:T,maxData:S,minData:F})}}Ly.layerName="GridAggregationLayer";const Lye={...Dy.defaultProps,getPosition:{type:"accessor",value:r=>r.position},getWeight:{type:"accessor",value:1},gpuAggregation:!1,aggregation:"SUM"},HP="positions",Nye={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class kC extends Ly{initializeState(){super.initializeAggregationLayer({dimensions:Nye,getCellSize:n=>n.cellSizePixels});const e={count:{size:1,operation:Xi.SUM,needMax:!0,maxTexture:Rm(this.context.device,{id:`${this.id}-max-texture`})}};this.setState({supported:!0,projectPoints:!0,weights:e,subLayerData:{attributes:{}},maxTexture:e.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]}),this.getAttributeManager().add({[HP]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return this.state.supported&&e.somethingChanged}updateState(e){super.updateState(e)}renderLayers(){if(!this.state.supported)return[];const{maxTexture:e,numRow:t,numCol:n,weights:i}=this.state,{updateTriggers:o}=this.props,{aggregationBuffer:s}=i.count,c=this.getSubLayerClass("cells",Dy);return new c(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:o}),{data:{attributes:{instanceCounts:s}},maxTexture:e,numInstances:t*n})}finalizeState(e){super.finalizeState(e);const{aggregationBuffer:t,maxBuffer:n,maxTexture:i}=this.state;t==null||t.delete(),n==null||n.delete(),i==null||i.delete()}getPickingInfo({info:e}){const{index:t}=e;if(t>=0){const{gpuGridAggregator:n,gpuAggregation:i,weights:o}=this.state,s=i?n.getData("count"):o.count;e.object=qc.getAggregationData({pixelIndex:t,...s})}return e}updateResults({aggregationData:e,maxData:t}){const{count:n}=this.state.weights;n.aggregationData=e,n.aggregationBuffer.write(e),n.maxData=t,n.maxTexture.setImageData({data:t})}updateAggregationState(e){const t=e.props.cellSizePixels,n=e.oldProps.cellSizePixels!==t,{viewportChanged:i}=e.changeFlags;let o=e.props.gpuAggregation;this.state.gpuAggregation!==e.props.gpuAggregation&&o&&!qc.isSupported(this.context.device)&&(Ur.warn("GPU Grid Aggregation not supported, falling back to CPU")(),o=!1);const s=o!==this.state.gpuAggregation;this.setState({gpuAggregation:o});const c=this.isAttributeChanged(HP),{dimensions:f}=this.state,{data:g,weights:b}=f,T=c||s||i||this.isAggregationDirty(e,{compareAll:o,dimension:g}),S=this.isAggregationDirty(e,{dimension:b});this.setState({aggregationDataDirty:T,aggregationWeightsDirty:S});const{viewport:F}=this.context;if(i||n){const{width:k,height:U}=F,j=Math.ceil(k/t),z=Math.ceil(U/t);this.allocateResources(z,j),this.setState({scaling:[k/2,-U/2,1],gridOffset:{xOffset:t,yOffset:t},width:k,height:U,numCol:j,numRow:z})}S&&this._updateAccessors(e),(T||S)&&this._resetResults()}_updateAccessors(e){const{getWeight:t,aggregation:n,data:i}=e.props,{count:o}=this.state.weights;o&&(o.getWeight=t,o.operation=Xi[n]),this.setState({getValue:OC(n,t,{data:i})})}_resetResults(){const{count:e}=this.state.weights;e&&(e.aggregationData=null)}}kC.layerName="ScreenGridLayer";kC.defaultProps=Lye;function jP(){}const JP=["getBins","getDomain","getScaleFunc"],WP=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],kye=r=>r.cellSize;class UC{constructor(e){this.state={layerData:{data:void 0},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=e.getCellSize||kye,this._getAggregator=e.getAggregator,this._addDimension(e.dimensions||WP)}static defaultDimensions(){return WP}updateState(e,t){const{oldProps:n,props:i,changeFlags:o}=e;this.updateGetValueFuncs(n,i,o);const s=this.needsReProjectPoints(n,i,o);let c=!1;return o.dataChanged||s?(this.getAggregatedData(i,t),c=!0):((this.getDimensionChanges(n,i,o)||[]).forEach(g=>typeof g=="function"&&g()),c=!0),this.setState({aggregationDirty:c}),this.state}setState(e){this.state={...this.state,...e}}setDimensionState(e,t){this.setState({dimensions:{...this.state.dimensions,[e]:{...this.state.dimensions[e],...t}}})}normalizeResult(e={}){return e.hexagons?{data:e.hexagons,...e}:e.layerData?{data:e.layerData,...e}:e}getAggregatedData(e,t){const i=this._getAggregator(e)(e,t);this.setState({layerData:this.normalizeResult(i)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}updateGetValueFuncs(e,t,n){for(const i in this.dimensionUpdaters){const{value:o,weight:s,aggregation:c}=this.dimensionUpdaters[i].getBins.triggers;let f=t[o.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[i].getBins,e,t,n)&&(f?f=G_e(f,{data:t.data}):f=OC(t[c.prop],t[s.prop],{data:t.data})),f&&this.setDimensionState(i,{getValue:f})}}needsReProjectPoints(e,t,n){return this._getCellSize(e)!==this._getCellSize(t)||this._getAggregator(e)!==this._getAggregator(t)||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}addDimension(e){this._addDimension(e)}_addDimension(e=[]){e.forEach(t=>{const{key:n}=t;this.dimensionUpdaters[n]=this.getDimensionUpdaters(t),this.state.dimensions[n]={getValue:null,domain:null,sortedBins:null,scaleFunc:jP}})}getDimensionUpdaters({key:e,accessor:t,pickingInfo:n,getBins:i,getDomain:o,getScaleFunc:s,nullValue:c}){return{key:e,accessor:t,pickingInfo:n,getBins:{updater:this.getDimensionSortedBins.bind(this),...i},getDomain:{updater:this.getDimensionValueDomain.bind(this),...o},getScaleFunc:{updater:this.getDimensionScale.bind(this),...s},attributeAccessor:this.getSubLayerDimensionAttribute(e,c)}}needUpdateDimensionStep(e,t,n,i){return Object.values(e.triggers).some(o=>o.updateTrigger?i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged[o.updateTrigger]):t[o.prop]!==n[o.prop])}getDimensionChanges(e,t,n){const i=[];for(const o in this.dimensionUpdaters){const s=JP.find(c=>this.needUpdateDimensionStep(this.dimensionUpdaters[o][c],e,t,n));s&&i.push(this.dimensionUpdaters[o][s].updater.bind(this,t,this.dimensionUpdaters[o]))}return i.length?i:null}getUpdateTriggers(e){const t=e.updateTriggers||{},n={};for(const i in this.dimensionUpdaters){const{accessor:o}=this.dimensionUpdaters[i];n[o]={},JP.forEach(s=>{Object.values(this.dimensionUpdaters[i][s].triggers).forEach(({prop:c,updateTrigger:f})=>{if(f){const g=t[f];typeof g=="object"&&!Array.isArray(g)?Object.assign(n[o],g):g!==void 0&&(n[o][c]=g)}else n[o][c]=e[c]})})}return n}getSortedBins(e){for(const t in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[t])}getDimensionSortedBins(e,t){const{key:n}=t,{getValue:i}=this.state.dimensions[n],o=new LC(this.state.layerData.data||[],{getValue:i,filterData:e._filterData});this.setDimensionState(n,{sortedBins:o}),this.getDimensionValueDomain(e,t)}getDimensionValueDomain(e,t){const{getDomain:n,key:i}=t,{triggers:{lowerPercentile:o,upperPercentile:s,scaleType:c}}=n,f=this.state.dimensions[i].sortedBins.getValueDomainByScale(e[c.prop],[e[o.prop],e[s.prop]]);this.setDimensionState(i,{valueDomain:f}),this.getDimensionScale(e,t)}getDimensionScale(e,t){const{key:n,getScaleFunc:i,getDomain:o}=t,{domain:s,range:c}=i.triggers,{scaleType:f}=o.triggers,{onSet:g}=i,b=e[c.prop],T=e[s.prop]||this.state.dimensions[n].valueDomain,F=Tye(f&&e[f.prop])(T,b);typeof g=="object"&&typeof e[g.props]=="function"&&e[g.props](F.domain()),this.setDimensionState(n,{scaleFunc:F})}getSubLayerDimensionAttribute(e,t){return n=>{const{sortedBins:i,scaleFunc:o}=this.state.dimensions[e],s=i.binMap[n.index];if(s&&s.counts===0)return t;const c=s&&s.value,f=o.domain();return c>=f[0]&&c<=f[f.length-1]?o(c):t}}getSubLayerAccessors(e){const t={};for(const n in this.dimensionUpdaters){const{accessor:i}=this.dimensionUpdaters[n];t[i]=this.getSubLayerDimensionAttribute(e,n)}return t}getPickingInfo({info:e}){const t=e.picked&&e.index>-1;let n=null;if(t){const i=this.state.layerData.data[e.index],o={};for(const s in this.dimensionUpdaters){const{pickingInfo:c}=this.dimensionUpdaters[s],{sortedBins:f}=this.state.dimensions[s],g=f.binMap[i.index]&&f.binMap[i.index].value;o[c]=g}n=Object.assign(o,i,{points:i.filteredPoints||i.points})}return e.picked=!!n,e.object=n,e}getAccessor(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:jP}}function XP(){}const Uye={colorDomain:null,colorRange:BA,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:XP,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:XP,gridAggregator:NC,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:r=>r.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}};class Rg extends SA{initializeState(){const e=new UC({getAggregator:n=>n.gridAggregator,getCellSize:n=>n.cellSize});this.state={cpuAggregator:e,aggregatorState:e.state},this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"}})}updateState(e){super.updateState(e),this.setState({aggregatorState:this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances()})})}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:t,cellSize:n,coverage:i,material:o,transitions:s}=this.props,{cpuAggregator:c}=this.state,f=this.getSubLayerClass("grid-cell",oy),g=this._getSublayerUpdateTriggers();return new f({cellSize:n,coverage:i,material:o,elevationScale:e,extruded:t,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:g}),{data:c.state.layerData.data})}}Rg.layerName="CPUGridLayer";Rg.defaultProps=Uye;var Id=Math.PI/3,zye=[0,Id,2*Id,3*Id,4*Id,5*Id];function Gye(r){return r[0]}function Vye(r){return r[1]}function Hye(){var r=0,e=0,t=1,n=1,i=Gye,o=Vye,s,c,f;function g(T){var S={},F=[],k,U=T.length;for(k=0;k<U;++k)if(!(isNaN(z=+i.call(null,j=T[k],k,T))||isNaN(V=+o.call(null,j,k,T)))){var j,z,V,K=Math.round(V=V/f),fe=Math.round(z=z/c-(K&1)/2),Q=V-K;if(Math.abs(Q)*3>1){var oe=z-fe,Te=fe+(z<fe?-1:1)/2,ze=K+(V<K?-1:1),Ae=z-Te,_e=V-ze;oe*oe+Q*Q>Ae*Ae+_e*_e&&(fe=Te+(K&1?1:-1)/2,K=ze)}var pe=fe+"-"+K,X=S[pe];X?X.push(j):(F.push(X=S[pe]=[j]),X.x=(fe+(K&1)/2)*c,X.y=K*f)}return F}function b(T){var S=0,F=0;return zye.map(function(k){var U=Math.sin(k)*T,j=-Math.cos(k)*T,z=U-S,V=j-F;return S=U,F=j,[z,V]})}return g.hexagon=function(T){return"m"+b(T==null?s:+T).join("l")+"z"},g.centers=function(){for(var T=[],S=Math.round(e/f),F=Math.round(r/c),k=S*f;k<n+s;k+=f,++S)for(var U=F*c+(S&1)*c/2;U<t+c/2;U+=c)T.push([U,k]);return T},g.mesh=function(){var T=b(s).slice(0,4).join("l");return g.centers().map(function(S){return"M"+S+"m"+T}).join("")},g.x=function(T){return arguments.length?(i=T,g):i},g.y=function(T){return arguments.length?(o=T,g):o},g.radius=function(T){return arguments.length?(s=+T,c=s*2*Math.sin(Id),f=s*1.5,g):s},g.size=function(T){return arguments.length?(r=e=0,t=+T[0],n=+T[1],g):[t-r,n-e]},g.extent=function(T){return arguments.length?(r=+T[0][0],e=+T[0][1],t=+T[1][0],n=+T[1][1],g):[[r,e],[t,n]]},g.radius(1)}function jye(r,e){const{data:t,radius:n}=r,{viewport:i,attributes:o}=e,s=t.length?Jye(t,e):null,c=Wye(n,i,s),f=[],{iterable:g,objectInfo:b}=el(t),T=o.positions.value,{size:S}=o.positions.getAccessor();for(const U of g){b.index++;const j=b.index*S,z=[T[j],T[j+1]];Number.isFinite(z[0])&&Number.isFinite(z[1])?f.push({screenCoord:i.projectFlat(z),source:U,index:b.index}):Ur.warn("HexagonLayer: invalid position")()}return{hexagons:Hye().radius(c).x(U=>U.screenCoord[0]).y(U=>U.screenCoord[1])(f).map((U,j)=>({position:i.unprojectFlat([U.x,U.y]),points:U,index:j})),radiusCommon:c}}function Jye(r,e){const{attributes:t}=e,n=t.positions.value,{size:i}=t.positions.getAccessor();let o=1/0,s=1/0,c=-1/0,f=-1/0,g;for(g=0;g<i*r.length;g+=i){const b=n[g],T=n[g+1];Number.isFinite(b)&&Number.isFinite(T)&&(o=Math.min(b,o),c=Math.max(b,c),s=Math.min(T,s),f=Math.max(T,f))}return[o,s,c,f].every(Number.isFinite)?[(o+c)/2,(s+f)/2]:null}function Wye(r,e,t){const{unitsPerMeter:n}=e.getDistanceScales(t);return r*n[0]}function $P(){}const Xye={colorDomain:null,colorRange:BA,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:$P,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:$P,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:jye,getPosition:{type:"accessor",value:r=>r.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class zC extends SA{initializeState(){const e=new UC({getAggregator:n=>n.hexagonAggregator,getCellSize:n=>n.radius});this.state={cpuAggregator:e,aggregatorState:e.state,vertices:null},this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"}})}updateState(e){if(super.updateState(e),e.changeFlags.propsOrDataChanged){const t=this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==t.layerData){const{hexagonVertices:n}=t.layerData||{};this.setState({vertices:n&&this.convertLatLngToMeterOffset(n)})}this.setState({aggregatorState:t})}}convertLatLngToMeterOffset(e){const{viewport:t}=this.context;if(Array.isArray(e)&&e.length===6){const n=e[0],i=e[3],o=[(n[0]+i[0])/2,(n[1]+i[1])/2],s=t.projectFlat(o),{metersPerUnit:c}=t.getDistanceScales(o);return e.map(g=>{const b=t.projectFlat(g);return[(b[0]-s[0])*c[0],(b[1]-s[1])*c[1]]})}return Ur.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:t,coverage:n,material:i,transitions:o}=this.props,{aggregatorState:s,vertices:c}=this.state,f=this.getSubLayerClass("hexagon-cell",Jl),g=this._getSublayerUpdateTriggers(),b=c?{vertices:c,radius:1}:{radius:s.layerData.radiusCommon||1,radiusUnits:"common",angle:90};return new f({...b,diskResolution:6,elevationScale:e,extruded:t,coverage:n,material:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:g}),{data:s.layerData.data})}}zC.layerName="HexagonLayer";zC.defaultProps=Xye;const An=.5,bn=1/6,bt={N:[0,An],E:[An,0],S:[0,-.5],W:[-.5,0],NE:[An,An],NW:[-.5,An],SE:[An,-.5],SW:[-.5,-.5]},pd=[bt.W,bt.SW,bt.S],gd=[bt.S,bt.SE,bt.E],md=[bt.E,bt.NE,bt.N],_d=[bt.NW,bt.W,bt.N],yd=[[-.5,bn],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[bn,-.5]],vd=[[-.16666666666666666,-.5],[bn,-.5],[An,-.16666666666666666],[An,bn]],bd=[[An,-.16666666666666666],[An,bn],[bn,An],[-.16666666666666666,An]],xd=[[-.5,bn],[-.5,-.16666666666666666],[bn,An],[-.16666666666666666,An]],KP=[bt.W,bt.SW,bt.SE,bt.E],qP=[bt.S,bt.SE,bt.NE,bt.N],ZP=[bt.NW,bt.W,bt.E,bt.NE],YP=[bt.NW,bt.SW,bt.S,bt.N],QP=[[-.5,bn],[-.5,-.16666666666666666],[An,-.16666666666666666],[An,bn]],eR=[[-.16666666666666666,-.5],[bn,-.5],[bn,An],[-.16666666666666666,An]],$ye=[bt.NW,bt.SW,bt.SE,bt.NE],tR=[bt.NW,bt.SW,bt.SE,bt.E,bt.N],rR=[bt.W,bt.SW,bt.SE,bt.NE,bt.N],nR=[bt.NW,bt.W,bt.S,bt.SE,bt.NE],iR=[bt.NW,bt.SW,bt.S,bt.E,bt.NE],sR=[bt.NW,bt.W,[An,-.16666666666666666],[An,bn],bt.N],oR=[[-.16666666666666666,-.5],[bn,-.5],bt.E,bt.NE,bt.N],aR=[[-.5,bn],[-.5,-.16666666666666666],bt.S,bt.SE,bt.E],cR=[bt.W,bt.SW,bt.S,[bn,An],[-.16666666666666666,An]],lR=[bt.NW,bt.W,[-.16666666666666666,-.5],[bn,-.5],bt.N],uR=[[-.5,bn],[-.5,-.16666666666666666],bt.E,bt.NE,bt.N],fR=[bt.S,bt.SE,bt.E,[bn,An],[-.16666666666666666,An]],hR=[bt.W,bt.SW,bt.S,[An,-.16666666666666666],[An,bn]],dR=[bt.W,bt.SW,bt.SE,bt.E,[bn,An],[-.16666666666666666,An]],AR=[[-.5,bn],[-.5,-.16666666666666666],bt.S,bt.SE,bt.NE,bt.N],pR=[bt.NW,bt.W,[-.16666666666666666,-.5],[bn,-.5],bt.E,bt.NE],gR=[bt.NW,bt.SW,bt.S,[An,-.16666666666666666],[An,bn],bt.N],wd=[bt.W,bt.SW,bt.S,bt.E,bt.NE,bt.N],Cd=[bt.NW,bt.W,bt.S,bt.SE,bt.E,bt.N],cm=[[-.5,bn],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[bn,-.5],bt.E,bt.NE,bt.N],lm=[bt.W,bt.SW,bt.S,[An,-.16666666666666666],[An,bn],[bn,An],[-.16666666666666666,An]],um=[bt.NW,bt.W,[-.16666666666666666,-.5],[bn,-.5],[An,-.16666666666666666],[An,bn],bt.N],fm=[[-.5,bn],[-.5,-.16666666666666666],bt.S,bt.SE,bt.E,[bn,An],[-.16666666666666666,An]],mR=[[-.5,bn],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[bn,-.5],[An,-.16666666666666666],[An,bn],[bn,An],[-.16666666666666666,An]],Kye={0:[],1:[[bt.W,bt.S]],2:[[bt.S,bt.E]],3:[[bt.W,bt.E]],4:[[bt.N,bt.E]],5:{0:[[bt.W,bt.S],[bt.N,bt.E]],1:[[bt.W,bt.N],[bt.S,bt.E]]},6:[[bt.N,bt.S]],7:[[bt.W,bt.N]],8:[[bt.W,bt.N]],9:[[bt.N,bt.S]],10:{0:[[bt.W,bt.N],[bt.S,bt.E]],1:[[bt.W,bt.S],[bt.N,bt.E]]},11:[[bt.N,bt.E]],12:[[bt.W,bt.E]],13:[[bt.S,bt.E]],14:[[bt.W,bt.S]],15:[]};function ar(r){return parseInt(r,4)}const qye={[ar("0000")]:[],[ar("2222")]:[],[ar("2221")]:[pd],[ar("2212")]:[gd],[ar("2122")]:[md],[ar("1222")]:[_d],[ar("0001")]:[pd],[ar("0010")]:[gd],[ar("0100")]:[md],[ar("1000")]:[_d],[ar("2220")]:[yd],[ar("2202")]:[vd],[ar("2022")]:[bd],[ar("0222")]:[xd],[ar("0002")]:[yd],[ar("0020")]:[vd],[ar("0200")]:[bd],[ar("2000")]:[xd],[ar("0011")]:[KP],[ar("0110")]:[qP],[ar("1100")]:[ZP],[ar("1001")]:[YP],[ar("2211")]:[KP],[ar("2112")]:[qP],[ar("1122")]:[ZP],[ar("1221")]:[YP],[ar("2200")]:[QP],[ar("2002")]:[eR],[ar("0022")]:[QP],[ar("0220")]:[eR],[ar("1111")]:[$ye],[ar("1211")]:[tR],[ar("2111")]:[rR],[ar("1112")]:[nR],[ar("1121")]:[iR],[ar("1011")]:[tR],[ar("0111")]:[rR],[ar("1110")]:[nR],[ar("1101")]:[iR],[ar("1200")]:[sR],[ar("0120")]:[oR],[ar("0012")]:[aR],[ar("2001")]:[cR],[ar("1022")]:[sR],[ar("2102")]:[oR],[ar("2210")]:[aR],[ar("0221")]:[cR],[ar("1002")]:[lR],[ar("2100")]:[uR],[ar("0210")]:[fR],[ar("0021")]:[hR],[ar("1220")]:[lR],[ar("0122")]:[uR],[ar("2012")]:[fR],[ar("2201")]:[hR],[ar("0211")]:[dR],[ar("2110")]:[AR],[ar("1102")]:[pR],[ar("1021")]:[gR],[ar("2011")]:[dR],[ar("0112")]:[AR],[ar("1120")]:[pR],[ar("1201")]:[gR],[ar("2101")]:[wd],[ar("0121")]:[wd],[ar("1012")]:[Cd],[ar("1210")]:[Cd],[ar("0101")]:{0:[pd,md],1:[wd],2:[wd]},[ar("1010")]:{0:[_d,gd],1:[Cd],2:[Cd]},[ar("2121")]:{0:[wd],1:[wd],2:[pd,md]},[ar("1212")]:{0:[Cd],1:[Cd],2:[_d,gd]},[ar("2120")]:{0:[cm],1:[cm],2:[yd,md]},[ar("2021")]:{0:[lm],1:[lm],2:[pd,bd]},[ar("1202")]:{0:[um],1:[um],2:[_d,vd]},[ar("0212")]:{0:[fm],1:[fm],2:[gd,xd]},[ar("0102")]:{0:[yd,md],1:[cm],2:[cm]},[ar("0201")]:{0:[pd,bd],1:[lm],2:[lm]},[ar("1020")]:{0:[_d,vd],1:[um],2:[um]},[ar("2010")]:{0:[gd,xd],1:[fm],2:[fm]},[ar("2020")]:{0:[xd,vd],1:[mR],2:[yd,bd]},[ar("0202")]:{0:[bd,yd],1:[mR],2:[xd,vd]}},eA={ISO_LINES:1,ISO_BANDS:2},Zye={zIndex:0,zOffset:.005};function bp(r,e){return Array.isArray(e)?r<e[0]?0:r<e[1]?1:2:r>=e?1:0}function Yye(r){const{cellWeights:e,x:t,y:n,width:i,height:o}=r;let s=r.threshold;r.thresholdValue&&(Ur.deprecated("thresholdValue","threshold")(),s=r.thresholdValue);const c=t<0,f=t>=i-1,g=n<0,b=n>=o-1,T=c||f||g||b,S={},F={};c||b?F.top=0:(S.top=e[(n+1)*i+t],F.top=bp(S.top,s)),f||b?F.topRight=0:(S.topRight=e[(n+1)*i+t+1],F.topRight=bp(S.topRight,s)),f||g?F.right=0:(S.right=e[n*i+t+1],F.right=bp(S.right,s)),c||g?F.current=0:(S.current=e[n*i+t],F.current=bp(S.current,s));const{top:k,topRight:U,right:j,current:z}=F;let V=-1;Number.isFinite(s)&&(V=k<<3|U<<2|j<<1|z),Array.isArray(s)&&(V=k<<6|U<<4|j<<2|z);let K=0;return T||(K=bp((S.top+S.topRight+S.right+S.current)/4,s)),{code:V,meanCode:K}}function _R(r){const{gridOrigin:e,cellSize:t,x:n,y:i,code:o,meanCode:s,type:c=eA.ISO_LINES}=r,f={...Zye,...r.thresholdData};let g=c===eA.ISO_BANDS?qye[o]:Kye[o];Array.isArray(g)||(g=g[s]);const b=f.zIndex*f.zOffset,T=(n+1)*t[0],S=(i+1)*t[1],F=e[0]+T,k=e[1]+S;if(c===eA.ISO_BANDS){const j=[];return g.forEach(z=>{const V=[];z.forEach(K=>{const fe=F+K[0]*t[0],Q=k+K[1]*t[1];V.push([fe,Q,b])}),j.push(V)}),j}const U=[];return g.forEach(j=>{j.forEach(z=>{const V=F+z[0]*t[0],K=k+z[1]*t[1];U.push([V,K,b])})}),U}function Qye({thresholdData:r,cellWeights:e,gridSize:t,gridOrigin:n,cellSize:i}){const o=[],s=[],c=t[0],f=t[1];let g=0,b=0;for(const T of r){const{contour:S}=T,{threshold:F}=S;for(let k=-1;k<c;k++)for(let U=-1;U<f;U++){const{code:j,meanCode:z}=Yye({cellWeights:e,threshold:F,x:k,y:U,width:c,height:f}),V={type:eA.ISO_BANDS,gridOrigin:n,cellSize:i,x:k,y:U,code:j,meanCode:z,thresholdData:T};if(Array.isArray(F)){V.type=eA.ISO_BANDS;const K=_R(V);for(const fe of K)s[b++]={vertices:fe,contour:S}}else{V.type=eA.ISO_LINES;const K=_R(V);for(let fe=0;fe<K.length;fe+=2)o[g++]={start:K[fe],end:K[fe+1],contour:S}}}}return{contourSegments:o,contourPolygons:s}}const yR=[255,255,255,255],eve=1,tve=1,rve={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:r=>r.position},getWeight:{type:"accessor",value:1},gpuAggregation:!1,aggregation:"SUM",contours:{type:"object",value:[{threshold:tve}],optional:!0,compare:3},zOffset:.005},vR="positions",nve={data:{props:["cellSize"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class GC extends Ly{initializeState(){super.initializeAggregationLayer({dimensions:nve}),this.setState({contourData:{},projectPoints:!1,weights:{count:{size:1,operation:Xi.SUM}}}),this.getAttributeManager().add({[vR]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}updateState(e){super.updateState(e);let t=!1;const{oldProps:n,props:i}=e,{aggregationDirty:o}=this.state;(n.contours!==i.contours||n.zOffset!==i.zOffset)&&(t=!0,this._updateThresholdData(e.props)),this.getNumInstances()>0&&(o||t)&&this._generateContours()}renderLayers(){const{contourSegments:e,contourPolygons:t}=this.state.contourData,n=this.getSubLayerClass("lines",xg),i=this.getSubLayerClass("bands",Zu),o=e&&e.length>0&&new n(this.getSubLayerProps({id:"lines"}),{data:this.state.contourData.contourSegments,getSourcePosition:c=>c.start,getTargetPosition:c=>c.end,getColor:c=>c.contour.color||yR,getWidth:c=>c.contour.strokeWidth||eve}),s=t&&t.length>0&&new i(this.getSubLayerProps({id:"bands"}),{data:this.state.contourData.contourPolygons,getPolygon:c=>c.vertices,getFillColor:c=>c.contour.color||yR});return[o,s]}updateAggregationState(e){const{props:t,oldProps:n}=e,{cellSize:i,coordinateSystem:o}=t,{viewport:s}=this.context,c=n.cellSize!==i;let f=t.gpuAggregation;this.state.gpuAggregation!==t.gpuAggregation&&f&&!qc.isSupported(this.context.device)&&(Ur.warn("GPU Grid Aggregation not supported, falling back to CPU")(),f=!1);const g=f!==this.state.gpuAggregation;this.setState({gpuAggregation:f});const{dimensions:b}=this.state,T=this.isAttributeChanged(vR),{data:S,weights:F}=b;let{boundingBox:k}=this.state;if(T&&(k=m8(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:k})),T||c){const{gridOffset:z,translation:V,width:K,height:fe,numCol:Q,numRow:oe}=y8(k,i,s,o);this.allocateResources(oe,Q),this.setState({gridOffset:z,boundingBox:k,translation:V,posOffset:V.slice(),gridOrigin:[-1*V[0],-1*V[1]],width:K,height:fe,numCol:Q,numRow:oe})}const U=T||g||this.isAggregationDirty(e,{dimension:S,compareAll:f}),j=this.isAggregationDirty(e,{dimension:F});j&&this._updateAccessors(e),(U||j)&&this._resetResults(),this.setState({aggregationDataDirty:U,aggregationWeightsDirty:j})}_updateAccessors(e){const{getWeight:t,aggregation:n,data:i}=e.props,{count:o}=this.state.weights;o&&(o.getWeight=t,o.operation=Xi[n]),this.setState({getValue:OC(n,t,{data:i})})}_resetResults(){const{count:e}=this.state.weights;e&&(e.aggregationData=null)}_generateContours(){const{numCol:e,numRow:t,gridOrigin:n,gridOffset:i,thresholdData:o}=this.state,{count:s}=this.state.weights;let{aggregationData:c}=s;c||(c=s.aggregationBuffer.readSyncWebGL(),s.aggregationData=c);const{cellWeights:f}=qc.getCellData({countsData:c}),g=Qye({thresholdData:o,cellWeights:f,gridSize:[e,t],gridOrigin:n,cellSize:[i.xOffset,i.yOffset]});this.setState({contourData:g})}_updateThresholdData(e){const{contours:t,zOffset:n}=e,i=t.length,o=new Array(i);for(let s=0;s<i;s++){const c=t[s];o[s]={contour:c,zIndex:c.zIndex||s,zOffset:n}}this.setState({thresholdData:o})}}GC.layerName="ContourLayer";GC.defaultProps=rve;const ive=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-vertex-shader
#define RANGE_COUNT 6
in vec3 positions;
in vec3 normals;
in vec4 colors;
in vec4 elevations;
in vec3 instancePickingColors;
uniform vec2 offset;
uniform bool extruded;
uniform float cellSize;
uniform float coverage;
uniform float opacity;
uniform float elevationScale;
uniform ivec2 gridSize;
uniform vec2 gridOrigin;
uniform vec2 gridOriginLow;
uniform vec2 gridOffset;
uniform vec2 gridOffsetLow;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 elevationRange;
uniform vec2 colorDomain;
uniform bool colorDomainValid;
uniform vec2 elevationDomain;
uniform bool elevationDomainValid;
layout(std140) uniform;
uniform ColorData
{
vec4 maxMinCount;
} colorData;
uniform ElevationData
{
vec4 maxMinCount;
} elevationData;
#define EPSILON 0.00001
out vec4 vColor;
vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
vec4 outColor = vec4(0., 0., 0., 0.);
if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
float domainRange = domain.y - domain.x;
if (domainRange <= 0.) {
outColor = colorRange[0];
} else {
float rangeCount = float(RANGE_COUNT);
float rangeStep = domainRange / rangeCount;
float idx = floor((value - domain.x) / rangeStep);
idx = clamp(idx, 0., rangeCount - 1.);
int intIdx = int(idx);
outColor = colorRange[intIdx];
}
}
return outColor;
}
float linearScale(vec2 domain, vec2 range, float value) {
if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;
}
return -1.;
}
void main(void) {
vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);
vec4 color = quantizeScale(clrDomain, colorRange, colors.r);
float elevation = 0.0;
if (extruded) {
vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);
elevation = linearScale(elvDomain, elevationRange, elevations.r);
elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;
}
float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);
float dotRadius = cellSize / 2. * coverage * shouldRender;
int yIndex = (gl_InstanceID / gridSize[0]);
int xIndex = gl_InstanceID - (yIndex * gridSize[0]);
vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));
instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));
vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));
instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));
vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);
vec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);
geometry.worldPosition = centroidPosition;
vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);
picking_setPickingColor(instancePickingColors);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
vec3 normals_commonspace = project_normal(normals);
if (extruded) {
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, normals_commonspace);
vColor = vec4(lightColor, color.a * opacity) / 255.;
} else {
vColor = vec4(color.rgb, color.a * opacity) / 255.;
}
}
`,sve=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
fragColor = picking_filterColor(fragColor);
}
`,yb=0,vb=1,ove={colorDomain:null,colorRange:BA,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",value:[1,1]},gridOrigin:{type:"array",value:[0,0]},gridOffset:{type:"array",value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0};class VC extends cs{getShaders(){return super.getShaders({vs:ive,fs:sve,modules:[_o,W_,Fo,J_]})}initializeState(){this.getAttributeManager().addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});const t=this._getModel();this._setupUniformBuffer(t),this.setState({model:t})}_getModel(){return new mi(this.context.device,{...this.getShaders(),id:this.props.id,geometry:new BD,isInstanced:!0})}draw({uniforms:e}){const{cellSize:t,offset:n,extruded:i,elevationScale:o,coverage:s,gridSize:c,gridOrigin:f,gridOffset:g,elevationRange:b,colorMaxMinBuffer:T,elevationMaxMinBuffer:S}=this.props,F=this.state.model,k=[Ep(f[0]),Ep(f[1])],U=[Ep(g[0]),Ep(g[1])],j=this.getDomainUniforms(),z=Fy(this.props.colorRange);this.bindUniformBuffers(T,S),F.setUniforms(e),F.setUniforms(j),F.setUniforms({cellSize:t,offset:n,extruded:i,elevationScale:o,coverage:s,gridSize:c,gridOrigin:f,gridOriginLow:k,gridOffset:g,gridOffsetLow:U,colorRange:z,elevationRange:b}),F.draw(this.context.renderPass),this.unbindUniformBuffers(T,S)}bindUniformBuffers(e,t){e.bind({target:35345,index:yb}),t.bind({target:35345,index:vb})}unbindUniformBuffers(e,t){e.unbind({target:35345,index:yb}),t.unbind({target:35345,index:vb})}getDomainUniforms(){const{colorDomain:e,elevationDomain:t}=this.props,n={};return e!==null?(n.colorDomainValid=!0,n.colorDomain=e):n.colorDomainValid=!1,t!==null?(n.elevationDomainValid=!0,n.elevationDomain=t):n.elevationDomainValid=!1,n}_setupUniformBuffer(e){const t=e.pipeline.handle,n=this.context.gl,i=n.getUniformBlockIndex(t,"ColorData"),o=n.getUniformBlockIndex(t,"ElevationData");n.uniformBlockBinding(t,i,yb),n.uniformBlockBinding(t,o,vb)}}VC.layerName="GPUGridCellLayer";VC.defaultProps=ove;const ave={colorDomain:null,colorRange:BA,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:r=>r.position},extruded:!1,material:!0},cve={data:{props:["cellSize","colorAggregation","elevationAggregation"]}},bR="positions";class Fg extends Ly{initializeState({device:e}){const t=qc.isSupported(e);t||Ur.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),super.initializeAggregationLayer({dimensions:cve}),this.setState({gpuAggregation:!1,projectPoints:!1,isSupported:t,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:e.createBuffer({byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:e.createBuffer({byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"}),this.getAttributeManager().add({[bR]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},color:{size:3,accessor:"getColorWeight"},elevation:{size:3,accessor:"getElevationWeight"}})}updateState(e){if(this.state.isSupported===!1)return;super.updateState(e);const{aggregationDirty:t}=this.state;t&&this.setState({gridHash:null})}getHashKeyForIndex(e){const{numRow:t,numCol:n,boundingBox:i,gridOffset:o}=this.state,s=[n,t],c=[i.xMin,i.yMin],f=[o.xOffset,o.yOffset],g=Math.floor(e/s[0]),b=e-g*s[0],T=Math.floor((g*f[1]+c[1]+90+f[1]/2)/f[1]),S=Math.floor((b*f[0]+c[0]+180+f[0]/2)/f[0]);return`${T}-${S}`}getPositionForIndex(e){const{numRow:t,numCol:n,boundingBox:i,gridOffset:o}=this.state,s=[n,t],c=[i.xMin,i.yMin],f=[o.xOffset,o.yOffset],g=Math.floor(e/s[0]),b=e-g*s[0],T=g*f[1]+c[1];return[b*f[0]+c[0],T]}getPickingInfo({info:e,mode:t}){const{index:n}=e;let i=null;if(n>=0){const o=this.state.gpuGridAggregator,s=this.getPositionForIndex(n),c=qc.getAggregationData({pixelIndex:n,...o.getData("color")}),f=qc.getAggregationData({pixelIndex:n,...o.getData("elevation")});if(i={colorValue:c.cellWeight,elevationValue:f.cellWeight,count:c.cellCount||f.cellCount,position:s,totalCount:c.totalCount||f.totalCount},t!=="hover"){const{props:g}=this;let{gridHash:b}=this.state;if(!b){const{gridOffset:F,translation:k,boundingBox:U}=this.state,{viewport:j}=this.context,z=this.getAttributes();b=NC(g,{gridOffset:F,attributes:z,viewport:j,boundingBox:U}).gridHash,this.setState({gridHash:b})}const T=this.getHashKeyForIndex(n),S=b[T];Object.assign(i,S)}}return e.picked=!!i,e.object=i,e}renderLayers(){if(!this.state.isSupported)return null;const{elevationScale:e,extruded:t,cellSize:n,coverage:i,material:o,elevationRange:s,colorDomain:c,elevationDomain:f}=this.props,{weights:g,numRow:b,numCol:T,gridOrigin:S,gridOffset:F}=this.state,{color:k,elevation:U}=g,j=Fy(this.props.colorRange),z=this.getSubLayerClass("gpu-grid-cell",VC);return new z({gridSize:[T,b],gridOrigin:S,gridOffset:[F.xOffset,F.yOffset],colorRange:j,elevationRange:s,colorDomain:c,elevationDomain:f,cellSize:n,coverage:i,material:o,elevationScale:e,extruded:t},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:k.aggregationBuffer,elevations:U.aggregationBuffer}},colorMaxMinBuffer:k.maxMinBuffer,elevationMaxMinBuffer:U.maxMinBuffer,numInstances:T*b})}finalizeState(e){const{color:t,elevation:n}=this.state.weights;[t,n].forEach(i=>{const{aggregationBuffer:o,maxMinBuffer:s}=i;s==null||s.destroy(),o==null||o.destroy()}),super.finalizeState(e)}updateAggregationState(e){const{props:t,oldProps:n}=e,{cellSize:i,coordinateSystem:o}=t,{viewport:s}=this.context,c=n.cellSize!==i,{dimensions:f}=this.state,g=this.isAttributeChanged(bR),b=g||this.isAttributeChanged();let{boundingBox:T}=this.state;if(g&&(T=m8(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:T})),g||c){const{gridOffset:F,translation:k,width:U,height:j,numCol:z,numRow:V}=y8(T,i,s,o);this.allocateResources(V,z),this.setState({gridOffset:F,translation:k,gridOrigin:[-1*k[0],-1*k[1]],width:U,height:j,numCol:z,numRow:V})}const S=b||this.isAggregationDirty(e,{dimension:f.data,compareAll:!0});S&&this._updateAccessors(e),this.setState({aggregationDataDirty:S})}_updateAccessors(e){const{colorAggregation:t,elevationAggregation:n}=e.props,{color:i,elevation:o}=this.state.weights;i.operation=Xi[t],o.operation=Xi[n]}}Fg.layerName="GPUGridLayer";Fg.defaultProps=ave;const lve={...Fg.defaultProps,...Rg.defaultProps,gpuAggregation:!1};class HC extends gs{initializeState(){this.state={useGPUAggregation:!1}}updateState({props:e}){this.setState({useGPUAggregation:!1})}renderLayers(){const{data:e,updateTriggers:t}=this.props,n=this.state.useGPUAggregation?"GPU":"CPU",i=this.state.useGPUAggregation?this.getSubLayerClass("GPU",Fg):this.getSubLayerClass("CPU",Rg);return new i(this.props,this.getSubLayerProps({id:n,updateTriggers:t}),{data:e})}canUseGPUAggregation(e){const{gpuAggregation:t,lowerPercentile:n,upperPercentile:i,getColorValue:o,getElevationValue:s,colorScaleType:c}=e;return!(!t||!qc.isSupported(this.context.device)||n!==0||i!==100||o!==null||s!==null||c==="quantile"||c==="ordinal")}}HC.layerName="GridLayer";HC.defaultProps=lve;function uve(r){const e=r.map(c=>c[0]),t=r.map(c=>c[1]),n=Math.min.apply(null,e),i=Math.max.apply(null,e),o=Math.min.apply(null,t),s=Math.max.apply(null,t);return[n,o,i,s]}function fve(r,e){return e[0]>=r[0]&&e[2]<=r[2]&&e[1]>=r[1]&&e[3]<=r[3]}const xR=new Float32Array(12);function wR(r,e=2){let t=0;for(const n of r)for(let i=0;i<e;i++)xR[t++]=n[i]||0;return xR}function hve(r,e,t){const[n,i,o,s]=r,c=o-n,f=s-i;let g=c,b=f;c/f<e/t?g=e/t*f:b=t/e*c,g<e&&(g=e,b=t);const T=(o+n)/2,S=(s+i)/2;return[T-g/2,S-b/2,T+g/2,S+b/2]}function dve(r,e){const[t,n,i,o]=e;return[(r[0]-t)/(i-t),(r[1]-n)/(o-n)]}const Ave=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
uniform float intensity;
uniform vec2 colorDomain;
uniform float threshold;
uniform float aggregationMode;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * threshold;
if (colorDomain[1] > 0.) {
maxValue = colorDomain[1];
minValue = colorDomain[0];
}
vIntensityMax = intensity / maxValue;
vIntensityMin = intensity / minValue;
}
`,pve=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
uniform float aggregationMode;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= opacity;
fragColor = linearColor;
}
`;class v8 extends cs{getShaders(){return{vs:Ave,fs:pve,modules:[_o]}}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:n,weightsTexture:i,maxTexture:o,colorTexture:s}=this.props;return new mi(e,{...this.getShaders(),id:this.props.id,bindings:{weightsTexture:i,maxTexture:o,colorTexture:s},attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-fan-webgl",vertexCount:t})}draw({uniforms:e}){const{model:t}=this.state,{intensity:n,threshold:i,aggregationMode:o,colorDomain:s}=this.props;t.setUniforms({...e,intensity:n,threshold:i,aggregationMode:o,colorDomain:s}),t.draw(this.context.renderPass)}}v8.layerName="TriangleLayer";const CR=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
uniform float radiusPixels;
uniform float textureWidth;
uniform vec4 commonBounds;
uniform float weightsScale;
void main()
{
weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,ER=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,gve=`#version 300 es
uniform sampler2D inTexture;
uniform float textureSize;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(textureSize);
int xIndex = gl_VertexID - (yIndex * int(textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,mve=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,_ve=2,bb={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},TR=[0,0],yve={SUM:0,MEAN:1},vve={getPosition:{type:"accessor",value:r=>r.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:BA,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},bve=["float32-renderable-webgl","texture-blend-float-webgl"],xve={data:{props:["radiusPixels"]}};class jC extends SA{initializeState(){super.initializeAggregationLayer(xve),this.setState({colorDomain:TR}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:n}=e,i=this._getChangeFlags(e);(i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):i.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==n.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:o,colorDomain:s}=this.state,{updateTriggers:c,intensity:f,threshold:g,aggregation:b}=this.props,T=this.getSubLayerClass("triangle",v8);return new T(this.getSubLayerProps({id:"triangle-layer",updateTriggers:c}),{coordinateSystem:Wr.DEFAULT,data:{attributes:{positions:t,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:o,aggregationMode:yve[b]||0,weightsTexture:e,intensity:f,threshold:g,colorDomain:s})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:n,maxWeightTransform:i,maxWeightsTexture:o,triPositionBuffer:s,triTexCoordBuffer:c,colorTexture:f,updateTimer:g}=this.state;t==null||t.destroy(),n==null||n.destroy(),i==null||i.destroy(),o==null||o.destroy(),s==null||s.destroy(),c==null||c.destroy(),f==null||f.destroy(),g&&clearTimeout(g)}_getAttributeManager(){return new Wx(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:n}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:i}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==i)&&(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...bb,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...bb,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,n=Math.min(t,e.limits.maxTextureDimension2D),i=bve.every(c=>e.features.has(c)),o=i?"rgba32float":"rgba8unorm",s=i?1:1/255;this.setState({textureSize:n,format:o,weightsScale:s}),i||Ur.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:n}=this.state,i=this.getAttributeManager();t==null||t.destroy(),t=new e2(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:i.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:n,maxWeightsTexture:i}=this.state,o=this.getShaders({vs:CR,fs:ER});this._createWeightsTransform(o);const s=this.getShaders({vs:gve,fs:mve}),c=new e2(e,{id:`${this.id}-max-weights-transform`,bindings:{inTexture:n},uniforms:{textureSize:t},targetTexture:i,...s,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}});this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:c,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:CR,fs:ER,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,n=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([t.width,t.height]),t.unproject([0,t.height])].map(c=>c.map(Math.fround)),i=uve(n),o={visibleWorldBounds:i,viewportCorners:n};let s=!1;if(e||!this.state.worldBounds||!fve(this.state.worldBounds,i)){const c=this._worldToCommonBounds(i),f=this._commonToWorldBounds(c);this.props.coordinateSystem===Wr.LNGLAT&&(f[1]=Math.max(f[1],-85.051129),f[3]=Math.min(f[3],85.051129),f[0]=Math.max(f[0],-360),f[2]=Math.min(f[2],360));const g=this._worldToCommonBounds(f);o.worldBounds=f,o.normalizedCommonBounds=g,s=!0}return this.setState(o),s}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:o}=this.context;e.write(wR(i,3));const s=i.map(c=>dve(o.projectPosition(c),n));t.write(wR(s,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:n}=this.state;const i=Fy(t,!1,Uint8Array);n&&(n==null?void 0:n.width)===t.length?n.setSubImageData({data:i}):(n==null||n.destroy(),n=this.context.device.createTexture({...bb,data:i,width:t.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:n}=this.props,{worldBounds:i,textureSize:o,weightsScale:s}=this.state,c=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const f=this._worldToCommonBounds(i,{useLayerCoordinateSystem:!0});if(t&&n==="SUM"){const{viewport:F}=this.context,k=F.distanceScales.metersPerUnit[2]*(f[2]-f[0])/o;this.state.colorDomain=t.map(U=>U*k*s)}else this.state.colorDomain=t||TR;const b=this.getAttributeManager().getAttributes(),T=this.getModuleSettings(),S={radiusPixels:e,commonBounds:f,textureWidth:o,weightsScale:s};this._setModelAttributes(c.model,b),c.model.setVertexCount(this.getNumInstances()),c.model.setUniforms(S),c.model.updateModuleSettings(T),c.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:n}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:n=!1}=t,[i,o,s,c]=e,{viewport:f}=this.context,{textureSize:g}=this.state,{coordinateSystem:b}=this.props,T=n&&(b===Wr.LNGLAT_OFFSETS||b===Wr.METER_OFFSETS),S=T?f.projectPosition(this.props.coordinateOrigin):[0,0],F=g*_ve/f.scale;let k,U;return n&&!T?(k=this.projectPosition([i,o,0]),U=this.projectPosition([s,c,0])):(k=f.projectPosition([i,o,0]),U=f.projectPosition([s,c,0])),hve([k[0]-S[0],k[1]-S[1],U[0]-S[0],U[1]-S[1]],F,F)}_commonToWorldBounds(e){const[t,n,i,o]=e,{viewport:s}=this.context,c=s.unprojectPosition([t,n]),f=s.unprojectPosition([i,o]);return c.slice(0,2).concat(f.slice(0,2))}}jC.layerName="HeatmapLayer";jC.defaultProps=vve;const wve=Object.freeze(Object.defineProperty({__proto__:null,AGGREGATION_OPERATION:Xi,CPUGridLayer:Rg,ContourLayer:GC,GPUGridLayer:Fg,GridLayer:HC,HeatmapLayer:jC,HexagonLayer:zC,ScreenGridLayer:kC,_AggregationLayer:SA,_BinSorter:LC,_CPUAggregator:UC,_GPUGridAggregator:qc},Symbol.toStringTag,{value:"Module"})),Cve={ClusterTileLayer:bC,H3TileLayer:wC,HeatmapTileLayer:EC,PointLabelLayer:TC,QuadbinTileLayer:Ry,RasterTileLayer:SC,VectorTileLayer:MC};function ax(r,e=""){if(!r)throw new Error(`JSON conversion error ${e}`)}function Eve(r,e){const t=Bve(e);let n=r;for(const i of t)n=Tve(n)?n[i]:void 0;return n}function Tve(r){return r!==null&&typeof r=="object"}const BR={};function Bve(r){if(typeof r=="string"){let e=BR[r];return e||(e=r.split("."),BR[r]=e),e}return Array.isArray(r)?r:[r]}var hm={exports:{}},SR;function Sve(){return SR||(SR=1,function(r,e){(function(t){var n="Compound",i="Identifier",o="MemberExpression",s="Literal",c="ThisExpression",f="CallExpression",g="UnaryExpression",b="BinaryExpression",T="LogicalExpression",S="ConditionalExpression",F="ArrayExpression",k=46,U=44,j=39,z=34,V=40,K=41,fe=91,Q=93,oe=63,Te=59,ze=58,Ae=function(Tt,nt){var cr=new Error(Tt+" at character "+nt);throw cr.index=nt,cr.description=Tt,cr},_e=!0,pe={"-":_e,"!":_e,"~":_e,"+":_e},X={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},ne=function(Tt){var nt=0,cr;for(var $t in Tt)(cr=$t.length)>nt&&Tt.hasOwnProperty($t)&&(nt=cr);return nt},Be=ne(pe),Ze=ne(X),Ce={true:!0,false:!1,null:null},Ne="this",Ge=function(Tt){return X[Tt]||0},Qe=function(Tt,nt,cr){var $t=Tt==="||"||Tt==="&&"?T:b;return{type:$t,operator:Tt,left:nt,right:cr}},rt=function(Tt){return Tt>=48&&Tt<=57},tt=function(Tt){return Tt===36||Tt===95||Tt>=65&&Tt<=90||Tt>=97&&Tt<=122||Tt>=128&&!X[String.fromCharCode(Tt)]},lt=function(Tt){return Tt===36||Tt===95||Tt>=65&&Tt<=90||Tt>=97&&Tt<=122||Tt>=48&&Tt<=57||Tt>=128&&!X[String.fromCharCode(Tt)]},mt=function(Tt){for(var nt=0,cr=Tt.charAt,$t=Tt.charCodeAt,Jt=function(Ut){return cr.call(Tt,Ut)},Lt=function(Ut){return $t.call(Tt,Ut)},lr=Tt.length,tn=function(){for(var Ut=Lt(nt);Ut===32||Ut===9||Ut===10||Ut===13;)Ut=Lt(++nt)},Er=function(){var Ut=In(),dr,Tr;if(tn(),Lt(nt)===oe){if(nt++,dr=Er(),dr||Ae("Expected expression",nt),tn(),Lt(nt)===ze)return nt++,Tr=Er(),Tr||Ae("Expected expression",nt),{type:S,test:Ut,consequent:dr,alternate:Tr};Ae("Expected :",nt)}else return Ut},Ar=function(){tn();for(var Ut=Tt.substr(nt,Ze),dr=Ut.length;dr>0;){if(X.hasOwnProperty(Ut)&&(!tt(Lt(nt))||nt+Ut.length<Tt.length&&!lt(Lt(nt+Ut.length))))return nt+=dr,Ut;Ut=Ut.substr(0,--dr)}return!1},In=function(){var Ut,dr,Tr,Zr,fi,Pe,Ot,Vt,sr;if(Pe=hr(),dr=Ar(),!dr)return Pe;for(fi={value:dr,prec:Ge(dr)},Ot=hr(),Ot||Ae("Expected expression after "+dr,nt),Zr=[Pe,fi,Ot];(dr=Ar())&&(Tr=Ge(dr),Tr!==0);){for(fi={value:dr,prec:Tr},sr=dr;Zr.length>2&&Tr<=Zr[Zr.length-2].prec;)Ot=Zr.pop(),dr=Zr.pop().value,Pe=Zr.pop(),Ut=Qe(dr,Pe,Ot),Zr.push(Ut);Ut=hr(),Ut||Ae("Expected expression after "+sr,nt),Zr.push(fi,Ut)}for(Vt=Zr.length-1,Ut=Zr[Vt];Vt>1;)Ut=Qe(Zr[Vt-1].value,Zr[Vt-2],Ut),Vt-=2;return Ut},hr=function(){var Ut,dr,Tr;if(tn(),Ut=Lt(nt),rt(Ut)||Ut===k)return pr();if(Ut===j||Ut===z)return rn();if(Ut===fe)return Kn();for(dr=Tt.substr(nt,Be),Tr=dr.length;Tr>0;){if(pe.hasOwnProperty(dr)&&(!tt(Lt(nt))||nt+dr.length<Tt.length&&!lt(Lt(nt+dr.length))))return nt+=Tr,{type:g,operator:dr,argument:hr(),prefix:!0};dr=dr.substr(0,--Tr)}return tt(Ut)||Ut===V?Jn():!1},pr=function(){for(var Ut="",dr,Tr;rt(Lt(nt));)Ut+=Jt(nt++);if(Lt(nt)===k)for(Ut+=Jt(nt++);rt(Lt(nt));)Ut+=Jt(nt++);if(dr=Jt(nt),dr==="e"||dr==="E"){for(Ut+=Jt(nt++),dr=Jt(nt),(dr==="+"||dr==="-")&&(Ut+=Jt(nt++));rt(Lt(nt));)Ut+=Jt(nt++);rt(Lt(nt-1))||Ae("Expected exponent ("+Ut+Jt(nt)+")",nt)}return Tr=Lt(nt),tt(Tr)?Ae("Variable names cannot start with a number ("+Ut+Jt(nt)+")",nt):Tr===k&&Ae("Unexpected period",nt),{type:s,value:parseFloat(Ut),raw:Ut}},rn=function(){for(var Ut="",dr=Jt(nt++),Tr=!1,Zr;nt<lr;)if(Zr=Jt(nt++),Zr===dr){Tr=!0;break}else if(Zr==="\\")switch(Zr=Jt(nt++),Zr){case"n":Ut+=`
`;break;case"r":Ut+="\r";break;case"t":Ut+="	";break;case"b":Ut+="\b";break;case"f":Ut+="\f";break;case"v":Ut+="\v";break;default:Ut+=Zr}else Ut+=Zr;return Tr||Ae('Unclosed quote after "'+Ut+'"',nt),{type:s,value:Ut,raw:dr+Ut+dr}},Sr=function(){var Ut=Lt(nt),dr=nt,Tr;for(tt(Ut)?nt++:Ae("Unexpected "+Jt(nt),nt);nt<lr&&(Ut=Lt(nt),lt(Ut));)nt++;return Tr=Tt.slice(dr,nt),Ce.hasOwnProperty(Tr)?{type:s,value:Ce[Tr],raw:Tr}:Tr===Ne?{type:c}:{type:i,name:Tr}},ti=function(Ut){for(var dr,Tr=[],Zr,fi=!1,Pe=0;nt<lr;)if(tn(),dr=Lt(nt),dr===Ut){fi=!0,nt++,Ut===K&&Pe&&Pe>=Tr.length&&Ae("Unexpected token "+String.fromCharCode(Ut),nt);break}else if(dr===U){if(nt++,Pe++,Pe!==Tr.length){if(Ut===K)Ae("Unexpected token ,",nt);else if(Ut===Q)for(var Ot=Tr.length;Ot<Pe;Ot++)Tr.push(null)}}else Zr=Er(),(!Zr||Zr.type===n)&&Ae("Expected comma",nt),Tr.push(Zr);return fi||Ae("Expected "+String.fromCharCode(Ut),nt),Tr},Jn=function(){var Ut,dr;for(Ut=Lt(nt),Ut===V?dr=un():dr=Sr(),tn(),Ut=Lt(nt);Ut===k||Ut===fe||Ut===V;)nt++,Ut===k?(tn(),dr={type:o,computed:!1,object:dr,property:Sr()}):Ut===fe?(dr={type:o,computed:!0,object:dr,property:Er()},tn(),Ut=Lt(nt),Ut!==Q&&Ae("Unclosed [",nt),nt++):Ut===V&&(dr={type:f,arguments:ti(K),callee:dr}),tn(),Ut=Lt(nt);return dr},un=function(){nt++;var Ut=Er();if(tn(),Lt(nt)===K)return nt++,Ut;Ae("Unclosed (",nt)},Kn=function(){return nt++,{type:F,elements:ti(Q)}},Nn=[],vn,Wn;nt<lr;)vn=Lt(nt),vn===Te||vn===U?nt++:(Wn=Er())?Nn.push(Wn):nt<lr&&Ae('Unexpected "'+Jt(nt)+'"',nt);return Nn.length===1?Nn[0]:{type:n,body:Nn}};mt.version="0.3.5",mt.toString=function(){return"JavaScript Expression Parser (JSEP) v"+mt.version},mt.addUnaryOp=function(Tt){return Be=Math.max(Tt.length,Be),pe[Tt]=_e,this},mt.addBinaryOp=function(Tt,nt){return Ze=Math.max(Tt.length,Ze),X[Tt]=nt,this},mt.addLiteral=function(Tt,nt){return Ce[Tt]=nt,this},mt.removeUnaryOp=function(Tt){return delete pe[Tt],Tt.length===Be&&(Be=ne(pe)),this},mt.removeAllUnaryOps=function(){return pe={},Be=0,this},mt.removeBinaryOp=function(Tt){return delete X[Tt],Tt.length===Ze&&(Ze=ne(X)),this},mt.removeAllBinaryOps=function(){return X={},Ze=0,this},mt.removeLiteral=function(Tt){return delete Ce[Tt],this},mt.removeAllLiterals=function(){return Ce={},this},r.exports?e=r.exports=mt:e.parse=mt})()}(hm,hm.exports)),hm.exports}var Ive=Sve();const Mve=th(Ive),IR={"||":(r,e)=>r||e,"&&":(r,e)=>r&&e,"|":(r,e)=>r|e,"^":(r,e)=>r^e,"&":(r,e)=>r&e,"==":(r,e)=>r==e,"!=":(r,e)=>r!=e,"===":(r,e)=>r===e,"!==":(r,e)=>r!==e,"<":(r,e)=>r<e,">":(r,e)=>r>e,"<=":(r,e)=>r<=e,">=":(r,e)=>r>=e,"<<":(r,e)=>r<<e,">>":(r,e)=>r>>e,">>>":(r,e)=>r>>>e,"+":(r,e)=>r+e,"-":(r,e)=>r-e,"*":(r,e)=>r*e,"/":(r,e)=>r/e,"%":(r,e)=>r%e},Pve={"-":r=>-r,"+":r=>+r,"~":r=>~r,"!":r=>!r};function MR(r,e){return r.map(function(t){return Us(t,e)})}function PR(r,e){const t=Us(r.object,e);let n;if(r.computed?n=Us(r.property,e):n=r.property.name,/^__proto__|prototype|constructor$/.test(n))throw Error(`Access to member "${n}" disallowed.`);return[t,t[n]]}function Us(r,e){const t=r;switch(t.type){case"ArrayExpression":return MR(t.elements,e);case"BinaryExpression":return IR[t.operator](Us(t.left,e),Us(t.right,e));case"CallExpression":let n,i,o;return t.callee.type==="MemberExpression"?(o=PR(t.callee,e),n=o[0],i=o[1]):i=Us(t.callee,e),typeof i!="function"?void 0:i.apply(n,MR(t.arguments,e));case"ConditionalExpression":return Us(t.test,e)?Us(t.consequent,e):Us(t.alternate,e);case"Identifier":return e[t.name];case"Literal":return t.value;case"LogicalExpression":return t.operator==="||"?Us(t.left,e)||Us(t.right,e):t.operator==="&&"?Us(t.left,e)&&Us(t.right,e):IR[t.operator](Us(t.left,e),Us(t.right,e));case"MemberExpression":return PR(t,e)[1];case"ThisExpression":return e;case"UnaryExpression":return Pve[t.operator](Us(t.argument,e));default:return}}const xb={"-":r=>r};function b8(r,e){if(r in xb)return xb[r];let t;const n=Mve(r);return n.type==="Identifier"?t=i=>Eve(i,r):(cx(n,i=>{if(i.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),t=i=>Us(n,i)),xb[r]=t,t}function cx(r,e){if(Array.isArray(r))r.forEach(t=>cx(t,e));else if(r&&typeof r=="object"){r.type&&e(r);for(const t in r)cx(r[t],e)}}const C_="@@=",RR="@@#",Rve="@@type",x8="@@function",FR=r=>r&&typeof r=="object";class lx{constructor(...e){this.typeKey=Rve,this.functionKey=x8,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=b8,this.preProcessClassProps=(t,n)=>n,this.postProcessConvertedJson=t=>t;for(const t of e)this.merge(t)}merge(e){for(const t in e)switch(t){case"layers":case"views":Object.assign(this.classes,e[t]);break;default:if(t in this){const n=e[t];this[t]=FR(this[t])?Object.assign(this[t],n):n}}}validate(e){return ax(!this.typeKey||typeof this.typeKey=="string"),ax(FR(this.classes)),!0}}function Fve(r){return typeof r=="string"&&r.startsWith(C_)}function Dve(r){return r.replace(C_,"")}function w8(r,e){const t={};for(const n in r){let i=r[n];Fve(i)&&(i=Dve(i),i=b8(i)),t[n]=i}return t}function Ove(r,e,t){const n=t.classes[r],i=t.reactComponents[r];if(!n&&!i){const{log:o}=t;if(o){const s=JSON.stringify(e,null,0).slice(0,40);o.warn(`JSON converter: No registered class of type ${r}(${s}...)  `)}return null}return n?Lve(n,e,t):Nve(i,e,t)}function Lve(r,e,t){return t.preProcessClassProps&&(e=t.preProcessClassProps(r,e,t)),e=w8(e),new r(e)}function Nve(r,e,t){const{React:n}=t,{children:i=[]}=e;return delete e.children,t.preProcessClassProps&&(e=t.preProcessClassProps(r,e,t)),e=w8(e),n.createElement(r,e,i)}function kve(r,e,t){const n=t.functions[r];if(!n){const{log:i}=t;if(i){const o=JSON.stringify(e,null,0).slice(0,40);i.warn(`JSON converter: No registered function ${r}(${o}...)  `)}return null}return n(e)}function Uve(r){return typeof r=="string"?JSON.parse(r):r}const JC=r=>r&&typeof r=="object";class zve{constructor(e){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(e)}finalize(){}setProps(e){"configuration"in e&&(this.configuration=e.configuration instanceof lx?e.configuration:new lx(e.configuration)),"onJSONChange"in e&&(this.onJSONChange=e.onJSONChange)}mergeConfiguration(e){this.configuration.merge(e)}convert(e){if(!e||e===this.json)return this.convertedJson;this.json=e;const t=Uve(e);let n=Gve(t,this.configuration);return n=this.configuration.postProcessConvertedJson(n),this.convertedJson=n,n}convertJson(e){return this.convert(e)}}function Gve(r,e){return e=new lx(e),WC(r,"",e)}function WC(r,e,t){return Array.isArray(r)?r.map((n,i)=>WC(n,String(i),t)):Vve(r,t)?Hve(r,t):JC(r)?x8 in r?jve(r,t):XC(r,t):typeof r=="string"?Jve(r,e,t):r}function Vve(r,e){const{typeKey:t}=e;return JC(r)&&!!r[t]}function Hve(r,e){const{typeKey:t}=e,n=r[t];let i={...r};return delete i[t],i=XC(i,e),Ove(n,i,e)}function jve(r,e){const{functionKey:t}=e,n=r[t];let i={...r};return delete i[t],i=XC(i,e),kve(n,i,e)}function XC(r,e){ax(JC(r));const t={};for(const n in r){const i=r[n];t[n]=WC(i,n,e)}return t}function Jve(r,e,t){if(r.startsWith(C_)&&t.convertFunction)return r=r.replace(C_,""),t.convertFunction(r,t);if(r.startsWith(RR)){if(r=r.replace(RR,""),t.constants[r])return t.constants[r];const[n,i]=r.split(".");return t.enumerations[n][i]}return r}const Wve={classes:{...Eie,...wve,...t0e,...nfe,...Cve},functions:{colorBins:P_e,colorCategories:R_e,colorContinuous:F_e}},C8=new zve({configuration:Wve}),Xve={[By.layerName]:["getFillColor"],[gy.layerName]:["getFillColor"],[tl.layerName]:["getFillColor"],[EA.layerName]:["getFillColor"],[uy.layerName]:["getFillColor"],[ly.layerName]:["getFillColor"],[dy.layerName]:["getColor"],[bg.layerName]:["getTargetColor","getSourceColor"],[Jl.layerName]:["getFillColor"],[Wl.layerName]:["getFillColor"],[CA.layerName]:["getColor"],[xg.layerName]:["getColor"],[ch.layerName]:["getColor"],[wg.layerName]:["getColor"],[Yu.layerName]:["getFillColor"],[Cg.layerName]:["getFillColor","getColor","getLineColor"],[Zu.layerName]:["getFillColor"],[lh.layerName]:["getColor"],[Sg.layerName]:["getColor"],[Yf.layerName]:["getColor"]},$ve=({object:r,objectInfo:e,originalFillFunction:t})=>{const n=typeof t=="function"?t(r,e):t;if(Array.isArray(n))return[n[0]||0,n[1]||0,n[2]||0,n[3]||255];if(typeof n=="string"&&n.startsWith("@@=")){const i=C8.convert({originalColor:n}).originalColor(r);return[i[0]||0,i[1]||0,i[2]||0,i[3]||255]}return null},DR=({isSelected:r,object:e,objectInfo:t,opacity:n,originalFillFunction:i})=>{const o=$ve({object:e,objectInfo:t,originalFillFunction:i});if(!o)return null;let s=0;return r?s=Math.max(typeof o[3]=="number"?o[3]:n,n):s=Math.min(typeof o[3]=="number"?o[3]:n,n),[o[0]||0,o[1]||0,o[2]||0,s]},Kve=({isSelected:r,object:e,objectInfo:t,originalFillFunction:n,selectedColor:i,selectedOpacity:o=255,unselectedColor:s,unselectedOpacity:c=Math.floor(255*.4)})=>r?DR({opacity:o,isSelected:!0,object:e,objectInfo:t,originalFillFunction:n})||i:DR({opacity:c,isSelected:!1,object:e,objectInfo:t,originalFillFunction:n})||s,fg={selection:{indices:{},objects:{}}},OR=(r,e)=>{const t=e.match(/{(.*?)}/g);return t&&t.forEach(n=>{const i=n.substring(1,n.length-1);r.object.hasOwnProperty(i)?e=e.replace(n,r.object[i]):r.object.hasOwnProperty("properties")&&r.object.properties.hasOwnProperty(i)&&(e=e.replace(n,r.object.properties[i]))}),e};function qve(r,e){return e.id?r.getElementState(e.id,"selection")??fg:fg}function Zve(r,e){if(!e.id)return fg;const t=r.getStringValue(e);return(t?Eb.parse(t):null)??fg}function Yve(r,e,t,n){r.id&&e.setStringValue(r,JSON.stringify(t.value),{fromUi:t.fromUi},n)}const Qve=r=>{var X;const{height:e,width:t,expanded:n}=GR(VR),{element:i,fragmentId:o,isLightTheme:s,theme:c,widgetMgr:f}=r,{selectionMode:g,tooltip:b,useContainerWidth:T}=i,S=n??!1,[F,k]=mk({element:i,getDefaultState:qve,getStateFromWidgetMgr:Zve,updateWidgetMgrState:Yve,widgetMgr:f,fragmentId:o}),[U,j]=Bt.useState({bearing:0,pitch:0,zoom:11}),{height:z,width:V}=Ere({element:i,isFullScreen:S,shouldUseContainerWidth:T,container:{height:e,width:t},heightFallback:((X=U.initialViewState)==null?void 0:X.height)||c.sizes.defaultMapHeight}),[K,fe]=Bt.useState({}),Q=g[0],oe=Q!==void 0,Te=oe&&Object.keys(F.selection.indices).length>0,ze=Bt.useMemo(()=>Object.freeze(Eb.parse(i.json)),[S,s,i.json]),Ae=Bt.useMemo(()=>{const ne={...ze};if(ne.mapStyle||(ne.mapStyle=`mapbox://styles/mapbox/${s?"light":"dark"}-v9`),ne.layers){const Be=Object.values(F.selection.indices).some(Ce=>Ce==null?void 0:Ce.length),Ze=ne.layers.some(Ce=>Object.hasOwn(Ce,"pickable"));ne.layers=ne.layers.map(Ce=>{var tt,lt;if(!Ce||Array.isArray(Ce)||!oe)return Ce;Ze||(Ce.pickable=!0);const Ne=`${Ce.id||null}`,Ge=((lt=(tt=F==null?void 0:F.selection)==null?void 0:tt.indices)==null?void 0:lt[Ne])||[],Qe=Xve[Ce["@@type"]];if(!Qe)return Ce;const rt={...Ce};return Qe.forEach(mt=>{var Ar;rt.updateTriggers={[mt]:[...((Ar=rt.updateTriggers)==null?void 0:Ar[mt])||[],Ge,Be]};const Tt=!Be,nt=Ce[mt];if(Tt||!nt)return rt;const cr=255,$t=Math.floor(255*.4),Jt=gT(c.colors.primary),Lt=[Jt[0],Jt[1],Jt[2],cr],lr=gT(c.colors.gray20),tn=[lr[0],lr[1],lr[2],$t],Er=(In,hr)=>Kve({isSelected:Ge.includes(hr.index),object:In,objectInfo:hr,originalFillFunction:nt,selectedColor:Lt,unselectedColor:tn,selectedOpacity:cr,unselectedOpacity:$t});rt[mt]=Er}),rt})}return ne==null||delete ne.views,C8.convert(ne)},[F.selection.indices,s,oe,ze,c.colors.gray20,c.colors.primary]);Bt.useEffect(()=>{if(!lk(Ae.initialViewState,K)){const ne=Object.keys(Ae.initialViewState).reduce((Be,Ze)=>Ae.initialViewState[Ze]===K[Ze]?Be:{...Be,[Ze]:Ae.initialViewState[Ze]},{});j({...U,...ne}),fe(Ae.initialViewState)}},[Ae.initialViewState,K,U]);const _e=Bt.useCallback(ne=>{if(!ne||!ne.object||!b)return null;const Be=Eb.parse(b);return Be.html?Be.html=OR(ne,Be.html):Be.text=OR(ne,Be.text),Be},[b]),pe=Bt.useCallback(({viewState:ne})=>{j(ne)},[j]);return{createTooltip:_e,data:F,deck:Ae,hasActiveSelection:Te,height:z,isSelectionModeActivated:oe,onViewStateChange:pe,selectionMode:Q,setSelection:k,viewState:U,width:V}};Ag([uw,F2]);const wb=fg.selection,e1e=[],t1e=r=>{const{disabled:e,disableFullscreenMode:t,element:n,fragmentId:i,mapboxToken:o,widgetMgr:s}=r,{mapboxToken:c}=n,f=uk(),{expanded:g,expand:b,collapse:T}=GR(VR),{createTooltip:S,data:F,deck:k,hasActiveSelection:U,height:j,isSelectionModeActivated:z,onViewStateChange:V,selectionMode:K,setSelection:fe,viewState:Q,width:oe}=Qve({element:n,fragmentId:i,isLightTheme:zR(f),theme:f,widgetMgr:s}),[Te,ze]=Bt.useState(!1);Bt.useEffect(()=>{ze(!0)},[]);const Ae=Bt.useCallback(pe=>{var Qe;if(K===void 0)return;const{index:X,object:ne}=pe,Be=`${((Qe=pe.layer)==null?void 0:Qe.id)||null}`,Ze=F,Ce=X===-1,Ge=(()=>{var rt;if(Ce)return wb;switch(K){case mT.SelectionMode.SINGLE_OBJECT:return((rt=Ze.selection.indices[Be])==null?void 0:rt[0])===X?wb:{indices:{[`${Be}`]:[X]},objects:{[`${Be}`]:[ne]}};case mT.SelectionMode.MULTI_OBJECT:{const tt=new Map((()=>{var mt,Tt;return(((Tt=(mt=Ze==null?void 0:Ze.selection)==null?void 0:mt.indices)==null?void 0:Tt[Be])||[]).map((nt,cr)=>{var $t,Jt,Lt;return[nt,(Lt=(Jt=($t=Ze.selection)==null?void 0:$t.objects)==null?void 0:Jt[Be])==null?void 0:Lt[cr]]})})());if(tt.has(X)?tt.delete(X):tt.set(X,ne),tt.size===0){const{[Be]:lt,...mt}=Ze.selection.indices,{[Be]:Tt,...nt}=Ze.selection.objects;return{indices:mt,objects:nt}}return{indices:{...Ze.selection.indices,[`${Be}`]:Array.from(tt.keys())},objects:{...Ze.selection.objects,[`${Be}`]:Array.from(tt.values())}}}default:throw fk(K),new Error("Invalid selection mode")}})();JSON.stringify(Ge)!==JSON.stringify(Ze.selection)&&fe({fromUi:!0,value:{selection:Ge}})},[K,F,fe]),_e=Bt.useCallback(()=>{fe({value:{selection:wb},fromUi:!0})},[fe]);return Vc(RI,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",height:j,children:[Es(pk,{isFullScreen:g,disableFullscreenMode:t,onExpand:b,onCollapse:T,target:RI,locked:U&&!e?!0:void 0,children:U&&!e&&Es(Ak,{label:"Clear selection",onClick:_e,icon:dk})}),Vc(q$,{viewState:Q,onViewStateChange:V,height:j,width:oe,layers:Te?k.layers:e1e,getTooltip:S,ContextProvider:ah.Provider,controller:!0,onClick:z&&!e?Ae:void 0,children:[Es(jl,{height:j,width:oe,mapStyle:k.mapStyle&&(typeof k.mapStyle=="string"?k.mapStyle:k.mapStyle[0]),mapboxApiAccessToken:c||o}),Es(Cre,{children:Es(MZ,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})},r1e=gk(wre("st.pydeck_chart")(t1e)),P1e=Bt.memo(r1e);export{P1e as default};
